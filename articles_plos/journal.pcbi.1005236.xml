<!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1d3 20150301//EN" "http://jats.nlm.nih.gov/publishing/1.1d3/JATS-journalpublishing1.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="1.1d3" xml:lang="en">
<front>
<journal-meta>
<journal-id journal-id-type="nlm-ta">PLoS Comput Biol</journal-id>
<journal-id journal-id-type="publisher-id">plos</journal-id>
<journal-id journal-id-type="pmc">ploscomp</journal-id>
<journal-title-group>
<journal-title>PLOS Computational Biology</journal-title>
</journal-title-group>
<issn pub-type="ppub">1553-734X</issn>
<issn pub-type="epub">1553-7358</issn>
<publisher>
<publisher-name>Public Library of Science</publisher-name>
<publisher-loc>San Francisco, CA USA</publisher-loc>
</publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="doi">10.1371/journal.pcbi.1005236</article-id>
<article-id pub-id-type="publisher-id">PCOMPBIOL-D-16-00987</article-id>
<article-categories>
<subj-group subj-group-type="heading">
<subject>Research Article</subject>
</subj-group>
<subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Biophysics</subject><subj-group><subject>Ion channels</subject><subj-group><subject>Calcium channels</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Physical sciences</subject><subj-group><subject>Physics</subject><subj-group><subject>Biophysics</subject><subj-group><subject>Ion channels</subject><subj-group><subject>Calcium channels</subject></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Physiology</subject><subj-group><subject>Electrophysiology</subject><subj-group><subject>Ion channels</subject><subj-group><subject>Calcium channels</subject></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Medicine and health sciences</subject><subj-group><subject>Physiology</subject><subj-group><subject>Electrophysiology</subject><subj-group><subject>Ion channels</subject><subj-group><subject>Calcium channels</subject></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Physiology</subject><subj-group><subject>Electrophysiology</subject><subj-group><subject>Neurophysiology</subject><subj-group><subject>Ion channels</subject><subj-group><subject>Calcium channels</subject></subj-group></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Medicine and health sciences</subject><subj-group><subject>Physiology</subject><subj-group><subject>Electrophysiology</subject><subj-group><subject>Neurophysiology</subject><subj-group><subject>Ion channels</subject><subj-group><subject>Calcium channels</subject></subj-group></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Neuroscience</subject><subj-group><subject>Neurophysiology</subject><subj-group><subject>Ion channels</subject><subj-group><subject>Calcium channels</subject></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Biochemistry</subject><subj-group><subject>Proteins</subject><subj-group><subject>Ion channels</subject><subj-group><subject>Calcium channels</subject></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Cell biology</subject><subj-group><subject>Cellular structures and organelles</subject><subj-group><subject>Cell membranes</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Physical sciences</subject><subj-group><subject>Mathematics</subject><subj-group><subject>Applied mathematics</subject><subj-group><subject>Algorithms</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Research and analysis methods</subject><subj-group><subject>Simulation and modeling</subject><subj-group><subject>Algorithms</subject></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Cell biology</subject><subj-group><subject>Cellular structures and organelles</subject><subj-group><subject>Cell membranes</subject><subj-group><subject>Membrane proteins</subject></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Research and analysis methods</subject><subj-group><subject>Mathematical and statistical techniques</subject><subj-group><subject>Statistical methods</subject><subj-group><subject>Monte Carlo method</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Physical sciences</subject><subj-group><subject>Mathematics</subject><subj-group><subject>Statistics (mathematics)</subject><subj-group><subject>Statistical methods</subject><subj-group><subject>Monte Carlo method</subject></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Physical sciences</subject><subj-group><subject>Chemistry</subject><subj-group><subject>Polymer chemistry</subject><subj-group><subject>Macromolecules</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Physical sciences</subject><subj-group><subject>Mathematics</subject><subj-group><subject>Probability theory</subject><subj-group><subject>Probability density</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Cell biology</subject><subj-group><subject>Signal transduction</subject><subj-group><subject>Cell signaling</subject><subj-group><subject>Membrane receptor signaling</subject></subj-group></subj-group></subj-group></subj-group></subj-group></article-categories>
<title-group>
<article-title>Numerical Approach to Spatial Deterministic-Stochastic Models Arising in Cell Biology</article-title>
<alt-title alt-title-type="running-head">Spatial Hybrid Solver for Models in Cell Biology</alt-title>
</title-group>
<contrib-group>
<contrib contrib-type="author" xlink:type="simple">
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0003-3286-7736</contrib-id>
<name name-style="western">
<surname>Schaff</surname>
<given-names>James C.</given-names>
</name>
<xref ref-type="aff" rid="aff001"/>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<name name-style="western">
<surname>Gao</surname>
<given-names>Fei</given-names>
</name>
<xref ref-type="aff" rid="aff001"/>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<name name-style="western">
<surname>Li</surname>
<given-names>Ye</given-names>
</name>
<xref ref-type="aff" rid="aff001"/>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<name name-style="western">
<surname>Novak</surname>
<given-names>Igor L.</given-names>
</name>
<xref ref-type="aff" rid="aff001"/>
</contrib>
<contrib contrib-type="author" corresp="yes" xlink:type="simple">
<name name-style="western">
<surname>Slepchenko</surname>
<given-names>Boris M.</given-names>
</name>
<xref ref-type="corresp" rid="cor001">*</xref>
<xref ref-type="aff" rid="aff001"/>
</contrib>
</contrib-group>
<aff id="aff001"><addr-line>Richard D. Berlin Center for Cell Analysis and Modeling, Department of Cell Biology, University of Connecticut Health Center, Farmington, Connecticut, United States of America</addr-line></aff>
<contrib-group>
<contrib contrib-type="editor" xlink:type="simple">
<name name-style="western">
<surname>Meier-Schellersheim</surname>
<given-names>Martin</given-names>
</name>
<role>Editor</role>
<xref ref-type="aff" rid="edit1"/>
</contrib>
</contrib-group>
<aff id="edit1"><addr-line>National Institutes of Health, UNITED STATES</addr-line></aff>
<author-notes>
<fn fn-type="conflict" id="coi001">
<p>The authors have declared that no competing interests exist.</p>
</fn>
<fn fn-type="con">
<p><list list-type="simple"> <list-item><p><bold>Conceptualization:</bold> JCS BMS.</p></list-item> <list-item><p><bold>Formal analysis:</bold> ILN BMS.</p></list-item> <list-item><p><bold>Investigation:</bold> BMS.</p></list-item> <list-item><p><bold>Methodology:</bold> JCS ILN BMS.</p></list-item> <list-item><p><bold>Software:</bold> FG YL JCS.</p></list-item> <list-item><p><bold>Validation:</bold> YL ILN BMS.</p></list-item> <list-item><p><bold>Writing – original draft:</bold> BMS.</p></list-item> <list-item><p><bold>Writing – review &amp; editing:</bold> BMS.</p></list-item></list>
</p>
</fn>
<corresp id="cor001">* E-mail: <email xlink:type="simple">boris@uchc.edu</email></corresp>
</author-notes>
<pub-date pub-type="epub">
<day>13</day>
<month>12</month>
<year>2016</year>
</pub-date>
<pub-date pub-type="collection">
<month>12</month>
<year>2016</year>
</pub-date>
<volume>12</volume>
<issue>12</issue>
<elocation-id>e1005236</elocation-id>
<history>
<date date-type="received">
<day>23</day>
<month>6</month>
<year>2016</year>
</date>
<date date-type="accepted">
<day>3</day>
<month>11</month>
<year>2016</year>
</date>
</history>
<permissions>
<copyright-year>2016</copyright-year>
<copyright-holder>Schaff et al</copyright-holder>
<license xlink:href="http://creativecommons.org/licenses/by/4.0/" xlink:type="simple">
<license-p>This is an open access article distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/" xlink:type="simple">Creative Commons Attribution License</ext-link>, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p>
</license>
</permissions>
<self-uri content-type="pdf" xlink:href="info:doi/10.1371/journal.pcbi.1005236"/>
<abstract>
<p>Hybrid deterministic-stochastic methods provide an efficient alternative to a fully stochastic treatment of models which include components with disparate levels of stochasticity. However, general-purpose hybrid solvers for spatially resolved simulations of reaction-diffusion systems are not widely available. Here we describe fundamentals of a general-purpose spatial hybrid method. The method generates realizations of a spatially inhomogeneous hybrid system by appropriately integrating capabilities of a deterministic partial differential equation solver with a popular particle-based stochastic simulator, Smoldyn. Rigorous validation of the algorithm is detailed, using a simple model of calcium ‘sparks’ as a testbed. The solver is then applied to a deterministic-stochastic model of spontaneous emergence of cell polarity. The approach is general enough to be implemented within biologist-friendly software frameworks such as Virtual Cell.</p>
</abstract>
<abstract abstract-type="summary">
<title>Author Summary</title>
<p>Mechanisms of some cellular phenomena involve interactions of molecular systems of which one can be described deterministically, while the other is inherently stochastic. Calcium ‘sparks’ in cardiomyocytes is one such example, in which dynamics of calcium ions, which are usually present in large numbers, can be described deterministically, whereas the channels open and close stochastically. The calcium influx through the channels renders the entire system stochastic, but a fully stochastic treatment accounting for each calcium ion is computationally expensive. Fortunately, such systems can be efficiently solved by hybrid methods in which deterministic and stochastic algorithms are appropriately integrated. Here we describe fundamentals of a general-purpose deterministic-stochastic method for simulating spatially resolved systems. The internal workings of the method are explained and illustrated by applications to very different phenomena such as calcium ‘sparks’, stochastically gated reactions, and spontaneous cell polarization.</p>
</abstract>
<funding-group>
<award-group id="award001">
<funding-source>
<institution-wrap>
<institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/100000057</institution-id>
<institution>National Institute of General Medical Sciences</institution>
</institution-wrap>
</funding-source>
<award-id>9 P41 GM 103313-15</award-id>
</award-group>
<award-group id="award002">
<funding-source>
<institution-wrap>
<institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/100000097</institution-id>
<institution>National Center for Research Resources</institution>
</institution-wrap>
</funding-source>
<award-id>2 P41 RR 013186-15</award-id>
</award-group>
<award-group id="award003">
<funding-source>
<institution-wrap>
<institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/100000057</institution-id>
<institution>National Institute of General Medical Sciences</institution>
</institution-wrap>
</funding-source>
<award-id>U54 GM64346</award-id>
</award-group>
<funding-statement>The work was supported by grants from the National Center for Research Resources (2P41RR013186-15) and the National Institute of General Medical Sciences (9 P41 GM103313-15 and U54 GM64346) from the National Institutes of Health. The funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.</funding-statement>
</funding-group>
<counts>
<fig-count count="8"/>
<table-count count="0"/>
<page-count count="23"/>
</counts>
<custom-meta-group>
<custom-meta id="data-availability">
<meta-name>Data Availability</meta-name>
<meta-value>Our data are all contained within the paper.</meta-value>
</custom-meta>
</custom-meta-group>
</article-meta>
</front>
<body>
<sec id="sec001" sec-type="intro">
<title>Introduction</title>
<p>It is not uncommon for a cell-biological model to include some components that might be stochastic in nature (small copy numbers, rare events), whereas others, if uncoupled, would behave deterministically (large copy numbers, fast reactions). Through their interaction, fluctuations in a stochastic subsystem may induce significant random perturbations in the ‘deterministic’ one, thus rendering the entire system stochastic. Calcium sparks in cardiomyocytes and other cells [<xref ref-type="bibr" rid="pcbi.1005236.ref001">1</xref>] is one such example, where calcium released from intracellular stores through calcium channels may, in turn, influence probabilities of opening and closing of those channels. Here, calcium concentration can often be regarded as a ‘deterministic’ component of the system, whereas the dynamics of calcium channels is inherently stochastic. Similarly, stochastic openings of voltage-sensitive ion channels depend on the ‘deterministic’ membrane potential, which, in turn, is affected by stochastic electric currents passing through the channels [<xref ref-type="bibr" rid="pcbi.1005236.ref002">2</xref>]. Stochasticity in otherwise deterministic cellular subsystems may also be brought about by their coupling to dynamics of cytoskeletal filaments, translation events, and other processes involving macromolecules and small organelles present in small numbers.</p>
<p>Simulating such systems as fully stochastic can be prohibitively slow. Indeed, simulating calcium sparks stochastically with an account of every single calcium ion would be computationally expensive because their number is typically large. But in the limit of large copy numbers, the intrinsic fluctuations due to discreteness of molecules are insignificant, and one can design faster hybrid algorithms, in which deterministic and stochastic approaches are appropriately combined. While these efficient methods are approximate, the larger the copy numbers in the ‘deterministic’ subsystem, the more accurate their outcome.</p>
<p>Numerical approaches to interacting systems with disparate levels of stochasticity are an area of active interdisciplinary research. In the context of cell-biological applications, various hybrid approaches were proposed for ‘well-mixed’ models of biochemical networks with fast and slow components [<xref ref-type="bibr" rid="pcbi.1005236.ref003">3</xref>, <xref ref-type="bibr" rid="pcbi.1005236.ref004">4</xref>]. In these models, a fast component, whose copy numbers are only moderately large, is often modeled as a Wiener stochastic process, rather than deterministically. The corresponding numerical techniques are a combination of methods of solving stochastic ordinary differential equations (SDEs) [<xref ref-type="bibr" rid="pcbi.1005236.ref005">5</xref>], also termed Langevin equations in the physics literature, and Gillespie-type algorithms [<xref ref-type="bibr" rid="pcbi.1005236.ref006">6</xref>, <xref ref-type="bibr" rid="pcbi.1005236.ref007">7</xref>] that simulate stochastic reaction events in the slow component. Unlike <italic>stochastic</italic> hybrids, the <italic>deterministic</italic>-stochastic models are mathematically defined as piecewise deterministic Markov processes [<xref ref-type="bibr" rid="pcbi.1005236.ref008">8</xref>, <xref ref-type="bibr" rid="pcbi.1005236.ref009">9</xref>], in which the system develops deterministically between consecutive stochastic events. Numerical approaches to such systems are based on a formulation that couples differential equations, which describe continuous variables, with equations that govern probability distributions of the stochastic components. The coupling occurs through ‘deterministic’ rates dependent on discrete stochastic variables and transition probability rates that are functions of continuous variables. Efficient numerical methods for solving deterministic-stochastic models rely on generating Monte Carlo realizations of a hybrid system. For this, a kinetic Monte Carlo algorithm advancing a stochastic subsystem in time must work in conjunction with a deterministic integrator that updates continuous variables by solving the corresponding differential equations.</p>
<p>A variety of algorithms were proposed for spatially uniform, or well-mixed, deterministic-stochastic models. Fixed time step methods, applied to hybrid models of membrane potential [<xref ref-type="bibr" rid="pcbi.1005236.ref002">2</xref>] and calcium dynamics [<xref ref-type="bibr" rid="pcbi.1005236.ref010">10</xref>], are conceptually straightforward but incur time-discretization errors in stochastic variables. In adaptive methods, which were first proposed for solving deterministic-stochastic models of biochemical networks [<xref ref-type="bibr" rid="pcbi.1005236.ref011">11</xref>], the treatment of a stochastic subsystem is essentially free of time-discretization errors. In these algorithms, accurate sampling of stochastic reaction events coupled to continuous variables is achieved by adapting Gillespie’s methods for systems whose transition rates explicitly depend on time. A similar approach was used in a hybrid <italic>stochastic</italic> algorithm for well-mixed systems with fast and slow components [<xref ref-type="bibr" rid="pcbi.1005236.ref012">12</xref>]. It should be noted that in adaptive methods, special care is required for ensuring synchronous treatment of the ‘deterministic’ and stochastic subsystems. A rigorous convergence analysis of the hybrid adaptive methods was given in [<xref ref-type="bibr" rid="pcbi.1005236.ref013">13</xref>].</p>
<p>Numerical methods for spatially resolved deterministic-stochastic models are less common. A method described in [<xref ref-type="bibr" rid="pcbi.1005236.ref014">14</xref>] approximates a stochastic subsystem by a reaction-diffusion master equation [<xref ref-type="bibr" rid="pcbi.1005236.ref015">15</xref>–<xref ref-type="bibr" rid="pcbi.1005236.ref018">18</xref>]. In this approximation, a spatial domain is partitioned into subvolumes which are assumed to be well-mixed at any time, and a state of the stochastic subsystem is described in terms of copy numbers per subvolume. The master equation is then solved by an optimized variant of the Next Subvolume method [<xref ref-type="bibr" rid="pcbi.1005236.ref019">19</xref>]. Designed for models with relatively slow deterministic dynamics, the method of [<xref ref-type="bibr" rid="pcbi.1005236.ref014">14</xref>] is applicable only if the stochastic subsystems involve sufficiently large copy numbers per subvolume [<xref ref-type="bibr" rid="pcbi.1005236.ref020">20</xref>, <xref ref-type="bibr" rid="pcbi.1005236.ref021">21</xref>].</p>
<p>Stochastic subsystems with relatively low copy numbers can be described in terms of states and spatial locations of individual molecules. The particle-based approach was used to simulate a simple model of assembly of RNA granules in which RNA molecules bind to core complexes [<xref ref-type="bibr" rid="pcbi.1005236.ref022">22</xref>]. In the model, spatial distributions of RNA molecules were modeled deterministically by partial differential equations. The core complexes and RNA granules were treated stochastically as individual particles interacting with the deterministic subsystem while undergoing random walks. A similar approach was adopted in modeling actin bundles and asters [<xref ref-type="bibr" rid="pcbi.1005236.ref023">23</xref>, <xref ref-type="bibr" rid="pcbi.1005236.ref024">24</xref>], where the stochastic subsystem was comprised of tips of actin filaments while ‘deterministic’ actin monomers were modeled as well-mixed because of their relatively fast diffusion.</p>
<p>States and positions of individual channels were also used to define stochastic subsystems in spatial versions of the deterministic-stochastic models of membrane potential [<xref ref-type="bibr" rid="pcbi.1005236.ref025">25</xref>] and calcium release from inositol 1,4,5-trisphosphate (InsP<sub>3</sub>)-receptor channels [<xref ref-type="bibr" rid="pcbi.1005236.ref026">26</xref>–<xref ref-type="bibr" rid="pcbi.1005236.ref028">28</xref>, <xref ref-type="bibr" rid="pcbi.1005236.ref002">2</xref>]. Algorithmically, the methods in these studies combined deterministic descriptions in terms of partial differential equations and the event-driven time stepping schemes [<xref ref-type="bibr" rid="pcbi.1005236.ref011">11</xref>]. Calcium-induced calcium release in cardiac muscle cells [<xref ref-type="bibr" rid="pcbi.1005236.ref029">29</xref>] was already mentioned above as a mechanism that naturally lends itself to a hybrid numerical treatment. Playing a key role in ensuring robustness of heart contractions in response to action potentials, it has been studied extensively by various methods [<xref ref-type="bibr" rid="pcbi.1005236.ref030">30</xref>], including mathematical modeling [<xref ref-type="bibr" rid="pcbi.1005236.ref031">31</xref>]. The calcium release in cardiomyocytes occurs by way of clustered ryanodine receptor channels (RyR) and, in a healthy heart, takes the form of an avalanche of calcium ‘sparks’, the localized spikes of calcium concentration [<xref ref-type="bibr" rid="pcbi.1005236.ref032">32</xref>]. Recent advances in experimental technologies have generated renewed interest in detailed predictive computational modeling of calcium dynamics in heart muscle cells for normal and pathological conditions [<xref ref-type="bibr" rid="pcbi.1005236.ref033">33</xref>, <xref ref-type="bibr" rid="pcbi.1005236.ref034">34</xref>]. Similar to calcium release from the (InsP<sub>3</sub>)-receptor channels, the problem entails coupling of a spatial deterministic description of calcium and stochastic kinetics of RyR channels and can be solved efficiently by a hybrid numerical method.</p>
<p>All of the above approaches were largely specific solutions to a specific modeling problem or a restricted domain of problems. In this article, we describe a general-purpose spatial deterministic-stochastic algorithm and discuss techniques used for its validation. The work was motivated by the need of providing tools for simulating spatial hybrid models to a wide range of cell scientists. The method is designed to be applicable to a broad spectrum of models, including those where continuous and discrete variables are defined both in volume and in the encompassing membranes. The current implementation of the method appropriately combines capabilities of one of the Virtual Cell (VCell) [<xref ref-type="bibr" rid="pcbi.1005236.ref035">35</xref>–<xref ref-type="bibr" rid="pcbi.1005236.ref039">39</xref>] spatial deterministic solvers and an efficient particle-based simulator called Smoldyn [<xref ref-type="bibr" rid="pcbi.1005236.ref040">40</xref>, <xref ref-type="bibr" rid="pcbi.1005236.ref041">41</xref>]. (Note that Smoldyn has been recently adapted to accommodate a different type of hybrid stochastic models [<xref ref-type="bibr" rid="pcbi.1005236.ref042">42</xref>], in which the subsystems with disparate levels of stochasticity are segregated in space but can interact in a ‘handshaking’ region [<xref ref-type="bibr" rid="pcbi.1005236.ref043">43</xref>–<xref ref-type="bibr" rid="pcbi.1005236.ref046">46</xref>].) The development of the VCell hybrid solver benefited from recent integration of Smoldyn into VCell as a method of solving spatial stochastic models [<xref ref-type="bibr" rid="pcbi.1005236.ref047">47</xref>]. A distinct feature of our hybrid solver is that the simulations of widespread fluctuations originating from point sources can be carried out in realistic geometries taken from experimental images, as both VCell and Smoldyn provide tools for simulating reaction-diffusion systems in arbitrary geometries [<xref ref-type="bibr" rid="pcbi.1005236.ref048">48</xref>, <xref ref-type="bibr" rid="pcbi.1005236.ref049">49</xref>, <xref ref-type="bibr" rid="pcbi.1005236.ref040">40</xref>].</p>
<p>This article is focused on physical underpinnings of the method and its algorithmic details, with special emphasis on rigorous validation of its key elements. Hybrid algorithms, often proposed heuristically, may appear intuitive, but their rigorous analysis and validation constitute a challenging task [<xref ref-type="bibr" rid="pcbi.1005236.ref012">12</xref>, <xref ref-type="bibr" rid="pcbi.1005236.ref025">25</xref>, <xref ref-type="bibr" rid="pcbi.1005236.ref007">7</xref>]. This is particularly true in the context of spatially resolved models. Tests against deterministic limits, while necessary, are insufficient because convergence to a correct deterministic limit does not yet guarantee correct behavior in the stochastic regime. Analytical solutions of stochastic models, required for convergence studies in the stochastic regime, are rare, particularly for spatial hybrid systems. In addition to truncation errors due to the time-space discretization, common to deterministic integrators, probability distributions and correlation functions obtained by Monte Carlo techniques include statistical errors due to finite numbers of realizations. Thus, the validation of a spatial hybrid solver entails analysis of multidimensional datasets representing multiple realizations of a hybrid system obtained with varying discretization parameters.</p>
<p>The paper is organized as follows. The algorithm, along with its mathematical fundamentals, is described in Section <italic>Mathematical problem and algorithm</italic> using a simple model of calcium sparks as an example. It is then applied to two very different cell-biological phenomena. The calcium spark model introduced in Section <italic>Mathematical problem and algorithm</italic> is used in Section <italic>Validation of the method</italic> for validation of the method against analytical results and numerical solutions obtained by alternative methods. In Section <italic>Application to a hybrid model of spontaneous cell polarization</italic>, the method is applied to a hybrid model of spontaneous cell polarization; the actual VCell MathModel script for this application is included in <xref ref-type="supplementary-material" rid="pcbi.1005236.s003">S3 Text</xref> as an illustration of the software implementation. A summary of results and discussion of possible improvements conclude the paper.</p>
</sec>
<sec id="sec002" sec-type="results">
<title>Results</title>
<sec id="sec003">
<title>The mathematical problem and algorithm</title>
<p>Mathematically, the algorithm is based on a formulation of a deterministic-stochastic system, which is somewhat similar to how Wiener processes are described in terms of Langevin equations. To illustrate the approach and explain the workings of the algorithm, we employ a simple model of calcium sparks, whose ‘deterministic’ subsystem consists of a single variable, the calcium concentration <italic>U</italic>(<bold>r</bold>,<italic>t</italic>), and its stochastic subsystem is comprised of calcium channels, through which calcium flows into the cell from intracellular stores. In muscle cells, calcium channels form small regularly distributed clusters. For simplicity, we will treat the calcium sources as single channels having two states, open and closed. The corresponding discrete stochastic variables are <italic>Ξ</italic><sub><italic>i</italic></sub>(<bold>r</bold>,<italic>t</italic>) ≡ δ(<bold>r</bold> − <bold>r</bold><sub><italic>i</italic></sub>)<italic>ξ</italic><sub><italic>i</italic></sub>(<italic>t</italic>), where the Dirac deltas δ(<bold>r</bold> − <bold>r</bold><sub><italic>i</italic></sub>) define channel locations and the stochastic variables <italic>ξ</italic><sub><italic>i</italic></sub>(<italic>t</italic>) accept two values: 1 (open state) and 0 (closed state). The index <italic>i</italic> enumerates the channels, and <bold>r</bold>,<bold>r</bold><sub><italic>i</italic></sub> ∈ <italic>Ω</italic><sub><bold>cell</bold></sub>, where <italic>Ω</italic><sub><bold>cell</bold></sub> denotes the space of a cell.</p>
<p>Dynamics of the continuous variable <italic>U</italic>(<bold>r</bold>,<italic>t</italic>) are affected by the following mechanisms: calcium release through channels, calcium diffusion, and removal of calcium from the cytosol via calcium pumps. The variable is therefore governed by a partial differential equation (PDE) with stochastic source terms,
<disp-formula id="pcbi.1005236.e001">
<alternatives>
<graphic id="pcbi.1005236.e001g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e001" xlink:type="simple"/>
<mml:math display="block" id="M1">
<mml:mrow><mml:msub><mml:mo>∂</mml:mo><mml:mi>t</mml:mi></mml:msub><mml:mi>U</mml:mi><mml:mo>=</mml:mo><mml:mo>∇</mml:mo><mml:mo>⋅</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>D</mml:mi><mml:mo>∇</mml:mo><mml:mi>U</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mi>J</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mstyle displaystyle="true"><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mtext>ch</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:msubsup><mml:mrow><mml:msub><mml:mi>Ξ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">r</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle><mml:mo>−</mml:mo><mml:msub><mml:mi>V</mml:mi><mml:mtext>p</mml:mtext></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>U</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>U</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mrow>
</mml:math>
</alternatives>
<label>(1)</label>
</disp-formula>
where <italic>D</italic> is the calcium diffusion constant, <italic>J</italic> is the calcium flux through an open channel, <italic>N</italic><sub>ch</sub> is the total number of channels in the cell, <italic>V</italic><sub>p</sub> is the calcium pump rate constant, and <italic>U</italic><sub>0</sub> is the steady-state calcium concentration in the absence of open channels. Eq (<xref ref-type="disp-formula" rid="pcbi.1005236.e001">1</xref>) is subject to boundary conditions imposed at the cell membrane. For example, if calcium fluxes at the plasma membrane can be ignored, the corresponding no-flux boundary condition can be written as
<disp-formula id="pcbi.1005236.e002">
<alternatives>
<graphic id="pcbi.1005236.e002g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e002" xlink:type="simple"/>
<mml:math display="block" id="M2">
<mml:mrow><mml:mo>−</mml:mo><mml:mi>D</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">n</mml:mi><mml:mo>⋅</mml:mo><mml:mo>∇</mml:mo><mml:mi>U</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mo>|</mml:mo><mml:mrow><mml:mo>∂</mml:mo><mml:msub><mml:mi>Ω</mml:mi><mml:mrow><mml:mtext>cell</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo></mml:mrow>
</mml:math>
</alternatives>
<label>(2)</label>
</disp-formula>
where <bold>n</bold> is an outward normal to the cell membrane ∂<italic>Ω</italic><sub>cell</sub>.</p>
<p>Dynamics of the stochastic subsystem are described by a two-component probability distribution function, <inline-formula id="pcbi.1005236.e003"><alternatives><graphic id="pcbi.1005236.e003g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e003" xlink:type="simple"/><mml:math display="inline" id="M3"><mml:mrow><mml:mo>{</mml:mo><mml:msubsup><mml:mi>P</mml:mi><mml:mn>0</mml:mn><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mi>P</mml:mi><mml:mn>1</mml:mn><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>}</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>, given that in our simple model a channel has only two states. The differential Chapman-Kolmogorov equation that governs Markov processes [<xref ref-type="bibr" rid="pcbi.1005236.ref005">5</xref>] reduces in this case to
<disp-formula id="pcbi.1005236.e004">
<alternatives>
<graphic id="pcbi.1005236.e004g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e004" xlink:type="simple"/>
<mml:math display="block" id="M4">
<mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:msubsup><mml:mi>P</mml:mi><mml:mn>0</mml:mn><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mi>d</mml:mi><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mtext>on</mml:mtext></mml:mrow><mml:mi>i</mml:mi></mml:msubsup><mml:mi>d</mml:mi><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msubsup><mml:mi>P</mml:mi><mml:mn>0</mml:mn><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mtext>off</mml:mtext></mml:mrow><mml:mi>i</mml:mi></mml:msubsup><mml:msubsup><mml:mi>P</mml:mi><mml:mn>1</mml:mn><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msubsup><mml:mi>P</mml:mi><mml:mn>1</mml:mn><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mi>d</mml:mi><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mtext>off</mml:mtext></mml:mrow><mml:mi>i</mml:mi></mml:msubsup><mml:mi>d</mml:mi><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msubsup><mml:mi>P</mml:mi><mml:mn>1</mml:mn><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mtext>on</mml:mtext></mml:mrow><mml:mi>i</mml:mi></mml:msubsup><mml:msubsup><mml:mi>P</mml:mi><mml:mn>0</mml:mn><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:mtd></mml:mtr></mml:mtable><mml:mspace width="3em"/><mml:mo stretchy="false">(</mml:mo><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mn>…</mml:mn><mml:mo>,</mml:mo><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mtext>ch</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo>
</mml:math>
</alternatives>
<label>(3)</label>
</disp-formula>
where <inline-formula id="pcbi.1005236.e005"><alternatives><graphic id="pcbi.1005236.e005g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e005" xlink:type="simple"/><mml:math display="inline" id="M5"><mml:mrow><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mtext>on</mml:mtext></mml:mrow><mml:mi>i</mml:mi></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1005236.e006"><alternatives><graphic id="pcbi.1005236.e006g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e006" xlink:type="simple"/><mml:math display="inline" id="M6"><mml:mrow><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mtext>off</mml:mtext></mml:mrow><mml:mi>i</mml:mi></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula> are the rate constants for channel openings and closings, respectively. (Because <inline-formula id="pcbi.1005236.e007"><alternatives><graphic id="pcbi.1005236.e007g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e007" xlink:type="simple"/><mml:math display="inline" id="M7"><mml:mrow><mml:msubsup><mml:mi>P</mml:mi><mml:mn>0</mml:mn><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:msubsup><mml:mi>P</mml:mi><mml:mn>1</mml:mn><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>≡</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>, it is sufficient to solve only for one of the components, say, for <inline-formula id="pcbi.1005236.e008"><alternatives><graphic id="pcbi.1005236.e008g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e008" xlink:type="simple"/><mml:math display="inline" id="M8"><mml:mrow><mml:msubsup><mml:mi>P</mml:mi><mml:mn>1</mml:mn><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>.) Importantly, parameters <inline-formula id="pcbi.1005236.e009"><alternatives><graphic id="pcbi.1005236.e009g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e009" xlink:type="simple"/><mml:math display="inline" id="M9"><mml:mrow><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mtext>on</mml:mtext></mml:mrow><mml:mi>i</mml:mi></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1005236.e010"><alternatives><graphic id="pcbi.1005236.e010g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e010" xlink:type="simple"/><mml:math display="inline" id="M10"><mml:mrow><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mtext>off</mml:mtext></mml:mrow><mml:mi>i</mml:mi></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula> may depend on <italic>U</italic>(<bold>r</bold>,<italic>t</italic>); this would couple Eq (<xref ref-type="disp-formula" rid="pcbi.1005236.e004">3</xref>) with Eqs (<xref ref-type="disp-formula" rid="pcbi.1005236.e001">1</xref> and <xref ref-type="disp-formula" rid="pcbi.1005236.e002">2</xref>) and also make the equations with different <italic>i</italic>, which otherwise would be independent, indirectly affect each other. Note that because of coupling with <italic>Ξ</italic><sub><italic>i</italic></sub>(<bold>r</bold>,<italic>t</italic>), <italic>U</italic>(<bold>r</bold>,<italic>t</italic>) also becomes a stochastic variable.</p>
<p>Eqs (<xref ref-type="disp-formula" rid="pcbi.1005236.e001">1</xref>–<xref ref-type="disp-formula" rid="pcbi.1005236.e004">3</xref>) fully determine the time-dependent behavior of the deterministic-stochastic system for given initial conditions <inline-formula id="pcbi.1005236.e011"><alternatives><graphic id="pcbi.1005236.e011g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e011" xlink:type="simple"/><mml:math display="inline" id="M11"><mml:mrow><mml:mo>{</mml:mo><mml:mi>U</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">r</mml:mi><mml:mo>,</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>;</mml:mo><mml:mo>{</mml:mo><mml:msubsup><mml:mi>P</mml:mi><mml:mn>1</mml:mn><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo><mml:mo>}</mml:mo><mml:mo>}</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>. Their generalization to multivariate (multistate) models is straightforward, yielding descriptions that retain the structure and features of Eqs (<xref ref-type="disp-formula" rid="pcbi.1005236.e001">1</xref>–<xref ref-type="disp-formula" rid="pcbi.1005236.e004">3</xref>). Specifically, a multivariate spatial piecewise-deterministic Markov process is defined in terms of random variables of two types [<xref ref-type="bibr" rid="pcbi.1005236.ref016">16</xref>, <xref ref-type="bibr" rid="pcbi.1005236.ref028">28</xref>], the continuous ‘<italic>U</italic>-type’ and discrete ‘<italic>Ξ</italic>-type’ variables. Using vector notation for sets of these variables, all possible outcomes of the process, {<bold>U</bold>(<bold>r</bold>),<bold>Ξ</bold>(<bold>r</bold>)}, form an infinite-dimensional function space [<xref ref-type="bibr" rid="pcbi.1005236.ref028">28</xref>]. The only practical approach to solving numerically for a time-dependent probability density functional <italic>p</italic>({<bold>U</bold>(<bold>r</bold>),<bold>Ξ</bold>(<bold>r</bold>)},<italic>t</italic>) is by Monte Carlo simulations of individual realizations of a system based on generation of pseudorandom numbers. The description in the mold of Eqs (<xref ref-type="disp-formula" rid="pcbi.1005236.e001">1</xref>–<xref ref-type="disp-formula" rid="pcbi.1005236.e004">3</xref>) provides an intuitive script for an algorithm of this type. (Alternatively, one can seek a direct numerical solution of a functional equation governing <italic>p</italic>({<bold>U</bold>(<bold>r</bold>),<bold>Ξ</bold>(<bold>r</bold>)},<italic>t</italic>) [<xref ref-type="bibr" rid="pcbi.1005236.ref005">5</xref>], which, however, quickly runs into memory constraints. Still, this approach can be used for testing purposes, see subsection <italic>Fully coupled systems with finite diffusion</italic>: <italic>validation against direct solutions of Fokker-Planck equation</italic>).</p>
<p>Our spatial hybrid algorithm employs fixed time step integration due to its conceptual and logistical simplicity. The downside is that the stability constraints imposed on the time step, which should be sufficiently small to resolve fast ‘deterministic’ reactions, may result in slow performance. The inefficiency can be partially alleviated by applying an automatic pseudo-steady-state treatment [<xref ref-type="bibr" rid="pcbi.1005236.ref050">50</xref>].</p>
<p>A key element of a hybrid method is how the numerical treatments of the ‘deterministic’ and stochastic subsystems are merged. In our algorithm, the PDEs are discretized in space using a finite-volume scheme [<xref ref-type="bibr" rid="pcbi.1005236.ref051">51</xref>], in which a computational domain <italic>Ω</italic> is partitioned into <italic>N</italic><sub><italic>ω</italic></sub> subvolumes: <italic>Ω</italic> = {<italic>ω</italic><sub><italic>j</italic></sub>}, <italic>j</italic> = 1,…, <italic>N</italic><sub><italic>ω</italic></sub>. The <italic>U</italic>-type variables are discretized respectively as <bold>U</bold>(<bold>r</bold>) → {<bold>U</bold><sub><italic>j</italic></sub> ≡ <bold>U</bold>(<bold>r</bold><sub><italic>j</italic></sub>)}, where <bold>r</bold><sub><italic>j</italic></sub> is the center of <italic>ω</italic><sub><italic>j</italic></sub> and <bold>U</bold><sub><italic>j</italic></sub> has a meaning of a subvolume average: <inline-formula id="pcbi.1005236.e012"><alternatives><graphic id="pcbi.1005236.e012g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e012" xlink:type="simple"/><mml:math display="inline" id="M12"><mml:mrow><mml:msub><mml:mi mathvariant="bold">U</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:msub><mml:mi>ω</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:msup><mml:mo stretchy="false">|</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mstyle displaystyle="true"><mml:mrow><mml:msub><mml:mo>∫</mml:mo><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mrow><mml:mi mathvariant="bold">U</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">r</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msup><mml:mi>d</mml:mi><mml:mn>3</mml:mn></mml:msup><mml:mi mathvariant="bold">r</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:mrow></mml:math></alternatives></inline-formula>, where |<italic>ω</italic><sub><italic>j</italic></sub>| stands for the volume of <italic>ω</italic><sub><italic>j</italic></sub>. Spatial histograms of stochastic variables that use the same subvolumes {<italic>ω</italic><sub><italic>j</italic></sub>} as bins would have the similar meaning. Indeed, let <italic>N</italic><sub><italic>Ξ</italic></sub> be the number of particles of a given type <italic>Ξ</italic>; then the histogram <inline-formula id="pcbi.1005236.e013"><alternatives><graphic id="pcbi.1005236.e013g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e013" xlink:type="simple"/><mml:math display="inline" id="M13"><mml:mrow><mml:msubsup><mml:mi>Ξ</mml:mi><mml:mi>j</mml:mi><mml:mi>s</mml:mi></mml:msubsup><mml:mo>=</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:msub><mml:mi>ω</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:msup><mml:mo stretchy="false">|</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mstyle displaystyle="true"><mml:mrow><mml:munder><mml:mo>∫</mml:mo><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:munder><mml:mrow><mml:mstyle displaystyle="true"><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>Ξ</mml:mi></mml:msub></mml:mrow></mml:munderover><mml:mrow><mml:msub><mml:mi>Ξ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">r</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mo stretchy="false">|</mml:mo><mml:mrow><mml:msub><mml:mi>ξ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mstyle><mml:msup><mml:mi>d</mml:mi><mml:mn>3</mml:mn></mml:msup><mml:mi mathvariant="bold">r</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:mrow></mml:math></alternatives></inline-formula> describes the density of particles of the molecular type <italic>Ξ</italic> in state <italic>s</italic> in the vicinity of <bold>r</bold><sub><italic>j</italic></sub> or, more precisely, the number of particles <italic>Ξ</italic><sub><italic>i</italic></sub>|<sub><italic>ξ</italic> = <italic>s</italic></sub> in <italic>ω</italic><sub><italic>j</italic></sub> divided by the volume of <italic>ω</italic><sub><italic>j</italic></sub> (<italic>s</italic> = 1,…, <italic>N</italic><sub>st</sub>(<italic>Ξ</italic>); here, <italic>N</italic><sub>st</sub>(<italic>Ξ</italic>) is the number of states of a particle of type <italic>Ξ</italic>). For example, the spatial binning of the stochastic source term of Eq (<xref ref-type="disp-formula" rid="pcbi.1005236.e001">1</xref>) yields <inline-formula id="pcbi.1005236.e014"><alternatives><graphic id="pcbi.1005236.e014g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e014" xlink:type="simple"/><mml:math display="inline" id="M14"><mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:msub><mml:mi>ω</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:msup><mml:mo stretchy="false">|</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mstyle displaystyle="true"><mml:mrow><mml:munder><mml:mo>∫</mml:mo><mml:mrow><mml:msub><mml:mi>ω</mml:mi><mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:munder><mml:mrow><mml:mstyle displaystyle="true"><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mrow><mml:mtext>ch</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:munderover><mml:mrow><mml:msub><mml:mi>Ξ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">r</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mo stretchy="false">|</mml:mo><mml:mrow><mml:msub><mml:mi>ξ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mstyle><mml:msup><mml:mi>d</mml:mi><mml:mn>3</mml:mn></mml:msup><mml:mi mathvariant="bold">r</mml:mi></mml:mrow></mml:mrow></mml:mstyle><mml:mo>=</mml:mo><mml:msub><mml:mi>n</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>/</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:msub><mml:mi>ω</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>, where <italic>n</italic><sub><italic>j</italic></sub> is the number of open calcium channels inside <italic>ω</italic><sub><italic>j</italic></sub>. Then, as expected, <italic>Jn</italic><sub><italic>j</italic></sub>/|<italic>ω</italic><sub><italic>j</italic></sub>| is the rate of change of calcium concentration due to the influx through open channels located in the vicinity of <bold>r</bold><sub><italic>j</italic></sub>. As a result, both the deterministic and stochastic rates can now be expressed in terms of sets <inline-formula id="pcbi.1005236.e015"><alternatives><graphic id="pcbi.1005236.e015g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e015" xlink:type="simple"/><mml:math display="inline" id="M15"><mml:mrow><mml:mo>{</mml:mo><mml:msub><mml:mi mathvariant="bold">U</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:msubsup><mml:mi>Ξ</mml:mi><mml:mi>j</mml:mi><mml:mi>s</mml:mi></mml:msubsup><mml:mo>}</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> with components defined for the same spatial grid, which makes advancing the hybrid system in time conceptually straightforward.</p>
<p>A realization of a piecewise deterministic Markov process at time <italic>t</italic> + <italic>Δt</italic> is generated on the basis of a known state at time <italic>t</italic> as follows. For sufficiently small time steps <italic>Δt</italic>, such that the sum of the <italic>O</italic>(<italic>Δt</italic>) terms in the expansion of the total transition probability for a particle is less than 1, a particle may undergo at most one stochastic transition per <italic>Δt</italic> from its current state to a new one. (For the example described by Eq (<xref ref-type="disp-formula" rid="pcbi.1005236.e004">3</xref>), this requirement yields a condition <inline-formula id="pcbi.1005236.e016"><alternatives><graphic id="pcbi.1005236.e016g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e016" xlink:type="simple"/><mml:math display="inline" id="M16"><mml:mrow><mml:mi>Δ</mml:mi><mml:mi>t</mml:mi><mml:mo>&lt;&lt;</mml:mo><mml:mn>1</mml:mn><mml:mo>/</mml:mo><mml:mi mathvariant="normal">max</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mtext>on</mml:mtext></mml:mrow><mml:mi>i</mml:mi></mml:msubsup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mtext>off</mml:mtext></mml:mrow><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>). Thus, without loss of generality, occurrences of the stochastic transitions can be assigned to the end points of the interval <italic>Δt</italic>. Therefore <italic>during</italic> the interval, the variables <bold>Ξ</bold>(<bold>r</bold>,<italic>t</italic>) remain unchanged and, upon the binning described above, the equations for <bold>U</bold>(<bold>r</bold>,<italic>t</italic>) become regular deterministic PDEs (see, e.g., Eq (<xref ref-type="disp-formula" rid="pcbi.1005236.e001">1</xref>) of the simple calcium sparks model). The updated values <bold>U</bold>(<bold>r</bold>,<italic>t</italic> + <italic>Δt</italic>) are then found by integrating the PDEs over <italic>Δt</italic> with the corresponding boundary conditions (exemplified by Eq (<xref ref-type="disp-formula" rid="pcbi.1005236.e002">2</xref>)). In our method, this is done by employing a fixed time step PDE solver of VCell.</p>
<p>The update of variables <bold>Ξ</bold>(<bold>r</bold>,<italic>t</italic>) is carried out by employing Smoldyn, a particle-based fixed time step Monte Carlo package [<xref ref-type="bibr" rid="pcbi.1005236.ref040">40</xref>, <xref ref-type="bibr" rid="pcbi.1005236.ref041">41</xref>]. Using again the simple calcium spark model as an example, the transitions of a channel between open and closed states can be interpreted as ‘unimolecular’ reactions, which are simulated by Smoldyn through acceptance-rejection sampling. First, those of the rate parameters <inline-formula id="pcbi.1005236.e017"><alternatives><graphic id="pcbi.1005236.e017g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e017" xlink:type="simple"/><mml:math display="inline" id="M17"><mml:mrow><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mtext>on</mml:mtext></mml:mrow><mml:mi>i</mml:mi></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1005236.e018"><alternatives><graphic id="pcbi.1005236.e018g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e018" xlink:type="simple"/><mml:math display="inline" id="M18"><mml:mrow><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mtext>off</mml:mtext></mml:mrow><mml:mi>i</mml:mi></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula> in Eq (<xref ref-type="disp-formula" rid="pcbi.1005236.e004">3</xref>) that depend on <italic>U</italic>(<bold>r</bold>,<italic>t</italic>) are updated accordingly. Next, given known states of the channels <italic>ξ</italic><sub><italic>i</italic></sub>(<italic>t</italic>) at time <italic>t</italic>, the probability of a transition to occur by the end of the time interval is computed. If, for example <italic>ξ</italic><sub><italic>i</italic></sub>(<italic>t</italic>) = 0, i.e. the <italic>i</italic>th channel is in a closed state at time <italic>t</italic>, then <inline-formula id="pcbi.1005236.e019"><alternatives><graphic id="pcbi.1005236.e019g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e019" xlink:type="simple"/><mml:math display="inline" id="M19"><mml:mrow><mml:msubsup><mml:mi>P</mml:mi><mml:mn>0</mml:mn><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1005236.e020"><alternatives><graphic id="pcbi.1005236.e020g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e020" xlink:type="simple"/><mml:math display="inline" id="M20"><mml:mrow><mml:msubsup><mml:mi>P</mml:mi><mml:mn>1</mml:mn><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>. As a result, the first of Eq (<xref ref-type="disp-formula" rid="pcbi.1005236.e004">3</xref>) becomes <inline-formula id="pcbi.1005236.e021"><alternatives><graphic id="pcbi.1005236.e021g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e021" xlink:type="simple"/><mml:math display="inline" id="M21"><mml:mrow><mml:mi>d</mml:mi><mml:msubsup><mml:mi>P</mml:mi><mml:mn>0</mml:mn><mml:mi>i</mml:mi></mml:msubsup><mml:mo>/</mml:mo><mml:mi>d</mml:mi><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mtext>on</mml:mtext></mml:mrow><mml:mi>i</mml:mi></mml:msubsup><mml:msubsup><mml:mi>P</mml:mi><mml:mn>0</mml:mn><mml:mi>i</mml:mi></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula>, and because the rate constants stay fixed during the time interval, <inline-formula id="pcbi.1005236.e022"><alternatives><graphic id="pcbi.1005236.e022g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e022" xlink:type="simple"/><mml:math display="inline" id="M22"><mml:mrow><mml:msubsup><mml:mi>P</mml:mi><mml:mn>0</mml:mn><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mi>Δ</mml:mi><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi mathvariant="normal">exp</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mo>−</mml:mo><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mtext>on</mml:mtext></mml:mrow><mml:mi>i</mml:mi></mml:msubsup><mml:mi>Δ</mml:mi><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1005236.e023"><alternatives><graphic id="pcbi.1005236.e023g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e023" xlink:type="simple"/><mml:math display="inline" id="M23"><mml:mrow><mml:msubsup><mml:mi>P</mml:mi><mml:mn>1</mml:mn><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mi>Δ</mml:mi><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi mathvariant="normal">exp</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mo>−</mml:mo><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mtext>on</mml:mtext></mml:mrow><mml:mi>i</mml:mi></mml:msubsup><mml:mi>Δ</mml:mi><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>. Finally, a random number <italic>r</italic> is generated and compared with <inline-formula id="pcbi.1005236.e024"><alternatives><graphic id="pcbi.1005236.e024g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e024" xlink:type="simple"/><mml:math display="inline" id="M24"><mml:mrow><mml:msubsup><mml:mi>P</mml:mi><mml:mn>1</mml:mn><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mi>Δ</mml:mi><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>. If <inline-formula id="pcbi.1005236.e025"><alternatives><graphic id="pcbi.1005236.e025g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e025" xlink:type="simple"/><mml:math display="inline" id="M25"><mml:mrow><mml:mi>r</mml:mi><mml:mo>&lt;</mml:mo><mml:msubsup><mml:mi>P</mml:mi><mml:mn>1</mml:mn><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mi>Δ</mml:mi><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>, the transition to the open state with <italic>ξ</italic><sub><italic>i</italic></sub>(<italic>t</italic> + <italic>Δt</italic>) = 1 is accepted, otherwise it is rejected. The similar logic applies to channels that are open at time <italic>t</italic>.</p>
<p>Note that bimolecular reactions, in which one of the participants is described by a <italic>U</italic>-type variable and the other is represented by a <italic>Ξ</italic>-variable, can be approximated in deterministic-stochastic models as unimolecular. Indeed, the copy numbers described by variables of <italic>U</italic>-type are assumed to be deterministically large even within <italic>ω</italic><sub><italic>j</italic></sub>, so the changes due to binding to, or unbinding from, discrete particles can be ignored. In other words, the molecules described in terms of concentrations could be treated as ‘catalysts’ in this type of interactions.</p>
<p>In summary, the algorithm includes the following steps:</p>
<p><italic>Initializing the system</italic>:</p>
<list list-type="roman-lower">
<list-item><p>Use initial conditions of the problem to initialize variables <bold>U</bold>(<bold>r</bold>,0) and <bold>Ξ</bold>(<bold>r</bold>,0). If the initial condition for <italic>Ξ</italic>-type variables are given by their probability distribution functions <italic>P</italic>(<bold>Ξ</bold>(<bold>r</bold>), 0), then sample <italic>P</italic>(<bold>Ξ</bold>(<bold>r</bold>), 0). The current version of the solver supports sampling of a uniform spatial distribution of particles.</p></list-item>
<list-item><p>Use <bold>U</bold>(<bold>r</bold>,0) to initialize the transition rate parameters for the <italic>Ξ</italic>-type variables.</p></list-item>
<list-item><p>Compute initial binned densities for <italic>Ξ</italic>-type variables.</p>
<p><italic>Advancing the system in time</italic>:</p></list-item>
<list-item><p>Determine <bold>U</bold>(<bold>r</bold>,<italic>t</italic> + <italic>Δt</italic>) by integrating the PDEs using <bold>U</bold>(<bold>r</bold>,<italic>t</italic>) and the spatial binning of the <italic>Ξ</italic>-type variables computed in steps (iii) and (vii) as initial conditions. In the current version of the algorithm, this is done by calling the VCell semi-implicit PDE solver.</p></list-item>
<list-item><p>Find <bold>Ξ</bold>(<bold>r</bold>,<italic>t</italic> + <italic>Δt</italic>), using <bold>Ξ</bold>(<bold>r</bold>,<italic>t</italic>) as initial conditions. Currently, Monte Carlo routines of Smoldyn are utilized to implement this step.</p></list-item>
<list-item><p>Use <bold>U</bold>(<bold>r</bold>,<italic>t</italic> + <italic>Δt</italic>) to update the transition rate parameters for <italic>Ξ</italic>-type variables;</p></list-item>
<list-item><p>Use <bold>Ξ</bold>(<bold>r</bold>,<italic>t</italic> + <italic>Δt</italic>) to update the binned densities for <italic>Ξ</italic>-type variables.</p></list-item>
</list>
</sec>
<sec id="sec004">
<title>Validation of the method</title>
<p>Accuracy of our spatial deterministic-stochastic solver is affected by truncation errors, arising from discretization of space and time, and statistical errors due to finite numbers of Monte Carlo realizations. The algorithm was validated against analytical results and through comparison with alternative methods. The calcium spark model introduced in the previous section was used as a testbed for the tests described below.</p>
<sec id="sec005">
<title>Convergence of solutions of a hybrid system with separable variables</title>
<p>If transition parameters for <italic>Ξ</italic>-variables, such as <inline-formula id="pcbi.1005236.e026"><alternatives><graphic id="pcbi.1005236.e026g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e026" xlink:type="simple"/><mml:math display="inline" id="M26"><mml:mrow><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mtext>on</mml:mtext></mml:mrow><mml:mi>i</mml:mi></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1005236.e027"><alternatives><graphic id="pcbi.1005236.e027g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e027" xlink:type="simple"/><mml:math display="inline" id="M27"><mml:mrow><mml:msubsup><mml:mi>k</mml:mi><mml:mrow><mml:mtext>off</mml:mtext></mml:mrow><mml:mi>i</mml:mi></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula> in Eq (<xref ref-type="disp-formula" rid="pcbi.1005236.e004">3</xref>), are independent of <italic>U</italic>-variables, the <bold>Ξ</bold>–subsystem is separable and can be solved independently. For this case, the probabilities of the channel states in the calcium spark model, <inline-formula id="pcbi.1005236.e028"><alternatives><graphic id="pcbi.1005236.e028g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e028" xlink:type="simple"/><mml:math display="inline" id="M28"><mml:mrow><mml:mo>{</mml:mo><mml:msubsup><mml:mi>P</mml:mi><mml:mn>0</mml:mn><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mi>P</mml:mi><mml:mn>1</mml:mn><mml:mi>i</mml:mi></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>}</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>, and the expectation values of the spatial average of <italic>U</italic>(<bold>r</bold>,<italic>t</italic>), <inline-formula id="pcbi.1005236.e029"><alternatives><graphic id="pcbi.1005236.e029g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e029" xlink:type="simple"/><mml:math display="inline" id="M29"><mml:mrow><mml:msub><mml:mrow><mml:mover accent="true"><mml:mi>U</mml:mi><mml:mo stretchy="true">¯</mml:mo></mml:mover></mml:mrow><mml:mrow><mml:mtext>exact</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi>E</mml:mi><mml:mo stretchy="false">[</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:msub><mml:mi>Ω</mml:mi><mml:mrow><mml:mtext>cell</mml:mtext></mml:mrow></mml:msub><mml:msup><mml:mo stretchy="false">|</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mstyle displaystyle="true"><mml:mrow><mml:msub><mml:mo>∫</mml:mo><mml:mrow><mml:msub><mml:mi>Ω</mml:mi><mml:mrow><mml:mtext>cell</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mrow><mml:mi>U</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">r</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>d</mml:mi><mml:mi mathvariant="bold">r</mml:mi><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:mrow></mml:math></alternatives></inline-formula>, can be determined analytically by integrating Eqs (<xref ref-type="disp-formula" rid="pcbi.1005236.e001">1</xref>–<xref ref-type="disp-formula" rid="pcbi.1005236.e004">3</xref>), see <xref ref-type="supplementary-material" rid="pcbi.1005236.s001">S1 Text</xref>. This allows us to compute solution errors and analyze convergence of hybrid solutions.</p>
<p>In this test, we used the hybrid method to solve Eqs (<xref ref-type="disp-formula" rid="pcbi.1005236.e001">1</xref>–<xref ref-type="disp-formula" rid="pcbi.1005236.e004">3</xref>) in a simple quasi-2D geometry <italic>Ω</italic><sub>cell</sub> = [0,10.1]×[0,2.1]×[0,0.5] μm<sup>3</sup> with the arrangement of channels shown in <xref ref-type="fig" rid="pcbi.1005236.g001">Fig 1A</xref> and the following parameter set: <italic>J</italic> = 10 μM·μm<sup>3</sup>/s, <italic>U</italic><sub>0</sub> = 0.1 μM, <italic>k</italic><sub>on</sub> = 1 s<sup>-1</sup>, <italic>k</italic><sub>off</sub> = 5 s<sup>-1</sup>, <italic>V</italic><sub>p</sub> = 1 s<sup>-1</sup>, <italic>D</italic> = 1 μm<sup>2</sup>/s, and <italic>N</italic><sub>ch</sub> = 24. Simulations, initialized at <italic>ξ</italic><sub><italic>i</italic></sub>(0) = 0 (for all <italic>i</italic> = 1,….<italic>N</italic><sub>ch</sub>) and <italic>U</italic>(<bold>r</bold>,0) = <italic>U</italic><sub>0</sub>, were run to <italic>T</italic> = 5 s, at which the system began approaching a steady state.</p>
<fig id="pcbi.1005236.g001" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005236.g001</object-id>
<label>Fig 1</label>
<caption>
<title>Test with a separable stochastic subsystem.</title>
<p>(A) Channel arrangement (upper panel) and a snapshot of simulation results for <italic>U</italic>(<bold>r</bold>,<italic>t</italic>) at <italic>t</italic> = 1 s (lower panel). (B) The multi-trial mean, <inline-formula id="pcbi.1005236.e030"><alternatives><graphic id="pcbi.1005236.e030g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e030" xlink:type="simple"/><mml:math display="inline" id="M30"><mml:mrow><mml:mo>&lt;</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:msub><mml:mi>Ω</mml:mi><mml:mrow><mml:mtext>cell</mml:mtext></mml:mrow></mml:msub><mml:msup><mml:mo stretchy="false">|</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mstyle displaystyle="false"><mml:mrow><mml:msub><mml:mo>∫</mml:mo><mml:mrow><mml:msub><mml:mi>Ω</mml:mi><mml:mrow><mml:mtext>cell</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mrow><mml:mi>U</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">r</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>d</mml:mi><mml:mi mathvariant="bold">r</mml:mi><mml:mo>&gt;</mml:mo></mml:mrow></mml:mrow></mml:mstyle></mml:mrow></mml:math></alternatives></inline-formula>, converges to an exact expectation value with the increasing number of trials and decreasing time step <italic>Δt</italic> (data points for <italic>Δt</italic> = 0.02 s, 0.006 s, and 0.002 s are shown as triangles, squares, and circles, respectively). Inset: convergence with respect to <italic>Δt</italic> (shown for <italic>N</italic> = 10<sup>4</sup>).</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005236.g001" xlink:type="simple"/>
</fig>
<p>The solution errors defined as <inline-formula id="pcbi.1005236.e031"><alternatives><graphic id="pcbi.1005236.e031g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e031" xlink:type="simple"/><mml:math display="inline" id="M31"><mml:mrow><mml:mi>ε</mml:mi><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mi mathvariant="normal">max</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn><mml:mo>≤</mml:mo><mml:mi>t</mml:mi><mml:mo>≤</mml:mo><mml:mi>T</mml:mi></mml:mrow></mml:munder><mml:mo stretchy="false">|</mml:mo><mml:msub><mml:mover accent="true"><mml:mi>U</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mrow><mml:mtext>exact</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mo>&lt;</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:msub><mml:mi>Ω</mml:mi><mml:mrow><mml:mtext>cell</mml:mtext></mml:mrow></mml:msub><mml:msup><mml:mo stretchy="false">|</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mstyle displaystyle="true"><mml:mrow><mml:msub><mml:mo>∫</mml:mo><mml:mrow><mml:msub><mml:mi>Ω</mml:mi><mml:mrow><mml:mtext>cell</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mrow><mml:mi>U</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">r</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>d</mml:mi><mml:mi mathvariant="bold">r</mml:mi><mml:mo stretchy="false">]</mml:mo></mml:mrow></mml:mrow></mml:mstyle><mml:msub><mml:mo>&gt;</mml:mo><mml:mi>N</mml:mi></mml:msub><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>, where the angular brackets &lt;…&gt;<sub><italic>N</italic></sub> denote averaging over <italic>N</italic> realizations, were computed for solutions <italic>U</italic>(<bold>r</bold>,<italic>t</italic>) obtained with varying mesh sizes, time steps <italic>Δt</italic> and <italic>N</italic>. <xref ref-type="fig" rid="pcbi.1005236.g001">Fig 1B</xref> demonstrates <italic>ε</italic> as a function of <italic>N</italic> and <italic>Δt</italic> (inset) for solutions computed with the spatial resolution <italic>Δx</italic> = <italic>Δy</italic> = 0.1 μm, <italic>Δz</italic> = 0.5 μm, such that the truncation error is mainly due to discretization of time. For <italic>Δt</italic> = 2 ms, the power fit yields an exponent close to <inline-formula id="pcbi.1005236.e032"><alternatives><graphic id="pcbi.1005236.e032g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e032" xlink:type="simple"/><mml:math display="inline" id="M32"><mml:mrow><mml:mo>−</mml:mo><mml:mstyle scriptlevel="+1"><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac></mml:mstyle></mml:mrow></mml:math></alternatives></inline-formula>, indicating that for small <italic>Δt</italic>, the solution error, as expected, is largely determined by its statistical component. Overall, the data indicate convergence of <inline-formula id="pcbi.1005236.e033"><alternatives><graphic id="pcbi.1005236.e033g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e033" xlink:type="simple"/><mml:math display="inline" id="M33"><mml:mrow><mml:mo>&lt;</mml:mo><mml:mover accent="true"><mml:mi>U</mml:mi><mml:mo stretchy="true">¯</mml:mo></mml:mover><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mo>&gt;</mml:mo><mml:mi>N</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> to <inline-formula id="pcbi.1005236.e034"><alternatives><graphic id="pcbi.1005236.e034g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e034" xlink:type="simple"/><mml:math display="inline" id="M34"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>U</mml:mi><mml:mo>¯</mml:mo></mml:mover><mml:mrow><mml:mtext>exact</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>, but the validation is limited to cases with separable stochastic subsystems.</p>
</sec>
<sec id="sec006">
<title>Fully coupled systems in the limit of fast diffusion: validation against different solvers</title>
<p>One way to validate a hybrid solver for conditions in which the variables are inseparable is to use a fully coupled calcium spark model in the limit of large <italic>D</italic>. Because the system is well-mixed in this limit, a reference solution can be obtained by solving the corresponding fully stochastic system using a non-spatial stochastic simulator.</p>
<p>In the tests, the full coupling was achieved by replacing <italic>k</italic><sub>on</sub> with <italic>k</italic><sub>on</sub><italic>U</italic>(<bold>r</bold>,<italic>t</italic>)/<italic>U</italic><sub>0</sub>, and the VCell hybrid solver was run with <italic>k</italic><sub>on</sub> = 0.1 s<sup>-1</sup>, <italic>D</italic> = 1000 μm<sup>2</sup>/s and <italic>Δt</italic> = 0.2 ms. All other parameters, as well as the initial conditions, geometry, and mesh, were the same as in the previous subsection. The reference solution was obtained by solving the corresponding well-mixed problem with a VCell nonspatial stochastic solver that implements a ‘next reaction’ algorithm proposed by Gibson and Bruck [<xref ref-type="bibr" rid="pcbi.1005236.ref007">7</xref>]. This algorithm is an adaptive event-driven method free of time-discretization error (see <italic><xref ref-type="sec" rid="sec001">Introduction</xref></italic>).</p>
<p>Time-dependent solutions obtained by the two solvers are illustrated in <xref ref-type="fig" rid="pcbi.1005236.g002">Fig 2</xref>. The results, shown for three time points, are based on 10,000 realizations. Because of the large <italic>D</italic>, the realizations of <italic>U</italic>(<bold>r</bold>,<italic>t</italic>) obtained by the VCell hybrid solver were nearly uniform in space for any of the presented times. Still, for comparison with the nonspatial solver, they were averaged over <italic>Ω</italic><sub>cell</sub>, and the symbol <italic>U</italic>, used in Figs <xref ref-type="fig" rid="pcbi.1005236.g002">2</xref> and <xref ref-type="fig" rid="pcbi.1005236.g003">3</xref> and below, denotes spatial averages (as well as calcium concentrations in the well-mixed problem). The marginal probability density function <italic>p</italic>(<italic>U</italic>,<italic>t</italic>), defined as <inline-formula id="pcbi.1005236.e035"><alternatives><graphic id="pcbi.1005236.e035g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e035" xlink:type="simple"/><mml:math display="inline" id="M35"><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>U</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mstyle displaystyle="false"><mml:msub><mml:mo>∑</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:msub><mml:mi>ξ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>}</mml:mo></mml:mrow></mml:msub><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>U</mml:mi><mml:mo>,</mml:mo><mml:mo>{</mml:mo><mml:msub><mml:mi>ξ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>}</mml:mo><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle></mml:mrow></mml:math></alternatives></inline-formula>, where <italic>p</italic>(<italic>U</italic>,{<italic>ξ</italic><sub><italic>i</italic></sub>},<italic>t</italic>) is the joint probability distribution, was approximated by computing a normalized 20-bin histogram over the range of <italic>U</italic> and dividing the frequencies by the lengths of the intervals. Insets of <xref ref-type="fig" rid="pcbi.1005236.g002">Fig 2</xref> illustrate the probabilities of the number of open channels, which are defined as <inline-formula id="pcbi.1005236.e036"><alternatives><graphic id="pcbi.1005236.e036g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e036" xlink:type="simple"/><mml:math display="inline" id="M36"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mstyle displaystyle="false"><mml:mrow><mml:msub><mml:mo>∫</mml:mo><mml:mi>U</mml:mi></mml:msub><mml:mrow><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>U</mml:mi><mml:mo>,</mml:mo><mml:mo>{</mml:mo><mml:msub><mml:mi>ξ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>}</mml:mo><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mo stretchy="false">|</mml:mo><mml:mrow><mml:mstyle displaystyle="false"><mml:msub><mml:mo>∑</mml:mo><mml:mi>i</mml:mi></mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>ξ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:mstyle></mml:mrow></mml:msub></mml:mrow></mml:mrow></mml:mstyle><mml:mi>d</mml:mi><mml:mi>U</mml:mi></mml:mrow></mml:math></alternatives></inline-formula>; they were determined by computing the corresponding histograms. <xref ref-type="fig" rid="pcbi.1005236.g002">Fig 2</xref> demonstrates that the time-dependent solution obtained by the VCell hybrid solver for a fully coupled system in the limit of fast diffusion is consistent with the results obtained by an adaptive nonspatial solver for the corresponding well-mixed model. The differences between the two solutions at <italic>t</italic> = 1 s, 2 s, 3 s computed in L<sup>2</sup>-norm for <italic>p</italic>(<italic>U</italic>,<italic>t</italic>) (first number) and <italic>P</italic>(<italic>n</italic>,<italic>t</italic>) (second number) are as follows: (0.0126, 0.0018), (0.0077, 0.0024), and (0.0043, 0.0026).</p>
<fig id="pcbi.1005236.g002" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005236.g002</object-id>
<label>Fig 2</label>
<caption>
<title>Time-dependent solutions of a fully coupled problem with large <italic>D</italic>.</title>
<p>Results from VCell hybrid (dots) are validated against a reference solution of the corresponding well-mixed system obtained by Gibson-Bruck nonspatial solver (solid line). Probability density functions of <italic>U</italic> and probability distributions of the numbers of open channels in insets (black columns for VCell hybrid, white columns for Gibson-Bruck) are based on 10,000 realizations by each solver and shown for three time points, <italic>t</italic> = 1 s, 2 s, 3 s.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005236.g002" xlink:type="simple"/>
</fig>
<fig id="pcbi.1005236.g003" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005236.g003</object-id>
<label>Fig 3</label>
<caption>
<title>Steady-state solution of a fully coupled system in the limit of large <italic>D</italic>.</title>
<p>As in <xref ref-type="fig" rid="pcbi.1005236.g002">Fig 2</xref>, the near steady-state solution of a fully coupled system was obtained by VCell hybrid for the fast-diffusion limit and validated against Gibson-Bruck stochastic nonspatial solver. Results from each solver are based on 20,000 realizations and shown for <italic>t</italic> = 30 s, the time long enough for the system to become sufficiently close to its steady state.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005236.g003" xlink:type="simple"/>
</fig>
<p>Similarly, <xref ref-type="fig" rid="pcbi.1005236.g003">Fig 3</xref> demonstrates good agreement between the steady state distributions obtained by the spatial hybrid solver for the case of fast diffusion and the corresponding solution of a well-mixed system by the Gibson-Bruck method; the corresponding differences in L<sup>2</sup>-norm are 0.0127 and 0.0017 for <italic>p</italic>(<italic>U</italic>,<italic>t</italic>) and <italic>P</italic>(<italic>n</italic>,<italic>t</italic>), respectively, or ≈1% of the corresponding maximum values. The results in <xref ref-type="fig" rid="pcbi.1005236.g003">Fig 3</xref> are shown for <italic>t</italic> = 30 s, which is sufficient for accurately approximating <italic>p</italic>(<italic>U</italic>,∞) and <italic>P</italic>(<italic>n</italic>,∞) by <italic>p</italic>(<italic>U</italic>,<italic>t</italic>) and <italic>P</italic>(<italic>n</italic>,<italic>t</italic>) (the solution becomes stationary at <italic>t</italic> ≈ 10 s).</p>
<p>Alternatively, reference solutions of coupled hybrid models in the limit <italic>D</italic> → ∞ can be obtained by solving directly the corresponding Fokker-Planck equations [<xref ref-type="bibr" rid="pcbi.1005236.ref005">5</xref>]. Unlike the stochastic approach of the hybrid method, direct solution of a Fokker-Planck equation does not involve Monte Carlo techniques and therefore is free of statistical error. While the direct approach is not practical for solving realistic spatial models because of the excessively large dimensionality of a discretized domain, it can be used for testing purposes, for appropriately downsized test problems. Consider for simplicity a system with a single channel placed at the origin. Averaging Eq (<xref ref-type="disp-formula" rid="pcbi.1005236.e001">1</xref>) over <italic>Ω</italic><sub>cell</sub> with the account of Eq (<xref ref-type="disp-formula" rid="pcbi.1005236.e002">2</xref>) then yields ∂<sub><italic>t</italic></sub><italic>U</italic> = <italic>Jξ</italic>/|<italic>Ω</italic><sub>cell</sub>| − <italic>V</italic><sub>p</sub>(<italic>U</italic> − <italic>U</italic><sub>0</sub>) with <inline-formula id="pcbi.1005236.e037"><alternatives><graphic id="pcbi.1005236.e037g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e037" xlink:type="simple"/><mml:math display="inline" id="M37"><mml:mrow><mml:mi>U</mml:mi><mml:mo>=</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:msub><mml:mi>Ω</mml:mi><mml:mrow><mml:mtext>cell</mml:mtext></mml:mrow></mml:msub><mml:msup><mml:mo stretchy="false">|</mml:mo><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mstyle displaystyle="false"><mml:mrow><mml:msub><mml:mo>∫</mml:mo><mml:mrow><mml:msub><mml:mi>Ω</mml:mi><mml:mrow><mml:mtext>cell</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mrow><mml:mi>U</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">r</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>d</mml:mi><mml:mi mathvariant="bold">r</mml:mi></mml:mrow></mml:mrow></mml:mstyle></mml:mrow></mml:math></alternatives></inline-formula>. The continuous and discrete variables are again coupled by replacing <italic>k</italic><sub>on</sub> with <italic>k</italic><sub>on</sub><italic>U</italic>/<italic>U</italic><sub>0</sub>. Upon nondimensionalization: <inline-formula id="pcbi.1005236.e038"><alternatives><graphic id="pcbi.1005236.e038g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e038" xlink:type="simple"/><mml:math display="inline" id="M38"><mml:mrow><mml:mi>ρ</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>U</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>U</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>U</mml:mi><mml:mn>0</mml:mn></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:math></alternatives></inline-formula>, <italic>τ</italic> = <italic>tV</italic><sub>p</sub>, <inline-formula id="pcbi.1005236.e039"><alternatives><graphic id="pcbi.1005236.e039g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e039" xlink:type="simple"/><mml:math display="inline" id="M39"><mml:mrow><mml:mi>α</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mrow><mml:mtext>off</mml:mtext></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>V</mml:mi><mml:mtext>p</mml:mtext></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:math></alternatives></inline-formula>, <inline-formula id="pcbi.1005236.e040"><alternatives><graphic id="pcbi.1005236.e040g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e040" xlink:type="simple"/><mml:math display="inline" id="M40"><mml:mrow><mml:mi>β</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mrow><mml:mtext>on</mml:mtext></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:msub><mml:mi>k</mml:mi><mml:mrow><mml:mtext>off</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:math></alternatives></inline-formula>, <inline-formula id="pcbi.1005236.e041"><alternatives><graphic id="pcbi.1005236.e041g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e041" xlink:type="simple"/><mml:math display="inline" id="M41"><mml:mrow><mml:mi>a</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mi>J</mml:mi><mml:mrow><mml:msub><mml:mi>U</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:msub><mml:mi>V</mml:mi><mml:mtext>p</mml:mtext></mml:msub><mml:mo stretchy="false">|</mml:mo><mml:msub><mml:mi>Ω</mml:mi><mml:mrow><mml:mtext>cell</mml:mtext></mml:mrow></mml:msub><mml:mo stretchy="false">|</mml:mo></mml:mrow></mml:mfrac></mml:mrow></mml:math></alternatives></inline-formula>, the equation for <italic>U</italic> reduces to <inline-formula id="pcbi.1005236.e042"><alternatives><graphic id="pcbi.1005236.e042g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e042" xlink:type="simple"/><mml:math display="inline" id="M42"><mml:mrow><mml:mfrac><mml:mrow><mml:mi>d</mml:mi><mml:mi>ρ</mml:mi></mml:mrow><mml:mrow><mml:mi>d</mml:mi><mml:mi>τ</mml:mi></mml:mrow></mml:mfrac><mml:mo>=</mml:mo><mml:mi>a</mml:mi><mml:mi>ξ</mml:mi><mml:mo>−</mml:mo><mml:mi>ρ</mml:mi></mml:mrow></mml:math></alternatives></inline-formula>, while <italic>αβ</italic>(<italic>ρ</italic> + 1) and <italic>α</italic> become the respective dimensionless versions of the ‘on-’ and ‘off-’ parameters for the transition probability rates in Eq (<xref ref-type="disp-formula" rid="pcbi.1005236.e004">3</xref>).</p>
<p>A corresponding joint probability density function <italic>p</italic>(<italic>ρ</italic>,<italic>ξ</italic>,<italic>τ</italic>), defined in this case in a one-dimensional domain {<italic>ρ</italic>,<italic>ξ</italic>} with a two-valued discrete variable <italic>ξ</italic>, has two components: <italic>p</italic><sub>0</sub>(<italic>ρ</italic>,<italic>τ</italic>) = <italic>p</italic>(<italic>ρ</italic>,<italic>ξ</italic> = 0,<italic>τ</italic>) and <italic>p</italic><sub>1</sub>(<italic>ρ</italic>,<italic>τ</italic>) = <italic>p</italic>(<italic>ρ</italic>,<italic>ξ</italic> = 1,<italic>τ</italic>). The governing Chapman-Kolmogorov equation then reduces to
<disp-formula id="pcbi.1005236.e043">
<alternatives>
<graphic id="pcbi.1005236.e043g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e043" xlink:type="simple"/>
<mml:math display="block" id="M43">
<mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:msub><mml:mo>∂</mml:mo><mml:mi>τ</mml:mi></mml:msub><mml:msub><mml:mi>p</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>ρ</mml:mi><mml:mo>,</mml:mo><mml:mi>τ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mo>∂</mml:mo><mml:mi>ρ</mml:mi></mml:msub><mml:mo stretchy="false">[</mml:mo><mml:mo>−</mml:mo><mml:mi>ρ</mml:mi><mml:msub><mml:mi>p</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>ρ</mml:mi><mml:mo>,</mml:mo><mml:mi>τ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">]</mml:mo><mml:mo>+</mml:mo><mml:mi>R</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msub><mml:mo>∂</mml:mo><mml:mi>τ</mml:mi></mml:msub><mml:msub><mml:mi>p</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>ρ</mml:mi><mml:mo>,</mml:mo><mml:mi>τ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mo>∂</mml:mo><mml:mi>ρ</mml:mi></mml:msub><mml:mo stretchy="false">[</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>a</mml:mi><mml:mo>−</mml:mo><mml:mi>ρ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>ρ</mml:mi><mml:mo>,</mml:mo><mml:mi>τ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">]</mml:mo><mml:mo>−</mml:mo><mml:mi>R</mml:mi></mml:mtd></mml:mtr></mml:mtable><mml:mo>,</mml:mo>
</mml:math>
</alternatives>
<label>(4)</label>
</disp-formula>
where <italic>R</italic> = <italic>α</italic>(<italic>p</italic><sub>1</sub>(<italic>ρ</italic>,<italic>τ</italic>) − <italic>β</italic>(<italic>ρ</italic> + 1)<italic>p</italic><sub>0</sub>(<italic>ρ</italic>,<italic>τ</italic>)). Eq (<xref ref-type="disp-formula" rid="pcbi.1005236.e043">4</xref>) are to be solved with the initial conditions <italic>p</italic><sub>0</sub>(<italic>ρ</italic>,0) = δ(<italic>ρ</italic>), <italic>p</italic><sub>1</sub>(<italic>ρ</italic>,0) = 0 and the boundary conditions ∂<sub><italic>ρ</italic></sub><italic>p</italic><sub>0</sub>|<sub><italic>ρ</italic> = 0</sub> = ∂<sub><italic>ρ</italic></sub><italic>p</italic><sub>1</sub>|<sub><italic>ρ</italic> = 0</sub> = 0. Thus, in the limit of fast diffusion, the Fokker-Planck formulation is equivalent to a set of hyperbolic equations (Eq (<xref ref-type="disp-formula" rid="pcbi.1005236.e043">4</xref>)).</p>
<p>In the test, the single-channel hybrid system was solved by the VCell hybrid solver in 3D geometry, <italic>Ω</italic><sub>cell</sub> = [−0.5,0.5]×[−0.5,0.5]×[−0.5,0.5], for <italic>α</italic> = <italic>β</italic> = 1, <italic>a</italic> = 24. The dimensionless diffusion constant, <italic>d</italic> = <italic>D</italic>/(<italic>V</italic><sub>p</sub><italic>l</italic><sup>2</sup>) with <italic>l</italic> = 1 μm, was set at 10<sup>4</sup>, and the simulations were run with the time step <italic>Δτ</italic> = 0.002 and the mesh sizes <italic>Δx</italic> = <italic>Δy</italic> = <italic>Δz</italic> = 0.1. The results for the probability density function <italic>p</italic>(<italic>ρ</italic>,<italic>τ</italic>) = <italic>p</italic><sub>0</sub>(<italic>ρ</italic>,<italic>τ</italic>) + <italic>p</italic><sub>1</sub>(<italic>ρ</italic>,<italic>τ</italic>) are shown in <xref ref-type="fig" rid="pcbi.1005236.g004">Fig 4</xref> for time <italic>τ</italic> = 30, sufficiently long to accurately approximate the steady-state distribution <italic>p</italic>(<italic>ρ</italic>,∞) with <italic>p</italic>(<italic>ρ</italic>,<italic>τ</italic>). The hybrid solution based on 10,000 realizations (dots) agrees well with the direct solution of Eq (<xref ref-type="disp-formula" rid="pcbi.1005236.e043">4</xref>) obtained by a VCell fully-implicit PDE solver [<xref ref-type="bibr" rid="pcbi.1005236.ref039">39</xref>] with the mesh size <italic>Δρ</italic> = 0.1 (solid curve).</p>
<fig id="pcbi.1005236.g004" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005236.g004</object-id>
<label>Fig 4</label>
<caption>
<title>Spatial hybrid vs. Fokker-Planck formulation in the limit of large <italic>D</italic>.</title>
<p>Probability density function of dimensionless continuous variable <italic>ρ</italic> is shown for <italic>t</italic> = 30 s, sufficient for accurate approximation of the system’s steady state. Results from VCell hybrid (dots) are based on 10,000 realizations, and Fokker-Planck equations (Eq (<xref ref-type="disp-formula" rid="pcbi.1005236.e043">4</xref>)) were solved by VCell fully implicit advection-diffusion solver with mesh size <italic>Δρ</italic>/<italic>ρ</italic><sub>max</sub> = 0.004 (solid curve). The L<sup>2</sup>-norm of the difference between the two solutions is 0.0137.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005236.g004" xlink:type="simple"/>
</fig>
</sec>
<sec id="sec007">
<title>Fully coupled systems with finite diffusion: validation against direct solutions of Fokker-Planck equations</title>
<p>The idea of testing the hybrid solver against a fully stochastic simulator, which worked in the limit of fast diffusion (see previous subsection), turned out to be not particularly practical for testing spatially heterogeneous solutions of hybrid models. As discussed in <italic>Introduction</italic>, treating such models by a fully stochastic spatial solver is computationally expensive, because the copy numbers of ‘deterministic’ species must be large not only in total but locally as well. Also, the probability rates originating from the ‘hybrid’ terms in stochastic subsystems depend on large local copy numbers describing ‘deterministic’ variables and therefore are fast, thus necessitating a small integration time step. As a result, obtaining an accurate solution that entails multiple runs of a fully stochastic solver becomes prohibitively slow.</p>
<p>It is still possible to achieve fairly large local copy numbers for single-channel calcium spark models with low-dimensional geometries. We used Smoldyn to obtain fully stochastic solutions of a quasi-1D coupled model for different total copy numbers of calcium ions and compared them to the corresponding solution obtained by the hybrid solver. As expected, the probability distributions obtained with larger total numbers of particles were closer to the hybrid solution, but suppressing the errors due to the finiteness of the copy numbers describing the ‘deterministic’ variable and due to the finiteness of the number of Monte Carlo trials proved to be challenging because of the constraints described above.</p>
<p>For more accurate comparison, we used direct numerical solution of the Fokker-Planck equation, which, as mentioned earlier, is free of statistical error. In the case of finite <italic>D</italic>, this approach has its own limitations due to an exponential increase of the domain size with the number of spatial degrees of freedom. We therefore again employed the quasi-1D single-channel test problem and solved it on coarse meshes. For finite <italic>D</italic>, the problem is formulated in terms of the probability density functionals, <italic>p</italic><sub>0</sub>(<italic>ρ</italic>(<italic>x</italic>),<italic>τ</italic>) and <italic>p</italic><sub>1</sub>(<italic>ρ</italic>(<italic>x</italic>),<italic>τ</italic>). Here and below <italic>x</italic> and <italic>d</italic> are the dimensionless spatial coordinate and diffusion coefficient. The corresponding generalization of Eq (<xref ref-type="disp-formula" rid="pcbi.1005236.e043">4</xref>) yields functional Fokker-Planck equations that include diffusion-related terms [<xref ref-type="bibr" rid="pcbi.1005236.ref005">5</xref>]:
<disp-formula id="pcbi.1005236.e044">
<alternatives>
<graphic id="pcbi.1005236.e044g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e044" xlink:type="simple"/>
<mml:math display="block" id="M44">
<mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:msub><mml:mo>∂</mml:mo><mml:mi>τ</mml:mi></mml:msub><mml:msub><mml:mi>p</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>ρ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mi>τ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi>R</mml:mi><mml:mo>−</mml:mo><mml:mstyle displaystyle="false"><mml:mrow><mml:mo>∫</mml:mo><mml:mrow><mml:mi>d</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:mrow></mml:mstyle><mml:mfrac><mml:mi>δ</mml:mi><mml:mrow><mml:mi>δ</mml:mi><mml:mi>ρ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mo stretchy="false">[</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>d</mml:mi><mml:mo>⋅</mml:mo><mml:mover accent="true"><mml:mi>L</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>ρ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mi>ρ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>ρ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mi>τ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">]</mml:mo></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msub><mml:mo>∂</mml:mo><mml:mi>τ</mml:mi></mml:msub><mml:msub><mml:mi>p</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>ρ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mi>τ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:mi>R</mml:mi><mml:mo>−</mml:mo><mml:mstyle displaystyle="false"><mml:mrow><mml:mo>∫</mml:mo><mml:mrow><mml:mi>d</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:mrow></mml:mstyle><mml:mfrac><mml:mi>δ</mml:mi><mml:mrow><mml:mi>δ</mml:mi><mml:mi>ρ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac><mml:mo stretchy="false">[</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>d</mml:mi><mml:mo>⋅</mml:mo><mml:mover accent="true"><mml:mi>L</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mi>ρ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>a</mml:mi><mml:mi mathvariant="normal">δ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mi>ρ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mi>p</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>ρ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mi>τ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">]</mml:mo></mml:mtd></mml:mtr></mml:mtable><mml:mo>.</mml:mo>
</mml:math>
</alternatives>
<label>(5)</label>
</disp-formula></p>
<p>In Eq (<xref ref-type="disp-formula" rid="pcbi.1005236.e044">5</xref>), <italic>x</italic> ∈ [0,<italic>x</italic><sub>max</sub>] and for every <italic>x</italic>, <italic>ρ</italic>(<italic>x</italic>) ∈ [0,<italic>ρ</italic><sub>max</sub>(<italic>x</italic>)], where <italic>ρ</italic><sub>max</sub>(<italic>x</italic>) define the ranges of possible values of <italic>ρ</italic>(<italic>x</italic>); <inline-formula id="pcbi.1005236.e045"><alternatives><graphic id="pcbi.1005236.e045g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e045" xlink:type="simple"/><mml:math display="inline" id="M45"><mml:mrow><mml:mfrac><mml:mi>δ</mml:mi><mml:mrow><mml:mi>δ</mml:mi><mml:mi>ρ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac></mml:mrow></mml:math></alternatives></inline-formula> is the operator of functional (variational) differentiation, <inline-formula id="pcbi.1005236.e046"><alternatives><graphic id="pcbi.1005236.e046g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e046" xlink:type="simple"/><mml:math display="inline" id="M46"><mml:mover accent="true"><mml:mi>L</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> is the diffusion operator, which in the continuous limit can be symbolically written as <inline-formula id="pcbi.1005236.e047"><alternatives><graphic id="pcbi.1005236.e047g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e047" xlink:type="simple"/><mml:math display="inline" id="M47"><mml:mrow><mml:mover accent="true"><mml:mi>L</mml:mi><mml:mo>^</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:msubsup><mml:mo>∂</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mi>x</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula>, and δ(<italic>x</italic>) is the Dirac delta-function. The term describing transitions between the states of the channel, which was placed at the origin as in the fast diffusion test, is <italic>R</italic> = <italic>α</italic>(<italic>p</italic><sub>1</sub> − <italic>β</italic>(<italic>ρ</italic>(0) + 1)<italic>p</italic><sub>0</sub>). Note that because the spatial coordinate <italic>x</italic> has the dimension of length, the units of the normalized diffusion constant, denoted as <italic>D</italic> in Eq (<xref ref-type="disp-formula" rid="pcbi.1005236.e044">5</xref>) and below, are those of length squared. The problem is solved with the initial conditions, <italic>p</italic><sub>0</sub>(<italic>ρ</italic>(<italic>x</italic>),0) = δ(<italic>ρ</italic>(<italic>x</italic>)), <italic>p</italic><sub>1</sub>(<italic>ρ</italic>(<italic>x</italic>),0) = 0 and with the zero-flux boundary conditions on all boundaries for <italic>ρ</italic> and <italic>x</italic>. Discretization of Eq (<xref ref-type="disp-formula" rid="pcbi.1005236.e044">5</xref>) and solution of the discretized equations are described in <xref ref-type="supplementary-material" rid="pcbi.1005236.s002">S2 Text</xref>.</p>
<p>The direct numerical solutions of Eq (<xref ref-type="disp-formula" rid="pcbi.1005236.e044">5</xref>) were compared with the hybrid solutions obtained for the same spatial grid. The hybrid formulation in this case includes the following equation,
<disp-formula id="pcbi.1005236.e048">
<alternatives>
<graphic id="pcbi.1005236.e048g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e048" xlink:type="simple"/>
<mml:math display="block" id="M48">
<mml:mrow><mml:msub><mml:mo>∂</mml:mo><mml:mi>τ</mml:mi></mml:msub><mml:mi>ρ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>τ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi>d</mml:mi><mml:mo>⋅</mml:mo><mml:msubsup><mml:mo>∂</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mi>x</mml:mi></mml:mrow><mml:mn>2</mml:mn></mml:msubsup><mml:mi>ρ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>τ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mi>a</mml:mi><mml:mi mathvariant="normal">δ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>ξ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>τ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:mi>ρ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>τ</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mrow>
</mml:math>
</alternatives>
</disp-formula>
where <italic>ξ</italic>(<italic>τ</italic>) is the Poisson stochastic process with the ‘on-’ and ‘off-’ rate constants <italic>αβ</italic>(<italic>ρ</italic>(0) + 1) and <italic>α</italic>, respectively. <xref ref-type="fig" rid="pcbi.1005236.g005">Fig 5</xref> illustrates comparison of the solution of the functional Fokker-Planck equation on the two-dimensional grid, <italic>i</italic><sub>max</sub> = 2 (<italic>x</italic><sub>max</sub> = 4, <italic>Δx</italic> = 2), and the corresponding solution by the VCell hybrid solver, which were obtained for <italic>α</italic> = 10, <italic>β</italic> = 1, <inline-formula id="pcbi.1005236.e049"><alternatives><graphic id="pcbi.1005236.e049g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e049" xlink:type="simple"/><mml:math display="inline" id="M49"><mml:mrow><mml:mi>a</mml:mi><mml:mo>=</mml:mo><mml:mstyle scriptlevel="+1"><mml:mfrac bevelled="true"><mml:mrow><mml:mn>20</mml:mn></mml:mrow><mml:mn>3</mml:mn></mml:mfrac></mml:mstyle></mml:mrow></mml:math></alternatives></inline-formula>, and <italic>d</italic> = 1. The results are shown for the probability density function <italic>p</italic>(<italic>ρ</italic>(<italic>x</italic><sub><italic>i</italic></sub>),<italic>τ</italic>) = <italic>p</italic><sub>0</sub>(<italic>ρ</italic>(<italic>x</italic><sub><italic>i</italic></sub>),<italic>τ</italic>) + <italic>p</italic><sub>1</sub>(<italic>ρ</italic>(<italic>x</italic><sub><italic>i</italic></sub>),<italic>τ</italic>) at <italic>τ</italic> = 1. Integration with the spatial hybrid solver was performed with the time step <italic>Δτ</italic> = 1e-4, and the results are based on 12,500 realizations. The values of <italic>p</italic>(<italic>ρ</italic>(<italic>x</italic><sub><italic>i</italic></sub>),<italic>τ</italic>) (dots in <xref ref-type="fig" rid="pcbi.1005236.g005">Fig 5</xref>) were computed by building 20-bin histograms in [0,<italic>ρ</italic><sub>max</sub>(<italic>i</italic>)] and dividing the frequencies by <italic>Δρ</italic>. The results obtained by the two very different methods are in overall good agreement. Note that the discrepancies of ≈5% near the maximum of <italic>p</italic>(<italic>ρ</italic>(<italic>x</italic><sub>1</sub>),<italic>τ</italic>) indicate that the interval [0,<italic>ρ</italic><sub>max</sub>(1)] is under-resolved, but <italic>Δρ</italic> could not be made significantly smaller due to memory constraints.</p>
<fig id="pcbi.1005236.g005" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005236.g005</object-id>
<label>Fig 5</label>
<caption>
<title>Validation of spatially inhomogeneous solutions (finite <italic>D</italic>), <italic>i</italic><sub>max</sub> = 2.</title>
<p>Solutions for probability density function <italic>p</italic>(<italic>ρ</italic>) are shown for <italic>τ</italic> = 1. Results from VCell hybrid (triangles for <italic>i</italic> = 0 and circles for <italic>i</italic> = 1) are based on 12,500 realizations. Solutions of the corresponding functional Fokker-Planck equation (solid curves) were obtained with <italic>Δρ</italic> = 1.25e-3. The L<sup>2</sup>-norms of the differences of the two solutions are ≈ 1.9% (<italic>i</italic> = 0) and 3.3% (<italic>i</italic> = 1) of the respective maximum values.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005236.g005" xlink:type="simple"/>
</fig>
<p>These limitations are more restrictive for three-dimensional grids, so the reference data for <italic>i</italic><sub>max</sub> = 3 were obtained by extrapolating to <italic>Δρ</italic> = 0 a series of solutions computed with different <italic>Δρ</italic>, an approach that has been applied in a different context in [<xref ref-type="bibr" rid="pcbi.1005236.ref052">52</xref>] (see <xref ref-type="supplementary-material" rid="pcbi.1005236.s002">S2 Text</xref> for details). <xref ref-type="fig" rid="pcbi.1005236.g006">Fig 6</xref> demonstrates comparison of the extrapolated curves with the solution obtained by the VCell hybrid solver with <italic>i</italic><sub>max</sub> = 3 (<italic>x</italic><sub>max</sub> = 6, <italic>Δx</italic> = 2) for <italic>α</italic> = 20, <italic>β</italic> = 0.5, <italic>a</italic> = 20, <italic>d</italic> = 50. The hybrid solution was based on 12,500 simulations obtained with <italic>Δτ</italic> = 2e-5. As in the previous test, the values of <italic>p</italic>(<italic>ρ</italic>(<italic>x</italic><sub><italic>i</italic></sub>),<italic>τ</italic>) were computed using the 20-bin histograms calculated for each [0,<italic>ρ</italic><sub>max</sub>(<italic>i</italic>)].</p>
<fig id="pcbi.1005236.g006" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005236.g006</object-id>
<label>Fig 6</label>
<caption>
<title>Validation of spatially inhomogeneous solutions (finite diffusion), <italic>i</italic><sub>max</sub> = 3.</title>
<p>Solutions for probability density function <italic>p</italic>(<italic>ρ</italic>) are shown for <italic>τ</italic> = 1. Results from VCell hybrid for positions near the channel (<italic>i</italic> = 0), squares), away from the channel (<italic>i</italic> = 2, circles) and in between (<italic>i</italic> = 1, triangles) are based on 12,500 realizations. The curves are extrapolations to <italic>Δρ</italic> = 0 of numerical solutions of the corresponding Fokker-Planck equation, computed with <italic>Δρ<sub>s</sub></italic> ∝ (1.5)<italic><sup>-s</sup></italic> 0, <italic>s</italic> = 0,1,…,5. The L<sup>2</sup>-norms of the differences of the two solutions are ≈ 1.3% (<italic>i</italic> = 0 and <italic>i</italic> = 1) and 1.5% (<italic>i</italic> = 2) of the respective maximum values.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005236.g006" xlink:type="simple"/>
</fig>
<p>The good agreement of the solutions obtained for the same spatial grids by the entirely different methods validates the hybrid solver for conditions of slow diffusion and full coupling of the stochastic and ‘deterministic’ components.</p>
</sec>
<sec id="sec008">
<title>Other capabilities and limitations of the method</title>
<p>The tests described in the previous subsections verify key elements of the spatial hybrid method exemplified by a simple model of calcium sparks of Section <italic>Mathematical problem and algorithm</italic>. Here we briefly discuss other functionality of the VCell hybrid solver not included in Eqs (<xref ref-type="disp-formula" rid="pcbi.1005236.e001">1</xref>–<xref ref-type="disp-formula" rid="pcbi.1005236.e004">3</xref>) and limitations of the current version of the method.</p>
<p>In the test examples, positions of the channels were fixed but in general, particles constituting a stochastic subsystem can diffuse and/or drift (see Section <italic>Application to a hybrid model of spontaneous cell polarization</italic>). Thus, vectors <bold>r</bold><sub><italic>i</italic></sub> describing their positions could be continuous functions of time governed by a stochastic process. Also not included in the tests is the binding of discrete particles to one another (the channels in the test problems undergo first-order (unimolecular) reactions). The hybrid solver supports these additional capabilities via Smoldyn [<xref ref-type="bibr" rid="pcbi.1005236.ref040">40</xref>], which approximates particles as points and implements their diffusion in space by sampling the exact diffusion propagator, which in and of itself does not incur additional numerical errors for any <italic>Δt</italic>. In a hybrid setting, however, diffusion of particles may amplify truncation errors due to discretization of time and space (see <italic>Convergence of solutions of a hybrid system with separable variables</italic>). Indeed, an interaction of a diffusing particle with ‘deterministic’ species can be equivalently described as the interaction between a fixed particle and the ‘deterministic’ species with increased diffusivities. Therefore, to maintain comparable accuracy of computations on a similar spatial grid, simulations of a hybrid model with diffusing particles should be run with appropriately decreased <italic>Δt</italic>.</p>
<p>The bimolecular reactions are simulated by Smoldyn as diffusion-limited, i.e. two particles positioned within a binding distance connect instantaneously. By default, the binding distance is set automatically on the basis of a given <italic>Δt</italic>, diffusion coefficients of the binding partners, and a desired macroscopic rate constant. Whereas with <italic>Δt</italic>→0, the method converges to solutions of reaction-diffusion systems with diffusion-limited reactions, the numerical error due to finite <italic>Δt</italic> results in radial pair distributions that would have been produced if the intrinsic binding occurred with a finite rate [<xref ref-type="bibr" rid="pcbi.1005236.ref040">40</xref>]. In our hybrid algorithm, these limitations of Smoldyn apply to bimolecular reactions within a stochastic subsystem.</p>
<p>We now consider limitations in treating bimolecular reactions where a continuously described molecule binds to a discrete particle. Because the hybrid approach assumes that the molecules of the ‘deterministic’ subsystem are expressed in large copy numbers, one can ignore sequestration of a continuous variable in such reactions, i.e. approximate a continuously described species as a catalyst (see discussion in section <italic>Mathematical problem and algorithm</italic>). In some applications, however, possible variations of concentrations as a result of such binding may need to be taken into account. For these problems, the hybrid method yields accurate results if diffusion is sufficiently fast, i.e. the binding is dominated by the intrinsic binding and the resulting depletion is small. Note that in the current implementation of our method, the treatment of the binding partners belonging to the different subsystems is slightly asynchronous, see steps (iv) and (v) of the algorithm described in section <italic>Mathematical problem and algorithm</italic>. This causes deviations from local mass conservation, which are usually small but may exacerbate and even cause numerical instability if <italic>Δt</italic> is insufficiently small.</p>
<p>To test our method in the opposite limit of diffusion-influenced reactions that may result in significant depletion of the continuous component in the immediate vicinity of a particle, we applied it to a model of stochastically gated reactions, for which accurate numerical results and analytical asymptotics have been obtained in [<xref ref-type="bibr" rid="pcbi.1005236.ref053">53</xref>]. In this model, macromolecule <italic>M</italic>, expressed in relatively low numbers, switches stochastically between inert and reactive configurations with the rate constants of activation and inactivation <italic>a</italic> and <italic>b</italic>. When in the reactive configuration, the macromolecule can bind ligand <italic>L</italic> to form complex <italic>C</italic> (see [<xref ref-type="bibr" rid="pcbi.1005236.ref053">53</xref>] and references therein). The binding is modeled as diffusion-influenced with the reaction rate described as
<disp-formula id="pcbi.1005236.e050">
<alternatives>
<graphic id="pcbi.1005236.e050g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e050" xlink:type="simple"/>
<mml:math display="block" id="M50">
<mml:mrow><mml:mn>4</mml:mn><mml:mi>π</mml:mi><mml:mi>D</mml:mi><mml:msubsup><mml:mi>r</mml:mi><mml:mi>c</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:msub><mml:mo>∂</mml:mo><mml:mi>r</mml:mi></mml:msub><mml:msub><mml:mi>ρ</mml:mi><mml:mrow><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:mtext>active</mml:mtext></mml:mrow></mml:msub><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mo stretchy="false">|</mml:mo><mml:mrow><mml:mi>r</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>r</mml:mi><mml:mi>c</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>κ</mml:mi><mml:mtext>f</mml:mtext></mml:msub><mml:msub><mml:mi>ρ</mml:mi><mml:mrow><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:mtext>active</mml:mtext></mml:mrow></mml:msub><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>r</mml:mi><mml:mi>c</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mi>κ</mml:mi><mml:mtext>r</mml:mtext></mml:msub><mml:mo stretchy="false">[</mml:mo><mml:mi>C</mml:mi><mml:mo stretchy="false">]</mml:mo></mml:mrow><mml:mo>,</mml:mo>
</mml:math>
</alternatives>
</disp-formula>
where <inline-formula id="pcbi.1005236.e051"><alternatives><graphic id="pcbi.1005236.e051g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e051" xlink:type="simple"/><mml:math display="inline" id="M51"><mml:mrow><mml:msub><mml:mi>ρ</mml:mi><mml:mrow><mml:msub><mml:mi>M</mml:mi><mml:mrow><mml:mtext>active</mml:mtext></mml:mrow></mml:msub><mml:mi>L</mml:mi></mml:mrow></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>r</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> is the pair distribution function of the ligand and reactive macromolecule; the macromolecule is modeled as a sphere with radius <italic>r</italic><sub><italic>c</italic></sub>; <italic>D</italic> is the sum of diffusion coefficients of <italic>M</italic> and <italic>L</italic>, and <italic>κ</italic><sub>f</sub>, <italic>κ</italic><sub>r</sub> are the forward (binding) and reverse (unbinding) rate constants, respectively. Of interest is the effect of slow diffusion on the relaxation function of reversible binding of the gated receptor, <inline-formula id="pcbi.1005236.e052"><alternatives><graphic id="pcbi.1005236.e052g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e052" xlink:type="simple"/><mml:math display="inline" id="M52"><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mrow><mml:mtext>eq</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mi>C</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>C</mml:mi><mml:mrow><mml:mtext>eq</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mi>C</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mn>0</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mfrac></mml:mrow></mml:math></alternatives></inline-formula>, where <italic>C</italic>(<italic>t</italic>) is the total number of complexes in the space <italic>Ω</italic> occupied by the system at time <italic>t</italic> and <italic>C</italic><sub>eq</sub> = <italic>C</italic>(∞). Specifically, it is predicted that the relaxation function has a power-law tail ∝ <italic>t</italic><sup>−3/2</sup> at <italic>t</italic> &gt;&gt; <italic>τ</italic><sub>D</sub>, where <inline-formula id="pcbi.1005236.e053"><alternatives><graphic id="pcbi.1005236.e053g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e053" xlink:type="simple"/><mml:math display="inline" id="M53"><mml:mrow><mml:msub><mml:mi>τ</mml:mi><mml:mtext>D</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:msubsup><mml:mi>r</mml:mi><mml:mtext>c</mml:mtext><mml:mn>2</mml:mn></mml:msubsup><mml:mo>/</mml:mo><mml:mi>D</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> [<xref ref-type="bibr" rid="pcbi.1005236.ref053">53</xref>].</p>
<p>In a hybrid version of the model, the ligands are assumed to be expressed in large copy numbers and are described deterministically by their concentration <italic>L</italic>(<bold>r</bold>,<italic>t</italic>), whereas the macromolecules are represented by discrete variables <inline-formula id="pcbi.1005236.e054"><alternatives><graphic id="pcbi.1005236.e054g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e054" xlink:type="simple"/><mml:math display="inline" id="M54"><mml:mrow><mml:msub><mml:mi>Μ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">r</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi mathvariant="normal">δ</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">r</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi mathvariant="bold">r</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:msubsup><mml:mi>μ</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mi>μ</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:msubsup><mml:mi>μ</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>3</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></alternatives></inline-formula> with <bold>r</bold>,<bold>r</bold><sub><italic>i</italic></sub> ∈ <italic>Ω</italic>, <italic>i</italic> = 1,…,<italic>N</italic>, and <italic>N</italic> is the total number of macromolecules in the system. Each of the stochastic components <inline-formula id="pcbi.1005236.e055"><alternatives><graphic id="pcbi.1005236.e055g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e055" xlink:type="simple"/><mml:math display="inline" id="M55"><mml:mrow><mml:msubsup><mml:mi>μ</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>α</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> that describe respectively the inert, active, and complex states, assumes values 0 or 1 in such a way that <inline-formula id="pcbi.1005236.e056"><alternatives><graphic id="pcbi.1005236.e056g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e056" xlink:type="simple"/><mml:math display="inline" id="M56"><mml:mrow><mml:mstyle displaystyle="true"><mml:msub><mml:mo>∑</mml:mo><mml:mi>α</mml:mi></mml:msub><mml:mrow><mml:msubsup><mml:mi>μ</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>α</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:mstyle><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>. We assume that the macromolecules are immobile in all forms and randomly distributed throughout <italic>Ω</italic>.</p>
<p>In the corresponding ‘Langevin-like’ formulation, <italic>L</italic>(<bold>r</bold>,<italic>t</italic>) is governed by the equation,
<disp-formula id="pcbi.1005236.e057">
<alternatives>
<graphic id="pcbi.1005236.e057g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e057" xlink:type="simple"/>
<mml:math display="block" id="M57">
<mml:mrow><mml:msub><mml:mo>∂</mml:mo><mml:mi>t</mml:mi></mml:msub><mml:mi>L</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">r</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi>D</mml:mi><mml:msup><mml:mo>∇</mml:mo><mml:mn>2</mml:mn></mml:msup><mml:mi>L</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">r</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mi>κ</mml:mi><mml:mtext>f</mml:mtext></mml:msub><mml:mi>L</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">r</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mstyle displaystyle="true"><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:msubsup><mml:mrow><mml:msub><mml:mi>Μ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">r</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle><mml:msub><mml:mo stretchy="false">|</mml:mo><mml:mrow><mml:msubsup><mml:mi>μ</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>2</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:msub><mml:mi>κ</mml:mi><mml:mtext>r</mml:mtext></mml:msub><mml:mstyle displaystyle="true"><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>N</mml:mi></mml:msubsup><mml:mrow><mml:msub><mml:mi>M</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">r</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mstyle><mml:msub><mml:mo stretchy="false">|</mml:mo><mml:mrow><mml:msubsup><mml:mi>μ</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>3</mml:mn><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>,</mml:mo>
</mml:math>
</alternatives>
<label>(6)</label>
</disp-formula>
which is subjected to a Dirichlet boundary condition, <italic>L</italic>(<bold>r</bold>,<italic>t</italic>)|<sub>∂<italic>Ω</italic></sub> = <italic>L</italic><sub>0</sub> = 1 μM ≈ 602 μm<sup>-3</sup>, and realizations of <inline-formula id="pcbi.1005236.e058"><alternatives><graphic id="pcbi.1005236.e058g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e058" xlink:type="simple"/><mml:math display="inline" id="M58"><mml:mrow><mml:msubsup><mml:mi>μ</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi>α</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> are governed by Poisson processes with the following transition probabilities,
<disp-formula id="pcbi.1005236.e059">
<alternatives>
<graphic id="pcbi.1005236.e059g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e059" xlink:type="simple"/>
<mml:math display="block" id="M59">
<mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>α</mml:mi><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mi>d</mml:mi><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:mi>α</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi>a</mml:mi><mml:mi>d</mml:mi><mml:mi>t</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>α</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mi>d</mml:mi><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:mi>α</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>a</mml:mi><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>α</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mi>d</mml:mi><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:mi>α</mml:mi><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mi>b</mml:mi><mml:mi>d</mml:mi><mml:mi>t</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>α</mml:mi><mml:mo>=</mml:mo><mml:mn>3</mml:mn><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mi>d</mml:mi><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:mi>α</mml:mi><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mi>κ</mml:mi><mml:mtext>f</mml:mtext></mml:msub><mml:mi>L</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">r</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>α</mml:mi><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mi>d</mml:mi><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:mi>α</mml:mi><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>b</mml:mi><mml:mi>d</mml:mi><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:msub><mml:mi>κ</mml:mi><mml:mtext>f</mml:mtext></mml:msub><mml:mi>L</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">r</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>α</mml:mi><mml:mo>=</mml:mo><mml:mn>2</mml:mn><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mi>d</mml:mi><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:mi>α</mml:mi><mml:mo>=</mml:mo><mml:mn>3</mml:mn><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mi>κ</mml:mi><mml:mtext>r</mml:mtext></mml:msub><mml:mi>d</mml:mi><mml:mi>t</mml:mi><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mi>p</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi>α</mml:mi><mml:mo>=</mml:mo><mml:mn>3</mml:mn><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mi>d</mml:mi><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">|</mml:mo><mml:mi>α</mml:mi><mml:mo>=</mml:mo><mml:mn>3</mml:mn><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi>κ</mml:mi><mml:mtext>r</mml:mtext></mml:msub><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:mtd></mml:mtr></mml:mtable><mml:mo>,</mml:mo>
</mml:math>
</alternatives>
<label>(7)</label>
</disp-formula>
where the states are specified by the index of a nonzero component. The system was solved by the hybrid solver in a 3D rectangular domain <italic>Ω</italic> = [0,10]<sup>3</sup> μm<sup>3</sup>, with the diffusion coefficient <italic>D</italic> = 1 μm<sup>2</sup>/s. Values of other parameters were correspond to Fig 2A in [<xref ref-type="bibr" rid="pcbi.1005236.ref053">53</xref>]: <italic>r</italic><sub><italic>c</italic></sub> = (0.3/(4π<italic>L</italic><sub>0</sub>))<sup>1/3</sup> ≈ 0.0341 μm; <inline-formula id="pcbi.1005236.e060"><alternatives><graphic id="pcbi.1005236.e060g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e060" xlink:type="simple"/><mml:math display="inline" id="M60"><mml:mrow><mml:mi>a</mml:mi><mml:mo>=</mml:mo><mml:mi>b</mml:mi><mml:mo>=</mml:mo><mml:msubsup><mml:mi>τ</mml:mi><mml:mtext>D</mml:mtext><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula> with <inline-formula id="pcbi.1005236.e061"><alternatives><graphic id="pcbi.1005236.e061g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e061" xlink:type="simple"/><mml:math display="inline" id="M61"><mml:mrow><mml:msub><mml:mi>τ</mml:mi><mml:mtext>D</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:msubsup><mml:mi>r</mml:mi><mml:mtext>c</mml:mtext><mml:mn>2</mml:mn></mml:msubsup><mml:mo>/</mml:mo><mml:mi>D</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> ≈ 1.163 × 10<sup>−3</sup> s; <italic>κ</italic><sub>f</sub> = 4<italic>πDr</italic><sub>c</sub> ≈ 0.429 μm<sup>3</sup> /s and <inline-formula id="pcbi.1005236.e062"><alternatives><graphic id="pcbi.1005236.e062g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e062" xlink:type="simple"/><mml:math display="inline" id="M62"><mml:mrow><mml:msub><mml:mi>κ</mml:mi><mml:mtext>r</mml:mtext></mml:msub><mml:mo>=</mml:mo><mml:msub><mml:mi>κ</mml:mi><mml:mtext>f</mml:mtext></mml:msub><mml:msub><mml:mi>L</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>=</mml:mo><mml:mn>0.3</mml:mn><mml:msubsup><mml:mi>τ</mml:mi><mml:mtext>D</mml:mtext><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula> ≈ 258 s<sup>-1</sup>. As in [<xref ref-type="bibr" rid="pcbi.1005236.ref053">53</xref>], the macromolecules were initially unbound and equally partitioned between the inert and reactive states; thus <italic>C</italic>(0) = 0, and the relaxation function reduces to 1 − <italic>C</italic>(<italic>t</italic>)/<italic>C</italic><sub>eq</sub>. The total number of macromolecules was <italic>N</italic> = 20000, equivalent to ≈ 3.322 × 10<sup>−2</sup> μM, and the initial ligand concentration was <italic>L</italic><sub>0</sub> = 1 μM.</p>
<p>The relaxation function, shown in <xref ref-type="fig" rid="pcbi.1005236.g007">Fig 7</xref> as dots with error bars representing the standard deviation, was obtained from a hybrid solution based on 4052 realizations. The simulations were run with time step <italic>Δt</italic> = 10<sup>−5</sup> s and mesh size <italic>h</italic> = 0.2 μm. In the simulations, the maximal depletion of ligands in the vicinity of particles was about 40%. The results of <xref ref-type="fig" rid="pcbi.1005236.g007">Fig 7</xref> are similar to those presented in Fig 2A of [<xref ref-type="bibr" rid="pcbi.1005236.ref053">53</xref>]. The relaxation function starts as an exponential, but later approaches the predicted power-law asymptotic, <inline-formula id="pcbi.1005236.e063"><alternatives><graphic id="pcbi.1005236.e063g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e063" xlink:type="simple"/><mml:math display="inline" id="M63"><mml:mrow><mml:mfrac><mml:mrow><mml:msub><mml:mi>κ</mml:mi><mml:mtext>f</mml:mtext></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mi>a</mml:mi><mml:mo>/</mml:mo><mml:mi>b</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>4</mml:mn><mml:mi>π</mml:mi><mml:mi>D</mml:mi><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>3</mml:mn><mml:mo>/</mml:mo><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:msub><mml:mi>κ</mml:mi><mml:mtext>r</mml:mtext></mml:msub><mml:msup><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mn>1</mml:mn><mml:mo>+</mml:mo><mml:mi>a</mml:mi><mml:mo>/</mml:mo><mml:mi>b</mml:mi><mml:mo>+</mml:mo><mml:msub><mml:mi>L</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:msub><mml:mi>κ</mml:mi><mml:mtext>f</mml:mtext></mml:msub><mml:mo>/</mml:mo><mml:msub><mml:mi>κ</mml:mi><mml:mtext>r</mml:mtext></mml:msub><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mfrac></mml:mrow></mml:math></alternatives></inline-formula> (dashed curve in <xref ref-type="fig" rid="pcbi.1005236.g007">Fig 7</xref>). However, the solution significantly overestimates the steepness of the initial exponential decrease (solid curve in the inset of <xref ref-type="fig" rid="pcbi.1005236.g007">Fig 7</xref>), and the value of <italic>C</italic><sub>eq</sub> which was approximated as <inline-formula id="pcbi.1005236.e064"><alternatives><graphic id="pcbi.1005236.e064g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e064" xlink:type="simple"/><mml:math display="inline" id="M64"><mml:mrow><mml:mi>C</mml:mi><mml:msub><mml:mo stretchy="false">|</mml:mo><mml:mrow><mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mn>110</mml:mn><mml:mo>⋅</mml:mo><mml:msub><mml:mi>τ</mml:mi><mml:mtext>D</mml:mtext></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>. These readouts depend on accurate description of gradients of <italic>L</italic>(<bold>r</bold>,<italic>t</italic>) in the vicinity of the particles. Solving the model on a finer mesh with <italic>h</italic> = 0.034μm indeed improved the solution (dashed curve in the inset of <xref ref-type="fig" rid="pcbi.1005236.g007">Fig 7</xref>). In this case, we solved the problem in <italic>Ω</italic> = [0,1.7]<sup>3</sup> μm<sup>3</sup> with the same particle density, initial ligand concentration, and kinetic constants, and observed the maximal local depletion of ligands of about 75%. Still, the new solution differs noticeably from the result of [<xref ref-type="bibr" rid="pcbi.1005236.ref053">53</xref>], and decreasing <italic>h</italic> further is not necessarily helpful, since the mesh size is already close to <italic>r</italic><sub><italic>c</italic></sub>. We therefore conclude that in this application, the accuracy of our hybrid method is largely limited by the fact that particles are approximated as points. Note also that the handling of strong depletion of continuous variables in the vicinity of discrete particles might be improved by employing multiscale approaches proposed for cases with spatial separation of subsystems with disparate levels of stochasticity [<xref ref-type="bibr" rid="pcbi.1005236.ref043">43</xref>–<xref ref-type="bibr" rid="pcbi.1005236.ref046">46</xref>]. Overall, the test shows that even at the limits of applicability, the method produces qualitatively, and in some respects quantitatively, reasonable results.</p>
<fig id="pcbi.1005236.g007" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005236.g007</object-id>
<label>Fig 7</label>
<caption>
<title>Hybrid solution of a system of stochastically-gated reactions, Eqs (<xref ref-type="disp-formula" rid="pcbi.1005236.e057">6</xref> and <xref ref-type="disp-formula" rid="pcbi.1005236.e059">7</xref>).</title>
<p>For <italic>t</italic> &gt;&gt; τ<sub>D,</sub> the probability that a macro-molecule remains unbound (dots with error bars) deviates from an exponential and approaches the power-law predicted in [<xref ref-type="bibr" rid="pcbi.1005236.ref053">53</xref>] (dashed curve). Inset: initial exponential decay of the relaxation function obtained with <italic>h</italic> = 0.2 μm (solid curve) and <italic>h</italic> = 0.034 μm (dashed curve).</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005236.g007" xlink:type="simple"/>
</fig>
<p>The VCell spatial hybrid solver also applies to models where continuous and discrete variables are defined both in the volume and in surrounding membranes. Subroutines supporting surface-bound stochastic sources were validated using a version of the model of calcium sparks, in which channels were placed on the cell membrane. For this case, the terms with stochastic variables move from the PDE to its boundary conditions. Diffusion on surfaces was rigorously validated separately in VCell [<xref ref-type="bibr" rid="pcbi.1005236.ref049">49</xref>] and Smoldyn.</p>
</sec>
</sec>
<sec id="sec009">
<title>Application to a hybrid model of spontaneous cell polarization</title>
<p>In this section, we formulate a deterministic-stochastic model of spontaneous emergence of cell polarity and simulate it with our method. The model is a hybrid version of a fully stochastic mechanism originally proposed by Altschuler et al. [<xref ref-type="bibr" rid="pcbi.1005236.ref054">54</xref>].</p>
<p>Division, differentiation, and proliferation of living cells rely on mechanisms of symmetry breaking. A key element of these mechanisms is emergence of asymmetric (polar) distributions of signaling molecules, often in form of molecular clusters. While clustering may be spurred by external cues, many cell types can polarize spontaneously (see [<xref ref-type="bibr" rid="pcbi.1005236.ref054">54</xref>, <xref ref-type="bibr" rid="pcbi.1005236.ref055">55</xref>] and references therein). Positive feedback in cell signaling is thought to play a crucial role in establishing cell polarity. The model by Altschuler et al. demonstrates that the positive feedback combined with stochasticity is sufficient for the emergence of a unipolar distribution of membrane-bound molecules. In the model, molecules from a cytoplasmic pool randomly associate with, and dissociate from, the membrane. While in the membrane, they diffuse but also recruit more molecules from the pool. The positive feedback reinforces the clustering. Remarkably, stochasticity of the system is critical for self-polarization: the effect disappears if the copy number of molecules in the membrane exceeds a certain threshold, so that there are no asymmetric solutions in the deterministic limit.</p>
<p>However, it is not uncommon for the membrane molecular clusters to involve large numbers of molecules. One such example is focal adhesions whose formation is initiated by membrane proteins called integrins. Activated by their binding to extracellular matrix, the integrins recruit many other molecules from the cytosol, which together form a focal adhesion. In our deterministic-stochastic model, the membrane receptor proteins that initiate clustering are distinguished from the cytosolic proteins recruited to the membrane. We assume that numbers of receptor proteins are sufficiently small to be represented by discrete variables, whereas copy numbers of cytosolic proteins, both recruited to the membrane and remaining in the cytoplasm, can be modeled continuously in terms of surface densities and volumetric concentrations. We then solve this hybrid model numerically using our method to determine if it retains the property of spontaneous polarization.</p>
<p>The corresponding ‘Langevin-like’ formulation of the problem is as follows. Consider a cell <italic>Ω</italic> with the plasma membrane ∂<italic>Ω</italic>. Let <italic>U</italic>(<bold>r</bold>,<italic>t</italic>) (<bold>r</bold> ∈ <italic>Ω</italic>) be the volume density of the proteins in the cytoplasm and <italic>S</italic>(<bold>r</bold>,<italic>t</italic>) (<bold>r</bold> ∈ ∂<italic>Ω</italic>) be the surface density of the proteins recruited to the membrane. To describe receptor proteins residing in the membrane, we introduce discrete variables <italic>Γ</italic><sub><italic>i</italic></sub>(<bold>r</bold>,<italic>t</italic>) = δ(<bold>r</bold> − <bold>r</bold><sub><italic>i</italic></sub>(<italic>t</italic>))<italic>γ</italic><sub><italic>i</italic></sub>(<italic>t</italic>) with <bold>r</bold> ∈ ∂<italic>Ω</italic> and <italic>i</italic> = 1,…, <italic>N</italic><sub><italic>r</italic></sub>, where <italic>N</italic><sub><italic>r</italic></sub> is the total number of receptors in the membrane. The discrete random variables <italic>γ</italic><sub><italic>i</italic></sub>(<italic>t</italic>) accept two values: 0 (inactive receptor) and 1 (active receptor), whereas <bold>r</bold><sub><italic>i</italic></sub>(<italic>t</italic>) are continuous random variables in ∂<italic>Ω</italic> (see discussion in subsection <italic>capabilities and limitations of the method</italic>).</p>
<p>Variables <italic>U</italic>(<bold>r</bold>,<italic>t</italic>) and <italic>S</italic>(<bold>r</bold>,<italic>t</italic>) form the ‘deterministic’ subsystem of the model and are governed by the following equations:
<disp-formula id="pcbi.1005236.e065">
<alternatives>
<graphic id="pcbi.1005236.e065g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e065" xlink:type="simple"/>
<mml:math display="block" id="M65">
<mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:msub><mml:mo>∂</mml:mo><mml:mi>t</mml:mi></mml:msub><mml:mi>U</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>D</mml:mi><mml:mi>U</mml:mi></mml:msub><mml:mi>Δ</mml:mi><mml:mi>U</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msub><mml:mo>∂</mml:mo><mml:mi>t</mml:mi></mml:msub><mml:mi>S</mml:mi><mml:mo>=</mml:mo><mml:msub><mml:mi>D</mml:mi><mml:mi>S</mml:mi></mml:msub><mml:msub><mml:mi>Δ</mml:mi><mml:mi>s</mml:mi></mml:msub><mml:mi>S</mml:mi><mml:mo>+</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mi>U</mml:mi><mml:mstyle displaystyle="false"><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>r</mml:mi></mml:msub></mml:mrow></mml:msubsup><mml:mrow><mml:msub><mml:mi>Γ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mstyle><mml:mo>−</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mi>S</mml:mi></mml:mtd></mml:mtr></mml:mtable><mml:mo>,</mml:mo>
</mml:math>
</alternatives>
<label>(8)</label>
</disp-formula>
where <italic>Δ</italic> is the Laplacian in <italic>Ω</italic>, whereas <italic>Δ</italic><sub><italic>s</italic></sub> is the Laplace-Beltrami operator describing diffusion in ∂<italic>Ω</italic> (see, e.g., [<xref ref-type="bibr" rid="pcbi.1005236.ref049">49</xref>]); <italic>D</italic><sub><italic>U</italic></sub> and <italic>D</italic><sub><italic>S</italic></sub> are the corresponding diffusion constants. The two other terms in the equation for <italic>S</italic> are the rates with which the cytosolic proteins are recruited to, and dissociated from, the membrane; <italic>k</italic><sub>1</sub>, <italic>k</italic><sub>2</sub> are the corresponding on- and off- rate constants. The boundary condition for the equation describing <italic>U</italic> reflects the local mass conservation,
<disp-formula id="pcbi.1005236.e066">
<alternatives>
<graphic id="pcbi.1005236.e066g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e066" xlink:type="simple"/>
<mml:math display="block" id="M66">
<mml:mrow><mml:mo>−</mml:mo><mml:msub><mml:mi>D</mml:mi><mml:mi>U</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">n</mml:mi><mml:mo>∇</mml:mo><mml:mi>U</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mo stretchy="false">|</mml:mo><mml:mrow><mml:mo>∂</mml:mo><mml:msub><mml:mi>Ω</mml:mi><mml:mrow><mml:mtext>cell</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mn>1</mml:mn></mml:msub><mml:mi>U</mml:mi><mml:mstyle displaystyle="false"><mml:msubsup><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:msub><mml:mi>N</mml:mi><mml:mi>r</mml:mi></mml:msub></mml:mrow></mml:msubsup><mml:mrow><mml:msub><mml:mi>Γ</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mstyle><mml:mo>+</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mn>2</mml:mn></mml:msub><mml:mi>S</mml:mi></mml:mrow><mml:mo>,</mml:mo>
</mml:math>
</alternatives>
<label>(9)</label>
</disp-formula>
where <bold>n</bold> is the outward normal.</p>
<p>Realizations of <italic>γ</italic><sub><italic>i</italic></sub>(<italic>t</italic>) are governed by Poisson processes with the following transition probabilities:
<disp-formula id="pcbi.1005236.e067">
<alternatives>
<graphic id="pcbi.1005236.e067g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e067" xlink:type="simple"/>
<mml:math display="block" id="M67">
<mml:mtable columnalign="left"><mml:mtr><mml:mtd><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>Γ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">r</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mi>d</mml:mi><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>γ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">|</mml:mo><mml:msub><mml:mi>Γ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">r</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>γ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mi>S</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">r</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>Γ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">r</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mi>d</mml:mi><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>γ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">|</mml:mo><mml:msub><mml:mi>Γ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">r</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>γ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>Γ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">r</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mi>d</mml:mi><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>γ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">|</mml:mo><mml:msub><mml:mi>Γ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">r</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>γ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mn>4</mml:mn></mml:msub><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>Γ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">r</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mi>d</mml:mi><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>γ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">|</mml:mo><mml:msub><mml:mi>Γ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">r</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>γ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mi>S</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">r</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:mtd></mml:mtr></mml:mtable><mml:mo>,</mml:mo>
</mml:math>
</alternatives>
<label>(10)</label>
</disp-formula>
where <italic>k</italic><sub>3</sub>, <italic>k</italic><sub>4</sub> are the on- and off- rate constants for receptor activation. Stochastic variables <bold>r</bold><sub><italic>i</italic></sub>(<italic>t</italic>) are modeled on an assumption that inactive receptors diffuse in the membrane, while active receptors are immobile. Accordingly,
<disp-formula id="pcbi.1005236.e068">
<alternatives>
<graphic id="pcbi.1005236.e068g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e068" xlink:type="simple"/>
<mml:math display="block" id="M68">
<mml:mrow><mml:msub><mml:mi mathvariant="bold">r</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mi>d</mml:mi><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi mathvariant="bold">r</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>+</mml:mo><mml:mi>d</mml:mi><mml:mi mathvariant="bold">r</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi mathvariant="bold">r</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mi>d</mml:mi><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mspace width="3.35em"/><mml:mi mathvariant="normal">if</mml:mi><mml:mspace width="0.25em"/><mml:msub><mml:mi>γ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi mathvariant="bold">r</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mspace width="10em"/><mml:mi mathvariant="normal">if</mml:mi><mml:mspace width="0.25em"/><mml:msub><mml:mi>γ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mrow></mml:mrow><mml:mo>,</mml:mo>
</mml:math>
</alternatives>
<label>(11)</label>
</disp-formula>
where <italic>d</italic><bold>r</bold>(<bold>r</bold><sub><italic>i</italic></sub>(<italic>t</italic>), <italic>dt</italic>) is a realization of a Wiener-type stochastic process described by Green’s function for the diffusion operator ∂<sub><italic>t</italic></sub> − <italic>D</italic><sub><italic>Γ</italic></sub><italic>Δ</italic><sub><italic>s</italic></sub> on ∂<italic>Ω</italic>; the function is centered at <bold>r</bold><sub><italic>i</italic></sub>(<italic>t</italic>). The initial positions of the receptors <bold>r</bold><sub><italic>i</italic></sub>(0) are uniformly distributed in ∂<italic>Ω</italic>. Other initial conditions are discussed below.</p>
<p>The model includes a positive feedback between <italic>Γ</italic><sub><italic>i</italic></sub>(<bold>r</bold>,<italic>t</italic>) and <italic>S</italic>(<bold>r</bold>,<italic>t</italic>), given that the rate of recruitment of cytosolic proteins to the membrane depends on <italic>Γ</italic><sub><italic>i</italic></sub>(<bold>r</bold>,<italic>t</italic>), while the receptor activation rate depends on <italic>S</italic>(<bold>r</bold>,<italic>t</italic>). It is easy to see that the system described by Eqs (<xref ref-type="disp-formula" rid="pcbi.1005236.e065">8</xref>–<xref ref-type="disp-formula" rid="pcbi.1005236.e068">11</xref>) has an inactive steady state: <italic>γ</italic><sub><italic>i</italic></sub>(<italic>t</italic>) = 0 for all <italic>i</italic>, <italic>S</italic>(<bold>r</bold>,<italic>t</italic>) = 0, and <italic>U</italic>(<bold>r</bold>,<italic>t</italic>) = <italic>U</italic><sub>0</sub> (<italic>U</italic><sub>0</sub> is the initial uniform concentration of the cytosolic protein). For some parameter sets, however, the inactive steady state can become unstable or the model may exhibit multi-stability. These possibilities can be explored by solving the model with varying initial conditions. Alternatively, one can transiently perturb the inactive steady state used as an initial condition. The latter approach was implemented in the example below by adding a pre-activation pulse to the intrinsic activation rate <inline-formula id="pcbi.1005236.e069"><alternatives><graphic id="pcbi.1005236.e069g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e069" xlink:type="simple"/><mml:math display="inline" id="M69"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>Γ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">r</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mi>d</mml:mi><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>γ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">|</mml:mo><mml:msub><mml:mi>Γ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">r</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>γ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mi>t</mml:mi><mml:mo>/</mml:mo><mml:mi>τ</mml:mi></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mi>S</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">r</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> and, correspondingly, <inline-formula id="pcbi.1005236.e070"><alternatives><graphic id="pcbi.1005236.e070g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005236.e070" xlink:type="simple"/><mml:math display="inline" id="M70"><mml:mrow><mml:mi>P</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>Γ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">r</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo>+</mml:mo><mml:mi>d</mml:mi><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>γ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">|</mml:mo><mml:msub><mml:mi>Γ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">r</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mrow><mml:msub><mml:mi>γ</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>=</mml:mo><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo stretchy="false">)</mml:mo><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:msup><mml:mi>e</mml:mi><mml:mrow><mml:mo>−</mml:mo><mml:mi>t</mml:mi><mml:mo>/</mml:mo><mml:mi>τ</mml:mi></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:msub><mml:mi>k</mml:mi><mml:mn>3</mml:mn></mml:msub><mml:mi>S</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mi mathvariant="bold">r</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo stretchy="false">)</mml:mo><mml:mi>d</mml:mi><mml:mi>t</mml:mi></mml:mrow></mml:math></alternatives></inline-formula>; <italic>k</italic><sub>0</sub> and <italic>τ</italic> are the rate and time constants of the pulse.</p>
<p>The model has been solved by the spatial hybrid method in a spherical cell with radius <italic>R</italic> = 4 μm for the following model parameters: <italic>U</italic><sub>0</sub> = 1 μM, <italic>N</italic><sub><italic>r</italic></sub> = 1000, <italic>D</italic><sub><italic>U</italic></sub> = 10 μm<sup>2</sup>/s, <italic>D</italic><sub><italic>S</italic></sub> = <italic>D</italic><sub><italic>Γ</italic></sub> = 0.1 μm<sup>2</sup>/s, <italic>k</italic><sub>1</sub> = 0.01 μM<sup>-1</sup>s<sup>-1</sup>, <italic>k</italic><sub>2</sub> = 0.01 s<sup>-1</sup>, <italic>k</italic><sub>3</sub> = 0.01 μm<sup>-2</sup>s<sup>-1</sup>, <italic>k</italic><sub>4</sub> = 0.1 s<sup>-1</sup>. For this parameter set, the inactive state is unstable: activation of a single receptor drives the system to its active state with an average of about 800 active receptors. Interestingly, spatial averages of all variables have reached their active steady-state regimes relatively quickly (by <italic>t</italic> = 10 s, for the robust pre-activation characterized by <italic>k</italic><sub>0</sub> = 10 s<sup>-1</sup> and <italic>τ</italic> = 1 s, and by <italic>t</italic> ≈ 350 s, when just ten receptors were initially activated), whereas the cluster structure evolves on a much longer time scale, see results in <xref ref-type="fig" rid="pcbi.1005236.g008">Fig 8</xref> obtained for <italic>k</italic><sub>0</sub> = 10 s<sup>-1</sup> and <italic>τ</italic> = 1 s.</p>
<fig id="pcbi.1005236.g008" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005236.g008</object-id>
<label>Fig 8</label>
<caption>
<title>Cell polarization: coalescence of a multi-cluster system into a single cluster.</title>
<p>Distributions of proteins recruited to the membrane from the interior (top) and active receptors (bottom), obtained by solving the model of Eqs (<xref ref-type="disp-formula" rid="pcbi.1005236.e065">8</xref>–<xref ref-type="disp-formula" rid="pcbi.1005236.e068">11</xref>) with VCell spatial hybrid for parameters specified in the text. Local surface densities increase in large clusters, as the number of clusters diminishes (see color scales).</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005236.g008" xlink:type="simple"/>
</fig>
<p>As in the original stochastic model [<xref ref-type="bibr" rid="pcbi.1005236.ref054">54</xref>], the hybrid mechanism yields a spatially heterogeneous steady state with a single cluster of activated receptors and recruited proteins. But unlike the original model, the total number of proteins in clusters can be large, because the condition of small copy numbers applies in the hybrid model only to the receptors initiating the clustering. Note the increase of local densities in the surviving clusters (see color scales in <xref ref-type="fig" rid="pcbi.1005236.g008">Fig 8</xref>), which is consistent with the early stabilization of spatial averages. While the ‘attractive’ spatial correlations of active receptors originate from the positive feedback, a corresponding deterministic formulation does not yield a spatially heterogeneous steady state (as was the case with the original model [<xref ref-type="bibr" rid="pcbi.1005236.ref054">54</xref>]), indicating that the discreteness and stochasticity of the receptors also play an essential role in establishing the polar distributions of membrane-bound molecules. Interestingly, the kinetics of cell polarization predicted by the model is reminiscent of glassy behavior, in which a system approaches a stable steady state by going through a long sequence of metastable states [<xref ref-type="bibr" rid="pcbi.1005236.ref056">56</xref>].</p>
</sec>
</sec>
<sec id="sec010" sec-type="materials|methods">
<title>Methods</title>
<p>The deterministic-stochastic algorithm described in this article integrates a spatial particle-based fixed time step Monte Carlo method (Smoldyn) and a conventional PDE solver with compatible time-stepping (one of the VCell solvers). The PDE solver utilizes finite-volume spatial discretization of PDEs [<xref ref-type="bibr" rid="pcbi.1005236.ref048">48</xref>, <xref ref-type="bibr" rid="pcbi.1005236.ref049">49</xref>], which ensures local mass conservation, and a semi-implicit time discretization scheme, in which the diffusion/ advection operator applies to variables at time <italic>t</italic> + <italic>Δt</italic> while the reaction and membrane flux terms are evaluated at time <italic>t</italic> [<xref ref-type="bibr" rid="pcbi.1005236.ref050">50</xref>, <xref ref-type="bibr" rid="pcbi.1005236.ref051">51</xref>]. To ensure consistency in handling geometry by the two methods, triangulation of surfaces is performed by applying Taubin smoothing [<xref ref-type="bibr" rid="pcbi.1005236.ref057">57</xref>] to watertight pixilated surfaces emerging from segmentation of space. The approach is applicable both to geometries defined analytically and to irregular realistic geometries based on experimental images.</p>
<p>Implementation in VCell Math workspace of the hybrid model of spontaneous cell polarization described in Section <italic>Application to a hybrid model of spontaneous cell polarization</italic> is detailed in <xref ref-type="supplementary-material" rid="pcbi.1005236.s003">S3 Text</xref>. The corresponding VCell MathModel, ‘Hybrid_cell_polarity_public’, along with simulation results, can be found by logging to VCell, <ext-link ext-link-type="uri" xlink:href="http://vcell.org/" xlink:type="simple">http://vcell.org</ext-link>, and searching the database of public MathModels under username ‘boris’.</p>
</sec>
<sec id="sec011" sec-type="conclusions">
<title>Discussion</title>
<p>Stochastic processes are ubiquitous in cellular systems. A deterministic-stochastic description of interacting components with disparate degrees of stochasticity provides an efficient alternative to a full stochastic treatment of the problem. In a hybrid numerical approach, an appropriate integration of deterministic and stochastic methods yields significant computational savings.</p>
<p>In this paper, we describe a general-purpose hybrid method for solving spatial deterministic-stochastic models in realistic cell geometries. The emphasis is placed on the physical fundamentals of the method and its testing. The method is based on a formulation in terms of stochastic variables of two types: continuous variables, described by partial differential equations with stochastic source terms, and discrete variables governed by stochastic jump processes. Numerically, the algorithm is a Monte Carlo fixed time step integrator generating realizations of the hybrid system. The current implementation utilizes a VCell fixed time step PDE solver coupled with a particle-based stochastic simulator Smoldyn.</p>
<p>Validating a hybrid deterministic-stochastic numerical scheme is conceptually nontrivial and logistically challenging. We tested our method against analytical results and numerical solutions obtained by alternative methods. The expected convergence of solution error was observed in tests with a separable stochastic subsystem. Testing of the method in conditions of full coupling was performed in the limit of fast diffusion against well-mixed solutions obtained with nonspatial Gibson-Bruck method and against a direct solution of a corresponding Fokker-Planck equation. The latter approach was also used for testing spatially heterogeneous solutions of fully coupled hybrid systems.</p>
<p>The method has been applied to a hybrid model of spontaneous cell polarization based on the original idea of Altschuler et al. [<xref ref-type="bibr" rid="pcbi.1005236.ref054">54</xref>]. The solution recapitulates emergence of a stable asymmetric distribution of membrane-bound molecules, as a result of positive feedback and stochasticity. But in the hybrid version, the total number of membrane molecules is free from the small copy number requirement, which now applies only to the number of receptors that initiate clusters. The model predicts glassy-like kinetics of coalescence of the multi-cluster structure into a single cluster.</p>
<p>While the VCell spatial hybrid solver is practical for many typical applications, its performance may become suboptimal for cases with disparate time scales (‘stiff’ problems), as the integration is done with a fixed time step. The handling of the discrete variables can be optimized by incorporating adaptive approaches, although potential savings should be weighed against costs associated with additional logistical complexity, particularly since the inefficiencies are often caused by stiffness of the deterministic subsystem. While the stiffness caused by fast reactions that persist throughout the time of interest can be addressed by applying the VCell automatic quasi-steady-state approximation (see discussion in Section <italic>Mathematical problem and algorithm</italic>), the treatment of continuous variables would generally benefit from implementation of time-step control commonly employed in deterministic numerical algorithms.</p>
</sec>
<sec id="sec012">
<title>Supporting Information</title>
<supplementary-material id="pcbi.1005236.s001" mimetype="application/vnd.openxmlformats-officedocument.wordprocessingml.document" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005236.s001" xlink:type="simple">
<label>S1 Text</label>
<caption>
<title>Exact mathematical expectation value of the spatial average of the ‘deterministic variable in a hybrid model with separable subsystems</title>
<p>(DOCX)</p>
</caption>
</supplementary-material>
<supplementary-material id="pcbi.1005236.s002" mimetype="application/vnd.openxmlformats-officedocument.wordprocessingml.document" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005236.s002" xlink:type="simple">
<label>S2 Text</label>
<caption>
<title>Discretization of Eq (<xref ref-type="disp-formula" rid="pcbi.1005236.e044">5</xref>) and solution of discretized equations</title>
<p>(DOCX)</p>
</caption>
</supplementary-material>
<supplementary-material id="pcbi.1005236.s003" mimetype="application/vnd.openxmlformats-officedocument.wordprocessingml.document" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005236.s003" xlink:type="simple">
<label>S3 Text</label>
<caption>
<title>Implementation of the hybrid model of spontaneous cell polarization in VCell Math Workspace</title>
<p>(DOCX)</p>
</caption>
</supplementary-material>
</sec>
</body>
<back>
<ack>
<p>We thank Leslie Loew for continuing support and stimulating discussions and gratefully acknowledge helpful discussions with Yung-Sze Choi, Diana Resasco, Steven Andrews, and Steven Altschuler. Frank Morgan, Gerard Weatherby, and Masoud Nickaeen kindly provided technical assistance at various stages of the project.</p>
</ack>
<ref-list>
<title>References</title>
<ref id="pcbi.1005236.ref001"><label>1</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Rüdiger</surname> <given-names>S</given-names></name> (<year>2014</year>) <article-title>Stochastic models of intracellular calcium signals</article-title>. <source>Phys Rep</source> <volume>534</volume>: <fpage>39</fpage>–<lpage>47</lpage>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref002"><label>2</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Schneidman</surname> <given-names>E</given-names></name>, <name name-style="western"><surname>Freedman</surname> <given-names>B</given-names></name>, <name name-style="western"><surname>Segev</surname> <given-names>I</given-names></name> (<year>1998</year>) <article-title>Ion channel stochasticity may be critical in determining the reliability and precision of spike timing</article-title>. <source>Neural Comput</source> <volume>10</volume>: <fpage>1679</fpage>–<lpage>1703</lpage>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref003"><label>3</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Pahle</surname> <given-names>J</given-names></name> (<year>2009</year>) <article-title>Biochemical simulations: stochastic, approximate stochastic and hybrid approaches</article-title>. <source>Brief Bioinform</source> <volume>10</volume>: <fpage>53</fpage>–<lpage>64</lpage>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref004"><label>4</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Choi</surname> <given-names>T</given-names></name>, <name name-style="western"><surname>Maurya</surname> <given-names>MR</given-names></name>, <name name-style="western"><surname>Tartakovsky</surname> <given-names>DM</given-names></name>, <name name-style="western"><surname>Subramaniam</surname> <given-names>S</given-names></name> (<year>2010</year>) <article-title>Stochastic hybrid modeling of intracellular calcium dynamics</article-title>. <source>J Chem Phys</source> <volume>133</volume>: <fpage>165101</fpage>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref005"><label>5</label><mixed-citation publication-type="book" xlink:type="simple"><name name-style="western"><surname>Gardiner</surname> <given-names>C</given-names></name> (<year>2004</year>) <source>Handbook of Stochastic Methods for Physics, Chemistry and the Natural Sciences</source>. <edition>Third Edition</edition>: <publisher-name>Springer-Verlag</publisher-name>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref006"><label>6</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Gillespie</surname> <given-names>DT</given-names></name> (<year>1976</year>) <article-title>A General Method for Numerically Simulating the Stochastic Time Evolution of Coupled Chemical Reactions</article-title>. <source>J Comput Phys</source> <volume>22</volume>: <fpage>403</fpage>–<lpage>434</lpage>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref007"><label>7</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Gibson</surname> <given-names>MA</given-names></name>, <name name-style="western"><surname>Bruck</surname> <given-names>J</given-names></name> (<year>2000</year>) <article-title>Efficient Exact Stochastic Simulation of Chemical System with Many Species and Many Channels</article-title>. <source>J Phys Chem A</source> <volume>104</volume>: <fpage>1876</fpage>–<lpage>1889</lpage>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref008"><label>8</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Davis</surname> <given-names>MHA</given-names></name> (<year>1984</year>) <article-title>Piecewise-deterministic Markov processes: a general class of non-diffusion stochastic models (with discussion)</article-title>, <source>J R Stat Soc Ser B</source> <volume>46</volume>: <fpage>353</fpage>–<lpage>388</lpage>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref009"><label>9</label><mixed-citation publication-type="book" xlink:type="simple"><name name-style="western"><surname>Davis</surname> <given-names>MHA</given-names></name> (<year>1993</year>) <chapter-title>Markov models and optimization</chapter-title>. <publisher-name>Chapman and Hall</publisher-name>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref010"><label>10</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Shuai</surname> <given-names>JW</given-names></name>, <name name-style="western"><surname>Jung</surname> <given-names>P</given-names></name> (<year>2002</year>) <article-title>Stochastic properties of Ca (2+) release of inositol 1,4,5-trisphosphate receptor clusters</article-title>. <source>Biophys J</source> <volume>83</volume>: <fpage>87</fpage>–<lpage>97</lpage>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref011"><label>11</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Alfonsi</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Cancès</surname> <given-names>E</given-names></name>, <name name-style="western"><surname>Turinici</surname> <given-names>G</given-names></name>, <name name-style="western"><surname>Di Ventura</surname> <given-names>B</given-names></name>, <name name-style="western"><surname>Huisinga</surname></name> (<year>2005</year>) <article-title>Adaptive simulation of hybrid stochastic and deterministic models for biochemical systems</article-title>. <source>ESAIM: Proc</source> <volume>14</volume>: <fpage>1</fpage>–<lpage>13</lpage>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref012"><label>12</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Riedler</surname> <given-names>MG</given-names></name> (<year>2013</year>) <article-title>Almost sure convergence of numerical approximations for Piecewise Deterministic Markov Processes</article-title>. <source>J Comput Appl Math</source> <volume>239</volume>: <fpage>50</fpage>–<lpage>71</lpage>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref013"><label>13</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Salis</surname> <given-names>H</given-names></name>, <name name-style="western"><surname>Kaznessis</surname> <given-names>Y</given-names></name> (<year>2005</year>) <article-title>Accurate hybrid stochastic simulation of a system of coupled chemical or biochemical reactions</article-title>. <source>J Chem Phys</source> <volume>122</volume>: <fpage>054103</fpage>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref014"><label>14</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Wylie</surname> <given-names>DC</given-names></name>, <name name-style="western"><surname>Hori</surname> <given-names>Y</given-names></name>, <name name-style="western"><surname>Dinner</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Chakraborty</surname> <given-names>AK</given-names></name> (<year>2006</year>) <article-title>A hybrid deterministic-stochastic algorithm for modeling cell signaling dynamics in spatially inhomogeneous environments and under the influence of external fields</article-title>. <source>J Phys Chem B</source> <volume>110</volume>: <fpage>12749</fpage>–<lpage>12765</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1021/jp056231f" xlink:type="simple">10.1021/jp056231f</ext-link></comment> <object-id pub-id-type="pmid">16800611</object-id></mixed-citation></ref>
<ref id="pcbi.1005236.ref015"><label>15</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Stundzia</surname> <given-names>AB</given-names></name>, <name name-style="western"><surname>Lumsden</surname> <given-names>CJ</given-names></name> (<year>1996</year>) <article-title>Stochastic simulation of coupled reaction-diffusion processes</article-title>. <source>J Comput Phys</source> <volume>127</volume>: <fpage>196</fpage>–<lpage>207</lpage>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref016"><label>16</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Elf</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Doncic</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Ehrenberg</surname> <given-names>M</given-names></name> (<year>2003</year>) <article-title>Mesoscopic reaction-diffusion in intracellular signaling</article-title>, <source>Soc Photo-Opt Instr Eng</source> <volume>5110</volume>: <fpage>114</fpage>–<lpage>124</lpage>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref017"><label>17</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Cao</surname> <given-names>Y</given-names></name>, <name name-style="western"><surname>Li</surname> <given-names>H</given-names></name>, <name name-style="western"><surname>Petzold</surname> <given-names>L</given-names></name> (<year>2004</year>) <article-title>Efficient formulation of the stochastic simulation algorithm for chemically reacting systems</article-title>. <source>J Chem Phys</source> <volume>121</volume>: <fpage>4059</fpage>–<lpage>4067</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1063/1.1778376" xlink:type="simple">10.1063/1.1778376</ext-link></comment> <object-id pub-id-type="pmid">15332951</object-id></mixed-citation></ref>
<ref id="pcbi.1005236.ref018"><label>18</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Isaacson</surname> <given-names>SA</given-names></name>, <name name-style="western"><surname>Peskin</surname> <given-names>CS</given-names></name> (<year>2006</year>) <article-title>Incorporating diffusion in complex geometries into stochastic chemical kinetics simulations</article-title>. <source>SIAM J Sci Comput</source> <volume>28</volume>: <fpage>47</fpage>–<lpage>74</lpage>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref019"><label>19</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Fange</surname> <given-names>D</given-names></name>, <name name-style="western"><surname>Elf</surname> <given-names>J</given-names></name> (<year>2006</year>) <article-title>Noise-Induced Min Phenotypes in E. coli</article-title>. <source>PLoS Comput Bio</source>. <volume>2</volume>: <fpage>637</fpage>–<lpage>648</lpage> (<issue>e80</issue>).</mixed-citation></ref>
<ref id="pcbi.1005236.ref020"><label>20</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Baras</surname> <given-names>F</given-names></name>, <name name-style="western"><surname>Mansour</surname> <given-names>MM</given-names></name> (<year>1996</year>) <article-title>Reaction-diffusion master equation: A comparison with microscopic simulations</article-title>. <source>Phys Rev E</source><volume>54</volume>: <fpage>6139</fpage>–<lpage>6148</lpage>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref021"><label>21</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Isaacson</surname> <given-names>SA</given-names></name> (<year>2009</year>) <article-title>The reaction-diffusion master equation as an asymptotic diffusion to a small target</article-title>, <source>SIAM J Appl Math</source> <volume>70</volume>: <fpage>77</fpage>–<lpage>111</lpage>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref022"><label>22</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Slepchenko</surname> <given-names>BM</given-names></name>, <name name-style="western"><surname>Schaff</surname> <given-names>JC</given-names></name>, <name name-style="western"><surname>Carson</surname> <given-names>JH</given-names></name>, <name name-style="western"><surname>Loew</surname> <given-names>LM</given-names></name> (<year>2002</year>) <article-title>Computational cell biology: spatiotemporal simulation of cellular events</article-title>. <source>Annu Rev Biophys Biomol Struct</source> <volume>31</volume>: <fpage>423</fpage>–<lpage>41</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1146/annurev.biophys.31.101101.140930" xlink:type="simple">10.1146/annurev.biophys.31.101101.140930</ext-link></comment> <object-id pub-id-type="pmid">11988477</object-id></mixed-citation></ref>
<ref id="pcbi.1005236.ref023"><label>23</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Kraikivski</surname> <given-names>P</given-names></name>, <name name-style="western"><surname>Slepchenko</surname> <given-names>BM</given-names></name>, <name name-style="western"><surname>Novak</surname> <given-names>IL</given-names></name> (<year>2008</year>) <article-title>Actin bundling: initiation mechanisms and kinetics</article-title>. <source>Phys Rev Lett</source> <volume>101</volume>: <fpage>128102</fpage>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref024"><label>24</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Kraikivski</surname> <given-names>P</given-names></name>, <name name-style="western"><surname>Slepchenko</surname> <given-names>BM</given-names></name> (<year>2010</year>) <article-title>Quantifying a pathway: Kinetic analysis of actin dendritic nucleation</article-title>, <source>Biophys J</source> <volume>99</volume>: <fpage>708</fpage>–<lpage>715</lpage>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref025"><label>25</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Buckwar</surname> <given-names>E</given-names></name>, <name name-style="western"><surname>Riedler</surname> <given-names>M.G.</given-names></name> (<year>2011</year>) <article-title>An exact stochastic hybrid model of excitable membranes including spatio-temporal evolution</article-title>. <source>J Math Biol</source> <volume>63</volume>: <fpage>1051</fpage>–<lpage>1093</lpage>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref026"><label>26</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Rüdiger</surname> <given-names>S</given-names></name>, <name name-style="western"><surname>Shuai</surname> <given-names>JW</given-names></name>, <name name-style="western"><surname>Huisinga</surname> <given-names>W</given-names></name>, <name name-style="western"><surname>Nagaiah</surname> <given-names>C</given-names></name>, <name name-style="western"><surname>Warnecke</surname> <given-names>G</given-names></name>, <name name-style="western"><surname>Parker</surname> <given-names>I</given-names></name>, <name name-style="western"><surname>Falcke</surname> <given-names>M</given-names></name> (<year>2007</year>) <article-title>Hybrid stochastic and deterministic simulations of calcium blips</article-title>, <source>Biophys J</source>. <volume>93</volume> <fpage>1847</fpage>–<lpage>1857</lpage>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref027"><label>27</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Rüdiger</surname> <given-names>S</given-names></name>, <name name-style="western"><surname>Nagaiah</surname> <given-names>C</given-names></name>, <name name-style="western"><surname>Warnecke</surname> <given-names>G</given-names></name>, <name name-style="western"><surname>Shuai</surname> <given-names>JW</given-names></name> (<year>2010</year>) <article-title>Calcium domains around single and clustered IP3 receptors and their modulation by buffers</article-title>, <source>Biophys J</source>. <volume>99</volume> <fpage>3</fpage>–<lpage>12</lpage>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref028"><label>28</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Skupin</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Kettenmann</surname> <given-names>H</given-names></name>, <name name-style="western"><surname>Falcke</surname> <given-names>M</given-names></name> (<year>2010</year>) <article-title>Calcium signals driven by single channel noise</article-title>, <source>PLoS Comput Biol</source> <volume>6</volume>: <fpage>e1000870</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1371/journal.pcbi.1000870" xlink:type="simple">10.1371/journal.pcbi.1000870</ext-link></comment> <object-id pub-id-type="pmid">20700497</object-id></mixed-citation></ref>
<ref id="pcbi.1005236.ref029"><label>29</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Jafri</surname> <given-names>MS</given-names></name> (<year>2012</year>) <article-title>Models of Excitation–Contraction Coupling in Cardiac Ventricular Myocytes</article-title>. <source>Methods Mol Biol</source> <volume>910</volume>: <fpage>309</fpage>–<lpage>335</lpage>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref030"><label>30</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Fabiato</surname> <given-names>A</given-names></name> (<year>1983</year>) <article-title>Calcium-induced release of calcium from the cardiac sarcoplasmic reticulum</article-title>. <source>Am J Physiol</source> <volume>245 C</volume>: <fpage>1</fpage>–<lpage>14</lpage>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref031"><label>31</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Williams</surname> <given-names>GS</given-names></name>, <name name-style="western"><surname>Smith</surname> <given-names>GD</given-names></name>, <name name-style="western"><surname>Sobie</surname> <given-names>EA</given-names></name>, <name name-style="western"><surname>Jafri</surname> <given-names>MS</given-names></name> (<year>2010</year>) <article-title>Models of cardiac excitation-contraction coupling in ventricular myocytes</article-title>, <source>Math Biosci</source> <volume>226</volume>: <fpage>1</fpage>–<lpage>15</lpage>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref032"><label>32</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Cheng</surname> <given-names>H</given-names></name>, <name name-style="western"><surname>Lederer</surname> <given-names>WJ</given-names></name>, <name name-style="western"><surname>Cannell</surname> <given-names>MB</given-names></name> (<year>1993</year>) <article-title>Calcium sparks: elementary events underlying excitation contraction coupling in heart muscle</article-title>. <source>Science</source> <volume>262</volume>: <fpage>740</fpage>–<lpage>4</lpage>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref033"><label>33</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Cheng</surname> <given-names>Y</given-names></name>, <name name-style="western"><surname>Yu</surname> <given-names>Z</given-names></name>, <name name-style="western"><surname>Hoshijima</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Holst</surname> <given-names>MJ</given-names></name>, <name name-style="western"><surname>McCulloch</surname> <given-names>AD</given-names></name>, <name name-style="western"><surname>McCammon</surname> <given-names>JA</given-names></name>, <name name-style="western"><surname>Michailova</surname> <given-names>AP</given-names></name> (<year>2010</year>) <article-title>Numerical analysis of Ca2+ signaling in rat ventricular myocytes with realistic transverse-axial tubular geometry and inhibited sarcoplasmic reticulum</article-title>. <source>PLoS Comput Biol</source>. <volume>6</volume>: <fpage>e1000972</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1371/journal.pcbi.1000972" xlink:type="simple">10.1371/journal.pcbi.1000972</ext-link></comment> <object-id pub-id-type="pmid">21060856</object-id></mixed-citation></ref>
<ref id="pcbi.1005236.ref034"><label>34</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Ramay</surname> <given-names>HR</given-names></name>, <name name-style="western"><surname>Jafri</surname> <given-names>MS</given-names></name>, <name name-style="western"><surname>Lederer</surname> <given-names>WJ</given-names></name>, <name name-style="western"><surname>Sobie</surname> <given-names>EA</given-names></name> (<year>2010</year>) <article-title>Predicting local SR Ca(2+) dynamics during Ca(2+) wave propagation in ventricular myocytes</article-title>, <source>Biophys J</source> <volume>98</volume>: <fpage>2515</fpage>–<lpage>2523</lpage>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref035"><label>35</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Loew</surname> <given-names>LM</given-names></name>, <name name-style="western"><surname>Schaff</surname> <given-names>JC</given-names></name> (<year>2001</year>) <article-title>The Virtual Cell: a software environment for computational cell biology</article-title>. <source>Trends Biotechnol</source> <volume>19</volume>: <fpage>401</fpage>–<lpage>406</lpage>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref036"><label>36</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Moraru</surname> <given-names>II</given-names></name>, <name name-style="western"><surname>Schaff</surname> <given-names>JC</given-names></name>, <name name-style="western"><surname>Slepchenko</surname> <given-names>BM</given-names></name>, <name name-style="western"><surname>Blinov</surname> <given-names>ML</given-names></name>, <name name-style="western"><surname>Morgan</surname> <given-names>F</given-names></name>, <name name-style="western"><surname>Lakshminarayana</surname> <given-names>A.</given-names></name>, <name name-style="western"><surname>Gao</surname> <given-names>F</given-names></name>, <name name-style="western"><surname>Li</surname> <given-names>Y</given-names></name>, <name name-style="western"><surname>Loew</surname> <given-names>LM</given-names></name> (<year>2008</year>) <article-title>Virtual Cell modelling and simulation environment</article-title>, <source>IET Syst Biol</source> <volume>2</volume>: <fpage>352</fpage>–<lpage>362</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1049/iet-syb:20080102" xlink:type="simple">10.1049/iet-syb:20080102</ext-link></comment> <object-id pub-id-type="pmid">19045830</object-id></mixed-citation></ref>
<ref id="pcbi.1005236.ref037"><label>37</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Slepchenko</surname> <given-names>BM</given-names></name>, <name name-style="western"><surname>Schaff</surname> <given-names>JC</given-names></name>, <name name-style="western"><surname>Macara</surname> <given-names>I</given-names></name>, <name name-style="western"><surname>Loew</surname> <given-names>LM</given-names></name> (<year>2003</year>) <article-title>Quantitative cell biology with the Virtual Cell</article-title>. <source>Trends Cell Biol</source> <volume>13</volume>: <fpage>570</fpage>–<lpage>576</lpage>. <object-id pub-id-type="pmid">14573350</object-id></mixed-citation></ref>
<ref id="pcbi.1005236.ref038"><label>38</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Slepchenko</surname> <given-names>BM</given-names></name>, <name name-style="western"><surname>Loew</surname> <given-names>LM</given-names></name> (<year>2010</year>) <article-title>Use of Virtual Cell in Studies of Cellular Dynamics</article-title>. <source>Int Rev Cell Mol Biol</source> <volume>283</volume>: <fpage>1</fpage>–<lpage>56</lpage>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref039"><label>39</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Resasco</surname> <given-names>DC</given-names></name>, <name name-style="western"><surname>Gao</surname> <given-names>F</given-names></name>, <name name-style="western"><surname>Morgan</surname> <given-names>F</given-names></name>, <name name-style="western"><surname>Novak</surname> <given-names>IL</given-names></name>, <name name-style="western"><surname>Schaff</surname> <given-names>JC</given-names></name>, <name name-style="western"><surname>Slepchenko</surname> <given-names>BM</given-names></name> (<year>2012</year>) <article-title>Virtual Cell: computational tools for modeling in cell biology</article-title>. <source>WIREs Syst Biol Med</source> <volume>4</volume>: <fpage>129</fpage>–<lpage>140</lpage>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref040"><label>40</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Andrews</surname> <given-names>SS</given-names></name>, <name name-style="western"><surname>Bray</surname> <given-names>D</given-names></name> (<year>2004</year>) <article-title>Stochastic simulation of chemical reactions with spatial resolution and single molecule detail</article-title>. <source>Phys Biol</source> <volume>1</volume>: <fpage>137</fpage>–<lpage>151</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1088/1478-3967/1/3/001" xlink:type="simple">10.1088/1478-3967/1/3/001</ext-link></comment> <object-id pub-id-type="pmid">16204833</object-id></mixed-citation></ref>
<ref id="pcbi.1005236.ref041"><label>41</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Andrews</surname> <given-names>SS</given-names></name>, <name name-style="western"><surname>Addy</surname> <given-names>NJ</given-names></name>, <name name-style="western"><surname>Brent</surname> <given-names>R</given-names></name>, <name name-style="western"><surname>Arkin</surname> <given-names>AP</given-names></name> (<year>2010</year>) <article-title>Detailed simulations of cell biology with Smoldyn 2.1</article-title>. <source>PLoS Comput. Biol.</source> <volume>6</volume>: <fpage>e1000705</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1371/journal.pcbi.1000705" xlink:type="simple">10.1371/journal.pcbi.1000705</ext-link></comment> <object-id pub-id-type="pmid">20300644</object-id></mixed-citation></ref>
<ref id="pcbi.1005236.ref042"><label>42</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Robinson</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Andrews</surname> <given-names>SS</given-names></name>, <name name-style="western"><surname>Erban</surname> <given-names>R</given-names></name> (<year>2015</year>) <article-title>Multiscale reaction-diffusion simulations with Smoldyn</article-title>. <source>Bioinformatics</source> <volume>31</volume>: <fpage>2406</fpage>–<lpage>2408</lpage>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref043"><label>43</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Alexander</surname> <given-names>FJ</given-names></name>, <name name-style="western"><surname>Garcia</surname> <given-names>AL</given-names></name>, <name name-style="western"><surname>Tartakovsky</surname> <given-names>DM</given-names></name> (<year>2002</year>) <article-title>Algorithm Refinement for Stochastic Partial Differential Equations</article-title>. <source>J Comput Phys</source> <volume>182</volume>: <fpage>47</fpage>–<lpage>66</lpage>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref044"><label>44</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Flegg</surname> <given-names>MB</given-names></name>, <name name-style="western"><surname>Chapman</surname> <given-names>SJ</given-names></name>, <name name-style="western"><surname>Erban</surname> <given-names>R</given-names></name> (<year>2012</year>) <article-title>The two-regime method for optimizing stochastic reaction- diffusion simulations</article-title>, <source>J R Soc Interface</source> <volume>9</volume>: <fpage>859</fpage>–<lpage>868</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1098/rsif.2011.0574" xlink:type="simple">10.1098/rsif.2011.0574</ext-link></comment> <object-id pub-id-type="pmid">22012973</object-id></mixed-citation></ref>
<ref id="pcbi.1005236.ref045"><label>45</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Franz</surname> <given-names>B</given-names></name>, <name name-style="western"><surname>Flegg</surname> <given-names>MB</given-names></name>, <name name-style="western"><surname>Chapman</surname> <given-names>SJ</given-names></name>, <name name-style="western"><surname>Erban</surname> <given-names>R</given-names></name> (<year>2013</year>) <article-title>Multiscale reaction-diffusion algorithms: PDE-assisted Brownian dynamics</article-title>, <source>SIAM J Appl Math</source> <volume>73</volume>: <fpage>1224</fpage>–<lpage>1247</lpage>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref046"><label>46</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Dobramysl</surname> <given-names>U</given-names></name>, <name name-style="western"><surname>Rüdiger</surname> <given-names>S</given-names></name>, <name name-style="western"><surname>Erban</surname> <given-names>R</given-names></name> (<year>2016</year>) <article-title>Particle-based Multiscale Modeling of Intracellular Calcium Dynamics</article-title>, <source>SIAM Multiscale Model Simul</source> <volume>14</volume>: <fpage>997</fpage>–<lpage>1016</lpage>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref047"><label>47</label><mixed-citation publication-type="book" xlink:type="simple"><name name-style="western"><surname>Cowan</surname> <given-names>AE</given-names></name>, <name name-style="western"><surname>Moraru</surname> <given-names>II</given-names></name>, <name name-style="western"><surname>Schaff</surname> <given-names>JC</given-names></name>, <name name-style="western"><surname>Slepchenko</surname> <given-names>BM</given-names></name>, <name name-style="western"><surname>Loew</surname> <given-names>L.M.</given-names></name> (<year>2012</year>) <chapter-title>Spatial modeling of cell signaling networks</chapter-title>, in <name name-style="western"><surname>Asthagiri</surname> <given-names>A. R.</given-names></name> and <name name-style="western"><surname>Arkin</surname> <given-names>A. P.</given-names></name> (Eds.), <source>Computational Methods in Cell Biology</source>, <publisher-name>Academic Press, Elsevier Inc.</publisher-name>, <publisher-loc>Oxford UK</publisher-loc>, pp. <fpage>196</fpage>–<lpage>223</lpage>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref048"><label>48</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Schaff</surname> <given-names>JC</given-names></name>, <name name-style="western"><surname>Slepchenko</surname> <given-names>BM</given-names></name>, <name name-style="western"><surname>Choi</surname> <given-names>Y-S</given-names></name>, <name name-style="western"><surname>Wagner</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Resasco</surname> <given-names>D</given-names></name>, <name name-style="western"><surname>Loew</surname> <given-names>L. M.</given-names></name> (<year>2001</year>) <article-title>Analysis of nonlinear dynamics on arbitrary geometries with the Virtual Cell</article-title>. <source>Chaos</source> <volume>11</volume>: <fpage>115</fpage>–<lpage>131</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1063/1.1350404" xlink:type="simple">10.1063/1.1350404</ext-link></comment> <object-id pub-id-type="pmid">12779447</object-id></mixed-citation></ref>
<ref id="pcbi.1005236.ref049"><label>49</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Novak</surname> <given-names>IL</given-names></name>, <name name-style="western"><surname>Gao</surname> <given-names>F</given-names></name>, <name name-style="western"><surname>Choi</surname> <given-names>Y-S</given-names></name>, <name name-style="western"><surname>Resasco</surname> <given-names>D</given-names></name>, <name name-style="western"><surname>Schaff</surname> <given-names>JC</given-names></name>, <name name-style="western"><surname>Slepchenko</surname> <given-names>BM</given-names></name> (<year>2007</year>) <article-title>Diffusion on a Curved Surface Coupled to Diffusion in the Volume: Application to Cell Biology</article-title>. <source>J Comput Phys</source> <volume>226</volume>: <fpage>1271</fpage>–<lpage>1290</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1016/j.jcp.2007.05.025" xlink:type="simple">10.1016/j.jcp.2007.05.025</ext-link></comment> <object-id pub-id-type="pmid">18836520</object-id></mixed-citation></ref>
<ref id="pcbi.1005236.ref050"><label>50</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Slepchenko</surname> <given-names>BM</given-names></name>, <name name-style="western"><surname>Schaff</surname> <given-names>JC</given-names></name>, <name name-style="western"><surname>Choi</surname> <given-names>Y-S</given-names></name> (<year>2000</year>) <article-title>Numerical Approach to Fast Reactions in Reaction-Diffusion Systems: Application to Buffered Calcium Waves in Bistable Models</article-title>, <source>J Comput Phys</source> <volume>162</volume>: <fpage>186</fpage>–<lpage>218</lpage>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref051"><label>51</label><mixed-citation publication-type="book" xlink:type="simple"><name name-style="western"><surname>Ferziger</surname> <given-names>JH</given-names></name>, <name name-style="western"><surname>Perić</surname> <given-names>M</given-names></name> (<year>2002</year>) <source>Computational Methods for Fluid Dynamics</source>. <edition>Third Edition</edition>: <publisher-name>Springer</publisher-name>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref052"><label>52</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Novak</surname> <given-names>IL</given-names></name>, <name name-style="western"><surname>Gao</surname> <given-names>F</given-names></name>, <name name-style="western"><surname>Kraikivski</surname> <given-names>P</given-names></name>, <name name-style="western"><surname>Slepchenko</surname> <given-names>BM</given-names></name> (<year>2011</year>) <article-title>Diffusion amid random overlapping obstacles: Similarities, invariants, approximations</article-title>, <source>J Chem Phys</source> <volume>134</volume>: <fpage>154104</fpage>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref053"><label>53</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Gopich</surname> <given-names>IV</given-names></name>, <name name-style="western"><surname>Szabo</surname> <given-names>A</given-names></name> (<year>2016</year>) <article-title>Reversible stochastically gated diffusion-influenced reactions</article-title>, <source>J Phys Chem B</source> 2016, <volume>120</volume>: <fpage>8080</fpage>–<lpage>8089</lpage>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref054"><label>54</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Altschuler</surname> <given-names>SJ</given-names></name>, <name name-style="western"><surname>Angenent</surname> <given-names>SB</given-names></name>, <name name-style="western"><surname>Wang</surname> <given-names>Y</given-names></name>, <name name-style="western"><surname>Wu</surname> <given-names>LF</given-names></name> (<year>2008</year>) <article-title>On the spontaneous emergence of cell polarity</article-title>, <source>Nature</source> <volume>454</volume>: <fpage>886</fpage>–<lpage>890</lpage>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref055"><label>55</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Jikine</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Angenent</surname> <given-names>SB</given-names></name>, <name name-style="western"><surname>Wu</surname> <given-names>LF</given-names></name>, <name name-style="western"><surname>Altschuler</surname> <given-names>SJ</given-names></name> (<year>2011</year>) <article-title>A Density-Dependent Switch Drives Stochastic Clustering and Polarization of Signaling Molecules</article-title>, <source>PLoS Comput Biol</source> <volume>7</volume>: <fpage>e41002271</fpage>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref056"><label>56</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Sadati</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Nourhani</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Fredberg</surname> <given-names>JJ</given-names></name>, <name name-style="western"><surname>Qazvini</surname> <given-names>NT</given-names></name> (<year>2014</year>) <article-title>Glass-like dynamics in the cell and in cellular collectives</article-title>, <source>WIREs Syst Biol Med</source> <volume>6</volume>: <fpage>137</fpage>–<lpage>149</lpage>.</mixed-citation></ref>
<ref id="pcbi.1005236.ref057"><label>57</label><mixed-citation publication-type="other" xlink:type="simple">Taubin G (<year>1994</year>) Curve and surface smoothing without shrinkage, IBM Research Technical Report RC-19536.</mixed-citation></ref>
</ref-list>
</back>
</article>