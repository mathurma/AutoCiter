<!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1d3 20150301//EN" "http://jats.nlm.nih.gov/publishing/1.1d3/JATS-journalpublishing1.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="1.1d3" xml:lang="en">
<front>
<journal-meta>
<journal-id journal-id-type="nlm-ta">PLoS Comput Biol</journal-id>
<journal-id journal-id-type="publisher-id">plos</journal-id>
<journal-id journal-id-type="pmc">ploscomp</journal-id>
<journal-title-group>
<journal-title>PLOS Computational Biology</journal-title>
</journal-title-group>
<issn pub-type="ppub">1553-734X</issn>
<issn pub-type="epub">1553-7358</issn>
<publisher>
<publisher-name>Public Library of Science</publisher-name>
<publisher-loc>San Francisco, CA USA</publisher-loc>
</publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="publisher-id">PCOMPBIOL-D-16-01968</article-id>
<article-id pub-id-type="doi">10.1371/journal.pcbi.1005842</article-id>
<article-categories>
<subj-group subj-group-type="heading">
<subject>Research Article</subject>
</subj-group>
<subj-group subj-group-type="Discipline-v3"><subject>Medicine and health sciences</subject><subj-group><subject>Surgical and invasive medical procedures</subject><subj-group><subject>Functional electrical stimulation</subject></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Physiology</subject><subj-group><subject>Electrophysiology</subject><subj-group><subject>Membrane potential</subject><subj-group><subject>Action potentials</subject></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Medicine and health sciences</subject><subj-group><subject>Physiology</subject><subj-group><subject>Electrophysiology</subject><subj-group><subject>Membrane potential</subject><subj-group><subject>Action potentials</subject></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Physiology</subject><subj-group><subject>Electrophysiology</subject><subj-group><subject>Neurophysiology</subject><subj-group><subject>Action potentials</subject></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Medicine and health sciences</subject><subj-group><subject>Physiology</subject><subj-group><subject>Electrophysiology</subject><subj-group><subject>Neurophysiology</subject><subj-group><subject>Action potentials</subject></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Neuroscience</subject><subj-group><subject>Neurophysiology</subject><subj-group><subject>Action potentials</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Cell biology</subject><subj-group><subject>Cellular types</subject><subj-group><subject>Animal cells</subject><subj-group><subject>Neurons</subject></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Neuroscience</subject><subj-group><subject>Cellular neuroscience</subject><subj-group><subject>Neurons</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Physical sciences</subject><subj-group><subject>Mathematics</subject><subj-group><subject>Numerical analysis</subject><subj-group><subject>Extrapolation</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Physical sciences</subject><subj-group><subject>Mathematics</subject><subj-group><subject>Applied mathematics</subject><subj-group><subject>Algorithms</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Research and analysis methods</subject><subj-group><subject>Simulation and modeling</subject><subj-group><subject>Algorithms</subject></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Research and analysis methods</subject><subj-group><subject>Bioassays and physiological analysis</subject><subj-group><subject>Electrophysiological techniques</subject><subj-group><subject>Membrane electrophysiology</subject><subj-group><subject>Electrode recording</subject></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Biotechnology</subject><subj-group><subject>Medical devices and equipment</subject><subj-group><subject>Assistive technologies</subject><subj-group><subject>Prosthetics</subject></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Medicine and health sciences</subject><subj-group><subject>Medical devices and equipment</subject><subj-group><subject>Assistive technologies</subject><subj-group><subject>Prosthetics</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Anatomy</subject><subj-group><subject>Ocular system</subject><subj-group><subject>Ocular anatomy</subject><subj-group><subject>Retina</subject></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Medicine and health sciences</subject><subj-group><subject>Anatomy</subject><subj-group><subject>Ocular system</subject><subj-group><subject>Ocular anatomy</subject><subj-group><subject>Retina</subject></subj-group></subj-group></subj-group></subj-group></subj-group></article-categories>
<title-group>
<article-title>Electrical stimulus artifact cancellation and neural spike detection on large multi-electrode arrays</article-title>
<alt-title alt-title-type="running-head">Electrical stimulus artifact cancellation and neural spike detection on large MEAs</alt-title>
</title-group>
<contrib-group>
<contrib contrib-type="author" corresp="yes" xlink:type="simple">
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0003-4432-9679</contrib-id>
<name name-style="western">
<surname>Mena</surname> <given-names>Gonzalo E.</given-names></name>
<role content-type="http://credit.casrai.org/">Conceptualization</role>
<role content-type="http://credit.casrai.org/">Data curation</role>
<role content-type="http://credit.casrai.org/">Formal analysis</role>
<role content-type="http://credit.casrai.org/">Investigation</role>
<role content-type="http://credit.casrai.org/">Methodology</role>
<role content-type="http://credit.casrai.org/">Software</role>
<role content-type="http://credit.casrai.org/">Validation</role>
<role content-type="http://credit.casrai.org/">Visualization</role>
<role content-type="http://credit.casrai.org/">Writing – original draft</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff001"><sup>1</sup></xref>
<xref ref-type="corresp" rid="cor001">*</xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<name name-style="western">
<surname>Grosberg</surname> <given-names>Lauren E.</given-names></name>
<role content-type="http://credit.casrai.org/">Conceptualization</role>
<role content-type="http://credit.casrai.org/">Data curation</role>
<role content-type="http://credit.casrai.org/">Formal analysis</role>
<role content-type="http://credit.casrai.org/">Investigation</role>
<role content-type="http://credit.casrai.org/">Methodology</role>
<role content-type="http://credit.casrai.org/">Software</role>
<role content-type="http://credit.casrai.org/">Validation</role>
<role content-type="http://credit.casrai.org/">Visualization</role>
<role content-type="http://credit.casrai.org/">Writing – original draft</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff002"><sup>2</sup></xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<name name-style="western">
<surname>Madugula</surname> <given-names>Sasidhar</given-names></name>
<role content-type="http://credit.casrai.org/">Data curation</role>
<role content-type="http://credit.casrai.org/">Formal analysis</role>
<role content-type="http://credit.casrai.org/">Investigation</role>
<role content-type="http://credit.casrai.org/">Software</role>
<role content-type="http://credit.casrai.org/">Validation</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff002"><sup>2</sup></xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-7592-2195</contrib-id>
<name name-style="western">
<surname>Hottowy</surname> <given-names>Paweł</given-names></name>
<role content-type="http://credit.casrai.org/">Investigation</role>
<role content-type="http://credit.casrai.org/">Methodology</role>
<role content-type="http://credit.casrai.org/">Resources</role>
<role content-type="http://credit.casrai.org/">Software</role>
<xref ref-type="aff" rid="aff003"><sup>3</sup></xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<name name-style="western">
<surname>Litke</surname> <given-names>Alan</given-names></name>
<role content-type="http://credit.casrai.org/">Conceptualization</role>
<role content-type="http://credit.casrai.org/">Investigation</role>
<role content-type="http://credit.casrai.org/">Methodology</role>
<role content-type="http://credit.casrai.org/">Resources</role>
<role content-type="http://credit.casrai.org/">Software</role>
<xref ref-type="aff" rid="aff004"><sup>4</sup></xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<name name-style="western">
<surname>Cunningham</surname> <given-names>John</given-names></name>
<role content-type="http://credit.casrai.org/">Investigation</role>
<role content-type="http://credit.casrai.org/">Methodology</role>
<role content-type="http://credit.casrai.org/">Supervision</role>
<role content-type="http://credit.casrai.org/">Validation</role>
<role content-type="http://credit.casrai.org/">Writing – original draft</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff001"><sup>1</sup></xref>
<xref ref-type="aff" rid="aff005"><sup>5</sup></xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<name name-style="western">
<surname>Chichilnisky</surname> <given-names>E. J.</given-names></name>
<role content-type="http://credit.casrai.org/">Conceptualization</role>
<role content-type="http://credit.casrai.org/">Data curation</role>
<role content-type="http://credit.casrai.org/">Formal analysis</role>
<role content-type="http://credit.casrai.org/">Funding acquisition</role>
<role content-type="http://credit.casrai.org/">Investigation</role>
<role content-type="http://credit.casrai.org/">Methodology</role>
<role content-type="http://credit.casrai.org/">Project administration</role>
<role content-type="http://credit.casrai.org/">Resources</role>
<role content-type="http://credit.casrai.org/">Supervision</role>
<role content-type="http://credit.casrai.org/">Validation</role>
<role content-type="http://credit.casrai.org/">Writing – original draft</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff002"><sup>2</sup></xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<name name-style="western">
<surname>Paninski</surname> <given-names>Liam</given-names></name>
<role content-type="http://credit.casrai.org/">Conceptualization</role>
<role content-type="http://credit.casrai.org/">Formal analysis</role>
<role content-type="http://credit.casrai.org/">Funding acquisition</role>
<role content-type="http://credit.casrai.org/">Investigation</role>
<role content-type="http://credit.casrai.org/">Methodology</role>
<role content-type="http://credit.casrai.org/">Project administration</role>
<role content-type="http://credit.casrai.org/">Resources</role>
<role content-type="http://credit.casrai.org/">Supervision</role>
<role content-type="http://credit.casrai.org/">Validation</role>
<role content-type="http://credit.casrai.org/">Writing – original draft</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff001"><sup>1</sup></xref>
<xref ref-type="aff" rid="aff005"><sup>5</sup></xref>
</contrib>
</contrib-group>
<aff id="aff001">
<label>1</label>
<addr-line>Statistics Department, Columbia University, New York, New York, United States of America</addr-line>
</aff>
<aff id="aff002">
<label>2</label>
<addr-line>Department of Neurosurgery and Hansen Experimental Physics Laboratory, Stanford University, Stanford, California, United States of America</addr-line>
</aff>
<aff id="aff003">
<label>3</label>
<addr-line>Physics and Applied Computer Science, AGH University of Science and Technology, Krakow, Poland</addr-line>
</aff>
<aff id="aff004">
<label>4</label>
<addr-line>Santa Cruz Institute for Particle Physics, University of California, Santa Cruz, Santa Cruz, California, United States of America</addr-line>
</aff>
<aff id="aff005">
<label>5</label>
<addr-line>Grossman Center for the Statistics of Mind and Center for Theoretical Neuroscience, Columbia University, New York, New York, United States of America</addr-line>
</aff>
<contrib-group>
<contrib contrib-type="editor" xlink:type="simple">
<name name-style="western">
<surname>Hennig</surname> <given-names>Matthias H</given-names></name>
<role>Editor</role>
<xref ref-type="aff" rid="edit1"/>
</contrib>
</contrib-group>
<aff id="edit1">
<addr-line>University of Edinburgh, UNITED KINGDOM</addr-line>
</aff>
<author-notes>
<fn fn-type="conflict" id="coi001">
<p>The authors have declared that no competing interests exist.</p>
</fn>
<corresp id="cor001">* E-mail: <email xlink:type="simple">gem2131@columbia.edu</email></corresp>
</author-notes>
<pub-date pub-type="collection">
<month>11</month>
<year>2017</year>
</pub-date>
<pub-date pub-type="epub">
<day>13</day>
<month>11</month>
<year>2017</year>
</pub-date>
<volume>13</volume>
<issue>11</issue>
<elocation-id>e1005842</elocation-id>
<history>
<date date-type="received">
<day>2</day>
<month>12</month>
<year>2016</year>
</date>
<date date-type="accepted">
<day>20</day>
<month>10</month>
<year>2017</year>
</date>
</history>
<permissions>
<copyright-year>2017</copyright-year>
<copyright-holder>Mena et al</copyright-holder>
<license xlink:href="http://creativecommons.org/licenses/by/4.0/" xlink:type="simple">
<license-p>This is an open access article distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/" xlink:type="simple">Creative Commons Attribution License</ext-link>, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p>
</license>
</permissions>
<self-uri content-type="pdf" xlink:href="info:doi/10.1371/journal.pcbi.1005842"/>
<abstract>
<p>Simultaneous electrical stimulation and recording using multi-electrode arrays can provide a valuable technique for studying circuit connectivity and engineering neural interfaces. However, interpreting these measurements is challenging because the spike sorting process (identifying and segregating action potentials arising from different neurons) is greatly complicated by electrical stimulation artifacts across the array, which can exhibit complex and nonlinear waveforms, and overlap temporarily with evoked spikes. Here we develop a scalable algorithm based on a structured Gaussian Process model to estimate the artifact and identify evoked spikes. The effectiveness of our methods is demonstrated in both real and simulated 512-electrode recordings in the peripheral primate retina with single-electrode and several types of multi-electrode stimulation. We establish small error rates in the identification of evoked spikes, with a computational complexity that is compatible with real-time data analysis. This technology may be helpful in the design of future high-resolution sensory prostheses based on tailored stimulation (e.g., retinal prostheses), and for closed-loop neural stimulation at a much larger scale than currently possible.</p>
</abstract>
<abstract abstract-type="summary">
<title>Author summary</title>
<p>Simultaneous electrical stimulation and recording using multi-electrode arrays can provide a valuable technique for studying circuit connectivity and engineering neural interfaces. However, interpreting these recordings is challenging because the spike sorting process (identifying and segregating action potentials arising from different neurons) is largely stymied by electrical stimulation artifacts across the array, which are typically larger than the signals of interest. We develop a novel computational framework to estimate and subtract away this contaminating artifact, enabling the large-scale analysis of responses of possibly hundreds of cells to tailored stimulation. Importantly, we suggest that this technology may also be helpful for the development of future high-resolution neural prosthetic devices (e.g., retinal prostheses).</p>
</abstract>
<funding-group>
<funding-statement>LEG received funding from NIH Grant 1F32EY025120 (<ext-link ext-link-type="uri" xlink:href="https://www.nih.gov/" xlink:type="simple">https://www.nih.gov/</ext-link>). EJC received funding from NEI Grant EY021271 (<ext-link ext-link-type="uri" xlink:href="https://nei.nih.gov/funding" xlink:type="simple">https://nei.nih.gov/funding</ext-link>). LP received funding by NSF BIGDATA IIS 1546296 (<ext-link ext-link-type="uri" xlink:href="https://www.nsf.gov/" xlink:type="simple">https://www.nsf.gov/</ext-link>). JC received funding Sloan Foundation and the McKnight Foundation fellowships. PH: Polish National Science Centre grant DEC-2013/10/M/NZ4/00268 (PH), Website: <ext-link ext-link-type="uri" xlink:href="https://www.ncn.gov.pl/?language=en" xlink:type="simple">https://www.ncn.gov.pl/?language=en</ext-link>. The funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.</funding-statement>
</funding-group>
<counts>
<fig-count count="12"/>
<table-count count="1"/>
<page-count count="33"/>
</counts>
<custom-meta-group>
<custom-meta>
<meta-name>PLOS Publication Stage</meta-name>
<meta-value>vor-update-to-uncorrected-proof</meta-value>
</custom-meta>
<custom-meta>
<meta-name>Publication Update</meta-name>
<meta-value>2017-11-27</meta-value>
</custom-meta>
<custom-meta id="data-availability">
<meta-name>Data Availability</meta-name>
<meta-value>Code is available in this github repository: <ext-link ext-link-type="uri" xlink:href="https://github.com/gomena/spike_separation_artifacts" xlink:type="simple">https://github.com/gomena/spike_separation_artifacts</ext-link>. We have provided data that allows readers to reproduce all the essential results of the manuscript without an immense (e.g. 1 TB) download. The data consist of raw voltages recorded from 512 recording electrodes, obtained at 29 stimulation current levels x 55 time samples x 50 repeats, for a particular stimulating electrode. Along with these data we provide data from 24 neurons x 80 time samples x 512 electrodes that represent the template waveforms, for a total of 40 MB of data. Finally, we also provide the summary data from all figures and tables, in the manuscript and S1 Text.</meta-value>
</custom-meta>
</custom-meta-group>
</article-meta>
</front>
<body>
<disp-quote>
<p>This is a <italic>PLOS Computational Biology</italic> Methods paper.</p>
</disp-quote>
<sec id="sec001" sec-type="intro">
<title>Introduction</title>
<p>Simultaneous electrical stimulation and recording with multi-electrode arrays (MEAs) serves at least two important purposes for investigating neural circuits and for neural engineering. First, it enables the probing of neural circuits, leading to improved understanding of circuit anatomy and function [<xref ref-type="bibr" rid="pcbi.1005842.ref001">1</xref>–<xref ref-type="bibr" rid="pcbi.1005842.ref006">6</xref>]. Second, it can be used to assess and optimize the performance of brain-machine interfaces, such as retinal prostheses [<xref ref-type="bibr" rid="pcbi.1005842.ref007">7</xref>, <xref ref-type="bibr" rid="pcbi.1005842.ref008">8</xref>], by exploring the patterns of stimulation required to achieve particular patterns of neural activity. However, identifying neural activity in the presence of artifacts introduced by electrical stimulation is a major challenge, and automation is required to efficiently analyze recordings from large-scale MEAs. Furthermore, closed-loop experiments require the ability to assess neural responses to stimulation in real time to actively update the stimulus and probe the circuit, so the automated approach for identifying neural activity must be fast [<xref ref-type="bibr" rid="pcbi.1005842.ref009">9</xref>, <xref ref-type="bibr" rid="pcbi.1005842.ref010">10</xref>].</p>
<p>Spike sorting methods [<xref ref-type="bibr" rid="pcbi.1005842.ref011">11</xref>–<xref ref-type="bibr" rid="pcbi.1005842.ref013">13</xref>] allow identification of neurons from their spatio-temporal electrical footprints recorded on the MEA. However, these methods fail when used on data corrupted by stimulation artifacts. Although technological advances in stimulation circuitry have enabled recording with significantly reduced artifacts [<xref ref-type="bibr" rid="pcbi.1005842.ref014">14</xref>–<xref ref-type="bibr" rid="pcbi.1005842.ref018">18</xref>], identification of neural responses from artifact-corrupted recordings still presents a challenging task—even for human experts—since these artifacts can be much larger than spikes [<xref ref-type="bibr" rid="pcbi.1005842.ref019">19</xref>], overlap temporally with spikes, and occupy a similar temporal frequency band as spikes.</p>
<p>Although a number of approaches have been previously proposed to tackle this problem [<xref ref-type="bibr" rid="pcbi.1005842.ref020">20</xref>–<xref ref-type="bibr" rid="pcbi.1005842.ref023">23</xref>], there are two shortcomings we address here. First, previous approaches are based on restrictive assumptions on the frequency of spikes and their latency distribution (e.g, stimulation-elicited spikes have to occur at least 2ms following stimulus onset). Consequently, it becomes necessary to discard non-negligible portions of the recordings [<xref ref-type="bibr" rid="pcbi.1005842.ref019">19</xref>, <xref ref-type="bibr" rid="pcbi.1005842.ref024">24</xref>], leading to biased results that may miss the low-latency regimes where the most interesting neuronal dynamics occur [<xref ref-type="bibr" rid="pcbi.1005842.ref025">25</xref>, <xref ref-type="bibr" rid="pcbi.1005842.ref026">26</xref>]. Second, all of these methods have a local nature, i.e., they are based on electrode-wise estimates of the artifact that don’t exploit the shared spatio-temporal information present in MEAs. In general this leads to suboptimal performance. Therefore, a scalable computational infrastructure for spike sorting with stimulation artifacts in large-scale setups is necessary.</p>
<p>This paper presents a method to idesectionntify single-unit spike events in electrical stimulation and recording experiments using large-scale MEAs. We develop a modern, large-scale, principled framework for the analysis of neural voltage recordings that have been corrupted by stimulation artifacts. First, we model this highly structured artifact using a structured Gaussian Process (GP) to represent the observed variability across stimulation amplitudes and in the spatial and temporal dimensions measured on the MEA. Next, we introduce a spike detection algorithm that leverages the structure imposed in the GP to achieve a fast and scalable implementation. Importantly, our algorithm exploits many characteristics that make this problem tractable, allowing it to separate the contributions of artifact and neural activity to the observed data. For example, the artifact is smooth in certain dimensions, with spatial footprints that are different than those of spikes. Also, artifact variability is different than that of spikes: while the artifact does not substantially change if the same stimulus is repeated, responses of neurons in many stimulation regimes are stochastic, enhancing identifiability.</p>
<p>The effectiveness of our method is demonstrated by comparison on simulated data and against human-curated inferred spikes extracted from real data recorded in primate retina. Although some features of our method are context-dependent, we discuss extensions to other scenarios, stressing the generality of our approach.</p>
</sec>
<sec id="sec002" sec-type="materials|methods">
<title>Materials and methods</title>
<sec id="sec003">
<title>Ethics statement</title>
<p>All experiments were performed in accordance with IACUC guidelines for the care and use of animals. The research was approved on 2016-08-18 and the assurance number is A3213-01.</p>
</sec>
<sec id="sec004">
<title>Outline</title>
<p>In this section we develop a method for identifying neural activity in response to electrical stimulation. We assume access to voltage recordings <italic>Y</italic> (<italic>e</italic>, <italic>t</italic>, <italic>j</italic>, <italic>i</italic>) in a MEA with <italic>e</italic> = 1, …, <italic>E</italic> electrodes (here, <italic>E</italic> = 512), during <italic>t</italic> = 1, … <italic>T</italic> timepoints (e.g., <italic>T</italic> = 40, corresponding to 2 milliseconds for a 20Khz sampling rate) after the presentation of <italic>j</italic> = 1, …, <italic>J</italic> different stimuli, each of them being a current pulse of increasing amplitudes <italic>a</italic><sub><italic>j</italic></sub> (in other words, the <italic>a</italic><sub><italic>j</italic></sub> are magnification factors applied to an unitary pulse). For each of these stimuli <italic>n</italic><sub><italic>j</italic></sub> trials or repetitions are available; <italic>i</italic> indexes trials. Each recorded data segment is modeled as a sum of the true signal of interest <italic>s</italic> (neural spiking activity on that electrode), plus two types of noise.</p>
<p>The first noise source, <italic>A</italic>, is the large artifact that results from the electrical stimulation at a given electrode. This artifact has a well defined structure but its exact form in any given stimulus condition is not known <italic>a priori</italic> and must be estimated from the data and separated from occurrences of spikes. Although in typical experimental setups one will be concerned with data coming from many different stimulating electrodes, for clarity we start with the case of just a single stimulating electrode; we will generalize this below.</p>
<p>The second source of noise, <italic>ϵ</italic>, is additive spherical Gaussian observation noise; that is, <inline-formula id="pcbi.1005842.e001"><alternatives><graphic id="pcbi.1005842.e001g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e001" xlink:type="simple"/><mml:math display="inline" id="M1"><mml:mrow><mml:mi>ϵ</mml:mi> <mml:mo>∼</mml:mo> <mml:mi mathvariant="script">N</mml:mi> <mml:mo>(</mml:mo> <mml:mn>0</mml:mn> <mml:mo>,</mml:mo> <mml:msup><mml:mi>σ</mml:mi> <mml:mn>2</mml:mn></mml:msup> <mml:msub><mml:mi>I</mml:mi> <mml:msup><mml:mi>d</mml:mi> <mml:mo>′</mml:mo></mml:msup></mml:msub> <mml:mo>)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>, with <inline-formula id="pcbi.1005842.e002"><alternatives><graphic id="pcbi.1005842.e002g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e002" xlink:type="simple"/><mml:math display="inline" id="M2"><mml:mrow><mml:msup><mml:mi>d</mml:mi> <mml:mo>′</mml:mo></mml:msup> <mml:mo>=</mml:mo> <mml:mi>T</mml:mi> <mml:mo>×</mml:mo> <mml:mi>E</mml:mi> <mml:mo>×</mml:mo> <mml:msubsup><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>j</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:mi>J</mml:mi></mml:msubsup> <mml:mspace width="1pt"/><mml:msub><mml:mi>n</mml:mi> <mml:mi>j</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>. This assumption is rather restrictive and we assume it here for computational ease, but refer the reader to the discussion for a more general formulation that takes into account correlated noise.</p>
<p>Additionally, we assume that <italic>electrical images</italic> (EI) [<xref ref-type="bibr" rid="pcbi.1005842.ref027">27</xref>, <xref ref-type="bibr" rid="pcbi.1005842.ref028">28</xref>]—the spatio-temporal collection of action potential shapes on every electrode <italic>e</italic>—are available for all the <italic>N</italic> neurons under study. In detail, each of these EIs are estimates of the voltage deflections produced by a spike over the array in a time window of length <italic>T</italic>′. They are represented as matrices with dimensions <italic>E</italic> × <italic>T</italic>′ and can be obtained in the absence of electrical stimulation, using standard large-scale spike sorting methods (e.g. [<xref ref-type="bibr" rid="pcbi.1005842.ref012">12</xref>]). <xref ref-type="fig" rid="pcbi.1005842.g001">Fig 1</xref> shows examples of many EIs, or templates, obtained during a visual stimulation experiment.</p>
<fig id="pcbi.1005842.g001" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005842.g001</object-id>
<label>Fig 1</label>
<caption>
<title>Overlapping electrical images of 24 neurons (different colors) over the MEA, aligned to onset of spiking at <italic>t</italic> = 0.5<italic>ms</italic>.</title>
<p>Each trace represents the time course of voltage at a certain electrode. For each neuron, traces are only shown in the electrodes with a strong enough signal. Only a subset of neurons visible on the MEA are shown, for better visibility.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005842.g001" xlink:type="simple"/>
</fig>
<p>Finally, we assume the observed traces are the linear sum of neural activity, artifact, and other noise sources; that is:
<disp-formula id="pcbi.1005842.e003"><alternatives><graphic id="pcbi.1005842.e003g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e003" xlink:type="simple"/><mml:math display="block" id="M3"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>Y</mml:mi> <mml:mo>=</mml:mo> <mml:mi>A</mml:mi> <mml:mo>+</mml:mo> <mml:mi>s</mml:mi> <mml:mo>+</mml:mo> <mml:mi>ϵ</mml:mi> <mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(1)</label></disp-formula>
Similar linear decompositions have been recently utilized to tackle related neuroscience problems [<xref ref-type="bibr" rid="pcbi.1005842.ref012">12</xref>, <xref ref-type="bibr" rid="pcbi.1005842.ref029">29</xref>].</p>
<p><xref ref-type="fig" rid="pcbi.1005842.g002">Fig 2</xref> illustrates the difficulty of this problem: even if 1) for low-amplitude stimuli the artifact may not heavily corrupt the recorded traces and 2) the availability of several trials can enhance identifiability—as traces with spikes and no spikes naturally cluster into different groups—in the general case we will be concerned also with high amplitudes of stimulation. In these regimes, spikes could significantly overlap temporarily with the artifact, and occur with high probability and almost deterministically, i.e., with low latency variability. For example, in the rightmost columns of <xref ref-type="fig" rid="pcbi.1005842.g002">Fig 2</xref>, spike identification is not straightforward since all the traces look alike, and the shape of a typical trace does not necessarily suggest the presence of neural activity. There, inference of neural activity is only possible given a reasonable estimate of the artifact: for instance, under the assumption that the artifact is a smooth function of the stimulus strength, one can make a good initial guess of the artifact by considering the artifact at a lower stimulation amplitude, where spike identification is relatively easier.</p>
<fig id="pcbi.1005842.g002" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005842.g002</object-id>
<label>Fig 2</label>
<caption>
<title>Visual inspection of traces reveals the difficulty of the problem.</title>
<p>First column: templates of spiking neurons. Second to fourth columns: responses of one (<bold>A</bold>) or two (<bold>B</bold>) cells to electrical stimulation at increasing stimulation amplitudes as recorded in the stimulating electrode (first rows) or a neighboring, non-stimulating electrode (third rows). If the stimulation artifact is known (gray traces) it can be subtracted from raw traces to produce a baseline (second and fourth rows) amenable for template matching: traces with spike(s) (colored) match, on each electrode, either a translation of a template (<bold>A</bold> and <bold>B</bold>) or the sum of different translations of two or more templates (<bold>B</bold>). As reflected by the activation curves (fifth column) for strong enough stimuli spiking occurs with probability close to one, consistent with the absence of black traces in the rightmost columns.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005842.g002" xlink:type="simple"/>
</fig>
<p>Therefore, a solution to this problem will rely on a method for an appropriate separation of neural activity and artifact, which in turn requires the use of sensible models that properly capture the structure of the latter; that is, how it varies along the different relevant dimensions. In the following we develop such a method, and divide its exposition in five parts. We start by describing how to model neural activity. Second, we describe the structure of the stimulation artifacts. Third, we propose a GP model to represent this structure. Fourth, we introduce a scalable algorithm that produces an estimate of <italic>A</italic> and <italic>s</italic> given recordings <italic>Y</italic>. Finally, we provide a simplified version of our method and extend it to address multi-electrode stimulation scenarios.</p>
</sec>
<sec id="sec005">
<title>Modeling neural activity</title>
<p>We assume that <italic>s</italic> is the linear superposition of the activities <italic>s</italic><sup><italic>n</italic></sup> of the <italic>N</italic> neurons involved, i.e. <inline-formula id="pcbi.1005842.e004"><alternatives><graphic id="pcbi.1005842.e004g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e004" xlink:type="simple"/><mml:math display="inline" id="M4"><mml:mrow><mml:mi>s</mml:mi> <mml:mo>=</mml:mo> <mml:msubsup><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>n</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:mi>N</mml:mi></mml:msubsup> <mml:mspace width="1pt"/><mml:msup><mml:mi>s</mml:mi> <mml:mi>n</mml:mi></mml:msup></mml:mrow></mml:math></alternatives></inline-formula>. Furthermore, each of these activities is expressed in terms of the binary vectors <italic>b</italic><sup><italic>n</italic></sup> that indicate spike occurrence and timing: specifically, if <inline-formula id="pcbi.1005842.e005"><alternatives><graphic id="pcbi.1005842.e005g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e005" xlink:type="simple"/><mml:math display="inline" id="M5"><mml:msubsup><mml:mi>s</mml:mi> <mml:mrow><mml:mi>j</mml:mi> <mml:mo>,</mml:mo> <mml:mi>i</mml:mi></mml:mrow> <mml:mi>n</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> is the neural activity of neuron <italic>n</italic> at trial <italic>i</italic> of the <italic>j</italic>-th stimulation amplitude, we write <inline-formula id="pcbi.1005842.e006"><alternatives><graphic id="pcbi.1005842.e006g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e006" xlink:type="simple"/><mml:math display="inline" id="M6"><mml:mrow><mml:msubsup><mml:mi>s</mml:mi> <mml:mrow><mml:mi>j</mml:mi> <mml:mo>,</mml:mo> <mml:mi>i</mml:mi></mml:mrow> <mml:mi>n</mml:mi></mml:msubsup> <mml:mo>=</mml:mo> <mml:msup><mml:mi>M</mml:mi> <mml:mi>n</mml:mi></mml:msup> <mml:msubsup><mml:mi>b</mml:mi> <mml:mrow><mml:mi>j</mml:mi> <mml:mo>,</mml:mo> <mml:mi>i</mml:mi></mml:mrow> <mml:mi>n</mml:mi></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula>, where <italic>M</italic><sup><italic>n</italic></sup> is a matrix that contains on each row a copy of the EI of neuron <italic>n</italic> (vectorizing over different electrodes) aligned to spiking occurring at different times. Notice that this binary representation immediately entails that: 1) on each trial each neuron fires at most once (this will be the case if we choose analysis time windows that are shorter than the refractory period) and 2) that spikes can only occur over a discrete set of times (a strict subset of the entire recording window), which here corresponds to all the time samples between 0.25 ms and 1.5 ms. We refer the reader to [<xref ref-type="bibr" rid="pcbi.1005842.ref030">30</xref>] for details on how to relax this simplifying assumption.</p>
</sec>
<sec id="sec006">
<title>Stimulation artifacts</title>
<p>Electrical stimulation experiments where neural responses are inhibited (e.g., using the neurotoxin TTX) provide qualitative insights about the structure of the stimulation artifact <italic>A</italic>(<italic>e</italic>, <italic>t</italic>, <italic>j</italic>, <italic>i</italic>) (<xref ref-type="fig" rid="pcbi.1005842.g003">Fig 3</xref>); that is, how it varies as a function of all the relevant covariates: space (represented by electrode, <italic>e</italic>), time <italic>t</italic>, amplitude of stimulus <italic>a</italic><sub><italic>j</italic></sub>, and stimulus repetition <italic>i</italic>. Repeating the same stimulation leads to the same artifact, up to small random fluctuations, and so by averaging several trials these fluctuations can be reduced, and we can conceive the artifact as a stack of movies <italic>A</italic>(<italic>e</italic>, <italic>t</italic>, <italic>j</italic>), one for each amplitude of stimulation <italic>a</italic><sub><italic>j</italic></sub>.</p>
<fig id="pcbi.1005842.g003" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005842.g003</object-id>
<label>Fig 3</label>
<caption>
<title>Properties of the electrical stimulation artifact revealed by TTX experiments.</title>
<p>(<bold>A</bold>) local, electrode-wise properties of the stimulation artifacts. Overall, magnitude of the artifact increases with stimulation strength (different shades of blue). However, unlike non-stimulating electrodes, where artifacts have a typical shape of a bump around 0.5 ms (fourth column), the case of the stimulating electrode is more complex: besides the apparent increase in artifact strength, the shape itself is not a simple function of stimulating electrode (first and second rows). Also, for a given stimulating electrode the shape of the artifact is a complex function of the stimulation strength, changing smoothly only within certain stimulation ranges: here, responses to the entire stimulation range are divided into three ranges (first, second, and third column) and although traces within each range look alike, traces from different ranges cannot be guessed from other ranges. (<bold>B</bold>) stimulation artifacts in a neighborhood of the stimulating electrode, at two different stimulus strengths (left and right). Each trace represents the time course of voltage at a certain electrode. Notice that stimulating electrode (blue) and non-stimulating electrodes (light blue) are plotted in different scales.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005842.g003" xlink:type="simple"/>
</fig>
<p>We treat the stimulating and non-stimulating electrodes separately because of their observed different qualitative properties.</p>
<sec id="sec007">
<title>Stimulating electrode</title>
<p>Modeling the artifact in the stimulating electrode requires special care because it is this electrode that typically will capture the strongest neural signal in attempts to directly activate a soma (e.g. <xref ref-type="fig" rid="pcbi.1005842.g003">Fig 3</xref>). The artifact is more complex in the stimulating electrode [<xref ref-type="bibr" rid="pcbi.1005842.ref016">16</xref>] and has the following properties here: 1) its magnitude is much greater than that of the non-stimulating electrodes; 2) its effect persists at least 2 ms after the onset of the stimulus; and 3) it is a piece-wise smooth, continuous function of the stimulus strength (<xref ref-type="fig" rid="pcbi.1005842.g003">Fig 3A</xref>). Discontinuities occur at a pre-defined set of stimulus amplitudes, the “breakpoints” (known beforehand), resulting from gain settings in the stimulation hardware that must change in order to apply stimuli of different magnitude ranges [<xref ref-type="bibr" rid="pcbi.1005842.ref016">16</xref>]. Notice that these discontinuities are a rather technical and context-dependent feature that may not necessarily apply to all stimulation systems, unlike the rest of the properties described here.</p>
</sec>
<sec id="sec008">
<title>Non-stimulating electrodes</title>
<p>The artifact here is much more regular and of lower magnitude, and has the following properties (see <xref ref-type="fig" rid="pcbi.1005842.g003">Fig 3</xref>): 1) its magnitude peaks around .4<italic>ms</italic> following the stimulus onset, and then rapidly stabilizes; 2) the artifact magnitude typically decays with distance from the stimulating electrode; 3) the magnitude of the artifact increases with increasing stimulus strength.</p>
<p>Based on these observations, we develop a general framework for artifact modeling based on Gaussian processes.</p>
</sec>
</sec>
<sec id="sec009">
<title>A structured Gaussian process model for stimulation artifacts</title>
<p>From the above discussion we conclude that the artifact is highly non-linear (on each coordinate), non-stationary (i.e., the variability depends on the value of each coordinate), but structured. The Gaussian process (GP) framework [<xref ref-type="bibr" rid="pcbi.1005842.ref031">31</xref>] provides powerful and computationally scalable methods for modeling non-linear functions given noisy measurements, and leads to a straightforward implementation of all the usual operations that are relevant for our purposes (e.g. extrapolation and filtering) in terms of some tractable conditional Gaussian distributions.</p>
<p>To better understand the rationale guiding the choice of GPs, consider first a simple Bayesian regression model for the artifact as a noisy linear combination of <italic>B</italic> basis functions Φ<sub><italic>b</italic></sub>(<italic>e</italic>, <italic>t</italic>, <italic>j</italic>) (e.g. polynomials); that is, <inline-formula id="pcbi.1005842.e007"><alternatives><graphic id="pcbi.1005842.e007g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e007" xlink:type="simple"/><mml:math display="inline" id="M7"><mml:mrow><mml:mi>A</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>e</mml:mi> <mml:mo>,</mml:mo> <mml:mi>t</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:msubsup><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>b</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:mi>B</mml:mi></mml:msubsup> <mml:mspace width="1pt"/><mml:msub><mml:mi>w</mml:mi> <mml:mi>b</mml:mi></mml:msub> <mml:msub><mml:mo>Φ</mml:mo> <mml:mi>b</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>e</mml:mi> <mml:mo>,</mml:mo> <mml:mi>t</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>+</mml:mo> <mml:mi>ϵ</mml:mi></mml:mrow></mml:math></alternatives></inline-formula>, with a regularizing prior <italic>p</italic>(<italic>w</italic>) on the weights. If <italic>p</italic>(<italic>w</italic>) and <italic>ϵ</italic> are modeled as Gaussian, and if we consider the collection of <italic>A</italic>(<italic>e</italic>, <italic>t</italic>, <italic>j</italic>) values (over all electrodes <italic>e</italic>, timesteps <italic>t</italic>, and stimulus amplitude indices <italic>j</italic>) as one large vector <italic>A</italic>, then this translates into an assumption that the vector <italic>A</italic> is drawn from a high-dimensional Gaussian distribution. The prior mean <italic>μ</italic> and covariance <italic>K</italic> of <italic>A</italic> can easily be computed in terms of Φ and <italic>p</italic>(<italic>w</italic>). Importantly, this simple model provides us with tools to estimate the posterior distribution of <italic>A</italic> given partial noisy observations (for example, we could estimate the posterior of <italic>A</italic> at a certain electrode if we are given its values on the rest of the array). Since <italic>A</italic> in this model is a stochastic process (indexed by <italic>e</italic>, <italic>t</italic>, and <italic>j</italic>) with a Gaussian distribution, we say that <italic>A</italic> is modeled as a Gaussian process, and write <inline-formula id="pcbi.1005842.e008"><alternatives><graphic id="pcbi.1005842.e008g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e008" xlink:type="simple"/><mml:math display="inline" id="M8"><mml:mrow><mml:mi>A</mml:mi> <mml:mo>∼</mml:mo> <mml:mtext mathvariant="script">GP</mml:mtext> <mml:mo>(</mml:mo> <mml:mi>μ</mml:mi> <mml:mo>,</mml:mo> <mml:mi>K</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>.</p>
<p>The main problem with the approach sketched above is that one has to solve some challenging model selection problems: what basis functions Φ<sub><italic>i</italic></sub> should we choose, how large should <italic>M</italic> be, what parameters should we use for the prior <italic>p</italic>(<italic>w</italic>), and so on. We can avoid these issues by instead directly specifying the covariance <italic>K</italic> and mean <italic>μ</italic> (instead of specifying <italic>K</italic> and <italic>μ</italic> indirectly, through <italic>p</italic>(<italic>w</italic>), Φ, etc.).</p>
<p>The parameter <italic>μ</italic> informs us about the mean behavior of the samples from the GP (here, the average values of the artifact). Briefly, we estimate <inline-formula id="pcbi.1005842.e009"><alternatives><graphic id="pcbi.1005842.e009g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e009" xlink:type="simple"/><mml:math display="inline" id="M9"><mml:mover accent="true"><mml:mi>μ</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> by taking the mean of the recordings at the lowest stimulation amplitude and then subtract off that value from all the traces, so that <italic>μ</italic> can be assumed to be zero in the following. We refer the reader to <xref ref-type="supplementary-material" rid="pcbi.1005842.s001">S1 Text</xref> and <xref ref-type="supplementary-material" rid="pcbi.1005842.s003">S1 Fig</xref> for details, and stress that all the figures shown in the main text are made after applying this mean-subtraction pre-processing operation.</p>
<p>Next we need to specify <italic>K</italic>. This “kernel” can be thought of as a square matrix of size dim(<italic>A</italic>) × dim(<italic>A</italic>), where dim(<italic>A</italic>) is as large as <italic>T</italic> × <italic>E</italic> × <italic>J</italic> ∼ 10<sup>6</sup> in our context. This number is large enough so all elementary operations (e.g. kernel inversion) are prohibitively slow unless further structure is imposed on <italic>K</italic>—indeed, we need to avoid even storing <italic>K</italic> in memory, and estimating such a high-dimensional object is impossible without some kind of strong regularization. Thus, instead of specifying every single entry of <italic>K</italic> we need to exploit a simpler, lower-dimensional model that is flexible enough to enforce the qualitative structure on <italic>A</italic> that we described in the preceding section.</p>
<p>Specifically, we impose a separable Kronecker product structure on <italic>K</italic>, leading to tractable and scalable inferences [<xref ref-type="bibr" rid="pcbi.1005842.ref032">32</xref>, <xref ref-type="bibr" rid="pcbi.1005842.ref033">33</xref>]. This Kronecker product is defined for any two matrices as (<italic>A</italic> ⊗ <italic>B</italic>)<sub>((<italic>i</italic><sub>1</sub>,<italic>i</italic><sub>2</sub>),(<italic>j</italic><sub>1</sub>,<italic>j</italic><sub>2</sub>))</sub> = <italic>A</italic><sub>(<italic>i</italic><sub>1</sub>,<italic>j</italic><sub>1</sub>)</sub> <italic>B</italic><sub>(<italic>i</italic><sub>2</sub>,<italic>j</italic><sub>2</sub>)</sub>. The key point is that this Kronecker structure allows us to break the huge matrix <italic>K</italic> into smaller, more tractable pieces whose properties can be easily specified and matched to the observed data. The result is a much lower-dimensional representation of <italic>K</italic> that serves to strongly regularize our estimate of this very high-dimensional object. In <xref ref-type="supplementary-material" rid="pcbi.1005842.s002">S2 Text</xref> we review the main operations from [<xref ref-type="bibr" rid="pcbi.1005842.ref034">34</xref>] that enable computational speed-ups due to this Kronecker product representation</p>
<p>We state separate Kronecker decompositions for the non-stimulating and stimulating electrodes. For the non-stimulating electrode we assume the following decomposition:
<disp-formula id="pcbi.1005842.e010"><alternatives><graphic id="pcbi.1005842.e010g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e010" xlink:type="simple"/><mml:math display="block" id="M10"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>K</mml:mi> <mml:mo>=</mml:mo> <mml:mi>ρ</mml:mi> <mml:msub><mml:mi>K</mml:mi> <mml:mi>t</mml:mi></mml:msub> <mml:mo>⊗</mml:mo> <mml:msub><mml:mi>K</mml:mi> <mml:mi>e</mml:mi></mml:msub> <mml:mo>⊗</mml:mo> <mml:msub><mml:mi>K</mml:mi> <mml:mi>s</mml:mi></mml:msub> <mml:mo>+</mml:mo> <mml:msup><mml:mi>ϕ</mml:mi> <mml:mn>2</mml:mn></mml:msup> <mml:msub><mml:mi>I</mml:mi> <mml:mrow><mml:mi>T</mml:mi> <mml:mo>×</mml:mo> <mml:mi>E</mml:mi> <mml:mo>×</mml:mo> <mml:mi>J</mml:mi></mml:mrow></mml:msub> <mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(2)</label></disp-formula>
where <italic>K</italic><sub><italic>t</italic></sub>, <italic>K</italic><sub><italic>e</italic></sub>, and <italic>K</italic><sub><italic>s</italic></sub> are the kernels that account for variations in the time, space, and stimulus magnitude dimensions of the data, respectively. One way to think about the Kronecker product <italic>K</italic><sub><italic>t</italic></sub> ⊗ <italic>K</italic><sub><italic>e</italic></sub> ⊗ <italic>K</italic><sub><italic>s</italic></sub> is as follows: to draw a sample from a GP with mean zero and covariance <italic>K</italic><sub><italic>t</italic></sub> ⊗ <italic>K</italic><sub><italic>e</italic></sub> ⊗ <italic>K</italic><sub><italic>s</italic></sub>, start with an array <italic>z</italic>(<italic>t</italic>, <italic>e</italic>, <italic>s</italic>) filled with independent standard normal random variables, then apply independent linear filters in each direction <italic>t</italic>, <italic>e</italic>, and <italic>s</italic> so that the marginal covariances in each direction correspond to <italic>K</italic><sub><italic>t</italic></sub>, <italic>K</italic><sub><italic>e</italic></sub>, and <italic>K</italic><sub><italic>s</italic></sub>, respectively. The dimensionless quantity <italic>ρ</italic> is used to control the overall magnitude of variability and the scaled identity matrix <italic>ϕ</italic><sup>2</sup><italic>I</italic><sub>dim(<italic>A</italic>)</sub> is included to allow for slight unstructured deviations from the Kronecker structure. Notice that we distinguish between this extra prior variance <italic>ϕ</italic><sup>2</sup> and the observation noise variance <italic>σ</italic><sup>2</sup>, associated with the error term <italic>ϵ</italic> of <xref ref-type="disp-formula" rid="pcbi.1005842.e003">Eq 1</xref>.</p>
<p>Likewise, for the stimulating electrode we consider the kernel:
<disp-formula id="pcbi.1005842.e011"><alternatives><graphic id="pcbi.1005842.e011g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e011" xlink:type="simple"/><mml:math display="block" id="M11"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msup><mml:mi>K</mml:mi> <mml:mo>′</mml:mo></mml:msup> <mml:mo>=</mml:mo> <mml:munderover><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>r</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:mi>R</mml:mi></mml:munderover> <mml:mspace width="1pt"/><mml:msup><mml:mi>ρ</mml:mi> <mml:mi>r</mml:mi></mml:msup> <mml:msubsup><mml:mi>K</mml:mi> <mml:mi>t</mml:mi> <mml:mi>r</mml:mi></mml:msubsup> <mml:mo>⊗</mml:mo> <mml:msubsup><mml:mi>K</mml:mi> <mml:mi>s</mml:mi> <mml:mi>r</mml:mi></mml:msubsup> <mml:mo>+</mml:mo> <mml:msup><mml:mi>ϕ</mml:mi> <mml:mrow><mml:mo>′</mml:mo> <mml:mn>2</mml:mn></mml:mrow></mml:msup> <mml:msub><mml:mi>I</mml:mi> <mml:mrow><mml:mi>T</mml:mi> <mml:mo>×</mml:mo> <mml:mi>J</mml:mi></mml:mrow></mml:msub> <mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(3)</label></disp-formula></p>
<p>Here, the sum goes over the stimulation ranges defined by consecutive breakpoints; and for each of those ranges, the kernel <inline-formula id="pcbi.1005842.e012"><alternatives><graphic id="pcbi.1005842.e012g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e012" xlink:type="simple"/><mml:math display="inline" id="M12"><mml:msubsup><mml:mi>K</mml:mi> <mml:mi>s</mml:mi> <mml:mi>r</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> has non-zero off-diagonal entries only for the stimulation values within the <italic>r</italic>-th range between breakpoints. In this way, we ensure artifact information is not shared for stimulus amplitudes across breakpoints. Finally, <italic>ρ</italic>′ and <italic>ϕ</italic>′ play a similar role as in <xref ref-type="disp-formula" rid="pcbi.1005842.e010">Eq 2</xref>.</p>
<p>Now that this structured kernel has been stated it remains to specify parametric families for the elementary kernels <italic>K</italic><sub><italic>t</italic></sub>, <italic>K</italic><sub><italic>e</italic></sub>, <italic>K</italic><sub><italic>s</italic></sub>, <inline-formula id="pcbi.1005842.e013"><alternatives><graphic id="pcbi.1005842.e013g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e013" xlink:type="simple"/><mml:math display="inline" id="M13"><mml:mrow><mml:msubsup><mml:mi>K</mml:mi> <mml:mi>t</mml:mi> <mml:mi>r</mml:mi></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula>, <inline-formula id="pcbi.1005842.e014"><alternatives><graphic id="pcbi.1005842.e014g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e014" xlink:type="simple"/><mml:math display="inline" id="M14"><mml:mrow><mml:msubsup><mml:mi>K</mml:mi> <mml:mi>s</mml:mi> <mml:mi>r</mml:mi></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula>. We construct these from the Matérn family, using extra parameters to account for the behaviors described in Stimulation artifacts.</p>
<sec id="sec010">
<title>A non-stationary family of kernels</title>
<p>We consider the Matérn(3/2) kernel, the continuous version of an autoregressive process of order 2. Its (stationary) covariance is given by
<disp-formula id="pcbi.1005842.e015"><alternatives><graphic id="pcbi.1005842.e015g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e015" xlink:type="simple"/><mml:math display="block" id="M15"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>K</mml:mi> <mml:mo>λ</mml:mo></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>x</mml:mi> <mml:mn>1</mml:mn></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>x</mml:mi> <mml:mn>2</mml:mn></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:msub><mml:mi>K</mml:mi> <mml:mo>λ</mml:mo></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>δ</mml:mi> <mml:mo>=</mml:mo> <mml:mo>|</mml:mo></mml:mrow> <mml:msub><mml:mi>x</mml:mi> <mml:mn>1</mml:mn></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mi>x</mml:mi> <mml:mn>2</mml:mn></mml:msub> <mml:mrow><mml:mo>|</mml:mo> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:mo>(</mml:mo> <mml:mn>1</mml:mn> <mml:mo>+</mml:mo> <mml:msqrt><mml:mn>3</mml:mn></mml:msqrt> <mml:mi>δ</mml:mi> <mml:mo>λ</mml:mo> <mml:mo>)</mml:mo> <mml:mo form="prefix">exp</mml:mo> <mml:mo>(</mml:mo> <mml:mo>-</mml:mo> <mml:msqrt><mml:mn>3</mml:mn></mml:msqrt> <mml:mi>δ</mml:mi> <mml:mo>λ</mml:mo> <mml:mo>)</mml:mo> <mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(4)</label></disp-formula>
The parameter λ &gt; 0 represents the (inverse) length-scale and determines how fast correlations decay with distance. We use this kernel as a device for representing smoothness; that is, the property that information is shared across a certain dimension (e.g. time). This property is key to induce reasonable extrapolation and filtering estimators, as required by our method. Naturally, given our rationale for choosing this kernel, similar results should be expected if the Matérn(3/2) was replaced by a similar, stationary smoothing kernel.</p>
<p>We induce non-stationarities by considering the family of unnormalized gamma densities <italic>d</italic><sub><italic>α</italic>,<italic>β</italic></sub>(⋅):
<disp-formula id="pcbi.1005842.e016"><alternatives><graphic id="pcbi.1005842.e016g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e016" xlink:type="simple"/><mml:math display="block" id="M16"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>d</mml:mi> <mml:mrow><mml:mi>α</mml:mi> <mml:mo>,</mml:mo> <mml:mi>β</mml:mi></mml:mrow></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:mo form="prefix">exp</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:mo>-</mml:mo> <mml:mi>x</mml:mi> <mml:mi>β</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:msup><mml:mi>x</mml:mi> <mml:mi>α</mml:mi></mml:msup> <mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(5)</label></disp-formula>
By an appropriate choice of the pair (<italic>α</italic>, <italic>β</italic>) &gt; 0 we aim to expressively represent non-stationary ‘bumps’ in variability. The functions <italic>d</italic><sub><italic>α</italic>,<italic>β</italic></sub>(⋅) are then used to create a family of non-stationary kernels through the process <italic>Z</italic><sub><italic>α</italic>,<italic>β</italic></sub> ≡ <italic>Z</italic><sub><italic>α</italic>,<italic>β</italic></sub>(<italic>x</italic>) = <italic>d</italic><sub><italic>α</italic>,<italic>β</italic></sub>(<italic>x</italic>)<italic>Y</italic>(<italic>x</italic>) where <italic>Y</italic> ∼ <italic>GP</italic>(0, <italic>K</italic><sub>λ</sub>). Thus <italic>Y</italic> here is a smooth stationary process and <italic>d</italic> serves to modulate the amplitude of <italic>Y</italic>. <italic>Z</italic><sub><italic>α</italic>,<italic>β</italic></sub> is a <italic>bona fide</italic> GP [<xref ref-type="bibr" rid="pcbi.1005842.ref035">35</xref>] with the following covariance matrix (<italic>D</italic><sub><italic>α</italic>,<italic>β</italic></sub> is a diagonal matrix with entries <italic>d</italic><sub><italic>α</italic>,<italic>β</italic></sub>(⋅)):
<disp-formula id="pcbi.1005842.e017"><alternatives><graphic id="pcbi.1005842.e017g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e017" xlink:type="simple"/><mml:math display="block" id="M17"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>K</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mo>λ</mml:mo> <mml:mo>,</mml:mo> <mml:mi>α</mml:mi> <mml:mo>,</mml:mo> <mml:mi>β</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:msub><mml:mi>D</mml:mi> <mml:mrow><mml:mi>α</mml:mi> <mml:mo>,</mml:mo> <mml:mi>β</mml:mi></mml:mrow></mml:msub> <mml:msub><mml:mi>K</mml:mi> <mml:mo>λ</mml:mo></mml:msub> <mml:msub><mml:mi>D</mml:mi> <mml:mrow><mml:mi>α</mml:mi> <mml:mo>,</mml:mo> <mml:mi>β</mml:mi></mml:mrow></mml:msub> <mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(6)</label></disp-formula></p>
<p>For the non-stimulating electrodes, we choose all three kernels <italic>K</italic><sub><italic>t</italic></sub>, <italic>K</italic><sub><italic>e</italic></sub>, <italic>K</italic><sub><italic>s</italic></sub> as <italic>K</italic>(λ, <italic>α</italic>, <italic>β</italic>) in <xref ref-type="disp-formula" rid="pcbi.1005842.e017">Eq 6</xref>, with separate parameters λ, <italic>α</italic>, <italic>β</italic> for each. For the time kernels we use time and <italic>t</italic> as the relevant covariate (<italic>δ</italic> in <xref ref-type="disp-formula" rid="pcbi.1005842.e015">Eq 4</xref> and <italic>x</italic> in <xref ref-type="disp-formula" rid="pcbi.1005842.e016">Eq 5</xref>). The case of the spatial kernel is more involved: although we want to impose spatial smoothness, we also need to express the non-stationarities that depend on the distance between any electrode and the stimulating electrode. We do so by making <italic>δ</italic> represent the distance between recording electrodes, and <italic>x</italic> represent the distance between stimulating and recording electrodes. Finally, for the stimulus kernel we take stimulus strength <italic>a</italic><sub><italic>j</italic></sub> as the covariate but we only model smoothness through the Matérn kernel and not localization (i.e. <italic>α</italic>, <italic>β</italic> = 0).</p>
<p>Finally, for the stimulating electrode we use the same method for constructing the kernels <inline-formula id="pcbi.1005842.e018"><alternatives><graphic id="pcbi.1005842.e018g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e018" xlink:type="simple"/><mml:math display="inline" id="M18"><mml:mrow><mml:msubsup><mml:mi>K</mml:mi> <mml:mi>t</mml:mi> <mml:mi>r</mml:mi></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula>, <inline-formula id="pcbi.1005842.e019"><alternatives><graphic id="pcbi.1005842.e019g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e019" xlink:type="simple"/><mml:math display="inline" id="M19"><mml:mrow><mml:msubsup><mml:mi>K</mml:mi> <mml:mi>s</mml:mi> <mml:mi>r</mml:mi></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula> on each range between breakpoints. We provide a notational summary in <xref ref-type="table" rid="pcbi.1005842.t001">Table 1</xref>.</p>
<table-wrap id="pcbi.1005842.t001" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005842.t001</object-id>
<label>Table 1</label>
<caption>
<title>Summary of relevant notation.</title>
</caption>
<alternatives>
<graphic id="pcbi.1005842.t001g" mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005842.t001" xlink:type="simple"/>
<table border="0" frame="box" rules="all">
<colgroup>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
</colgroup>
<thead>
<tr>
<th align="left">Notation</th>
<th align="left">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><italic>Y</italic>, <italic>A</italic>, <italic>s</italic></td>
<td align="left">traces, artifact and neural activity, respectively.</td>
</tr>
<tr>
<td align="left">
<inline-formula id="pcbi.1005842.e020">
<alternatives>
<graphic id="pcbi.1005842.e020g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e020" xlink:type="simple"/>
<mml:math display="inline" id="M20">
<mml:mrow>
<mml:mover accent="true">
<mml:mi>A</mml:mi>
<mml:mo>^</mml:mo>
</mml:mover>
</mml:mrow>
</mml:math>
</alternatives>
</inline-formula>,
<inline-formula id="pcbi.1005842.e021">
<alternatives>
<graphic id="pcbi.1005842.e021g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e021" xlink:type="simple"/>
<mml:math display="inline" id="M21">
<mml:mrow>
<mml:mover accent="true">
<mml:mi>s</mml:mi>
<mml:mo>^</mml:mo>
</mml:mover>
</mml:mrow>
</mml:math>
</alternatives>
</inline-formula>
</td>
<td align="left">inferred artifact and neural activity.</td>
</tr>
<tr>
<td align="left"><italic>t</italic>, <italic>j</italic>, <italic>i</italic>, <italic>e</italic></td>
<td align="left">time sample, stimulus index, trial index, electrode index.</td>
</tr>
<tr>
<td align="left"><italic>T</italic>, <italic>J</italic>, <italic>n</italic><sub><italic>j</italic></sub>, <italic>E</italic></td>
<td align="left">number of time samples per recording, number of stimuli, amount of trials per stimulus, number of electrodes in array.</td>
</tr>
<tr>
<td align="left">
<inline-formula id="pcbi.1005842.e022">
<alternatives>
<graphic id="pcbi.1005842.e022g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e022" xlink:type="simple"/>
<mml:math display="inline" id="M22">
<mml:msubsup>
<mml:mi>b</mml:mi>
<mml:mrow>
<mml:mi>j</mml:mi>
<mml:mo>,</mml:mo>
<mml:mi>i</mml:mi>
</mml:mrow>
<mml:mi>n</mml:mi>
</mml:msubsup>
</mml:math>
</alternatives>
</inline-formula>
</td>
<td align="left">Binary timing vector of spike of neuron <italic>n</italic>, at trial <italic>i</italic> of <italic>j</italic>-th stimulus.</td>
</tr>
<tr>
<td align="left">
<inline-formula id="pcbi.1005842.e023">
<alternatives>
<graphic id="pcbi.1005842.e023g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e023" xlink:type="simple"/>
<mml:math display="inline" id="M23">
<mml:msubsup>
<mml:mi>s</mml:mi>
<mml:mrow>
<mml:mi>j</mml:mi>
<mml:mo>,</mml:mo>
<mml:mi>i</mml:mi>
</mml:mrow>
<mml:mi>n</mml:mi>
</mml:msubsup>
</mml:math>
</alternatives>
</inline-formula>
</td>
<td align="left">Action potential (if any) of neuron <italic>n</italic> at trial <italic>i</italic> of <italic>j</italic>-th stimulus.</td>
</tr>
<tr>
<td align="left"><italic>M</italic><sup><italic>n</italic></sup></td>
<td align="left">matrix containing action potentials of neuron <italic>n</italic>, aligned to spiking onset at different times as rows.</td>
</tr>
<tr>
<td align="left"><italic>K</italic><sub>λ</sub></td>
<td align="left">Matérn(3/2) kernel with inverse length-scale parameter λ.</td>
</tr>
<tr>
<td align="left"><italic>K</italic>, <italic>K</italic>′</td>
<td align="left">Non-stimulating and stimulating electrodes kernels.</td>
</tr>
<tr>
<td align="left"><italic>K</italic><sub><italic>t</italic></sub>, <italic>K</italic><sub><italic>e</italic></sub>, <italic>K</italic><sub><italic>s</italic></sub></td>
<td align="left">time, electrode (space) and stimulus kernels (non-stimulating electrodes).</td>
</tr>
<tr>
<td align="left">
<inline-formula id="pcbi.1005842.e024">
<alternatives>
<graphic id="pcbi.1005842.e024g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e024" xlink:type="simple"/>
<mml:math display="inline" id="M24">
<mml:mrow>
<mml:msubsup>
<mml:mi>K</mml:mi>
<mml:mi>t</mml:mi>
<mml:mi>r</mml:mi>
</mml:msubsup>
</mml:mrow>
</mml:math>
</alternatives>
</inline-formula>,
<inline-formula id="pcbi.1005842.e025">
<alternatives>
<graphic id="pcbi.1005842.e025g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e025" xlink:type="simple"/>
<mml:math display="inline" id="M25">
<mml:mrow>
<mml:msubsup>
<mml:mi>K</mml:mi>
<mml:mi>s</mml:mi>
<mml:mi>r</mml:mi>
</mml:msubsup>
</mml:mrow>
</mml:math>
</alternatives>
</inline-formula>
</td>
<td align="left">time and stimulus kernels (stimulating electrode) at the <italic>r</italic> – <italic>th</italic> range between breakpoints.</td>
</tr>
<tr>
<td align="left"><italic>R</italic></td>
<td align="left">number of intervals between breakpoints.</td>
</tr>
<tr>
<td align="left"><italic>K</italic><sub><italic>j</italic>,<italic>j</italic></sub></td>
<td align="left">sub-matrix of kernel matrix with fixed <italic>j</italic>-th stimulus.</td>
</tr>
<tr>
<td align="left"><italic>ρ</italic>, <italic>ρ</italic><sup><italic>r</italic></sup></td>
<td align="left">dimensionless factors for stimulating and non-stimulating electrode kernels.</td>
</tr>
<tr>
<td align="left"><italic>α</italic>, <italic>β</italic></td>
<td align="left">parameters of gamma ‘envelope’ <italic>d</italic><sub><italic>α</italic>,<italic>β</italic></sub>(<italic>x</italic>) = <italic>x</italic><sup><italic>α</italic></sup> <italic>exp</italic>(−<italic>xβ</italic>).</td>
</tr>
<tr>
<td align="left"><italic>θ</italic></td>
<td align="left">vector of kernel hyperparameters: <italic>θ</italic> = (<italic>ρ</italic>, <italic>α</italic>, λ, <italic>β</italic>) and <italic>K</italic><sup><italic>θ</italic></sup> = <italic>K</italic><sub><italic>t</italic></sub>, <italic>K</italic><sub><italic>e</italic></sub>, <italic>K</italic><sub><italic>s</italic></sub> (non-stimulating electrodes).</td>
</tr>
<tr>
<td align="left"><italic>ϕ</italic><sup>2</sup></td>
<td align="left">noise variance of the artifact.</td>
</tr>
<tr>
<td align="left"><italic>σ</italic><sup>2</sup></td>
<td align="left">noise variance of recorded traces.</td>
</tr>
<tr>
<td align="left"><italic>K</italic><sup>(<italic>θ</italic>,<italic>ϕ</italic><sup>2</sup>)</sup>, <italic>K</italic><sup>(<italic>θ</italic>,<italic>ϕ</italic>′<sup>2</sup>)</sup></td>
<td align="left">Makes explicit the dependence of <italic>K</italic>, <italic>K</italic>′ on parameters <italic>K</italic><sup>(<italic>θ</italic>,<italic>ϕ</italic><sup>2</sup>)</sup> = <italic>K</italic>, <italic>K</italic><sup>(<italic>θ</italic>,<italic>ϕ</italic>′<sup>2</sup>)</sup> = <italic>K</italic>′</td>
</tr>
</tbody>
</table>
</alternatives>
</table-wrap>
</sec>
</sec>
<sec id="sec011">
<title>Algorithm</title>
<p>Now we introduce an algorithm for the joint estimation of <italic>A</italic> and <italic>s</italic>, based on the GP model for <italic>A</italic>. Roughly, the algorithm is divided in two stages: first, the hyperparameters that govern the structure of <italic>A</italic> have to be found. After, given the inferred hyperparameters we perform the actual inference of <italic>A</italic>, <italic>s</italic> given these hyperparameters. We base our approach on posterior inference for <italic>p</italic>(<italic>A</italic>, <italic>s</italic>|<italic>Y</italic>, <italic>θ</italic>, <italic>σ</italic><sup>2</sup>) ∝ <italic>p</italic>(<italic>Y</italic>|<italic>s</italic>, <italic>A</italic>, <italic>σ</italic><sup>2</sup>)<italic>p</italic>(<italic>A</italic>|<italic>θ</italic>), where the first factor in the right hand side is the likelihood of the observed data <italic>Y</italic> given <italic>s</italic>, <italic>A</italic>, and the noise variance <italic>σ</italic><sup>2</sup>, and the second stands for the noise-free artifact prior; <italic>A</italic> ∼ <italic>GP</italic>(0, <italic>K</italic><sup><italic>θ</italic></sup>). A summary of all the involved operations is shown in pseudo-code in algorithm 1.</p>
<p><bold>Algorithm 1</bold> Spike detection and Artifact cancellation with electrical stimulation</p>
<p specific-use="line"><bold>Input:</bold> Traces <italic>Y</italic> = (<italic>Y</italic><sub><italic>j</italic></sub>)<sub><italic>j</italic> = 1, …, <italic>J</italic></sub>, in response to <italic>J</italic> stimuli.</p>
<p specific-use="line"><bold>Output:</bold> Estimates of artifact <inline-formula id="pcbi.1005842.e026"><alternatives><graphic id="pcbi.1005842.e026g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e026" xlink:type="simple"/><mml:math display="inline" id="M26"><mml:mover accent="true"><mml:mi>A</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> and neural activity <inline-formula id="pcbi.1005842.e027"><alternatives><graphic id="pcbi.1005842.e027g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e027" xlink:type="simple"/><mml:math display="inline" id="M27"><mml:msup><mml:mover accent="true"><mml:mi>s</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mi>n</mml:mi></mml:msup></mml:math></alternatives></inline-formula> for each neuron.</p>
<p specific-use="line">  EIs of <italic>N</italic> neurons (e.g. obtained in a visual stimulation experiment).</p>
<p specific-use="line"><bold>Initialization</bold></p>
<p specific-use="line">1: Estimate <italic>ϕ</italic><sup>2</sup> (artifact noise) and <italic>θ</italic>.      ▹ Hyperparameter estimation, <xref ref-type="disp-formula" rid="pcbi.1005842.e035">Eq (7)</xref></p>
<p specific-use="line">2: Also, estimate <italic>σ</italic><sup>2</sup> (neural noise) from traces.</p>
<p specific-use="line"><bold>Artifact/neural activity inference via coordinate ascent and extrapolation</bold></p>
<p specific-use="line">3: <bold>for</bold> <italic>j</italic> = 1, … <italic>J</italic> <bold>do</bold></p>
<p specific-use="line">4:   Estimate <inline-formula id="pcbi.1005842.e028"><alternatives><graphic id="pcbi.1005842.e028g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e028" xlink:type="simple"/><mml:math display="inline" id="M28"><mml:msubsup><mml:mi>A</mml:mi> <mml:mi>j</mml:mi> <mml:mn>0</mml:mn></mml:msubsup></mml:math></alternatives></inline-formula> from <italic>A</italic><sub>[<italic>j</italic>−1]</sub> (<inline-formula id="pcbi.1005842.e029"><alternatives><graphic id="pcbi.1005842.e029g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e029" xlink:type="simple"/><mml:math display="inline" id="M29"><mml:mrow><mml:msubsup><mml:mi>A</mml:mi> <mml:mn>1</mml:mn> <mml:mn>0</mml:mn></mml:msubsup> <mml:mrow><mml:mo>≡</mml:mo> <mml:mn>0</mml:mn> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>.       ▹ Extrapolation, <xref ref-type="disp-formula" rid="pcbi.1005842.e063">Eq (11)</xref></p>
<p specific-use="line">5:   <bold>while</bold> some <inline-formula id="pcbi.1005842.e030"><alternatives><graphic id="pcbi.1005842.e030g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e030" xlink:type="simple"/><mml:math display="inline" id="M30"><mml:msubsup><mml:mover accent="true"><mml:mi>s</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mrow><mml:mi>j</mml:mi> <mml:mo>,</mml:mo> <mml:mi>i</mml:mi></mml:mrow> <mml:mi>n</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> change from one iteration to the next <bold>do</bold>  ▹ Coordinate ascent</p>
<p specific-use="line">6:    • Estimate <inline-formula id="pcbi.1005842.e031"><alternatives><graphic id="pcbi.1005842.e031g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e031" xlink:type="simple"/><mml:math display="inline" id="M31"><mml:msubsup><mml:mover accent="true"><mml:mi>s</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mrow><mml:mi>j</mml:mi> <mml:mo>,</mml:mo> <mml:mi>i</mml:mi></mml:mrow> <mml:mi>n</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> (for each <italic>i</italic>, <italic>n</italic>) greedily.     ▹ Matching pursuit, <xref ref-type="disp-formula" rid="pcbi.1005842.e053">Eq (9)</xref></p>
<p specific-use="line">7:     until no spike addition increases the likelihood.</p>
<p specific-use="line">8:    • Estimate <inline-formula id="pcbi.1005842.e032"><alternatives><graphic id="pcbi.1005842.e032g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e032" xlink:type="simple"/><mml:math display="inline" id="M32"><mml:msub><mml:mover accent="true"><mml:mi>A</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mi>j</mml:mi></mml:msub></mml:math></alternatives></inline-formula> from residuals <inline-formula id="pcbi.1005842.e033"><alternatives><graphic id="pcbi.1005842.e033g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e033" xlink:type="simple"/><mml:math display="inline" id="M33"><mml:mrow><mml:msub><mml:mi>Y</mml:mi> <mml:mi>j</mml:mi></mml:msub> <mml:mo>-</mml:mo> <mml:msubsup><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>n</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:mi>N</mml:mi></mml:msubsup> <mml:mspace width="1pt"/><mml:msubsup><mml:mi>s</mml:mi> <mml:mi>j</mml:mi> <mml:mi>n</mml:mi></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula>. ▹ Artifact filtering, <xref ref-type="disp-formula" rid="pcbi.1005842.e057">Eq (10)</xref>.</p>
<p specific-use="line">9:   <bold>end while</bold></p>
<p specific-use="line">10: <bold>end for</bold></p>
<sec id="sec012">
<title>Initialization: Hyperparameter estimation</title>
<p>From Eqs (<xref ref-type="disp-formula" rid="pcbi.1005842.e010">2</xref>, <xref ref-type="disp-formula" rid="pcbi.1005842.e011">3</xref>, <xref ref-type="disp-formula" rid="pcbi.1005842.e015">4</xref>) and <xref ref-type="disp-formula" rid="pcbi.1005842.e017">6</xref> the GP model for the artifact is completely specified by the hyperparameters <italic>θ</italic> = (<italic>ρ</italic>, <italic>α</italic>, λ, <italic>β</italic>) and <italic>ϕ</italic><sup>2</sup>, <italic>ϕ</italic>′<sup>2</sup>. The standard approach for estimating <italic>θ</italic> is to optimize the marginal likelihood of the observed data <italic>Y</italic> [<xref ref-type="bibr" rid="pcbi.1005842.ref031">31</xref>]. However, in this setting computing this marginal likelihood entails summing over all possible spiking patterns <italic>s</italic> while simultaneously integrating over the high-dimensional vector <italic>A</italic>; exactly computing this large joint sum and integral is computationally intractable. Instead we introduce a simpler approximation that is computationally relatively cheap and quite effective in practice. We simply optimize the (gaussian) likelihood of <inline-formula id="pcbi.1005842.e034"><alternatives><graphic id="pcbi.1005842.e034g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e034" xlink:type="simple"/><mml:math display="inline" id="M34"><mml:mover accent="true"><mml:mi>A</mml:mi> <mml:mo>˜</mml:mo></mml:mover></mml:math></alternatives></inline-formula>,
<disp-formula id="pcbi.1005842.e035"><alternatives><graphic id="pcbi.1005842.e035g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e035" xlink:type="simple"/><mml:math display="block" id="M35"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:munder><mml:mo form="prefix" movablelimits="true">max</mml:mo> <mml:mi>θ</mml:mi></mml:munder> <mml:mo form="prefix">log</mml:mo> <mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mover accent="true"><mml:mi>A</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mo>|</mml:mo> <mml:mi>θ</mml:mi> <mml:mo>,</mml:mo> <mml:msup><mml:mi>ϕ</mml:mi> <mml:mn>2</mml:mn></mml:msup> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:munder><mml:mo form="prefix" movablelimits="true">min</mml:mo> <mml:mi>θ</mml:mi></mml:munder> <mml:mfrac><mml:mn>1</mml:mn> <mml:mn>2</mml:mn></mml:mfrac> <mml:msup><mml:mover accent="true"><mml:mi>A</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mi>t</mml:mi></mml:msup> <mml:mspace width="1pt"/><mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:msup><mml:mi>K</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>θ</mml:mi> <mml:mo>,</mml:mo> <mml:msup><mml:mi>ϕ</mml:mi> <mml:mn>2</mml:mn></mml:msup> <mml:mo>)</mml:mo></mml:mrow></mml:msup> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>-</mml:mo> <mml:mn>1</mml:mn></mml:mrow></mml:msup> <mml:mspace width="1pt"/><mml:mover accent="true"><mml:mi>A</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mo>+</mml:mo> <mml:mfrac><mml:mn>1</mml:mn> <mml:mn>2</mml:mn></mml:mfrac> <mml:mo form="prefix">log</mml:mo> <mml:mo>|</mml:mo> <mml:msup><mml:mi>K</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>θ</mml:mi> <mml:mo>,</mml:mo> <mml:msup><mml:mi>ϕ</mml:mi> <mml:mn>2</mml:mn></mml:msup> <mml:mo>)</mml:mo></mml:mrow></mml:msup> <mml:mo>|</mml:mo> <mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(7)</label></disp-formula>
where <inline-formula id="pcbi.1005842.e036"><alternatives><graphic id="pcbi.1005842.e036g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e036" xlink:type="simple"/><mml:math display="inline" id="M36"><mml:mover accent="true"><mml:mi>A</mml:mi> <mml:mo>˜</mml:mo></mml:mover></mml:math></alternatives></inline-formula> is a computationally cheap proxy for the true <italic>A</italic>. The notation <italic>K</italic><sup>(<italic>θ</italic>,<italic>ϕ</italic><sup>2</sup>)</sup> makes explicit the parametric dependence of the kernels in Eqs <xref ref-type="disp-formula" rid="pcbi.1005842.e010">2</xref> and <xref ref-type="disp-formula" rid="pcbi.1005842.e011">3</xref>, i.e., <italic>K</italic><sup>(<italic>θ</italic>,<italic>ϕ</italic><sup>2</sup>)</sup> = <italic>K</italic><sup><italic>θ</italic></sup> + <italic>ϕ</italic><sup>2</sup><italic>I</italic><sub><italic>T</italic>×<italic>E</italic>×<italic>J</italic></sub> with <italic>K</italic><sup><italic>θ</italic></sup> = <italic>ρK</italic><sub><italic>t</italic></sub> ⊗ <italic>K</italic><sub><italic>e</italic></sub> ⊗ <italic>K</italic><sub><italic>s</italic></sub> for the non-stimulating electrodes (or <italic>K</italic><sup>(<italic>θ</italic>,<italic>ϕ</italic>′<sup>2</sup>)</sup> = <italic>K</italic><sup><italic>θ</italic></sup> + <italic>ϕ</italic>′<sup>2</sup><italic>I</italic><sub><italic>T</italic>×<italic>E</italic></sub> and <inline-formula id="pcbi.1005842.e037"><alternatives><graphic id="pcbi.1005842.e037g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e037" xlink:type="simple"/><mml:math display="inline" id="M37"><mml:mrow><mml:msup><mml:mi>K</mml:mi> <mml:mi>θ</mml:mi></mml:msup> <mml:mo>=</mml:mo> <mml:msubsup><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>r</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:mi>R</mml:mi></mml:msubsup> <mml:mspace width="1pt"/><mml:msup><mml:mi>ρ</mml:mi> <mml:mi>r</mml:mi></mml:msup> <mml:msubsup><mml:mi>K</mml:mi> <mml:mi>t</mml:mi> <mml:mi>r</mml:mi></mml:msubsup> <mml:mo>⊗</mml:mo> <mml:msubsup><mml:mi>K</mml:mi> <mml:mi>s</mml:mi> <mml:mi>r</mml:mi></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula> for the stimulating electrode). Due to the Kronecker structure of these matrices, once <inline-formula id="pcbi.1005842.e038"><alternatives><graphic id="pcbi.1005842.e038g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e038" xlink:type="simple"/><mml:math display="inline" id="M38"><mml:mover accent="true"><mml:mi>A</mml:mi> <mml:mo>˜</mml:mo></mml:mover></mml:math></alternatives></inline-formula> is obtained the terms in <xref ref-type="disp-formula" rid="pcbi.1005842.e035">Eq 7</xref> can be computed quite tractably, with computational complexity <italic>O</italic>(<italic>d</italic><sup>3</sup>), with <italic>d</italic> = max{<italic>E</italic>, <italic>T</italic>, <italic>J</italic>} (max{<italic>T</italic>, <italic>J</italic>} in the stimulating-electrode case), instead of <italic>O</italic>(dim(<italic>A</italic>)<sup>3</sup>), with dim(<italic>A</italic>) = <italic>E</italic> ⋅ <italic>T</italic> ⋅ <italic>J</italic>, in the case of a general non-structured <italic>K</italic>. Thus the Kronecker assumption here leads to computational efficiency gains of several orders of magnitude. See e.g. [<xref ref-type="bibr" rid="pcbi.1005842.ref033">33</xref>] for a detailed exposition of efficient algorithmic implementations of all the operations that involve the Kronecker product that we have adopted here; some potential further accelerations are mentioned in the discussion section below.</p>
<p>Now we need to define <inline-formula id="pcbi.1005842.e039"><alternatives><graphic id="pcbi.1005842.e039g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e039" xlink:type="simple"/><mml:math display="inline" id="M39"><mml:mover accent="true"><mml:mi>A</mml:mi> <mml:mo>˜</mml:mo></mml:mover></mml:math></alternatives></inline-formula>. The stimulating electrode case is a bit more straightforward: we have found that setting <inline-formula id="pcbi.1005842.e040"><alternatives><graphic id="pcbi.1005842.e040g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e040" xlink:type="simple"/><mml:math display="inline" id="M40"><mml:mover accent="true"><mml:mi>A</mml:mi> <mml:mo>˜</mml:mo></mml:mover></mml:math></alternatives></inline-formula> to the mean or median of <italic>Y</italic> across trials and then solving <xref ref-type="disp-formula" rid="pcbi.1005842.e035">Eq 7</xref> leads to reasonable hyperparameter settings. The reason is that can neglect the effect of neural activity on traces, as the artifact <italic>A</italic> is much bigger than the effect of spiking activity <italic>s</italic> on this electrode, and. We estimate distinct kernels <inline-formula id="pcbi.1005842.e041"><alternatives><graphic id="pcbi.1005842.e041g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e041" xlink:type="simple"/><mml:math display="inline" id="M41"><mml:mrow><mml:msubsup><mml:mi>K</mml:mi> <mml:mi>t</mml:mi> <mml:mo>′</mml:mo></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula>, <inline-formula id="pcbi.1005842.e042"><alternatives><graphic id="pcbi.1005842.e042g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e042" xlink:type="simple"/><mml:math display="inline" id="M42"><mml:mrow><mml:msubsup><mml:mi>K</mml:mi> <mml:mi>s</mml:mi> <mml:mo>′</mml:mo></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula> for each stimulating electrode (since from <xref ref-type="fig" rid="pcbi.1005842.g003">Fig 3A</xref> we see that there is a good deal of heterogeneity across electrodes), and each of the ranges between breakpoints. <xref ref-type="fig" rid="pcbi.1005842.g004">Fig 4B</xref> shows an example of some kernels estimated following this approach.</p>
<fig id="pcbi.1005842.g004" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005842.g004</object-id>
<label>Fig 4</label>
<caption>
<title>Examples of learned GP kernels.</title>
<p><bold>A</bold> <italic>Left</italic>: inferred kernels <italic>K</italic><sub><italic>t</italic></sub>, <italic>K</italic><sub><italic>e</italic></sub>, <italic>K</italic><sub><italic>s</italic></sub> in the top, center, and bottom rows, respectively. <italic>Center</italic>: corresponding stationary auto-covariances from the Matérn(3/2) kernels (<xref ref-type="disp-formula" rid="pcbi.1005842.e015">Eq 4</xref>). <italic>Right</italic>: corresponding unnormalized ‘gamma-like’ envelopes <italic>d</italic><sub><italic>α</italic>,<italic>β</italic></sub> (<xref ref-type="disp-formula" rid="pcbi.1005842.e016">Eq 5</xref>). The inferred quantities are in agreement with what is observed in <xref ref-type="fig" rid="pcbi.1005842.g003">Fig 3B</xref>: first, the shape of temporal term <italic>d</italic><sub><italic>α</italic>,<italic>β</italic></sub> reflects that the artifact starts small, then the variance amplitude peaks at ∼.5 ms, and then decreases rapidly. Likewise, the corresponding spatial <italic>d</italic><sub><italic>α</italic>,<italic>β</italic></sub> indicates that the artifact variability induced by the stimulation is negligible for electrodes greater than 700 microns away from the stimulating electrode. <bold>B</bold> Same as <bold>A</bold>), but for the stimulating electrode. Only temporal kernels are shown, for two inter-breakpoint ranges (first and second rows, respectively).</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005842.g004" xlink:type="simple"/>
</fig>
<p>For non-stimulating electrodes, the artifact <italic>A</italic> is more comparable in size to the spiking contributions <italic>s</italic>, and this simple average-over-trials approach was much less successful, explained also by possible corruptions on ‘bad’, broken electrodes which could lead to equally bad hyperparameters estimates. On the other hand, for non-stimulating electrodes the artifact shape is much more reproducible across electrodes, so some averaging over electrodes should be effective. We found that a sensible and more robust estimate can be obtained by assuming that the effect of the artifact is a function of the position relative to the stimulating electrode. Under that assumption we can estimate the artifact by translating, for each of the stimulating electrodes, all the recorded traces as if they had occurred in response to stimulation at the center electrode, and then taking a big average for each electrode. In other words, we estimate
<disp-formula id="pcbi.1005842.e043"><alternatives><graphic id="pcbi.1005842.e043g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e043" xlink:type="simple"/><mml:math display="block" id="M43"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mover accent="true"><mml:mi>A</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>e</mml:mi> <mml:mo>,</mml:mo> <mml:mi>t</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:mfrac><mml:mn>1</mml:mn> <mml:mi>E</mml:mi></mml:mfrac> <mml:mspace width="1pt"/><mml:munderover><mml:mo>∑</mml:mo> <mml:mrow><mml:msub><mml:mi>e</mml:mi> <mml:mi>s</mml:mi></mml:msub> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:mi>E</mml:mi></mml:munderover> <mml:mspace width="1pt"/><mml:mfrac><mml:mn>1</mml:mn> <mml:msub><mml:mi>n</mml:mi> <mml:mi>j</mml:mi></mml:msub></mml:mfrac> <mml:mspace width="1pt"/><mml:munderover><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>i</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:msub><mml:mi>n</mml:mi> <mml:mi>j</mml:mi></mml:msub></mml:munderover> <mml:mspace width="1pt"/><mml:msup><mml:mi>Y</mml:mi> <mml:msub><mml:mi>e</mml:mi> <mml:mi>s</mml:mi></mml:msub></mml:msup> <mml:mrow><mml:mo>(</mml:mo> <mml:mover accent="true"><mml:mi>e</mml:mi> <mml:mo>¯</mml:mo></mml:mover> <mml:mo>,</mml:mo> <mml:mi>t</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi> <mml:mo>,</mml:mo> <mml:mi>i</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(8)</label></disp-formula>
where <italic>Y</italic><sup><italic>e</italic><sub><italic>s</italic></sub></sup> are the traces in response to stimulation on electrode <italic>e</italic><sub><italic>s</italic></sub> and <inline-formula id="pcbi.1005842.e044"><alternatives><graphic id="pcbi.1005842.e044g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e044" xlink:type="simple"/><mml:math display="inline" id="M44"><mml:mover accent="true"><mml:mi>e</mml:mi> <mml:mo>¯</mml:mo></mml:mover></mml:math></alternatives></inline-formula> is the index of electrode <italic>e</italic> after a translation of electrodes so that <italic>e</italic><sub><italic>s</italic></sub> is the center electrode. This centered estimate leads to stable values of <italic>θ</italic>, since combining information across many stimulating electrodes serves to average-out stimulating-electrode-specific neural activity and other outliers.</p>
<p>Some implementation details are worth mentioning. First, we do not combine information of all the <italic>E</italic> stimulating electrodes, but rather take a large-enough random sample to ensure the stability of the estimate. We found that using ∼15 electrodes is sufficient. Second, as the effect of the artifact is very localized in space, we do not utilize all the electrodes, but consider only the ones that are close enough to the center (here, the 25% closest). This leads to computational speed-ups without sacrificing estimate quality; indeed, using the entire array may lead to sub-optimal performance, since distant electrodes essentially contribute noise to this calculation. Third, we do not estimate <italic>ϕ</italic><sup>2</sup> by jointly maximizing <xref ref-type="disp-formula" rid="pcbi.1005842.e035">Eq 7</xref> with respect to (<italic>θ</italic>, <italic>ϕ</italic>). Instead, to avoid numerical instabilities we estimate <italic>ϕ</italic><sup>2</sup> directly as the background noise of the fictitious artifact. This can be easily done before solving the optimization problem, by considering the portions of <italic>A</italic> with the lowest artifact magnitude, e.g. the last few time steps at the lowest amplitude of stimulation at electrodes distant from the stimulating electrode. <xref ref-type="fig" rid="pcbi.1005842.g004">Fig 4A</xref> shows an example of kernels <italic>K</italic><sub><italic>t</italic></sub>, <italic>K</italic><sub><italic>e</italic></sub>, and <italic>K</italic><sub><italic>s</italic></sub> estimated following this approach.</p>
</sec>
<sec id="sec013">
<title>Coordinate ascent</title>
<p>Once the hyperparameters <italic>θ</italic> are known we focus on the posterior inference for <italic>A</italic>, <italic>s</italic> given <italic>θ</italic> and observed data <italic>Y</italic>. The non-convexity of the set over which the binary vectors <italic>b</italic><sup><italic>n</italic></sup> are defined makes this problem difficult: many local optima exist in practice and, as a result, for global optimization there may not be a better alternative than to look at a huge number of possible cases. We circumvent this cumbersome global optimization by taking a greedy approach, with two main characteristics: first, joint optimization over <italic>A</italic> and <italic>s</italic> is addressed with alternating ascent (over <italic>A</italic> with <italic>s</italic> held fixed, and then over <italic>s</italic> with <italic>A</italic> held fixed). Alternating ascent is a common approach for related methods in neuroscience (e.g. [<xref ref-type="bibr" rid="pcbi.1005842.ref012">12</xref>, <xref ref-type="bibr" rid="pcbi.1005842.ref029">29</xref>]), where the recordings are modeled as an additive sum of spiking, noise, and other terms. Second, data is divided in batches corresponding to the same stimulus amplitude, and the analysis for the (<italic>j</italic> + 1)-th batch starts only after definite estimates <inline-formula id="pcbi.1005842.e045"><alternatives><graphic id="pcbi.1005842.e045g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e045" xlink:type="simple"/><mml:math display="inline" id="M45"><mml:msub><mml:mover accent="true"><mml:mi>s</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mrow><mml:mo>[</mml:mo> <mml:mi>j</mml:mi> <mml:mo>]</mml:mo></mml:mrow></mml:msub></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1005842.e046"><alternatives><graphic id="pcbi.1005842.e046g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e046" xlink:type="simple"/><mml:math display="inline" id="M46"><mml:msub><mml:mover accent="true"><mml:mi>A</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mrow><mml:mo>[</mml:mo> <mml:mi>j</mml:mi> <mml:mo>]</mml:mo></mml:mrow></mml:msub></mml:math></alternatives></inline-formula> have already been produced ([<italic>j</italic>] denotes the set {1, …, <italic>j</italic>}). Moreover, this latter estimate of the artifact is used to initialize the estimate for <italic>A</italic><sub><italic>j</italic>+1</sub> (intuitively, we borrow strength from lower stimulation amplitudes to counteract the more challenging effects of artifacts at higher amplitudes). We address each step of the algorithm in turn below. For simplicity, we describe the details only for the non-stimulating electrodes. Treatment of the stimulating electrode is almost the same but demands a slightly more careful handling that we defer to Algorithm.</p>
<p>Given the batch <italic>Y</italic><sub><italic>j</italic></sub> and an initial artifact estimate <inline-formula id="pcbi.1005842.e047"><alternatives><graphic id="pcbi.1005842.e047g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e047" xlink:type="simple"/><mml:math display="inline" id="M47"><mml:msubsup><mml:mi>A</mml:mi> <mml:mi>j</mml:mi> <mml:mn>0</mml:mn></mml:msubsup></mml:math></alternatives></inline-formula> we alternate between neural activity estimation <inline-formula id="pcbi.1005842.e048"><alternatives><graphic id="pcbi.1005842.e048g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e048" xlink:type="simple"/><mml:math display="inline" id="M48"><mml:msub><mml:mover accent="true"><mml:mi>s</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mi>j</mml:mi></mml:msub></mml:math></alternatives></inline-formula> given a current artifact estimate, and artifact estimation <inline-formula id="pcbi.1005842.e049"><alternatives><graphic id="pcbi.1005842.e049g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e049" xlink:type="simple"/><mml:math display="inline" id="M49"><mml:msub><mml:mover accent="true"><mml:mi>A</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mi>j</mml:mi></mml:msub></mml:math></alternatives></inline-formula> given the current estimate of neural activity. This alternating optimization stops when changes in every <inline-formula id="pcbi.1005842.e050"><alternatives><graphic id="pcbi.1005842.e050g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e050" xlink:type="simple"/><mml:math display="inline" id="M50"><mml:msubsup><mml:mover accent="true"><mml:mi>s</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mi>j</mml:mi> <mml:mi>n</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> are sufficiently small, or nonexistent.</p>
</sec>
<sec id="sec014">
<title>Matching pursuit for neural activity inference</title>
<p>Given the current artifact estimate <inline-formula id="pcbi.1005842.e051"><alternatives><graphic id="pcbi.1005842.e051g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e051" xlink:type="simple"/><mml:math display="inline" id="M51"><mml:msub><mml:mover accent="true"><mml:mi>A</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mi>j</mml:mi></mml:msub></mml:math></alternatives></inline-formula> we maximize the conditional distribution for neural activity <inline-formula id="pcbi.1005842.e052"><alternatives><graphic id="pcbi.1005842.e052g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e052" xlink:type="simple"/><mml:math display="inline" id="M52"><mml:mrow><mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>s</mml:mi> <mml:mi>j</mml:mi></mml:msub> <mml:mo>|</mml:mo> <mml:msub><mml:mi>Y</mml:mi> <mml:mi>j</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>A</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mi>j</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msup><mml:mi>σ</mml:mi> <mml:mn>2</mml:mn></mml:msup> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:msubsup><mml:mo>∏</mml:mo> <mml:mrow><mml:mi>i</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:msub><mml:mi>n</mml:mi> <mml:mi>j</mml:mi></mml:msub></mml:msubsup> <mml:mspace width="1pt"/><mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>s</mml:mi> <mml:mrow><mml:mi>j</mml:mi> <mml:mo>,</mml:mo> <mml:mi>i</mml:mi></mml:mrow></mml:msub> <mml:mo>|</mml:mo> <mml:msub><mml:mi>Y</mml:mi> <mml:mrow><mml:mi>j</mml:mi> <mml:mo>,</mml:mo> <mml:mi>i</mml:mi></mml:mrow></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>A</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mi>j</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msup><mml:mi>σ</mml:mi> <mml:mn>2</mml:mn></mml:msup> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>, which corresponds to the following sparse regression problem (the set <italic>S</italic> embodies our constraints on spike occurrence and timing):
<disp-formula id="pcbi.1005842.e053"><alternatives><graphic id="pcbi.1005842.e053g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e053" xlink:type="simple"/><mml:math display="block" id="M53"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:munder><mml:mo form="prefix" movablelimits="true">min</mml:mo> <mml:mrow><mml:msubsup><mml:mi>b</mml:mi> <mml:mrow><mml:mi>j</mml:mi> <mml:mo>,</mml:mo> <mml:mi>i</mml:mi></mml:mrow> <mml:mi>n</mml:mi></mml:msubsup> <mml:mo>∈</mml:mo> <mml:mi>S</mml:mi> <mml:mo>,</mml:mo> <mml:mi>n</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn> <mml:mo>,</mml:mo> <mml:mo>…</mml:mo> <mml:mo>,</mml:mo> <mml:mi>N</mml:mi></mml:mrow></mml:munder> <mml:mspace width="1pt"/><mml:munderover><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>i</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:msub><mml:mi>n</mml:mi> <mml:mi>j</mml:mi></mml:msub></mml:munderover> <mml:mspace width="1pt"/><mml:msup><mml:mrow><mml:mo>∥</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>Y</mml:mi> <mml:mrow><mml:mi>j</mml:mi> <mml:mo>,</mml:mo> <mml:mi>i</mml:mi></mml:mrow></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>A</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mi>j</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>-</mml:mo> <mml:munderover><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>n</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:mi>n</mml:mi></mml:munderover> <mml:mspace width="1pt"/><mml:msup><mml:mi>M</mml:mi> <mml:mi>n</mml:mi></mml:msup> <mml:msubsup><mml:mi>b</mml:mi> <mml:mrow><mml:mi>j</mml:mi> <mml:mo>,</mml:mo> <mml:mi>i</mml:mi></mml:mrow> <mml:mi>n</mml:mi></mml:msubsup> <mml:mo>∥</mml:mo></mml:mrow> <mml:mn>2</mml:mn></mml:msup> <mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(9)</label></disp-formula></p>
<p>We seek to find the allocation of spikes that will lead the best match with the residuals <inline-formula id="pcbi.1005842.e054"><alternatives><graphic id="pcbi.1005842.e054g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e054" xlink:type="simple"/><mml:math display="inline" id="M54"><mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>Y</mml:mi> <mml:mrow><mml:mi>j</mml:mi> <mml:mo>,</mml:mo> <mml:mi>i</mml:mi></mml:mrow></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>A</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mi>j</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>. We follow a standard template-matching-pursuit greedy approach (e.g. [<xref ref-type="bibr" rid="pcbi.1005842.ref012">12</xref>]) to locally optimize <xref ref-type="disp-formula" rid="pcbi.1005842.e053">Eq 9</xref>: specifically, for each trial we iteratively search for the best choice of neuron/time, then subtract the corresponding neural activity until the proposed updates no longer lead to increases in the likelihood.</p>
</sec>
<sec id="sec015">
<title>Filtering for artifact inference</title>
<p>Given the current estimate of neural activity <inline-formula id="pcbi.1005842.e055"><alternatives><graphic id="pcbi.1005842.e055g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e055" xlink:type="simple"/><mml:math display="inline" id="M55"><mml:msub><mml:mover accent="true"><mml:mi>s</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mi>j</mml:mi></mml:msub></mml:math></alternatives></inline-formula> we maximize the posterior distribution of the artifact, that is, <inline-formula id="pcbi.1005842.e056"><alternatives><graphic id="pcbi.1005842.e056g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e056" xlink:type="simple"/><mml:math display="inline" id="M56"><mml:mrow><mml:msub><mml:mo form="prefix" movablelimits="true">max</mml:mo> <mml:msub><mml:mi>A</mml:mi> <mml:mi>j</mml:mi></mml:msub></mml:msub><mml:mspace width="4pt"/> <mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>A</mml:mi> <mml:mi>j</mml:mi></mml:msub> <mml:mo>|</mml:mo> <mml:msub><mml:mi>Y</mml:mi> <mml:mi>j</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>s</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mi>j</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:mi>θ</mml:mi> <mml:mo>,</mml:mo> <mml:msup><mml:mi>σ</mml:mi> <mml:mn>2</mml:mn></mml:msup> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>, which here leads to the posterior mean estimator (again, the overline indicates mean across the <italic>n</italic><sub><italic>j</italic></sub> trials):
<disp-formula id="pcbi.1005842.e057"><alternatives><graphic id="pcbi.1005842.e057g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e057" xlink:type="simple"/><mml:math display="block" id="M57"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>A</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mi>j</mml:mi></mml:msub> <mml:mo>=</mml:mo> <mml:mi>E</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>A</mml:mi> <mml:mi>j</mml:mi></mml:msub> <mml:mo>|</mml:mo> <mml:msub><mml:mi>Y</mml:mi> <mml:mi>j</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>s</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mi>j</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:mi>θ</mml:mi> <mml:mo>,</mml:mo> <mml:msup><mml:mi>σ</mml:mi> <mml:mn>2</mml:mn></mml:msup> <mml:mo>,</mml:mo> <mml:msup><mml:mi>ϕ</mml:mi> <mml:mn>2</mml:mn></mml:msup> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:msubsup><mml:mi>K</mml:mi> <mml:mrow><mml:mi>j</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi></mml:mrow> <mml:mi>θ</mml:mi></mml:msubsup> <mml:mspace width="1pt"/><mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mi>K</mml:mi> <mml:mrow><mml:mi>j</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi></mml:mrow> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>θ</mml:mi> <mml:mo>,</mml:mo> <mml:mfrac><mml:msup><mml:mi>σ</mml:mi> <mml:mn>2</mml:mn></mml:msup> <mml:msub><mml:mi>n</mml:mi> <mml:mi>j</mml:mi></mml:msub></mml:mfrac> <mml:mo>+</mml:mo> <mml:msup><mml:mi>ϕ</mml:mi> <mml:mn>2</mml:mn></mml:msup> <mml:mo>)</mml:mo></mml:mrow></mml:msubsup> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>-</mml:mo> <mml:mn>1</mml:mn></mml:mrow></mml:msup> <mml:mspace width="1pt"/><mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>Y</mml:mi> <mml:mo>¯</mml:mo></mml:mover> <mml:mi>j</mml:mi></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mover accent="true"><mml:mover accent="true"><mml:mi>s</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mo>¯</mml:mo></mml:mover> <mml:mi>j</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(10)</label></disp-formula>
This operation can be understood as the application of a linear filter. Indeed, by appealing to the eigendecomposition of <inline-formula id="pcbi.1005842.e058"><alternatives><graphic id="pcbi.1005842.e058g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e058" xlink:type="simple"/><mml:math display="inline" id="M58"><mml:msubsup><mml:mi>K</mml:mi> <mml:mrow><mml:mi>j</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi></mml:mrow> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>θ</mml:mi> <mml:mo>,</mml:mo> <mml:msup><mml:mi>σ</mml:mi> <mml:mn>2</mml:mn></mml:msup> <mml:mo>/</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mi>j</mml:mi></mml:msub> <mml:mo>+</mml:mo> <mml:msup><mml:mi>ϕ</mml:mi> <mml:mn>2</mml:mn></mml:msup> <mml:mo>)</mml:mo></mml:mrow></mml:msubsup></mml:math></alternatives></inline-formula> we see this operator shrinks the <italic>m</italic>-th eigencomponent of the artifact by a factor of <italic>κ</italic><sub><italic>m</italic></sub>/(<italic>κ</italic><sub><italic>m</italic></sub> + <italic>σ</italic><sup>2</sup>/<italic>n</italic><sub><italic>j</italic></sub> + <italic>ϕ</italic><sup>2</sup>) (<italic>κ</italic><sub><italic>m</italic></sub> is the m-th eigenvalue of <inline-formula id="pcbi.1005842.e059"><alternatives><graphic id="pcbi.1005842.e059g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e059" xlink:type="simple"/><mml:math display="inline" id="M59"><mml:msubsup><mml:mi>K</mml:mi> <mml:mrow><mml:mi>j</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi></mml:mrow> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>θ</mml:mi> <mml:mo>,</mml:mo> <mml:msup><mml:mi>σ</mml:mi> <mml:mn>2</mml:mn></mml:msup> <mml:mo>/</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mi>j</mml:mi></mml:msub> <mml:mo>+</mml:mo> <mml:msup><mml:mi>ϕ</mml:mi> <mml:mn>2</mml:mn></mml:msup> <mml:mo>)</mml:mo></mml:mrow></mml:msubsup></mml:math></alternatives></inline-formula>), exerting its greatest influence where <italic>κ</italic><sub><italic>m</italic></sub> is small. Notice that in the extreme case that <italic>σ</italic><sup>2</sup>/<italic>n</italic><sub><italic>j</italic></sub> + <italic>ϕ</italic><sup>2</sup> is very small compared to the <italic>κ</italic><sub><italic>m</italic></sub> then <inline-formula id="pcbi.1005842.e060"><alternatives><graphic id="pcbi.1005842.e060g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e060" xlink:type="simple"/><mml:math display="inline" id="M60"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>A</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mi>j</mml:mi></mml:msub> <mml:mo>≈</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>Y</mml:mi> <mml:mo>¯</mml:mo></mml:mover> <mml:mi>j</mml:mi></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mover accent="true"><mml:mover accent="true"><mml:mi>s</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mo>¯</mml:mo></mml:mover> <mml:mi>j</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>, i.e., the filtered artifact converges to the simple mean of spike-subtracted traces.</p>
</sec>
<sec id="sec016">
<title>Convergence</title>
<p>Remarkably, in practice often only a few (e.g. 3) iterations of coordinate ascent (neural activity inference and artifact inference) are required to converge to a stable solution <inline-formula id="pcbi.1005842.e061"><alternatives><graphic id="pcbi.1005842.e061g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e061" xlink:type="simple"/><mml:math display="inline" id="M61"><mml:msub><mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mi>s</mml:mi> <mml:mi>j</mml:mi> <mml:mi>n</mml:mi></mml:msubsup> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>{</mml:mo> <mml:mi>n</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn> <mml:mo>,</mml:mo> <mml:mo>…</mml:mo> <mml:mi>N</mml:mi> <mml:mo>}</mml:mo></mml:mrow></mml:msub></mml:math></alternatives></inline-formula>. The required number of iterations can vary slightly, depending e.g. on the number of neurons or the signal-to-noise; i.e., EI strength versus noise variance.</p>
</sec>
<sec id="sec017">
<title>Iteration over batches and artifact extrapolation</title>
<p>The procedure described in Algorithm is repeated in a loop that iterates through the batches corresponding to different stimulus strengths, from the lowest to the highest. Also, when doing <italic>j</italic> → <italic>j</italic> + 1 an initial estimate for the artifact <inline-formula id="pcbi.1005842.e062"><alternatives><graphic id="pcbi.1005842.e062g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e062" xlink:type="simple"/><mml:math display="inline" id="M62"><mml:msubsup><mml:mi>A</mml:mi> <mml:mrow><mml:mi>j</mml:mi> <mml:mo>+</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:mn>0</mml:mn></mml:msubsup></mml:math></alternatives></inline-formula> is generated by extrapolating from the current, faithful, estimate of the artifact up to the <italic>j</italic>-th batch. This extrapolation is easily implemented as the mean of the noise-free posterior distribution in this GP setup, that is:
<disp-formula id="pcbi.1005842.e063"><alternatives><graphic id="pcbi.1005842.e063g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e063" xlink:type="simple"/><mml:math display="block" id="M63"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msubsup><mml:mi>A</mml:mi> <mml:mrow><mml:mi>j</mml:mi> <mml:mo>+</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:mn>0</mml:mn></mml:msubsup> <mml:mo>=</mml:mo> <mml:mi>E</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>A</mml:mi> <mml:mrow><mml:mi>j</mml:mi> <mml:mo>+</mml:mo> <mml:mn>1</mml:mn></mml:mrow></mml:msub> <mml:mo>|</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>A</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mrow><mml:mo>[</mml:mo> <mml:mi>j</mml:mi> <mml:mo>]</mml:mo></mml:mrow></mml:msub> <mml:mi>θ</mml:mi> <mml:mo>,</mml:mo> <mml:msup><mml:mi>ϕ</mml:mi> <mml:mn>2</mml:mn></mml:msup> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:msubsup><mml:mi>K</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>j</mml:mi> <mml:mo>+</mml:mo> <mml:mn>1</mml:mn> <mml:mo>,</mml:mo> <mml:mo>[</mml:mo> <mml:mi>j</mml:mi> <mml:mo>]</mml:mo> <mml:mo>)</mml:mo></mml:mrow> <mml:mi>θ</mml:mi></mml:msubsup> <mml:mspace width="1pt"/><mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mi>K</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mo>[</mml:mo> <mml:mi>j</mml:mi> <mml:mo>]</mml:mo> <mml:mo>,</mml:mo> <mml:mo>[</mml:mo> <mml:mi>j</mml:mi> <mml:mo>]</mml:mo> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>θ</mml:mi> <mml:mo>,</mml:mo> <mml:msup><mml:mi>ϕ</mml:mi> <mml:mn>2</mml:mn></mml:msup> <mml:mo>)</mml:mo></mml:mrow></mml:msubsup> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>-</mml:mo> <mml:mn>1</mml:mn></mml:mrow></mml:msup> <mml:mspace width="1pt"/><mml:msub><mml:mover accent="true"><mml:mi>A</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mrow><mml:mo>[</mml:mo> <mml:mi>j</mml:mi> <mml:mo>]</mml:mo></mml:mrow></mml:msub> <mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(11)</label></disp-formula>
Importantly, in practice this initial estimate ends up being extremely useful, as in the absence of a good initial estimate, coordinate ascent often leads to poor optima. The very accurate initializations from extrapolation estimates help to avoid these poor local optima.</p>
<p>We note that both for the extrapolation and filtering stages we still profit from the scalability properties that arise from the Kronecker decomposition. Indeed, the two required operations—inversion of the kernel and the product between that inverse and the vectorized artifact—reduce to elementary operations that only involve the kernels <italic>K</italic><sub><italic>e</italic></sub>, <italic>K</italic><sub><italic>t</italic></sub>, <italic>K</italic><sub><italic>s</italic></sub> [<xref ref-type="bibr" rid="pcbi.1005842.ref033">33</xref>].</p>
</sec>
<sec id="sec018">
<title>Integrating the stimulating and non-stimulating electrodes</title>
<p>Notice that the same algorithm can be implemented for the stimulating electrode, or for all electrodes simultaneously, by considering equivalent extrapolation, filtering, and matched pursuit operations. The only caveat is that extrapolation across stimulation amplitude breakpoints does not make sense for the stimulating electrode, and therefore, information from the stimulating electrode must not be taken into account at the first amplitude following a breakpoint, at least for the first matching pursuit-artifact filtering iteration.</p>
</sec>
<sec id="sec019">
<title>Further computational remarks</title>
<p>Note the different computational complexities of artifact related operations (filtering, extrapolation) and neural activity inference: while the former depends (cubically) only on <italic>T</italic>, <italic>E</italic>, <italic>J</italic>, the latter depends (linearly) on the number of trials <italic>n</italic><sub><italic>j</italic></sub>, the number of neurons, and the number of electrodes on which each neuron’s EI is significantly nonzero. In the data analyzed here, we found that the fixed computational cost of artifact inference is typically bigger than the per-trial cost of neural activity inference. Therefore, if spike sorting is required for big volumes of data (<italic>n</italic><sub><italic>j</italic></sub> ≫ 1) it is a sensible choice to avoid unnecessary artifact-related operations: as artifact estimates are stable after a moderate number of trials (e.g. <italic>n</italic><sub><italic>j</italic></sub> = 50), one could estimate the artifact with that number, subtract that artifact from traces and perform matching pursuit for the remaining trials. That would also be helpful to avoid unnecessary multiple iterations of the artifact inference—spike inference loop.</p>
</sec>
</sec>
<sec id="sec020">
<title>Simplifications and extensions</title>
<sec id="sec021">
<title>A simplified method</title>
<p>We now describe a way to reduce some of the computations associated with algorithm 1. This simplified method is based on two observations: first, as discussed above, if many repetitions are available, the sample mean of spike subtracted traces over trials should already provide an accurate artifact estimator, making filtering (<xref ref-type="disp-formula" rid="pcbi.1005842.e057">Eq 10</xref>) superfluous. (Alternatively, one could also consider the more robust median over trials; in the experiments analyzed here we did not find any substantial improvement with the median estimator.) Second, as artifact changes smoothly across stimulus amplitudes, it is reasonable to use the artifact estimated at condition <italic>j</italic> as an initialization for the artifact estimate at the (<italic>j</italic> + 1)th amplitude. Naturally, if two amplitudes are too far apart this estimator breaks down, but if not, it circumvents the need to appeal to <xref ref-type="disp-formula" rid="pcbi.1005842.e063">Eq 11</xref>.</p>
<p>Thus, we propose a simplified method in which <xref ref-type="disp-formula" rid="pcbi.1005842.e057">Eq 10</xref> is replaced by the spike-subtracted mean voltage (i.e. skip the filtering step in line 9 of algorithm 1), and <xref ref-type="disp-formula" rid="pcbi.1005842.e063">Eq 11</xref> is replaced by simple ‘naive’ extrapolation (i.e. avoid kernel-based extrapolation in line 5 of algorithm 1 and just initialize <inline-formula id="pcbi.1005842.e064"><alternatives><graphic id="pcbi.1005842.e064g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005842.e064" xlink:type="simple"/><mml:math display="inline" id="M64"><mml:mrow><mml:msubsup><mml:mi>A</mml:mi> <mml:mrow><mml:mi>j</mml:mi> <mml:mo>+</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:mn>0</mml:mn></mml:msubsup> <mml:mo>=</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>A</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mrow><mml:mo>[</mml:mo> <mml:mi>j</mml:mi> <mml:mo>]</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>). We can derive this simplified estimator as a limiting special case within our GP framework: first, avoiding the filtering operator is achieved by neglecting the noise variances <italic>σ</italic><sup>2</sup> and <italic>ϕ</italic><sup>2</sup>, as this essentially means that our observations are noise-free; hence, there is no need for smoothing. Also, our naive extrapolation proposal can be obtained using an artifact covariance kernel based on Brownian motion in <italic>j</italic> [<xref ref-type="bibr" rid="pcbi.1005842.ref036">36</xref>].</p>
<p>Finally, notice that the simplified method does not require a costly initialization (i.e, we can skip the maximization of <xref ref-type="disp-formula" rid="pcbi.1005842.e035">Eq 7</xref> in line 2 of algorithm 1).</p>
</sec>
<sec id="sec022">
<title>Beyond single-electrode stimulation</title>
<p>So far we have focused our attention on single electrode stimulation. A natural question is whether or not our method can be extended to analyze responses to simultaneous stimulation at several electrodes, which is of particular importance for the use of patterned stimulation as a means of achieving selective activation of neurons [<xref ref-type="bibr" rid="pcbi.1005842.ref028">28</xref>, <xref ref-type="bibr" rid="pcbi.1005842.ref037">37</xref>]. One simple approach is to simply restrict attention to experimental designs in which the relative amplitudes of the stimuli delivered on each electrode are held fixed, while we vary the overall amplitude. This reduces to a one-dimensional problem (since we are varying just a single overall amplitude scalar). We can apply the approach described above with no modifications to this case, just replacing “stimulus amplitude” in the single-electrode setting with “overall amplitude scale” in the multiple-electrode case.</p>
<p>In this work we consider three types of multiple electrode stimulation: <italic>Bipolar</italic> stimulation, <italic>Local Return</italic> stimulation and <italic>Arbitrary</italic> stimulation patterns. Bipolar stimuli were applied on two neighboring electrodes, and consisted of simultaneous pulses with opposite amplitudes. The purpose was to modulate the direction of the applied electric field [<xref ref-type="bibr" rid="pcbi.1005842.ref038">38</xref>]. The local return stimulus had the same central electrode current, with simultaneous current waveforms of opposite sign and one sixth amplitude on the six immediately surrounding return electrodes. The purpose of the local return stimulus configuration was to restrict the current spread of the stimulation pulse by using local grounding. More generally, arbitrary stimulation patterns (up to four electrodes) were similarly designed to shape the resulting electric field, and consisted of simultaneous pulses of varied amplitudes.</p>
</sec>
</sec>
</sec>
<sec id="sec023" sec-type="results">
<title>Results</title>
<p>We start by showing, in <xref ref-type="fig" rid="pcbi.1005842.g005">Fig 5</xref>, an example of the estimation of the artifact <italic>A</italic> and spiking activity <italic>s</italic> from single observed trials <italic>Y</italic>. Here, looking at individual responses to stimulation provides little information about the presence of spikes, even if the EIs are known. Thus, the estimation process relies heavily on the use of shared information across dimensions: in this example, a good estimate of the artifact was obtained by using information from stimulation at lower amplitudes, and from several trials.</p>
<fig id="pcbi.1005842.g005" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005842.g005</object-id>
<label>Fig 5</label>
<caption>
<title>Example of neural activity and artifact inference in a neighborhood of the stimulating electrode.</title>
<p><italic>Left:</italic> Two recordings in response to a 2.01 <italic>μA</italic> stimulus. <italic>Center:</italic> estimated artifact (as the stimulus doesn’t change, it is the same for both trials). <italic>Right:</italic> Difference between raw traces and estimated artifact, with inferred spikes in color. In the first trial (above) one spiking neuron was detected, while in trial 2 (below) three spiking neurons were detected. The algorithm separates the artifact <italic>A</italic> and spiking activity <italic>s</italic> effectively here.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005842.g005" xlink:type="simple"/>
</fig>
<sec id="sec024">
<title>Algorithm validation</title>
<p>We validated the algorithm by measuring its performance both on a large dataset with available human-curated spike sorting and with ground-truth simulated data (we avoid the term ground-truth in the real data to acknowledge the possibility that the human makes mistakes).</p>
<sec id="sec025">
<title>Comparison to human annotation</title>
<p>The efficacy of the algorithm was first demonstrated by comparison to human-curated results from the peripheral primate retina. The algorithm was applied to 4,045 sets of traces in response to increasing stimuli. We refer to each of these sets as an <italic>amplitude series</italic>. These amplitude series came from the four stimulation categories described in: single-electrode, bipolar, local return, and arbitrary.</p>
<p>We first assessed the agreement between algorithm and human annotation on a trial-by-trial basis, by comparing the presence or absence of spikes, and their latencies. Results of this trial-by-trial analysis for the kernel-based estimator are shown in <xref ref-type="fig" rid="pcbi.1005842.g006">Fig 6A</xref>. Overall, the results are satisfactory, with an error rate of 0.45%. Errors were the result of either false positives (misidentified spikes over the cases of no spiking) or false negatives (failures in detecting truly existing spikes), whose rates were 0.43% (FPR, false positives over total positives) and 1.08% (FNR, false negatives over total negatives), respectively. For reference, we considered the baseline given by the simple estimator introduced in [<xref ref-type="bibr" rid="pcbi.1005842.ref020">20</xref>]: there, the artifact is estimated as the simple mean of traces. False negative rates were an order of magnitude larger for the reference estimator, 49% (see <xref ref-type="supplementary-material" rid="pcbi.1005842.s004">S2 Fig</xref> for details). In Comparison to other methods we further discuss why this reference method fails in this data.</p>
<fig id="pcbi.1005842.g006" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005842.g006</object-id>
<label>Fig 6</label>
<caption>
<title>Population results from thirteen retinal preparations reveal the efficacy of the algorithm.</title>
<p><bold>A</bold>. Trial-by-trial wise performance of estimators broken down by the the four types of stimulation considered (total number of trials 1,713,233, see Table 1 <xref ref-type="supplementary-material" rid="pcbi.1005842.s001">S1 Text</xref> for details). <bold>B</bold>. Trial-by-trial wise performance of estimators to perturbations of real data (only single-electrode): five trials per stimulus for trial subsampling, every other stimulus for amplitude subsampling and <italic>σ</italic> = 20 for noise injection. <bold>C,D</bold>. Amplitude-series wise performance of estimators. <bold>C</bold>: false omission rate (FOR = FN/(FN+TP)), false discovery rate (FDR = FP/(FP+TP)), and error rate based on the 4,045 available amplitude series (see Table 2 <xref ref-type="supplementary-material" rid="pcbi.1005842.s001">S1 Text</xref> for details); <bold>D</bold>: comparison of activation thresholds (human vs. kernel-based algorithm). <bold>E</bold>. Performance measures (trial-by-trial) broken down by distance between neuron and stimulating electrode. <bold>F</bold>. Trial-by-trial error as a function of EI peak strength across all electrodes (only kernel-based). A Spearman correlation test revealed a significant negative correlation. <bold>G</bold>. Error as a function of number of iterations in the algorithm. <bold>H</bold>. For the true positives, histogram of the differences of latencies between human and algorithm. <bold>I</bold>. Computational cost comparison of the three methods for the analysis of single-electrode scans, with 20 to 25 (left) or 50 (right) trials per stimulus.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005842.g006" xlink:type="simple"/>
</fig>
<p>We observed comparable error rates for the simplified and kernel-based estimator (again, see <xref ref-type="supplementary-material" rid="pcbi.1005842.s004">S2 Fig</xref> for details). To further investigate differences in performance, we considered three ‘perturbations’ to real data (restricting our attention to single-electrode stimulation, for simplicity): sub-sampling of trials (by limiting the maximum number of trials per stimulus to 20, 10, 5, and 2), sub-sampling of amplitudes (considering only every other or every other other stimulus amplitude in the sequence), and noise injection, by adding uncorrelated Gaussian noise with standard deviation <italic>σ</italic> = 5, 10, or 20<italic>μ</italic> V (this noise adds to the actual noise in recordings that here we estimated below <italic>σ</italic> = 6<italic>μ</italic>V, by using traces in response to low amplitude stimuli far from the stimulation site). Representative results are shown in <xref ref-type="fig" rid="pcbi.1005842.g006">Fig 6B</xref> (but see <xref ref-type="supplementary-material" rid="pcbi.1005842.s005">S3 Fig</xref> for full comparisons), and indicate that indeed the kernel-based estimator delivers superior performance in these more challenging scenarios. Thus unless otherwise noted below we focus on results of the full kernel-based estimator, not the simplified estimator; see Applications: High resolution neural prosthesis for more comparisons between both estimators.</p>
<p>We also quantified accuracy at the level of the entire amplitude series, instead of individual trials: given an amplitude series we conclude that neural activation is present if the sigmoidal activation function fit (specifically, the CDF of a normal distribution) to the empirical activation curves—the proportion of trials where spikes occurred as a function of stimulation amplitude—exceeds 50% within the ranges of stimulation. In the positive cases, we define the stimulation threshold as the current needed to elicit spiking with 0.5 probability. This number provides an informative univariate summary of the activation curve itself. The obtained results are again satisfactory (<xref ref-type="fig" rid="pcbi.1005842.g006">Fig 6C</xref>). Also, in the case of correctly detected events we compared the activation thresholds (<xref ref-type="fig" rid="pcbi.1005842.g006">Fig 6D</xref>) and found little discrepancy between human and algorithm (with the exception of a single point, which can be better considered as an additional false positive, as the algorithm predicts activation at much smaller amplitude of stimulus).</p>
<p>We investigated various covariates that could modulate performance: distance between targeted neuron and stimulating electrode (<xref ref-type="fig" rid="pcbi.1005842.g006">Fig 6E</xref>), strength of the neural signals (<xref ref-type="fig" rid="pcbi.1005842.g006">Fig 6F</xref>) and maximum permitted number of iterations of the coordinate ascent step (<xref ref-type="fig" rid="pcbi.1005842.g006">Fig 6G</xref>). Regarding the first, we divided data by somatic stimulation (stimulating electrode is the closest to the soma), peri-somatic stimulation (stimulating electrode neighbors the closest to the soma) and distant stimulation (neither somatic nor peri-somatic). As expected, accuracies were the lowest when the neural soma was close to the stimulating electrode (somatic stimulation), presumably a consequence of artifacts of larger magnitude in that case. Regarding the second, we found that error significantly decreases with strength of the EI, indicating that our algorithm benefits from strong neural signals. With respect to the third, we observe some benefit from increasing the maximum number of iterations, and that accuracies stabilize after a certain value (e.g. three), indicating that either the algorithm converged or that further coordinate iterations did not lead to improvements.</p>
<p>Finally, we report two other relevant metrics: first, differences between real and inferred latencies (<xref ref-type="fig" rid="pcbi.1005842.g006">Fig 6H</xref>, only for correctly identified spikes) revealed that in the vast majority of cases (&gt;95%) spike times inferred by human vs. algorithm differed by less than 0.1 ms. Second, we assessed computational expenses by measuring the algorithm’s running time for the analysis of a single-electrode scan; i.e, the totality of the 512 amplitude series, one for each stimulating electrode (<xref ref-type="fig" rid="pcbi.1005842.g006">Fig 6I</xref>). The analysis was done in parallel, with twenty threads analyzing single amplitude series (details in <xref ref-type="supplementary-material" rid="pcbi.1005842.s001">S1 Text</xref>). We conclude that we can analyze a complete experiment in ten to thirty minutes and that the parallel implementation is compatible with the time scales required by closed-loop pipelines. We further comment on this in Online data analysis. Comparisons in <xref ref-type="fig" rid="pcbi.1005842.g006">Fig 6I</xref> also illustrate that our methods are 2x-3x slower than the (much less accurate) reference estimator, but that differences between kernel-based and the simplified estimator are rather moderate. This suggests that filtering and extrapolation are inexpensive in comparison to the time spent in the matching pursuit stage of the algorithm, and that the cost of finding the hyper-parameters (only once) is negligible at the scale of the analysis of several hundreds of amplitude series.</p>
<p>We refer the reader to <xref ref-type="supplementary-material" rid="pcbi.1005842.s001">S1 Text</xref> for details on population statistics of the analyzed data, exclusion criteria, and computational implementation.</p>
</sec>
<sec id="sec026">
<title>Simulations</title>
<p>Synthetic datasets were generated by adding artifacts measured in TTX recordings (not contaminated by neural activity <italic>s</italic>), real templates, and white noise, in an attempt to faithfully match basic statistics of neural activity in response to electrical stimuli, i.e., the frequency of spiking and latency distribution as a function of distance between stimulating electrode and neurons (see <xref ref-type="supplementary-material" rid="pcbi.1005842.s007">S5 Fig</xref>). These simulations (only on single-electrode stimulation) were aimed to further investigate the differences between the naive and kernel-based estimators, by determining when—and to which extent—filtering (<xref ref-type="disp-formula" rid="pcbi.1005842.e057">Eq 10</xref>) and extrapolation (<xref ref-type="disp-formula" rid="pcbi.1005842.e063">Eq 11</xref>) were beneficial to enhance performance. To address this question, we evaluated separately the effects of the omission and/or simplification of the filtering operation (<xref ref-type="disp-formula" rid="pcbi.1005842.e057">Eq 10</xref>), and of the replacement of the kernel-based extrapolation (<xref ref-type="disp-formula" rid="pcbi.1005842.e063">Eq 11</xref>) by the naive extrapolation estimator that guesses the artifact at the <italic>j</italic>-th amplitude of stimulation simply as the artifact at the <italic>j</italic> − 1 amplitude of stimulation.</p>
<p>As the number of trials <italic>n</italic><sub><italic>j</italic></sub> goes to infinity, or as the noise level <italic>σ</italic> goes to zero, the influence of the likelihood grows compared to the GP prior, and the filtering operator converges to the identity (see <xref ref-type="disp-formula" rid="pcbi.1005842.e057">Eq 10</xref>). However, applied on individual traces, where the influence of this operator is maximal, filtering removes high frequency noise components and variations occurring where the localization kernels do not concentrate their mass (<xref ref-type="fig" rid="pcbi.1005842.g004">Fig 4A</xref>), which usually correspond to spikes. Therefore, in this case filtering should lead to less spike-contaminated artifact estimates. <xref ref-type="fig" rid="pcbi.1005842.g007">Fig 7B</xref> confirms this intuition with results from simulated data: in cases of high <italic>σ</italic><sup>2</sup> and small <italic>n</italic><sub><italic>j</italic></sub> the filtering estimator led to improved results. Moreover, a simplified filter that only consisted of smoothing kernels (i.e. for all the spatial, temporal and amplitude-wise kernels the localization terms <italic>d</italic><sub><italic>α</italic>,<italic>β</italic></sub> in <xref ref-type="disp-formula" rid="pcbi.1005842.e016">Eq 5</xref> were set equal to 1, leading to the Matérn kernel in <xref ref-type="disp-formula" rid="pcbi.1005842.e015">Eq 4</xref>) led to more modest improvements, suggesting that the localization terms (<xref ref-type="disp-formula" rid="pcbi.1005842.e016">Eq 5</xref>)—and not only the smoothing kernels—act as sensible and helpful modeling choices.</p>
<fig id="pcbi.1005842.g007" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005842.g007</object-id>
<label>Fig 7</label>
<caption>
<title>Filtering (<xref ref-type="disp-formula" rid="pcbi.1005842.e057">Eq 10</xref>) leads to a better, less spike-corrupted artifact estimate in our simulations.</title>
<p><bold>A</bold> effect of filtering on traces for two non-stimulating electrodes, at a fixed amplitude of stimulation (2.2<italic>μA</italic>). <italic>A1,A3</italic> raw traces, <italic>A2,A4</italic> filtered traces. Notice the two main features of the filter: first, it principally affects traces containing spikes, a consequence of the localized nature of the kernel in <xref ref-type="disp-formula" rid="pcbi.1005842.e010">Eq 2</xref>. Second, it helps eliminate high-frequency noise. <bold>B</bold> through simulations, we showed that filtering leads to improved results in challenging situations. Two filters—only smoothing and localization + smoothing—were compared to the omission of filtering. In all cases, to rule out that performance changes were due to the extrapolation estimator, extrapolation was done with the naive estimator. <italic>B1</italic> results in a less challenging situation. <italic>B2</italic> results in the heavily subsampled (<italic>n</italic><sub><italic>j</italic></sub> = 1) case. <italic>B3</italic> results in the high-noise variance (<italic>σ</italic><sup>2</sup> = 10) case.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005842.g007" xlink:type="simple"/>
</fig>
<p>Likewise, we expect that kernel-based extrapolation leads to improved performance if the artifact magnitude is large compared to the size of the EIs: in this case, differences between the naive estimator and the actual artifact would be large enough that many spikes would be misidentified or missed. However, since kernel-based extrapolation produces better artifact estimates (see <xref ref-type="fig" rid="pcbi.1005842.g008">Fig 8A and 8B</xref>), the occurrence of those failures should be diminished. Indeed, <xref ref-type="fig" rid="pcbi.1005842.g008">Fig 8C</xref> shows that better results are attained when the size of the artifact is multiplied by a constant factor (or equivalently, neglecting the noise term <italic>σ</italic><sup>2</sup>, when the size of the EIs is divided by a constant factor). Moreover, the differential results obtained when including the filtering stage suggest that the two effects are non-redundant: filtering and extrapolation both lead to improvements and the improvements due to each operation are not replaced by the other.</p>
<fig id="pcbi.1005842.g008" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005842.g008</object-id>
<label>Fig 8</label>
<caption>
<title>Kernel-based extrapolation (<xref ref-type="disp-formula" rid="pcbi.1005842.e063">Eq 11</xref>) leads to more accurate initial estimates of the artifact.</title>
<p><bold>A</bold> comparison between kernel-based extrapolation and the naive estimator, the artifact at the previous amplitude of stimulation. For a non-stimulating (first row) and the stimulating (second row) electrode, left: artifacts at different stimulus strengths (shades of blue), center: differences with extrapolation estimator (<xref ref-type="disp-formula" rid="pcbi.1005842.e063">Eq 11</xref>), right: differences with the naive estimator. <bold>B</bold> comparison between the true artifact (black), the naive estimator (blue) and the kernel-based estimator (light blue) for a fixed amplitude of stimulus (3.1<italic>μA</italic>) on a neighborhood of the stimulating electrode. <bold>C</bold> Through simulations we showed that extrapolation leads to improved results in a challenging situation. Kernel-based extrapolation was compared to naive extrapolation. <italic>C1</italic> results in a less challenging situation. <italic>C2-C3</italic> results in the case where the artifact is multiplied by a factor of 3 and 5, respectively.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005842.g008" xlink:type="simple"/>
</fig>
</sec>
</sec>
<sec id="sec027">
<title>Applications: High resolution neural prosthesis</title>
<p>A prominent application of our method relates to the development of high-resolution neural prostheses (particularly, epi-retinal prosthesis), whose success will rely on the ability to elicit arbitrary patterns of neural activity through the selective activation of individual neurons in real-time [<xref ref-type="bibr" rid="pcbi.1005842.ref028">28</xref>, <xref ref-type="bibr" rid="pcbi.1005842.ref039">39</xref>, <xref ref-type="bibr" rid="pcbi.1005842.ref040">40</xref>]. For achieving such selective activation in a closed-loop setup, we need to know how different stimulating electrodes activate nearby neurons, information that is easily summarized by the activation curves, with the activation thresholds themselves as proxies. Unfortunately, obtaining this information in real time—as required for prosthetic devices—is currently not feasible since estimation of thresholds requires the analysis of individual responses to stimuli. In Online data analysis we discuss in detail how, within our framework, to overcome the stringent time limitations required for such purposes.</p>
<p>Figs <xref ref-type="fig" rid="pcbi.1005842.g009">9</xref>, <xref ref-type="fig" rid="pcbi.1005842.g010">10</xref>, <xref ref-type="fig" rid="pcbi.1005842.g011">11</xref> and <xref ref-type="fig" rid="pcbi.1005842.g012">12</xref> show pictorial representations of different features of the results obtained with the algorithm, and their comparison with human annotation. Axonal reconstructions from all of the neurons in the figures were achieved through a polynomial fit to the neuron’s spatial EI, with soma size depending on the EI strength (see [<xref ref-type="bibr" rid="pcbi.1005842.ref028">28</xref>] for details). Each of these figures provides particular insights to inform and guide the large-scale closed-loop control of the neural population. Importantly, generation of these maps took only minutes on a personal computer, compared to many human hours, indicating feasibility for clinical applications and substantial value for analysis of laboratory experiments [<xref ref-type="bibr" rid="pcbi.1005842.ref028">28</xref>, <xref ref-type="bibr" rid="pcbi.1005842.ref040">40</xref>].</p>
<fig id="pcbi.1005842.g009" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005842.g009</object-id>
<label>Fig 9</label>
<caption>
<title>Analysis of responses of neurons in a neighborhood of the stimulating electrode.</title>
<p><bold>A</bold> Spatial configuration: stimulating electrode (blue/yellow annulus) and four neurons on its vicinity. Soma of green neuron and axon of pink neuron overlap with stimulating electrode. <bold>B</bold> Activation curves (solid lines) along with human-curated and algorithm inferred spike probabilities (gray and colored circles, respectively) of all the four cells. Stimulation elicited activation of green and pink neurons; however, the two other neurons remained inactive. <bold>C</bold> Raster plots for the activated cells, with responses sorted by stimulation strength in the y axis. Human and algorithm inferred latencies are in good agreement (gray and colored circles, respectively). Here, direct somatic activation of the green neuron leads to lower-latency and lower-threshold activation than of the pink neuron, which is activated through its axon.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005842.g009" xlink:type="simple"/>
</fig>
<fig id="pcbi.1005842.g010" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005842.g010</object-id>
<label>Fig 10</label>
<caption>
<title>Electrical receptive field of a neuron.</title>
<p><bold>A</bold> spatial representation of the soma (black circle) and axon (black line) over the array. Electrodes where stimulation was attempted are represented by circles, with colors indicating the activation threshold in the case of a successful activation of the neuron within the stimulation range. <bold>B</bold> For those cases, activation curves (solid lines) are shown along with with human and algorithm inferred spike frequencies (gray and colored circles, respectively). Large circles indicate the activation thresholds represented in <bold>A</bold>. In this case, much of the activity is elicited through axonal stimulation, as there is a single electrode close to the soma that can activate the neuron. Human and algorithm are in good agreement.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005842.g010" xlink:type="simple"/>
</fig>
<fig id="pcbi.1005842.g011" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005842.g011</object-id>
<label>Fig 11</label>
<caption>
<title>Analysis of differential responses to single (A) and two-electrode (B) stimulation.</title>
<p>Gray and colored dots indicate human and algorithm inferences, respectively. In both cases activation of the two neurons is achieved. However, shape of activation curves is modulated by the presence of a current with the same strength and opposite polarity in a neighboring electrode (yellow/blue annulus in <bold>B</bold>): indeed, in this case bipolar stimulation leads to an enhanced ability to activate the pink neuron without activating the green neuron. The algorithm is faithfully able to recover the relevant activation thresholds.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005842.g011" xlink:type="simple"/>
</fig>
<fig id="pcbi.1005842.g012" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005842.g012</object-id>
<label>Fig 12</label>
<caption>
<title>Large-scale analysis of the stimulation of a population of parasol cells.</title>
<p>For each neuron, one or more stimulating electrodes in a neighborhood of neural soma were chosen for stimulation. <bold>A</bold> Receptive fields colored by the lowest achieved stimulation threshold (black if activation was not achieved). <bold>B</bold> Inferred somas (big black circles) of the neurons labeled A-E in <bold>A</bold>), showing which electrodes were chosen for stimulation (small circles) and whether activation was achieved (colors). <bold>C</bold> Activation curves (solid lines) of the neurons in <bold>B</bold> for the successful activation cases. Gray and colored dots represent human and algorithm results, respectively, and large circle indicates stimulation thresholds.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005842.g012" xlink:type="simple"/>
</fig>
<p><xref ref-type="fig" rid="pcbi.1005842.g009">Fig 9</xref> focuses on the stimulating electrode’s point of view: given stimulation in one electrode, it is of interest to understand which neurons will get activated within the stimulation range, and how selective that activation can be made. This information is provided by the activation curves, i.e, their steepness and their associated stimulation thresholds. Additionally, latencies can be informative about the spatial arrangement of the system under study, and the mode of neural activation: in this example, one cell is activated through direct stimulation of the soma, and the other, more distant cell is activated through the indirect and antidromic propagation of current through the axon [<xref ref-type="bibr" rid="pcbi.1005842.ref041">41</xref>]. This is confirmed by the observed latency pattern.</p>
<p><xref ref-type="fig" rid="pcbi.1005842.g010">Fig 10</xref> depicts the converse view, focusing on the neuron. Here we aim to determine the cell’s electrical receptive field [<xref ref-type="bibr" rid="pcbi.1005842.ref037">37</xref>, <xref ref-type="bibr" rid="pcbi.1005842.ref042">42</xref>] to single-electrode stimulation; that is, the set of electrodes that are able to elicit activation, and in the positive cases, the corresponding stimulation thresholds. These fields are crucial for tailoring stimuli that selectively activate sub-populations of neurons.</p>
<p><xref ref-type="fig" rid="pcbi.1005842.g011">Fig 11</xref> shows how the algorithm enables the analysis of responses to bipolar stimulation. This strategy has been suggested to enhance selectivity [<xref ref-type="bibr" rid="pcbi.1005842.ref043">43</xref>], by differentially shifting the stimulation thresholds of the cells so the range of currents that lead to activation of a single cell is widened. More generally, multi-electrode spatial stimulation patterns have the potential to enhance selectivity by producing an electric field optimized for activating one cell more strongly than others [<xref ref-type="bibr" rid="pcbi.1005842.ref028">28</xref>], and <xref ref-type="fig" rid="pcbi.1005842.g011">Fig 11</xref> is a depiction of how our algorithm permits an accurate assessment of this potential enhancement.</p>
<p>Finally, <xref ref-type="fig" rid="pcbi.1005842.g012">Fig 12</xref> shows a large-scale summary of the responses to single-electrode stimulation. There, a population of ON and OFF parasol cells was stimulated at many different electrodes close to their somas, and each of those cells was then labeled by the lowest achieved activation threshold. These maps provide a proxy of the ability to activate cells with single-electrode stimulation, and of the different degrees of difficulty in achieving activation. Since in many cases only as few as 20% of the neurons can be activated [<xref ref-type="bibr" rid="pcbi.1005842.ref044">44</xref>], the information about which cells were activated can provide a useful guide for the on-line development of more complex multiple electrode stimulation patterns that activate the remaining cells.</p>
</sec>
</sec>
<sec id="sec028" sec-type="conclusions">
<title>Discussion</title>
<p>Now we discuss the main features of the algorithm in light of the results and sketch some extensions to enable the analysis of data in contexts that go beyond those analyzed here.</p>
<sec id="sec029">
<title>Simplified vs. full kernel-based estimators</title>
<p>Figs <xref ref-type="fig" rid="pcbi.1005842.g006">6B</xref>, <xref ref-type="fig" rid="pcbi.1005842.g007">7B</xref> and <xref ref-type="fig" rid="pcbi.1005842.g008">8C</xref>, and <xref ref-type="supplementary-material" rid="pcbi.1005842.s005">S3 Fig</xref> illustrate some cases where the full kernel-based estimator outperforms the simplified artifact estimator. These cases correspond to heavy sub-sampling or small signal-to-noise ratios, where the data do not adequately constrain simple estimators of the artifact and the full Bayesian approach can exploit the structure in the problem to obtain significant improvements. In closed-loop experiments (discussed below in Online data analysis) experimental time is limited, and the ability to analyze fewer trials without loss of accuracy opens up the possibility for new experimental designs that may not have been otherwise feasible. That said, it is useful to note that simplified estimators are available and accurate in regimes of high SNR and where many trials are available.</p>
</sec>
<sec id="sec030">
<title>Comparison to other methods</title>
<p>We showed that our method strongly outperforms the simple proposal by [<xref ref-type="bibr" rid="pcbi.1005842.ref020">20</xref>]. Although this competing method was successful on its intended application, here it breaks down since neural activity tends to appear rather deterministically (i.e., spikes occur with very high probability and have low variability in time across trials) for stimuli of high amplitude. This phenomenon is documented in S5, and can be also observed in <xref ref-type="fig" rid="pcbi.1005842.g002">Fig 2</xref> (see traces in responses to the strongest stimulus). As a consequence, the mean-of-traces estimator of the artifact also contains the neural activity that is being sought, leading to a dramatic failure in detecting spikes, explaining the high false negative rate.</p>
<p>Two other prominent artifact cancellation methods exist, but neither applies directly to our context. The method of [<xref ref-type="bibr" rid="pcbi.1005842.ref022">22</xref>] considers high-frequency stimulation (5khz). In that context, since action potentials follow a much larger time course than of this very short latency artifact, it is relatively easy to cancel the artifact and recover neural activity by linearly interpolating the recordings whenever stimulation occurs. However, here, as seen in <xref ref-type="fig" rid="pcbi.1005842.g002">Fig 2</xref>, the artifact’s time course can be larger than of spikes (especially at the stimulating electrode). Additionally, the method of [<xref ref-type="bibr" rid="pcbi.1005842.ref021">21</xref>] has guarantees of success only for latencies greater than 2ms after the onset of stimulus, much larger than the ones addressed here (as small as 0.3 ms). Their 2ms threshold comes from the observation that it is at that time when spikes and artifacts become spectrally separable. However, in our case, at smaller latencies the artifact has a highly transient nature and there is much diversity of artifact shapes (<xref ref-type="fig" rid="pcbi.1005842.g003">Fig 3</xref>) for different electrodes and pulse amplitudes. This immediately excludes the possibility of considering an algorithm based on the spectral differentiation between the spikes and the artifacts in the low-latency context we care about.</p>
</sec>
<sec id="sec031">
<title>Online data analysis</title>
<p>The present findings open a real possibility for the development of closed-loop experiments to achieve selective activation of neurons, [<xref ref-type="bibr" rid="pcbi.1005842.ref010">10</xref>, <xref ref-type="bibr" rid="pcbi.1005842.ref045">45</xref>] featuring online data analysis at a much larger scale scale than was previously possible.</p>
<p>We briefly discuss a hypothetical pipeline for a closed loop-experiment, involving four steps: i) visual stimulation and subsequent spike sorting to identify neurons and their EIs; ii) single-electrode stimulation scans to map the excitability of those neurons with respect to each of the electrodes in the MEA; iii) additional multi-electrode stimulation to further explore ways to activate cells (optional); and iv) computation of optimal stimulation patterns to match a desired spike train.</p>
<p>Step (iii) might be helpful to enhance combinatorial richness (i.e. the number of ways in which ways neurons can be stimulated) if the available stimulus space resulting from single-electrode stimulation does not lead to a complete selective activation of neurons (in the retina, this will often be the case [<xref ref-type="bibr" rid="pcbi.1005842.ref044">44</xref>]). There is a caveat, though: allowing for arbitrary stimulation patterns is not possible without further assumptions, since the number of possible amplitude series, i.e., sequences of multi-dimensional stimuli with increasing amplitude, increases exponentially with the number of stimulating electrodes. We propose two solutions: 1) focus on patterns for which there is a clear underlying biophysical interpretation in terms of interactions between the neural tissue and the applied electrical field (e.g., the bipolar and local return stimulation patterns explored here) so that the number of patterns remains bounded, and 2) relax the amplitude series assumption; i.e. allows modes of data collection where recordings are not in response to a sequence of stimulus with increasing strength. This would be possible if artifacts obeyed linear superposition (i.e. the artifact to arbitrary stimulation breaks down into the linear sum of the individual artifacts), since then we would simply need to save the artifacts to single electrode stimulation, and subtract them as required from traces to arbitrary stimuli. In S6 we provide some elementary evidence that supports this linear superposition hypothesis in the simplest, two-electrode stimulation case. However, we stress that further research is required to establish artifact linearity more generally.</p>
</sec>
<sec id="sec032">
<title>Limitations</title>
<p>Here we comment on the current limitations of our method while suggesting some possible extensions.</p>
<sec id="sec033">
<title>Beyond the retina: Dealing with unavailability of electrical images</title>
<p>We stress the generalizability of our method to neural systems beyond the retina, as we expect that the qualitative characteristics of this artifact, being a general consequence of the electrical interactions between the neural tissue and the MEA [<xref ref-type="bibr" rid="pcbi.1005842.ref016">16</xref>], are replicable up to different scales that can be accounted for by appropriate changes in the hyperparameters.</p>
<p>In this work we have assumed that the EIs of the spiking neurons are available. At least in the retina, this will normally be the case, as spontaneous firing is ubiquitous among retinal ganglion cells [<xref ref-type="bibr" rid="pcbi.1005842.ref046">46</xref>]. Thus we can use this spontaneous activity to infer the EIs or other cell properties (e.g. cell type) ‘in the dark’ [<xref ref-type="bibr" rid="pcbi.1005842.ref047">47</xref>]. If this is not the case, we propose stimulation at low amplitudes so that the elicited cell activity is variable and therefore an initial crude estimate of the artifact can be initialized by the simple mean or median over many repetitions of the same stimulus. Then, after artifact subtraction EIs could be estimated with standard spike sorting approaches.</p>
<p>More generally, this additional EI estimation step could be stated in terms of an outer loop that iterates between EI estimation, given current artifact estimates, and neural activity and artifact estimation given the current EI estimate—that is, our algorithm. Furthermore, we notice the EI estimation step is essentially spike sorting; therefore, there is room for the use of state-of-the-art [<xref ref-type="bibr" rid="pcbi.1005842.ref048">48</xref>, <xref ref-type="bibr" rid="pcbi.1005842.ref049">49</xref>] methods to achieve efficient implementations. This outer loop would be especially helpful to enable the online update of the EI in order to counteract the effect of tissue drift, or to correct possible biases in estimates of the EI provided by visual stimulation [<xref ref-type="bibr" rid="pcbi.1005842.ref050">50</xref>, <xref ref-type="bibr" rid="pcbi.1005842.ref051">51</xref>], which could lead to problematic changes in EI shape over the course of an experiment. We acknowledge, however, that the implementation of this loop could significantly increase the computational complexity of our algorithm, and deem as an open problem how to achieve a reduction in computational complexity so that online data analysis would still be feasible.</p>
</sec>
<sec id="sec034">
<title>Small spikes: Accounting for correlated noise</title>
<p>We assumed that the noise process (<italic>ϵ</italic>) was uncorrelated in time and across electrodes, and had a constant variance. This is certainly an overly crude assumption: noise in recordings does exhibit strong spatiotemporal dependencies [<xref ref-type="bibr" rid="pcbi.1005842.ref012">12</xref>, <xref ref-type="bibr" rid="pcbi.1005842.ref052">52</xref>], and methods for properly estimating these structured covariances have been proposed [<xref ref-type="bibr" rid="pcbi.1005842.ref012">12</xref>, <xref ref-type="bibr" rid="pcbi.1005842.ref053">53</xref>]. To relax this assumption we can consider an extra, pre-whitening stage in the algorithm, where traces are pre-multiplied by a suitable whitening matrix. This matrix can be estimated by using stimulation-free data (e.g. while obtaining the EIs) as in [<xref ref-type="bibr" rid="pcbi.1005842.ref012">12</xref>]. The use of a more accurate noise model might be helpful as a means to decrease the signal-to-noise ratio under which the algorithm can operate: here, we discarded neurons whose EI peak strength was smaller than 30 <italic>μ</italic> V (across all electrodes), as the guarantees for accurate spike identification were lost in that case. If this threshold of 30 can be decreased then cells with typically smaller spikes (e.g. retinal midget cells) could be better identified.</p>
</sec>
<sec id="sec035">
<title>Saturation</title>
<p>Amplifier saturation is a common problem in electrical stimulation systems [<xref ref-type="bibr" rid="pcbi.1005842.ref014">14</xref>, <xref ref-type="bibr" rid="pcbi.1005842.ref016">16</xref>, <xref ref-type="bibr" rid="pcbi.1005842.ref019">19</xref>], and arises when the actual voltage (comprising artifacts and neural activities) exceeds the saturation limit of the stimulation hardware. Although in this work we have considered stimulation regimes that did not lead to saturation, we emphasize that our method would be helpful to deal with saturated traces as well: indeed, in opposition to naive approaches that would lead to no other choice than throwing away entire saturated recordings, our model-based approach enables a more efficient treatment of saturation-corrupted data. We can understand this problem as an example of inference in the context of partially missing observations, for which methods are already available in the GP framework [<xref ref-type="bibr" rid="pcbi.1005842.ref032">32</xref>].</p>
<p>Finally, notice the above rationale applies not only to saturation, but also to any type of data corruption that could render the recordings at certain electrodes useless.</p>
</sec>
<sec id="sec036">
<title>Automatic detection of failures and post-processing</title>
<p>Since errors cannot be fully avoided, in order to enhance confidence in neural activity estimates provided by the algorithm in the absence of rapid human analysis, we propose to consider diagnostic measures to flag suspicious situations that could be indicative of an algorithmic failure. We consider two measures that arise from a careful analysis of the underlying causes of discrepancies between algorithm and human annotation.</p>
<p>The first comes from the activation curves: at least in the retina, it has been widely documented that these should be smoothly increasing functions of the stimulus strength [<xref ref-type="bibr" rid="pcbi.1005842.ref025">25</xref>, <xref ref-type="bibr" rid="pcbi.1005842.ref039">39</xref>]. Therefore, deviations from this expected behavior—e.g., non-smooth activation curves characterized by sudden increases or drops in spiking probability—are indicative of potential problems. For example, the outlier in <xref ref-type="fig" rid="pcbi.1005842.g006">Fig 6D</xref> and many of the false positives in <xref ref-type="fig" rid="pcbi.1005842.g006">Fig 6C</xref> are the result of an incorrectly inferred sudden increase of spiking from one stimulus amplitude to the next. Moreover, often this sudden increase is ultimately caused by a wrong extrapolation estimate, either with the kernel-based or naive extrapolation estimators. Thus, the application of this simple post-processing criterion (detection of sudden increases in spiking probability) would mark this cell for revised analysis.</p>
<p>The second relates to the residuals, or the difference between observed data and the sum of artifact and neural activity. Cases where those residuals are relatively large could indicate a failure in detecting spikes, perhaps due to a mismatch between a mis-specified EI and observed data. Indeed, we observed many cases where results were wrong because recordings contained activity that did not match any of the available templates. In such cases it is hard even for a human to make a judgment, as he or she has to carefully decide whether the observed activity corresponds to an available inaccurate EI or rather, to a truly spiking neuron that was not identified during the EI creation stage. We have reported these as errors, but we highlight they were propagated from the previous spike sorting stage. Therefore, methods to quantify the per-neuron credibility of the templates, such as those developed in [<xref ref-type="bibr" rid="pcbi.1005842.ref054">54</xref>], are of crucial importance here to complement the above residual criterion.</p>
<p>In either case, the diagnostic measures can be implemented as an automatic procedure based on goodness-of-fit statistics (e.g. the deviance [<xref ref-type="bibr" rid="pcbi.1005842.ref055">55</xref>]), or even simpler quantities (e.g. an abrupt increase in firing probability between two consecutive values). Moreover, we have showed in related work [<xref ref-type="bibr" rid="pcbi.1005842.ref056">56</xref>] that these automatic diagnostics can be implemented in a further post-processing stage, where the artifact is locally re-sampled or interpolated from the Gaussian model if a possible error has been diagnosed.</p>
</sec>
<sec id="sec037">
<title>Larger and denser arrays, different time scales</title>
<p>In this work, the computationally limiting factor is <italic>E</italic>, the number of electrodes, as this dominates the (cubic) computational time of the GP inference steps. Recent advances in the scalable GP literature [<xref ref-type="bibr" rid="pcbi.1005842.ref057">57</xref>–<xref ref-type="bibr" rid="pcbi.1005842.ref059">59</xref>] should be useful for extending our methods to even larger arrays as needed; we plan to pursue these extensions in future work.</p>
<p>Finally, we also note that an extension to denser arrays (e.g. [<xref ref-type="bibr" rid="pcbi.1005842.ref060">60</xref>]) is immediately available within our framework: indeed, preliminary results with denser arrays (30<italic>μm</italic> spacing between electrodes) revealed that due to the increased proximity between the stimulating electrode and its neighboring electrodes, those electrodes also possessed large artifacts and were subject to the effect of breakpoints. Then, we can proceed exactly as we did in Simplifications and extensions for local return, by considering different models for the stimulating electrode and its neighbors.</p>
</sec>
</sec>
<sec id="sec038">
<title>Conclusion</title>
<p>We have developed a method to automate spike sorting in electrical stimulation experiments using large MEAs, where artifacts are a concern. We believe our developments will be useful to enable closed-loop neural stimulation at a much larger scale than was previously possible, and to enhance the ability to actively control neural activity. Also, our algorithm has the potential to constitute an important computational substrate for the development of future neural prostheses, particularly epi-retinal prostheses. We have made available, in the first author’s website, MATLAB code that contains an example applying the algorithm to process one of the datasets analyzed in this paper.</p>
</sec>
</sec>
<sec id="sec039">
<title>Supporting information</title>
<supplementary-material id="pcbi.1005842.s001" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005842.s001" xlink:type="simple">
<label>S1 Text</label>
<caption>
<title>Experimental procedures.</title>
<p>(PDF)</p>
</caption>
</supplementary-material>
<supplementary-material id="pcbi.1005842.s002" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005842.s002" xlink:type="simple">
<label>S2 Text</label>
<caption>
<title>Supplemental mathematical details.</title>
<p>(PDF)</p>
</caption>
</supplementary-material>
<supplementary-material id="pcbi.1005842.s003" mimetype="application/eps" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005842.s003" xlink:type="simple">
<label>S1 Fig</label>
<caption>
<title>Stimulation artifact details.</title>
<p><bold>A.</bold> Raw artifact traces at the smallest amplitude of stimulation (0.1 <italic>μA</italic>), considered an estimate of <italic>μ</italic>, the switching artifact. <bold>B.</bold> Raw artifact traces at 0.99 <italic>μA</italic> of stimulus. <bold>C.</bold> Difference. Notice that the main text refers to this already mean-subtracted artifact. <bold>D.</bold> <italic>Left</italic>: Raw artifact at all different stimuli for a non-stimulating electrode (inset, switching artifact). <italic>Right</italic>: Differences.</p>
<p>(EPS)</p>
</caption>
</supplementary-material>
<supplementary-material id="pcbi.1005842.s004" mimetype="application/eps" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005842.s004" xlink:type="simple">
<label>S2 Fig</label>
<caption>
<title>Population results(log scale) including the mean-of-traces estimator proposed in [<xref ref-type="bibr" rid="pcbi.1005842.ref020">20</xref>] and our simplified estimator.</title>
<p>These results complement <xref ref-type="fig" rid="pcbi.1005842.g006">Fig 6A</xref>, by reporting differences by type of estimator, and also by reporting total errors.</p>
<p>(EPS)</p>
</caption>
</supplementary-material>
<supplementary-material id="pcbi.1005842.s005" mimetype="application/eps" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005842.s005" xlink:type="simple">
<label>S3 Fig</label>
<caption>
<title>Comparison of simplified and kernel-based estimator in the analysis of perturbations to real data.</title>
<p>These results complement <xref ref-type="fig" rid="pcbi.1005842.g006">Fig 6B</xref>, by reporting false positive and negative rates at different conditions for trial subsampling (top), amplitude subsampling (middle) and noise injection (bottom). Only for single electrode stimulation. Notice that for trial sub-sampling and noise injection, results may vary from one experiment to another.</p>
<p>(EPS)</p>
</caption>
</supplementary-material>
<supplementary-material id="pcbi.1005842.s006" mimetype="application/eps" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005842.s006" xlink:type="simple">
<label>S4 Fig</label>
<caption>
<title>Distribution of EI strength on the stimulating electrode among spike events, both for somatic and axonal (distant) stimulation.</title>
<p>For somatic stimulation inset corresponds to a zoom to smallest voltages. For EI peak strengths smaller than 10<italic>μV</italic> spike is not observed (based on manual analysis).</p>
<p>(EPS)</p>
</caption>
</supplementary-material>
<supplementary-material id="pcbi.1005842.s007" mimetype="application/eps" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005842.s007" xlink:type="simple">
<label>S5 Fig</label>
<caption>
<title>Latency distribution.</title>
<p>Population based estimates of the mean (top) and standard deviation (bottom) of spike latency, as a function of probability of spiking (left) and stimulus amplitude (right). This supports the observation that when activation is reached (high probability of spike) variability of latencies reaches its minimum.</p>
<p>(EPS)</p>
</caption>
</supplementary-material>
<supplementary-material id="pcbi.1005842.s008" mimetype="application/eps" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005842.s008" xlink:type="simple">
<label>S6 Fig</label>
<caption>
<title>The linear superposition of artifacts provides a reasonable phenomenological model for two electrode stimulation.</title>
<p>Observations are based on a single retinal preparation (TTX). <bold>A)</bold> example of observed linearity: <italic>A1-A2</italic>) artifacts for single electrode stimulation at two different stimulating electrodes with same strength (3.1 <italic>μ</italic> A) and opposite polarities. <italic>A3</italic>) corresponding two-electrode stimulation. <italic>A4</italic>) sum of <italic>A1</italic>) and <italic>A2</italic>). <italic>A5</italic>) difference between <italic>A3</italic>) and <italic>A4</italic>). <italic>A6</italic>) for reference, the EI of a typical neuron in shown in the same scale. <bold>B)</bold> population-based generalization of the finding in <bold>A)</bold> from thousands of stimulating electrode pairs, collapsing stimulating amplitudes and electrodes. <italic>B1-B2</italic>) scatterplots of the maximum strength (over electrodes and time) of two-electrode stimulation artifacts at different stimulus strengths (strength of the color) before and after subtracting the sum of single electrode artifacts. Points in the gray-scale are the ones shown in <bold>A)</bold>. <italic>B3</italic> histogram of log peak EI of neurons in the array. In the light of <italic>B3</italic>, <italic>B1,B2</italic> show in the vast majority of artifacts of magnitude comparable with than of EI (99% of points above the diagonal and outside the log-strength 2.5 <italic>μV</italic> boxes in <italic>B1,B2</italic>) subtracting the linear sum of individual artifacts is a sensible choice as it decreases its strength.</p>
<p>(EPS)</p>
</caption>
</supplementary-material>
</sec>
</body>
<back>
<ack>
<p>We thank David Blei Nishal Shah for useful discussions, Frederick Kellison-Linn and Victoria Fan for manual data analysis, Georges Goetz and Pulkit Tandon for computational assistance, and Mariano Gabitto and Ella Batty for their comments on the manuscript.</p>
</ack>
<ref-list>
<title>References</title>
<ref id="pcbi.1005842.ref001">
<label>1</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Wagenaar</surname> <given-names>DA</given-names></name>, <name name-style="western"><surname>Madhavan</surname> <given-names>R</given-names></name>, <name name-style="western"><surname>Pine</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Potter</surname> <given-names>SM</given-names></name>. <article-title>Controlling bursting in cortical cultures with closed-loop multi-electrode stimulation</article-title>. <source>The Journal of neuroscience</source>. <year>2005</year>;<volume>25</volume>(<issue>3</issue>):<fpage>680</fpage>–<lpage>688</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1523/JNEUROSCI.4209-04.2005" xlink:type="simple">10.1523/JNEUROSCI.4209-04.2005</ext-link></comment> <object-id pub-id-type="pmid">15659605</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005842.ref002">
<label>2</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Middlebrooks</surname> <given-names>JC</given-names></name>, <name name-style="western"><surname>Snyder</surname> <given-names>RL</given-names></name>. <article-title>Selective electrical stimulation of the auditory nerve activates a pathway specialized for high temporal acuity</article-title>. <source>The Journal of Neuroscience</source>. <year>2010</year>;<volume>30</volume>(<issue>5</issue>):<fpage>1937</fpage>–<lpage>1946</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1523/JNEUROSCI.4949-09.2010" xlink:type="simple">10.1523/JNEUROSCI.4949-09.2010</ext-link></comment> <object-id pub-id-type="pmid">20130202</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005842.ref003">
<label>3</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Meacham</surname> <given-names>KW</given-names></name>, <name name-style="western"><surname>Guo</surname> <given-names>L</given-names></name>, <name name-style="western"><surname>DeWeerth</surname> <given-names>SP</given-names></name>, <name name-style="western"><surname>Hochman</surname> <given-names>S</given-names></name>. <source>Selective stimulation of the spinal cord surface using a stretchable microelectrode array</source>. <year>2011</year>;.</mixed-citation>
</ref>
<ref id="pcbi.1005842.ref004">
<label>4</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Bakkum</surname> <given-names>DJ</given-names></name>, <name name-style="western"><surname>Frey</surname> <given-names>U</given-names></name>, <name name-style="western"><surname>Radivojevic</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Russell</surname> <given-names>TL</given-names></name>, <name name-style="western"><surname>Muller</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Fiscella</surname> <given-names>M</given-names></name>, <etal>et al</etal>. <article-title>Tracking axonal action potential propagation on a high-density microelectrode array across hundreds of sites</article-title>. <source>Nature Communications</source>. <year>2013</year>;<volume>4</volume>(<issue>2181</issue>). <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1038/ncomms3181" xlink:type="simple">10.1038/ncomms3181</ext-link></comment> <object-id pub-id-type="pmid">23867868</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005842.ref005">
<label>5</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Kim</surname> <given-names>R</given-names></name>, <name name-style="western"><surname>Joo</surname> <given-names>S</given-names></name>, <name name-style="western"><surname>Jung</surname> <given-names>H</given-names></name>, <name name-style="western"><surname>Hong</surname> <given-names>N</given-names></name>, <name name-style="western"><surname>Nam</surname> <given-names>Y</given-names></name>. <article-title>Recent trends in microelectrode array technology for in vitro neural interface platform</article-title>. <source>Biomedical Engineering Letters</source>. <year>2014</year>;<volume>4</volume>(<issue>2</issue>):<fpage>129</fpage>–<lpage>141</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1005842.ref006">
<label>6</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Jorgenson</surname> <given-names>LA</given-names></name>, <name name-style="western"><surname>Newsome</surname> <given-names>WT</given-names></name>, <name name-style="western"><surname>Anderson</surname> <given-names>DJ</given-names></name>, <name name-style="western"><surname>Bargmann</surname> <given-names>CI</given-names></name>, <name name-style="western"><surname>Brown</surname> <given-names>EN</given-names></name>, <name name-style="western"><surname>Deisseroth</surname> <given-names>K</given-names></name>, <etal>et al</etal>. <article-title>The BRAIN Initiative: developing technology to catalyse neuroscience discovery</article-title>. <source>Philosophical Transactions of the Royal Society of London B: Biological Sciences</source>. <year>2015</year>;<volume>370</volume>(<issue>1668</issue>). <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1098/rstb.2014.0164" xlink:type="simple">10.1098/rstb.2014.0164</ext-link></comment> <object-id pub-id-type="pmid">25823863</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005842.ref007">
<label>7</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Barry</surname> <given-names>MP</given-names></name>, <name name-style="western"><surname>Dagnelie</surname> <given-names>G</given-names></name>. <article-title>Use of the Argus II Retinal Prosthesis to Improve Visual Guidance of Fine Hand Movements</article-title>. <source>Investigative ophthalmology &amp; visual science</source>. <year>2012</year>;<volume>53</volume>(<issue>9</issue>):<fpage>5095</fpage>–<lpage>5101</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1167/iovs.12-9536" xlink:type="simple">10.1167/iovs.12-9536</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1005842.ref008">
<label>8</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Goetz</surname> <given-names>GA</given-names></name>, <name name-style="western"><surname>Palanker</surname> <given-names>DV</given-names></name>. <article-title>Electronic approaches to restoration of sight</article-title>. <source>Reports on Progress in Physics</source>. <year>2016</year>;<volume>79</volume>(<issue>9</issue>):<fpage>096701</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1088/0034-4885/79/9/096701" xlink:type="simple">10.1088/0034-4885/79/9/096701</ext-link></comment> <object-id pub-id-type="pmid">27502748</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005842.ref009">
<label>9</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Franke</surname> <given-names>F</given-names></name>, <name name-style="western"><surname>Jakel</surname> <given-names>D</given-names></name>, <name name-style="western"><surname>Dragas</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Muller</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Radivojevic</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Bakkum</surname> <given-names>D</given-names></name>, <etal>et al</etal>. <article-title>High-density microelectrode array recordings and real-time spike sorting for closed-loop experiments: an emerging technology to study neural plasticity</article-title>. <source>Frontiers in Neural Circuits</source>. <year>2012</year>;<volume>6</volume>(<issue>105</issue>). <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.3389/fncir.2012.00105" xlink:type="simple">10.3389/fncir.2012.00105</ext-link></comment> <object-id pub-id-type="pmid">23267316</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005842.ref010">
<label>10</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Potter</surname> <given-names>SM</given-names></name>, <name name-style="western"><surname>El Hady</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Fetz</surname> <given-names>EE</given-names></name>. <article-title>Closed-Loop Neuroscience and Neuroengineering</article-title>. <source>Frontiers in Neural Circuits</source>. <year>2014</year>;<volume>8</volume>(<issue>115</issue>). <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.3389/fncir.2014.00115" xlink:type="simple">10.3389/fncir.2014.00115</ext-link></comment> <object-id pub-id-type="pmid">25294988</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005842.ref011">
<label>11</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Lewicki</surname> <given-names>MS</given-names></name>. <article-title>A review of methods for spike sorting: the detection and classification of neural action potentials</article-title>. <source>Network: Computation in Neural Systems</source>. <year>1998</year>;<volume>9</volume>(<issue>4</issue>):<fpage>R53</fpage>–<lpage>R78</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1088/0954-898X_9_4_001" xlink:type="simple">10.1088/0954-898X_9_4_001</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1005842.ref012">
<label>12</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Pillow</surname> <given-names>JW</given-names></name>, <name name-style="western"><surname>Shlens</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Chichilnisky</surname> <given-names>EJ</given-names></name>, <name name-style="western"><surname>Simoncelli</surname> <given-names>EP</given-names></name>. <article-title>A Model-Based Spike Sorting Algorithm for Removing Correlation Artifacts in Multi-Neuron Recordings</article-title>. <source>PLoS ONE</source>. <year>2013</year>;<volume>8</volume>(<issue>5</issue>):<fpage>e62123</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1371/journal.pone.0062123" xlink:type="simple">10.1371/journal.pone.0062123</ext-link></comment> <object-id pub-id-type="pmid">23671583</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005842.ref013">
<label>13</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Rey</surname> <given-names>HG</given-names></name>, <name name-style="western"><surname>Pedreira</surname> <given-names>C</given-names></name>, <name name-style="western"><surname>Quiroga</surname> <given-names>RQ</given-names></name>. <article-title>Past, present and future of spike sorting techniques</article-title>. <source>Brain research bulletin</source>. <year>2015</year>;<volume>119</volume>:<fpage>106</fpage>–<lpage>117</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.brainresbull.2015.04.007" xlink:type="simple">10.1016/j.brainresbull.2015.04.007</ext-link></comment> <object-id pub-id-type="pmid">25931392</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005842.ref014">
<label>14</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Merletti</surname> <given-names>R</given-names></name>, <name name-style="western"><surname>Knaflitz</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>De Luca</surname> <given-names>CJ</given-names></name>, <etal>et al</etal>. <article-title>Electrically evoked myoelectric signals</article-title>. <source>Crit Rev Biomed Eng</source>. <year>1992</year>;<volume>19</volume>(<issue>4</issue>):<fpage>293</fpage>–<lpage>340</lpage>. <object-id pub-id-type="pmid">1563271</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005842.ref015">
<label>15</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Hottowy</surname> <given-names>P</given-names></name>, <name name-style="western"><surname>Dąbrowski</surname> <given-names>W</given-names></name>, <name name-style="western"><surname>Kachiguine</surname> <given-names>S</given-names></name>, <name name-style="western"><surname>Skoczen</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Fiutowski</surname> <given-names>T</given-names></name>, <name name-style="western"><surname>Sher</surname> <given-names>A</given-names></name>, <etal>et al</etal>. <article-title>An MEA-based system for multichannel, low artifact stimulation and recording of neural activity</article-title>. <source>Proc 6th Int Meet Substrate-integrated Micro Electrode Arrays</source>. <year>2008</year>; p. <fpage>261</fpage>–<lpage>265</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1005842.ref016">
<label>16</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Hottowy</surname> <given-names>P</given-names></name>, <name name-style="western"><surname>Skoczen</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Gunning</surname> <given-names>DE</given-names></name>, <name name-style="western"><surname>Kachiguine</surname> <given-names>S</given-names></name>, <name name-style="western"><surname>Mathieson</surname> <given-names>K</given-names></name>, <name name-style="western"><surname>Sher</surname> <given-names>A</given-names></name>, <etal>et al</etal>. <article-title>Properties and application of a multichannel integrated circuit for low-artifact, patterned electrical stimulation of neural tissue</article-title>. <source>Journal of neural engineering</source>. <year>2012</year>;<volume>9</volume>(<issue>6</issue>):<fpage>066005</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1088/1741-2560/9/6/066005" xlink:type="simple">10.1088/1741-2560/9/6/066005</ext-link></comment> <object-id pub-id-type="pmid">23160018</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005842.ref017">
<label>17</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Brown</surname> <given-names>EA</given-names></name>, <name name-style="western"><surname>Ross</surname> <given-names>JD</given-names></name>, <name name-style="western"><surname>Blum</surname> <given-names>RA</given-names></name>, <name name-style="western"><surname>Nam</surname> <given-names>Y</given-names></name>, <name name-style="western"><surname>Wheeler</surname> <given-names>BC</given-names></name>, <name name-style="western"><surname>Deweerth</surname> <given-names>SP</given-names></name>. <source>Stimulus-Artifact Elimination in a Multi-Electrode System</source>. <year>2008</year>;<volume>2</volume>(<issue>1</issue>):<fpage>10</fpage>–<lpage>21</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1005842.ref018">
<label>18</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Wichmann</surname> <given-names>T</given-names></name>, <name name-style="western"><surname>Devergnas</surname> <given-names>A</given-names></name>. <article-title>A novel device to suppress electrical stimulus artifacts in electrophysiological experiments</article-title>. <source>Journal of Neuroscience Methods</source>. <year>2011</year>;<volume>201</volume>(<issue>1</issue>):<fpage>1</fpage>–<lpage>8</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.jneumeth.2011.06.026" xlink:type="simple">10.1016/j.jneumeth.2011.06.026</ext-link></comment> <object-id pub-id-type="pmid">21745499</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005842.ref019">
<label>19</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Obien</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Deligkaris</surname> <given-names>K</given-names></name>, <name name-style="western"><surname>Bullmann</surname> <given-names>T</given-names></name>, <name name-style="western"><surname>Bakkum</surname> <given-names>DJ</given-names></name>, <name name-style="western"><surname>Frey</surname> <given-names>U</given-names></name>. <article-title>Revealing neuronal function through microelectrode array recordings</article-title>. <source>Frontiers in neuroscience</source>. <year>2015</year>;<volume>8</volume>:<fpage>423</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.3389/fnins.2014.00423" xlink:type="simple">10.3389/fnins.2014.00423</ext-link></comment> <object-id pub-id-type="pmid">25610364</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005842.ref020">
<label>20</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Hashimoto</surname> <given-names>T</given-names></name>, <name name-style="western"><surname>Elder</surname> <given-names>CM</given-names></name>, <name name-style="western"><surname>Vitek</surname> <given-names>JL</given-names></name>. <article-title>A template subtraction method for stimulus artifact removal in high-frequency deep brain stimulation</article-title>. <source>Journal of Neuroscience Methods</source>. <year>2002</year>;<volume>113</volume>:<fpage>181</fpage>–<lpage>186</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/S0165-0270(01)00491-5" xlink:type="simple">10.1016/S0165-0270(01)00491-5</ext-link></comment> <object-id pub-id-type="pmid">11772439</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005842.ref021">
<label>21</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Wagenaar</surname> <given-names>D</given-names></name>, <name name-style="western"><surname>Potter</surname> <given-names>SM</given-names></name>. <article-title>Real-time multi-channel stimulus artifact suppression by local curve fitting</article-title>. <source>Journal of Neuroscience Methods</source>. <year>2002</year>;<volume>120</volume>:<fpage>113</fpage>–<lpage>120</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/S0165-0270(02)00149-8" xlink:type="simple">10.1016/S0165-0270(02)00149-8</ext-link></comment> <object-id pub-id-type="pmid">12385761</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005842.ref022">
<label>22</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Heffer</surname> <given-names>LF</given-names></name>, <name name-style="western"><surname>Fallon</surname> <given-names>JB</given-names></name>. <article-title>A novel stimulus artifact removal technique for high-rate electrical stimulation</article-title>. <source>Journal of Neuroscience Methods</source>. <year>2008</year>;<volume>170</volume>:<fpage>277</fpage>–<lpage>284</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.jneumeth.2008.01.023" xlink:type="simple">10.1016/j.jneumeth.2008.01.023</ext-link></comment> <object-id pub-id-type="pmid">18339428</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005842.ref023">
<label>23</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Erez</surname> <given-names>Y</given-names></name>, <name name-style="western"><surname>Tischler</surname> <given-names>H</given-names></name>, <name name-style="western"><surname>Moran</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Bar-gad</surname> <given-names>I</given-names></name>. <article-title>Generalized framework for stimulus artifact removal</article-title>. <source>Journal of Neuroscience Methods</source>. <year>2010</year>;<volume>191</volume>(<issue>1</issue>):<fpage>45</fpage>–<lpage>59</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.jneumeth.2010.06.005" xlink:type="simple">10.1016/j.jneumeth.2010.06.005</ext-link></comment> <object-id pub-id-type="pmid">20542059</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005842.ref024">
<label>24</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Müller</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Bakkum</surname> <given-names>DJ</given-names></name>, <name name-style="western"><surname>Hierlemann</surname> <given-names>A</given-names></name>. <article-title>Sub-millisecond closed-loop feedback stimulation between arbitrary sets of individual neurons</article-title>. <source>Closing the Loop Around Neural Systems</source>. <year>2014</year>; p. <fpage>38</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1005842.ref025">
<label>25</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Sekirnjak</surname> <given-names>C</given-names></name>, <name name-style="western"><surname>Hottowy</surname> <given-names>P</given-names></name>, <name name-style="western"><surname>Sher</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Dabrowski</surname> <given-names>W</given-names></name>, <name name-style="western"><surname>Litke</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Chichilnisky</surname> <given-names>E</given-names></name>. <article-title>Electrical stimulation of mammalian retinal ganglion cells with multielectrode arrays</article-title>. <source>Journal of neurophysiology</source>. <year>2006</year>;<volume>95</volume>(<issue>6</issue>):<fpage>3311</fpage>–<lpage>3327</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1152/jn.01168.2005" xlink:type="simple">10.1152/jn.01168.2005</ext-link></comment> <object-id pub-id-type="pmid">16436479</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005842.ref026">
<label>26</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Sekirnjak</surname> <given-names>C</given-names></name>, <name name-style="western"><surname>Hottowy</surname> <given-names>P</given-names></name>, <name name-style="western"><surname>Sher</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Dabrowski</surname> <given-names>W</given-names></name>, <name name-style="western"><surname>Litke</surname> <given-names>AM</given-names></name>, <name name-style="western"><surname>Chichilnisky</surname> <given-names>E</given-names></name>. <article-title>High-resolution electrical stimulation of primate retina for epiretinal implant design</article-title>. <source>The Journal of neuroscience</source>. <year>2008</year>;<volume>28</volume>(<issue>17</issue>):<fpage>4446</fpage>–<lpage>4456</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1523/JNEUROSCI.5138-07.2008" xlink:type="simple">10.1523/JNEUROSCI.5138-07.2008</ext-link></comment> <object-id pub-id-type="pmid">18434523</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005842.ref027">
<label>27</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Litke</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Bezayiff</surname> <given-names>N</given-names></name>, <name name-style="western"><surname>Chichilnisky</surname> <given-names>EJ</given-names></name>, <name name-style="western"><surname>Cunningham</surname> <given-names>W</given-names></name>, <name name-style="western"><surname>Dabrowski</surname> <given-names>W</given-names></name>, <name name-style="western"><surname>Grillo</surname> <given-names>A</given-names></name>, <etal>et al</etal>. <article-title>What does the eye tell the brain?: Development of a system for the large-scale recording of retinal output activity</article-title>. <source>IEEE Transactions on Nuclear Science</source>. <year>2004</year>;<volume>51</volume>(<issue>4</issue>):<fpage>1434</fpage>–<lpage>1440</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1109/TNS.2004.832706" xlink:type="simple">10.1109/TNS.2004.832706</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1005842.ref028">
<label>28</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Jepson</surname> <given-names>LH</given-names></name>, <name name-style="western"><surname>Hottowy</surname> <given-names>P</given-names></name>, <name name-style="western"><surname>Mathieson</surname> <given-names>K</given-names></name>, <name name-style="western"><surname>Gunning</surname> <given-names>DE</given-names></name>, <name name-style="western"><surname>Dabrowski</surname> <given-names>W</given-names></name>, <name name-style="western"><surname>Litke</surname> <given-names>AM</given-names></name>, <etal>et al</etal>. <article-title>Spatially Patterned Electrical Stimulation to Enhance Resolution of Retinal Prostheses</article-title>. <source>J Neurosci</source>. <year>2014</year>;<volume>34</volume>(<issue>14</issue>):<fpage>487</fpage>–<lpage>4881</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1523/JNEUROSCI.2882-13.2014" xlink:type="simple">10.1523/JNEUROSCI.2882-13.2014</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1005842.ref029">
<label>29</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Zanos</surname> <given-names>TP</given-names></name>, <name name-style="western"><surname>Mineault</surname> <given-names>PJ</given-names></name>, <name name-style="western"><surname>Pack</surname> <given-names>CC</given-names></name>. <article-title>Removal of spurious correlations between spikes and local field potentials</article-title>. <source>Journal of neurophysiology</source>. <year>2011</year>;<volume>105</volume>(<issue>1</issue>):<fpage>474</fpage>–<lpage>486</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1152/jn.00642.2010" xlink:type="simple">10.1152/jn.00642.2010</ext-link></comment> <object-id pub-id-type="pmid">21068271</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005842.ref030">
<label>30</label>
<mixed-citation publication-type="book" xlink:type="simple">
<name name-style="western"><surname>Ekanadham</surname> <given-names>C</given-names></name>, <name name-style="western"><surname>Tranchina</surname> <given-names>D</given-names></name>, <name name-style="western"><surname>Simoncelli</surname> <given-names>EP</given-names></name>. <source>A blind sparse deconvolution method for neural spike identification</source>. In: <name name-style="western"><surname>Shawe-Taylor</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Zemel</surname> <given-names>RS</given-names></name>, <name name-style="western"><surname>Bartlett</surname> <given-names>PL</given-names></name>, <name name-style="western"><surname>Pereira</surname> <given-names>FCN</given-names></name>, <name name-style="western"><surname>Weinberger</surname> <given-names>KQ</given-names></name>, editors. <publisher-name>NIPS</publisher-name>; <year>2011</year>. p. <fpage>1440</fpage>–<lpage>1448</lpage>. Available from: <ext-link ext-link-type="uri" xlink:href="http://dblp.uni-trier.de/db/conf/nips/nips2011.html#EkanadhamTS11" xlink:type="simple">http://dblp.uni-trier.de/db/conf/nips/nips2011.html#EkanadhamTS11</ext-link>.</mixed-citation>
</ref>
<ref id="pcbi.1005842.ref031">
<label>31</label>
<mixed-citation publication-type="book" xlink:type="simple">
<name name-style="western"><surname>Rasmussen</surname> <given-names>CE</given-names></name>, <name name-style="western"><surname>Williams</surname> <given-names>CKI</given-names></name>. <source>Gaussian Processes for Machine Learning</source>. <publisher-name>MIT Press</publisher-name>; <year>2006</year>.</mixed-citation>
</ref>
<ref id="pcbi.1005842.ref032">
<label>32</label>
<mixed-citation publication-type="other" xlink:type="simple">Wilson A, Gilboa E, Nehorai A, Cunningham JP. Fast kernel learning for multidimensional pattern extrapolation. In: Advances in Neural Information Processing Systems; 2014. p. 3626–3634.</mixed-citation>
</ref>
<ref id="pcbi.1005842.ref033">
<label>33</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Gilboa</surname> <given-names>E</given-names></name>, <name name-style="western"><surname>Saatçi</surname> <given-names>Y</given-names></name>, <name name-style="western"><surname>Cunningham</surname> <given-names>JP</given-names></name>. <article-title>Scaling multidimensional inference for structured Gaussian processes</article-title>. <source>Pattern Analysis and Machine Intelligence, IEEE Transactions on</source>. <year>2015</year>;<volume>37</volume>(<issue>2</issue>):<fpage>424</fpage>–<lpage>436</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1109/TPAMI.2013.192" xlink:type="simple">10.1109/TPAMI.2013.192</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1005842.ref034">
<label>34</label>
<mixed-citation publication-type="book" xlink:type="simple">
<name name-style="western"><surname>Saatçi</surname> <given-names>Y</given-names></name>. <source>Scalable inference for structured Gaussian process models</source>. <publisher-name>University of Cambridge</publisher-name>; <year>2012</year>.</mixed-citation>
</ref>
<ref id="pcbi.1005842.ref035">
<label>35</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Genton</surname> <given-names>MG</given-names></name>. <article-title>Classes of kernels for Machine Learning: a statistics perspective</article-title>. <source>Journal of machine learning research</source>. <year>2001</year>;<volume>2</volume>(<month>Dec</month>):<fpage>299</fpage>–<lpage>312</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1005842.ref036">
<label>36</label>
<mixed-citation publication-type="book" xlink:type="simple">
<name name-style="western"><surname>Karatzas</surname> <given-names>I</given-names></name>, <name name-style="western"><surname>Shreve</surname> <given-names>S</given-names></name>. <source>Brownian motion and stochastic calculus</source>. <volume>vol. 113</volume>. <publisher-name>Springer Science &amp; Business Media</publisher-name>; <year>2012</year>.</mixed-citation>
</ref>
<ref id="pcbi.1005842.ref037">
<label>37</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Maturana</surname> <given-names>MI</given-names></name>, <name name-style="western"><surname>Apollo</surname> <given-names>NV</given-names></name>, <name name-style="western"><surname>Hadjinicolaou</surname> <given-names>AE</given-names></name>, <name name-style="western"><surname>Garrett</surname> <given-names>DJ</given-names></name>, <name name-style="western"><surname>Cloherty</surname> <given-names>SL</given-names></name>, <name name-style="western"><surname>Kameneva</surname> <given-names>T</given-names></name>, <etal>et al</etal>. <article-title>A Simple and Accurate Model to Predict Responses to Multi-electrode Stimulation in the Retina</article-title>. <source>PLoS Comput Biol</source>. <year>2016</year>;<volume>12</volume>(<issue>4</issue>):<fpage>e1004849</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1371/journal.pcbi.1004849" xlink:type="simple">10.1371/journal.pcbi.1004849</ext-link></comment> <object-id pub-id-type="pmid">27035143</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005842.ref038">
<label>38</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Rattay</surname> <given-names>F</given-names></name>, <name name-style="western"><surname>Resatz</surname> <given-names>S</given-names></name>. <article-title>Effective electrode configuration for selective stimulation with inner eye prostheses</article-title>. <source>IEEE transactions on biomedical engineering</source>. <year>2004</year>;<volume>51</volume>(<issue>9</issue>):<fpage>1659</fpage>–<lpage>1664</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1109/TBME.2004.828044" xlink:type="simple">10.1109/TBME.2004.828044</ext-link></comment> <object-id pub-id-type="pmid">15376514</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005842.ref039">
<label>39</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Jepson</surname> <given-names>LH</given-names></name>, <name name-style="western"><surname>Hottowy</surname> <given-names>P</given-names></name>, <name name-style="western"><surname>Mathieson</surname> <given-names>K</given-names></name>, <name name-style="western"><surname>Gunning</surname> <given-names>DE</given-names></name>, <name name-style="western"><surname>Dabrowski</surname> <given-names>W</given-names></name>, <name name-style="western"><surname>Litke</surname> <given-names>AM</given-names></name>, <etal>et al</etal>. <article-title>Focal electrical stimulation of major ganglion cell types in the primate retina for the design of visual prostheses</article-title>. <source>The Journal of Neuroscience</source>. <year>2013</year>;<volume>33</volume>(<issue>17</issue>):<fpage>7194</fpage>–<lpage>7205</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1523/JNEUROSCI.4967-12.2013" xlink:type="simple">10.1523/JNEUROSCI.4967-12.2013</ext-link></comment> <object-id pub-id-type="pmid">23616529</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005842.ref040">
<label>40</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Jepson</surname> <given-names>LH</given-names></name>, <name name-style="western"><surname>Hottowy</surname> <given-names>P</given-names></name>, <name name-style="western"><surname>Weiner</surname> <given-names>GA</given-names></name>, <name name-style="western"><surname>Dabrowski</surname> <given-names>W</given-names></name>, <name name-style="western"><surname>Litke</surname> <given-names>AM</given-names></name>, <name name-style="western"><surname>Chichilnisky</surname> <given-names>EJ</given-names></name>. <article-title>High-Fidelity Reproduction of Spatiotemporal Visual Signals for Retinal Prosthesis</article-title>. <source>Neuron</source>. <year>2014</year>;<volume>83</volume>(<issue>1</issue>):<fpage>87</fpage>–<lpage>92</lpage>. <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1016/j.neuron.2014.04.044" xlink:type="simple">http://dx.doi.org/10.1016/j.neuron.2014.04.044</ext-link>. <object-id pub-id-type="pmid">24910077</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005842.ref041">
<label>41</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Grosberg</surname> <given-names>LE</given-names></name>, <name name-style="western"><surname>Hottowy</surname> <given-names>P</given-names></name>, <name name-style="western"><surname>Jepson</surname> <given-names>LH</given-names></name>, <name name-style="western"><surname>Ito</surname> <given-names>S</given-names></name>, <name name-style="western"><surname>Kellison-Linn</surname> <given-names>F</given-names></name>, <name name-style="western"><surname>Sher</surname> <given-names>A</given-names></name>, <etal>et al</etal>. <article-title>Axon activation with focal epiretinal stimulation in primate retina</article-title>. <source>Investigative Ophthalmology &amp; Visual Science</source>. <year>2015</year>;<volume>56</volume>(<issue>7</issue>):<fpage>780</fpage>–<lpage>780</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1005842.ref042">
<label>42</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Fine</surname> <given-names>I</given-names></name>, <name name-style="western"><surname>Cepko</surname> <given-names>CL</given-names></name>, <name name-style="western"><surname>Landy</surname> <given-names>MS</given-names></name>. <article-title>Vision research special issue: Sight restoration: Prosthetics, optogenetics and gene therapy</article-title>. <source>Vision Res</source>. <year>2015</year>;<volume>111</volume>(<issue>Pt B</issue>):<fpage>115</fpage>–<lpage>23</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.visres.2015.04.012" xlink:type="simple">10.1016/j.visres.2015.04.012</ext-link></comment> <object-id pub-id-type="pmid">25937376</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005842.ref043">
<label>43</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Grumet</surname> <given-names>AE</given-names></name>, <name name-style="western"><surname>Wyatt</surname> <given-names>JL</given-names></name>, <name name-style="western"><surname>Rizzo</surname> <given-names>JF</given-names></name>. <article-title>Multi-electrode stimulation and recording in the isolated retina</article-title>. <source>Journal of neuroscience methods</source>. <year>2000</year>;<volume>101</volume>(<issue>1</issue>):<fpage>31</fpage>–<lpage>42</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/S0165-0270(00)00246-6" xlink:type="simple">10.1016/S0165-0270(00)00246-6</ext-link></comment> <object-id pub-id-type="pmid">10967359</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005842.ref044">
<label>44</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Grosberg</surname> <given-names>LE</given-names></name>, <name name-style="western"><surname>Ganesan</surname> <given-names>K</given-names></name>, <name name-style="western"><surname>Goetz</surname> <given-names>GA</given-names></name>, <name name-style="western"><surname>Madugula</surname> <given-names>SS</given-names></name>, <name name-style="western"><surname>Bhaskhar</surname> <given-names>N</given-names></name>, <name name-style="western"><surname>Fan</surname> <given-names>V</given-names></name>, <etal>et al</etal>. <article-title>Activation of ganglion cells and axon bundles using epiretinal electrical stimulation</article-title>. <source>Journal of Neurophysiology</source>. <year>2017</year>;<volume>118</volume>(<issue>3</issue>):<fpage>1457</fpage>–<lpage>1471</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1152/jn.00750.2016" xlink:type="simple">10.1152/jn.00750.2016</ext-link></comment> <object-id pub-id-type="pmid">28566464</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005842.ref045">
<label>45</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Pais-Vieira</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Yadav</surname> <given-names>AP</given-names></name>, <name name-style="western"><surname>Moreira</surname> <given-names>D</given-names></name>, <name name-style="western"><surname>Guggenmos</surname> <given-names>D</given-names></name>, <name name-style="western"><surname>Santos</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Lebedev</surname> <given-names>M</given-names></name>, <etal>et al</etal>. <article-title>A Closed Loop Brain-machine Interface for Epilepsy Control Using Dorsal Column Electrical Stimulation</article-title>. <source>Scientific Reports</source>. <year>2016</year>;<volume>6</volume>:<fpage>32814</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1038/srep32814" xlink:type="simple">10.1038/srep32814</ext-link></comment> <object-id pub-id-type="pmid">27605389</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005842.ref046">
<label>46</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Sakmann</surname> <given-names>B</given-names></name>, <name name-style="western"><surname>Creutzfeldt</surname> <given-names>OD</given-names></name>. <article-title>Scotopic and mesopic light adaptation in the cat’s retina</article-title>. <source>Pflügers Archiv</source>. <year>1969</year>;<volume>313</volume>(<issue>2</issue>):<fpage>168</fpage>–<lpage>185</lpage>. <object-id pub-id-type="pmid">5390975</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005842.ref047">
<label>47</label>
<mixed-citation publication-type="other" xlink:type="simple">Richard E, Goetz GA, Chichilnisky E. Recognizing retinal ganglion cells in the dark. In: Advances in Neural Information Processing Systems; 2015. p. 2476–2484.</mixed-citation>
</ref>
<ref id="pcbi.1005842.ref048">
<label>48</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Pachitariu</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Steinmetz</surname> <given-names>N</given-names></name>, <name name-style="western"><surname>Kadir</surname> <given-names>S</given-names></name>, <name name-style="western"><surname>Carandini</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Harris</surname> <given-names>KD</given-names></name>. <article-title>Kilosort: realtime spike-sorting for extracellular electrophysiology with hundreds of channels</article-title>. <source>bioRxiv</source>. <year>2016</year>; p. <fpage>061481</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1005842.ref049">
<label>49</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Yger</surname> <given-names>P</given-names></name>, <name name-style="western"><surname>Spampinato</surname> <given-names>GL</given-names></name>, <name name-style="western"><surname>Esposito</surname> <given-names>E</given-names></name>, <name name-style="western"><surname>Lefebvre</surname> <given-names>B</given-names></name>, <name name-style="western"><surname>Deny</surname> <given-names>S</given-names></name>, <name name-style="western"><surname>Gardella</surname> <given-names>C</given-names></name>, <etal>et al</etal>. <article-title>Fast and accurate spike sorting in vitro and in vivo for up to thousands of electrodes</article-title>. <source>bioRxiv</source>. <year>2016</year>; p. <fpage>067843</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1005842.ref050">
<label>50</label>
<mixed-citation publication-type="other" xlink:type="simple">Branchaud E, Burdick JW, Andersen R, et al. An algorithm for autonomous isolation of neurons in extracellular recordings. In: Biomedical Robotics and Biomechatronics, 2006. BioRob 2006. The First IEEE/RAS-EMBS International Conference on. IEEE; 2006. p. 939–945.</mixed-citation>
</ref>
<ref id="pcbi.1005842.ref051">
<label>51</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Franke</surname> <given-names>F</given-names></name>, <name name-style="western"><surname>Natora</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Boucsein</surname> <given-names>C</given-names></name>, <name name-style="western"><surname>Munk</surname> <given-names>MH</given-names></name>, <name name-style="western"><surname>Obermayer</surname> <given-names>K</given-names></name>. <article-title>An online spike detection and spike classification algorithm capable of instantaneous resolution of overlapping spikes</article-title>. <source>Journal of computational neuroscience</source>. <year>2010</year>;<volume>29</volume>(<issue>1–2</issue>):<fpage>127</fpage>–<lpage>148</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1007/s10827-009-0163-5" xlink:type="simple">10.1007/s10827-009-0163-5</ext-link></comment> <object-id pub-id-type="pmid">19499318</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005842.ref052">
<label>52</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Fee</surname> <given-names>MS</given-names></name>, <name name-style="western"><surname>Mitra</surname> <given-names>PP</given-names></name>, <name name-style="western"><surname>Kleinfeld</surname> <given-names>D</given-names></name>. <article-title>Automatic sorting of multiple unit neuronal signals in the presence of anisotropic and non-Gaussian variability</article-title>. <source>Journal of neuroscience methods</source>. <year>1996</year>;<volume>69</volume>(<issue>2</issue>):<fpage>175</fpage>–<lpage>188</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/S0165-0270(96)00050-7" xlink:type="simple">10.1016/S0165-0270(96)00050-7</ext-link></comment> <object-id pub-id-type="pmid">8946321</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005842.ref053">
<label>53</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Franke</surname> <given-names>F</given-names></name>, <name name-style="western"><surname>Quiroga</surname> <given-names>RQ</given-names></name>, <name name-style="western"><surname>Hierlemann</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Obermayer</surname> <given-names>K</given-names></name>. <article-title>Bayes optimal template matching for spike sorting–combining fisher discriminant analysis with optimal filtering</article-title>. <source>Journal of computational neuroscience</source>. <year>2015</year>;<volume>38</volume>(<issue>3</issue>):<fpage>439</fpage>–<lpage>459</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1007/s10827-015-0547-7" xlink:type="simple">10.1007/s10827-015-0547-7</ext-link></comment> <object-id pub-id-type="pmid">25652689</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005842.ref054">
<label>54</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Barnett</surname> <given-names>AH</given-names></name>, <name name-style="western"><surname>Magland</surname> <given-names>JF</given-names></name>, <name name-style="western"><surname>Greengard</surname> <given-names>LF</given-names></name>. <article-title>Validation of neural spike sorting algorithms without ground-truth information</article-title>. <source>Journal of neuroscience methods</source>. <year>2016</year>;<volume>264</volume>:<fpage>65</fpage>–<lpage>77</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.jneumeth.2016.02.022" xlink:type="simple">10.1016/j.jneumeth.2016.02.022</ext-link></comment> <object-id pub-id-type="pmid">26930629</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005842.ref055">
<label>55</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Hosmer</surname> <given-names>DW</given-names></name>, <name name-style="western"><surname>Hosmer</surname> <given-names>T</given-names></name>, <name name-style="western"><surname>Le Cessie</surname> <given-names>S</given-names></name>, <name name-style="western"><surname>Lemeshow</surname> <given-names>S</given-names></name>, <etal>et al</etal>. <article-title>A comparison of goodness-of-fit tests for the logistic regression model</article-title>. <source>Statistics in medicine</source>. <year>1997</year>;<volume>16</volume>(<issue>9</issue>):<fpage>965</fpage>–<lpage>980</lpage>. <object-id pub-id-type="pmid">9160492</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005842.ref056">
<label>56</label>
<mixed-citation publication-type="other" xlink:type="simple">Mena G, Grosberg L, Kellison-Linn F, Chichilnisky E, Paninski L. Large-scale multi electrode array spike sorting algorithm introducing concurrent recording and stimulation. In: NIPS workshop on Statistical Methods for Understanding Neural Systems; <year>2015</year>.</mixed-citation>
</ref>
<ref id="pcbi.1005842.ref057">
<label>57</label>
<mixed-citation publication-type="other" xlink:type="simple">Titsias MK. Variational learning of inducing variables in sparse Gaussian processes. In: International Conference on Artificial Intelligence and Statistics; 2009. p. 567–574.</mixed-citation>
</ref>
<ref id="pcbi.1005842.ref058">
<label>58</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Wilson</surname> <given-names>AG</given-names></name>, <name name-style="western"><surname>Nickisch</surname> <given-names>H</given-names></name>. <article-title>Kernel Interpolation for Scalable Structured Gaussian Processes (KISS-GP)</article-title>. <source>CoRR</source>. <year>2015</year>;abs/1503.01057.</mixed-citation>
</ref>
<ref id="pcbi.1005842.ref059">
<label>59</label>
<mixed-citation publication-type="other" xlink:type="simple">Hensman J, Matthews AG, Filippone M, Ghahramani Z. MCMC for Variationally Sparse Gaussian Processes. In: Cortes C, Lawrence ND, Lee DD, Sugiyama M, Garnett R, editors. Advances in Neural Information Processing Systems 28. Curran Associates, Inc.; 2015. p. 1648–1656. Available from: <ext-link ext-link-type="uri" xlink:href="http://papers.nips.cc/paper/5875-mcmc-for-variationally-sparse-gaussian-processes.pdf" xlink:type="simple">http://papers.nips.cc/paper/5875-mcmc-for-variationally-sparse-gaussian-processes.pdf</ext-link>.</mixed-citation>
</ref>
<ref id="pcbi.1005842.ref060">
<label>60</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Radivojevic</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Jäckel</surname> <given-names>D</given-names></name>, <name name-style="western"><surname>Altermatt</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Müller</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Viswam</surname> <given-names>V</given-names></name>, <name name-style="western"><surname>Hierlemann</surname> <given-names>A</given-names></name>, <etal>et al</etal>. <article-title>Electrical Identification and Selective Microstimulation of Neuronal Compartments Based on Features of Extracellular Action Potentials</article-title>. <source>Scientific Reports</source>. <year>2016</year>;<volume>6</volume>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1038/srep31332" xlink:type="simple">10.1038/srep31332</ext-link></comment> <object-id pub-id-type="pmid">27510732</object-id></mixed-citation>
</ref>
</ref-list>
</back>
</article>