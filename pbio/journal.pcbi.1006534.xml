<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="1.1d3" xml:lang="en">
<front>
<journal-meta>
<journal-id journal-id-type="nlm-ta">PLoS Comput Biol</journal-id>
<journal-id journal-id-type="publisher-id">plos</journal-id>
<journal-id journal-id-type="pmc">ploscomp</journal-id>
<journal-title-group>
<journal-title>PLOS Computational Biology</journal-title>
</journal-title-group>
<issn pub-type="ppub">1553-734X</issn>
<issn pub-type="epub">1553-7358</issn>
<publisher>
<publisher-name>Public Library of Science</publisher-name>
<publisher-loc>San Francisco, CA USA</publisher-loc>
</publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="publisher-id">PCOMPBIOL-D-18-01647</article-id>
<article-id pub-id-type="doi">10.1371/journal.pcbi.1006534</article-id>
<article-categories>
<subj-group subj-group-type="heading">
<subject>Research Article</subject>
</subj-group>
<subj-group subj-group-type="Discipline-v3"><subject>Research and analysis methods</subject><subj-group><subject>Simulation and modeling</subject></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Organisms</subject><subj-group><subject>Bacteria</subject><subj-group><subject>Staphylococcus</subject><subj-group><subject>Staphylococcus aureus</subject><subj-group><subject>Methicillin-resistant Staphylococcus aureus</subject></subj-group></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Microbiology</subject><subj-group><subject>Medical microbiology</subject><subj-group><subject>Microbial pathogens</subject><subj-group><subject>Bacterial pathogens</subject><subj-group><subject>Staphylococcus</subject><subj-group><subject>Staphylococcus aureus</subject><subj-group><subject>Methicillin-resistant Staphylococcus aureus</subject></subj-group></subj-group></subj-group></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Medicine and health sciences</subject><subj-group><subject>Pathology and laboratory medicine</subject><subj-group><subject>Pathogens</subject><subj-group><subject>Microbial pathogens</subject><subj-group><subject>Bacterial pathogens</subject><subj-group><subject>Staphylococcus</subject><subj-group><subject>Staphylococcus aureus</subject><subj-group><subject>Methicillin-resistant Staphylococcus aureus</subject></subj-group></subj-group></subj-group></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Physical sciences</subject><subj-group><subject>Mathematics</subject><subj-group><subject>Probability theory</subject><subj-group><subject>Probability distribution</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Physical sciences</subject><subj-group><subject>Mathematics</subject><subj-group><subject>Applied mathematics</subject><subj-group><subject>Algorithms</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Research and analysis methods</subject><subj-group><subject>Simulation and modeling</subject><subj-group><subject>Algorithms</subject></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Evolutionary biology</subject><subj-group><subject>Population genetics</subject></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Genetics</subject><subj-group><subject>Population genetics</subject></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Population biology</subject><subj-group><subject>Population genetics</subject></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Computational biology</subject><subj-group><subject>Genome evolution</subject></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Genetics</subject><subj-group><subject>Genomics</subject><subj-group><subject>Genome evolution</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Evolutionary biology</subject><subj-group><subject>Molecular evolution</subject><subj-group><subject>Genome evolution</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Computer and information sciences</subject><subj-group><subject>Data acquisition</subject></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Computational biology</subject><subj-group><subject>Genome analysis</subject></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Genetics</subject><subj-group><subject>Genomics</subject><subj-group><subject>Genome analysis</subject></subj-group></subj-group></subj-group></subj-group></article-categories>
<title-group>
<article-title>A Bayesian model of acquisition and clearance of bacterial colonization incorporating within-host variation</article-title>
<alt-title alt-title-type="running-head">A Bayesian model of acquisition and clearance of bacterial colonization</alt-title>
</title-group>
<contrib-group>
<contrib contrib-type="author" xlink:type="simple">
<name name-style="western">
<surname>Järvenpää</surname> <given-names>Marko</given-names></name>
<role content-type="http://credit.casrai.org/">Conceptualization</role>
<role content-type="http://credit.casrai.org/">Formal analysis</role>
<role content-type="http://credit.casrai.org/">Investigation</role>
<role content-type="http://credit.casrai.org/">Methodology</role>
<role content-type="http://credit.casrai.org/">Software</role>
<role content-type="http://credit.casrai.org/">Validation</role>
<role content-type="http://credit.casrai.org/">Visualization</role>
<role content-type="http://credit.casrai.org/">Writing – original draft</role>
<xref ref-type="aff" rid="aff001"><sup>1</sup></xref>
<xref ref-type="aff" rid="aff002"><sup>2</sup></xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0003-1912-0590</contrib-id>
<name name-style="western">
<surname>Sater</surname> <given-names>Mohamad R. Abdul</given-names></name>
<role content-type="http://credit.casrai.org/">Data curation</role>
<role content-type="http://credit.casrai.org/">Formal analysis</role>
<role content-type="http://credit.casrai.org/">Investigation</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff002"><sup>2</sup></xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-3165-7801</contrib-id>
<name name-style="western">
<surname>Lagoudas</surname> <given-names>Georgia K.</given-names></name>
<role content-type="http://credit.casrai.org/">Data curation</role>
<role content-type="http://credit.casrai.org/">Resources</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff003"><sup>3</sup></xref>
<xref ref-type="aff" rid="aff004"><sup>4</sup></xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-4889-8783</contrib-id>
<name name-style="western">
<surname>Blainey</surname> <given-names>Paul C.</given-names></name>
<role content-type="http://credit.casrai.org/">Data curation</role>
<role content-type="http://credit.casrai.org/">Funding acquisition</role>
<role content-type="http://credit.casrai.org/">Resources</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff003"><sup>3</sup></xref>
<xref ref-type="aff" rid="aff004"><sup>4</sup></xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<name name-style="western">
<surname>Miller</surname> <given-names>Loren G.</given-names></name>
<role content-type="http://credit.casrai.org/">Data curation</role>
<role content-type="http://credit.casrai.org/">Funding acquisition</role>
<role content-type="http://credit.casrai.org/">Resources</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff005"><sup>5</sup></xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<name name-style="western">
<surname>McKinnell</surname> <given-names>James A.</given-names></name>
<role content-type="http://credit.casrai.org/">Data curation</role>
<role content-type="http://credit.casrai.org/">Funding acquisition</role>
<role content-type="http://credit.casrai.org/">Resources</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff005"><sup>5</sup></xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<name name-style="western">
<surname>Huang</surname> <given-names>Susan S.</given-names></name>
<role content-type="http://credit.casrai.org/">Data curation</role>
<role content-type="http://credit.casrai.org/">Funding acquisition</role>
<role content-type="http://credit.casrai.org/">Resources</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff006"><sup>6</sup></xref>
</contrib>
<contrib contrib-type="author" corresp="yes" equal-contrib="yes" xlink:type="simple">
<name name-style="western">
<surname>Grad</surname> <given-names>Yonatan H.</given-names></name>
<role content-type="http://credit.casrai.org/">Conceptualization</role>
<role content-type="http://credit.casrai.org/">Data curation</role>
<role content-type="http://credit.casrai.org/">Funding acquisition</role>
<role content-type="http://credit.casrai.org/">Methodology</role>
<role content-type="http://credit.casrai.org/">Supervision</role>
<role content-type="http://credit.casrai.org/">Writing – original draft</role>
<xref ref-type="aff" rid="aff002"><sup>2</sup></xref>
<xref ref-type="corresp" rid="cor001">*</xref>
</contrib>
<contrib contrib-type="author" corresp="yes" equal-contrib="yes" xlink:type="simple">
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0001-7078-7927</contrib-id>
<name name-style="western">
<surname>Marttinen</surname> <given-names>Pekka</given-names></name>
<role content-type="http://credit.casrai.org/">Conceptualization</role>
<role content-type="http://credit.casrai.org/">Funding acquisition</role>
<role content-type="http://credit.casrai.org/">Methodology</role>
<role content-type="http://credit.casrai.org/">Software</role>
<role content-type="http://credit.casrai.org/">Supervision</role>
<role content-type="http://credit.casrai.org/">Writing – original draft</role>
<xref ref-type="aff" rid="aff001"><sup>1</sup></xref>
<xref ref-type="corresp" rid="cor001">*</xref>
</contrib>
</contrib-group>
<aff id="aff001">
<label>1</label>
<addr-line>Helsinki Institute for Information Technology HIIT, Department of Computer Science, Aalto University, Espoo, Finland</addr-line>
</aff>
<aff id="aff002">
<label>2</label>
<addr-line>Department of Immunology and Infectious Diseases, Harvard TH Chan School of Public Health, Boston, MA, USA</addr-line>
</aff>
<aff id="aff003">
<label>3</label>
<addr-line>Department of Biological Engineering, MIT, Cambridge, MA, USA</addr-line>
</aff>
<aff id="aff004">
<label>4</label>
<addr-line>Broad Institute of MIT and Harvard, Cambridge, MA, USA</addr-line>
</aff>
<aff id="aff005">
<label>5</label>
<addr-line>Infectious Disease Clinical Outcomes Research Unit, Division of Infectious Diseases, LA Biomed Research Institute at Harbor–UCLA Medical Center, Torrance, CA, USA</addr-line>
</aff>
<aff id="aff006">
<label>6</label>
<addr-line>Division of Infectious Diseases and Health Policy Research Institute, University of California, Irvine School of Medicine, Irvine, CA, USA</addr-line>
</aff>
<contrib-group>
<contrib contrib-type="editor" xlink:type="simple">
<name name-style="western">
<surname>Kasson</surname> <given-names>Peter M</given-names></name>
<role>Editor</role>
<xref ref-type="aff" rid="edit1"/>
</contrib>
</contrib-group>
<aff id="edit1">
<addr-line>University of Virginia, UNITED STATES</addr-line>
</aff>
<author-notes>
<fn fn-type="conflict" id="coi001">
<p>The authors have declared that no relevant competing interests exist.</p>
</fn>
<corresp id="cor001">* E-mail: <email xlink:type="simple">ygrad@hsph.harvard.edu</email> (YHG); <email xlink:type="simple">pekka.marttinen@aalto.fi</email> (PM)</corresp>
</author-notes>
<pub-date pub-type="collection">
<month>4</month>
<year>2019</year>
</pub-date>
<pub-date pub-type="epub">
<day>22</day>
<month>4</month>
<year>2019</year>
</pub-date>
<volume>15</volume>
<issue>4</issue>
<elocation-id>e1006534</elocation-id>
<history>
<date date-type="received">
<day>24</day>
<month>9</month>
<year>2018</year>
</date>
<date date-type="accepted">
<day>22</day>
<month>2</month>
<year>2019</year>
</date>
</history>
<permissions>
<copyright-year>2019</copyright-year>
<copyright-holder>Järvenpää et al</copyright-holder>
<license xlink:href="http://creativecommons.org/licenses/by/4.0/" xlink:type="simple">
<license-p>This is an open access article distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/" xlink:type="simple">Creative Commons Attribution License</ext-link>, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p>
</license>
</permissions>
<self-uri content-type="pdf" xlink:href="info:doi/10.1371/journal.pcbi.1006534"/>
<abstract>
<p>Bacterial populations that colonize a host can play important roles in host health, including serving as a reservoir that transmits to other hosts and from which invasive strains emerge, thus emphasizing the importance of understanding rates of acquisition and clearance of colonizing populations. Studies of colonization dynamics have been based on assessment of whether serial samples represent a single population or distinct colonization events. With the use of whole genome sequencing to determine genetic distance between isolates, a common solution to estimate acquisition and clearance rates has been to assume a fixed genetic distance threshold below which isolates are considered to represent the same strain. However, this approach is often inadequate to account for the diversity of the underlying within-host evolving population, the time intervals between consecutive measurements, and the uncertainty in the estimated acquisition and clearance rates. Here, we present a fully Bayesian model that provides probabilities of whether two strains should be considered the same, allowing us to determine bacterial clearance and acquisition from genomes sampled over time. Our method explicitly models the within-host variation using population genetic simulation, and the inference is done using a combination of Approximate Bayesian Computation (ABC) and Markov Chain Monte Carlo (MCMC). We validate the method with multiple carefully conducted simulations and demonstrate its use in practice by analyzing a collection of methicillin resistant Staphylococcus aureus (MRSA) isolates from a large recently completed longitudinal clinical study. An R-code implementation of the method is freely available at: <ext-link ext-link-type="uri" xlink:href="https://github.com/mjarvenpaa/bacterial-colonization-model" xlink:type="simple">https://github.com/mjarvenpaa/bacterial-colonization-model</ext-link>.</p>
</abstract>
<abstract abstract-type="summary">
<title>Author summary</title>
<p>As colonizing bacterial populations are the source for much transmission and a reservoir for infection, they are a major focus of interest clinically and epidemiologically. Understanding the dynamics of colonization depends on being able to confidently identify acquisition and clearance events given intermittent sampling of hosts. To do so, we need a model of within-host bacterial population evolution from acquisition through the time of sampling that enables estimation of whether two samples are derived from the same population. Past efforts have frequently relied on empirical genetic distance thresholds that forgo an underlying model or employ a simple molecular clock model. Here, we present an inferential method that accounts for the timing of sample collection and population diversification, to provide a probabilistic estimate for whether two isolates represent the same colonizing strain. This method has implications for understanding the dynamics of acquisition and clearance of colonizing bacteria, and the impact on these rates by factors such as sensitivity of the sampling method, pathogen genotype, competition with other carriage bacteria, host immune response, and antibiotic exposure.</p>
</abstract>
<funding-group>
<funding-statement>PM is supported by the Academy of Finland (grants no. 286607 and 294015). YHG is supported by Doris Duke Clinical Scientist Development Award (2016092). PCB and YHG are supported by the US National Institute of Allergy and Infectious disease (AI121932). PCB is supported by a Career Award at the Scientific Interface from the Burroughs Wellcome Fund. GKL was supported by the M.I.T. Hugh Hampton Young Fellowship and the National Science Foundation Graduate Research Fellowship. The collection of the isolates was performed through a grant (R01HS019388) from the Agency for Healthcare Research and Quality. Data collection also supported by the UC Irvine Institute for Clinical and Translational Science funded by the National Institutes of Health Clinical and Translational Sciences Award program (UL1 TR000153 to SSH). The funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.</funding-statement>
</funding-group>
<counts>
<fig-count count="8"/>
<table-count count="3"/>
<page-count count="25"/>
</counts>
<custom-meta-group>
<custom-meta>
<meta-name>PLOS Publication Stage</meta-name>
<meta-value>vor-update-to-uncorrected-proof</meta-value>
</custom-meta>
<custom-meta>
<meta-name>Publication Update</meta-name>
<meta-value>2019-05-02</meta-value>
</custom-meta>
<custom-meta id="data-availability">
<meta-name>Data Availability</meta-name>
<meta-value>The method and all relevant data are within the manuscript and available at a public github repository (<ext-link ext-link-type="uri" xlink:href="https://github.com/mjarvenpaa/bacterial-colonization-model.git" xlink:type="simple">https://github.com/mjarvenpaa/bacterial-colonization-model.git</ext-link>) except the distance distributions (D_0) which is published elsewhere (Gordon N et al., 2017, Journal of Clinical Microbiology).</meta-value>
</custom-meta>
</custom-meta-group>
</article-meta>
</front>
<body>
<sec id="sec001" sec-type="intro">
<title>Introduction</title>
<p>Colonizing bacterial populations are often the source of infecting strains and transmission to new hosts [<xref ref-type="bibr" rid="pcbi.1006534.ref001">1</xref>–<xref ref-type="bibr" rid="pcbi.1006534.ref005">5</xref>], making it important to understand the dynamics of these populations and the factors that contribute to persistent colonization and to the success or failure of clinical decolonization protocols. The study of colonization dynamics is based on inferring whether bacteria from samples collected over time represent the same population or distinct colonization events, thereby permitting calculation of rates of acquisition and clearance [<xref ref-type="bibr" rid="pcbi.1006534.ref006">6</xref>, <xref ref-type="bibr" rid="pcbi.1006534.ref007">7</xref>]. Whole genome sequencing has provided a detailed measure of genetic distance between isolates, which can then be used to infer the relationship between them [<xref ref-type="bibr" rid="pcbi.1006534.ref008">8</xref>–<xref ref-type="bibr" rid="pcbi.1006534.ref011">11</xref>]. Successes in identifying transmission and outbreaks have led to proposals for routine genome sequencing of clinical and surveillance isolates for infection control [<xref ref-type="bibr" rid="pcbi.1006534.ref005">5</xref>, <xref ref-type="bibr" rid="pcbi.1006534.ref012">12</xref>]. While to date most studies have used genetic distance thresholds as the basis for determining the relationship between isolates [<xref ref-type="bibr" rid="pcbi.1006534.ref008">8</xref>, <xref ref-type="bibr" rid="pcbi.1006534.ref010">10</xref>], here we improve on these heuristic strategies and present a robust and accurate fully Bayesian model that provides probabilities of whether two strains should be considered the same, allowing us to determine bacterial clearance and acquisition from genomes sampled over time. Note that here we define ‘strain’ as a population of closely related isolates.</p>
<p>An example of a typical individual-level longitudinally sampled data set from a study population is shown in <xref ref-type="fig" rid="pcbi.1006534.g001">Fig 1</xref>: each ‘row’ represents a patient, x-axis is time, and dots are the genomes sampled at multiple time points. Dot color refers to different, easily distinguishable, sequence types (ST). The coloured number between two consecutive samples reflects the distance between the genomes, and we see that even within the same ST the distances may vary considerably, and, therefore, determining whether the changes can be explained by within-host evolution only, is challenging. Intuitively, if two genomes are very similar, we interpret this as a single strain colonizing the host, as these isolates are drawn from a closely related population resident in the niche from which sampling has taken place. On the other hand, two very different genomes, even if the same ST but with enough diversity that the most recent common ancestor resided outside the host, are interpreted as two different strains, obtained either jointly or separately as two acquisitions. With these data, we would like to address questions including: to what extent are people persistently colonized, cleared, and recolonized? If recolonized, what is the likelihood that it is the same or a distinct strain? To address these questions, prior work has relied on using a threshold number of single nucleotide polymorphisms (SNPs) to define a strain. Optimally, however, the SNP distance between the genomes observed and the interval between the sampling time defines a probability that the two genomes represent the same strain. Such data are critical for understanding within-host dynamics, response to interventions, and transmission.</p>
<fig id="pcbi.1006534.g001" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1006534.g001</object-id>
<label>Fig 1</label>
<caption>
<title>Illustration of a subset of the data used in the study.</title>
<p>Each row in panel A corresponds to one patient. Only the first 20 patients are shown. R0 is the initial hospital visit and V1, V2, etc. are the subsequent visits. Red colour refers to ST5 and blue to ST8. The numbers show the number of mutations <italic>d</italic><sub><italic>i</italic></sub> between consecutive isolates. The samples were obtained from nares swabs and represent single colonies. Dashed black colour highlights cases where the ST changed from ST 5 to ST 8. Panel B shows the frequencies of observed distances <italic>d</italic><sub><italic>i</italic></sub> between consecutive samples. These distances were used for model fitting.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1006534.g001" xlink:type="simple"/>
</fig>
<p>Previously, transitions between different colonizing bacteria have been modeled using hidden Markov models [<xref ref-type="bibr" rid="pcbi.1006534.ref013">13</xref>] with states corresponding to different colonizing STs. However, this approach is not suitable for modeling within a single ST, where acquisition and clearance must be determined based on a small number of mutations. Crucial for interpreting such small differences is a model for within-host variation [<xref ref-type="bibr" rid="pcbi.1006534.ref008">8</xref>, <xref ref-type="bibr" rid="pcbi.1006534.ref014">14</xref>], specifying the number of mutations expected by evolution within the host. Population genetic models can be used for understanding the variation in an evolving population [<xref ref-type="bibr" rid="pcbi.1006534.ref015">15</xref>]. A major difficulty in fitting such models to data like those shown in <xref ref-type="fig" rid="pcbi.1006534.g001">Fig 1</xref> is that the information contained by the data is extremely limited regarding the variation within the host: a single time point is summarized with just a single (or a few) genomes, and must serve to represent the whole within-host population. While some studies use genome sequence from multiple isolates to achieve a more complete characterization of within-host diversity [<xref ref-type="bibr" rid="pcbi.1006534.ref003">3</xref>, <xref ref-type="bibr" rid="pcbi.1006534.ref010">10</xref>], these tend to be limited in terms of the number of time points and/or patients.</p>
<p>The Bayesian statistical framework can be used to combine information from multiple data sources. In the Bayesian approach, a prior distribution is updated using the laws of probability into a posterior distribution in the light of the observations, and this can be repeated multiple times with different data sets [<xref ref-type="bibr" rid="pcbi.1006534.ref016">16</xref>, <xref ref-type="bibr" rid="pcbi.1006534.ref017">17</xref>]. Approximate Bayesian computation (ABC) is particularly useful with population genetic models, where the likelihood function may be difficult to specify explicitly, but simulating the model is straightforward [<xref ref-type="bibr" rid="pcbi.1006534.ref018">18</xref>, <xref ref-type="bibr" rid="pcbi.1006534.ref019">19</xref>]. ABC has recently been introduced in bacterial population genetics [<xref ref-type="bibr" rid="pcbi.1006534.ref020">20</xref>–<xref ref-type="bibr" rid="pcbi.1006534.ref023">23</xref>]. Here, we present a Bayesian model for determining whether two genomes should be considered the same strain, enabling a strategy grounded in population genetics to make inferences about acquisition and clearance from data of closely related genomes. Benefits of the fully Bayesian analysis include: rigorous quantification of uncertainty, explicit statement of modeling assumptions (open for criticism and further development when needed), and straightforward utilization of multiple data sources. We demonstrate these benefits by analyzing a large collection longitudinally collected methicillin resistant <italic>Staphylococcus aureus</italic> (MRSA) genomes, obtained through a clinical trial (Project CLEAR) to evaluate the effectiveness of an MRSA decolonization protocol [<xref ref-type="bibr" rid="pcbi.1006534.ref024">24</xref>]. This method for identifying strains with explicit assessment of uncertainty will enable studies of the characteristics–both host and pathogen–that impact colonization in the presence and absence of interventions.</p>
</sec>
<sec id="sec002" sec-type="materials|methods">
<title>Methods</title>
<sec id="sec003">
<title>Isolate collection and whole genome sequencing</title>
<p>MRSA isolates were collected as part of the Project CLEAR (Changing Lives by Eradicating Antibiotic Resistance) clinical trial (ClinicalTrials.gov identifier: NCT01209234), designed to compare the impact on MRSA carriage of a long-term decolonization protocol with patient education on general hygiene and self care [<xref ref-type="bibr" rid="pcbi.1006534.ref024">24</xref>]. Study subjects in the trial were recruited from hospitalized patients based on a MRSA positive culture or surveillance swab. After recruitment, nasal swabs were obtained from subjects around the time of hospital discharge (R0) and at 1,3,6, and 9 months (V1-V4, respectively) following the initial specimen. Only these samples obtained as part of the clinical trial were included. Note that some enrolled study subjects, despite a history of MRSA colonization or infection, did not have swabs positive for MRSA at the first time point (R0).</p>
<p>Swabs were cultured on chromogenic agar, and single colonies were picked from the resulting growth. Paired end DNA libraries were constructed via Illumina Nextera according to the manufacturer guidelines. Libraries were sequenced on the Illumina Hiseq platform. Sequencing reads were assembled de novo using SPAdes-3.10.1 [<xref ref-type="bibr" rid="pcbi.1006534.ref025">25</xref>] and the corresponding sequence type (ST) and clonal complex (CC) was determined by matching to PubMLST database (<ext-link ext-link-type="uri" xlink:href="https://pubmlst.org/saureus/" xlink:type="simple">https://pubmlst.org/saureus/</ext-link>) and eBURST (<ext-link ext-link-type="uri" xlink:href="http://saureus.mlst.net/eburst/" xlink:type="simple">http://saureus.mlst.net/eburst/</ext-link>). Sequencing reads were mapped using BWA mem v0.7.12 [<xref ref-type="bibr" rid="pcbi.1006534.ref026">26</xref>]. For CC8 and CC5 isolates, reads were mapped to TCH1516 (GenBank ID CP000730.1) and JH1 (CP000736.1), respectively. Duplicate reads were marked by Picard tools V2.8.0 (<ext-link ext-link-type="uri" xlink:href="http://broadinstitute.github.io/picard/" xlink:type="simple">http://broadinstitute.github.io/picard/</ext-link>) and ignored. SNP calling was performed using default parameters Pilon [<xref ref-type="bibr" rid="pcbi.1006534.ref027">27</xref>]. Regions with low coverage (&lt;10 reads) or ambiguous variants from ambiguous mapping were discarded. Regions with elevated SNP density, representing putative recombination events or phage, as determined by Gubbins v2.3.3 [<xref ref-type="bibr" rid="pcbi.1006534.ref028">28</xref>], were also discarded. Sequencing reads can be found at NCBI SRA accession PRJNA224550.</p>
</sec>
<sec id="sec004">
<title>Overview of the model</title>
<p>One input data item for our model consists of a pair of genomes that are of the same ST, sampled from the same individual at two consecutive time points (or possibly with an intervening time point with no samples or a sample of a different ST). Each of these data items (i.e. pairs of consecutive genomes) is summarized in terms of two quantities: the distance between the genomes and the difference between their sampling times (see <xref ref-type="fig" rid="pcbi.1006534.g001">Fig 1</xref>). Hence, the observed data <italic>D</italic> can be written as consisting of pairs (<italic>d</italic><sub><italic>i</italic></sub>, <italic>t</italic><sub><italic>i</italic></sub>), <italic>i</italic> = 1, …, <italic>N</italic>, where <italic>t</italic><sub><italic>i</italic></sub> &gt; 0 is the time between the sampling of the genomes, <italic>d</italic><sub><italic>i</italic></sub> ∈ {0, 1, 2, …} is the observed distance, and <italic>N</italic> the total number of genome pairs that satisfy the criteria (i.e. same patient, same ST, consecutive time points or possibly with an intervening time point with no samples or a sample of a different ST). The restriction to genome pairs of the same ST stems from the fact that different STs will always be considered different strains anyway. It is possible to include multiple genomes sampled at the same time point by assuming some ordering (e.g. random) and setting <italic>t</italic><sub><italic>i</italic></sub> to zero, but a model specifically designed to handle this is described in Section ABC inference to update the prior using external data.</p>
<p>There are two possible explanations for the observed distances. If the genomes are from the same strain, we expect their distance to be relatively small. If the genomes are from different strains, we expect a greater distance. Below we define two probabilistic models that represent these two alternative explanations. These models are then combined into one overall mixture model, which assumes that the distance between a certain pair of genomes is generated either from the ‘same strain’ model or the ‘different strain’ model, and enables calculation of the probabilities of these two alternatives for each genome pair, rather than relying on a fixed threshold to distinguish between them.</p>
<p>An essential part of our approach is a population genetic simulation which allows us to model the within-host variation, and hence make probabilistic statements of the plausibilities of the ‘same strain’ vs. ‘different strain’ models. For this purpose, we adopt the common Wright-Fisher (W-F) simulation model, see e.g. [<xref ref-type="bibr" rid="pcbi.1006534.ref029">29</xref>], with a constant mutation rate and population size, which are estimated from the data. The simulation is started with all genomes being the same, which corresponds to a biological scenario according to which a colonization begins with a single isolate multiplying rapidly until reaching the maximum ‘capacity’, followed by slow diversification of the population. This assumption is supported by the fact that in the distance distribution, in cases where the acquisition time was known and had happened recently, very little variation was observed in the population. See the <xref ref-type="sec" rid="sec017">Discussion</xref> section for more details on the modeling assumptions. Overview of the approach, including data sets, models, and methods for inference, is outlined in <xref ref-type="fig" rid="pcbi.1006534.g002">Fig 2</xref> and discussed below in detail.</p>
<fig id="pcbi.1006534.g002" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1006534.g002</object-id>
<label>Fig 2</label>
<caption>
<title>Overview of the modeling and data fitting steps.</title>
<p>In Phase 1 we update our prior information on parameters (<italic>n</italic><sub>eff</sub>, <italic>μ</italic>) based on external data <italic>D</italic><sub>0</sub>. In phase 2 we estimate all the parameters of the (mixture) model using MCMC, precomputed distance distributions <italic>p</italic><sub><italic>S</italic></sub> and the information obtained in Phase 1. The fitted model can be used to e.g. obtain the same strain probability for a new (future) measurement.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1006534.g002" xlink:type="simple"/>
</fig>
<sec id="sec005">
<title>Model <italic>p</italic><sub><italic>S</italic></sub>: Same strain</title>
<p>Let (<italic>s</italic><sub><italic>i</italic>1</sub>, <italic>s</italic><sub><italic>i</italic>2</sub>) denote a pair of genomes with distance <italic>d</italic><sub><italic>i</italic></sub>, sampled from a patient at two consecutive time points (see the previous section) with time <italic>t</italic><sub><italic>i</italic></sub> between taking the samples. Here we present a model, i.e., a probability distribution <italic>p</italic><sub><italic>S</italic></sub>(<italic>d</italic><sub><italic>i</italic></sub>|<italic>t</italic><sub><italic>i</italic></sub>, <italic>n</italic><sub>eff</sub>, <italic>μ</italic>), which tells what distances we should expect if the genomes are from the same strain, i.e. represent a closely related population that has evolved from a single colonization event. The parameter <italic>n</italic><sub>eff</sub> is the effective population size and <italic>μ</italic> is the mutation rate. We model <italic>d</italic><sub><italic>i</italic></sub> as
<disp-formula id="pcbi.1006534.e001"><alternatives><graphic id="pcbi.1006534.e001g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e001" xlink:type="simple"/><mml:math display="block" id="M1"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>d</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>=</mml:mo> <mml:msub><mml:mi>d</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mn>1</mml:mn></mml:mrow></mml:msub> <mml:mo>+</mml:mo> <mml:msub><mml:mi>d</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(1)</label></disp-formula>
where we have defined
<disp-formula id="pcbi.1006534.e002"><alternatives><graphic id="pcbi.1006534.e002g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e002" xlink:type="simple"/><mml:math display="block" id="M2"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>d</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mn>1</mml:mn></mml:mrow></mml:msub> <mml:mo>=</mml:mo> <mml:mtext>dist</mml:mtext> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>s</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mn>1</mml:mn></mml:mrow></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>s</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mo>*</mml:mo></mml:mrow></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mspace width="1.em"/><mml:mtext>and</mml:mtext> <mml:mspace width="1.em"/><mml:msub><mml:mi>d</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mn>2</mml:mn></mml:mrow></mml:msub> <mml:mo>=</mml:mo> <mml:mtext>dist</mml:mtext> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>s</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mo>*</mml:mo></mml:mrow></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>s</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mn>2</mml:mn></mml:mrow></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(2)</label></disp-formula>
where dist(⋅, ⋅) is a distance function that tells the number of mutations between its arguments, and <italic>s</italic><sub><italic>i</italic>*</sub> is the unique ancestor of <italic>s</italic><sub><italic>i</italic>2</sub> that was present in the host when <italic>s</italic><sub><italic>i</italic>1</sub> was sampled, and which has descended within the host from the same genome as <italic>s</italic><sub><italic>i</italic>1</sub> (see <xref ref-type="fig" rid="pcbi.1006534.g003">Fig 3A</xref>). The <xref ref-type="disp-formula" rid="pcbi.1006534.e001">Eq 1</xref> is valid when mutations between <italic>s</italic><sub><italic>i</italic>1</sub> and <italic>s</italic><sub><italic>i</italic>*</sub>, and <italic>s</italic><sub><italic>i</italic>*</sub> and <italic>s</italic><sub><italic>i</italic>2</sub> have occurred in different sites, which is true with a high probability when the genomes are long (millions of bps) compared to the number of mutations (dozens or a few hundred at most). The probability distribution of <italic>d</italic><sub><italic>i</italic>1</sub> which we will denote by <italic>p</italic><sub>sim</sub>(<italic>d</italic><sub><italic>i</italic>1</sub>|<italic>n</italic><sub>eff</sub>, <italic>μ</italic>), and which is not available analytically and does not depend on <italic>t</italic><sub><italic>i</italic></sub>, represents the within-host variation at a single time point. We approximate it as
<disp-formula id="pcbi.1006534.e003"><alternatives><graphic id="pcbi.1006534.e003g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e003" xlink:type="simple"/><mml:math display="block" id="M3"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>p</mml:mi> <mml:mtext>sim</mml:mtext></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>d</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mn>1</mml:mn></mml:mrow></mml:msub> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mi>μ</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mtext>eff</mml:mtext></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:mtext>WF-simulator</mml:mtext> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>d</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mn>1</mml:mn></mml:mrow></mml:msub> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mi>μ</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mtext>eff</mml:mtext></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(3)</label></disp-formula></p>
<fig id="pcbi.1006534.g003" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1006534.g003</object-id>
<label>Fig 3</label>
<caption>
<title>Outline of the ‘same strain’ and ‘different strain’ models.</title>
<p>Model <italic>p</italic><sub><italic>D</italic></sub> on the left (panel A) represents the situation where the genomes denoted by <italic>s</italic><sub><italic>i</italic>1</sub> and <italic>s</italic><sub><italic>i</italic>2</sub> are of the same strain. Model <italic>p</italic><sub><italic>S</italic></sub> on the right (panel B) shows the case where these genomes are of different strains. Time flows from left to right in the figures, the dots represent individual genomes, and the edges parent-offspring relationships.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1006534.g003" xlink:type="simple"/>
</fig>
<p>The distribution of <italic>d</italic><sub><italic>i</italic>2</sub> is assumed to be
<disp-formula id="pcbi.1006534.e004"><alternatives><graphic id="pcbi.1006534.e004g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e004" xlink:type="simple"/><mml:math display="block" id="M4"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mrow><mml:msub><mml:mi>d</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mn>2</mml:mn></mml:mrow></mml:msub> <mml:mrow><mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mi>μ</mml:mi> <mml:mo>,</mml:mo></mml:mrow> <mml:msub><mml:mi>t</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>∼</mml:mo> <mml:mtext>Poisson</mml:mtext> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>μ</mml:mi> <mml:msub><mml:mi>t</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow></mml:mrow> <mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(4)</label></disp-formula>
that is, mutations are assumed to occur according to a Poisson process with the rate parameter <italic>μ</italic>, which follows from the constant mutation rate assumption in the Wright-Fisher model.</p>
</sec>
<sec id="sec006">
<title>Model <italic>p</italic><sub><italic>D</italic></sub>: Different strains</title>
<p>Model <italic>p</italic><sub><italic>D</italic></sub> represents the case that the genomes <italic>s</italic><sub><italic>i</italic>1</sub> and <italic>s</italic><sub><italic>i</italic>2</sub> are from different strains, which we define to mean that their most recent common ancestor (MRCA), denoted by <italic>s</italic><sub><italic>iA</italic></sub>, resided outside the host. The time between <italic>s</italic><sub><italic>iA</italic></sub> and <italic>s</italic><sub><italic>i</italic>1</sub> is denoted by <italic>t</italic><sub>0<italic>i</italic></sub> (see <xref ref-type="fig" rid="pcbi.1006534.g003">Fig 3B</xref>). Under model <italic>p</italic><sub><italic>D</italic></sub>, we assume that the distribution of the distance <italic>d</italic><sub><italic>i</italic></sub> is
<disp-formula id="pcbi.1006534.e005"><alternatives><graphic id="pcbi.1006534.e005g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e005" xlink:type="simple"/><mml:math display="block" id="M5"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>p</mml:mi> <mml:mi>D</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>d</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mi>μ</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>t</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>t</mml:mi> <mml:mrow><mml:mn>0</mml:mn> <mml:mi>i</mml:mi></mml:mrow></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:mtext>Poisson</mml:mtext> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>d</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mi>μ</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mn>2</mml:mn> <mml:msub><mml:mi>t</mml:mi> <mml:mrow><mml:mn>0</mml:mn> <mml:mi>i</mml:mi></mml:mrow></mml:msub> <mml:mo>+</mml:mo> <mml:msub><mml:mi>t</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(5)</label></disp-formula>
where the values of <italic>t</italic><sub>0<italic>i</italic></sub> are unknown and will be estimated, but let us assume for now that they are known. One difference between the same strain model <italic>p</italic><sub><italic>S</italic></sub> (defined by Eqs <xref ref-type="disp-formula" rid="pcbi.1006534.e001">1</xref>, <xref ref-type="disp-formula" rid="pcbi.1006534.e003">3</xref> and <xref ref-type="disp-formula" rid="pcbi.1006534.e004">4</xref>) and the different strain model <italic>p</italic><sub><italic>D</italic></sub> (<xref ref-type="disp-formula" rid="pcbi.1006534.e005">Eq 5</xref>) is that the former uses Wright-Fisher simulation, whereas the latter does not. The reason is that the within-host variation is bounded, occasionally increasing and decreasing, which is reflected by the constant population size of the Wright-Fisher simulation in the same strain model. In the different strain model, the distance between <italic>s</italic><sub><italic>i</italic>1</sub> and <italic>s</italic><sub><italic>i</italic>2</sub> can in principle increase without bound, given enough time since their common ancestor, because they diverged and evolved outside the host.</p>
</sec>
<sec id="sec007">
<title>Mixture model</title>
<p>With the two alternative models for the distance, we can write the full model, which assumes that each distance observation is distributed according to
<disp-formula id="pcbi.1006534.e006"><alternatives><graphic id="pcbi.1006534.e006g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e006" xlink:type="simple"/><mml:math display="block" id="M6"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>p</mml:mi> <mml:mo>(</mml:mo> <mml:msub><mml:mi>d</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mrow><mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/></mml:mrow> <mml:msub><mml:mi>t</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">θ</mml:mi> <mml:mo>)</mml:mo> <mml:mo>=</mml:mo> <mml:msub><mml:mi>ω</mml:mi> <mml:mi>S</mml:mi></mml:msub> <mml:msub><mml:mi>p</mml:mi> <mml:mi>S</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>d</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:msub><mml:mi>t</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mtext>eff</mml:mtext></mml:msub> <mml:mo>,</mml:mo> <mml:mi>μ</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>+</mml:mo> <mml:msub><mml:mi>ω</mml:mi> <mml:mi>D</mml:mi></mml:msub> <mml:msub><mml:mi>p</mml:mi> <mml:mi>D</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>d</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:msub><mml:mi>t</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>t</mml:mi> <mml:mrow><mml:mn>0</mml:mn> <mml:mi>i</mml:mi></mml:mrow></mml:msub> <mml:mo>,</mml:mo> <mml:mi>μ</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>,</mml:mo> <mml:mspace width="1.em"/><mml:mi>i</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn> <mml:mo>,</mml:mo> <mml:mo>…</mml:mo> <mml:mo>,</mml:mo> <mml:mi>N</mml:mi> <mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(6)</label></disp-formula>
where <italic><bold>θ</bold></italic> denotes jointly all the parameters of the models, i.e., <italic><bold>θ</bold></italic> = (<italic>n</italic><sub>eff</sub>, <italic>μ</italic>, <italic>ω</italic><sub><italic>S</italic></sub>, <italic>ω</italic><sub><italic>D</italic></sub>, <italic>t</italic><sub>01</sub>, …, <italic>t</italic><sub>0<italic>N</italic></sub>). The parameter <italic>ω</italic><sub><italic>S</italic></sub> represents the proportion of pairs from the same strain and <italic>ω</italic><sub><italic>D</italic></sub> is the proportion of pairs from different strains, such that <italic>ω</italic><sub><italic>S</italic></sub> + <italic>ω</italic><sub><italic>D</italic></sub> = 1. To learn the unknown parameters <italic><bold>θ</bold></italic>, we need to fit the model to data, but before going into details, we discuss how to use an external data set to update the prior distribution about the mutation rate <italic>μ</italic> and the effective sample size <italic>n</italic><sub>eff</sub>. This updated distribution will itself be used as the prior in the mixture model.</p>
</sec>
</sec>
<sec id="sec008">
<title>ABC inference to update the prior using external data</title>
<p>Simulations with the W-F model are used in our approach for two purposes: 1) to incorporate information from an external data set to update the prior on the mutation rate <italic>μ</italic> and the effective sample size <italic>n</italic><sub>eff</sub>, and 2) to define empirically the distribution <italic>p</italic><sub><italic>S</italic></sub>(<italic>d</italic><sub><italic>i</italic></sub>|<italic>t</italic><sub><italic>i</italic></sub>, <italic>n</italic><sub>eff</sub>, <italic>μ</italic>) required in the mixture model. Here we discuss the first task.</p>
<p>As external data we use measurements from eight patients colonised with MSSA [<xref ref-type="bibr" rid="pcbi.1006534.ref003">3</xref>], comprising nasal swabs from two time points for each patient, such that the acquisition is known to have happened approximately just before the first swab. Multiple genomes were sequenced from each sample, and the distributions of pairwise distances between the genomes provide snapshots to the within-host variability at the two time points for each individual, and these distance distributions are used as data. That is, in contrast with data <italic>D</italic> (which represents SNP distances between single isolates collected at different time points) used to fit the mixture model, we here use the distribution of SNP distances within each time point. We exclude one patient (number 1219) because according to [<xref ref-type="bibr" rid="pcbi.1006534.ref003">3</xref>] this patient was likely infected already long before the first sample. The data set also contains observations from an additional 13 patients from [<xref ref-type="bibr" rid="pcbi.1006534.ref014">14</xref>], denoted by letters from A to M in [<xref ref-type="bibr" rid="pcbi.1006534.ref003">3</xref>]. For these patients, distance distributions from only one time point are available, and the acquisition times are unknown. The data comprising the distance distributions from the 7 patients (two time points) and the additional 13 patients (a single time point) are jointly denoted by <italic>D</italic><sub>0</sub>.</p>
<p>To learn about the unknown parameters <italic>n</italic><sub>eff</sub> and <italic>μ</italic>, we first note that their values affect the distance distribution of a population resulting from a W-F simulation with the specified values (<xref ref-type="fig" rid="pcbi.1006534.g004">Fig 4</xref>). To estimate these parameters, we try to find such values for them which make the output of the W-F similar to the observed distance distributions <italic>D</italic><sub>0</sub>. Since the corresponding likelihood function is unavailable, standard statistical techniques for model fitting do not apply. Therefore, we use Approximate Bayesian Computation (ABC), a class of methods for Bayesian inference when the likelihood is either unavailable or too expensive to evaluate but simulating the model is feasible, see [<xref ref-type="bibr" rid="pcbi.1006534.ref018">18</xref>, <xref ref-type="bibr" rid="pcbi.1006534.ref019">19</xref>, <xref ref-type="bibr" rid="pcbi.1006534.ref030">30</xref>, <xref ref-type="bibr" rid="pcbi.1006534.ref031">31</xref>] for an overview on ABC. The basic ABC rejection sampler algorithm for the model fitting consists of the following steps:</p>
<list list-type="order">
<list-item>
<p>Simulate a parameter vector (<italic>n</italic><sub>eff</sub>, <italic>μ</italic>) from the prior distribution <italic>p</italic>(<italic>n</italic><sub>eff</sub>, <italic>μ</italic>).</p>
</list-item>
<list-item>
<p>Generate a pseudo-data similar to the observed data <italic>D</italic><sub>0</sub> by running the W-F model separately for each patient using the parameter (<italic>n</italic><sub>eff</sub>, <italic>μ</italic>).</p>
</list-item>
<list-item>
<p>Accept the parameter (<italic>n</italic><sub>eff</sub>, <italic>μ</italic>) as a sample from the (approximate) posterior distribution if the discrepancy between the observed and simulated data is smaller than a specified threshold <italic>ε</italic>.</p>
</list-item>
</list>
<fig id="pcbi.1006534.g004" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1006534.g004</object-id>
<label>Fig 4</label>
<caption>
<title>Distributions of pairwise distances for populations simulated with different parameters.</title>
<p>The histograms show the estimated probability mass functions <inline-formula id="pcbi.1006534.e007"><alternatives><graphic id="pcbi.1006534.e007g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e007" xlink:type="simple"/><mml:math display="inline" id="M7"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>p</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mtext>sim</mml:mtext></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>d</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mn>1</mml:mn></mml:mrow></mml:msub> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:msub><mml:mi>n</mml:mi> <mml:mtext>eff</mml:mtext></mml:msub> <mml:mo>,</mml:mo> <mml:mi>μ</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> with selected parameter vectors (<italic>n</italic><sub>eff</sub>, <italic>μ</italic>). Increasing <italic>μ</italic> and/or <italic>n</italic><sub>eff</sub> tends to increase the distances. Each histogram represent variability in a simulated population at a single time point 6,000 generations after the beginning of the simulation.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1006534.g004" xlink:type="simple"/>
</fig>
<p>The quality of the resulting ABC approximation depends on the selection of the discrepancy function, the threshold <italic>ε</italic> and the number of accepted samples. Broadly speaking, if the discrepancy summarizes the information in the data completely (e.g. it is a function of the sufficient statistics) and <italic>ε</italic> is arbitrarily small, the approximation error becomes negligible and the samples are generated from the exact posterior. In practice, choosing <italic>ε</italic> very small makes the algorithm inefficient since many simulations are needed to obtain an accepted sample even with the optimal value of the parameter. Also, finding a good discrepancy function may be difficult because sufficient statistics are typically unavailable. Many sophisticated ABC variants exist, see e.g. [<xref ref-type="bibr" rid="pcbi.1006534.ref019">19</xref>, <xref ref-type="bibr" rid="pcbi.1006534.ref031">31</xref>] and the references therein, but as we need to estimate only two parameters (one of which is discrete) and because running the simulations in parallel is straightforward with the basic algorithm, we use a the ABC rejection sampler outlined above, with details discussed below.</p>
<p>In [<xref ref-type="bibr" rid="pcbi.1006534.ref014">14</xref>], MRSA evolution was simulated using parameters derived from the following estimates: 8 mutations per genome per year and generation length of 90 minutes (the whole year is thus 5840 generations). This gives mutation rate of 0.0019 per genome per generation, approximately 6.3 × 10<sup>−10</sup> mutations per site per generation assuming the genome length of 3 Mbp. We also use the generation time of 90 minutes, originally derived by [<xref ref-type="bibr" rid="pcbi.1006534.ref014">14</xref>] from the estimated doubling time of <italic>Staphylococcus aureus</italic> [<xref ref-type="bibr" rid="pcbi.1006534.ref032">32</xref>]. We use independent uniform priors for the parameters of the W-F model, so that
<disp-formula id="pcbi.1006534.e008"><alternatives><graphic id="pcbi.1006534.e008g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e008" xlink:type="simple"/><mml:math display="block" id="M8"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>n</mml:mi> <mml:mtext>eff</mml:mtext></mml:msub> <mml:mo>∼</mml:mo> <mml:mi mathvariant="script">U</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:mo>{</mml:mo> <mml:mn>20</mml:mn> <mml:mo>,</mml:mo> <mml:mn>21</mml:mn> <mml:mo>,</mml:mo> <mml:mo>…</mml:mo> <mml:mo>,</mml:mo> <mml:mn>10000</mml:mn> <mml:mo>}</mml:mo></mml:mrow> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>,</mml:mo> <mml:mspace width="1.em"/><mml:mi>μ</mml:mi> <mml:mo>∼</mml:mo> <mml:mi mathvariant="script">U</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:mo>[</mml:mo> <mml:msub><mml:mi>a</mml:mi> <mml:mi>μ</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>b</mml:mi> <mml:mi>μ</mml:mi></mml:msub> <mml:mo>]</mml:mo></mml:mrow> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(7)</label></disp-formula>
with <italic>a</italic><sub><italic>μ</italic></sub> = 0.00005 and <italic>b</italic><sub><italic>μ</italic></sub> = 0.005 mutations per genome per generation.</p>
<p>We argue that reasonable parameters should produce populations with similar histograms of the pairwise distances compared to the observations at the corresponding times. Consequently, we use the discrepancy Δ defined as
<disp-formula id="pcbi.1006534.e009"><alternatives><graphic id="pcbi.1006534.e009g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e009" xlink:type="simple"/><mml:math display="block" id="M9"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mo>Δ</mml:mo> <mml:mo>=</mml:mo> <mml:munderover><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>i</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:mn>7</mml:mn></mml:munderover> <mml:munderover><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>t</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:mn>2</mml:mn></mml:munderover> <mml:msub><mml:mi>l</mml:mi> <mml:mn>1</mml:mn></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>p</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mrow><mml:mi>i</mml:mi> <mml:mi>j</mml:mi></mml:mrow></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:msub><mml:mi>n</mml:mi> <mml:mtext>eff</mml:mtext></mml:msub> <mml:mo>,</mml:mo> <mml:mi>μ</mml:mi></mml:mrow> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>,</mml:mo> <mml:msubsup><mml:mover accent="true"><mml:mi>p</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mrow><mml:mi>i</mml:mi> <mml:mi>t</mml:mi></mml:mrow> <mml:mtext>obs</mml:mtext></mml:msubsup> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>+</mml:mo> <mml:munder><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>i</mml:mi> <mml:mo>∈</mml:mo> <mml:mo>{</mml:mo> <mml:mi>A</mml:mi> <mml:mo>,</mml:mo> <mml:mi>B</mml:mi> <mml:mo>,</mml:mo> <mml:mo>…</mml:mo> <mml:mo>,</mml:mo> <mml:mi>M</mml:mi> <mml:mo>}</mml:mo></mml:mrow></mml:munder> <mml:munder><mml:mo form="prefix" movablelimits="true">min</mml:mo> <mml:mi>t</mml:mi></mml:munder> <mml:mrow><mml:mo>{</mml:mo> <mml:msub><mml:mi>l</mml:mi> <mml:mn>1</mml:mn></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>p</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mrow><mml:mi>i</mml:mi> <mml:mi>t</mml:mi></mml:mrow></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:msub><mml:mi>n</mml:mi> <mml:mtext>eff</mml:mtext></mml:msub> <mml:mo>,</mml:mo> <mml:mi>μ</mml:mi></mml:mrow> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>,</mml:mo> <mml:msubsup><mml:mover accent="true"><mml:mi>p</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mrow><mml:mi>i</mml:mi> <mml:mn>1</mml:mn></mml:mrow> <mml:mtext>obs</mml:mtext></mml:msubsup> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>}</mml:mo></mml:mrow> <mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(8)</label></disp-formula>
where <inline-formula id="pcbi.1006534.e010"><alternatives><graphic id="pcbi.1006534.e010g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e010" xlink:type="simple"/><mml:math display="inline" id="M10"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>p</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mrow><mml:mi>i</mml:mi> <mml:mi>t</mml:mi></mml:mrow></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:msub><mml:mi>n</mml:mi> <mml:mtext>eff</mml:mtext></mml:msub> <mml:mo>,</mml:mo> <mml:mi>μ</mml:mi></mml:mrow> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1006534.e011"><alternatives><graphic id="pcbi.1006534.e011g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e011" xlink:type="simple"/><mml:math display="inline" id="M11"><mml:msubsup><mml:mover accent="true"><mml:mi>p</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mrow><mml:mi>i</mml:mi> <mml:mi>t</mml:mi></mml:mrow> <mml:mtext>obs</mml:mtext></mml:msubsup></mml:math></alternatives></inline-formula> are the simulated and observed empirical distributions of pairwise distances for patient <italic>i</italic> with time point <italic>t</italic>, respectively, and <italic>l</italic><sub>1</sub>(⋅, ⋅) denotes the <italic>L</italic><sup>1</sup> distance between the distributions (alternative distance measures are discussed in the Supplementary material). Note that in the second term in <xref ref-type="disp-formula" rid="pcbi.1006534.e009">Eq 8</xref> we use the minimum instead of summation. The reason is that the acquisition times for the 13 patients (A-M) are unknown, and estimating them exactly would be infeasible. Instead, we use these data such that we replace the unknown times with values that produce the minimum discrepancy. This way, parameters that never produce enough variability to match the observations will increase the discrepancy, allowing us to gain evidence against such unreasonable values, even if the exact times are unknown and too computationally costly to infer.</p>
<p>Instead of simulating (<italic>n</italic><sub>eff</sub>, <italic>μ</italic>) samples from the prior we perform equivalent grid-based computations. That is, we consider an equidistant 50 × 50 grid of (<italic>n</italic><sub>eff</sub>, <italic>μ</italic>) values and simulate the model 1, 000 times at each grid point. However, in preliminary experiments we noticed that if <italic>n</italic><sub>eff</sub> and <italic>μ</italic> are simultaneously large, the amount of mutations produced by the model increases rapidly and it is clear that the simulated pairwise distances are always greater than in the observed data, and also the computation time and memory usage become prohibitive. Thus, we do not run the full set of 1000 simulations in this parameter region because it is clear that the posterior density would be negligible. Finally, the threshold <italic>ε</italic> is chosen such that 5, 000 out of the total of almost 1 million simulations are below the threshold, corresponding to the acceptance probability of 0.0057.</p>
</sec>
<sec id="sec009">
<title>Details of the mixture model</title>
<p>We now discuss the mixture model in detail and then derive an efficient algorithm to estimate its parameters. Because the values of <italic>t</italic><sub>0<italic>i</italic></sub> in <xref ref-type="disp-formula" rid="pcbi.1006534.e005">Eq 5</xref>, denoting the times to the MRCAs in case the sequences are different strains, are unknown, we model them as random variables and give each of them a prior distribution
<disp-formula id="pcbi.1006534.e012"><alternatives><graphic id="pcbi.1006534.e012g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e012" xlink:type="simple"/><mml:math display="block" id="M12"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>t</mml:mi> <mml:mrow><mml:mn>0</mml:mn> <mml:mi>i</mml:mi></mml:mrow></mml:msub> <mml:mrow><mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mi>k</mml:mi> <mml:mo>,</mml:mo> <mml:mo>λ</mml:mo> <mml:mo>∼</mml:mo> <mml:mo form="prefix">Gamma</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>k</mml:mi> <mml:mo>,</mml:mo> <mml:mo>λ</mml:mo> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>,</mml:mo> <mml:mspace width="1.em"/><mml:mi>i</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn> <mml:mo>,</mml:mo> <mml:mo>…</mml:mo> <mml:mo>,</mml:mo> <mml:mi>N</mml:mi> <mml:mo>.</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(9)</label></disp-formula></p>
<p>We further specify a weakly informative prior for λ such that
<disp-formula id="pcbi.1006534.e013"><alternatives><graphic id="pcbi.1006534.e013g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e013" xlink:type="simple"/><mml:math display="block" id="M13"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mo>λ</mml:mo> <mml:mo>∼</mml:mo> <mml:mo form="prefix">Gamma</mml:mo> <mml:mo>(</mml:mo> <mml:mi>α</mml:mi> <mml:mo>,</mml:mo> <mml:mi>β</mml:mi> <mml:mo>)</mml:mo> <mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(10)</label></disp-formula></p>
<p>The parameter λ is thus shared between different <italic>t</italic><sub>0<italic>i</italic></sub> which allows us to learn about its distribution.</p>
<p>If <italic>k</italic> = 1, then the Gamma distribution in <xref ref-type="disp-formula" rid="pcbi.1006534.e012">Eq 9</xref> reduces to the Exponential, which, however, does not reflect our prior understanding of reasonable value of <italic>t</italic><sub>0<italic>i</italic></sub> because the mode of the resulting distribution is at zero, corresponding to a very recent common ancestor for genomes considered to be from different strains. Instead, we set <italic>k</italic> = 5, <italic>α</italic> = 2.5, and <italic>β</italic> = 1600, which approximately correspond to the mean and standard deviation of 5800 and 8400 generations, respectively. This weakly informative prior reflects the notion that different strains diverged on average approximately a year ago, but with a large variance. Furthermore, if the time between samples, <italic>t</italic><sub><italic>i</italic></sub>, is three months, the prior translates to an expectation that, if the sampled genomes are from different strains, they are on average 30 mutations apart, with a large standard deviation of 50 mutations. Moreover, the density has a heavy tail to account for some possibly much greater distances. The formulas used to compute these values and other useful facts about the prior are provided in the supplementary material.</p>
<p>An equivalent way of writing the mixture model in <xref ref-type="disp-formula" rid="pcbi.1006534.e006">Eq 6</xref>, which also simplifies the computations, is to introduce hidden labels which specify the component which generated each observation <italic>d</italic><sub><italic>i</italic></sub>, see [<xref ref-type="bibr" rid="pcbi.1006534.ref033">33</xref>]. We thus define latent variables
<disp-formula id="pcbi.1006534.e014"><alternatives><graphic id="pcbi.1006534.e014g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e014" xlink:type="simple"/><mml:math display="block" id="M14"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi mathvariant="bold">z</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>=</mml:mo> <mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>z</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mn>1</mml:mn></mml:mrow></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>z</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mn>2</mml:mn></mml:mrow></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mi>T</mml:mi></mml:msup> <mml:mo>=</mml:mo> <mml:mo>{</mml:mo> <mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:mn>1</mml:mn> <mml:mo>,</mml:mo> <mml:mn>0</mml:mn> <mml:mo>)</mml:mo></mml:mrow> <mml:mi>T</mml:mi></mml:msup> <mml:mo>,</mml:mo> <mml:mspace width="4.pt"/><mml:mtext>if</mml:mtext> <mml:mspace width="4.pt"/><mml:msub><mml:mi>d</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mspace width="4.pt"/><mml:mtext>has</mml:mtext> <mml:mspace width="4.pt"/><mml:mtext>distribution</mml:mtext> <mml:mspace width="4.pt"/><mml:msub><mml:mi>p</mml:mi> <mml:mi>S</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:mn>0</mml:mn> <mml:mo>,</mml:mo> <mml:mn>1</mml:mn> <mml:mo>)</mml:mo></mml:mrow> <mml:mi>T</mml:mi></mml:msup> <mml:mo>,</mml:mo> <mml:mspace width="4.pt"/><mml:mtext>if</mml:mtext> <mml:mspace width="4.pt"/><mml:msub><mml:mi>d</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mspace width="4.pt"/><mml:mtext>has</mml:mtext> <mml:mspace width="4.pt"/><mml:mtext>distribution</mml:mtext> <mml:mspace width="4.pt"/><mml:msub><mml:mi>p</mml:mi> <mml:mi>D</mml:mi></mml:msub> <mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable> <mml:mo/></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(11)</label></disp-formula></p>
<p>The prior density for the latent variables <bold>z</bold> is
<disp-formula id="pcbi.1006534.e015"><alternatives><graphic id="pcbi.1006534.e015g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e015" xlink:type="simple"/><mml:math display="block" id="M15"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi mathvariant="bold">z</mml:mi> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mi mathvariant="bold-italic">ω</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:munderover><mml:mo>∏</mml:mo> <mml:mrow><mml:mi>i</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:mi>N</mml:mi></mml:munderover> <mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi mathvariant="bold">z</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mi mathvariant="bold-italic">ω</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:munderover><mml:mo>∏</mml:mo> <mml:mrow><mml:mi>i</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:mi>N</mml:mi></mml:munderover> <mml:msubsup><mml:mi>ω</mml:mi> <mml:mi>S</mml:mi> <mml:msub><mml:mi>z</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:msubsup> <mml:msubsup><mml:mi>ω</mml:mi> <mml:mi>D</mml:mi> <mml:msub><mml:mi>z</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:msubsup> <mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(12)</label></disp-formula>
where we have used vector notation <bold>t</bold> = (<italic>t</italic><sub>1</sub>, …, <italic>t</italic><sub><italic>N</italic></sub>)<sup><italic>T</italic></sup>, <bold>d</bold> = (<italic>d</italic><sub>1</sub>, …, <italic>d</italic><sub><italic>N</italic></sub>)<sup><italic>T</italic></sup>, <bold>z</bold> = (<bold>z</bold><sub>1</sub>, …, <bold>z</bold><sub><italic>N</italic></sub>)<sup><italic>T</italic></sup>, <bold>t</bold><sub>0</sub> = (<italic>t</italic><sub>01</sub>, …, <italic>t</italic><sub>0<italic>N</italic></sub>)<sup><italic>T</italic></sup> and <bold><italic>ω</italic></bold> = (<italic>ω</italic><sub><italic>S</italic></sub>, <italic>ω</italic><sub><italic>D</italic></sub>)<sup><italic>T</italic></sup>. We augment the parameter <italic><bold>θ</bold></italic> to represent jointly all model parameters in <xref ref-type="disp-formula" rid="pcbi.1006534.e006">Eq 6</xref> and the prior densities specified in Eqs <xref ref-type="disp-formula" rid="pcbi.1006534.e012">9</xref> and <xref ref-type="disp-formula" rid="pcbi.1006534.e013">10</xref>, i.e., <italic><bold>θ</bold></italic> = (<italic>n</italic><sub>eff</sub>, <italic>μ</italic>, <italic><bold>ω</bold></italic>, <bold>z</bold>, <bold>t</bold><sub>0</sub>, λ)<sup><italic>T</italic></sup>. To complete the model specification, we must specify the prior for <italic><bold>ω</bold></italic>, <italic>n</italic><sub>eff</sub> and <italic>μ</italic>. We use
<disp-formula id="pcbi.1006534.e016"><alternatives><graphic id="pcbi.1006534.e016g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e016" xlink:type="simple"/><mml:math display="block" id="M16"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi mathvariant="bold-italic">ω</mml:mi> <mml:mo>∼</mml:mo> <mml:mo form="prefix">Dir</mml:mo> <mml:mo>(</mml:mo> <mml:mi mathvariant="bold-italic">γ</mml:mi> <mml:mo>)</mml:mo> <mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(13)</label></disp-formula>
that is, a Dirichlet distribution with parameter <bold>γ</bold> = (1, 1)<sup><italic>T</italic></sup>. We use the posterior <italic>p</italic>(<italic>n</italic><sub>eff</sub>, <italic>μ</italic>|<italic>D</italic><sub>0</sub>), obtained by ABC using the external data <italic>D</italic><sub>0</sub> as discussed in the previous section, as the (joint) prior for (<italic>n</italic><sub>eff</sub>, <italic>μ</italic>).</p>
</sec>
<sec id="sec010">
<title>Bayesian inference for the mixture model</title>
<p>We now show how the mixture model can be fit efficiently to data. The joint probability distribution for the data <bold>d</bold> and the parameters <italic><bold>θ</bold></italic> can be now written as
<disp-formula id="pcbi.1006534.e017"><alternatives><graphic id="pcbi.1006534.e017g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e017" xlink:type="simple"/><mml:math display="block" id="M17"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi mathvariant="bold">d</mml:mi> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">θ</mml:mi> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mi mathvariant="bold">t</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>D</mml:mi> <mml:mn>0</mml:mn></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi mathvariant="bold">d</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mtext>eff</mml:mtext></mml:msub> <mml:mo>,</mml:mo> <mml:mi>μ</mml:mi> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">ω</mml:mi> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold">z</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi mathvariant="bold">t</mml:mi> <mml:mn>0</mml:mn></mml:msub> <mml:mo>,</mml:mo> <mml:mo>λ</mml:mo> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mi mathvariant="bold">t</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>D</mml:mi> <mml:mn>0</mml:mn></mml:msub> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:mspace width="1.em"/><mml:mo>=</mml:mo> <mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi mathvariant="bold">d</mml:mi> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold">z</mml:mi> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:msub><mml:mi>n</mml:mi> <mml:mtext>eff</mml:mtext></mml:msub> <mml:mo>,</mml:mo> <mml:mi>μ</mml:mi> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">ω</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi mathvariant="bold">t</mml:mi> <mml:mn>0</mml:mn></mml:msub> <mml:mo>,</mml:mo> <mml:mo>λ</mml:mo> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold">t</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mspace width="0.166667em"/><mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mtext>eff</mml:mtext></mml:msub> <mml:mo>,</mml:mo> <mml:mi>μ</mml:mi> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">ω</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi mathvariant="bold">t</mml:mi> <mml:mn>0</mml:mn></mml:msub> <mml:mo>,</mml:mo> <mml:mo>λ</mml:mo> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:msub><mml:mi>D</mml:mi> <mml:mn>0</mml:mn></mml:msub> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(14)</label></disp-formula> <disp-formula id="pcbi.1006534.e018"><alternatives><graphic id="pcbi.1006534.e018g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e018" xlink:type="simple"/><mml:math display="block" id="M18"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:mspace width="1.em"/><mml:mo>=</mml:mo> <mml:munderover><mml:mo>∏</mml:mo> <mml:mrow><mml:mi>i</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:mi>N</mml:mi></mml:munderover> <mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>d</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:msub><mml:mi mathvariant="bold">z</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mtext>eff</mml:mtext></mml:msub> <mml:mo>,</mml:mo> <mml:mi>μ</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>t</mml:mi> <mml:mrow><mml:mn>0</mml:mn> <mml:mi>i</mml:mi></mml:mrow></mml:msub> <mml:mo>,</mml:mo> <mml:mo>λ</mml:mo> <mml:mo>,</mml:mo> <mml:msub><mml:mi>t</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mspace width="0.166667em"/><mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi mathvariant="bold">z</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mi mathvariant="bold-italic">ω</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mspace width="0.166667em"/><mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mtext>eff</mml:mtext></mml:msub> <mml:mo>,</mml:mo> <mml:mi>μ</mml:mi> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:msub><mml:mi>D</mml:mi> <mml:mn>0</mml:mn></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mspace width="0.166667em"/><mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi mathvariant="bold-italic">ω</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:munderover><mml:mo>∏</mml:mo> <mml:mrow><mml:mi>i</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:mi>N</mml:mi></mml:munderover> <mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>t</mml:mi> <mml:mrow><mml:mn>0</mml:mn> <mml:mi>i</mml:mi></mml:mrow></mml:msub> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mo>λ</mml:mo> <mml:mo>)</mml:mo></mml:mrow> <mml:mspace width="0.166667em"/><mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mo>λ</mml:mo> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(15)</label></disp-formula></p>
<p>We use Gibbs sampling, which is an MCMC algorithm, to sample from the posterior density. The algorithm exploits the hierarchical structure of the model and it proceeds by iteratively sampling from the conditional density of each variable (or a block of variables) at a time [<xref ref-type="bibr" rid="pcbi.1006534.ref034">34</xref>]. In the following we derive the conditional densities for the Gibbs sampling algorithm. We observed that some of the parameters <italic><bold>θ</bold></italic> are highly correlated which causes slow mixing of the resulting Markov chain and thus inefficient exploration of the parameter space. To make the algorithm more efficient, we reparametrise the model by defining new parameters <italic><bold>θ</bold></italic>′ = (<italic>n</italic><sub>eff</sub>, <italic>μ</italic>, <italic><bold>ω</bold></italic>, <bold>z</bold>, <italic><bold>η</bold></italic>, λ) via the transformation <italic><bold>η</bold></italic> = <italic>μ</italic> <bold>t</bold><sub>0</sub> and we use the Gibbs sampler for the transformed parameters <italic><bold>θ</bold></italic>′. This common strategy [<xref ref-type="bibr" rid="pcbi.1006534.ref034">34</xref>] resolves the problem arising from correlations between <italic>t</italic><sub>0<italic>i</italic></sub> and <italic>μ</italic>, because the magnitudes of all <italic>η</italic><sub><italic>i</italic></sub> can now be changed simultaneously by a single <italic>μ</italic> update. The original variables <italic>t</italic><sub>0<italic>i</italic></sub> can be obtained from the generated samples as <italic>t</italic><sub>0<italic>i</italic></sub> = <italic>η</italic><sub><italic>i</italic></sub>/<italic>μ</italic>.</p>
<p>The joint probability in <xref ref-type="disp-formula" rid="pcbi.1006534.e018">Eq 15</xref> for the transformed parameters then becomes
<disp-formula id="pcbi.1006534.e019"><alternatives><graphic id="pcbi.1006534.e019g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e019" xlink:type="simple"/><mml:math display="block" id="M19"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:mi>p</mml:mi> <mml:mo>(</mml:mo> <mml:mi mathvariant="bold">d</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mtext>eff</mml:mtext></mml:msub> <mml:mo>,</mml:mo> <mml:mi>μ</mml:mi> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">ω</mml:mi> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold">z</mml:mi> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">η</mml:mi> <mml:mo>,</mml:mo> <mml:mo>λ</mml:mo> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mi mathvariant="bold">t</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>D</mml:mi> <mml:mn>0</mml:mn></mml:msub> <mml:mo>)</mml:mo></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:mspace width="1.em"/><mml:mo>=</mml:mo> <mml:munderover><mml:mo>∏</mml:mo> <mml:mrow><mml:mi>i</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:mi>N</mml:mi></mml:munderover> <mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>d</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:msub><mml:mi mathvariant="bold">z</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mtext>eff</mml:mtext></mml:msub> <mml:mo>,</mml:mo> <mml:mi>μ</mml:mi> <mml:mo>,</mml:mo> <mml:msup><mml:mi>μ</mml:mi> <mml:mrow><mml:mo>-</mml:mo> <mml:mn>1</mml:mn></mml:mrow></mml:msup> <mml:mi mathvariant="bold-italic">η</mml:mi> <mml:mo>,</mml:mo> <mml:mo>λ</mml:mo> <mml:mo>,</mml:mo> <mml:msub><mml:mi>t</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mspace width="0.166667em"/><mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi mathvariant="bold">z</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mi mathvariant="bold-italic">ω</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mspace width="0.166667em"/><mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mtext>eff</mml:mtext></mml:msub> <mml:mo>,</mml:mo> <mml:mi>μ</mml:mi> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:msub><mml:mi>D</mml:mi> <mml:mn>0</mml:mn></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mspace width="0.166667em"/><mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi mathvariant="bold-italic">ω</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:munderover><mml:mo>∏</mml:mo> <mml:mrow><mml:mi>i</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:mi>N</mml:mi></mml:munderover> <mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msup><mml:mi>μ</mml:mi> <mml:mrow><mml:mo>-</mml:mo> <mml:mn>1</mml:mn></mml:mrow></mml:msup> <mml:mi mathvariant="bold-italic">η</mml:mi> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mo>λ</mml:mo> <mml:mo>)</mml:mo></mml:mrow> <mml:mspace width="0.166667em"/><mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mo>λ</mml:mo> <mml:mo>)</mml:mo></mml:mrow> <mml:msup><mml:mi>μ</mml:mi> <mml:mrow><mml:mo>-</mml:mo> <mml:mi>N</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:mspace width="1.em"/><mml:mo>=</mml:mo> <mml:munderover><mml:mo>∏</mml:mo> <mml:mrow><mml:mi>i</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:mi>N</mml:mi></mml:munderover> <mml:mo>[</mml:mo> <mml:msubsup><mml:mi>ω</mml:mi> <mml:mi>S</mml:mi> <mml:msub><mml:mi>z</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:msubsup> <mml:msub><mml:mi>p</mml:mi> <mml:mi>S</mml:mi></mml:msub> <mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>d</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:msub><mml:mi>t</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mtext>eff</mml:mtext></mml:msub> <mml:mo>,</mml:mo> <mml:mi>μ</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:msub><mml:mi>z</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:msup> <mml:msubsup><mml:mi>ω</mml:mi> <mml:mi>D</mml:mi> <mml:msub><mml:mi>z</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:msubsup> <mml:msub><mml:mi>p</mml:mi> <mml:mi>D</mml:mi></mml:msub> <mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>d</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:msub><mml:mi>t</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>η</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>/</mml:mo> <mml:mi>μ</mml:mi> <mml:mo>,</mml:mo> <mml:mi>μ</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:msub><mml:mi>z</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:msup> <mml:mo form="prefix">Gamma</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>η</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>/</mml:mo> <mml:mi>μ</mml:mi> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mi>k</mml:mi> <mml:mo>,</mml:mo> <mml:mo>λ</mml:mo> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>]</mml:mo></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:mspace width="1.em"/><mml:mspace width="1.em"/><mml:mo>·</mml:mo> <mml:mo form="prefix">Gamma</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:mo>λ</mml:mo> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mi>α</mml:mi> <mml:mo>,</mml:mo> <mml:mi>β</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo form="prefix">Dir</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:mi mathvariant="bold-italic">ω</mml:mi> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mi mathvariant="bold-italic">γ</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mtext>eff</mml:mtext></mml:msub> <mml:mo>,</mml:mo> <mml:mi>μ</mml:mi> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:msub><mml:mi>D</mml:mi> <mml:mn>0</mml:mn></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:msup><mml:mi>μ</mml:mi> <mml:mrow><mml:mo>-</mml:mo> <mml:mi>N</mml:mi></mml:mrow></mml:msup> <mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(16)</label></disp-formula>
where <italic>μ</italic><sup>−<italic>N</italic></sup> is the determinant of the Jacobian of the inverse transformation. Computing the conditional density of parameter <italic><bold>ω</bold></italic> is straightforward. We neglect those terms in <xref ref-type="disp-formula" rid="pcbi.1006534.e019">Eq 16</xref> that do not depend on <bold><italic>ω</italic></bold> and recognise the resulting formula as an unnormalised Dirichlet distribution. We then obtain
<disp-formula id="pcbi.1006534.e020"><alternatives><graphic id="pcbi.1006534.e020g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e020" xlink:type="simple"/><mml:math display="block" id="M20"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>p</mml:mi> <mml:mo>(</mml:mo> <mml:mi mathvariant="bold-italic">ω</mml:mi> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mi mathvariant="bold">z</mml:mi> <mml:mo>,</mml:mo> <mml:mi>D</mml:mi> <mml:mo>)</mml:mo> <mml:mo>=</mml:mo> <mml:mo form="prefix">Dir</mml:mo> <mml:mo>(</mml:mo> <mml:mi mathvariant="bold-italic">ω</mml:mi> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mi mathvariant="bold">n</mml:mi> <mml:mo>+</mml:mo> <mml:mi mathvariant="bold-italic">γ</mml:mi> <mml:mo>)</mml:mo> <mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(17)</label></disp-formula>
with <bold>n</bold> = (<italic>n</italic><sub>1</sub>, <italic>n</italic><sub>2</sub>)<sup><italic>T</italic></sup>, where <inline-formula id="pcbi.1006534.e021"><alternatives><graphic id="pcbi.1006534.e021g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e021" xlink:type="simple"/><mml:math display="inline" id="M21"><mml:mrow><mml:msub><mml:mi>n</mml:mi> <mml:mn>1</mml:mn></mml:msub> <mml:mo>=</mml:mo> <mml:msubsup><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>i</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:mi>N</mml:mi></mml:msubsup> <mml:msub><mml:mi>z</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1006534.e022"><alternatives><graphic id="pcbi.1006534.e022g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e022" xlink:type="simple"/><mml:math display="inline" id="M22"><mml:mrow><mml:msub><mml:mi>n</mml:mi> <mml:mn>2</mml:mn></mml:msub> <mml:mo>=</mml:mo> <mml:msubsup><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>i</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:mi>N</mml:mi></mml:msubsup> <mml:msub><mml:mi>z</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mn>2</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>. Next we consider the latent variables <bold>z</bold><sub><italic>i</italic></sub>. We see that the conditional distribution of <bold>z</bold><sub><italic>i</italic></sub> for any <italic>i</italic> = 1, …, <italic>N</italic> does not depend on other latent variables <bold>z</bold><sub><italic>j</italic></sub>, <italic>j</italic> ≠ <italic>i</italic>. Specifically, we obtain
<disp-formula id="pcbi.1006534.e023"><alternatives><graphic id="pcbi.1006534.e023g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e023" xlink:type="simple"/><mml:math display="block" id="M23"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi> <mml:mo>(</mml:mo> <mml:msub><mml:mi>z</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mn>1</mml:mn></mml:mrow></mml:msub> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:msub><mml:mi>n</mml:mi> <mml:mtext>eff</mml:mtext></mml:msub> <mml:mo>,</mml:mo> <mml:mi>μ</mml:mi> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">ω</mml:mi> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">η</mml:mi> <mml:mo>,</mml:mo> <mml:mi>D</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mo>∝</mml:mo> <mml:msub><mml:mi>ω</mml:mi> <mml:mi>S</mml:mi></mml:msub> <mml:msub><mml:mi>p</mml:mi> <mml:mi>S</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>d</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:msub><mml:mi>t</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mtext>eff</mml:mtext></mml:msub> <mml:mo>,</mml:mo> <mml:mi>μ</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(18)</label></disp-formula> <disp-formula id="pcbi.1006534.e024"><alternatives><graphic id="pcbi.1006534.e024g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e024" xlink:type="simple"/><mml:math display="block" id="M24"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi mathvariant="double-struck">P</mml:mi> <mml:mo>(</mml:mo> <mml:msub><mml:mi>z</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mn>2</mml:mn></mml:mrow></mml:msub> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:msub><mml:mi>n</mml:mi> <mml:mtext>eff</mml:mtext></mml:msub> <mml:mo>,</mml:mo> <mml:mi>μ</mml:mi> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">ω</mml:mi> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">η</mml:mi> <mml:mo>,</mml:mo> <mml:mi>D</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mo>∝</mml:mo> <mml:msub><mml:mi>ω</mml:mi> <mml:mi>D</mml:mi></mml:msub> <mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:mn>2</mml:mn> <mml:msub><mml:mi>η</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>+</mml:mo> <mml:mi>μ</mml:mi> <mml:msub><mml:mi>t</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:msub><mml:mi>d</mml:mi> <mml:mi>i</mml:mi></mml:msub></mml:msup> <mml:msup><mml:mi>e</mml:mi> <mml:mrow><mml:mo>-</mml:mo> <mml:mo>(</mml:mo> <mml:mn>2</mml:mn> <mml:msub><mml:mi>η</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>+</mml:mo> <mml:mi>μ</mml:mi> <mml:msub><mml:mi>t</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow></mml:msup></mml:mrow> <mml:mrow><mml:msub><mml:mi>d</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>!</mml:mo></mml:mrow></mml:mfrac> <mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(19)</label></disp-formula></p>
<p>We expect the effective sample size <italic>n</italic><sub>eff</sub> and the mutation parameter <italic>μ</italic> to be correlated a posteriori so we include them to the same block and update them together. We also include λ to this block as it also tends to be correlated with <italic>n</italic><sub>eff</sub> and <italic>μ</italic>. It is convenient to replace the sampling step from <italic>p</italic>(<italic>n</italic><sub>eff</sub>, <italic>μ</italic>, λ|<italic><bold>ω</bold></italic>, <bold>z</bold>, <italic><bold>η</bold></italic>, <italic>D</italic>, <italic>D</italic><sub>0</sub>) with the following two consecutive sampling steps: first sample from <italic>p</italic>(<italic>n</italic><sub>eff</sub>, <italic>μ</italic> | <italic><bold>ω</bold></italic>, <bold>z</bold>, <italic><bold>η</bold></italic>, <italic>D</italic>, <italic>D</italic><sub>0</sub>) = ∫ <italic>p</italic>(<italic>n</italic><sub>eff</sub>, <italic>μ</italic>, λ | <italic><bold>ω</bold></italic>, <bold>z</bold>, <italic><bold>η</bold></italic>, <italic>D</italic>, <italic>D</italic><sub>0</sub>) dλ and then sample from <italic>p</italic>(λ|<italic>n</italic><sub>eff</sub>, <italic>μ</italic>, <bold>ω</bold>, <bold>z</bold>, <bold><italic>η</italic></bold>, <italic>D</italic>, <italic>D</italic><sub>0</sub>). From <xref ref-type="disp-formula" rid="pcbi.1006534.e019">Eq 16</xref> we observe that
<disp-formula id="pcbi.1006534.e025"><alternatives><graphic id="pcbi.1006534.e025g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e025" xlink:type="simple"/><mml:math display="block" id="M25"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>p</mml:mi> <mml:mo>(</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mtext>eff</mml:mtext></mml:msub> <mml:mo>,</mml:mo> <mml:mi>μ</mml:mi> <mml:mo>,</mml:mo> <mml:mo>λ</mml:mo> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mi mathvariant="bold">z</mml:mi> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">η</mml:mi> <mml:mo>,</mml:mo> <mml:mi>D</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>D</mml:mi> <mml:mn>0</mml:mn></mml:msub> <mml:mo>)</mml:mo></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mo>∝</mml:mo> <mml:munderover><mml:mo>∏</mml:mo> <mml:mrow><mml:mi>i</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:mi>N</mml:mi></mml:munderover> <mml:mo>[</mml:mo> <mml:msub><mml:mi>p</mml:mi> <mml:mi>S</mml:mi></mml:msub> <mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>d</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:msub><mml:mi>t</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mtext>eff</mml:mtext></mml:msub> <mml:mo>,</mml:mo> <mml:mi>μ</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:msub><mml:mi>z</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:msup> <mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:mn>2</mml:mn> <mml:msub><mml:mi>η</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>+</mml:mo> <mml:mi>μ</mml:mi> <mml:msub><mml:mi>t</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:msub><mml:mi>z</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mn>2</mml:mn></mml:mrow></mml:msub> <mml:msub><mml:mi>d</mml:mi> <mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msup> <mml:mo>]</mml:mo> <mml:mfrac><mml:msup><mml:mi>e</mml:mi> <mml:mrow><mml:mo>-</mml:mo> <mml:mi>μ</mml:mi> <mml:msubsup><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>i</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:mi>N</mml:mi></mml:msubsup> <mml:msub><mml:mi>z</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mn>2</mml:mn></mml:mrow></mml:msub> <mml:msub><mml:mi>t</mml:mi> <mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msup> <mml:msup><mml:mi>μ</mml:mi> <mml:mrow><mml:mi>N</mml:mi> <mml:mi>k</mml:mi></mml:mrow></mml:msup></mml:mfrac></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:mo>·</mml:mo> <mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mtext>eff</mml:mtext></mml:msub> <mml:mo>,</mml:mo> <mml:mi>μ</mml:mi> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:msub><mml:mi>D</mml:mi> <mml:mn>0</mml:mn></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:msup><mml:mo>λ</mml:mo> <mml:mrow><mml:mi>N</mml:mi> <mml:mi>k</mml:mi> <mml:mo>+</mml:mo> <mml:mi>α</mml:mi> <mml:mo>-</mml:mo> <mml:mn>1</mml:mn></mml:mrow></mml:msup> <mml:msup><mml:mi>e</mml:mi> <mml:mrow><mml:mo>-</mml:mo> <mml:mo>λ</mml:mo> <mml:mo>(</mml:mo> <mml:msup><mml:mi>μ</mml:mi> <mml:mrow><mml:mo>-</mml:mo> <mml:mn>1</mml:mn></mml:mrow></mml:msup> <mml:msubsup><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>i</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:mi>N</mml:mi></mml:msubsup> <mml:msub><mml:mi>η</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>+</mml:mo> <mml:mi>β</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:msup> <mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(20)</label></disp-formula></p>
<p>The above formula is recognised to be proportional to a Gamma density as a function of λ. We can thus marginalise λ easily to obtain the following density for the first step
<disp-formula id="pcbi.1006534.e026"><alternatives><graphic id="pcbi.1006534.e026g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e026" xlink:type="simple"/><mml:math display="block" id="M26"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:mi>p</mml:mi> <mml:mo>(</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mtext>eff</mml:mtext></mml:msub> <mml:mo>,</mml:mo> <mml:mi>μ</mml:mi> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mi mathvariant="bold">z</mml:mi> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">η</mml:mi> <mml:mo>,</mml:mo> <mml:mi>D</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>D</mml:mi> <mml:mn>0</mml:mn></mml:msub> <mml:mo>)</mml:mo></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:mo>∝</mml:mo> <mml:munderover><mml:mo>∏</mml:mo> <mml:mrow><mml:mi>i</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:mi>N</mml:mi></mml:munderover> <mml:mo>[</mml:mo> <mml:msub><mml:mi>p</mml:mi> <mml:mi>S</mml:mi></mml:msub> <mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>d</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:msub><mml:mi>t</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mtext>eff</mml:mtext></mml:msub> <mml:mo>,</mml:mo> <mml:mi>μ</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:msub><mml:mi>z</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:msup> <mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:mn>2</mml:mn> <mml:msub><mml:mi>η</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>+</mml:mo> <mml:mi>μ</mml:mi> <mml:msub><mml:mi>t</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:msub><mml:mi>z</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mn>2</mml:mn></mml:mrow></mml:msub> <mml:msub><mml:mi>d</mml:mi> <mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msup> <mml:mo>]</mml:mo> <mml:mfrac><mml:mrow><mml:msup><mml:mi>e</mml:mi> <mml:mrow><mml:mo>-</mml:mo> <mml:mi>μ</mml:mi> <mml:msubsup><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>i</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:mi>N</mml:mi></mml:msubsup> <mml:msub><mml:mi>z</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mn>2</mml:mn></mml:mrow></mml:msub> <mml:msub><mml:mi>t</mml:mi> <mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msup> <mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mtext>eff</mml:mtext></mml:msub> <mml:mo>,</mml:mo> <mml:mi>μ</mml:mi> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:msub><mml:mi>D</mml:mi> <mml:mn>0</mml:mn></mml:msub> <mml:mo>)</mml:mo></mml:mrow></mml:mrow> <mml:mrow><mml:msup><mml:mi>μ</mml:mi> <mml:mrow><mml:mi>N</mml:mi> <mml:mi>k</mml:mi></mml:mrow></mml:msup> <mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:msup><mml:mi>μ</mml:mi> <mml:mrow><mml:mo>-</mml:mo> <mml:mn>1</mml:mn></mml:mrow></mml:msup> <mml:msubsup><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>i</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:mi>N</mml:mi></mml:msubsup> <mml:msub><mml:mi>η</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>+</mml:mo> <mml:mi>β</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mi>N</mml:mi> <mml:mi>k</mml:mi> <mml:mo>+</mml:mo> <mml:mi>α</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mfrac> <mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(21)</label></disp-formula></p>
<p>In the second step, we sample λ from the probability density
<disp-formula id="pcbi.1006534.e027"><alternatives><graphic id="pcbi.1006534.e027g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e027" xlink:type="simple"/><mml:math display="block" id="M27"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mo>λ</mml:mo> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mi>μ</mml:mi> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">η</mml:mi> <mml:mo>,</mml:mo> <mml:mi>D</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:mo form="prefix">Gamma</mml:mo> <mml:mo>(</mml:mo> <mml:mrow><mml:mo>λ</mml:mo> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mi>N</mml:mi> <mml:mi>k</mml:mi> <mml:mo>+</mml:mo> <mml:mi>α</mml:mi> <mml:mo>,</mml:mo> <mml:mi>β</mml:mi> <mml:mo>+</mml:mo></mml:mrow> <mml:mfrac><mml:mn>1</mml:mn> <mml:mi>μ</mml:mi></mml:mfrac> <mml:munderover><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>i</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:mi>N</mml:mi></mml:munderover> <mml:msub><mml:mi>η</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>)</mml:mo> <mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(22)</label></disp-formula></p>
<p>This formula follows directly from <xref ref-type="disp-formula" rid="pcbi.1006534.e025">Eq 20</xref>.</p>
<p>Sampling from <xref ref-type="disp-formula" rid="pcbi.1006534.e026">Eq 21</xref> and sampling <bold>z</bold> using <xref ref-type="disp-formula" rid="pcbi.1006534.e023">Eq 18</xref> are challenging because <italic>p</italic><sub><italic>S</italic></sub> is defined implicitly via the W-F simulation model. Consequently, we will consider an approximation that allows to compute <italic>p</italic><sub><italic>S</italic></sub>(<italic>d</italic><sub><italic>i</italic></sub>|<italic>t</italic><sub><italic>i</italic></sub>, <italic>n</italic><sub>eff</sub>, <italic>μ</italic>) for any proposed point (<italic>n</italic><sub>eff</sub>, <italic>μ</italic>) and all values of <italic>d</italic><sub><italic>i</italic></sub> and <italic>t</italic><sub><italic>i</italic></sub> in the data. Since <italic>d</italic><sub><italic>i</italic></sub> = <italic>d</italic><sub><italic>i</italic>1</sub> + <italic>d</italic><sub><italic>i</italic>2</sub>, we can use the convolution formula for a sum of discrete random variables to see that
<disp-formula id="pcbi.1006534.e028"><alternatives><graphic id="pcbi.1006534.e028g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e028" xlink:type="simple"/><mml:math display="block" id="M28"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>p</mml:mi> <mml:mi>S</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>d</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:msub><mml:mi>t</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mtext>eff</mml:mtext></mml:msub> <mml:mo>,</mml:mo> <mml:mi>μ</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mo>=</mml:mo> <mml:munderover><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>j</mml:mi> <mml:mo>=</mml:mo> <mml:mo form="prefix" movablelimits="true">max</mml:mo> <mml:mo>{</mml:mo> <mml:mn>0</mml:mn> <mml:mo>,</mml:mo> <mml:msub><mml:mi>d</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mi>d</mml:mi> <mml:mi>m</mml:mi></mml:msub> <mml:mo>}</mml:mo></mml:mrow> <mml:msub><mml:mi>d</mml:mi> <mml:mi>i</mml:mi></mml:msub></mml:munderover> <mml:mo form="prefix">Poisson</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>j</mml:mi> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mi>μ</mml:mi> <mml:msub><mml:mi>t</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:msub><mml:mi>p</mml:mi> <mml:mtext>sim</mml:mtext></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>d</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>-</mml:mo> <mml:mi>j</mml:mi> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:msub><mml:mi>n</mml:mi> <mml:mtext>eff</mml:mtext></mml:msub> <mml:mo>,</mml:mo> <mml:mi>μ</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(23)</label></disp-formula>
where <italic>p</italic><sub>sim</sub> specifies the distribution for a distance between two genomes as in <xref ref-type="disp-formula" rid="pcbi.1006534.e003">Eq 3</xref> and <italic>d</italic><sub><italic>m</italic></sub> is the maximum distance that can be obtained from <italic>p</italic><sub>sim</sub>.</p>
<p>Since <italic>p</italic><sub>sim</sub>(<italic>d</italic><sub><italic>i</italic>1</sub>|<italic>n</italic><sub>eff</sub>, <italic>μ</italic>) is not available analytically, we estimate this probability mass function by simulation. A special case is if we know that there is no variation in the population at the time of taking the first sample <italic>s</italic><sub><italic>i</italic>1</sub>, which can happen if we know that the acquisition happened just before the first sample. In this case, <italic>d</italic><sub><italic>i</italic>1</sub> = 0, and we do not need the simulation. Since this is usually not the case, we use a general solution as follows: for each (<italic>n</italic><sub>eff</sub>, <italic>μ</italic>) value, we sample independently <inline-formula id="pcbi.1006534.e029"><alternatives><graphic id="pcbi.1006534.e029g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e029" xlink:type="simple"/><mml:math display="inline" id="M29"><mml:mrow><mml:msubsup><mml:mi>d</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mn>1</mml:mn></mml:mrow> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>j</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:msubsup> <mml:mo>∼</mml:mo> <mml:msub><mml:mi>p</mml:mi> <mml:mtext>sim</mml:mtext></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mo>·</mml:mo> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:msub><mml:mi>n</mml:mi> <mml:mtext>eff</mml:mtext></mml:msub> <mml:mo>,</mml:mo> <mml:mi>μ</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> by simulating the W-F model, sample a pair of genomes at a fixed time <italic>t</italic> from the simulated population, and compute their distance <inline-formula id="pcbi.1006534.e030"><alternatives><graphic id="pcbi.1006534.e030g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e030" xlink:type="simple"/><mml:math display="inline" id="M30"><mml:msubsup><mml:mi>d</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mn>1</mml:mn></mml:mrow> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>j</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:msubsup></mml:math></alternatives></inline-formula>. This is repeated for <italic>j</italic> = 1, …, <italic>s</italic>. Since <italic>d</italic><sub><italic>i</italic>1</sub> is discrete, we approximate
<disp-formula id="pcbi.1006534.e031"><alternatives><graphic id="pcbi.1006534.e031g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e031" xlink:type="simple"/><mml:math display="block" id="M31"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>p</mml:mi> <mml:mtext>sim</mml:mtext></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>d</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mn>1</mml:mn></mml:mrow></mml:msub> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:msub><mml:mi>n</mml:mi> <mml:mtext>eff</mml:mtext></mml:msub> <mml:mo>,</mml:mo> <mml:mi>μ</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>≈</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>p</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mtext>sim</mml:mtext></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>d</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mn>1</mml:mn></mml:mrow></mml:msub> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:msub><mml:mi>n</mml:mi> <mml:mtext>eff</mml:mtext></mml:msub> <mml:mo>,</mml:mo> <mml:mi>μ</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:mfrac><mml:mn>1</mml:mn> <mml:mi>s</mml:mi></mml:mfrac> <mml:munderover><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>j</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:mi>s</mml:mi></mml:munderover> <mml:msub><mml:mn mathvariant="double-struck">1</mml:mn> <mml:mrow><mml:msubsup><mml:mi>d</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mn>1</mml:mn></mml:mrow> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>j</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:msubsup> <mml:mo>=</mml:mo> <mml:msub><mml:mi>d</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow></mml:msub> <mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(24)</label></disp-formula>
for all <italic>i</italic>. Since in data <italic>D</italic> we do not know the acquisition times, we set <italic>t</italic> = 6000 generations and use this same value for all <italic>i</italic>. This large value represents a steady state of the simulation, where the variation in the population occasionally increases and decreases as new lineages emerge and old ones die out, which can be seen as corresponding to a reasonable default expectation about population variability when the true acquisition time is unknown. While this assumption was introduced for computational necessity, it can be justified by considering its impact on the inferences: the simplification may cause slightly overestimated distances <italic>d</italic><sub><italic>i</italic>1</sub> if many acquisitions in reality happened very recently. The consequence is that the criterion for reporting new acquisitions becomes more <italic>conservative</italic>, because now the ‘same strain’ model will place some probability mass on occasional greater distances, and hence better accommodate also distant genomes which might otherwise have been considered as different strains.</p>
<p>Some of the resulting probability mass functions <inline-formula id="pcbi.1006534.e032"><alternatives><graphic id="pcbi.1006534.e032g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e032" xlink:type="simple"/><mml:math display="inline" id="M32"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>p</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mtext>sim</mml:mtext></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>d</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mn>1</mml:mn></mml:mrow></mml:msub> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:msub><mml:mi>n</mml:mi> <mml:mtext>eff</mml:mtext></mml:msub> <mml:mo>,</mml:mo> <mml:mi>μ</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> were already shown in <xref ref-type="fig" rid="pcbi.1006534.g004">Fig 4</xref>. In practice, the computations above are done using logarithms and the fact <inline-formula id="pcbi.1006534.e033"><alternatives><graphic id="pcbi.1006534.e033g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e033" xlink:type="simple"/><mml:math display="inline" id="M33"><mml:mrow><mml:mo form="prefix">log</mml:mo> <mml:msub><mml:mo>∑</mml:mo> <mml:mi>i</mml:mi></mml:msub> <mml:msup><mml:mi>e</mml:mi> <mml:msub><mml:mi>a</mml:mi> <mml:mi>i</mml:mi></mml:msub></mml:msup> <mml:mo>=</mml:mo> <mml:msub><mml:mo form="prefix" movablelimits="true">max</mml:mo> <mml:mi>i</mml:mi></mml:msub> <mml:mrow><mml:mo>{</mml:mo> <mml:msub><mml:mi>a</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>}</mml:mo></mml:mrow> <mml:mo>+</mml:mo> <mml:mo form="prefix">log</mml:mo> <mml:msub><mml:mo>∑</mml:mo> <mml:mi>i</mml:mi></mml:msub> <mml:msup><mml:mi>e</mml:mi> <mml:mrow><mml:msub><mml:mi>a</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mo form="prefix" movablelimits="true">max</mml:mo> <mml:mi>i</mml:mi></mml:msub> <mml:mrow><mml:mo>{</mml:mo> <mml:msub><mml:mi>a</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:msup></mml:mrow></mml:math></alternatives></inline-formula>, to avoid numerical underflow, which can occur whenever <italic>a</italic><sub><italic>i</italic></sub> ≪ 0. The finite sample size <italic>s</italic> causes some numerical error, but, because the distances are usually small enough that the number of values we need to consider is limited, <italic>s</italic> can be made large enough without too extensive computation, making this error small in general. The above procedure allows computation of the conditional density in <xref ref-type="disp-formula" rid="pcbi.1006534.e026">Eq 21</xref> for any (<italic>n</italic><sub>eff</sub>, <italic>μ</italic>), and we can use a Metropolis update for (<italic>n</italic><sub>eff</sub>, <italic>μ</italic>). We marginalised λ in <xref ref-type="disp-formula" rid="pcbi.1006534.e026">Eq 21</xref> to improve the mixing of the chain and to be able to use the analytical formula in <xref ref-type="disp-formula" rid="pcbi.1006534.e027">Eq 22</xref>, and in the supplementary material we justify that this algorithm is valid under the assumption that a new λ parameter is sampled only if the corresponding proposed value (<italic>n</italic><sub>eff</sub>, <italic>μ</italic>) has been accepted.</p>
<p>Whenever a new (<italic>n</italic><sub>eff</sub>, <italic>μ</italic>)-parameter is proposed, we need to compute <italic>p</italic><sub>sim</sub> at this point to check the acceptance condition. This value is also needed when sampling <bold>z</bold>. However, computing <italic>p</italic><sub>sim</sub> on each MCMC iteration as described earlier makes the algorithm slow. Consequently, we instead precompute the values of <italic>p</italic><sub>sim</sub> in a dense grid of (<italic>n</italic><sub>eff</sub>, <italic>μ</italic>)-points which can be done in a parallel manner on a computer cluster. Given the grid values, we use bilinear interpolation to approximate <italic>p</italic><sub>sim</sub> at each proposed point <inline-formula id="pcbi.1006534.e034"><alternatives><graphic id="pcbi.1006534.e034g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e034" xlink:type="simple"/><mml:math display="inline" id="M34"><mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mi>n</mml:mi> <mml:mrow><mml:mtext>eff</mml:mtext></mml:mrow> <mml:mo>*</mml:mo></mml:msubsup> <mml:mo>,</mml:mo> <mml:msup><mml:mi>μ</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>. We proceed similarly also with the prior density <italic>p</italic>(<italic>n</italic><sub>eff</sub>, <italic>μ</italic>|<italic>D</italic><sub>0</sub>). This approach also allows one to fit the mixture model using different modelling assumptions or different data sets without need to repeat the costly W-F simulations.</p>
<p>Finally, we see that the probability density of <italic>η</italic><sub><italic>i</italic></sub> conditioned on the other variables does not depend on <italic>η</italic><sub><italic>j</italic></sub>, <italic>j</italic> ≠ <italic>i</italic>. Specifically, we obtain
<disp-formula id="pcbi.1006534.e035"><alternatives><graphic id="pcbi.1006534.e035g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e035" xlink:type="simple"/><mml:math display="block" id="M35"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>η</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mi>μ</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi mathvariant="bold">z</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:mo>λ</mml:mo> <mml:mo>,</mml:mo> <mml:mi>D</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:mo>{</mml:mo> <mml:mtable><mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:mo form="prefix">Gamma</mml:mo> <mml:mo>(</mml:mo> <mml:msub><mml:mi>η</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mi>k</mml:mi> <mml:mo>,</mml:mo> <mml:mo>λ</mml:mo> <mml:mo>/</mml:mo> <mml:mi>μ</mml:mi> <mml:mo>)</mml:mo> <mml:mo>,</mml:mo></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mtext>if</mml:mtext> <mml:mspace width="4.pt"/><mml:msub><mml:mi>z</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mn>2</mml:mn></mml:mrow></mml:msub> <mml:mo>=</mml:mo> <mml:mn>0</mml:mn></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:munderover><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>j</mml:mi> <mml:mo>=</mml:mo> <mml:mn>0</mml:mn></mml:mrow> <mml:msub><mml:mi>d</mml:mi> <mml:mi>i</mml:mi></mml:msub></mml:munderover> <mml:msub><mml:mi>w</mml:mi> <mml:mi>j</mml:mi></mml:msub> <mml:mo form="prefix">Gamma</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>η</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mi>k</mml:mi> <mml:mo>+</mml:mo> <mml:mi>j</mml:mi> <mml:mo>,</mml:mo> <mml:mn>2</mml:mn> <mml:mo>+</mml:mo> <mml:mo>λ</mml:mo> <mml:mo>/</mml:mo> <mml:mi>μ</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>,</mml:mo></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mtext>if</mml:mtext> <mml:mspace width="4.pt"/><mml:msub><mml:mi>z</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mn>2</mml:mn></mml:mrow></mml:msub> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow></mml:mtd></mml:mtr></mml:mtable> <mml:mo/></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(25)</label></disp-formula>
for <italic>i</italic> = 1, …, <italic>N</italic>. Derivation of this result, the formula for the mixture weights <italic>w</italic><sub><italic>j</italic></sub> and a special algorithm (Algorithm 2) to generate random values from this density are shown in the supplementary material.</p>
<p>The resulting Gibbs sampler is presented as Algorithm 1. It could be alternatively called a Metropolis-within-Gibbs sampler since some of the parameters (<italic>n</italic><sub>eff</sub> and <italic>μ</italic>) are sampled using a Metropolis-Hastings step using a proposal density that is denoted as <italic>q</italic>. Because <italic>n</italic><sub>eff</sub> is a discrete random variable, (<italic>n</italic><sub>eff</sub>, <italic>μ</italic>) is a mixed random vector and we cannot use the standard Gaussian proposal. Instead, we consider the distribution
<disp-formula id="pcbi.1006534.e036"><alternatives><graphic id="pcbi.1006534.e036g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e036" xlink:type="simple"/><mml:math display="block" id="M36"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>q</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mi>n</mml:mi> <mml:mrow><mml:mtext>eff</mml:mtext></mml:mrow> <mml:mo>*</mml:mo></mml:msubsup> <mml:mo>,</mml:mo> <mml:msup><mml:mi>μ</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>)</mml:mo></mml:mrow> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mtext>eff</mml:mtext></mml:msub> <mml:mo>,</mml:mo> <mml:mi>μ</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>∝</mml:mo> <mml:munder><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>n</mml:mi> <mml:mo>∈</mml:mo> <mml:mi mathvariant="double-struck">Z</mml:mi></mml:mrow></mml:munder> <mml:mo form="prefix">exp</mml:mo> <mml:mo>(</mml:mo> <mml:mo>-</mml:mo> <mml:mfrac><mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:msup><mml:mi>μ</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>-</mml:mo> <mml:mi>μ</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mn>2</mml:mn></mml:msup> <mml:mrow><mml:mn>2</mml:mn> <mml:msubsup><mml:mi>σ</mml:mi> <mml:mrow><mml:mi>q</mml:mi> <mml:mo>,</mml:mo> <mml:mi>μ</mml:mi></mml:mrow> <mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mfrac> <mml:mo>-</mml:mo> <mml:mfrac><mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mi>n</mml:mi> <mml:mrow><mml:mtext>eff</mml:mtext></mml:mrow> <mml:mo>*</mml:mo></mml:msubsup> <mml:mo>-</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mtext>eff</mml:mtext></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mn>2</mml:mn></mml:msup> <mml:mrow><mml:mn>2</mml:mn> <mml:msubsup><mml:mi>σ</mml:mi> <mml:mrow><mml:mi>q</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mtext>eff</mml:mtext></mml:msub></mml:mrow> <mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mfrac> <mml:mo>)</mml:mo> <mml:mi>δ</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>n</mml:mi> <mml:mo>-</mml:mo> <mml:msubsup><mml:mi>n</mml:mi> <mml:mrow><mml:mtext>eff</mml:mtext></mml:mrow> <mml:mo>*</mml:mo></mml:msubsup> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(26)</label></disp-formula>
where <inline-formula id="pcbi.1006534.e037"><alternatives><graphic id="pcbi.1006534.e037g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e037" xlink:type="simple"/><mml:math display="inline" id="M37"><mml:msubsup><mml:mi>σ</mml:mi> <mml:mrow><mml:mi>q</mml:mi> <mml:mo>,</mml:mo> <mml:mi>μ</mml:mi></mml:mrow> <mml:mn>2</mml:mn></mml:msubsup></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1006534.e038"><alternatives><graphic id="pcbi.1006534.e038g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e038" xlink:type="simple"/><mml:math display="inline" id="M38"><mml:msubsup><mml:mi>σ</mml:mi> <mml:mrow><mml:mi>q</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mtext>eff</mml:mtext></mml:msub></mml:mrow> <mml:mn>2</mml:mn></mml:msubsup></mml:math></alternatives></inline-formula> are chosen to produce acceptance probability of the Metropolis step close to 0.25 and <italic>δ</italic>(⋅) is the Dirac delta function. The first element of a random sample from <italic>q</italic> in <xref ref-type="disp-formula" rid="pcbi.1006534.e036">Eq 26</xref> is an integer, and this proposal is also symmetric. We truncate the tails of <italic>q</italic> with respect to <italic>n</italic><sub>eff</sub> to be able to sample the discrete element from <italic>q</italic> efficiently. In practice we then use a proposal <italic>q</italic> that is a mixture density where the components are as in <xref ref-type="disp-formula" rid="pcbi.1006534.e036">Eq 26</xref> but with different variance parameters <inline-formula id="pcbi.1006534.e039"><alternatives><graphic id="pcbi.1006534.e039g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e039" xlink:type="simple"/><mml:math display="inline" id="M39"><mml:msubsup><mml:mi>σ</mml:mi> <mml:mrow><mml:mi>q</mml:mi> <mml:mo>,</mml:mo> <mml:mi>μ</mml:mi></mml:mrow> <mml:mn>2</mml:mn></mml:msubsup></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1006534.e040"><alternatives><graphic id="pcbi.1006534.e040g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e040" xlink:type="simple"/><mml:math display="inline" id="M40"><mml:msubsup><mml:mi>σ</mml:mi> <mml:mrow><mml:mi>q</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mtext>eff</mml:mtext></mml:msub></mml:mrow> <mml:mn>2</mml:mn></mml:msubsup></mml:math></alternatives></inline-formula> to occasionally propose large steps to increase the exploration of the parameter space.</p>
<p><bold>Algorithm 1</bold> MH-within-Gibbs sampling algorithm for the mixture model</p>
<p specific-use="line">select an initial parameter <bold><italic>θ</italic></bold>′<sup>(0)</sup> (e.g. by sampling from the prior <italic>p</italic>(<bold><italic>θ</italic></bold>′)), proposal <italic>q</italic> and the number of samples <italic>s</italic></p>
<p specific-use="line"><bold>for</bold> <italic>i</italic> = 1, …, <italic>s</italic> <bold>do</bold></p>
<p specific-use="line"> sample <inline-formula id="pcbi.1006534.e041"><alternatives><graphic id="pcbi.1006534.e041g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e041" xlink:type="simple"/><mml:math display="inline" id="M41"><mml:mrow><mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mi>n</mml:mi> <mml:mrow><mml:mtext>eff</mml:mtext></mml:mrow> <mml:mo>*</mml:mo></mml:msubsup> <mml:mo>,</mml:mo> <mml:msup><mml:mi>μ</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>∼</mml:mo> <mml:mi>q</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mo>·</mml:mo> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mi>n</mml:mi> <mml:mrow><mml:mtext>eff</mml:mtext></mml:mrow> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>i</mml:mi> <mml:mo>-</mml:mo> <mml:mn>1</mml:mn> <mml:mo>)</mml:mo></mml:mrow></mml:msubsup> <mml:mo>,</mml:mo> <mml:msup><mml:mi>μ</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>i</mml:mi> <mml:mo>-</mml:mo> <mml:mn>1</mml:mn> <mml:mo>)</mml:mo></mml:mrow></mml:msup> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1006534.e042"><alternatives><graphic id="pcbi.1006534.e042g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e042" xlink:type="simple"/><mml:math display="inline" id="M42"><mml:mrow><mml:mi>u</mml:mi> <mml:mo>∼</mml:mo> <mml:mo mathvariant="script">U</mml:mo> <mml:mo>(</mml:mo> <mml:mo>[</mml:mo> <mml:mn>0</mml:mn> <mml:mo>,</mml:mo> <mml:mn>1</mml:mn> <mml:mo>]</mml:mo> <mml:mo>)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula></p>
<p specific-use="line"> compute <inline-formula id="pcbi.1006534.e043"><alternatives><graphic id="pcbi.1006534.e043g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e043" xlink:type="simple"/><mml:math display="inline" id="M43"><mml:mrow><mml:mi>ρ</mml:mi> <mml:mo>=</mml:mo> <mml:mo form="prefix" movablelimits="true">min</mml:mo> <mml:mo>{</mml:mo> <mml:mn>1</mml:mn> <mml:mo>,</mml:mo> <mml:mfrac><mml:mrow><mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mi>n</mml:mi> <mml:mrow><mml:mtext>eff</mml:mtext></mml:mrow> <mml:mo>*</mml:mo></mml:msubsup> <mml:mo>,</mml:mo> <mml:msup><mml:mi>μ</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:msup><mml:mi mathvariant="bold">z</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>i</mml:mi> <mml:mo>-</mml:mo> <mml:mn>1</mml:mn> <mml:mo>)</mml:mo></mml:mrow></mml:msup> <mml:mo>,</mml:mo> <mml:msup><mml:mi mathvariant="bold-italic">η</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>i</mml:mi> <mml:mo>-</mml:mo> <mml:mn>1</mml:mn> <mml:mo>)</mml:mo></mml:mrow></mml:msup> <mml:mo>,</mml:mo> <mml:mi>D</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>D</mml:mi> <mml:mn>0</mml:mn></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mi>q</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mi>n</mml:mi> <mml:mrow><mml:mtext>eff</mml:mtext></mml:mrow> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>i</mml:mi> <mml:mo>-</mml:mo> <mml:mn>1</mml:mn> <mml:mo>)</mml:mo></mml:mrow></mml:msubsup> <mml:mo>,</mml:mo> <mml:msup><mml:mi>μ</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>i</mml:mi> <mml:mo>-</mml:mo> <mml:mn>1</mml:mn> <mml:mo>)</mml:mo></mml:mrow></mml:msup> <mml:mo>)</mml:mo></mml:mrow> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mi>n</mml:mi> <mml:mrow><mml:mtext>eff</mml:mtext></mml:mrow> <mml:mo>*</mml:mo></mml:msubsup> <mml:mo>,</mml:mo> <mml:msup><mml:mi>μ</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>)</mml:mo></mml:mrow></mml:mrow> <mml:mrow><mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mi>n</mml:mi> <mml:mrow><mml:mtext>eff</mml:mtext></mml:mrow> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>i</mml:mi> <mml:mo>-</mml:mo> <mml:mn>1</mml:mn> <mml:mo>)</mml:mo></mml:mrow></mml:msubsup> <mml:mo>,</mml:mo> <mml:msup><mml:mi>μ</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>i</mml:mi> <mml:mo>-</mml:mo> <mml:mn>1</mml:mn> <mml:mo>)</mml:mo></mml:mrow></mml:msup> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:msup><mml:mi mathvariant="bold">z</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>i</mml:mi> <mml:mo>-</mml:mo> <mml:mn>1</mml:mn> <mml:mo>)</mml:mo></mml:mrow></mml:msup> <mml:mo>,</mml:mo> <mml:msup><mml:mi mathvariant="bold-italic">η</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>i</mml:mi> <mml:mo>-</mml:mo> <mml:mn>1</mml:mn> <mml:mo>)</mml:mo></mml:mrow></mml:msup> <mml:mo>,</mml:mo> <mml:mi>D</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>D</mml:mi> <mml:mn>0</mml:mn></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mi>q</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mi>n</mml:mi> <mml:mrow><mml:mtext>eff</mml:mtext></mml:mrow> <mml:mo>*</mml:mo></mml:msubsup> <mml:mo>,</mml:mo> <mml:msup><mml:mi>μ</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>)</mml:mo></mml:mrow> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mi>n</mml:mi> <mml:mrow><mml:mtext>eff</mml:mtext></mml:mrow> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>i</mml:mi> <mml:mo>-</mml:mo> <mml:mn>1</mml:mn> <mml:mo>)</mml:mo></mml:mrow></mml:msubsup> <mml:mo>,</mml:mo> <mml:msup><mml:mi>μ</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>i</mml:mi> <mml:mo>-</mml:mo> <mml:mn>1</mml:mn> <mml:mo>)</mml:mo></mml:mrow></mml:msup> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac> <mml:mo>}</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> using <xref ref-type="disp-formula" rid="pcbi.1006534.e026">Eq 21</xref></p>
<p specific-use="line"> <bold>if</bold> <italic>ρ</italic> &lt; <italic>u</italic> <bold>then</bold></p>
<p specific-use="line">  set <inline-formula id="pcbi.1006534.e044"><alternatives><graphic id="pcbi.1006534.e044g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e044" xlink:type="simple"/><mml:math display="inline" id="M44"><mml:mrow><mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mi>n</mml:mi> <mml:mrow><mml:mtext>eff</mml:mtext></mml:mrow> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>i</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:msubsup> <mml:mo>,</mml:mo> <mml:msup><mml:mi>μ</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>i</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:msup> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>←</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mi>n</mml:mi> <mml:mrow><mml:mtext>eff</mml:mtext></mml:mrow> <mml:mo>*</mml:mo></mml:msubsup> <mml:mo>,</mml:mo> <mml:msup><mml:mi>μ</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula></p>
<p specific-use="line">  sample λ<sup>(<italic>i</italic>)</sup> ∼ <italic>p</italic>(⋅|<italic>μ</italic><sup>(<italic>i</italic>)</sup>, <bold><italic>η</italic></bold><sup>(<italic>i</italic>−1)</sup>, <italic>D</italic>) using <xref ref-type="disp-formula" rid="pcbi.1006534.e027">Eq 22</xref></p>
<p specific-use="line"> <bold>else</bold></p>
<p specific-use="line">  set <inline-formula id="pcbi.1006534.e045"><alternatives><graphic id="pcbi.1006534.e045g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e045" xlink:type="simple"/><mml:math display="inline" id="M45"><mml:mrow><mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mi>n</mml:mi> <mml:mrow><mml:mtext>eff</mml:mtext></mml:mrow> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>i</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:msubsup> <mml:mo>,</mml:mo> <mml:msup><mml:mi>μ</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>i</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:msup> <mml:mo>,</mml:mo> <mml:msup><mml:mo>λ</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>i</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:msup> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>←</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mi>n</mml:mi> <mml:mrow><mml:mtext>eff</mml:mtext></mml:mrow> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>i</mml:mi> <mml:mo>-</mml:mo> <mml:mn>1</mml:mn> <mml:mo>)</mml:mo></mml:mrow></mml:msubsup> <mml:mo>,</mml:mo> <mml:msup><mml:mi>μ</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>i</mml:mi> <mml:mo>-</mml:mo> <mml:mn>1</mml:mn> <mml:mo>)</mml:mo></mml:mrow></mml:msup> <mml:mo>,</mml:mo> <mml:msup><mml:mo>λ</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>i</mml:mi> <mml:mo>-</mml:mo> <mml:mn>1</mml:mn> <mml:mo>)</mml:mo></mml:mrow></mml:msup> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula></p>
<p specific-use="line"> <bold>end if</bold></p>
<p specific-use="line"> <bold>for</bold> <italic>j</italic> = 1, …, <italic>N</italic> <bold>do</bold></p>
<p specific-use="line">  sample <inline-formula id="pcbi.1006534.e046"><alternatives><graphic id="pcbi.1006534.e046g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e046" xlink:type="simple"/><mml:math display="inline" id="M46"><mml:msubsup><mml:mi>η</mml:mi> <mml:mrow><mml:mi>j</mml:mi></mml:mrow> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>i</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:msubsup></mml:math></alternatives></inline-formula> using the Algorithm 2 with <italic>μ</italic> = <italic>μ</italic><sup>(<italic>i</italic>)</sup>, <bold>z</bold> = <bold>z</bold><sup>(<italic>i</italic>−1)</sup>, λ = λ<sup>(<italic>i</italic>)</sup></p>
<p specific-use="line"> <bold>end for</bold></p>
<p specific-use="line"> <bold>for</bold> <italic>j</italic> = 1, …, <italic>N</italic> <bold>do</bold></p>
<p specific-use="line">  sample <inline-formula id="pcbi.1006534.e047"><alternatives><graphic id="pcbi.1006534.e047g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e047" xlink:type="simple"/><mml:math display="inline" id="M47"><mml:mrow><mml:msubsup><mml:mi mathvariant="bold">z</mml:mi> <mml:mi>j</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>i</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:msubsup> <mml:mo>∼</mml:mo> <mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mo>·</mml:mo> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:msubsup><mml:mi>n</mml:mi> <mml:mrow><mml:mtext>eff</mml:mtext></mml:mrow> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>i</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:msubsup> <mml:mo>,</mml:mo> <mml:msup><mml:mi>μ</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>i</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:msup> <mml:mo>,</mml:mo> <mml:msup><mml:mi mathvariant="bold-italic">ω</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>i</mml:mi> <mml:mo>-</mml:mo> <mml:mn>1</mml:mn> <mml:mo>)</mml:mo></mml:mrow></mml:msup> <mml:mo>,</mml:mo> <mml:msup><mml:mi mathvariant="bold-italic">η</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>i</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:msup> <mml:mo>,</mml:mo> <mml:mi>D</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> using <xref ref-type="disp-formula" rid="pcbi.1006534.e023">Eq 18</xref></p>
<p specific-use="line"> <bold>end for</bold></p>
<p specific-use="line"> sample <bold><italic>ω</italic></bold><sup>(<italic>i</italic>)</sup> ∼ <italic>p</italic>(⋅|<bold>z</bold><sup>(<italic>i</italic>)</sup>, <italic>D</italic>) using <xref ref-type="disp-formula" rid="pcbi.1006534.e020">Eq 17</xref></p>
<p specific-use="line"><bold>end for</bold></p>
<p specific-use="line"><bold>return</bold> samples <inline-formula id="pcbi.1006534.e048"><alternatives><graphic id="pcbi.1006534.e048g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e048" xlink:type="simple"/><mml:math display="inline" id="M48"><mml:msubsup><mml:mrow><mml:mo>{</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mi>n</mml:mi> <mml:mrow><mml:mtext>eff</mml:mtext></mml:mrow> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>i</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:msubsup> <mml:mo>,</mml:mo> <mml:msup><mml:mi>μ</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>i</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:msup> <mml:mo>,</mml:mo> <mml:msup><mml:mi mathvariant="bold-italic">ω</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>i</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:msup> <mml:mo>,</mml:mo> <mml:msup><mml:mi mathvariant="bold">z</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>i</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:msup> <mml:mo>,</mml:mo> <mml:msup><mml:mi mathvariant="bold-italic">η</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>i</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:msup> <mml:mo>,</mml:mo> <mml:msup><mml:mo>λ</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>i</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:msup> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>}</mml:mo></mml:mrow> <mml:mrow><mml:mi>i</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:mi>s</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula></p>
</sec>
<sec id="sec011">
<title>Posterior distribution for future data</title>
<p>Given a new (future) data point (<italic>d</italic>*, <italic>t</italic>*) from a new patient, we would like to compute the probability of whether this case is of the same strain. This can be computed from the posterior of the model fitted to data <italic>D</italic>, <italic>D</italic><sub>0</sub> as follows. We denote the original parameter vector with <italic><bold>θ</bold></italic> as before and additional parameters related to the new data point <italic>D</italic>* = {(<italic>d</italic>*, <italic>t</italic>*)} as <bold>z</bold>* ∈ {(1, 0), (0, 1)} and <inline-formula id="pcbi.1006534.e049"><alternatives><graphic id="pcbi.1006534.e049g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e049" xlink:type="simple"/><mml:math display="inline" id="M49"><mml:mrow><mml:msubsup><mml:mi>t</mml:mi> <mml:mn>0</mml:mn> <mml:mo>*</mml:mo></mml:msubsup> <mml:mo>&gt;</mml:mo> <mml:mn>0</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>. The updated posterior after considering the new data point <italic>D</italic>* is then
<disp-formula id="pcbi.1006534.e050"><alternatives><graphic id="pcbi.1006534.e050g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e050" xlink:type="simple"/><mml:math display="block" id="M50"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>p</mml:mi> <mml:mo>(</mml:mo> <mml:msup><mml:mi mathvariant="bold">z</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>,</mml:mo> <mml:msubsup><mml:mi>t</mml:mi> <mml:mn>0</mml:mn> <mml:mo>*</mml:mo></mml:msubsup> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">θ</mml:mi> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:msup><mml:mi>D</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>,</mml:mo> <mml:mi>D</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>D</mml:mi> <mml:mn>0</mml:mn></mml:msub> <mml:mo>)</mml:mo></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mo>∝</mml:mo> <mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msup><mml:mi mathvariant="bold">z</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>,</mml:mo> <mml:msubsup><mml:mi>t</mml:mi> <mml:mn>0</mml:mn> <mml:mo>*</mml:mo></mml:msubsup> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">θ</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msup><mml:mi>D</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>,</mml:mo> <mml:mi>D</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>D</mml:mi> <mml:mn>0</mml:mn></mml:msub> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mi mathvariant="bold-italic">θ</mml:mi> <mml:mo>,</mml:mo> <mml:msup><mml:mi mathvariant="bold">z</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>,</mml:mo> <mml:msubsup><mml:mi>t</mml:mi> <mml:mn>0</mml:mn> <mml:mo>*</mml:mo></mml:msubsup> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(27)</label></disp-formula> <disp-formula id="pcbi.1006534.e051"><alternatives><graphic id="pcbi.1006534.e051g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e051" xlink:type="simple"/><mml:math display="block" id="M51"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:mo>=</mml:mo> <mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi mathvariant="bold-italic">θ</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msup><mml:mi mathvariant="bold">z</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>,</mml:mo> <mml:msubsup><mml:mi>t</mml:mi> <mml:mn>0</mml:mn> <mml:mo>*</mml:mo></mml:msubsup> <mml:mo>,</mml:mo> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mi mathvariant="bold-italic">θ</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>D</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>D</mml:mi> <mml:mn>0</mml:mn></mml:msub> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mi mathvariant="bold-italic">θ</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msup><mml:mi>d</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:msup><mml:mi>t</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>,</mml:mo> <mml:msup><mml:mi mathvariant="bold">z</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>,</mml:mo> <mml:msubsup><mml:mi>t</mml:mi> <mml:mn>0</mml:mn> <mml:mo>*</mml:mo></mml:msubsup> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">θ</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(28)</label></disp-formula> <disp-formula id="pcbi.1006534.e052"><alternatives><graphic id="pcbi.1006534.e052g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e052" xlink:type="simple"/><mml:math display="block" id="M52"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:mo>∝</mml:mo> <mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msup><mml:mi>d</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:msup><mml:mi>t</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>,</mml:mo> <mml:msup><mml:mi mathvariant="bold">z</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>,</mml:mo> <mml:msubsup><mml:mi>t</mml:mi> <mml:mn>0</mml:mn> <mml:mo>*</mml:mo></mml:msubsup> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">θ</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msup><mml:mi mathvariant="bold">z</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>,</mml:mo> <mml:msubsup><mml:mi>t</mml:mi> <mml:mn>0</mml:mn> <mml:mo>*</mml:mo></mml:msubsup> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mi mathvariant="bold-italic">θ</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi mathvariant="bold-italic">θ</mml:mi> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mi>D</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>D</mml:mi> <mml:mn>0</mml:mn></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(29)</label></disp-formula>
where <italic>p</italic>(<italic><bold>θ</bold></italic>|<italic>D</italic>, <italic>D</italic><sub>0</sub>) is the posterior based on our original data <italic>D</italic>, <italic>D</italic><sub>0</sub>. We marginalise the set of parameters least contributory to the aim to obtain
<disp-formula id="pcbi.1006534.e053"><alternatives><graphic id="pcbi.1006534.e053g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e053" xlink:type="simple"/><mml:math display="block" id="M53"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msup><mml:mi mathvariant="bold">z</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:msup><mml:mi>D</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>,</mml:mo> <mml:mi>D</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>D</mml:mi> <mml:mn>0</mml:mn></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>∝</mml:mo> <mml:msub><mml:mo>∫</mml:mo> <mml:mi mathvariant="bold-italic">θ</mml:mi></mml:msub> <mml:msub><mml:mo>∫</mml:mo> <mml:msubsup><mml:mi>t</mml:mi> <mml:mn>0</mml:mn> <mml:mo>*</mml:mo></mml:msubsup></mml:msub> <mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msup><mml:mi>d</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:msup><mml:mi>t</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>,</mml:mo> <mml:msup><mml:mi mathvariant="bold">z</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>,</mml:mo> <mml:msubsup><mml:mi>t</mml:mi> <mml:mn>0</mml:mn> <mml:mo>*</mml:mo></mml:msubsup> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">θ</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mi>t</mml:mi> <mml:mn>0</mml:mn> <mml:mo>*</mml:mo></mml:msubsup> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mo>λ</mml:mo> <mml:mo>)</mml:mo></mml:mrow> <mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msup><mml:mi mathvariant="bold">z</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mi mathvariant="bold-italic">ω</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi mathvariant="bold-italic">θ</mml:mi> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mi>D</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>D</mml:mi> <mml:mn>0</mml:mn></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mi mathvariant="normal">d</mml:mi> <mml:msubsup><mml:mi>t</mml:mi> <mml:mn>0</mml:mn> <mml:mo>*</mml:mo></mml:msubsup> <mml:mi mathvariant="normal">d</mml:mi> <mml:mi mathvariant="bold-italic">θ</mml:mi></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(30)</label></disp-formula> <disp-formula id="pcbi.1006534.e054"><alternatives><graphic id="pcbi.1006534.e054g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e054" xlink:type="simple"/><mml:math display="block" id="M54"><mml:mrow><mml:mo>≈</mml:mo> <mml:mfrac><mml:mn>1</mml:mn> <mml:mi>s</mml:mi></mml:mfrac> <mml:mstyle displaystyle="true"><mml:munderover><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>i</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:mi>s</mml:mi></mml:munderover> <mml:mrow><mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:msubsup><mml:mi>ω</mml:mi> <mml:mi>S</mml:mi> <mml:mrow><mml:mo stretchy="false">(</mml:mo> <mml:mi>i</mml:mi> <mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup> <mml:msub><mml:mi>p</mml:mi> <mml:mi>S</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:msup><mml:mi>d</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>|</mml:mo> <mml:msubsup><mml:mi>n</mml:mi> <mml:mrow><mml:mtext>eff</mml:mtext></mml:mrow> <mml:mrow><mml:mo stretchy="false">(</mml:mo> <mml:mi>i</mml:mi> <mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup> <mml:mo>,</mml:mo> <mml:msup><mml:mi>μ</mml:mi> <mml:mrow><mml:mo stretchy="false">(</mml:mo> <mml:mi>i</mml:mi> <mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup> <mml:mo>,</mml:mo> <mml:msup><mml:mi>t</mml:mi> <mml:mo>*</mml:mo></mml:msup></mml:mrow> <mml:mo>)</mml:mo></mml:mrow></mml:mrow> <mml:mo>)</mml:mo></mml:mrow></mml:mrow> <mml:mrow><mml:msubsup><mml:mi>z</mml:mi> <mml:mn>1</mml:mn> <mml:mo>*</mml:mo></mml:msubsup></mml:mrow></mml:msup></mml:mrow></mml:mstyle> <mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:msubsup><mml:mi>ω</mml:mi> <mml:mi>D</mml:mi> <mml:mrow><mml:mo stretchy="false">(</mml:mo> <mml:mi>i</mml:mi> <mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msubsup> <mml:msub><mml:mi>p</mml:mi> <mml:mi>D</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:msup><mml:mi>d</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>|</mml:mo> <mml:msup><mml:mi>μ</mml:mi> <mml:mrow><mml:mo stretchy="false">(</mml:mo> <mml:mi>i</mml:mi> <mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup> <mml:mo>,</mml:mo> <mml:msubsup><mml:mi>t</mml:mi> <mml:mn>0</mml:mn> <mml:mrow><mml:msup><mml:mo>*</mml:mo> <mml:mrow><mml:mo stretchy="false">(</mml:mo> <mml:mi>i</mml:mi> <mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:msubsup> <mml:mo>,</mml:mo> <mml:msup><mml:mi>t</mml:mi> <mml:mo>*</mml:mo></mml:msup></mml:mrow> <mml:mo>)</mml:mo></mml:mrow></mml:mrow> <mml:mo>)</mml:mo></mml:mrow></mml:mrow> <mml:mrow><mml:msubsup><mml:mi>z</mml:mi> <mml:mn>2</mml:mn> <mml:mo>*</mml:mo></mml:msubsup></mml:mrow></mml:msup> <mml:mo>,</mml:mo></mml:mrow></mml:math></alternatives> <label>(31)</label></disp-formula>
where <inline-formula id="pcbi.1006534.e055"><alternatives><graphic id="pcbi.1006534.e055g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e055" xlink:type="simple"/><mml:math display="inline" id="M55"><mml:mrow><mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mi>t</mml:mi> <mml:mn>0</mml:mn> <mml:msup><mml:mo>*</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>i</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:msup></mml:msubsup> <mml:mo>,</mml:mo> <mml:msup><mml:mi mathvariant="bold-italic">θ</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>i</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:msup> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>∼</mml:mo> <mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mi>t</mml:mi> <mml:mn>0</mml:mn> <mml:mo>*</mml:mo></mml:msubsup> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mo>λ</mml:mo> <mml:mo>)</mml:mo></mml:mrow> <mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi mathvariant="bold-italic">θ</mml:mi> <mml:mspace width="0.166667em"/><mml:mo>|</mml:mo> <mml:mspace width="0.166667em"/><mml:mi>D</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>D</mml:mi> <mml:mn>0</mml:mn></mml:msub> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> for <italic>i</italic> = 1, …, <italic>s</italic>. The probability of the new measurement point (<italic>d</italic>*, <italic>t</italic>*) being of the same strain, based on the previously observed data <italic>D</italic>, <italic>D</italic><sub>0</sub> is obtained from <xref ref-type="disp-formula" rid="pcbi.1006534.e054">Eq 31</xref>.</p>
</sec>
</sec>
<sec id="sec012" sec-type="results">
<title>Results</title>
<p>In this section we fit the W-F model to the external data <italic>D</italic><sub>0</sub> as discussed in Section ABC inference to update the prior using external data. We then verify that the proposed Gibbs sampling algorithm for fitting the mixture model from Section Bayesian inference for the mixture model is consistent based on experiments with simulated data. Subsequently, we fit the mixture model to the MRSA data and discuss the results. Finally, we assess the quality of the model fit.</p>
<sec id="sec013">
<title>Updating the prior using ABC inference</title>
<p>The ABC posterior based on the external data <italic>D</italic><sub>0</sub> and the discrepancy in <xref ref-type="disp-formula" rid="pcbi.1006534.e009">Eq 8</xref>, is shown in <xref ref-type="fig" rid="pcbi.1006534.g005">Fig 5A</xref>. We also repeated the computations so that we omitted a subset, patients A-M, from the analysis i.e. the second summation term in <xref ref-type="disp-formula" rid="pcbi.1006534.e009">Eq 8</xref> was set to zero. This was done to assess the effect of patients A-M, which have measurements from one time point only, and an unknown time since acquisition. This extra analysis resulted in an ABC posterior approximation shown in <xref ref-type="fig" rid="pcbi.1006534.g005">Fig 5B</xref>. We see that in both cases large parts of the parameter space have been ruled out as having negligible posterior probability. As expected, the posterior distribution based on the subset (<xref ref-type="fig" rid="pcbi.1006534.g005">Fig 5B</xref>) is slightly more dispersed than with the full data <italic>D</italic><sub>0</sub> (<xref ref-type="fig" rid="pcbi.1006534.g005">Fig 5A</xref>). Using the full data causes the estimated mutation rate to be slightly greater than with the subset, likely because the model needs to accommodate the higher variability in the patients A-M. In addition, small effective sample sizes (<italic>n</italic><sub>eff</sub> &lt; 2000) are less probable based on the full data <italic>D</italic><sub>0</sub>.</p>
<fig id="pcbi.1006534.g005" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1006534.g005</object-id>
<label>Fig 5</label>
<caption>
<title>ABC posterior distribution for (<italic>n</italic><sub>eff</sub>, <italic>μ</italic>).</title>
<p>The ABC posterior distribution i.e. the updated prior for parameters (<italic>n</italic><sub>eff</sub>, <italic>μ</italic>), the effective population size and mutation rate, given data <italic>D</italic><sub>0</sub>. Panel A shows the result with the full data and panel B the corresponding result with only a subset of the data (see text for details).</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1006534.g005" xlink:type="simple"/>
</fig>
<p>Overall, we see that the effective sample size <italic>n</italic><sub>eff</sub> cannot be well identified based on the external data <italic>D</italic><sub>0</sub> alone. We also see that if the upper bound of the prior density of <italic>n</italic><sub>eff</sub> was increased from 10, 000, higher values would likely have non-negligible posterior probability also; however, this constraint will have a negligible impact on the resulting posterior from the mixture model as is seen later. The mutation rate <italic>μ</italic>, on the other hand, is smaller than 0.001 mutations per genome per generation with high probability and cannot be arbitrarily small.</p>
</sec>
<sec id="sec014">
<title>Validation of the mixture model using simulated data</title>
<p>To empirically investigate the identifiability of the mixture model parameters and the correctness and consistency of our MCMC algorithm under the assumption that the model is specified correctly, we first fit the mixture model to simulated data. We generate artificial data from the mixture model with parameter values similar to the estimates for the observed data <italic>D</italic> from the next section. Specifically, we choose <italic>n</italic><sub>eff</sub> = 2, 137, <italic>μ</italic> = 0.0011, <italic>ω</italic><sub><italic>S</italic></sub> = 0.8, λ = 0.0001 and we repeat the analysis with various data sizes <italic>N</italic>. We use otherwise similar priors as for the real data in the next section except that, for simplicity, instead of using the prior obtained from the ABC inference, we use a uniform prior in <xref ref-type="disp-formula" rid="pcbi.1006534.e008">Eq 7</xref>. We then fit the mixture model to the simulated data sets to investigate if the true parameters can be recovered (identifiability) and whether the posterior becomes concentrated around their true values when the amount of data increases (consistency).</p>
<p>Results are illustrated in <xref ref-type="fig" rid="pcbi.1006534.g006">Fig 6</xref>. We see that the (marginal) posterior of (<italic>n</italic><sub>eff</sub>, <italic>μ</italic>) is concentrated around the true parameter value that was used to generate the data (green diamond in the figure). Also, despite the fact that the number of parameters increases as a function of data size <italic>N</italic> (because each data point (<italic>d</italic><sub><italic>i</italic></sub>, <italic>t</italic><sub><italic>i</italic></sub>) has its own class indicator <bold>z</bold><sub><italic>i</italic></sub> and time to the most recent common ancestor <italic>t</italic><sub>0<italic>i</italic></sub> parameter), the marginal posterior distribution of (<italic>n</italic><sub>eff</sub>, <italic>μ</italic>) can be identified and appears to converge to the true value as <italic>N</italic> increases. We cannot learn each <italic>t</italic><sub>0<italic>i</italic></sub> accurately since essentially only the data point to which the parameter corresponds provides information about its value. However, precise estimates of these nuisance parameters are not needed for using the model or obtaining useful estimates of the other unknown parameters as demonstrated in <xref ref-type="fig" rid="pcbi.1006534.g006">Fig 6</xref>.</p>
<fig id="pcbi.1006534.g006" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1006534.g006</object-id>
<label>Fig 6</label>
<caption>
<title>Accuracy and consistency with synthetic data.</title>
<p>The first three panels show the estimated posterior distributions for parameters (<italic>n</italic><sub>eff</sub>, <italic>μ</italic>) of the mixture model using simulated data of different sizes <italic>N</italic>. The green diamond shows the true value used to generate the simulated data and the light grey dots denote the grid point locations needed for numerical computations. The bottom right panel shows the estimated vs. the true <italic>ω</italic><sub><italic>S</italic></sub> parameter in a set of additional simulation experiments.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1006534.g006" xlink:type="simple"/>
</fig>
<p>The panel in the lower right corner of <xref ref-type="fig" rid="pcbi.1006534.g006">Fig 6</xref> shows results from an additional simulation experiment where the mixture model is fitted to data generated with different values for the <italic>ω</italic><sub><italic>S</italic></sub> parameter, which represents the proportion of pairs that are from the same strain. Other than that and the fact that we fixed <italic>N</italic> = 150, the experimental design is the same as above. The results show that the estimated <italic>ω</italic><sub><italic>S</italic></sub> values generally agree well with the true values. Interestingly, <italic>ω</italic><sub><italic>S</italic></sub> is slightly overestimated when its true value is close to 0, and slightly underestimated when the true value is close to 1, which may reflect the regularizing effect of the prior, drawing the estimates away from the extreme values. Furthermore, when the true value of <italic>ω</italic><sub><italic>S</italic></sub> is around 0.5, the variance of the estimate tends to be higher than with <italic>ω</italic><sub><italic>S</italic></sub> values close to 0 or 1. This observation may be explained by the fact that there are more data points that overlap both mixture model components when <italic>ω</italic><sub><italic>S</italic></sub> is around 0.5 which makes the inference task more challenging and causes higher posterior variance.</p>
</sec>
<sec id="sec015">
<title>Analysis of the Project CLEAR MRSA data</title>
<p>The following settings are used to analyse longitudinally-sampled <italic>S. aureus</italic> nares isolates from the control arm of Project CLEAR [<xref ref-type="bibr" rid="pcbi.1006534.ref024">24</xref>]. We generate 4 MCMC chains, each of length 25, 000, initialized randomly from the prior density, whose first halves are discarded as “burn-in”. We use the Gelman and Rubin’s convergence diagnostic in R-package <monospace>coda</monospace> and visual checks to assess the convergence of the MCMC algorithm. We use 100 × 100 equidistant grid for numerical computation with the (<italic>n</italic><sub>eff</sub>, <italic>μ</italic>) values and <italic>s</italic> = 10, 000 in <xref ref-type="disp-formula" rid="pcbi.1006534.e031">Eq 24</xref>. The ABC posterior obtained in Section Updating the prior using ABC inference. and visualised in <xref ref-type="fig" rid="pcbi.1006534.g005">Fig 5A</xref> is used as the prior for (<italic>n</italic><sub>eff</sub>, <italic>μ</italic>).</p>
<p>The parameter vector <italic><bold>θ</bold></italic> consists of the ‘global’ parameters <italic>n</italic><sub>eff</sub>, <italic>μ</italic>, <italic><bold>ω</bold></italic>, λ, as well as a large number of nuisance parameters (<bold>z</bold> and <bold>t</bold><sub>0</sub>) related to each data point. The estimated global parameters are presented in <xref ref-type="table" rid="pcbi.1006534.t001">Table 1</xref>. We also repeated the analysis using a uniform prior on (<italic>n</italic><sub>eff</sub>, <italic>μ</italic>). While the uniform prior is non-informative about the parameters (<italic>n</italic><sub>eff</sub>, <italic>μ</italic>), the results are nevertheless surprisingly similar (<xref ref-type="table" rid="pcbi.1006534.t001">Table 1</xref>). In other words, the additional data <italic>D</italic><sub>0</sub> used to update the prior has only a small effect on the estimated parameters of the mixture model. This was unexpected because the data set <italic>D</italic> used to train the mixture model has only one genome per sampled time point, and yet, impressively, the model is able to learn about the parameters (<italic>n</italic><sub>eff</sub>, <italic>μ</italic>) which effectively define the variability in the whole population. This further demonstrates the robustness of the mixture model to the prior used. We observe, however, that incorporating the prior from the ABC slightly shifts the probability distribution for <italic>n</italic><sub>eff</sub> towards larger values, although the difference is small. For example, as seen in <xref ref-type="table" rid="pcbi.1006534.t001">Table 1</xref>, the 95% credible interval (CI) for <italic>n</italic><sub>eff</sub>, [1100, 1900], gets updated to [1100, 2000] when the extra prior information is included.</p>
<table-wrap id="pcbi.1006534.t001" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1006534.t001</object-id>
<label>Table 1</label>
<caption>
<title>Posterior mean and 95% credible interval (CI) for the ‘global’ parameters of the mixture model.</title>
</caption>
<alternatives>
<graphic id="pcbi.1006534.t001g" mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1006534.t001" xlink:type="simple"/>
<table border="0" frame="box" rules="all">
<colgroup>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
</colgroup>
<thead>
<tr>
<th align="left"/>
<th align="center" colspan="2">Informative prior (ABC, data <italic>D</italic><sub>0</sub>)</th>
<th align="center" colspan="2">Uniform prior</th>
</tr>
<tr>
<th align="left">parameter</th>
<th align="left">mean</th>
<th align="left">95% CI</th>
<th align="left">mean</th>
<th align="left">95% CI</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><italic>n</italic><sub>eff</sub></td>
<td align="left">1400</td>
<td align="left">[1100, 2000]</td>
<td align="left">1400</td>
<td align="left">[1100, 1900]</td>
</tr>
<tr>
<td align="left"><italic>μ</italic></td>
<td align="left">0.00071</td>
<td align="left">[0.00058, 0.00082]</td>
<td align="left">0.00073</td>
<td align="left">[0.00060, 0.00084]</td>
</tr>
<tr>
<td align="left"><italic>ω</italic><sub><italic>S</italic></sub></td>
<td align="left">0.85</td>
<td align="left">[0.81, 0.89]</td>
<td align="left">0.85</td>
<td align="left">[0.81, 0.89]</td>
</tr>
<tr>
<td align="left"><italic>ω</italic><sub><italic>D</italic></sub></td>
<td align="left">0.15</td>
<td align="left">[0.11, 0.19]</td>
<td align="left">0.15</td>
<td align="left">[0.11, 0.19]</td>
</tr>
<tr>
<td align="left">λ (× 10<sup>5</sup>)</td>
<td align="left">3.7</td>
<td align="left">[2.9, 4.4]</td>
<td align="left">3.8</td>
<td align="left">[3.0, 4.5]</td>
</tr>
</tbody>
</table>
</alternatives>
</table-wrap>
<p>
<xref ref-type="fig" rid="pcbi.1006534.g007">Fig 7</xref> shows the posterior predictive distribution for the probability of the same strain case for a (hypothetical future) observation with distance <italic>d</italic>* and time difference <italic>t</italic>*. Blue colour in the figure denotes high probability of the same strain. The corresponding 50% classification curve is (almost) a straight line with a steep positive slope. This is as expected since the same strain model can explain a greater number of mutations when more time has passed. Approximately 20 mutations draws the line between the same strain and different strains cases within the time difference up to 6000 generations. The uncertainty in the classification occurs because there is overlap in the two explanations (around <italic>d</italic>* ≈ 20) and because of the posterior uncertainty in the model parameters <italic><bold>θ</bold></italic>.</p>
<fig id="pcbi.1006534.g007" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1006534.g007</object-id>
<label>Fig 7</label>
<caption>
<title>Results for the Project CLEAR MRSA data.</title>
<p>Contour plot for same strain probability of a distance <italic>d</italic>* and time interval <italic>t</italic>* based on the fitted model. The coloured points denote the observations that were used to fit the model. Blue colour indicates large same strain probability. Distances greater than 50 are not shown and are classified as different strains with probability one. 6, 000 generations on the y-axis correspond to approximately one year.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1006534.g007" xlink:type="simple"/>
</fig>
<p>We also analysed explicitly all observed patterns where: 1) two genomes of the same ST from the same patient are interleaved with a missing observation, i.e. the colonization appears to disappear and then re-emerge, and 2) two genomes of the same ST from the same patient are interleaved with an observation of a different ST. The numbers for the two genomes being from the same or different strain in these patterns are shown in <xref ref-type="table" rid="pcbi.1006534.t002">Table 2</xref>. The credible intervals for the ‘same strain’ proportion combine uncertainty from the limited number of samples with the posterior uncertainty of whether a sample is from the same strain or not (see the Supplementary material for further details). From <xref ref-type="table" rid="pcbi.1006534.t002">Table 2</xref> we see that approximately 69% of genome pairs in pattern 1) are from the same strain. This is only a little smaller than the same strain proportion when there are no missing observations in between (89%). Therefore, a plausible explanation for most of the missing in-between observations is that in reality the same strain has been colonizing the patient throughout, and the missing observation reflects the limited sensitivity of the sampling, rather than a clearance followed by a novel acquisition. Similarly, even if interleaved with a different ST (pattern 2), the surrounding genomes often, in 65% of cases, appear to be from the same strain. This suggests that in these cases the patient has been colonized by the surrounding strain throughout, and co-colonized by two different STs at the time of observing the divergent ST in the middle.</p>
<table-wrap id="pcbi.1006534.t002" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1006534.t002</object-id>
<label>Table 2</label>
<caption>
<title>The estimated numbers (mean, 95% CI in parenthesis) of cases with genomes in the beginning and in the end of the pattern being from the same or different strain, for three different patterns in the Project CLEAR MRSA data, and the estimated proportion of the same strain cases.</title>
</caption>
<alternatives>
<graphic id="pcbi.1006534.t002g" mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1006534.t002" xlink:type="simple"/>
<table border="0" frame="box" rules="all">
<colgroup>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
</colgroup>
<thead>
<tr>
<th align="left"/>
<th align="left">same strain/n</th>
<th align="left">diff. strain/n</th>
<th align="left">same strain prop.</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">STA → STA</td>
<td align="left">199(199, 200)/224</td>
<td align="left">24(24, 25)/224</td>
<td align="left">0.89(0.84, 0.92)</td>
</tr>
<tr>
<td align="left">STA → ∅ → … → STA</td>
<td align="left">20(20, 21)/29</td>
<td align="left">9(8, 9)/29</td>
<td align="left">0.69(0.49, 0.84)</td>
</tr>
<tr>
<td align="left">STA → STB → … → STA</td>
<td align="left">12(12, 12)/18</td>
<td align="left">6(6, 6)/18</td>
<td align="left">0.65(0.41, 0.83)</td>
</tr>
</tbody>
</table>
</alternatives>
<table-wrap-foot>
<fn id="t002fn001">
<p>“STA → STA” denotes the case where the ST does not change between two genomes at consecutive samples, “STA → ∅ → … → STA” is the pattern 1) where one or more negative samples are seen between the same ST and “STA → STB → … → STA” is the pattern 2) where a sample with different ST is observed between two samples of the same ST. <italic>n</italic> denotes the number of data points in each alternative.</p>
</fn>
</table-wrap-foot>
</table-wrap>
<p>Finally, we compute acquisition and clearance rates using our model, and compare those to the ones obtained with the common strategy of using a fixed distance threshold. For the purposes of this exposition, we define the acquisition <italic>r</italic><sub>acq</sub> and clearance rates <italic>r</italic><sub>clear</sub> informally as
<disp-formula id="pcbi.1006534.e056"><alternatives><graphic id="pcbi.1006534.e056g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e056" xlink:type="simple"/><mml:math display="block" id="M56"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>r</mml:mi> <mml:mtext>acq</mml:mtext></mml:msub> <mml:mo>=</mml:mo> <mml:mfrac><mml:mrow><mml:mi>B</mml:mi> <mml:mo>+</mml:mo> <mml:mi>C</mml:mi> <mml:mo>+</mml:mo> <mml:mi>E</mml:mi></mml:mrow> <mml:mi>G</mml:mi></mml:mfrac> <mml:mo>,</mml:mo> <mml:mspace width="1.em"/><mml:msub><mml:mi>r</mml:mi> <mml:mtext>clear</mml:mtext></mml:msub> <mml:mo>=</mml:mo> <mml:mfrac><mml:mi>D</mml:mi> <mml:mrow><mml:mi>A</mml:mi> <mml:mo>+</mml:mo> <mml:mi>B</mml:mi> <mml:mo>+</mml:mo> <mml:mi>C</mml:mi> <mml:mo>+</mml:mo> <mml:mi>D</mml:mi></mml:mrow></mml:mfrac> <mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(32)</label></disp-formula>
where the quantities <italic>A</italic>, <italic>B</italic>, <italic>C</italic>, <italic>D</italic> and <italic>E</italic> denote the numbers of possible events in consecutive samples (e.g. acquisition, replacement, clearance, or no change) defined in detail in <xref ref-type="table" rid="pcbi.1006534.t003">Table 3</xref>. Also, <italic>G</italic> is the total number of possible events over the whole data. The quantities <italic>A</italic>, <italic>B</italic>, <italic>D</italic> and <italic>E</italic> are random variables that depend on the same/different strain posterior probabilities and, consequently, we also compute the uncertainty estimates for these quantities in <xref ref-type="disp-formula" rid="pcbi.1006534.e056">Eq 32</xref>. Number C is a constant because an observed change of ST always indicates an actual change of ST as well. For cases with one or more negative samples (denoted by ∅) between two positive samples, we do not know when the clearance and acquisition events took place and whether the negative samples are “false negatives”. To handle these cases, we parsimoniously assume that a missing observation between two positive samples that are inferred to come from the same strain is a false negative (i.e. that the same strain was present also in the middle, even if it was not detected), and record these events in the groups A-E accordingly. Details on how we unambiguously determine the group for all special cases is provided in the Supplementary material.</p>
<table-wrap id="pcbi.1006534.t003" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1006534.t003</object-id>
<label>Table 3</label>
<caption>
<title>Estimated numbers (posterior means) of different patterns A-E of consecutive samples and the estimated acquisition and clearance rates (mean, 95% CI in parenthesis).</title>
</caption>
<alternatives>
<graphic id="pcbi.1006534.t003g" mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1006534.t003" xlink:type="simple"/>
<table border="0" frame="box" rules="all">
<colgroup>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
</colgroup>
<tbody>
<tr>
<td align="left">event</td>
<td align="left" colspan="2">expected number</td>
</tr>
<tr>
<td align="left">A: STA, strX → STA, strX</td>
<td align="left" colspan="2">250</td>
</tr>
<tr>
<td align="left">B: STA, strX → STA, strY</td>
<td align="left" colspan="2">24</td>
</tr>
<tr>
<td align="left">C: STA → STB</td>
<td align="left" colspan="2">45</td>
</tr>
<tr>
<td align="left">D: STA, strX → ∅</td>
<td align="left" colspan="2">100</td>
</tr>
<tr>
<td align="left">E: ∅ → STA, strX</td>
<td align="left" colspan="2">17</td>
</tr>
<tr>
<td align="left">rate parameter</td>
<td align="left">post. estimate</td>
<td align="left">threshold-based estimate</td>
</tr>
<tr>
<td align="left">acquisition rate <italic>r</italic><sub>acq</sub></td>
<td align="left">0.16(0.15, 0.16)</td>
<td align="left">0.15</td>
</tr>
<tr>
<td align="left">clearance rate <italic>r</italic><sub>clear</sub></td>
<td align="left">0.24(0.24, 0.24)</td>
<td align="left">0.23</td>
</tr>
</tbody>
</table>
</alternatives>
<table-wrap-foot>
<fn id="t003fn001">
<p>Above, ST denotes sequence type as before, str denotes the strain and symbol ∅ denotes a negative sample i.e. no bacteria detected.</p>
</fn>
</table-wrap-foot>
</table-wrap>
<p>The estimated acquisition and clearance rates with 95% credible intervals are shown on the last two lines of <xref ref-type="table" rid="pcbi.1006534.t003">Table 3</xref>. For comparison, we also computed these rates otherwise similarly but using a fixed distance threshold of 40 mutations, a value used in [<xref ref-type="bibr" rid="pcbi.1006534.ref010">10</xref>], to determine if two genomes are from the same strain or not. We see that the threshold-based estimates are relatively similar to, and only slightly smaller than the estimates from our model. The explanation for the similarity of summaries such as the acquisition and deletion rates is that, when estimating these quantities across the whole data set, the uncertainty gets averaged out, even if some individual data points exhibit a lot of uncertainty regarding whether they are the same strain or not (see <xref ref-type="fig" rid="pcbi.1006534.g007">Fig 7</xref>). Importantly, while being consistent with the previous results, our model bypasses the task of heuristically choosing a single threshold and adds uncertainty estimates around the point estimates, crucial for drawing rigorous conclusions.</p>
</sec>
<sec id="sec016">
<title>Assessing the goodness-of-fit of the model for the Project CLEAR MRSA data</title>
<p>As the last part of our analysis, we use posterior predictive checks to assess the quality of the model, see e.g. [<xref ref-type="bibr" rid="pcbi.1006534.ref016">16</xref>] for further details. Briefly, this consists of simulating replicated data sets <italic>D</italic><sup>rep,(<italic>j</italic>)</sup> from the fitted mixture model and comparing these to the observed data <italic>D</italic> for any systematic deviations. Any discrepancies between the observed and simulated data can be used to criticise the model and understand how the model could be improved. In practice, simulating replicate data is done by simulating a parameter vector <italic><bold>θ</bold></italic><sup>(<italic>j</italic>)</sup> from the posterior (by using the existing MCMC chain) and simulating a new set of distance-time difference pairs <inline-formula id="pcbi.1006534.e057"><alternatives><graphic id="pcbi.1006534.e057g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006534.e057" xlink:type="simple"/><mml:math display="inline" id="M57"><mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mover accent="true"><mml:mi>d</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>i</mml:mi></mml:mrow> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>j</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:msubsup> <mml:mo>,</mml:mo> <mml:msubsup><mml:mover accent="true"><mml:mi>t</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>i</mml:mi></mml:mrow> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>j</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:msubsup> <mml:mo>)</mml:mo> <mml:mo>,</mml:mo> <mml:mi>i</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn> <mml:mo>,</mml:mo> <mml:mo>…</mml:mo> <mml:mo>,</mml:mo> <mml:mi>N</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> in <italic>D</italic><sup>rep,(<italic>j</italic>)</sup> from the model using <italic><bold>θ</bold></italic><sup>(<italic>j</italic>)</sup>. To obtain <italic>M</italic> replicates this procedure is repeated for <italic>j</italic> = 1, …, <italic>M</italic>.</p>
<p>Example replicate data sets are shown in <xref ref-type="fig" rid="pcbi.1006534.g008">Fig 8</xref>. Overall, the simulated distances are similar to the corresponding observations. Small distances are most frequent, and the frequency decreases with increasing distance. Occasional large distances (<italic>d</italic><sub><italic>i</italic></sub> &gt; 20) occur only rarely, in keeping with the observed data. A minor discrepancy is that the fitted model tends to underestimate the frequency of distance zero while small positive distances tend to occur more frequently than observed. This could happen because we estimated the empirical densities <italic>p</italic><sub>sim</sub>(<italic>d</italic><sub><italic>i</italic>1</sub>|<italic>n</italic><sub>eff</sub>, <italic>μ</italic>) using a constant time of 6, 000 (i.e. 1 year) since the acquisition (as discussed in Section Bayesian inference for the mixture model), which may lead to a slight overestimation of the distances. To explore the impact of this assumption further, we repeated the analysis so that we computed the densities <italic>p</italic><sub>sim</sub>(<italic>d</italic><sub><italic>i</italic>1</sub>|<italic>n</italic><sub>eff</sub>, <italic>μ</italic>) at a constant time of 1, 000 generations. However, the mismatch did not disappear completely and the estimated mutation rate increased as a result to compensate for the occurrence of greater distances, in disagreement with the prior density from the ABC analysis and data <italic>D</italic><sub>0</sub>. We thus believe that the current model is adequate.</p>
<fig id="pcbi.1006534.g008" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1006534.g008</object-id>
<label>Fig 8</label>
<caption>
<title>Model validation using posterior predictive checking.</title>
<p>The histogram in the upper left corner shows the observed distance distribution in the Project CLEAR MRSA data, the other figures in the top two rows show the corresponding distances in replicate data sets simulated from the fitted model. The bottom two rows show the same histograms zoomed to range [0, 50]. The replicate data sets look overall similar to the observed data, demonstrating the adequacy of the model. However, the amount of zero distances is underestimated and the frequencies of small positive distances tend to be slightly overestimated.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1006534.g008" xlink:type="simple"/>
</fig>
</sec>
</sec>
<sec id="sec017" sec-type="conclusions">
<title>Discussion</title>
<p>We presented a new model for the analysis of clearance and acquisition of bacterial colonization, which, unlike previous approaches, does not rely on a heuristic fixed distance threshold to determine whether genomes observed at different times points are from the same or different acquisition. Fully probabilistic, the model automatically provides uncertainty estimates for all relevant quantities. Furthermore, it takes into account the variation in the time intervals between pairs of consecutive samples. Another benefit is that the model can easily incorporate additional external data to inform about the values of the parameters. To fit the model, we developed an innovative combination of ABC and MCMC, based on an underlying mixture model where one of the component distributions was formulated empirically by simulation.</p>
<p>We demonstrated the model using data on <italic>S. aureus</italic> genomes sampled longitudinally from multiple patients. Our analysis provided evidence for occasional co-colonization and identified likely false negative samples. The output of the model consists of the same vs. different strain probability for any pair of genomes, and, by using this information to decide (probabilistically) when and where the colonizing strain had changed, the acquisition and clearance rates were easy to calculate. Estimates of these parameters were found to be in agreement with previous estimates derived using a fixed threshold, but now we were able to provide confidence intervals, essential for drawing rigorously supported conclusions. We believe such analyses are common enough that our method should be useful for many, and, consequently, we provide it as an easy-to-use R-code. The code includes tools for both the ABC-inference to incorporate external data of distance distributions between multiple samples at a given time point (or two time points), and the MCMC-algorithm. We note that our method does not assume recombination. Therefore, we recommend removing recombinations by preprocessing the genomes with one of the standard methods [<xref ref-type="bibr" rid="pcbi.1006534.ref035">35</xref>–<xref ref-type="bibr" rid="pcbi.1006534.ref037">37</xref>], as we did in our analysis. While our analysis demonstrated that the external data may reduce uncertainty in the resulting posterior, we also saw that the method may work without such data. In the latter case the input is simply a list of distance-time difference pairs for genomes sampled from the same patient at consecutive time points, and it is sufficient to run the MCMC, which is efficient and fast in typical cases.</p>
<p>A central component of our approach is a model for within-host variation, required to determine how much variation can be expected if the genomes at different time points have evolved from the same strain obtained in a single acquisition. We selected for this purpose the basic Wright-Fisher model assuming constant population size and mutation rate with the understanding that these assumptions are expected to be violated to some extent in any realistic data set, but the benefits of simplicity include robustness of the conclusions to prior distributions and identifiability of the parameters from the available data. More complex models have been fitted to the distance distributions (our external data <italic>D</italic><sub>0</sub>), assuming the population size first increases and then decreases [<xref ref-type="bibr" rid="pcbi.1006534.ref014">14</xref>]. However, our model can fit the same data with fewer parameters, which justifies the simpler alternative. Furthermore, the constant population size may also be seen as a sensible model for persistent colonization. An interesting future research question is what additional data should be collected in order to be able to fit one of the possible extensions of the basic model.</p>
<p>Other methods have been recently designed for the purpose of inferring transmission events between related patients [<xref ref-type="bibr" rid="pcbi.1006534.ref038">38</xref>]. However, the goal of our method is different: to study the dynamics of acquisition and clearance of colonization using data from independent patients. Nevertheless, a potential extension of our model that could allow studying transmission between closely related individuals, e.g., within a household, would include multiple interconnected populations, one for each possible host, similar to what is considered here for a single host. Yet another direction that we are currently pursuing is to extend the model to cover genomes sampled from multiple body sites.</p>
</sec>
<sec id="sec018">
<title>Supporting information</title>
<supplementary-material id="pcbi.1006534.s001" mimetype="application/pdf" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1006534.s001" xlink:type="simple">
<label>S1 File</label>
<caption>
<title>Derivations and further details of the model.</title>
<p>We provide some further derivations and details related to our MCMC algorithm. To guide the selection of prior hyperparameters, we also derive the explicit prior distribution and some of its summaries for the parameter <bold>t</bold><sub>0</sub> and the mean and variance for the prior predictive distribution for the distance. We show some further ABC inference results and also describe further details on computing the acquisition and clearance rates.</p>
<p>(PDF)</p>
</caption>
</supplementary-material>
</sec>
</body>
<back>
<ack>
<p>We acknowledge the computational resources provided by Aalto Science-IT project.</p>
</ack>
<ref-list>
<title>References</title>
<ref id="pcbi.1006534.ref001">
<label>1</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Young</surname> <given-names>BC</given-names></name>, <name name-style="western"><surname>Golubchik</surname> <given-names>T</given-names></name>, <name name-style="western"><surname>Batty</surname> <given-names>EM</given-names></name>, <name name-style="western"><surname>Fung</surname> <given-names>R</given-names></name>, <name name-style="western"><surname>Larner-Svensson</surname> <given-names>H</given-names></name>, <name name-style="western"><surname>Votintseva</surname> <given-names>AA</given-names></name>, <etal>et al</etal>. <article-title>Evolutionary dynamics of Staphylococcus aureus during progression from carriage to disease</article-title>. <source>Proceedings of the National Academy of Sciences</source>. <year>2012</year>;<volume>109</volume>(<issue>12</issue>):<fpage>4550</fpage>–<lpage>4555</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1073/pnas.1113219109" xlink:type="simple">10.1073/pnas.1113219109</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1006534.ref002">
<label>2</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Young</surname> <given-names>BC</given-names></name>, <name name-style="western"><surname>Wu</surname> <given-names>CH</given-names></name>, <name name-style="western"><surname>Gordon</surname> <given-names>NC</given-names></name>, <name name-style="western"><surname>Cole</surname> <given-names>K</given-names></name>, <name name-style="western"><surname>Price</surname> <given-names>JR</given-names></name>, <name name-style="western"><surname>Liu</surname> <given-names>E</given-names></name>, <etal>et al</etal>. <article-title>Severe infections emerge from commensal bacteria by adaptive evolution</article-title>. <source>elife</source>. <year>2017</year>;<volume>6</volume>:<fpage>e30637</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.7554/eLife.30637" xlink:type="simple">10.7554/eLife.30637</ext-link></comment> <object-id pub-id-type="pmid">29256859</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006534.ref003">
<label>3</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Gordon</surname> <given-names>N</given-names></name>, <name name-style="western"><surname>Pichon</surname> <given-names>B</given-names></name>, <name name-style="western"><surname>Golubchik</surname> <given-names>T</given-names></name>, <name name-style="western"><surname>Wilson</surname> <given-names>D</given-names></name>, <name name-style="western"><surname>Paul</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Blanc</surname> <given-names>D</given-names></name>, <etal>et al</etal>. <article-title>Whole-genome sequencing reveals the contribution of long-term carriers in Staphylococcus aureus outbreak investigation</article-title>. <source>Journal of Clinical Microbiology</source>. <year>2017</year>;<volume>55</volume>(<issue>7</issue>):<fpage>2188</fpage>–<lpage>2197</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1128/JCM.00363-17" xlink:type="simple">10.1128/JCM.00363-17</ext-link></comment> <object-id pub-id-type="pmid">28468851</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006534.ref004">
<label>4</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Alam</surname> <given-names>MT</given-names></name>, <name name-style="western"><surname>Read</surname> <given-names>TD</given-names></name>, <name name-style="western"><surname>Petit</surname> <given-names>RA</given-names></name>, <name name-style="western"><surname>Boyle-Vavra</surname> <given-names>S</given-names></name>, <name name-style="western"><surname>Miller</surname> <given-names>LG</given-names></name>, <name name-style="western"><surname>Eells</surname> <given-names>SJ</given-names></name>, <etal>et al</etal>. <article-title>Transmission and microevolution of USA300 MRSA in US households: evidence from whole-genome sequencing</article-title>. <source>MBio</source>. <year>2015</year>;<volume>6</volume>(<issue>2</issue>):<fpage>e00054</fpage>–<lpage>15</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1128/mBio.00054-15" xlink:type="simple">10.1128/mBio.00054-15</ext-link></comment> <object-id pub-id-type="pmid">25759497</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006534.ref005">
<label>5</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Coll</surname> <given-names>F</given-names></name>, <name name-style="western"><surname>Harrison</surname> <given-names>EM</given-names></name>, <name name-style="western"><surname>Toleman</surname> <given-names>MS</given-names></name>, <name name-style="western"><surname>Reuter</surname> <given-names>S</given-names></name>, <name name-style="western"><surname>Raven</surname> <given-names>KE</given-names></name>, <name name-style="western"><surname>Blane</surname> <given-names>B</given-names></name>, <etal>et al</etal>. <article-title>Longitudinal genomic surveillance of MRSA in the UK reveals transmission patterns in hospitals and the community</article-title>. <source>Science Translational Medicine</source>. <year>2017</year>;<volume>9</volume>(<issue>413</issue>):<fpage>eaak9745</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1126/scitranslmed.aak9745" xlink:type="simple">10.1126/scitranslmed.aak9745</ext-link></comment> <object-id pub-id-type="pmid">29070701</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006534.ref006">
<label>6</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Calderwood</surname> <given-names>MS</given-names></name>. <article-title>Editorial commentary: Duration of colonization with methicillin-resistant Staphylococcus aureus: A question with many answers</article-title>. <source>Clinical infectious diseases: an official publication of the Infectious Diseases Society of America</source>. <year>2015</year>;<volume>60</volume>(<issue>10</issue>):<fpage>1497</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1006534.ref007">
<label>7</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Miller</surname> <given-names>RR</given-names></name>, <name name-style="western"><surname>Walker</surname> <given-names>AS</given-names></name>, <name name-style="western"><surname>Godwin</surname> <given-names>H</given-names></name>, <name name-style="western"><surname>Fung</surname> <given-names>R</given-names></name>, <name name-style="western"><surname>Votintseva</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Bowden</surname> <given-names>R</given-names></name>, <etal>et al</etal>. <article-title>Dynamics of acquisition and loss of carriage of Staphylococcus aureus strains in the community: the effect of clonal complex</article-title>. <source>Journal of Infection</source>. <year>2014</year>;<volume>68</volume>(<issue>5</issue>):<fpage>426</fpage>–<lpage>439</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.jinf.2013.12.013" xlink:type="simple">10.1016/j.jinf.2013.12.013</ext-link></comment> <object-id pub-id-type="pmid">24393651</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006534.ref008">
<label>8</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Didelot</surname> <given-names>X</given-names></name>, <name name-style="western"><surname>Walker</surname> <given-names>AS</given-names></name>, <name name-style="western"><surname>Peto</surname> <given-names>TE</given-names></name>, <name name-style="western"><surname>Crook</surname> <given-names>DW</given-names></name>, <name name-style="western"><surname>Wilson</surname> <given-names>DJ</given-names></name>. <article-title>Within-host evolution of bacterial pathogens</article-title>. <source>Nature Reviews Microbiology</source>. <year>2016</year>;<volume>14</volume>(<issue>3</issue>):<fpage>150</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1038/nrmicro.2015.13" xlink:type="simple">10.1038/nrmicro.2015.13</ext-link></comment> <object-id pub-id-type="pmid">26806595</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006534.ref009">
<label>9</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Worby</surname> <given-names>CJ</given-names></name>, <name name-style="western"><surname>Lipsitch</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Hanage</surname> <given-names>WP</given-names></name>. <article-title>Within-host bacterial diversity hinders accurate reconstruction of transmission networks from genomic distance data</article-title>. <source>PLoS Computational Biology</source>. <year>2014</year>;<volume>10</volume>(<issue>3</issue>):<fpage>e1003549</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1371/journal.pcbi.1003549" xlink:type="simple">10.1371/journal.pcbi.1003549</ext-link></comment> <object-id pub-id-type="pmid">24675511</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006534.ref010">
<label>10</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Price</surname> <given-names>JR</given-names></name>, <name name-style="western"><surname>Cole</surname> <given-names>K</given-names></name>, <name name-style="western"><surname>Bexley</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Kostiou</surname> <given-names>V</given-names></name>, <name name-style="western"><surname>Eyre</surname> <given-names>DW</given-names></name>, <name name-style="western"><surname>Golubchik</surname> <given-names>T</given-names></name>, <etal>et al</etal>. <article-title>Transmission of Staphylococcus aureus between health-care workers, the environment, and patients in an intensive care unit: a longitudinal cohort study based on whole-genome sequencing</article-title>. <source>The Lancet Infectious Diseases</source>. <year>2017</year>;<volume>17</volume>(<issue>2</issue>):<fpage>207</fpage>–<lpage>214</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/S1473-3099(16)30413-3" xlink:type="simple">10.1016/S1473-3099(16)30413-3</ext-link></comment> <object-id pub-id-type="pmid">27863959</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006534.ref011">
<label>11</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Uhlemann</surname> <given-names>AC</given-names></name>, <name name-style="western"><surname>Dordel</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Knox</surname> <given-names>JR</given-names></name>, <name name-style="western"><surname>Raven</surname> <given-names>KE</given-names></name>, <name name-style="western"><surname>Parkhill</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Holden</surname> <given-names>MT</given-names></name>, <etal>et al</etal>. <article-title>Molecular tracing of the emergence, diversification, and transmission of S. aureus sequence type 8 in a New York community</article-title>. <source>Proceedings of the National Academy of Sciences</source>. <year>2014</year>;<volume>111</volume>(<issue>18</issue>):<fpage>6738</fpage>–<lpage>6743</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1073/pnas.1401006111" xlink:type="simple">10.1073/pnas.1401006111</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1006534.ref012">
<label>12</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Peacock</surname> <given-names>S</given-names></name>, <name name-style="western"><surname>Parkhill</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Brown</surname> <given-names>N</given-names></name>. <article-title>Changing the paradigm for hospital outbreak detection by leading with genomic surveillance of nosocomial pathogens</article-title>. <source>Microbiology (Reading, England)</source>. <year>2018</year>;. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1099/mic.0.000700" xlink:type="simple">10.1099/mic.0.000700</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1006534.ref013">
<label>13</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Lees</surname> <given-names>JA</given-names></name>, <name name-style="western"><surname>Croucher</surname> <given-names>NJ</given-names></name>, <name name-style="western"><surname>Goldblatt</surname> <given-names>D</given-names></name>, <name name-style="western"><surname>Nosten</surname> <given-names>F</given-names></name>, <name name-style="western"><surname>Parkhill</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Turner</surname> <given-names>C</given-names></name>, <etal>et al</etal>. <article-title>Genome-wide identification of lineage and locus specific variation associated with pneumococcal carriage duration</article-title>. <source>Elife</source>. <year>2017</year>;<volume>6</volume>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.7554/eLife.26255" xlink:type="simple">10.7554/eLife.26255</ext-link></comment> <object-id pub-id-type="pmid">28742023</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006534.ref014">
<label>14</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Golubchik</surname> <given-names>T</given-names></name>, <name name-style="western"><surname>Batty</surname> <given-names>EM</given-names></name>, <name name-style="western"><surname>Miller</surname> <given-names>RR</given-names></name>, <name name-style="western"><surname>Farr</surname> <given-names>H</given-names></name>, <name name-style="western"><surname>Young</surname> <given-names>BC</given-names></name>, <name name-style="western"><surname>Larner-Svensson</surname> <given-names>H</given-names></name>, <etal>et al</etal>. <article-title>Within-host evolution of Staphylococcus aureus during asymptomatic carriage</article-title>. <source>PLoS One</source>. <year>2013</year>;<volume>8</volume>(<issue>5</issue>):<fpage>e61319</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1371/journal.pone.0061319" xlink:type="simple">10.1371/journal.pone.0061319</ext-link></comment> <object-id pub-id-type="pmid">23658690</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006534.ref015">
<label>15</label>
<mixed-citation publication-type="book" xlink:type="simple">
<name name-style="western"><surname>Robinson</surname> <given-names>DA</given-names></name>, <name name-style="western"><surname>Feil</surname> <given-names>EJ</given-names></name>, <name name-style="western"><surname>Falush</surname> <given-names>D</given-names></name>. <source>Bacterial population genetics in infectious disease</source>. <publisher-name>John Wiley &amp; Sons</publisher-name>; <year>2010</year>.</mixed-citation>
</ref>
<ref id="pcbi.1006534.ref016">
<label>16</label>
<mixed-citation publication-type="book" xlink:type="simple">
<name name-style="western"><surname>Gelman</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Carlin</surname> <given-names>JB</given-names></name>, <name name-style="western"><surname>Stern</surname> <given-names>HS</given-names></name>, <name name-style="western"><surname>Dunson</surname> <given-names>DB</given-names></name>, <name name-style="western"><surname>Vehtari</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Rubin</surname> <given-names>DB</given-names></name>. <source>Bayesian data analysis</source>. <edition>3rd ed</edition>. <publisher-name>Chapman &amp; Hall/CRC Texts in Statistical Science</publisher-name>; <year>2013</year>.</mixed-citation>
</ref>
<ref id="pcbi.1006534.ref017">
<label>17</label>
<mixed-citation publication-type="book" xlink:type="simple">
<name name-style="western"><surname>O’Hagan</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Forster</surname> <given-names>J</given-names></name>. <source>Advanced Theory of Statistics, Bayesian inference</source>. <edition>2nd ed</edition>. <publisher-loc>London, UK</publisher-loc>: <publisher-name>Arnold</publisher-name>; <year>2004</year>.</mixed-citation>
</ref>
<ref id="pcbi.1006534.ref018">
<label>18</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Beaumont</surname> <given-names>MA</given-names></name>, <name name-style="western"><surname>Zhang</surname> <given-names>W</given-names></name>, <name name-style="western"><surname>Balding</surname> <given-names>DJ</given-names></name>. <article-title>Approximate Bayesian computation in population genetics</article-title>. <source>Genetics</source>. <year>2002</year>;<volume>162</volume>(<issue>4</issue>):<fpage>2025</fpage>–<lpage>2035</lpage>. <object-id pub-id-type="pmid">12524368</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006534.ref019">
<label>19</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Lintusaari</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Gutmann</surname> <given-names>MU</given-names></name>, <name name-style="western"><surname>Dutta</surname> <given-names>R</given-names></name>, <name name-style="western"><surname>Kaski</surname> <given-names>S</given-names></name>, <name name-style="western"><surname>Corander</surname> <given-names>J</given-names></name>. <article-title>Fundamentals and Recent Developments in Approximate Bayesian Computation</article-title>. <source>Systematic biology</source>. <year>2017</year>;<volume>66</volume>(<issue>1</issue>):<fpage>e66</fpage>–<lpage>e82</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1093/sysbio/syw077" xlink:type="simple">10.1093/sysbio/syw077</ext-link></comment> <object-id pub-id-type="pmid">28175922</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006534.ref020">
<label>20</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Ansari</surname> <given-names>MA</given-names></name>, <name name-style="western"><surname>Didelot</surname> <given-names>X</given-names></name>. <article-title>Inference of the properties of the recombination process from whole bacterial genomes</article-title>. <source>Genetics</source>. <year>2014</year>;<volume>196</volume>(<issue>1</issue>):<fpage>253</fpage>–<lpage>265</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1534/genetics.113.157172" xlink:type="simple">10.1534/genetics.113.157172</ext-link></comment> <object-id pub-id-type="pmid">24172133</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006534.ref021">
<label>21</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Numminen</surname> <given-names>E</given-names></name>, <name name-style="western"><surname>Cheng</surname> <given-names>L</given-names></name>, <name name-style="western"><surname>Gyllenberg</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Corander</surname> <given-names>J</given-names></name>. <article-title>Estimating the transmission dynamics of Streptococcus pneumoniae from strain prevalence data</article-title>. <source>Biometrics</source>. <year>2013</year>;<volume>69</volume>(<issue>3</issue>):<fpage>748</fpage>–<lpage>757</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1111/biom.12040" xlink:type="simple">10.1111/biom.12040</ext-link></comment> <object-id pub-id-type="pmid">23822205</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006534.ref022">
<label>22</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Järvenpää</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Gutmann</surname> <given-names>MU</given-names></name>, <name name-style="western"><surname>Vehtari</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Marttinen</surname> <given-names>P</given-names></name>. <article-title>Gaussian process modelling in approximate Bayesian computation to estimate horizontal gene transfer in bacteria</article-title>. <source>The Annals of Applied Statistics</source>. <year>2018</year>;<volume>12</volume>(<issue>4</issue>):<fpage>2228</fpage>–<lpage>2251</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1214/18-AOAS1150" xlink:type="simple">10.1214/18-AOAS1150</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1006534.ref023">
<label>23</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>De Maio</surname> <given-names>N</given-names></name>, <name name-style="western"><surname>Wilson</surname> <given-names>DJ</given-names></name>. <article-title>The bacterial sequential Markov coalescent</article-title>. <source>Genetics</source>. <year>2017</year>;<volume>206</volume>(<issue>1</issue>):<fpage>333</fpage>–<lpage>343</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1534/genetics.116.198796" xlink:type="simple">10.1534/genetics.116.198796</ext-link></comment> <object-id pub-id-type="pmid">28258183</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006534.ref024">
<label>24</label>
<mixed-citation publication-type="other" xlink:type="simple">Agency for Healthcare Research and Quality (AHRQ). Project CLEAR (Changing Lives by Eradicating Antibiotic Resistance) Trial; 2018. <ext-link ext-link-type="uri" xlink:href="https://clinicaltrials.gov/ct2/show/NCT01209234" xlink:type="simple">https://clinicaltrials.gov/ct2/show/NCT01209234</ext-link>. Last accessed 08-23-2018.</mixed-citation>
</ref>
<ref id="pcbi.1006534.ref025">
<label>25</label>
<mixed-citation publication-type="book" xlink:type="simple">
<name name-style="western"><surname>Nurk</surname> <given-names>S</given-names></name>, <name name-style="western"><surname>Bankevich</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Antipov</surname> <given-names>D</given-names></name>, <name name-style="western"><surname>Gurevich</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Korobeynikov</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Lapidus</surname> <given-names>A</given-names></name>, <etal>et al</etal>. <chapter-title>Assembling Genomes and Mini-metagenomes from Highly Chimeric Reads</chapter-title>. In: <name name-style="western"><surname>Deng</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Jiang</surname> <given-names>R</given-names></name>, <name name-style="western"><surname>Sun</surname> <given-names>F</given-names></name>, <name name-style="western"><surname>Zhang</surname> <given-names>X</given-names></name>, editors. <source>Research in Computational Molecular Biology</source>. <publisher-loc>Berlin, Heidelberg</publisher-loc>: <publisher-name>Springer Berlin Heidelberg</publisher-name>; <year>2013</year>. p. <fpage>158</fpage>–<lpage>170</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1006534.ref026">
<label>26</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Li</surname> <given-names>H</given-names></name>, <name name-style="western"><surname>Durbin</surname> <given-names>R</given-names></name>. <article-title>Fast and accurate short read alignment with Burrows–Wheeler transform</article-title>. <source>Bioinformatics</source>. <year>2009</year>;<volume>25</volume>(<issue>14</issue>):<fpage>1754</fpage>–<lpage>1760</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1093/bioinformatics/btp324" xlink:type="simple">10.1093/bioinformatics/btp324</ext-link></comment> <object-id pub-id-type="pmid">19451168</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006534.ref027">
<label>27</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Walker</surname> <given-names>BJ</given-names></name>, <name name-style="western"><surname>Abeel</surname> <given-names>T</given-names></name>, <name name-style="western"><surname>Shea</surname> <given-names>T</given-names></name>, <name name-style="western"><surname>Priest</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Abouelliel</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Sakthikumar</surname> <given-names>S</given-names></name>, <etal>et al</etal>. <article-title>Pilon: An Integrated Tool for Comprehensive Microbial Variant Detection and Genome Assembly Improvement</article-title>. <source>PLOS ONE</source>. <year>2014</year>;<volume>9</volume>(<issue>11</issue>):<fpage>1</fpage>–<lpage>14</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1371/journal.pone.0112963" xlink:type="simple">10.1371/journal.pone.0112963</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1006534.ref028">
<label>28</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Croucher</surname> <given-names>NJ</given-names></name>, <name name-style="western"><surname>Page</surname> <given-names>AJ</given-names></name>, <name name-style="western"><surname>Connor</surname> <given-names>TR</given-names></name>, <name name-style="western"><surname>Delaney</surname> <given-names>AJ</given-names></name>, <name name-style="western"><surname>Keane</surname> <given-names>JA</given-names></name>, <name name-style="western"><surname>Bentley</surname> <given-names>SD</given-names></name>, <etal>et al</etal>. <article-title>Rapid phylogenetic analysis of large samples of recombinant bacterial whole genome sequences using Gubbins</article-title>. <source>Nucleic Acids Research</source>. <year>2015</year>;<volume>43</volume>(<issue>3</issue>):<fpage>e15</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1093/nar/gku1196" xlink:type="simple">10.1093/nar/gku1196</ext-link></comment> <object-id pub-id-type="pmid">25414349</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006534.ref029">
<label>29</label>
<mixed-citation publication-type="book" xlink:type="simple">
<name name-style="western"><surname>Schierup</surname> <given-names>MH</given-names></name>, <name name-style="western"><surname>Wiuf</surname> <given-names>C</given-names></name>. <chapter-title>The coalescent of bacterial populations</chapter-title>. <source>Bacterial Population Genetics in Infectious Disease</source>. <year>2010</year>; p. <fpage>1</fpage>–<lpage>18</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1006534.ref030">
<label>30</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Hartig</surname> <given-names>F</given-names></name>, <name name-style="western"><surname>Calabrese</surname> <given-names>JM</given-names></name>, <name name-style="western"><surname>Reineking</surname> <given-names>B</given-names></name>, <name name-style="western"><surname>Wiegand</surname> <given-names>T</given-names></name>, <name name-style="western"><surname>Huth</surname> <given-names>A</given-names></name>. <article-title>Statistical inference for stochastic simulation models–theory and application</article-title>. <source>Ecology Letters</source>. <year>2011</year>;<volume>14</volume>(<issue>8</issue>):<fpage>816</fpage>–<lpage>27</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1111/j.1461-0248.2011.01640.x" xlink:type="simple">10.1111/j.1461-0248.2011.01640.x</ext-link></comment> <object-id pub-id-type="pmid">21679289</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006534.ref031">
<label>31</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Marin</surname> <given-names>JM</given-names></name>, <name name-style="western"><surname>Pudlo</surname> <given-names>P</given-names></name>, <name name-style="western"><surname>Robert</surname> <given-names>CP</given-names></name>, <name name-style="western"><surname>Ryder</surname> <given-names>RJ</given-names></name>. <article-title>Approximate Bayesian computational methods</article-title>. <source>Statistics and Computing</source>. <year>2012</year>;<volume>22</volume>(<issue>6</issue>):<fpage>1167</fpage>–<lpage>1180</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1007/s11222-011-9288-2" xlink:type="simple">10.1007/s11222-011-9288-2</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1006534.ref032">
<label>32</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Wertheim</surname> <given-names>HF</given-names></name>, <name name-style="western"><surname>Walsh</surname> <given-names>E</given-names></name>, <name name-style="western"><surname>Choudhurry</surname> <given-names>R</given-names></name>, <name name-style="western"><surname>Melles</surname> <given-names>DC</given-names></name>, <name name-style="western"><surname>Boelens</surname> <given-names>HA</given-names></name>, <name name-style="western"><surname>Miajlovic</surname> <given-names>H</given-names></name>, <etal>et al</etal>. <article-title>Key role for clumping factor B in Staphylococcus aureus nasal colonization of humans</article-title>. <source>PLoS medicine</source>. <year>2008</year>;<volume>5</volume>(<issue>1</issue>):<fpage>e17</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1371/journal.pmed.0050017" xlink:type="simple">10.1371/journal.pmed.0050017</ext-link></comment> <object-id pub-id-type="pmid">18198942</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006534.ref033">
<label>33</label>
<mixed-citation publication-type="book" xlink:type="simple">
<name name-style="western"><surname>Bishop</surname> <given-names>CM</given-names></name>. <source>Pattern Recognition and Machine Learning (Information Science and Statistics)</source>. <publisher-name>Springer-Verlag New York, Inc.</publisher-name>; <year>2006</year>.</mixed-citation>
</ref>
<ref id="pcbi.1006534.ref034">
<label>34</label>
<mixed-citation publication-type="book" xlink:type="simple">
<name name-style="western"><surname>Robert</surname> <given-names>CP</given-names></name>, <name name-style="western"><surname>Casella</surname> <given-names>G</given-names></name>. <source>Monte Carlo Statistical Methods</source>. <edition>2nd ed</edition>. <publisher-loc>New York</publisher-loc>: <publisher-name>Springer</publisher-name>; <year>2004</year>.</mixed-citation>
</ref>
<ref id="pcbi.1006534.ref035">
<label>35</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Croucher</surname> <given-names>NJ</given-names></name>, <name name-style="western"><surname>Page</surname> <given-names>AJ</given-names></name>, <name name-style="western"><surname>Connor</surname> <given-names>TR</given-names></name>, <name name-style="western"><surname>Delaney</surname> <given-names>AJ</given-names></name>, <name name-style="western"><surname>Keane</surname> <given-names>JA</given-names></name>, <name name-style="western"><surname>Bentley</surname> <given-names>SD</given-names></name>, <etal>et al</etal>. <article-title>Rapid phylogenetic analysis of large samples of recombinant bacterial whole genome sequences using Gubbins</article-title>. <source>Nucleic acids research</source>. <year>2014</year>;<volume>43</volume>(<issue>3</issue>):<fpage>e15</fpage>–<lpage>e15</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1093/nar/gku1196" xlink:type="simple">10.1093/nar/gku1196</ext-link></comment> <object-id pub-id-type="pmid">25414349</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006534.ref036">
<label>36</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Didelot</surname> <given-names>X</given-names></name>, <name name-style="western"><surname>Wilson</surname> <given-names>DJ</given-names></name>. <article-title>ClonalFrameML: efficient inference of recombination in whole bacterial genomes</article-title>. <source>PLoS computational biology</source>. <year>2015</year>;<volume>11</volume>(<issue>2</issue>):<fpage>e1004041</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1371/journal.pcbi.1004041" xlink:type="simple">10.1371/journal.pcbi.1004041</ext-link></comment> <object-id pub-id-type="pmid">25675341</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006534.ref037">
<label>37</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Mostowy</surname> <given-names>R</given-names></name>, <name name-style="western"><surname>Croucher</surname> <given-names>NJ</given-names></name>, <name name-style="western"><surname>Andam</surname> <given-names>CP</given-names></name>, <name name-style="western"><surname>Corander</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Hanage</surname> <given-names>WP</given-names></name>, <name name-style="western"><surname>Marttinen</surname> <given-names>P</given-names></name>. <article-title>Efficient inference of recent and ancestral recombination within bacterial populations</article-title>. <source>Molecular biology and evolution</source>. <year>2017</year>;<volume>34</volume>(<issue>5</issue>):<fpage>1167</fpage>–<lpage>1182</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1093/molbev/msx066" xlink:type="simple">10.1093/molbev/msx066</ext-link></comment> <object-id pub-id-type="pmid">28199698</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006534.ref038">
<label>38</label>
<mixed-citation publication-type="other" xlink:type="simple">Stimson J, Gardy JL, Mathema B, Crudu V, Cohen T, Colijn C. Beyond the SNP threshold: identifying outbreak clusters using inferred transmissions; 2018. <ext-link ext-link-type="uri" xlink:href="https://www.biorxiv.org/content/early/2018/12/03/319707" xlink:type="simple">https://www.biorxiv.org/content/early/2018/12/03/319707</ext-link>.</mixed-citation>
</ref>
</ref-list>
</back>
</article>