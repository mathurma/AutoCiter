<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article
  PUBLIC "-//NLM//DTD Journal Publishing DTD v3.0 20080202//EN" "http://dtd.nlm.nih.gov/publishing/3.0/journalpublishing3.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="3.0" xml:lang="EN">
  <front>
    <journal-meta><journal-id journal-id-type="publisher-id">plos</journal-id><journal-id journal-id-type="nlm-ta">PLoS Comput Biol</journal-id><journal-id journal-id-type="pmc">ploscomp</journal-id><!--===== Grouping journal title elements =====--><journal-title-group><journal-title>PLoS Computational Biology</journal-title></journal-title-group><issn pub-type="ppub">1553-734X</issn><issn pub-type="epub">1553-7358</issn><publisher>
        <publisher-name>Public Library of Science</publisher-name>
        <publisher-loc>San Francisco, USA</publisher-loc>
      </publisher></journal-meta>
    <article-meta><article-id pub-id-type="publisher-id">PCOMPBIOL-D-11-01898</article-id><article-id pub-id-type="doi">10.1371/journal.pcbi.1002569</article-id><article-categories>
        <subj-group subj-group-type="heading">
          <subject>Research Article</subject>
        </subj-group>
        <subj-group subj-group-type="Discipline-v2">
          <subject>Biology</subject>
          <subj-group>
            <subject>Neuroscience</subject>
            <subj-group>
              <subject>Neuroimaging</subject>
              <subj-group>
                <subject>Calcium imaging</subject>
              </subj-group>
            </subj-group>
          </subj-group>
        </subj-group>
        <subj-group subj-group-type="Discipline-v2">
          <subject>Engineering</subject>
          <subj-group>
            <subject>Signal processing</subject>
            <subj-group>
              <subject>Statistical signal processing</subject>
            </subj-group>
          </subj-group>
        </subj-group>
        <subj-group subj-group-type="Discipline-v2">
          <subject>Mathematics</subject>
          <subj-group>
            <subject>Applied mathematics</subject>
            <subj-group>
              <subject>Algorithms</subject>
            </subj-group>
          </subj-group>
          <subj-group>
            <subject>Probability theory</subject>
            <subj-group>
              <subject>Bayes theorem</subject>
            </subj-group>
          </subj-group>
          <subj-group>
            <subject>Statistics</subject>
            <subj-group>
              <subject>Statistical methods</subject>
            </subj-group>
          </subj-group>
        </subj-group>
        <subj-group subj-group-type="Discipline">
          <subject>Neuroscience</subject>
          <subject>Mathematics</subject>
        </subj-group>
      </article-categories><title-group><article-title>Fast Spatiotemporal Smoothing of Calcium Measurements in Dendritic Trees</article-title><alt-title alt-title-type="running-head">Fast Calcium Smoothing in Dendritic Trees</alt-title></title-group><contrib-group>
        <contrib contrib-type="author" xlink:type="simple">
          <name name-style="western">
            <surname>Pnevmatikakis</surname>
            <given-names>Eftychios A.</given-names>
          </name>
          <xref ref-type="aff" rid="aff1">
            <sup>1</sup>
          </xref>
          <xref ref-type="corresp" rid="cor1">
            <sup>*</sup>
          </xref>
        </contrib>
        <contrib contrib-type="author" xlink:type="simple">
          <name name-style="western">
            <surname>Kelleher</surname>
            <given-names>Keith</given-names>
          </name>
          <xref ref-type="aff" rid="aff2">
            <sup>2</sup>
          </xref>
          <xref ref-type="fn" rid="fn1">
            <sup>¤</sup>
          </xref>
        </contrib>
        <contrib contrib-type="author" xlink:type="simple">
          <name name-style="western">
            <surname>Chen</surname>
            <given-names>Rebecca</given-names>
          </name>
          <xref ref-type="aff" rid="aff2">
            <sup>2</sup>
          </xref>
        </contrib>
        <contrib contrib-type="author" xlink:type="simple">
          <name name-style="western">
            <surname>Saggau</surname>
            <given-names>Petter</given-names>
          </name>
          <xref ref-type="aff" rid="aff3">
            <sup>3</sup>
          </xref>
        </contrib>
        <contrib contrib-type="author" xlink:type="simple">
          <name name-style="western">
            <surname>Josić</surname>
            <given-names>Krešimir</given-names>
          </name>
          <xref ref-type="aff" rid="aff2">
            <sup>2</sup>
          </xref>
        </contrib>
        <contrib contrib-type="author" xlink:type="simple">
          <name name-style="western">
            <surname>Paninski</surname>
            <given-names>Liam</given-names>
          </name>
          <xref ref-type="aff" rid="aff1">
            <sup>1</sup>
          </xref>
        </contrib>
      </contrib-group><aff id="aff1"><label>1</label><addr-line>Department of Statistics and Center for Theoretical Neuroscience, Columbia University, New York, New York, United States of America</addr-line>       </aff><aff id="aff2"><label>2</label><addr-line>Department of Mathematics, University of Houston, Houston, Texas, United States of America</addr-line>       </aff><aff id="aff3"><label>3</label><addr-line>Department of Neuroscience, Baylor College of Medicine, Houston, Texas, United States of America</addr-line>       </aff><contrib-group>
        <contrib contrib-type="editor" xlink:type="simple">
          <name name-style="western">
            <surname>Sporns</surname>
            <given-names>Olaf</given-names>
          </name>
          <role>Editor</role>
          <xref ref-type="aff" rid="edit1"/>
        </contrib>
      </contrib-group><aff id="edit1">Indiana University, United States of America</aff><author-notes>
        <corresp id="cor1">* E-mail: <email xlink:type="simple">eftychios@stat.columbia.edu</email></corresp>
        <fn fn-type="current-aff" id="fn1">
          <label>¤</label>
          <p>Current address: Salk Institute for Biological Studies, La Jolla, California, United States of America</p>
        </fn>
        <fn fn-type="con">
          <p>Conceived and designed the experiments: KK RC PS KJ. Performed the experiments: KK PS. Analyzed the data: EAP KK RC. Contributed reagents/materials/analysis tools: EAP KK RC KJ LP. Wrote the paper: EAP KJ LP.</p>
        </fn>
      <fn fn-type="conflict">
        <p>The authors have declared that no competing interests exist.</p>
      </fn></author-notes><pub-date pub-type="collection">
        <month>6</month>
        <year>2012</year>
      </pub-date><pub-date pub-type="epub">
        <day>28</day>
        <month>6</month>
        <year>2012</year>
      </pub-date><volume>8</volume><issue>6</issue><elocation-id>e1002569</elocation-id><history>
        <date date-type="received">
          <day>15</day>
          <month>12</month>
          <year>2011</year>
        </date>
        <date date-type="accepted">
          <day>8</day>
          <month>5</month>
          <year>2012</year>
        </date>
      </history><!--===== Grouping copyright info into permissions =====--><permissions><copyright-year>2012</copyright-year><copyright-holder>Pnevmatikakis et al</copyright-holder><license><license-p>This is an open-access article distributed under the terms of the Creative Commons Attribution License, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p></license></permissions><abstract>
        <p>We discuss methods for fast spatiotemporal smoothing of calcium signals in dendritic trees, given single-trial, spatially localized imaging data obtained via multi-photon microscopy. By analyzing the dynamics of calcium binding to probe molecules and the effects of the imaging procedure, we show that calcium concentration can be estimated up to an affine transformation, i.e., an additive and multiplicative constant. To obtain a full spatiotemporal estimate, we model calcium dynamics within the cell using a functional approach. The evolution of calcium concentration is represented through a smaller set of hidden variables that incorporate fast transients due to backpropagating action potentials (bAPs), or other forms of stimulation. Because of the resulting state space structure, inference can be done in linear time using forward-backward maximum-a-posteriori methods. Non-negativity constraints on the calcium concentration can also be incorporated using a log-barrier method that does not affect the computational scaling. Moreover, by exploiting the neuronal tree structure we show that the cost of the algorithm is also linear in the size of the dendritic tree, making the approach applicable to arbitrarily large trees. We apply this algorithm to data obtained from hippocampal CA1 pyramidal cells with experimentally evoked bAPs, some of which were paired with excitatory postsynaptic potentials (EPSPs). The algorithm recovers the timing of the bAPs and provides an estimate of the induced calcium transient throughout the tree. The proposed methods could be used to further understand the interplay between bAPs and EPSPs in synaptic strength modification. More generally, this approach allows us to infer the concentration on intracellular calcium across the dendritic tree from noisy observations at a discrete set of points in space.</p>
      </abstract><abstract abstract-type="summary">
        <title>Author Summary</title>
        <p>Spatiotemporal dendritic imaging data, through fluorescent calcium indicators, opens an exciting window on computations performed by single neurons at a subcellular level. However, the analysis and interpretation of such data is challenging. The measurements are noisy, intermittent in space and/or time, and depend critically on the choice of the fluorescent indicator. Consequently, analysis is typically limited to a specific branch of the dendritic tree, neglects spatiotemporal correlations between neighboring compartments, and requires averaging over multiple trials. Here we derive a model for the spatiotemporal concentration of calcium bound probe molecules. Using state-space and optimization tools we derive a fast algorithm for estimating the most likely concentration based on the given measurements obtained from a single trial, and argue that it can provide an estimate of the fast transients of the underlying calcium concentration. In particular, our algorithm estimates the timing and amplitude of calcium transients due to backpropagating action potentials. It provides a flexible approach to inferring the structure of dendritic dynamics that are important in neural computation, but are inaccessible to direct measurement with current experimental techniques.</p>
      </abstract><funding-group><funding-statement>LP was supported by an NSF CAREER grant (<ext-link ext-link-type="uri" xlink:href="http://www.nsf.gov/" xlink:type="simple">http://www.nsf.gov/</ext-link>), a McKnight Scholar award (<ext-link ext-link-type="uri" xlink:href="http://www.mcknight.org/" xlink:type="simple">http://www.mcknight.org/</ext-link>), and by NSF grant IIS-0904353. EAP was supported by NSF grant IIS-0904353. KJ and RC were supported by NSF grants DMS-0817649, DMS-1122094, and a Texas ARP/ATP (<ext-link ext-link-type="uri" xlink:href="http://www.arpatp.com/" xlink:type="simple">http://www.arpatp.com/</ext-link>). The funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.</funding-statement></funding-group><counts>
        <page-count count="17"/>
      </counts></article-meta>
  </front>
  <body>
    <sec id="s1">
      <title>Introduction</title>
      <p>The problem of understanding the mechanisms that govern the change in strength of a synapse remains a key problem in cellular neuroscience. Fluorescence microscopy provides a way to examine aspects of the structure and specifically the function of living cells that are inaccessible to direct electrical recording. The experimenter performs optical recordings after delivering fluorescent probe molecules that translate a biological or biochemical signal into an optical output (for reviews see <xref ref-type="bibr" rid="pcbi.1002569-Rubart1">[1]</xref>, <xref ref-type="bibr" rid="pcbi.1002569-Saggau1">[2]</xref>). For instance, calcium indicators are such fluorescent probes that, upon binding calcium ions, change the amount of emitted light, which can be measured with a photo detector.</p>
      <p>The development of fast scanning multi-photon microscopy techniques has revealed that intracellular calcium concentrations play an important role in the interplay between backpropagating action potentials (bAPs) and excitatory post-synaptic potentials (EPSPs) that mediate synaptic changes through spike-timing dependent plasticity (STDP). However, the available experimental techniques still lead to noisy and spatiotemporally-subsampled observations of the true underlying calcium signals. Therefore we must use statistical methods to infer the details of the calcium transients from observed data. However, optimal spatiotemporal smoothing of the calcium profile on a dendritic tree given localized noisy measurements remains a difficult computational problem due to the high dimensionality (in terms of number of compartments) and complex structure of dendritic trees.</p>
      <p>In this paper we present a general methodology for fast spatio-temporal smoothing of calcium signals on dendritic trees, based on single-trial experiments. We take a functional approach according to which the evolution of calcium concentration on the whole tree is determined from a smaller set of hidden variables. These govern the temporal dynamics of the calcium bound probe molecules, at small but overlapping regions of the tree, and incorporate possible concentration “bumps” due to bAPs, EPSPs or external stimulation. These bumps in the hidden states are in general rapidly increasing and slowly decreasing, and model the corresponding spatially localized bumps in probe molecule concentration due to rapid calcium transients. The calcium measurements are then expressed as linear noisy measurements of the hidden variables. Our problem then reduces to the maximum a-posteriori space-time estimation of these hidden states. Using a standard state-space approach we formulate our problem as one of optimization that can be efficiently solved if the state-transition and measurement-noise distributions are log-concave in the hidden states. In this case the problem can be solved with a cost that scales linearly with <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e001" xlink:type="simple"/></inline-formula> (where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e002" xlink:type="simple"/></inline-formula> is the number of timesteps over which we would like to infer the underlying signal) using standard convex optimization techniques. These convex optimization approaches usually scale cubically with the number of hidden states <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e003" xlink:type="simple"/></inline-formula>, and are thus inapplicable to arbitrarily large trees. However, we exploit the localized structure that underlies our approach to show that the complexity of the present estimation algorithm also scales linearly with the size of the tree, leading to a total overall complexity that scales linearly both with <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e004" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e005" xlink:type="simple"/></inline-formula>.</p>
      <p>Although related, the problem that we deal with in this paper is different from the one of extracting spikes from mesoscopic fluorescence recordings. In the latter, the data consists of images taken at a low rate from a population of neurons, and the goal is to extract a set of spike times. Several methods have been developed for this problem, such as template matching <xref ref-type="bibr" rid="pcbi.1002569-Greenberg1">[3]</xref>, supervised learning <xref ref-type="bibr" rid="pcbi.1002569-Sasaki1">[4]</xref>, particle filtering <xref ref-type="bibr" rid="pcbi.1002569-Vogelstein1">[5]</xref> and fast nonnegative deconvolution <xref ref-type="bibr" rid="pcbi.1002569-Vogelstein2">[6]</xref>. Our model is a spatiotemporal generalization of the one presented in <xref ref-type="bibr" rid="pcbi.1002569-Vogelstein2">[6]</xref>, with several important differences. Our data consists of fast localized measurements at certain locations of the dendritic tree. Instead of extracting spike times, our goal is to smooth the data and estimate the full spatiotemporal profile of the calcium concentration over the entire dendritic tree, including locations at which no measurements were made. Moreover, the spikes in our case correspond to fast calcium transients due to bAPs, and apart from their timing, the estimation of their amplitude is also of great importance.</p>
      <p>We will consider data obtained by measurements of probe fluorescence obtained with fast random-access multi-photon (RAMP) microscopy <xref ref-type="bibr" rid="pcbi.1002569-Reddy1">[7]</xref> from a discrete set of recording sites across a single cell. The light intensity emitted at each site is related to the concentration of calcium-bound probe molecules, and hence the underlying calcium concentration. It is important to note that we can only estimate the signal up to an affine transformation of the spatio-temporal calcium concentration. As we discuss further below, estimation of the true calcium concentration is possible, but would require further signal processing that is affected by the various noise sources. Thus we estimate the calcium concentration up to an affine transformation, which still retains all the qualitative characteristics of the spatiotemporal calcium transients. We demonstrate our algorithm with examples on artificial and real data, and discuss some different possible choices of the prior on the hidden states. This prior can be chosen to reflect our a priori knowledge about the location, amplitude, and smoothness of the calcium bumps.</p>
    </sec>
    <sec id="s2" sec-type="methods">
      <title>Methods</title>
      <p>Measurements of the light intensity emitted by calcium sensitive dyes at discrete points in space and time can be used to infer the evolving concentration of calcium across the dendritic tree. Here we provide a description of an experimental situation suited for this approach, and show how it leads to a statistical model that can be used to estimate the calcium signal.</p>
      <sec id="s2a">
        <title>Outline of experiment</title>
        <p>Although the statistical methods we present are general, we demonstrate them in the context of a particular experiment. It has been assumed that action potentials that backpropagate from the soma into the dendritic tree play an important role in learning <xref ref-type="bibr" rid="pcbi.1002569-Magee1">[8]</xref>. We examined how bAPs interact with synaptic input in pyramidal cells from the CA1 region of the rat hippocampus <italic>in vitro</italic>, in acutely dissected hippocampal brain slices. A schematic of the stimulation protocol is shown in <xref ref-type="fig" rid="pcbi-1002569-g001">Fig. 1a</xref>: <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e006" xlink:type="simple"/></inline-formula> after the start of the recording ten action potentials (APs) were initiated at the soma of the pyramidal cell at 10 Hz. In some experiments, one of the 10 evoked APs is paired with a series of 3 synaptic EPSPs at 50 Hz. These EPSPs were evoked starting at 50 ms before the selected action potential by a bipolar extracellular stimulating electrode placed at 20–50 <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e007" xlink:type="simple"/></inline-formula> from the dendrite of the recorded cell, approximately 250–300 <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e008" xlink:type="simple"/></inline-formula> from the cell body layer.</p>
        <fig id="pcbi-1002569-g001" position="float">
          <object-id pub-id-type="doi">10.1371/journal.pcbi.1002569.g001</object-id>
          <label>Figure 1</label>
          <caption>
            <title>Experimental protocol and simplified reaction scheme.</title>
            <p>A: Experimental protocol. In the first protocol 10 spikes were initiated at the soma 500 ms after the start of the recording with a frequency of 10 Hz. In the second protocol, the last action potential was preceded by a series of 3 EPSPs evoked at the dendrites, starting 50 ms before the last spike at a frequency of 50 Hz. B: The relationship between membrane potential and fluorescence. Changes in membrane potential affect the rate of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e009" xlink:type="simple"/></inline-formula> influx into the cell via voltage gated calcium channels. Intracellularly, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e010" xlink:type="simple"/></inline-formula> is sequestered by endogenous <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e011" xlink:type="simple"/></inline-formula> buffers, as well as by the optical probe, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e012" xlink:type="simple"/></inline-formula>. A change in the relative concentration of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e013" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e014" xlink:type="simple"/></inline-formula> results in a measurable change in fluorescence.</p>
          </caption>
          <graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002569.g001" xlink:type="simple"/>
        </fig>
        <p>Each evoked AP backpropagated into the dendritic tree. These bAPs resulted in a transient increase in intracellular calcium concentration, which has been previously shown to result from increased conductance through voltage-dependent calcium channels <xref ref-type="bibr" rid="pcbi.1002569-Markram1">[9]</xref>, <xref ref-type="bibr" rid="pcbi.1002569-Reddy1">[7]</xref>. The goal of the experiment was to study the effects of the pairing of a bAP and EPSPs on the spatiotemporal structure of the calcium concentration across the dendritic tree. Each recording lasted for approximately 6 <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e015" xlink:type="simple"/></inline-formula>.</p>
        <p>Recordings were performed using 3D RAMP microscopy, which uses acousto-optic deflectors (AODs) for high-speed recording within a volume of live brain tissue <xref ref-type="bibr" rid="pcbi.1002569-Reddy1">[7]</xref>. Recording sites were chosen by the user, and their location was fixed during a recording session. A recording cycle took only 20 <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e016" xlink:type="simple"/></inline-formula> which allowed a functional scan consisting of 30 arbitrarily positioned recording sites to be made at a 1.6 kHz sampling rate.</p>
      </sec>
      <sec id="s2b">
        <title>Construction of the statistical model and the inference algorithm</title>
        <sec id="s2b1">
          <title>Calcium-bound probe molecules and the emitted light signal</title>
          <p>The concentration of calcium-bound probe molecules can be used as a proxy for the concentration of calcium in the system. A simplified reaction scheme describing calcium binding is shown in <xref ref-type="fig" rid="pcbi-1002569-g001">Fig. 1b</xref>. As probe molecules bind to calcium quickly, we assume that during fast transients, the change in concentration of fluorophore bound to calcium <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e017" xlink:type="simple"/></inline-formula> is proportional to the calcium concentration ([ <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e018" xlink:type="simple"/></inline-formula> ]) times the concentration of free fluorophore at this location. This relationship holds as long as probe molecules are not saturated with calcium. Our optical probe, Oregon Green BAPTA-1, has a high affinity to calcium, due to its fast binding rate, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e019" xlink:type="simple"/></inline-formula>, and slow unbinding rate, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e020" xlink:type="simple"/></inline-formula>, leading to decay rates on the order of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e021" xlink:type="simple"/></inline-formula>. As a result, the fluorescence response from a fast voltage transient, like that of a bAP or an EPSP, rises effectively instantaneously, and decays slowly <xref ref-type="bibr" rid="pcbi.1002569-Yasuda1">[10]</xref>, <xref ref-type="bibr" rid="pcbi.1002569-Poenie1">[11]</xref>. Thus the fluorescent signal provides a temporally filtered representation of the underlying intracellular calcium concentration. This complicates the interpretation of the recordings. Our goal will be to reconstruct the spatial and temporal structure of bound probe molecule dynamics. We therefore first describe how the emitted light intensity is related to the calcium concentration at a location within the cell.</p>
          <p>The light intensity emitted at location <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e022" xlink:type="simple"/></inline-formula> at time <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e023" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e024" xlink:type="simple"/></inline-formula>, is directly related to the concentrations of bound probe molecules by<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e025" xlink:type="simple"/></disp-formula>where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e026" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e027" xlink:type="simple"/></inline-formula> are the concentration of <italic>bound</italic> and <italic>free</italic> probe molecules respectively, at spatial location <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e028" xlink:type="simple"/></inline-formula> and time <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e029" xlink:type="simple"/></inline-formula>. The scalar <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e030" xlink:type="simple"/></inline-formula> represents the relative fluorescence of the bound fluorophore to free fluorophore (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e031" xlink:type="simple"/></inline-formula> for the dye used here <xref ref-type="bibr" rid="pcbi.1002569-Haugland1">[12]</xref>). The constants <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e032" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e033" xlink:type="simple"/></inline-formula> represent the light intensity of free probe molecules and autofluorescence, respectively.</p>
          <p>Assuming that probe molecules are conserved locally, i.e., <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e034" xlink:type="simple"/></inline-formula>, we obtain<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e035" xlink:type="simple"/><label>(1)</label></disp-formula>where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e036" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e037" xlink:type="simple"/></inline-formula>. Therefore fluorescence, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e038" xlink:type="simple"/></inline-formula>, is affinely related to the concentration of calcium-bound probe molecules when these are not saturated. To simplify our analysis we assume that Eq. (1) is deterministic and that all the noise in our model comes from the recording procedure, which will be described below. By defining the baseline fluorescence at location <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e039" xlink:type="simple"/></inline-formula> as <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e040" xlink:type="simple"/></inline-formula>, we have that <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e041" xlink:type="simple"/></inline-formula>.</p>
        </sec>
        <sec id="s2b2">
          <title>The signal of interest</title>
          <p>The fast calcium signals in the tree, in our case, are due to a bAP that results in a transient increase in the concentration of bound probe molecules. High affinity calcium dyes, such as the Oregon Green BAPTA-1 (OGB-1) used here, bind calcium with a very fast onset and also have a much slower dissociation rate. Neglecting spatial correlations and diffusion terms, we can model the bound probe molecule dynamics as<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e042" xlink:type="simple"/><label>(2)</label></disp-formula>Here <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e043" xlink:type="simple"/></inline-formula> is the time constant that determines the rate at which probe fluorescence molecules unbind from calcium. The term <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e044" xlink:type="simple"/></inline-formula> represents the times at which the sequence of bAPs reaches the location <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e045" xlink:type="simple"/></inline-formula> and can in this case be written as the sum <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e046" xlink:type="simple"/></inline-formula> of Dirac delta functions, where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e047" xlink:type="simple"/></inline-formula> represents the time at which the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e048" xlink:type="simple"/></inline-formula>-th bAP reaches location <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e049" xlink:type="simple"/></inline-formula>. We will generalize this assumption below. The <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e050" xlink:type="simple"/></inline-formula>-th bAP at location <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e051" xlink:type="simple"/></inline-formula> results in an instantaneous jump of size <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e052" xlink:type="simple"/></inline-formula> in bound probe molecule concentration, followed by an exponential decay to a baseline concentration at rate <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e053" xlink:type="simple"/></inline-formula>. For a high affinity dye a fast calcium influx leads to a <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e054" xlink:type="simple"/></inline-formula> transient with rapid onset. Moreover, from the reaction scheme of <xref ref-type="fig" rid="pcbi-1002569-g001">Fig. 1b</xref> the amplitude of this transient depends also on the baseline concentration <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e055" xlink:type="simple"/></inline-formula> of the optical probe at each location <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e056" xlink:type="simple"/></inline-formula>.</p>
          <p>This baseline probe molecule concentration typically varies across the cell and is difficult to control <italic>a priori</italic>. For instance, probe molecule concentrations are typically higher in the apical dendrite and near the soma, resulting in the higher luminosity of these regions. This variation may be due to nonuniform concentration of basal calcium across the cell. Also contributing may be limitations of the experimental setup, such as non-uniform laser illumination across the microscope's field of view or non-uniform volume of fluorophore excitation, due to thin processes that extend beyond the focal volume. Moreover, recording sites are sometimes placed slightly off a dendrite. To account for such variability in baseline fluorescence, we assume that such non-uniformities are primarily due to the experimental limitations which affect the number of probe molecules being excited. As a result, and based on the dynamics of calcium binding, we expect that during fast transients <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e057" xlink:type="simple"/></inline-formula>, where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e058" xlink:type="simple"/></inline-formula> is the binding rate of our optical probe. Implicit in this relation is the assumption that the concentration of probe molecules is away from saturation, and that the fast calcium transient is mainly due to the bAP. Therefore, Eq. (2) can be rewritten as<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e059" xlink:type="simple"/><label>(3)</label></disp-formula>where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e060" xlink:type="simple"/></inline-formula> represents (up to a multiplicative constant) the amplitude of the calcium transient at location <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e061" xlink:type="simple"/></inline-formula> and time <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e062" xlink:type="simple"/></inline-formula>.</p>
          <p>Based on the above discussion, we make an important conclusion: The <italic>relative</italic> change in bound probe molecules is reflective of the transients in calcium concentration. Hence, by Eq. (1), we need to estimate <italic>relative</italic> changes in light intensity at a given location, as a proxy for transients in calcium concentration. Dividing Eq. (3) by <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e063" xlink:type="simple"/></inline-formula> we get<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e064" xlink:type="simple"/><label>(4)</label></disp-formula>where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e065" xlink:type="simple"/></inline-formula>. As discussed above <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e066" xlink:type="simple"/></inline-formula> cannot be easily estimated. However, from our measurements we have access to <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e067" xlink:type="simple"/></inline-formula>. To be able to compare the calcium concentration at different locations of the tree, we need that approximately <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e068" xlink:type="simple"/></inline-formula> for all the locations in the tree. This assumption is expected to hold if <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e069" xlink:type="simple"/></inline-formula> for all locations, which is expected since the autofluorescence signal is in general weak for high affinity calcium indicators. Therefore from now on we assume that the relative change in bound probe molecules <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e070" xlink:type="simple"/></inline-formula> is approximately proportional to the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e071" xlink:type="simple"/></inline-formula>-transformed emitted light intensity, with a constant of proportionality that is the same across the tree:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e072" xlink:type="simple"/><label>(5)</label></disp-formula>Note that this resulting <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e073" xlink:type="simple"/></inline-formula> transformation is a standard heuristic used in the analysis of fluorescent recordings <xref ref-type="bibr" rid="pcbi.1002569-Markram1">[9]</xref>, <xref ref-type="bibr" rid="pcbi.1002569-Magee1">[8]</xref>.</p>
        </sec>
        <sec id="s2b3">
          <title>The recorded signal</title>
          <p>The signal, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e074" xlink:type="simple"/></inline-formula>, is weak, and is measured using photomultiplier tubes (PMTs), sensitive light detectors which contain several amplifying stages. Briefly, an electron entering one stage will produce a random number of outgoing electrons. If <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e075" xlink:type="simple"/></inline-formula> is the number of incoming electrons at a stage, the number of outgoing electrons, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e076" xlink:type="simple"/></inline-formula>, is random. The mean of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e077" xlink:type="simple"/></inline-formula> is the gain of the stage. For instance, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e078" xlink:type="simple"/></inline-formula> could be a sum of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e079" xlink:type="simple"/></inline-formula> numbers drawn independently from a Poisson distribution with mean <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e080" xlink:type="simple"/></inline-formula> <xref ref-type="bibr" rid="pcbi.1002569-Tan1">[13]</xref>. The output of an eight stage PMT is then an eight-fold composition of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e081" xlink:type="simple"/></inline-formula> with itself. The noise in the output of the PMT can therefore be highly non-Gaussian, with a distribution that is determined by the strength of the signal <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e082" xlink:type="simple"/></inline-formula>. In particular, at lower light levels <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e083" xlink:type="simple"/></inline-formula> approximately follows an exponential distribution (data not shown). At higher light levels, the distribution is approximately Gaussian <xref ref-type="bibr" rid="pcbi.1002569-Esposti1">[14]</xref>, <xref ref-type="bibr" rid="pcbi.1002569-Tan1">[13]</xref>. The photomultiplier statistics can be fit with a gamma distribution with activity dependent parameters:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e084" xlink:type="simple"/><label>(6)</label></disp-formula>When we fit our data to this model we obtained <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e085" xlink:type="simple"/></inline-formula> (data not shown). Note however that the signal of interest is not <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e086" xlink:type="simple"/></inline-formula> itself but its relative change (see Eq. (5)). If <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e087" xlink:type="simple"/></inline-formula> is known, then the scaled random variable <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e088" xlink:type="simple"/></inline-formula> is distributed according to <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e089" xlink:type="simple"/></inline-formula>. In that case the variance of the relative change in light intensity remains approximately constant with small changes in <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e090" xlink:type="simple"/></inline-formula> relative to <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e091" xlink:type="simple"/></inline-formula>. The skewness and kurtosis of the distribution are given by <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e092" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e093" xlink:type="simple"/></inline-formula> respectively. As <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e094" xlink:type="simple"/></inline-formula> becomes large, they become very small and the resulting distribution is approximately Gaussian <xref ref-type="bibr" rid="pcbi.1002569-Papoulis1">[15]</xref>. This happens at locations with moderate or high baseline activity. As a result we first assume that the signal is sufficiently strong and the noise is Gaussian, so that <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e095" xlink:type="simple"/></inline-formula> for a Gaussian random variable <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e096" xlink:type="simple"/></inline-formula>. We relax this assumption subsequently. However, we always assume that the expected value of the measured voltage is proportional to the true light intensity <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e097" xlink:type="simple"/></inline-formula>.</p>
        </sec>
        <sec id="s2b4">
          <title>A general statistical model for the spatiotemporal calcium signal</title>
          <p>Using Eq. (4) for the dynamics of relative bound probe molecules in the presence of incoming calcium spikes, we have that<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e098" xlink:type="simple"/><label>(7)</label></disp-formula>where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e099" xlink:type="simple"/></inline-formula> denotes the Heaviside function and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e100" xlink:type="simple"/></inline-formula> denotes the number of spikes. If the time at which a bAP is initiated is known, then the only parameters that need to be estimated are the amplitudes <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e101" xlink:type="simple"/></inline-formula>. We can assume that a bAP propagates through the tree instantaneously, so that <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e102" xlink:type="simple"/></inline-formula> for all locations. Under this assumption amplitudes can be easily estimated using maximum likelihood techniques, with the added constraints that the inferred amplitudes are nonnegative. We will fully describe these techniques in a more general setup below.</p>
          <p>More generally, the timing of the APs may not be known or not the same for all the locations in the tree and must be inferred from the bound probe molecule trace. This is a challenging problem in itself <xref ref-type="bibr" rid="pcbi.1002569-Vogelstein2">[6]</xref>. Moreover, the above approach neglects spatial correlations caused from the backpropapation and possible calcium diffusion mechanisms. As a result, the calcium profile at each location is treated independently and cannot be used to make predictions for neighboring, possibly non-imaged locations. Instead of analyzing the recorded signals from each location separately we would like to take advantage of the fact that the recording from one location may provide information about the signal at neighboring locations. We next describe a statistical approach that allows us to perform spatial and temporal smoothing concurrently.</p>
          <p>To address the issue of spatial correlations, we model the relative concentration of bound probe molecules at location <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e103" xlink:type="simple"/></inline-formula> of the dendritic tree at time <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e104" xlink:type="simple"/></inline-formula> as a linear combination of spatial functions whose weights are allowed to change with time,<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e105" xlink:type="simple"/><label>(8)</label></disp-formula>The spatial functions <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e106" xlink:type="simple"/></inline-formula> are bump functions which are smooth, nonnegative and local (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e107" xlink:type="simple"/></inline-formula> for <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e108" xlink:type="simple"/></inline-formula> further than some distance from the “center point” <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e109" xlink:type="simple"/></inline-formula> of the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e110" xlink:type="simple"/></inline-formula>-th bump). These functions serve to spatially smooth the inferred signal, since <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e111" xlink:type="simple"/></inline-formula> cannot vary more quickly in space than <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e112" xlink:type="simple"/></inline-formula>; by changing the number of bumps <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e113" xlink:type="simple"/></inline-formula> and their smoothness we can modify the overall spatial smoothness of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e114" xlink:type="simple"/></inline-formula>. There are a number of possible interpolation approaches, and we chose to use B-splines <xref ref-type="bibr" rid="pcbi.1002569-DeBoor1">[16]</xref>. Other choices include gaussian bumps or diffusion kernels <xref ref-type="bibr" rid="pcbi.1002569-Kondor1">[17]</xref> that preserve continuous differentiability at the tree branch points. However, the exact choice of basis functions did not considerably affect our results, as long as these functions are smooth and are placed approximately uniformly along the tree.</p>
          <p>As the spline basis functions are typically defined on a line, here we use a suitable generalization to trees. Splines are defined on subdomains of the tree defined by the cell shape. This tree therefore needs to be partitioned. We chose to define the partition using the topological distance from the soma, i.e., the distance from the soma along the tree. Thus all points that lie within a given distance from the center of a spline function belong to the same subdomain. Picking this distance is important because a very large/small value can lead to significant under/over-fitting of the data. In the Results section where we apply our algorithm to experimental data, we propose a data-driven method for determining this parameter.</p>
          <p>We discretize the cell into <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e115" xlink:type="simple"/></inline-formula> compartments so that the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e116" xlink:type="simple"/></inline-formula>-dimensional state vector of normalized bound probe molecule concentration at each location on the cell can be written in matrix-vector form as<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e117" xlink:type="simple"/><label>(9)</label></disp-formula>where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e118" xlink:type="simple"/></inline-formula> is an <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e119" xlink:type="simple"/></inline-formula> matrix whose <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e120" xlink:type="simple"/></inline-formula>-th column is a vector obtained from the spatial discretization of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e121" xlink:type="simple"/></inline-formula>, and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e122" xlink:type="simple"/></inline-formula> is the column vector of the activation variables at time <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e123" xlink:type="simple"/></inline-formula>, and has length <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e124" xlink:type="simple"/></inline-formula>.</p>
          <p>We assume the same temporal dynamics as in Eq. (2), but now for the weight variables <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e125" xlink:type="simple"/></inline-formula>, which are assumed to evolve according to<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e126" xlink:type="simple"/><label>(10)</label></disp-formula>Because of linearity, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e127" xlink:type="simple"/></inline-formula> has the same interpretation as the time constant that determines the rate at which probe fluorescence molecules unbind from calcium, and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e128" xlink:type="simple"/></inline-formula> have similar interpretations as before. After discretizing time, and introducing <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e129" xlink:type="simple"/></inline-formula>, Eq. (10) can be approximated by<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e130" xlink:type="simple"/><label>(11)</label></disp-formula>In this discretized representation <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e131" xlink:type="simple"/></inline-formula> when <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e132" xlink:type="simple"/></inline-formula>, and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e133" xlink:type="simple"/></inline-formula> otherwise. In the general case, where the timing of the spikes is unknown, we replace the product of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e134" xlink:type="simple"/></inline-formula> with a nonnegative random variable <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e135" xlink:type="simple"/></inline-formula>.<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e136" xlink:type="simple"/><label>(12)</label></disp-formula>This model is a spatiotemporal generalization of that discussed in <xref ref-type="bibr" rid="pcbi.1002569-Vogelstein2">[6]</xref>.</p>
          <p>There are two essential differences between the model described here by Eqs. (8)–(12) and the motivating model described in Eq. (7): estimation of spike times, and incorporation of spatial correlations. In the present model the input, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e137" xlink:type="simple"/></inline-formula>, is <italic>not</italic> assumed to be a sum of delta functions with unknown weights occurring at known times. Moreover, as we will see below, the inference will be done at once for the whole tree and <italic>not</italic> individually and independently for each location. Thus, this statistical approach is more general since the algorithm is capable of finding spike times, and more biologically accurate, since it allows for spatial correlations for nearby compartments.</p>
          <p>We use a Bayesian approach, and start by specifying a prior distribution on <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e138" xlink:type="simple"/></inline-formula>, and hence construct a prior distribution on the hidden weights <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e139" xlink:type="simple"/></inline-formula> (and consequently on <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e140" xlink:type="simple"/></inline-formula>(t)). For example, if we know that calcium influx is small at certain times <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e141" xlink:type="simple"/></inline-formula> or at certain locations <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e142" xlink:type="simple"/></inline-formula>, then we can choose the prior variance and mean of the corresponding <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e143" xlink:type="simple"/></inline-formula> to be small. Local correlations in <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e144" xlink:type="simple"/></inline-formula> may also be incorporated to increase the smoothness of the state vector <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e145" xlink:type="simple"/></inline-formula>. The prior on <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e146" xlink:type="simple"/></inline-formula> can also be interpreted as an autoregressive prior on <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e147" xlink:type="simple"/></inline-formula> which serves to temporally smooth the inferred signal, on a scale set by the time constant <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e148" xlink:type="simple"/></inline-formula>. This time constant <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e149" xlink:type="simple"/></inline-formula> could also depend on the spatial variable <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e150" xlink:type="simple"/></inline-formula> (modeling different <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e151" xlink:type="simple"/></inline-formula> buffer constants at different locations in the tree) without significantly changing the presentation below.</p>
          <p>Now taking into account the dynamics of probe molecules (see Eqs. (1),(4) and (5)), the emitted light intensity can be written as<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e152" xlink:type="simple"/><label>(13)</label></disp-formula>where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e153" xlink:type="simple"/></inline-formula> is a diagonal matrix where the non-zero entries denote the probe molecule baseline concentration, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e154" xlink:type="simple"/></inline-formula> is a column vector of ones with length <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e155" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e156" xlink:type="simple"/></inline-formula> is a scalar constant, related to the proportionality constant in Eq. (5), and is assumed to be constant throughout the tree. Note that our signal of interest <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e157" xlink:type="simple"/></inline-formula> and the emitted light intensity <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e158" xlink:type="simple"/></inline-formula> are related through an affine transformation.</p>
          <p>We have access to <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e159" xlink:type="simple"/></inline-formula> through spatially localized noisy measurements. In each measurement, we image a single compartment of the tree and at each time <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e160" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e161" xlink:type="simple"/></inline-formula> such measurements are performed. Let <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e162" xlink:type="simple"/></inline-formula> be a <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e163" xlink:type="simple"/></inline-formula> matrix where each row has one entry equal to one, corresponding to the compartment being imaged, and the rest equal to zero. Assuming additive noise, the measurements can be expressed as<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e164" xlink:type="simple"/><label>(14)</label></disp-formula>The noise <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e165" xlink:type="simple"/></inline-formula> is assumed to be spatiotemporally uncorrelated, although this could be generalized to the case that the covariance matrix of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e166" xlink:type="simple"/></inline-formula> has a local structure. Note that <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e167" xlink:type="simple"/></inline-formula>, the number of measurements per time step, can easily change with time. The matrix <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e168" xlink:type="simple"/></inline-formula> can represent more general linear measurements. Initially we assume noise is additive for notational simplicity. We show below that more general forms of noise can be modeled within this framework.</p>
          <p>After discretizing time, Eqs. (8) and Eq. (14), correspond to the state-space model<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e169" xlink:type="simple"/><label>(15)</label></disp-formula>where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e170" xlink:type="simple"/></inline-formula> and we abbreviated <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e171" xlink:type="simple"/></inline-formula> (with dimensions <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e172" xlink:type="simple"/></inline-formula>) and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e173" xlink:type="simple"/></inline-formula>. This completes the specification of the model.</p>
          <p>We emphasize again that Eq. (14) provides a biophysically inspired statistical model. As earlier, we aim to approximate a signal proportional to the bound calcium concentration across the dendritic tree. Note that certain parameters in the model such as the time constant <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e174" xlink:type="simple"/></inline-formula> do have direct physical interpretations</p>
        </sec>
        <sec id="s2b5">
          <title>Computing and optimizing the log-posterior</title>
          <p>We would like to compute the maximum a-posteriori (MAP) estimate of the relative spatiotemporal concentration of calcium-bound probe molecules <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e175" xlink:type="simple"/></inline-formula>, given the sequence of observations <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e176" xlink:type="simple"/></inline-formula>. Here <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e177" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e178" xlink:type="simple"/></inline-formula> denote the vectors with the underlying calcium concentrations and measured light intensity at all times, and have lengths <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e179" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e180" xlink:type="simple"/></inline-formula> respectively. From Eq. (9) it follows that<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e181" xlink:type="simple"/></disp-formula>Thus we will focus on finding the MAP estimate of the activation profile <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e182" xlink:type="simple"/></inline-formula>, where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e183" xlink:type="simple"/></inline-formula> is a vector of length <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e184" xlink:type="simple"/></inline-formula> defined similarly to <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e185" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e186" xlink:type="simple"/></inline-formula>. Using Bayes rule and the state-space nature of the model we can compute the log-posterior directly <xref ref-type="bibr" rid="pcbi.1002569-Fahrmeir1">[18]</xref>, <xref ref-type="bibr" rid="pcbi.1002569-Durbin1">[19]</xref>:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e187" xlink:type="simple"/><label>(16)</label></disp-formula>where the constant does not depend on the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e188" xlink:type="simple"/></inline-formula> and thus can be ignored. The log-posterior <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e189" xlink:type="simple"/></inline-formula>, can be maximized efficiently if this function is concave in <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e190" xlink:type="simple"/></inline-formula>. Since <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e191" xlink:type="simple"/></inline-formula> is a sum of terms of the form <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e192" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e193" xlink:type="simple"/></inline-formula>, it is sufficient that these observation and transition densities be log-concave, i.e., that <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e194" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e195" xlink:type="simple"/></inline-formula> be concave in <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e196" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e197" xlink:type="simple"/></inline-formula> respectively. This means that other log-concave noise distributions can be used in our framework, not just additive Gaussian noise.</p>
          <p>Additionally, since the calcium concentration is nonnegative, we have to ensure that all the activation variables, as well as the bumps <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e198" xlink:type="simple"/></inline-formula> are nonnegative. These additional constraints can be expressed <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e199" xlink:type="simple"/></inline-formula>, where the inequalities are in vector form, i.e., they have to hold for all the entries. Therefore our optimization problem can be written as<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e200" xlink:type="simple"/><label>(17)</label></disp-formula></p>
          <p>In the Supporting Information we describe the technical details of a fast method for the solution of Eq. (17). Briefly, we construct a log-barrier method for the incorporation of the non-negativity constraints <xref ref-type="bibr" rid="pcbi.1002569-Boyd1">[20]</xref>. In general, barrier methods are iterative procedures that converge within only a few iterations, but at cost per iteration <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e201" xlink:type="simple"/></inline-formula> in time and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e202" xlink:type="simple"/></inline-formula> memory requirement. The so called “big O” notation for the time cost <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e203" xlink:type="simple"/></inline-formula> is used to denote that every iteration requires a number of operations that scales linearly with the length of the experiment <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e204" xlink:type="simple"/></inline-formula> and cubically with the size of the imaged tree <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e205" xlink:type="simple"/></inline-formula>. We see that for large trees this cost can be prohibitive. However, by exploiting the tree-structure and the spatially localized nature of the measurements, we show that the cost per iteration can be dropped to <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e206" xlink:type="simple"/></inline-formula> in terms of both time and space, making our method applicable to arbitrary large dendritic trees. Details can be found in the Supporting Information.</p>
        </sec>
      </sec>
      <sec id="s2c">
        <title>A particular example</title>
        <p>We discuss a particular example of choices for the prior and noise likelihoods that are realistic and also ensure log-concavity. As a first example, we consider the case where the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e207" xlink:type="simple"/></inline-formula>-normalized measurements <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e208" xlink:type="simple"/></inline-formula> follow a Gaussian distribution with variance <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e209" xlink:type="simple"/></inline-formula>. The simulated calcium bumps have deterministic fixed amplitude <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e210" xlink:type="simple"/></inline-formula>. We have<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e211" xlink:type="simple"/><label>(18)</label></disp-formula>with <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e212" xlink:type="simple"/></inline-formula>, the measurement matrix at all times. The imaging locations at each time can change.</p>
        <p>The prior on <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e213" xlink:type="simple"/></inline-formula> depends on the temporal statistics of calcium activation and its amplitude at different locations of the dendritic tree. For simplicity, the hidden state bumps are assumed to be independent in time and space. Note that this assumption of independence applies to the hidden states. The inferred concentrations of bound calcium are obtained from the hidden states by interpolation using splines. As a result, the concentrations at neighboring compartments on the tree will be significantly correlated. The extent of these correlations is determined by the structure of the splines used in the interpolation. Nevertheless, the assumption of independence is a simplification, since a bAP is expected to increase the intracellular calcium concentration throughout the tree at approximately the same time. However, this assumption allows for a fast implementation of our algorithm, and in practice does not affect its performance.</p>
        <p>A reasonable intuitive choice for the bump prior would be a marked point process <xref ref-type="bibr" rid="pcbi.1002569-Last1">[21]</xref>, i.e., a sequence of pairs of spike times and amplitudes. However, since the latter is not in general log-concave, we can approximate it (as in <xref ref-type="bibr" rid="pcbi.1002569-Vogelstein2">[6]</xref> for the case of a Poisson process) with an exponential distribution with a desirable rate. The exponential distribution corresponds to a sparse, nonnegative prior, that also retains the desired property of log-concavity. The prior <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e214" xlink:type="simple"/></inline-formula> has the initial value <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e215" xlink:type="simple"/></inline-formula> chosen to be an exponential with parameter <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e216" xlink:type="simple"/></inline-formula>. For the state transitions, we let the differences <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e217" xlink:type="simple"/></inline-formula> follow an exponential distribution with mean <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e218" xlink:type="simple"/></inline-formula>, where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e219" xlink:type="simple"/></inline-formula> is the amplitude of the bump (assumed constant here), <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e220" xlink:type="simple"/></inline-formula> is the time discretization step <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e221" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e222" xlink:type="simple"/></inline-formula> is a vector that depends on the possibly time-varying, rate. Therefore,<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e223" xlink:type="simple"/><label>(19)</label></disp-formula>where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e224" xlink:type="simple"/></inline-formula> denotes the product of all the entries of the vector <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e225" xlink:type="simple"/></inline-formula>, and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e226" xlink:type="simple"/></inline-formula>, denotes the vector obtained by inverting each entry of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e227" xlink:type="simple"/></inline-formula>. Taking the logarithm and removing the additive terms that do not depend on <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e228" xlink:type="simple"/></inline-formula> we get,<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e229" xlink:type="simple"/><label>(20)</label></disp-formula>with <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e230" xlink:type="simple"/></inline-formula>, and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e231" xlink:type="simple"/></inline-formula> is an appropriate matrix such that <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e232" xlink:type="simple"/></inline-formula>.</p>
        <p>Putting everything together we seek the MAP estimate<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e233" xlink:type="simple"/><label>(21)</label></disp-formula>We can find this estimate efficiently using the method described in the Supporting Information. Note that the total number of parameters to be estimated is <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e234" xlink:type="simple"/></inline-formula>, where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e235" xlink:type="simple"/></inline-formula> is the number of hidden weights <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e236" xlink:type="simple"/></inline-formula>, and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e237" xlink:type="simple"/></inline-formula> is the number of timesteps.</p>
      </sec>
    </sec>
    <sec id="s3">
      <title>Results</title>
      <p>We demonstrate our approach using data generated by numerically simulating calcium transients on a dendritic tree, and then continue with the analysis of experimental data.</p>
      <sec id="s3a">
        <title>Application to simulated data on a real dendritic tree</title>
        <p>We apply the developed methodology on a reconstructed dendritic tree from a rat CA1 pyramidal cell. The tree was discretized in <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e238" xlink:type="simple"/></inline-formula> compartments and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e239" xlink:type="simple"/></inline-formula> hidden variables and spline functions were used to fit its dynamics. We simulated a series of three bAPs that propagate instantaneously and unselectively throughout the tree with amplitude that decreases exponentially with distance from soma. The prior on the amplitude of the hidden states due to the bAP was estimated from the transient pattern induced from the bAP, with methods that are explained below. We assumed that the calcium-bound probe molecule concentration relaxes with a single time constant that is estimated from the data and that the noise likelihood is known. For the noise likelihood we used a gamma distribution with parameters that depended on the true underlying value according to the statistics of the PMT used in the experiment (see Eq. (6)). At every time step 200 randomly chosen points are measured.</p>
        <p><xref ref-type="fig" rid="pcbi-1002569-g002">Fig. 2</xref> shows the true bound probe-molecules profile, the observed measurements, the inferred weights and transients, and the resulting estimated profile and error <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e240" xlink:type="simple"/></inline-formula>. The algorithm correctly predicts the timing of the bAPs and estimates the true bound probe molecules concentration. <xref ref-type="fig" rid="pcbi-1002569-g003">Fig. 3</xref> shows the amplitude of the second transient, the measurements right after the spike occurrence, the estimated transients and error. As discussed earlier, these transients estimate up to an affine transformation the underlying calcium transients. A close inspection reveals that in certain cases the algorithm underestimates the transient amplitude. The reason for this is that our algorithm acts as a shrinkage estimator due to the exponential prior <xref ref-type="bibr" rid="pcbi.1002569-Copas1">[22]</xref>. The prior in our analysis is included to provide more robust estimates in the presence of high noise. Because of the bias-variance tradeoff <xref ref-type="bibr" rid="pcbi.1002569-Geman1">[23]</xref> a robust estimator (i.e., with low variance) can be biased in the presence of high noise, as is in our case. If no prior is incorporated, then our estimate can in principle be unbiased (e.g., the least squares estimator in the presence of Gaussian noise), but it would also have a large variance (data not shown). This leads to over-fitting and is undesirable since the same underlying calcium concentration can lead to very different estimates, due to different noise realizations.</p>
        <fig id="pcbi-1002569-g002" position="float">
          <object-id pub-id-type="doi">10.1371/journal.pcbi.1002569.g002</object-id>
          <label>Figure 2</label>
          <caption>
            <title>True and estimated probe molecule concentration and inferred transients.</title>
            <p>A: True calcium traces of a simulated experiment. Three bAPs were simulated at timesteps 20, 50 and 66. B: Measurement locations and values at each timestep. The dark pixels correspond to locations that were not measured at the specific timestep. C: Inferred weights of the hidden states <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e241" xlink:type="simple"/></inline-formula> (top) D: Inferred transients of the hidden states <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e242" xlink:type="simple"/></inline-formula> (bottom). E: Estimated calcium traces for all compartments. F: Error between estimated and true profile <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e243" xlink:type="simple"/></inline-formula>. The algorithm correctly infers the timing of the bAPs and estimates their amplitude (see also <xref ref-type="fig" rid="pcbi-1002569-g003">Fig. 3</xref>). The colorbars in the panels A and E are the same.</p>
          </caption>
          <graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002569.g002" xlink:type="simple"/>
        </fig>
        <fig id="pcbi-1002569-g003" position="float">
          <object-id pub-id-type="doi">10.1371/journal.pcbi.1002569.g003</object-id>
          <label>Figure 3</label>
          <caption>
            <title>True and estimated amplitude of the second transient along the tree.</title>
            <p>Estimated transient due to the second bAP in the simulated experiment. A: True bound probe molecule transients. The transient occurs in the whole tree with an amplitude that decreases with the distance from the soma. B: Noisy measurements and their locations at the time of the bAP. C: Estimated transients. D: Ampltiude error (true - estimated). The amplitude is mostly underestimated due to the bias-variance trade-off. The colorbars for the first and third columns are the same.</p>
          </caption>
          <graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002569.g003" xlink:type="simple"/>
        </fig>
        <p>Sample code to generate <xref ref-type="fig" rid="pcbi-1002569-g002">Figs. 2</xref> and <xref ref-type="fig" rid="pcbi-1002569-g003">3</xref> as well as a movie that shows the spatiotemporal profile of the calcium in the tree can be found at <ext-link ext-link-type="uri" xlink:href="http://www.stat.columbia.edu/~eftychios/Home/Calcium_Smoothing.html" xlink:type="simple">http://www.stat.columbia.edu/~eftychios/Home/Calcium_Smoothing.html</ext-link></p>
        <p>We also tested the effect of the minimum topological distance between imaged positions. We used the same setup as above, but imaged the signal at 100 locations at every time step. Additionally, at each repetition we imposed a minimal topological distance between the imaged locations. Since the units are arbitrary here the exact results are not reported. However, for small values of the minimal distance the error grows slowly with the minimal separation between the imaged locations. Large errors are observed when the minimal distance between imaged locations becomes comparable or larger than the distance between centers of the interpolating spline functions. In the next section we present an adaptive method of determining the smoothing spline basis based on the locations of the measured locations.</p>
      </sec>
      <sec id="s3b">
        <title>Application to real data</title>
        <p>The algorithm was tested on calcium imaging data from a CA1 pyramidal neuron obtained with a fast three dimensional optical scanner. The details of the scanner are given in <xref ref-type="bibr" rid="pcbi.1002569-Reddy1">[7]</xref>. The reconstructed neuron consisted of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e244" xlink:type="simple"/></inline-formula> compartments. Recordings were made at 97 different locations in 3 different sessions. Every location was imaged at approximately every 0.6 <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e245" xlink:type="simple"/></inline-formula>. For simplicity, the dendrites that did not contain any recording locations were removed from the tree graph (using the TREES toolbox <xref ref-type="bibr" rid="pcbi.1002569-Cuntz1">[24]</xref>) when analyzing the data. The resulting truncated tree and the measurement locations are shown in <xref ref-type="fig" rid="pcbi-1002569-g004">Fig. 4</xref>. The three subtrees A,B,C are shown in panels B,C,D of <xref ref-type="fig" rid="pcbi-1002569-g004">Fig. 4</xref> respectively. Subtree A corresponds to the imaging session on the dendritic tuft of the neuron. Subtree B corresponds to the recording sites in the apical dendrites of the neurons and finally subtree C corresponds to the recording sites in the basal dendrites and around the soma.</p>
        <fig id="pcbi-1002569-g004" position="float">
          <object-id pub-id-type="doi">10.1371/journal.pcbi.1002569.g004</object-id>
          <label>Figure 4</label>
          <caption>
            <title>Tree and measurement locations without the non-imaged dendrites.</title>
            <p>A: Tree projected in the x-y plane and measurement locations. Each compartment is also color-coded according to its distance from the soma. The different colors in the measurement locations correspond to the different imaging sessions. Right: Detailed subtrees in three dimensions for the three different imaging sessions. B: Subtree A, recording locations in the apical tuft. C: Subtree B, recording locations around the apical dendrites. D: Subtree C, recording locations around the soma and basal dendrites. All the units are in <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e246" xlink:type="simple"/></inline-formula>. In all panels the purple electrodes point at the soma.</p>
          </caption>
          <graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002569.g004" xlink:type="simple"/>
        </fig>
        <p>For each pair of imaging data we estimated one set of model parameters, so that the results of the imaging algorithm on the two different protocols could be compared. The measured data was normalized using the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e247" xlink:type="simple"/></inline-formula> transformation (see Eq. (5)) before being analyzed. The data was analyzed with the same set of model parameters for the two different experimental protocols and separately on the three different subtrees obtained from the three different imaging sessions.</p>
        <sec id="s3b1">
          <title>Estimation of the model parameters</title>
          <p>Our model has several parameters that have to be estimated before we apply our smoothing algorithm. These are the baseline probe molecules concentration, the time constant of calcium unbinding and the noise statistics. Below we describe simple heuristic methods to estimate the model parameters. In practice more sophisticated and powerful methods can be developed such as Monte Carlo estimation methods (e.g. via the Expectation Maximization algorithm) <xref ref-type="bibr" rid="pcbi.1002569-Robert1">[25]</xref>. However, we saw that the results of our algorithm are qualitatively robust with respect to the various parameter values. We also discuss how we chose the appropriate spline matrix for each subtree and the prior on the transient amplitudes.</p>
        </sec>
        <sec id="s3b2">
          <title>Baseline probe molecule concentration</title>
          <p>The baseline fluorophore concentration <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e248" xlink:type="simple"/></inline-formula> was estimated by taking the time average of the measurements over the first <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e249" xlink:type="simple"/></inline-formula> on all the imaged locations. This corresponds to the maximum likelihood estimate of the baseline activity both under Gaussian and under gamma measurement noise.</p>
        </sec>
        <sec id="s3b3">
          <title>Time constant estimation</title>
          <p>Next, the decay constant of the recorded signal, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e250" xlink:type="simple"/></inline-formula>, through its discretized version <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e251" xlink:type="simple"/></inline-formula>, was estimated: First the measured calcium traces were passed through a low-pass, moving average filter (with <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e252" xlink:type="simple"/></inline-formula> width) to eliminate the high frequency noise effects (shot noise). After that, the discretized time constant was estimated by fitting a first order autoregressive model to the filtered data which was first normalized to have zero baseline.<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e253" xlink:type="simple"/><label>(22)</label></disp-formula>where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e254" xlink:type="simple"/></inline-formula> is the filtered measured calcium trace, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e255" xlink:type="simple"/></inline-formula> is the baseline concentration at location <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e256" xlink:type="simple"/></inline-formula>, and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e257" xlink:type="simple"/></inline-formula> is the number of recording locations. <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e258" xlink:type="simple"/></inline-formula> was chosen <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e259" xlink:type="simple"/></inline-formula>, i.e., shortly after the last bAP. This estimator gave <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e260" xlink:type="simple"/></inline-formula>, or <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e261" xlink:type="simple"/></inline-formula>. The time constant was estimated separately for each subtree and the estimates were approximately equal.</p>
        </sec>
        <sec id="s3b4">
          <title>Spline matrix and amplitude prior</title>
          <p>The state transition (amplitude) prior was considered to be an exponential distribution, as discussed in the Methods section. There a marked point process with rate <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e262" xlink:type="simple"/></inline-formula>, mean amplitude <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e263" xlink:type="simple"/></inline-formula>, and discretized in time at resolution <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e264" xlink:type="simple"/></inline-formula> can be approximated by a log-concave exponential distribution with parameter <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e265" xlink:type="simple"/></inline-formula>. Therefore we need to determine the amplitude of the hidden states at each location and the rate which is time varying. Note that in general the mean amplitude can be time varying, but we approximate it as constant with time. The B-spline matrix <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e266" xlink:type="simple"/></inline-formula> and the amplitude of the bump were estimated via an alternating procedure as follows: The basis functions were third order polynomials whose centers were placed uniformly on the tree, and the only parameter required for determining the splines was the topological distance (i.e., number of compartments), between two neighboring center points. The choice of this distance is important since a large distance can lead to a less flexible model, whereas a small one can cause over-fitting. We picked the maximum distance that allows the model to fit the estimated amplitude of the calcium bumps. Choosing a smaller distance gives more degrees of freedom to the system and can potentially lead to overfitting. Note that the prior amplitude pertains to the hidden state vectors <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e267" xlink:type="simple"/></inline-formula> and thus cannot be readily estimated from the data. We first obtained a crude estimate of the amplitude of the normalized calcium transient as<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e268" xlink:type="simple"/><label>(23)</label></disp-formula>i.e., the maximum difference after the first bAP, measured in the filtered traces. Then to determine the amplitude for the hidden states <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e269" xlink:type="simple"/></inline-formula> and the B-spline matrix we proceeded as follows: For any topological distance <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e270" xlink:type="simple"/></inline-formula> between two neighboring spline function centers, a different basis matrix <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e271" xlink:type="simple"/></inline-formula> was constructed and the prior amplitude vector <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e272" xlink:type="simple"/></inline-formula> on the state variables <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e273" xlink:type="simple"/></inline-formula> was given by the solution of the quadratic program<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e274" xlink:type="simple"/><label>(24)</label></disp-formula>This provided the non-negative amplitude parameters <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e275" xlink:type="simple"/></inline-formula> of the exponential priors that can best approximate <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e276" xlink:type="simple"/></inline-formula> (the estimated calcium transients) for the given topological distance <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e277" xlink:type="simple"/></inline-formula>. If this approximation had a relative error larger than 0.1, we decreased the topological distance <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e278" xlink:type="simple"/></inline-formula> and repeated the same procedure. The actual used topological distance <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e279" xlink:type="simple"/></inline-formula>, the splines matrix <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e280" xlink:type="simple"/></inline-formula>, and amplitude prior parameters <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e281" xlink:type="simple"/></inline-formula> were picked as<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e282" xlink:type="simple"/><label>(25)</label></disp-formula>i.e., we picked the maximum distance, and hence the smaller number of hidden variables, that allow for a satisfactory interpolation of the estimated calcium transients from the hidden state amplitude prior parameters. The rate <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e283" xlink:type="simple"/></inline-formula> of bumps was time varying and equal for all the states, given by<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e284" xlink:type="simple"/><label>(26)</label></disp-formula>The rate starts with a low value at the first <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e285" xlink:type="simple"/></inline-formula> since we do not expect any spikes there. Then, it is set at the value 10 since we expect 10 bAPs during the one-second excitation window. After that, the rate decays smoothly back to the initial value. As we explain further below, this smooth decay prevents the algorithm from inferring a non-existent spike at <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e286" xlink:type="simple"/></inline-formula> due to the temporal discontinuity of the rate. Note that with this model, the exact spike times are considered unknown and are also to be estimated by the algorithm.</p>
        </sec>
        <sec id="s3b5">
          <title>Noise statistics</title>
          <p>Finally, the noise likelihood at each measurement location was assumed to be independent and Gaussian with zero mean, and variance estimated directly from the measurement traces. To find the noise statistics we subtracted the filtered traces <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e287" xlink:type="simple"/></inline-formula> from the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e288" xlink:type="simple"/></inline-formula>-normalized data and then fitted a Gaussian distribution on the residual. Although this is a simplified approximation, in most of the cases this residual could be fit satisfactorily with a zero mean Gaussian distribution (data not shown).</p>
        </sec>
      </sec>
      <sec id="s3c">
        <title>Spatiotemporal smoothing of calcium-bound probe molecules</title>
        <p><xref ref-type="fig" rid="pcbi-1002569-g005">Fig. 5</xref> shows the measured data, and the inferred traces at all measurement locations, for all three subtrees and the two different experimental protocols. The first column shows the measured raw data. The last two show the data and the inferred traces in the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e289" xlink:type="simple"/></inline-formula> domain, i.e., the input and output of the algorithm. Based on the discussion of the Methods section these inferred traces are an estimate of the calcium bound probe molecules up to an affine transformation, and thus their transients are indicative of the calcium transients. From <xref ref-type="fig" rid="pcbi-1002569-g005">Fig. 5</xref> we see that the algorithm detects the spikes in the window <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e290" xlink:type="simple"/></inline-formula> (visible especially in the last column), and that the calcium concentration in general decays with the distance from the soma (see the color bars in the right column), a fact that has been reported in many studies (see e.g. <xref ref-type="bibr" rid="pcbi.1002569-Stuart1">[26]</xref>, <xref ref-type="bibr" rid="pcbi.1002569-Spruston1">[27]</xref>). In the first column of <xref ref-type="fig" rid="pcbi-1002569-g005">Figs. 5B and 5C</xref> we observe that the measured light intensity in some locations is significantly larger in a few points than the rest. These points lie in the dendritic trunk and also exhibit a larger baseline intensity. However, as seen from the last column, spikes are detected in most of the measurement locations, but not all of them, indicating the selective propagation of the bAPs. The results can best be viewed in video format, where the spatiotemporal probe molecule profile can be examined in the whole tree, and not just in the recording sites. Such movies can be found online at <ext-link ext-link-type="uri" xlink:href="http://www.stat.columbia.edu/~eftychios/Home/Calcium_Smoothing.html" xlink:type="simple">http://www.stat.columbia.edu/~eftychios/Home/Calcium_Smoothing.html</ext-link>.</p>
        <fig id="pcbi-1002569-g005" position="float">
          <object-id pub-id-type="doi">10.1371/journal.pcbi.1002569.g005</object-id>
          <label>Figure 5</label>
          <caption>
            <title>Observed and smoothed data at all the imaged locations for both experimental protocols.</title>
            <p>For each subfigure: First column: Raw data <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e291" xlink:type="simple"/></inline-formula> (unnormalized). Second column: Raw data <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e292" xlink:type="simple"/></inline-formula> normalized <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e293" xlink:type="simple"/></inline-formula>. Third column: Smoothed data at measurement locations <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e294" xlink:type="simple"/></inline-formula>, estimate of the relative concentration of calcium-bound probe molecules. Top row: 10 bAP protocol. Ten spikes were applied at the neuron soma at times <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e295" xlink:type="simple"/></inline-formula>. Bottom row: 10 bAP+3 EPSP protocol. 3 additional EPSPs were applied at times <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e296" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e297" xlink:type="simple"/></inline-formula>. A: Subtree A (tuft), B: Subtree B (apical dendrites), C: Subtree C (soma and basal dendrites). The algorithm smooths the data and provides an estimate of the underlying calcium concentration. Only the imaged locations are shown for comparison purposes. The inferred spikes are visible from the discontinuities in the third column. Spikes are not inferred in all locations indicating the selective propagation of calcium in the tree.</p>
          </caption>
          <graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002569.g005" xlink:type="simple"/>
        </fig>
        <p>The first row (A) of <xref ref-type="fig" rid="pcbi-1002569-g006">Fig. 6</xref> shows the detailed trace of the normalized measurements and inferred normalized concentrations for one point in subtree B (marked with a blue electrode in <xref ref-type="fig" rid="pcbi-1002569-g006">Fig. 6C</xref>), for the full length of the experiment. Panels B,C and D show the normalized measurements and inferred traces at one location of the subtrees A,B and C respectively for the first 2 seconds of the experiment. These points are highlighted with a blue electrode in the second and fourth columns. The 1st column is for the “10 bAP protocol” and the 3rd for the “bAP+EPSP protocol”. The red dashed lines mark the timing of the stimulation that invoked the action potentials. Apart from the significant denoising, the algorithm predicts the timing of the bAPs and provides an estimate for the amplitude of the transient due to the bAP, relative to the baseline concentration at this location.</p>
        <fig id="pcbi-1002569-g006" position="float">
          <object-id pub-id-type="doi">10.1371/journal.pcbi.1002569.g006</object-id>
          <label>Figure 6</label>
          <caption>
            <title>Detailed probe molecule traces and inferred transients.</title>
            <p>Detailed probe molecule traces for one location of each subtree (marked with the blue electrodes on the right columns) and profile of the amplitude of the last transient inferred in the whole subtree. A: Detailed measured and inferred trace for the whole length of the experiment at the marked location of subtree B. At each of the other rows: Detailed measured data and smoothed traces (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e298" xlink:type="simple"/></inline-formula> normalized) for two different locations (top and bottom row. The red dashed-lines correspond to the timing of the bAPs. The algorithm reduces noise considerably, accurately infers the timing of the bAPs and provides an estimate of their amplitude. The second and fourth columns provide an estimate of the amplitude of the last transient. Left: 10 bAP protocol. Right: 10 bAP+3 EPSP protocol. B: Subtree A (tuft), C: Subtree B (apical dendrites), D: Subtree C (soma and basal dendrites). The effect of the EPSP pairing is apparent in the distal dendrites (subtree C, second column), where the inferred amplitude is considerably higher that in the plain 10 bAP protocol.</p>
          </caption>
          <graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002569.g006" xlink:type="simple"/>
        </fig>
        <p>In some cases, there are also a few spikes detected outside the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e299" xlink:type="simple"/></inline-formula> excitation window. The main reason for this is the data is non stationary. The baseline concentration is different before and after the excitation, with the latter being usually higher. This can also be seen in <xref ref-type="fig" rid="pcbi-1002569-g006">Fig. 6A</xref> that shows the measured and inferred traces over the whole course of the experiment. However, in our algorithm, the baseline activity is kept constant, and is estimated as the mean measured value at the first <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e300" xlink:type="simple"/></inline-formula>. As a result, after the end of the excitation window the inferred trace tends to relax to a lower value than the one suggested by the data. This is prevented by the inferred spikes outside the excitation window. Note that sometimes these spikes, although not experimentally caused, are also suggested by the data. However, these spikes have always small amplitude and are spatially isolated in the sense that they are not inferred at multiple locations in the tree at similar times (as can be seen in the movies online). Consequently, they can be easily classified as “artificial” during post-processing of the data.</p>
        <p>A possible solution to prevent such spikes would be to set the spike rate outside the excitation window to a very low value. However this led to overfitting in the amplitude of the spikes in the interval <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e301" xlink:type="simple"/></inline-formula>. More specifically, if outside spikes are prohibited then the last spike at <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e302" xlink:type="simple"/></inline-formula> will be overestimated, so that the inferred trace did not relax to the actual baseline value of the model until the end of the experiment. Our method allows (possibly spurious) spikes at other times as well, but is robust to the length of the experiment in the sense that the amplitude of the transients remained approximately constant, independent of the length of the imaging data that was analyzed. Another possible approach would be to model the baseline as a slow time varying hidden variable and infer it together with the vector of the hidden states <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e303" xlink:type="simple"/></inline-formula>. However, this would significantly complicate our model, since the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e304" xlink:type="simple"/></inline-formula> transformation would no longer be readily applicable.</p>
        <p>From <xref ref-type="fig" rid="pcbi-1002569-g006">Fig. 6</xref> we also see that the amplitude of the last transient in the bAP+EPSP protocol is larger than the corresponding one for the bAP protocol, especially in the locations away from the soma in the tuft (<xref ref-type="fig" rid="pcbi-1002569-g006">Fig. 6B</xref>). This is further investigated in the second and fourth columns where the amplitude of the last transient is plotted in the whole subtree for all subtrees and both experimental protocols. This amplitude was computed by subtracting the inferred calcium signal just before the last spike from the inferred calcium signal <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e305" xlink:type="simple"/></inline-formula> after the last spike. From these two columns of <xref ref-type="fig" rid="pcbi-1002569-g006">Fig. 6</xref> we see that for the subtrees B and C, the amplitude of the last transient is larger in the bAP+EPSP protocol than the control case (bAP only). This supports the hypothesis that calcium plays an important role in the interplay between backpropagating action potentials (bAPs) and excitatory post-synaptic potentials (EPSPs) that mediate synaptic strength changes.</p>
        <p>As an additional test of the robustness of our results we examined how removing measurements from selected locations affects the inferred traces. In <xref ref-type="fig" rid="pcbi-1002569-g007">Fig. 7</xref> we show the results for subtree A under the bAP protocol, when omitting data from 3 measurement locations. These locations are indicated with the colored electrodes in <xref ref-type="fig" rid="pcbi-1002569-g007">Fig. 7A</xref> and the inferred traces at these locations are plotted with the same colors in <xref ref-type="fig" rid="pcbi-1002569-g007">Fig. 7B–D</xref> respectively. For comparison purposes we also plot with blue the inferred traces when all the data was considered from the algorithm.</p>
        <fig id="pcbi-1002569-g007" position="float">
          <object-id pub-id-type="doi">10.1371/journal.pcbi.1002569.g007</object-id>
          <label>Figure 7</label>
          <caption>
            <title>Cross-validation by leaving out locations.</title>
            <p>A: Locations of the omitted imaged sites and relative error between “full” and “cross-validated” results along the tree. B–D: Comparison of the “full” traces (blue) with the cross-validated traces at the omitted locations. The colors of the “cross-validated” traces are in correspondence with the colors of the fictional electrodes in panel A. The algorithm can predict the traces at left out imaging sites that are located in the middle of dendritic branches by interpolating the results from neighboring measured locations. However the traces of omitted compartments located at the end of branches cannot be inferred.</p>
          </caption>
          <graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002569.g007" xlink:type="simple"/>
        </fig>
        <p>The results shown in <xref ref-type="fig" rid="pcbi-1002569-g007">Fig. 7</xref> are intuitive: When the measurement sites that are left out are located at points that fall between locations from which measurements are available (red and green electrodes, <xref ref-type="fig" rid="pcbi-1002569-g007">Fig. 7B–C</xref>), the algorithm can approximate the bound probe molecule traces. The prior we used causes the newly inferred traces to have generally smaller amplitude. The event times are again inferred and are in good alignment with the event times inferred when all of the data is used. However, when we try to infer traces at the endpoints of dendritic branches (<xref ref-type="fig" rid="pcbi-1002569-g007">Fig. 7D</xref>) and/or at locations far from those at which measurements are available, the inferred traces are shrunk to zero by the prior, since there is no data available to encourage non-zero estimates in this case. Finally in <xref ref-type="fig" rid="pcbi-1002569-g007">Fig. 7A</xref> we also plot the relative error between the “full” and “cross-validated” traces for all the compartments of the subtree. The relative error for location x is defined as <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e306" xlink:type="simple"/></inline-formula>, where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e307" xlink:type="simple"/></inline-formula> denotes the inferred trace at location <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e308" xlink:type="simple"/></inline-formula> when all the data is considered and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e309" xlink:type="simple"/></inline-formula> is the inferred trace when the chosen locations have been left out. As expected from the spatially localized effect of any measurement to our algorithm, the inferred traces at compartments that are far from all the left out locations do not change. As a technical side note, we point out that when trying our algorithm for this cross-validation experiment, we did not reestimate all the necessary parameters as a means to facilitate direct comparison. Estimating these parameters again could lead to a better suited choice of spline basis <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e310" xlink:type="simple"/></inline-formula> and potentially to better interpolation results.</p>
        <p>Finally, we examined the effect of the temporal sampling rate, by applying our algorithm to a subsampled version of the data. In <xref ref-type="fig" rid="pcbi-1002569-g008">Fig. 8</xref> we examine the differences in the results when the data have been subsampled 4 and 8 times (subtree B under the bAP protocol). As expected, the difference between the full and subsampled results increase with subsampling factor. Using subsampled data, the event times are not always predicted. However, as can be seen from <xref ref-type="fig" rid="pcbi-1002569-g008">Fig. 8</xref>, the general behavior of the inferred traces remains largely the same. It is also important to note that in an experimental situation a lower temporal sampling rate typically leads to a higher signal to noise ratio (SNR). It would be interesting examine this quality-quantity tradeoff more thoroughly <xref ref-type="bibr" rid="pcbi.1002569-Vogelstein1">[5]</xref>; however, such an analysis is not directly possible with this dataset, since simple subsampling does not change the SNR. The analysis shown in <xref ref-type="fig" rid="pcbi-1002569-g007">Figs. 7</xref> and <xref ref-type="fig" rid="pcbi-1002569-g008">8</xref> was also carried out for the other subtrees and experimental protocols and no qualitative differences were observed (data not shown).</p>
        <fig id="pcbi-1002569-g008" position="float">
          <object-id pub-id-type="doi">10.1371/journal.pcbi.1002569.g008</object-id>
          <label>Figure 8</label>
          <caption>
            <title>Effect of the temporal sampling rate.</title>
            <p>A and D: Inferred traces using all the data for subtree B under the bAP protocol. B and E: Inferred traces after <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e311" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e312" xlink:type="simple"/></inline-formula> subsampling, respectively. C and F: Differences of the inferred traces under subsampling conditions from the traces that are inferred using all the data. Note that many qualitative features of the inferred probe molecule profile are preserved even given heavy subsampling.</p>
          </caption>
          <graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002569.g008" xlink:type="simple"/>
        </fig>
      </sec>
      <sec id="s3d">
        <title>Application to simulated data under “synaptic bombardment” conditions</title>
        <p>We finally applied our algorithm to simulated data in a dendritic tree receiving multiple synaptic input from both excitatory and inhibitory presynaptic neurons. (These simulations are necessarily somewhat underconstrained, since the spatiotemporal structure and effect of in-vivo inputs is only beginning to be characterized <xref ref-type="bibr" rid="pcbi.1002569-Branco1">[28]</xref>,<xref ref-type="bibr" rid="pcbi.1002569-Takahashi1">[29]</xref>.) We simulated data from a rat CA1 reconstructed tree model (<xref ref-type="fig" rid="pcbi-1002569-g009">Fig. 9</xref>; <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e313" xlink:type="simple"/></inline-formula> compartments) used in <xref ref-type="bibr" rid="pcbi.1002569-Gabbiani1">[30]</xref> (ch. 9), where the dendrites were endowed with the standard Hodgkin Huxley neuron channels <xref ref-type="bibr" rid="pcbi.1002569-Hodgkin1">[31]</xref> and the voltage profile obeyed the active dendritic cable equations <xref ref-type="bibr" rid="pcbi.1002569-Rall1">[32]</xref>. To this model we also added T-type voltage dependent calcium channels with the same parameters as the ones measured experimentally in <xref ref-type="bibr" rid="pcbi.1002569-Huguenard1">[33]</xref>. (Clearly more elaborate and realistic models are possible, but as we will see below the details of the voltage and calcium model seemed to have a minimal effect on the inference quality here.) We placed a total number of 40 synapses (both excitatory and inhibitory) at random locations along the tree. The synapses were of alpha type with <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e314" xlink:type="simple"/></inline-formula>. The synapses were activated at random times and a total of 80 synaptic events were produced. The neuron was simulated for <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e315" xlink:type="simple"/></inline-formula>, during which 10 action potentials were triggered as a result of the synaptic inputs; each of these spikes propagated back into the tree to a varying extent.</p>
        <fig id="pcbi-1002569-g009" position="float">
          <object-id pub-id-type="doi">10.1371/journal.pcbi.1002569.g009</object-id>
          <label>Figure 9</label>
          <caption>
            <title>Morphology of the CA1 neuron and somatic voltage trace used in <xref ref-type="fig" rid="pcbi-1002569-g010"><bold>Fig. 10</bold></xref>.</title>
            <p>A: Morphology of the CA1 neuron in the x-y axis. B: Voltage trace at the soma. 80 synaptic events were simulated and the neuron produced 10 action potentials. Neuron model and code adapted from <xref ref-type="bibr" rid="pcbi.1002569-Gabbiani1">[30]</xref>.</p>
          </caption>
          <graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002569.g009" xlink:type="simple"/>
        </fig>
        <p>Every <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e316" xlink:type="simple"/></inline-formula> we obtained ten noisy measurements from uniformly random locations, using the same measurement noise distribution described above (6). The probe molecule baseline concentration and the time constant of the dye were both assumed known. To apply our algorithm we constructed a spatial smoothing basis consisting of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e317" xlink:type="simple"/></inline-formula> spline functions. For each of the hidden “spike” variables <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e318" xlink:type="simple"/></inline-formula> we used a simple uncorrelated exponential prior at each location with a rate equal to the firing rate of the neuron. The results of the inference are shown in <xref ref-type="fig" rid="pcbi-1002569-g010">Fig. 10</xref>: even with a simple uncorrelated prior for <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e319" xlink:type="simple"/></inline-formula>, and no detailed knowledge of the underlying biophysical voltage and calcium dynamics, the algorithm does a satisfactory job in estimating the bound probe molecule concentration profile.</p>
        <fig id="pcbi-1002569-g010" position="float">
          <object-id pub-id-type="doi">10.1371/journal.pcbi.1002569.g010</object-id>
          <label>Figure 10</label>
          <caption>
            <title>Calcium estimation under “synaptic bombardment” conditions.</title>
            <p>A: Spatiotemporal voltage profile. B: Bound probe molecule profile: C: Measurement locations and values at each timestep (dark grey corresponds to locations that were not imaged at each timestep). D: Estimated bound probe molecule profile. The algorithm estimates satisfactorily the general behavior of the bound probe molecule concentration profile.</p>
          </caption>
          <graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002569.g010" xlink:type="simple"/>
        </fig>
      </sec>
    </sec>
    <sec id="s4">
      <title>Discussion</title>
      <p>We presented a statistical model for spatiotemporal calcium estimation (up to an affine transformation) given single-trial, spatially localized, noisy imaging measurements. We showed that our algorithm can infer the timing of bAPs and provide estimates about the amplitude of the transients that they initiate. Although the optical measurements come from a small subset of the neuron's compartments the algorithm estimates the full spatiotemporal calcium profile. Moreover, it runs with complexity that scales linearly both with the length of the experiment and the size of the tree, and as a result it can be used in arbitrarily long experiments and large dendritic trees. Our full spatiotemporal smoothing algorithm therefore enables the study of selective propagation of bAPs into specific dendrites, and of the effects of calcium as a coincidence indicator between bAPs and EPSPs. Although the focus of this study was the study of the interactions between bAPs and known EPSP stimulation, we also tested the generality of our algorithm by applying it to a conductance based neuron driven by random (unobserved) synaptic inputs. More generally, our algorithm opens up the possibility of single-trial analysis of spatiotemporal calcium dynamics imaged on large dendritic trees, and could therefore potentially lead to a better understanding of these complex dynamics.</p>
      <p>To obtain a relatively simple model and an efficient inference algorithm, we had to make a number of assumptions. For example, we employed a functional approach by assuming that the relative bound probe molecule concentration can be spatially approximated by a sum of smooth spline functions on the tree. This is reasonable since calcium diffuses locally through the dendritic tree. We assumed that the baseline fluorescence is constant before and after the spike stimulation. While this is true in general, we observed that in some locations (and especially the ones in the main dendritic trunk), the baseline can change significantly after the excitation, leading to the inferred spikes outside the excitation window, as discussed in the Results. The model also relies on the assumption that the bound probe molecules do not saturate during repetitive excitation, and that the rate of calcium unbinding remains constant. Analysis shows that the amplitude of the transients in general decreases as more spikes are applied. This has been reported in many studies (e.g. <xref ref-type="bibr" rid="pcbi.1002569-Gasparini1">[34]</xref>). However, in some situations (see for example the first row in <xref ref-type="fig" rid="pcbi-1002569-g006">Fig. 6b</xref>) there are indications of fast relaxations after the last spike which may imply saturating effects.</p>
      <p>Apart from constructing a spatial basis for the relative bound probe molecules, we also tried the same approach on the un-normalized, raw bound probe molecule measurements. However, we noticed that in this case the required dimension <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e320" xlink:type="simple"/></inline-formula> of the spline basis was much larger because of the large variations in the observed measurements. Consequently, the resulting spline functions were very localized and as a result, inference suffered from overfitting. Moreover, the noise statistics varied considerably at the different measurement locations. Many bAP induced transients went undetected, especially at the distal dendrites, because of their low amplitude. As a result, we concluded that normalizing the measurements with the estimated baseline fluorescence concentration greatly improved the quality and interpretability of results. This approach also has a clear interpretation since the normalized measurements are linearly related to the underlying calcium concentration.</p>
      <p>Our model, so far, assumes only temporal dependencies on the hidden activation states <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e321" xlink:type="simple"/></inline-formula>. Allowing spatial dependencies in <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e322" xlink:type="simple"/></inline-formula> enables the modeling of calcium propagation along the dendritic tree (similar to the cable equation for voltage diffusion) and would lead towards a more biophysical realistic model. To allow this we could modify the state equation Eq. (15) as<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e323" xlink:type="simple"/><label>(27)</label></disp-formula>where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e324" xlink:type="simple"/></inline-formula> is a suitable stable matrix. In the simplest case the spatial dependencies are restricted to the direct neighbors of each hidden variable, as in the standard cable equation <xref ref-type="bibr" rid="pcbi.1002569-Hines1">[35]</xref>. In this case <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e325" xlink:type="simple"/></inline-formula> retains the tree structure. Our fast algorithm can be applied in this setup without losing its linear <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e326" xlink:type="simple"/></inline-formula> complexity, using methods similar to the ones developed in <xref ref-type="bibr" rid="pcbi.1002569-Paninski1">[36]</xref> for voltage measurements in dendritic trees.</p>
      <p>The prior on the transient amplitude used in our model was very simple. It reflected only the knowledge of the interval over which the bAPs were initiated and their rate, but not the exact timing of the bAPs and other qualitative characteristics of the evoked transients. A more sophisticated prior can be chosen that exploits several characteristics of the bAPs. For example, the exact knowledge of the bAP timings can be incorporated to a greater extent by manipulating the time varying spike rate so that it becomes high in the time windows when we expect spikes, and low elsewhere. Moreover, at the dendrites, the amplitude of spikes usually decreases with the distance from the soma. In our approach “we let the data speak”, i.e., we determine the prior of the spike amplitude from the recordings as we discussed in the Results section. However, we can further impose a decreasing amplitude constraint as a regularizer to further promote this behavior, to better deal with the case where individual dendrites are very sparsely imaged. In matrix-vector notation this can be written as <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e327" xlink:type="simple"/></inline-formula> for all <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e328" xlink:type="simple"/></inline-formula>, where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e329" xlink:type="simple"/></inline-formula> is the directional adjacency matrix of the neuron graph <xref ref-type="bibr" rid="pcbi.1002569-Cuntz1">[24]</xref>. The directional adjacency matrix is defined as <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e330" xlink:type="simple"/></inline-formula> if the compartment <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e331" xlink:type="simple"/></inline-formula> is the parent of compartment <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e332" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e333" xlink:type="simple"/></inline-formula> otherwise. Since <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e334" xlink:type="simple"/></inline-formula> represents the bumps of the hidden states at time <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e335" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e336" xlink:type="simple"/></inline-formula> represents the bumps on the bound probe molecule concentration. As the root (soma) of the tree has no parents, the first row of the vector <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e337" xlink:type="simple"/></inline-formula> does not correspond to a difference between amplitudes and must be omitted from the constraints. Alternatively, we can set <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e338" xlink:type="simple"/></inline-formula> to make it trivial. The matrix <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002569.e339" xlink:type="simple"/></inline-formula> has a tree-stucture and such a constraint does not affect the complexity of our algorithm. Additionally, the exponential prior distribution that we used promotes sparsity among the bumps. By introducing a group-sparse nonnegative prior <xref ref-type="bibr" rid="pcbi.1002569-Yuan1">[37]</xref> we could promote synchronized bumps along the tree, again without changing the linear complexity per iteration <xref ref-type="bibr" rid="pcbi.1002569-Pnevmatikakis1">[38]</xref>. However, note that although our algorithm does not promote the above qualitative characteristics, these are observed in the inferred traces, indicating its suitability in cases with limited prior information.</p>
      <p>One natural question is whether the full spatiotemporal profile of calcium concentration can also be estimated. Our model promotes the inference of sparse events; this sparse regularization is necessary to avoid overfitting artifacts given our undersampled measurements. These sparse events, in turn, are interpreted as indicators of calcium concentration transients which are assumed to be instantaneous. As a result, due to these simplifications the detailed calcium dynamics cannot easily be inferred from our algorithm at its current form; see the Methods section for further discussion. Additional constraints on the model (e.g., a modification of the prior based on some knowledge of synaptic input locations) could improve this estimation, but this remains a direction for future work.</p>
      <p>A final interesting question concerns the design of an optimal path for measuring at different locations across the tree. In our dataset the set of imaged sites was chosen by the experimenter and held fixed for each imaging session. Such an approach is suboptimal since it leaves many sites unrecorded and also neglects the spatial correlations along the tree. A heuristic method was presented in <xref ref-type="bibr" rid="pcbi.1002569-Sadovsky1">[39]</xref> for the case of imaging a population of neurons. The goal there was to minimize the length of the scanning path in order to provide faster measurements. In our case of single neuron imaging, where the path length is small and fast measurements can be obtained through RAMP microscopy, the optimality criterion should be the one of maximally informative measurement locations. A similar method was presented in <xref ref-type="bibr" rid="pcbi.1002569-Huggins1">[40]</xref> for the case of voltage filtering. However the extension of this method to calcium measurements is challenging because of our non-Gaussian setup and the added nonnegativity constraints. The directions mentioned above will be pursued in future work.</p>
    </sec>
    <sec id="s5">
      <title>Supporting Information</title>
      <supplementary-material id="pcbi.1002569.s001" mimetype="application/pdf" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002569.s001" xlink:type="simple">
        <label>Text S1</label>
        <caption>
          <p>Description of the log-barrier method for the fast solution of our MAP estimation problem. <xref ref-type="sec" rid="s4">Discussion</xref> of the banded structure of the Hessian and how to exploit it for the fast computation of the Newton direction.</p>
          <p>(PDF)</p>
        </caption>
      </supplementary-material>
    </sec>
  </body>
  <back>
    <ack>
      <p>We thank T. Machado and P. Kaifosh for helpful discussions that improved the presentation of the paper.</p>
    </ack>
    <ref-list>
      <title>References</title>
      <ref id="pcbi.1002569-Rubart1">
        <label>1</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Rubart</surname><given-names>M</given-names></name></person-group>             <year>2004</year>             <article-title>Two-photon microscopy of cells and tissue.</article-title>             <source>Circ Res</source>             <volume>95</volume>             <fpage>1154</fpage>             <lpage>1166</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002569-Saggau1">
        <label>2</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Saggau</surname><given-names>P</given-names></name></person-group>             <year>2006</year>             <article-title>New methods and uses for fast optical scanning.</article-title>             <source>Curr Opin Neurobiol</source>             <volume>16</volume>             <fpage>543</fpage>             <lpage>550</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002569-Greenberg1">
        <label>3</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Greenberg</surname><given-names>DS</given-names></name><name name-style="western"><surname>Houweling</surname><given-names>AR</given-names></name><name name-style="western"><surname>Kerr</surname><given-names>JND</given-names></name></person-group>             <year>2008</year>             <article-title>Population imaging of ongoing neuronal activity in the visual cortex of awake rats.</article-title>             <source>Nat Neurosci</source>             <volume>11</volume>             <fpage>749</fpage>             <lpage>751</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002569-Sasaki1">
        <label>4</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Sasaki</surname><given-names>T</given-names></name><name name-style="western"><surname>Takahashi</surname><given-names>N</given-names></name><name name-style="western"><surname>Matsuki</surname><given-names>N</given-names></name><name name-style="western"><surname>Ikegaya</surname><given-names>Y</given-names></name></person-group>             <year>2008</year>             <article-title>Fast and accurate detection of action potentials from somatic calcium uctuations.</article-title>             <source>J Neurophysiol</source>             <volume>100</volume>             <fpage>1668</fpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002569-Vogelstein1">
        <label>5</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Vogelstein</surname><given-names>J</given-names></name><name name-style="western"><surname>Watson</surname><given-names>B</given-names></name><name name-style="western"><surname>Packer</surname><given-names>A</given-names></name><name name-style="western"><surname>Yuste</surname><given-names>R</given-names></name><name name-style="western"><surname>Jedynak</surname><given-names>B</given-names></name><etal/></person-group>             <year>2009</year>             <article-title>Spike inference from calcium imaging using sequential monte carlo methods.</article-title>             <source>Biophys J</source>             <volume>97</volume>             <fpage>636</fpage>             <lpage>655</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002569-Vogelstein2">
        <label>6</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Vogelstein</surname><given-names>J</given-names></name><name name-style="western"><surname>Packer</surname><given-names>A</given-names></name><name name-style="western"><surname>Machado</surname><given-names>T</given-names></name><name name-style="western"><surname>Sippy</surname><given-names>T</given-names></name><name name-style="western"><surname>Babadi</surname><given-names>B</given-names></name><etal/></person-group>             <year>2010</year>             <article-title>Fast non-negative deconvolution for spike train inference from population calcium imaging.</article-title>             <source>J Neurophysiol</source>             <volume>104</volume>             <fpage>3691</fpage>             <lpage>3704</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002569-Reddy1">
        <label>7</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Reddy</surname><given-names>G</given-names></name><name name-style="western"><surname>Kelleher</surname><given-names>K</given-names></name><name name-style="western"><surname>Fink</surname><given-names>R</given-names></name><name name-style="western"><surname>Saggau</surname><given-names>P</given-names></name></person-group>             <year>2008</year>             <article-title>Three-dimensional random access multiphoton microscopy for functional imaging of neuronal activity.</article-title>             <source>Nat Neurosci</source>             <volume>11</volume>             <fpage>713</fpage>             <lpage>720</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002569-Magee1">
        <label>8</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Magee</surname><given-names>J</given-names></name><name name-style="western"><surname>Johnston</surname><given-names>D</given-names></name></person-group>             <year>1997</year>             <article-title>A synaptically controlled, associative signal for hebbian plasticity in hippocampal neurons.</article-title>             <source>Science</source>             <volume>275</volume>             <fpage>209</fpage>             <lpage>213</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002569-Markram1">
        <label>9</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Markram</surname><given-names>H</given-names></name><name name-style="western"><surname>Helm</surname><given-names>P</given-names></name><name name-style="western"><surname>Sakmann</surname><given-names>B</given-names></name></person-group>             <year>1995</year>             <article-title>Dendritic calcium transients evoked by single backpropagating action potentials in rat neocortical pyramidal neurons.</article-title>             <source>J Physiol</source>             <volume>485</volume>             <fpage>1</fpage>             <lpage>20</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002569-Yasuda1">
        <label>10</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Yasuda</surname><given-names>R</given-names></name><name name-style="western"><surname>Nimchinsky</surname><given-names>E</given-names></name><name name-style="western"><surname>Scheuss</surname><given-names>V</given-names></name><name name-style="western"><surname>Pologruto</surname><given-names>T</given-names></name><name name-style="western"><surname>Oertner</surname><given-names>T</given-names></name><etal/></person-group>             <year>2004</year>             <article-title>Imaging calcium concentration dynamics in small neuronal compartments.</article-title>             <source>Sci STKE</source>             <volume>2004</volume>             <fpage>5</fpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002569-Poenie1">
        <label>11</label>
        <element-citation publication-type="other" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Poenie</surname><given-names>M</given-names></name></person-group>             <year>2006</year>             <article-title>Fluorescent calcium indicators based on bapta.</article-title>             <person-group person-group-type="editor"><name name-style="western"><surname>Putney</surname><given-names>JW</given-names></name></person-group>             <source>Calcium Signaling</source>             <publisher-loc>NY</publisher-loc>             <publisher-name>CRC Taylor and Francis</publisher-name>             <fpage>1</fpage>             <lpage>50</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002569-Haugland1">
        <label>12</label>
        <element-citation publication-type="other" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Haugland</surname><given-names>RP</given-names></name></person-group>             <year>1996</year>             <source>Handbook of Biological Fluorescent Probes and Research Chemicals</source>             <publisher-loc>Eugene, OR</publisher-loc>             <publisher-name>Molecular Probes</publisher-name>          </element-citation>
      </ref>
      <ref id="pcbi.1002569-Tan1">
        <label>13</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Tan</surname><given-names>HH</given-names></name></person-group>             <year>1982</year>             <article-title>A statistical model of the photomultiplier gain process with applications to optical pulse detection.</article-title>             <source>TDA Progress Report</source>             <fpage>42</fpage>             <lpage>68</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002569-Esposti1">
        <label>14</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Esposti</surname><given-names>F</given-names></name><name name-style="western"><surname>Ripamonti</surname><given-names>M</given-names></name><name name-style="western"><surname>Signorini</surname><given-names>MG</given-names></name></person-group>             <year>2009</year>             <article-title>Exploiting the multiplicative nature of uoroscopic image stochastic noise to enhance calcium imaging recording quality.</article-title>             <source>Conf Proc IEEE Eng Med Biol Soc</source>             <volume>2009</volume>             <fpage>3589</fpage>             <lpage>3592</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002569-Papoulis1">
        <label>15</label>
        <element-citation publication-type="other" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Papoulis</surname><given-names>A</given-names></name></person-group>             <year>1965</year>             <source>Probability, Random Variables, and Stochastic Processes</source>             <publisher-name>McGraw-Hill New York</publisher-name>          </element-citation>
      </ref>
      <ref id="pcbi.1002569-DeBoor1">
        <label>16</label>
        <element-citation publication-type="other" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>De Boor</surname><given-names>C</given-names></name></person-group>             <year>2001</year>             <source>A Practical Guide to Splines, volume 27</source>             <publisher-name>Springer Verlag</publisher-name>          </element-citation>
      </ref>
      <ref id="pcbi.1002569-Kondor1">
        <label>17</label>
        <element-citation publication-type="other" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Kondor</surname><given-names>R</given-names></name><name name-style="western"><surname>Lafferty</surname><given-names>J</given-names></name></person-group>             <year>2002</year>             <article-title>Diffusion kernels on graphs and other discrete structures.</article-title>             <fpage>315</fpage>             <lpage>322</lpage>             <comment>In: Proc. Int. Conf. on Machine Learning</comment>          </element-citation>
      </ref>
      <ref id="pcbi.1002569-Fahrmeir1">
        <label>18</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Fahrmeir</surname><given-names>L</given-names></name><name name-style="western"><surname>Kaufmann</surname><given-names>H</given-names></name></person-group>             <year>1991</year>             <article-title>On Kalman filtering, posterior mode estimation and Fisher scoring in dynamic exponential family regression.</article-title>             <source>Metrika</source>             <volume>38</volume>             <fpage>37</fpage>             <lpage>60</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002569-Durbin1">
        <label>19</label>
        <element-citation publication-type="other" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Durbin</surname><given-names>J</given-names></name><name name-style="western"><surname>Koopman</surname><given-names>S</given-names></name></person-group>             <year>2001</year>             <source>Time Series Analysis by State Space Methods</source>             <publisher-name>Oxford University Press</publisher-name>          </element-citation>
      </ref>
      <ref id="pcbi.1002569-Boyd1">
        <label>20</label>
        <element-citation publication-type="other" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Boyd</surname><given-names>S</given-names></name><name name-style="western"><surname>Vandenberghe</surname><given-names>L</given-names></name></person-group>             <year>2004</year>             <source>Convex Optimization</source>             <publisher-name>Oxford University Press</publisher-name>          </element-citation>
      </ref>
      <ref id="pcbi.1002569-Last1">
        <label>21</label>
        <element-citation publication-type="other" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Last</surname><given-names>G</given-names></name><name name-style="western"><surname>Brandt</surname><given-names>A</given-names></name></person-group>             <year>1995</year>             <source>Marked Point Processes on the Real Line: The Dynamic Approach</source>             <publisher-name>Springer</publisher-name>          </element-citation>
      </ref>
      <ref id="pcbi.1002569-Copas1">
        <label>22</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Copas</surname><given-names>J</given-names></name></person-group>             <year>1983</year>             <article-title>Regression, prediction and shrinkage.</article-title>             <source>J R Stat Soc Series B Stat Methodol</source>             <volume>45</volume>             <fpage>311</fpage>             <lpage>354</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002569-Geman1">
        <label>23</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Geman</surname><given-names>S</given-names></name><name name-style="western"><surname>Bienenstock</surname><given-names>E</given-names></name><name name-style="western"><surname>Doursat</surname><given-names>R</given-names></name></person-group>             <year>1992</year>             <article-title>Neural networks and the bias/variance dilemma.</article-title>             <source>Neural Comput</source>             <volume>4</volume>             <fpage>1</fpage>             <lpage>58</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002569-Cuntz1">
        <label>24</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Cuntz</surname><given-names>H</given-names></name><name name-style="western"><surname>Forstner</surname><given-names>F</given-names></name><name name-style="western"><surname>Borst</surname><given-names>A</given-names></name><name name-style="western"><surname>Hausser</surname><given-names>M</given-names></name></person-group>             <year>2010</year>             <article-title>One rule to grow them all: A general theory of neuronal branching and its practical application.</article-title>             <source>PLoS Comput Biol</source>             <volume>6</volume>             <fpage>e1000877</fpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002569-Robert1">
        <label>25</label>
        <element-citation publication-type="other" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Robert</surname><given-names>C</given-names></name><name name-style="western"><surname>Casella</surname><given-names>G</given-names></name></person-group>             <year>2005</year>             <source>Monte Carlo Statistical Methods</source>             <publisher-name>Springer</publisher-name>          </element-citation>
      </ref>
      <ref id="pcbi.1002569-Stuart1">
        <label>26</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Stuart</surname><given-names>G</given-names></name><name name-style="western"><surname>Sakmann</surname><given-names>B</given-names></name></person-group>             <year>1994</year>             <article-title>Active propagation of somatic action potential into neocortical pyramidal cell dendrites.</article-title>             <source>Nature</source>             <volume>367</volume>             <fpage>69</fpage>             <lpage>72</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002569-Spruston1">
        <label>27</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Spruston</surname><given-names>N</given-names></name><name name-style="western"><surname>Schiller</surname><given-names>Y</given-names></name><name name-style="western"><surname>Stuart</surname><given-names>G</given-names></name><name name-style="western"><surname>Sakmann</surname><given-names>B</given-names></name></person-group>             <year>1995</year>             <article-title>Activity-dependent action potential invasion and calcium inux into hippocampal ca1 dendrites.</article-title>             <source>Science</source>             <volume>268</volume>             <fpage>297</fpage>             <lpage>300</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002569-Branco1">
        <label>28</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Branco</surname><given-names>T</given-names></name><name name-style="western"><surname>Clark</surname><given-names>B</given-names></name><name name-style="western"><surname>Hausser</surname><given-names>M</given-names></name></person-group>             <year>2010</year>             <article-title>Dendritic discrimination of temporal input sequences in cortical neurons.</article-title>             <source>Science</source>             <volume>329</volume>             <fpage>1671</fpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002569-Takahashi1">
        <label>29</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Takahashi</surname><given-names>N</given-names></name><name name-style="western"><surname>Kitamura</surname><given-names>K</given-names></name><name name-style="western"><surname>Matsuo</surname><given-names>N</given-names></name><name name-style="western"><surname>Mayford</surname><given-names>M</given-names></name><name name-style="western"><surname>Kano</surname><given-names>M</given-names></name><etal/></person-group>             <year>2012</year>             <article-title>Locally synchronized synaptic inputs.</article-title>             <source>Science</source>             <volume>335</volume>             <fpage>353</fpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002569-Gabbiani1">
        <label>30</label>
        <element-citation publication-type="other" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Gabbiani</surname><given-names>F</given-names></name><name name-style="western"><surname>Cox</surname><given-names>S</given-names></name></person-group>             <year>2010</year>             <source>Mathematics for neuroscientists</source>             <publisher-name>Academic Press</publisher-name>          </element-citation>
      </ref>
      <ref id="pcbi.1002569-Hodgkin1">
        <label>31</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Hodgkin</surname><given-names>A</given-names></name><name name-style="western"><surname>Huxley</surname><given-names>A</given-names></name></person-group>             <year>1952</year>             <article-title>A quantitative description of membrane current and its application to conduction and excitation in nerve.</article-title>             <source>J Physiol</source>             <volume>117</volume>             <fpage>500</fpage>             <lpage>544</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002569-Rall1">
        <label>32</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Rall</surname><given-names>W</given-names></name></person-group>             <year>1977</year>             <article-title>Core conductor theory and cable properties of neurons.</article-title>             <source>Compr Physiol</source>             <volume>Supplement 1</volume>             <fpage>39</fpage>             <lpage>97</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002569-Huguenard1">
        <label>33</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Huguenard</surname><given-names>J</given-names></name><name name-style="western"><surname>McCormick</surname><given-names>D</given-names></name></person-group>             <year>1992</year>             <article-title>Simulation of the currents involved in rhythmic oscillations in thalamic relay neurons.</article-title>             <source>J Neurophysiol</source>             <volume>68</volume>             <fpage>1373</fpage>             <lpage>1383</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002569-Gasparini1">
        <label>34</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Gasparini</surname><given-names>S</given-names></name></person-group>             <year>2011</year>             <article-title>Distance-and activity-dependent modulation of spike back-propagation in layer V pyramidal neurons of the medial entorhinal cortex.</article-title>             <source>J Neurophysiol</source>             <volume>105</volume>             <fpage>1372</fpage>             <lpage>1379</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002569-Hines1">
        <label>35</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Hines</surname><given-names>M</given-names></name></person-group>             <year>1984</year>             <article-title>Efficient computation of branched nerve equations.</article-title>             <source>Int J Biomed Comput</source>             <volume>15</volume>             <fpage>69</fpage>             <lpage>76</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002569-Paninski1">
        <label>36</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Paninski</surname><given-names>L</given-names></name></person-group>             <year>2010</year>             <article-title>Fast Kalman filtering on quasilinear dendritic trees.</article-title>             <source>J Comput Neurosci</source>             <volume>28</volume>             <fpage>211</fpage>             <lpage>28</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002569-Yuan1">
        <label>37</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Yuan</surname><given-names>M</given-names></name><name name-style="western"><surname>Lin</surname><given-names>Y</given-names></name></person-group>             <year>2006</year>             <article-title>Model selection and estimation in regression with grouped variables.</article-title>             <source>J R Stat Soc Series B Stat Methodol</source>             <volume>68</volume>             <fpage>49</fpage>             <lpage>67</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002569-Pnevmatikakis1">
        <label>38</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Pnevmatikakis</surname><given-names>E</given-names></name><name name-style="western"><surname>Paninski</surname><given-names>L</given-names></name></person-group>             <year>2012</year>             <article-title>Fast interior-point inference in high-dimensional, sparse, penalized state-space models. Fifteenth International Conference on Artificial Intelligence and Statistics (AISTATS).</article-title>             <source>J Mach Learn Res</source>             <volume>22</volume>             <fpage>895</fpage>             <lpage>904</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002569-Sadovsky1">
        <label>39</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Sadovsky</surname><given-names>A</given-names></name><name name-style="western"><surname>Kruskal</surname><given-names>P</given-names></name><name name-style="western"><surname>Kimmel</surname><given-names>J</given-names></name><name name-style="western"><surname>Ostmeyer</surname><given-names>J</given-names></name><name name-style="western"><surname>Neubauer</surname><given-names>F</given-names></name><etal/></person-group>             <year>2011</year>             <article-title>Heuristically optimal path scanning (HOPS) for high speed multiphoton circuit imaging.</article-title>             <source>J Neurophysiol</source>             <volume>106</volume>             <fpage>1591</fpage>             <lpage>1598</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002569-Huggins1">
        <label>40</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Huggins</surname><given-names>J</given-names></name><name name-style="western"><surname>Paninski</surname><given-names>L</given-names></name></person-group>             <year>2012</year>             <article-title>Optimal experimental design for sampling voltage on dendritic trees in the low-SNR regime.</article-title>             <source>J Comput Neurosci</source>             <volume>32</volume>             <fpage>347</fpage>             <lpage>366</lpage>          </element-citation>
      </ref>
    </ref-list>
    
  </back>
</article>