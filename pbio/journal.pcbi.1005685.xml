<!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1d3 20150301//EN" "http://jats.nlm.nih.gov/publishing/1.1d3/JATS-journalpublishing1.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="1.1d3" xml:lang="en">
<front>
<journal-meta>
<journal-id journal-id-type="nlm-ta">PLoS Comput Biol</journal-id>
<journal-id journal-id-type="publisher-id">plos</journal-id>
<journal-id journal-id-type="pmc">ploscomp</journal-id>
<journal-title-group>
<journal-title>PLOS Computational Biology</journal-title>
</journal-title-group>
<issn pub-type="ppub">1553-734X</issn>
<issn pub-type="epub">1553-7358</issn>
<publisher>
<publisher-name>Public Library of Science</publisher-name>
<publisher-loc>San Francisco, CA USA</publisher-loc>
</publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="publisher-id">PCOMPBIOL-D-16-02043</article-id>
<article-id pub-id-type="doi">10.1371/journal.pcbi.1005685</article-id>
<article-categories>
<subj-group subj-group-type="heading">
<subject>Research Article</subject>
</subj-group>
<subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Cell biology</subject><subj-group><subject>Cellular types</subject><subj-group><subject>Animal cells</subject><subj-group><subject>Neurons</subject></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Neuroscience</subject><subj-group><subject>Cellular neuroscience</subject><subj-group><subject>Neurons</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Research and analysis methods</subject><subj-group><subject>Imaging techniques</subject><subj-group><subject>Neuroimaging</subject></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Neuroscience</subject><subj-group><subject>Neuroimaging</subject></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Research and analysis methods</subject><subj-group><subject>Imaging techniques</subject><subj-group><subject>Neuroimaging</subject><subj-group><subject>Calcium imaging</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Neuroscience</subject><subj-group><subject>Neuroimaging</subject><subj-group><subject>Calcium imaging</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Research and analysis methods</subject><subj-group><subject>Imaging techniques</subject><subj-group><subject>Fluorescence imaging</subject></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Physical sciences</subject><subj-group><subject>Mathematics</subject><subj-group><subject>Applied mathematics</subject><subj-group><subject>Algorithms</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Research and analysis methods</subject><subj-group><subject>Simulation and modeling</subject><subj-group><subject>Algorithms</subject></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Physical sciences</subject><subj-group><subject>Mathematics</subject><subj-group><subject>Statistics (mathematics)</subject><subj-group><subject>Statistical noise</subject><subj-group><subject>Gaussian noise</subject></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Research and analysis methods</subject><subj-group><subject>Imaging techniques</subject></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Computational biology</subject><subj-group><subject>Computational neuroscience</subject><subj-group><subject>Single neuron function</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Neuroscience</subject><subj-group><subject>Computational neuroscience</subject><subj-group><subject>Single neuron function</subject></subj-group></subj-group></subj-group></subj-group></article-categories>
<title-group>
<article-title>Multi-scale approaches for high-speed imaging and analysis of large neural populations</article-title>
<alt-title alt-title-type="running-head">Multi-scale approaches for neuronal population imaging</alt-title>
</title-group>
<contrib-group>
<contrib contrib-type="author" corresp="yes" xlink:type="simple">
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-1321-5866</contrib-id>
<name name-style="western">
<surname>Friedrich</surname> <given-names>Johannes</given-names></name>
<role content-type="http://credit.casrai.org/">Conceptualization</role>
<role content-type="http://credit.casrai.org/">Formal analysis</role>
<role content-type="http://credit.casrai.org/">Funding acquisition</role>
<role content-type="http://credit.casrai.org/">Investigation</role>
<role content-type="http://credit.casrai.org/">Methodology</role>
<role content-type="http://credit.casrai.org/">Software</role>
<role content-type="http://credit.casrai.org/">Writing – original draft</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff001"><sup>1</sup></xref>
<xref ref-type="aff" rid="aff002"><sup>2</sup></xref>
<xref ref-type="corresp" rid="cor001">*</xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0003-0941-3496</contrib-id>
<name name-style="western">
<surname>Yang</surname> <given-names>Weijian</given-names></name>
<role content-type="http://credit.casrai.org/">Data curation</role>
<role content-type="http://credit.casrai.org/">Funding acquisition</role>
<role content-type="http://credit.casrai.org/">Investigation</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff003"><sup>3</sup></xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0001-9368-6352</contrib-id>
<name name-style="western">
<surname>Soudry</surname> <given-names>Daniel</given-names></name>
<role content-type="http://credit.casrai.org/">Formal analysis</role>
<role content-type="http://credit.casrai.org/">Funding acquisition</role>
<role content-type="http://credit.casrai.org/">Investigation</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff001"><sup>1</sup></xref>
<xref ref-type="fn" rid="currentaff001"><sup>¤</sup></xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0001-9297-4854</contrib-id>
<name name-style="western">
<surname>Mu</surname> <given-names>Yu</given-names></name>
<role content-type="http://credit.casrai.org/">Data curation</role>
<role content-type="http://credit.casrai.org/">Investigation</role>
<xref ref-type="aff" rid="aff002"><sup>2</sup></xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<name name-style="western">
<surname>Ahrens</surname> <given-names>Misha B.</given-names></name>
<role content-type="http://credit.casrai.org/">Data curation</role>
<role content-type="http://credit.casrai.org/">Funding acquisition</role>
<role content-type="http://credit.casrai.org/">Resources</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff002"><sup>2</sup></xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<name name-style="western">
<surname>Yuste</surname> <given-names>Rafael</given-names></name>
<role content-type="http://credit.casrai.org/">Funding acquisition</role>
<role content-type="http://credit.casrai.org/">Resources</role>
<xref ref-type="aff" rid="aff003"><sup>3</sup></xref>
<xref ref-type="aff" rid="aff004"><sup>4</sup></xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<name name-style="western">
<surname>Peterka</surname> <given-names>Darcy S.</given-names></name>
<role content-type="http://credit.casrai.org/">Data curation</role>
<role content-type="http://credit.casrai.org/">Funding acquisition</role>
<role content-type="http://credit.casrai.org/">Methodology</role>
<role content-type="http://credit.casrai.org/">Writing – original draft</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff003"><sup>3</sup></xref>
<xref ref-type="aff" rid="aff005"><sup>5</sup></xref>
</contrib>
<contrib contrib-type="author" corresp="yes" xlink:type="simple">
<name name-style="western">
<surname>Paninski</surname> <given-names>Liam</given-names></name>
<role content-type="http://credit.casrai.org/">Conceptualization</role>
<role content-type="http://credit.casrai.org/">Formal analysis</role>
<role content-type="http://credit.casrai.org/">Funding acquisition</role>
<role content-type="http://credit.casrai.org/">Methodology</role>
<role content-type="http://credit.casrai.org/">Supervision</role>
<role content-type="http://credit.casrai.org/">Writing – original draft</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff001"><sup>1</sup></xref>
<xref ref-type="aff" rid="aff003"><sup>3</sup></xref>
<xref ref-type="aff" rid="aff004"><sup>4</sup></xref>
<xref ref-type="aff" rid="aff005"><sup>5</sup></xref>
<xref ref-type="corresp" rid="cor001">*</xref>
</contrib>
</contrib-group>
<aff id="aff001">
<label>1</label>
<addr-line>Department of Statistics, Grossman Center for the Statistics of Mind, and Center for Theoretical Neuroscience, Columbia University, New York, New York, United States of America</addr-line>
</aff>
<aff id="aff002">
<label>2</label>
<addr-line>Janelia Research Campus, Howard Hughes Medical Institute, Ashburn, Virginia, United States of America</addr-line>
</aff>
<aff id="aff003">
<label>3</label>
<addr-line>NeuroTechnology Center, Department of Biological Sciences, Columbia University, New York, New York, United States of America</addr-line>
</aff>
<aff id="aff004">
<label>4</label>
<addr-line>Kavli Institute of Brain Science, Columbia University, New York, New York, United States of America</addr-line>
</aff>
<aff id="aff005">
<label>5</label>
<addr-line>Zuckerman Mind Brain Behavior Institute, Columbia University, New York, New York, United States of America</addr-line>
</aff>
<contrib-group>
<contrib contrib-type="editor" xlink:type="simple">
<name name-style="western">
<surname>Graham</surname> <given-names>Lyle J.</given-names></name>
<role>Editor</role>
<xref ref-type="aff" rid="edit1"/>
</contrib>
</contrib-group>
<aff id="edit1">
<addr-line>Université Paris Descartes, Centre National de la Recherche Scientifique, FRANCE</addr-line>
</aff>
<author-notes>
<fn fn-type="conflict" id="coi001">
<p>The authors have declared that no competing interests exist.</p>
</fn>
<fn fn-type="current-aff" id="currentaff001">
<label>¤</label> <p>Current address: Department of Electrical Engineering, Technion, Haifa, Israel</p>
</fn>
<corresp id="cor001">* E-mail: <email xlink:type="simple">j.friedrich@columbia.edu</email> (JF); <email xlink:type="simple">liam@stat.columbia.edu</email> (LP)</corresp>
</author-notes>
<pub-date pub-type="collection">
<month>8</month>
<year>2017</year>
</pub-date>
<pub-date pub-type="epub">
<day>3</day>
<month>8</month>
<year>2017</year>
</pub-date>
<volume>13</volume>
<issue>8</issue>
<elocation-id>e1005685</elocation-id>
<history>
<date date-type="received">
<day>15</day>
<month>12</month>
<year>2016</year>
</date>
<date date-type="accepted">
<day>14</day>
<month>7</month>
<year>2017</year>
</date>
</history>
<permissions>
<copyright-year>2017</copyright-year>
<copyright-holder>Friedrich et al</copyright-holder>
<license xlink:href="http://creativecommons.org/licenses/by/4.0/" xlink:type="simple">
<license-p>This is an open access article distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/" xlink:type="simple">Creative Commons Attribution License</ext-link>, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p>
</license>
</permissions>
<self-uri content-type="pdf" xlink:href="info:doi/10.1371/journal.pcbi.1005685"/>
<abstract>
<p>Progress in modern neuroscience critically depends on our ability to observe the activity of large neuronal populations with cellular spatial and high temporal resolution. However, two bottlenecks constrain efforts towards fast imaging of large populations. First, the resulting large video data is challenging to analyze. Second, there is an explicit tradeoff between imaging speed, signal-to-noise, and field of view: with current recording technology we cannot image very large neuronal populations with simultaneously high spatial and temporal resolution. Here we describe multi-scale approaches for alleviating both of these bottlenecks. First, we show that spatial and temporal decimation techniques based on simple local averaging provide order-of-magnitude speedups in spatiotemporally demixing calcium video data into estimates of single-cell neural activity. Second, once the shapes of individual neurons have been identified at fine scale (e.g., after an initial phase of conventional imaging with standard temporal and spatial resolution), we find that the spatial/temporal resolution tradeoff shifts dramatically: after demixing we can accurately recover denoised fluorescence traces and deconvolved neural activity of each individual neuron from coarse scale data that has been spatially decimated by an order of magnitude. This offers a cheap method for compressing this large video data, and also implies that it is possible to either speed up imaging significantly, or to “zoom out” by a corresponding factor to image order-of-magnitude larger neuronal populations with minimal loss in accuracy or temporal resolution.</p>
</abstract>
<abstract abstract-type="summary">
<title>Author summary</title>
<p>The voxel rate of imaging systems ultimately sets the limit on the speed of data acquisition. These limits often mean that only a small fraction of the activity of large neuronal populations can be observed at high spatio-temporal resolution. For imaging of very large populations with single cell resolution, temporal resolution is typically sacrificed. Here we propose a multi-scale approach to achieve single cell precision using fast imaging at reduced spatial resolution. In the first phase the spatial location and shape of each neuron is obtained at standard spatial resolution; in the second phase imaging is performed at much lower spatial resolution. We show that we can apply a demixing algorithm to accurately recover each neuron’s activity from the low-resolution data by exploiting the high-resolution cellular maps estimated in the first imaging phase. Thus by decreasing the spatial resolution in the second phase, we can compress the video data significantly, and potentially acquire images over an order-of-magnitude larger area, or image at significantly higher temporal resolution, with minimal loss in accuracy of the recovered neuronal activity. We evaluate this approach on real data from light-sheet and 2-photon calcium imaging.</p>
</abstract>
<funding-group>
<award-group id="award001">
<funding-source>
<institution-wrap>
<institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/501100001711</institution-id>
<institution>Schweizerischer Nationalfonds zur Förderung der Wissenschaftlichen Forschung</institution>
</institution-wrap>
</funding-source>
<award-id>P300P2_158428</award-id>
<principal-award-recipient>
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-1321-5866</contrib-id>
<name name-style="western">
<surname>Friedrich</surname> <given-names>Johannes</given-names></name>
</principal-award-recipient>
</award-group>
<award-group id="award002">
<funding-source>
<institution>Gruss Lipper Charitable Foundation</institution>
</funding-source>
<principal-award-recipient>
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0001-9368-6352</contrib-id>
<name name-style="western">
<surname>Soudry</surname> <given-names>Daniel</given-names></name>
</principal-award-recipient>
</award-group>
<award-group id="award003">
<funding-source>
<institution-wrap>
<institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/100000861</institution-id>
<institution>Burroughs Wellcome Fund</institution>
</institution-wrap>
</funding-source>
<principal-award-recipient>
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0003-0941-3496</contrib-id>
<name name-style="western">
<surname>Yang</surname> <given-names>Weijian</given-names></name>
</principal-award-recipient>
</award-group>
<award-group id="award004">
<funding-source>
<institution-wrap>
<institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/100000893</institution-id>
<institution>Simons Foundation</institution>
</institution-wrap>
</funding-source>
<award-id>325171</award-id>
<principal-award-recipient>
<name name-style="western">
<surname>Ahrens</surname> <given-names>Misha B.</given-names></name>
</principal-award-recipient>
</award-group>
<award-group id="award005">
<funding-source>
<institution-wrap>
<institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/100000893</institution-id>
<institution>Simons Foundation</institution>
</institution-wrap>
</funding-source>
<award-id>325398</award-id>
<principal-award-recipient>
<name name-style="western">
<surname>Paninski</surname> <given-names>Liam</given-names></name>
</principal-award-recipient>
</award-group>
<award-group id="award006">
<funding-source>
<institution-wrap>
<institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/100000893</institution-id>
<institution>Simons Foundation</institution>
</institution-wrap>
</funding-source>
<award-id>365002</award-id>
<principal-award-recipient>
<name name-style="western">
<surname>Paninski</surname> <given-names>Liam</given-names></name>
</principal-award-recipient>
</award-group>
<award-group id="award007">
<funding-source>
<institution-wrap>
<institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/100000011</institution-id>
<institution>Howard Hughes Medical Institute</institution>
</institution-wrap>
</funding-source>
<principal-award-recipient>
<name name-style="western">
<surname>Ahrens</surname> <given-names>Misha B.</given-names></name>
</principal-award-recipient>
</award-group>
<award-group id="award008">
<funding-source>
<institution-wrap>
<institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/100000002</institution-id>
<institution>National Institutes of Health</institution>
</institution-wrap>
</funding-source>
<award-id>R44MH109187</award-id>
<principal-award-recipient>
<name name-style="western">
<surname>Peterka</surname> <given-names>Darcy S.</given-names></name>
</principal-award-recipient>
</award-group>
<award-group id="award009">
<funding-source>
<institution>NIH BRAIN Initiative</institution>
</funding-source>
<award-id>R01 EB22913</award-id>
<principal-award-recipient>
<name name-style="western">
<surname>Paninski</surname> <given-names>Liam</given-names></name>
</principal-award-recipient>
</award-group>
<award-group id="award010">
<funding-source>
<institution>NIH BRAIN Initiative</institution>
</funding-source>
<award-id>R21 EY027592</award-id>
<principal-award-recipient>
<name name-style="western">
<surname>Peterka</surname> <given-names>Darcy S.</given-names></name>
</principal-award-recipient>
</award-group>
<award-group id="award011">
<funding-source>
<institution-wrap>
<institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/100006502</institution-id>
<institution>Defense Sciences Office, DARPA</institution>
</institution-wrap>
</funding-source>
<award-id>N66001-15-C-4032</award-id>
<principal-award-recipient>
<name name-style="western">
<surname>Paninski</surname> <given-names>Liam</given-names></name>
</principal-award-recipient>
</award-group>
<award-group id="award012">
<funding-source>
<institution-wrap>
<institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/100000183</institution-id>
<institution>Army Research Office</institution>
</institution-wrap>
</funding-source>
<award-id>MURI W911NF-12-1-0594</award-id>
<principal-award-recipient>
<name name-style="western">
<surname>Yuste</surname> <given-names>Rafael</given-names></name>
</principal-award-recipient>
</award-group>
<funding-statement>The research of JF was supported by Swiss National Science Foundation (<ext-link ext-link-type="uri" xlink:href="http://www.snf.ch" xlink:type="simple">http://www.snf.ch</ext-link>) Research Award P300P2_158428, and the research of DS by the Gruss Lipper Charitable Foundation (<ext-link ext-link-type="uri" xlink:href="http://www.eglcf.org" xlink:type="simple">http://www.eglcf.org</ext-link>). WY holds a Career Award at the Scientific Interface from Burroughs Wellcome Fund (<ext-link ext-link-type="uri" xlink:href="https://www.bwfund.org" xlink:type="simple">https://www.bwfund.org</ext-link>). Further funding for this research was provided by Simons Foundation (<ext-link ext-link-type="uri" xlink:href="https://www.simonsfoundation.org" xlink:type="simple">https://www.simonsfoundation.org</ext-link>) Global Brain Research Awards 325171 (MBA, LP), 325398, and 365002 (LP), Howard Hughes Medical Institute (<ext-link ext-link-type="uri" xlink:href="http://hhmi.org" xlink:type="simple">http://hhmi.org</ext-link>; MBA), Army Research Office (ARO, <ext-link ext-link-type="uri" xlink:href="https://www.arl.army.mil?page=472" xlink:type="simple">https://www.arl.army.mil?page=472</ext-link>) W911NF-12-1-0594 (MURI; RY, LP), National Institutes of Health (NIH, <ext-link ext-link-type="uri" xlink:href="https://www.nih.gov" xlink:type="simple">https://www.nih.gov</ext-link>) DP1EY024503, R01MH101218 (RY), and R44MH109187 (DSP), NIH BRAIN Initiative (<ext-link ext-link-type="uri" xlink:href="https://www.braininitiative.nih.gov" xlink:type="simple">https://www.braininitiative.nih.gov</ext-link>) R01EB22913 (LP) and R21EY027592 (DSP, LP), Defense Advanced Research Projects Agency (DARPA, <ext-link ext-link-type="uri" xlink:href="http://www.darpa.mil" xlink:type="simple">http://www.darpa.mil</ext-link>) N66001-15-C-4032 (SIMPLEX; RY, LP), and a Google Faculty Research award (LP); in addition, this work was supported by the Intelligence Advanced Research Projects Activity (IARPA, <ext-link ext-link-type="uri" xlink:href="https://www.iarpa.gov" xlink:type="simple">https://www.iarpa.gov</ext-link>) via Department of Interior/ Interior Business Center (DoI/IBC) contract numbers D16PC00003 and D16PC00007 (LP). The funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.</funding-statement>
</funding-group>
<counts>
<fig-count count="8"/>
<table-count count="2"/>
<page-count count="24"/>
</counts>
<custom-meta-group>
<custom-meta>
<meta-name>PLOS Publication Stage</meta-name>
<meta-value>vor-update-to-uncorrected-proof</meta-value>
</custom-meta>
<custom-meta>
<meta-name>Publication Update</meta-name>
<meta-value>2017-08-15</meta-value>
</custom-meta>
<custom-meta id="data-availability">
<meta-name>Data Availability</meta-name>
<meta-value>Code and data underlying the reported findings are available on <ext-link ext-link-type="uri" xlink:href="https://github.com/j-friedrich/multi-scale" xlink:type="simple">https://github.com/j-friedrich/multi-scale</ext-link> and linked repositories therein. We further used a publicly available dataset provided by the GENIE project, Svoboda lab, at Janelia Research Campus on <ext-link ext-link-type="uri" xlink:href="http://crcns.org" xlink:type="simple">http://crcns.org</ext-link> (Chen et al., 2013; GENIE project, 2015).</meta-value>
</custom-meta>
</custom-meta-group>
</article-meta>
</front>
<body>
<disp-quote>
<p>This is a PLoS Computational Biology Methods paper.</p>
</disp-quote>
<sec id="sec001" sec-type="intro">
<title>Introduction</title>
<p>A major goal of neuroscience is to understand interactions within large populations of neurons, including their network dynamics and emergent behavior. This ideally requires the observation of neural activity over large volumes. Recently, light-sheet microscopy and genetically encoded indicators have enabled unprecedented whole-brain imaging of tens of thousands of neurons at cellular resolution [<xref ref-type="bibr" rid="pcbi.1005685.ref001">1</xref>]. However, light-sheet microscopy generally suffers from slow volumetric speeds (e.g. [<xref ref-type="bibr" rid="pcbi.1005685.ref002">2</xref>], but see also [<xref ref-type="bibr" rid="pcbi.1005685.ref003">3</xref>, <xref ref-type="bibr" rid="pcbi.1005685.ref004">4</xref>]) and is usually applied to small and transparent brains. In scattering brains, current technologies with single-neuron resolution are usually based on slow, serially-scanned two-photon (2P) imaging methods that can only sample from <italic>O</italic>(10<sup>2</sup> − 10<sup>3</sup>) neurons simultaneously with adequate temporal resolution [<xref ref-type="bibr" rid="pcbi.1005685.ref005">5</xref>]. Recent advances have enabled faster light-sheet imaging in cortex [<xref ref-type="bibr" rid="pcbi.1005685.ref006">6</xref>] and fast volumetric 2P imaging [<xref ref-type="bibr" rid="pcbi.1005685.ref007">7</xref>], but we must still contend with critical trade-offs between temporal and spatial resolution—and the need for even faster imaging of even larger neural populations.</p>
<p>Another critical challenge is the sheer amount of data generated by these large-scale imaging methods. A crucial step for further neural analysis involves a transition from voxel-space to neuron-source space: i.e., we must detect the neurons and extract and demix each neuron’s temporal activity from the video. Simple methods such as averaging voxels over distinct regions of interest (ROIs) are fast, but more statistically-principled methods based on constrained non-negative matrix factorization (CNMF) better conserve information, yield higher signal-to-noise ratio, recover more neurons, and enable the demixing of spatially overlapping neurons [<xref ref-type="bibr" rid="pcbi.1005685.ref008">8</xref>]. The methods described in [<xref ref-type="bibr" rid="pcbi.1005685.ref008">8</xref>] were not optimized for very large datasets, but NMF is a key machine learning primitive that has enjoyed more than a decade of intensive algorithmic optimization [<xref ref-type="bibr" rid="pcbi.1005685.ref009">9</xref>–<xref ref-type="bibr" rid="pcbi.1005685.ref012">12</xref>] that we can exploit here to scale the CNMF approach. We find that a very simple idea leads to order-of-magnitude speedups: by decimating the data (i.e., decreasing the resolution of the data by simple local averaging [<xref ref-type="bibr" rid="pcbi.1005685.ref013">13</xref>]), we can obtain much faster algorithms with minimal loss of accuracy.</p>
<p>Decimation ideas do not just lead to faster computational image processing, but also offer prescriptions for faster image acquisition over larger fields of view (FOV), and for observing larger neural populations. Specifically, we propose the following two-phase combined image acquisition/analysis approach. In the first phase, we use conventional imaging methods to obtain estimates of the visible neuronal locations and shapes. After this cell-identification phase is complete we switch to low-spatial-resolution imaging, which in the case of camera-based imaging simply corresponds to “zooming out” on the image, i.e., expanding the spatial size of each voxel. This has the benefit of projecting a larger FOV onto the same number of voxels; alternatively, if the number of voxels recorded per second is a limiting factor, then recording fewer (larger) voxels per frame implies that we can image at higher frame-rates. We are thus effectively trading off spatial resolution for temporal resolution; if we cut the spatial resolution too much we may no longer be able to clearly identify or resolve single cells by eye in the obtained images. However, we show that, given the high-spatial-resolution information obtained in the first imaging phase, the demixing stage of CNMF can recover the temporal signals of interest even from images that have undergone radical spatial decimation (an order of magnitude or more). In other words, CNMF significantly shifts the tradeoff between spatial and temporal resolution, enabling us to image larger neuronal populations at higher temporal resolution.</p>
<p>The rest of this paper is organized as follows. We first describe how temporal and spatial decimation (along with several other improvements) can be used within the CNMF algorithm to gain order-of-magnitude speed-ups in calcium imaging video processing. Next we investigate how decimation can enable faster imaging of larger populations for light-sheet and 2P imaging. We show the importance of the initial cell identification phase, quantitatively illustrate how CNMF changes the tradeoff between spatial and temporal resolution, and discuss how spatially decimated imaging followed by demixing can be interpreted as a simple compression and decoding scheme. We show that good estimates of the neural shapes can be obtained on a small batch of standard-resolution data, corresponding to a short cell-identification imaging phase. Finally we demonstrate that interleaved imaging that translates the pixels by subpixel shifts on each frame further improves the fidelity of the recovered neural time series.</p>
</sec>
<sec id="sec002" sec-type="results">
<title>Results</title>
<sec id="sec003">
<title>Order-of-magnitude speedups in demixing calcium imaging data</title>
<p>Constrained non-negative matrix factorization (see <xref ref-type="sec" rid="sec008">Methods</xref>) relies on the observation that the spatiotemporal fluorescence activity (represented as a space-by-time matrix) can be expressed in terms of a product of two matrices: a spatial matrix <italic>A</italic> that encodes the location and shape of each neuron and a temporal matrix <italic>C</italic> that characterizes the calcium concentration within each neuron over time. Placing constraints on the spatial footprint of each neuron (e.g., enforcing sparsity and locality of each neural shape) and on the temporal activity (modeling the observed calcium in terms of a filtered version of sparse, non-negative neural activity) significantly improves the estimation of these components compared to vanilla NMF [<xref ref-type="bibr" rid="pcbi.1005685.ref008">8</xref>]. Below (cf. <xref ref-type="fig" rid="pcbi.1005685.g001">Fig 1</xref>), we describe a number of algorithmic improvements on the basic approach described in [<xref ref-type="bibr" rid="pcbi.1005685.ref008">8</xref>]: an iterative block-coordinate descent algorithm in which we optimize for components of <italic>A</italic> with <italic>C</italic> held fixed, then for <italic>C</italic> with <italic>A</italic> held fixed.</p>
<fig id="pcbi.1005685.g001" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005685.g001</object-id>
<label>Fig 1</label>
<caption>
<title>Speeding up CNMF.</title>
<p>Mean-squared-error as a function of wall time. <bold>(A)</bold> The order in which coordinates in the block-coordinate descent method are updated affects convergence speed. The dashed box indicates the zoomed in plot region of (B, C, D) <bold>(B)</bold> Temporal decimation speeds up CNMF. Curves show the normalized mean square error (MSE; normalized so that at convergence the original CNMF method reaches a value of 1) on the whole data after 30 initial iterations are performed on a smaller dataset obtained by temporally decimating by different factors <italic>k</italic>—i.e., averaging each block of <italic>k</italic> frames into a single frame (color indicates <italic>k</italic>, cf. legend). The curve for decimation factor 1 (i.e., no decimation) is identical to the one in (A). <bold>(C)</bold> Temporal decimation outperforms other compression schemes. Compressing further after decimation (dashed lines) is not beneficial. The cyan and vermilion curve are the same as in (A,B). <bold>(D)</bold> Spatial decimation (locally averaging over spatial blocks of size <italic>l</italic> × <italic>l</italic> in the image) yields further improvements, in particular a better (local) minimum of the MSE. Curves show the results for 30 initial iterations on data that has been decimated temporally by a factor of 30 and spatially by the factors <italic>l</italic> given in the legend. The solid cyan curve for spatial decimation factor 1×1 (i.e., no spatial decimation) is the same as in (B, C).</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005685.g001" xlink:type="simple"/>
</fig>
<p>We begin by considering imaging data obtained at low temporal resolution, specifically a whole-brain light-sheet imaging recording acquired at a rate of 2 Hz using nuclear localized GCaMP6f in zebrafish. We restricted our analysis to a representative patch shown in <xref ref-type="fig" rid="pcbi.1005685.g002">Fig 2A</xref>, extracted from a medial z-layer of the telencephalon (pallium). (Similar analyses were also performed on patches from midbrain and hindbrain, with similar conclusions.) The neural centers were detected automatically using the greedy method from [<xref ref-type="bibr" rid="pcbi.1005685.ref008">8</xref>]. To ensure that the spatial components in <italic>A</italic> are localized, we constrained them to lie within spatial sub-patches (dashed squares in <xref ref-type="fig" rid="pcbi.1005685.g002">Fig 2A</xref>; see also <xref ref-type="sec" rid="sec008">Methods</xref>).</p>
<fig id="pcbi.1005685.g002" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005685.g002</object-id>
<label>Fig 2</label>
<caption>
<title>CNMF with and without initial decimation to speed up CNMF.</title>
<p><bold>(A)</bold> Real data summary image obtained as max-projection along time-axis. Squares indicate patches centered at suspected neurons. The three highlighted neurons are considered in the next panels. <bold>(B)</bold> Extracted shapes of the three neurons highlighted in (A) using the same color code. The upper row shows the result with initial temporal decimation by a factor of 30 and spatial decimation by 3×3, followed by five final iterations on the whole data. The algorithm ran for merely 1 s. The lower row shows the result without any decimation and running until convergence, yielding virtually identical results. <bold>(C)</bold> Extracted time traces without (thick black) and with initial iterations on decimated data (color as in A) overlap well after merely 1 s. <bold>(D)</bold> They overlap almost perfectly if the algorithm using decimation is run not only for 1 but 10 s.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005685.g002" xlink:type="simple"/>
</fig>
<p>The first algorithmic improvement follows from the realization that some of the constraints applied in CNMF are unnecessary, at least during early iterations of the algorithm, when only crude estimates for <italic>A</italic> and <italic>C</italic> are available. Specifically, [<xref ref-type="bibr" rid="pcbi.1005685.ref008">8</xref>] imposed temporal constraints on <italic>C</italic> in each iteration: namely, <italic>C</italic> was modeled as a filtered version of a nonnegative neural activity signal <italic>S</italic>—i.e., <italic>CG</italic> = <italic>S</italic>, for an invertible matrix <italic>G</italic>—and therefore <italic>CG</italic> is constrained to be non-negative. We found that enforcing a simpler non-negativity constraint on <italic>C</italic> instead of <italic>CG</italic> (and then switching to impose the constraint on <italic>CG</italic> only once the estimates of <italic>A</italic> and <italic>C</italic> were closer to convergence) led to a simpler algorithm enabling faster early iterations with no loss in accuracy.</p>
<p>Next we found that significant additional speed-ups in this simplified problem could be obtained by simply changing the order in which the variables in this simplified block-coordinate descent scheme are updated [<xref ref-type="bibr" rid="pcbi.1005685.ref012">12</xref>]. Instead of updating the temporal activity and spatial shape of one neuron at a time (<xref ref-type="fig" rid="pcbi.1005685.g001">Fig 1A</xref>, black line) as in [<xref ref-type="bibr" rid="pcbi.1005685.ref008">8</xref>], which is known as hierarchical alternating least squares (HALS, [<xref ref-type="bibr" rid="pcbi.1005685.ref009">9</xref>]) or rank-one residue iteration (RRI, [<xref ref-type="bibr" rid="pcbi.1005685.ref014">14</xref>]), it turned out to be beneficial to update the activities of all neurons while keeping their shapes fixed, and then updating all shapes while keeping their activities fixed (<xref ref-type="fig" rid="pcbi.1005685.g001">Fig 1A</xref>, vermilion line). The ensuing method is a constrained version of the fast hierarchical alternating least squares (fast HALS, [<xref ref-type="bibr" rid="pcbi.1005685.ref015">15</xref>]) for NMF; one major advantage of this update ordering is that in each iteration we operate on smaller matrices obtained as dot-products of the data matrix <italic>Y</italic> with <italic>A</italic> or <italic>C</italic>, and there is no need to compute the large residual matrix <italic>Y</italic> − <italic>AC</italic> (which is of the same size as the original video) [<xref ref-type="bibr" rid="pcbi.1005685.ref010">10</xref>, <xref ref-type="bibr" rid="pcbi.1005685.ref011">11</xref>]. (In the comparisons below we computed the residual to quantify performance, but excluded the substantial time spent on its computation from the reported wall time values.)</p>
<p>Next we reasoned that to obtain a good preliminary estimate of the spatial shape matrix <italic>A</italic>, it is likely unnecessary to use the original data at full temporal resolution [<xref ref-type="bibr" rid="pcbi.1005685.ref013">13</xref>]. Thus we experimented with the following approach: downsample temporally by a factor of <italic>k</italic>, then run constrained fast HALS (as described above) for 30 iterations, and then finally return to the original (non-downsampled) data and run a few more iterations of fast HALS until convergence. We experimented with three different downsampling methods: 1) selection of the <italic>k</italic>-th frame (this could be considered a kind of stochastic update rule, since we are forming updates based only on a subset of the data); 2) forming a median over the data in each block of <italic>k</italic> frames (applying the median over each pixel independently); and 3) forming a mean over each block of <italic>k</italic> frames. The mean approach (3) led to significantly more accurate and stable results than did the subsampling approach (1), consistent with the results of [<xref ref-type="bibr" rid="pcbi.1005685.ref012">12</xref>], and was about an order of magnitude faster than the median approach (2) with similar accuracy, so we restrict our attention to the mean approach (3) for the remainder of this work. (A further advantage of approach (3) relative to (1) is that (1) can miss fast activity transients.) <xref ref-type="fig" rid="pcbi.1005685.g001">Fig 1B</xref> shows the results obtained for a varying number of decimation factors <italic>k</italic>; we conclude that temporal decimation provides another significant speedup over the results shown in <xref ref-type="fig" rid="pcbi.1005685.g001">Fig 1A</xref>. The starting point of each line is the MSE for keeping the neural shapes obtained on decimated data fixed and solving for the time series on the full data. Refining the shapes on the full data further decreases the MSE, however by less then 1%, hence good shapes are obtained even using merely decimated data.</p>
<p>Besides downsampling methods, we also considered dimensionality reduction via structured random projections [<xref ref-type="bibr" rid="pcbi.1005685.ref016">16</xref>] or singular value decomposition (SVD, [<xref ref-type="bibr" rid="pcbi.1005685.ref017">17</xref>], see <xref ref-type="sec" rid="sec008">Methods</xref>). We compressed the data by the same factor <italic>k</italic> = 30, but found that both of these dimensionality-reduction methods were less efficient than simple decimation (<xref ref-type="fig" rid="pcbi.1005685.g001">Fig 1C</xref>). We further evaluated whether we can gain improvements by further compressing the decimated data via SVD or random projections, such that the reduced dimension is just slightly larger than the number of neurons. However, we did not obtain any improvements beyond plain decimation. We found this result to hold also for smaller patches that contained fewer neurons.</p>
<p>Further speed gains were obtained when applying spatial decimation (computing a mean within <italic>l</italic> × <italic>l</italic> pixel blocks) in addition to temporal decimation over the 30 preliminary fast HALS iterations (<xref ref-type="fig" rid="pcbi.1005685.g001">Fig 1C</xref>); see Algorithm 1 for full details. Strikingly, spatial decimation led not only to faster but also to better solutions of the biconvex factorization problem (where solution quality is measured by the residual sum of square errors, ||<italic>Y</italic> − <italic>AC</italic>||<sup>2</sup>, RSS), apparently because the spatially-decimated solutions are near better local optima in the squared-error objective function than are the non-decimated solutions.</p>
<p>In summary, by simplifying the early iterations of the CNMF algorithm (by removing the temporal deconvolution constraints to use fast HALS iterations on temporally and spatially subsampled data), we obtained remarkable speed-ups without compromising the accuracy of the obtained solution, at least in terms of the sum-of-squares objective function. But how do these modifications affect the extracted neural shapes and activity traces? We ran the algorithm without decimation until convergence and with decimation for 1 and 10 s respectively. <xref ref-type="fig" rid="pcbi.1005685.g002">Fig 2</xref> shows the results for three neurons with overlapping patches. Both shapes and activity traces agree well even if the decimated algorithm is run for merely 1 s (<xref ref-type="fig" rid="pcbi.1005685.g002">Fig 2B and 2C</xref>) and are nearly identical if run longer (<xref ref-type="fig" rid="pcbi.1005685.g002">Fig 2D</xref>); hence, decimation does not impair the final obtained accuracy.</p>
<p>Our focus has been on speeding up CNMF, one computational bottleneck of the entire processing pipeline. For completeness, we report the times spent on each step of the pipeline in <xref ref-type="table" rid="pcbi.1005685.t001">Table 1</xref> and compare to the previous CNMF version of [<xref ref-type="bibr" rid="pcbi.1005685.ref008">8</xref>]. After loading, the data was decimated temporally by a factor of 30 to speed up the detection of the neural centers using the greedy initialization method from [<xref ref-type="bibr" rid="pcbi.1005685.ref008">8</xref>]. We further decimated spatially and ran fast HALS for 30 iterations before finally returning to the whole data and performing five final fast HALS iterations. Each trace was normalized by the fluorescence at the resting state (known as Δ<italic>F</italic>/<italic>F</italic>) to account for baseline drift using a running percentile filter. Finally, the fluorescence traces were denoised via sparse non-negative deconvolution, using the recently developed fast method of [<xref ref-type="bibr" rid="pcbi.1005685.ref018">18</xref>], which eliminated another computational bottleneck present in the original CNMF implementation (last row of <xref ref-type="table" rid="pcbi.1005685.t001">Table 1</xref>).</p>
<table-wrap id="pcbi.1005685.t001" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005685.t001</object-id>
<label>Table 1</label>
<caption>
<title>Timing of the entire pipeline for a zebrafish patch.</title>
</caption>
<alternatives>
<graphic id="pcbi.1005685.t001g" mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005685.t001" xlink:type="simple"/>
<table border="0" frame="box" rules="all">
<colgroup>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
</colgroup>
<thead>
<tr>
<th align="center">CNMF method</th>
<th align="center">[<xref ref-type="bibr" rid="pcbi.1005685.ref008">8</xref>]</th>
<th align="right">here &amp; [<xref ref-type="bibr" rid="pcbi.1005685.ref018">18</xref>]</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center" style="background-color:#DFDFDF">load data<xref ref-type="table-fn" rid="t001fn002"><sup>†</sup></xref></td>
<td align="center" style="background-color:#DFDFDF">22 ± 1</td>
<td align="right" style="background-color:#DFDFDF">22 ± 1</td>
</tr>
<tr>
<td align="center">decimate</td>
<td align="center">N/A</td>
<td align="right">33 ± 1</td>
</tr>
<tr>
<td align="center" style="background-color:#DFDFDF">detect ROIs<xref ref-type="table-fn" rid="t001fn003"><sup>‡</sup></xref></td>
<td align="center" style="background-color:#DFDFDF">5,360 ± 20</td>
<td align="right" style="background-color:#DFDFDF">135 ± 2</td>
</tr>
<tr>
<td align="center">NMF</td>
<td align="center">35,100 ± 400</td>
<td align="right">990 ± 10</td>
</tr>
<tr>
<td align="center" style="background-color:#DFDFDF">Δ<italic>F</italic>/<italic>F</italic></td>
<td align="center" style="background-color:#DFDFDF">410 ± 10</td>
<td align="right" style="background-color:#DFDFDF">410 ± 10</td>
</tr>
<tr>
<td align="center">denoise</td>
<td align="center">17,900 ± 300</td>
<td align="right">600 ± 20</td>
</tr>
</tbody>
</table>
</alternatives>
<table-wrap-foot>
<fn id="t001fn001">
<p>Average computing time (± SEM) in ms over ten runs for individual steps of the processing pipeline on a standard laptop. The 96×96 patch contained <italic>N</italic> = 46 neurons recorded for <italic>T</italic> = 3000 frames.</p>
</fn>
<fn id="t001fn002">
<p><sup>†</sup>Loading the whole data as single binary file; loading a frame at a time was an order of magnitude slower.</p>
</fn>
<fn id="t001fn003">
<p><sup>‡</sup>Using greedy initialization; group lasso initialization [<xref ref-type="bibr" rid="pcbi.1005685.ref008">8</xref>] was an order of magnitude slower.</p>
</fn>
</table-wrap-foot>
</table-wrap>
</sec>
<sec id="sec004">
<title>Decimation can enable faster imaging of larger populations</title>
<p>We have shown that decimation leads to much faster computational processing of calcium video data. More importantly, these results inspired us next to propose a method for faster image acquisition or for imaging larger neural populations. The basic idea is quite simple: if we can estimate the quantities of interest (<italic>A</italic> and <italic>C</italic>) well given decimated data, then why collect data at the full resolution at all? Since spatial decimation by a factor of <italic>l</italic> conceptually reduces the number of pixels recorded over a given FOV by a factor of <italic>l</italic><sup>2</sup> (though of course this situation is slightly more complex in the case of scanning two-photon imaging; we will come back to this issue below), we should be able to use our newly-expanded pixel budget to image more cells, or image the same population of cells faster.</p>
<p>As we will see below, this basic idea can be improved upon significantly: if we have a good estimate for the spatial neural shape matrix <italic>A</italic> at the original spatial resolution, then we can decimate more drastically (thus increasing this <italic>l</italic><sup>2</sup> factor) with minimal loss in accuracy of the estimated activity <italic>C</italic>. This, finally, leads to the major proposal of this paper: first perform imaging with standard spatial resolution via conventional imaging protocols. Next perform the ROI detection and CNMF described above to obtain a good estimate of <italic>A</italic>. Then begin acquiring spatially <italic>l</italic>-decimated images and use the <italic>C</italic>-estimation step of CNMF to extract and demix the imaged activity. As we will see below, this two-phase imaging approach can potentially enable the accurate extraction of demixed neural activity even given quite large decimation factors <italic>l</italic>, with a correspondingly large increase in the resulting “imaging budget.”</p>
<sec id="sec005">
<title>Light-sheet imaging</title>
<p>We began by quantifying the potential effectiveness of this strategy using the zebrafish light-sheet imaging data examined in the last section. We emulated the decrease in spatial resolution by decimating the original imaging data as well as the neural shapes we had obtained by the CNMF approach, with a variety of decimation factors <italic>l</italic>. Then we used these decimated shapes <italic>A</italic><sub><italic>l</italic></sub> to extract and demix the activities <italic>C</italic><sub><italic>l</italic></sub> from the corresponding downscaled data <italic>Y</italic><sub><italic>l</italic></sub>. The reconstruction based on <italic>A</italic><sub>1</sub> and <italic>C</italic><sub><italic>l</italic></sub> fits the original data <italic>Y</italic> well, as measured by the RSS (<xref ref-type="fig" rid="pcbi.1005685.g003">Fig 3B</xref>, orange dashed line), whereas ‘single-phase’ imaging only fits the decimated data <italic>Y</italic><sub><italic>l</italic></sub> and thus does not capture the fine spatial structure present in <italic>Y</italic>. The reported low RSS values indicate that we capture the original data well even when the fluorescence traces are obtained on decimated data. However, we are not interested per se in low RSS values themselves (which could in general be undesirably achieved by overfitting), but in extracting the time series signal of each neuron well. Therefore, we evaluated the resulting <italic>C</italic><sub><italic>l</italic></sub> traces by comparing them to the original traces <italic>C</italic><sub>1</sub> obtained from the full original data <italic>Y</italic>. (In our notation if <italic>l</italic> = 1 then no decimation is applied.) <xref ref-type="fig" rid="pcbi.1005685.g003">Fig 3A</xref> shows that similar fluorescence traces are inferred even from quite heavily coarsened shapes <italic>A</italic><sub><italic>l</italic></sub>. The correlation between <italic>C</italic><sub>1</sub> and <italic>C</italic><sub><italic>l</italic></sub> decreases gracefully with the decimation factor <italic>l</italic> (<xref ref-type="fig" rid="pcbi.1005685.g003">Fig 3B</xref>, orange solid line). (We report Pearson correlation throughout this article as a basic similarity measure; using nonparametric Spearman correlation did not affect the conclusions.) In contrast, this correlation drops precipitously for relatively small values of <italic>l</italic> in the ‘single-phase’ imaging setting (cyan solid line), where we estimate the shapes <italic>A</italic><sub><italic>l</italic></sub> directly from <italic>Y</italic><sub><italic>l</italic></sub>, instead of estimating <italic>A</italic><sub>1</sub> from the full data <italic>Y</italic> first and then decimating to obtain <italic>A</italic><sub><italic>l</italic></sub>. The problem in this ‘single-phase’ imaging setting is that ROI detection fails catastrophically once the pixelization becomes too coarse. <xref ref-type="fig" rid="pcbi.1005685.g003">Fig 3A</xref> further shows traces (cyan) obtained in the ‘single-phase’ imaging setting, which markedly differ, in particularly for closely overlapping neurons. The middle trace clearly shows contributions from the upper trace, hence demixing these two neurons failed.</p>
<fig id="pcbi.1005685.g003" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005685.g003</object-id>
<label>Fig 3</label>
<caption>
<title>Low spatial resolution light-sheet imaging with previously identified cells.</title>
<p><bold>(A)</bold> Inferred traces for the three neurons in <xref ref-type="fig" rid="pcbi.1005685.g002">Fig 2</xref>. Shapes were decimated by averaging 2×2, 4×4 or 8×8 pixels. The legend shows the resulting shapes <italic>A</italic><sub><italic>l</italic></sub> as well as the correlation between the calcium traces <italic>C</italic><sub><italic>l</italic></sub> inferred from the decimated data versus the original traces <italic>C</italic><sub>1</sub> obtained from the non-decimated data. Further, the results obtained with merely 1-phase imaging for decimation by 8×8 pixels are shown as cyan traces. <bold>(B)</bold> Correlation (solid, left y-axis) between <italic>C</italic><sub><italic>l</italic></sub> and <italic>C</italic><sub>1</sub> for all cells recovered from this patch. Thick lines show the median, thin lines and shaded region the interquartile range (IQR). The correlation decays slowly as <italic>l</italic> increases for 2-phase imaging (orange) but drops abruptly if the shapes <italic>A</italic><sub><italic>l</italic></sub> are estimated directly from decimated data (cyan) instead of being decimated from the shapes <italic>A</italic><sub>1</sub> estimated from a standard-resolution imaging phase. Mean-squared-error (dashed, right y-axis) normalized so that without decimation the value is 1.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005685.g003" xlink:type="simple"/>
</fig>
<p>Thus the results are quite promising; with the two-phase imaging strategy we can effectively increase our imaging budget (as measured by <italic>l</italic><sup>2</sup>) by over an order of magnitude with minimal loss in the accuracy of the obtained activity traces <italic>C</italic><sub><italic>l</italic></sub>, and we also observe clear advantages of the two-phase over the single-phase decimation approaches. Finally, <xref ref-type="supplementary-material" rid="pcbi.1005685.s004">S1 Video</xref> illustrates the results in video form; we see there that we can recover essentially all the relevant information (at least visually) in the original video data <italic>Y</italic> from the spatially decimated video <italic>Y</italic><sub><italic>l</italic></sub>, even with quite large decimation levels <italic>l</italic> (<italic>l</italic> = 8 in <xref ref-type="supplementary-material" rid="pcbi.1005685.s004">S1 Video</xref>). Thus this decimation-then-demix approach could also provide a trivial compression scheme (with the estimation of <italic>C</italic><sub><italic>l</italic></sub> from <italic>Y</italic><sub><italic>l</italic></sub> and <italic>A</italic><sub><italic>l</italic></sub> serving as the decoder; here the compression ratio is <italic>l</italic><sup>2</sup>) that could be useful e.g. for wireless recordings, or any bandwidth- or memory-limited pipeline [<xref ref-type="bibr" rid="pcbi.1005685.ref019">19</xref>–<xref ref-type="bibr" rid="pcbi.1005685.ref021">21</xref>].</p>
</sec>
<sec id="sec006">
<title>Two-photon imaging</title>
<p>Turning towards imaging data acquired at a faster frame-rate, we next consider the case of a 2P calcium imaging dataset from mouse visual cortex acquired at 20 Hz. We chose ROIs based on the correlation image and max-projection image, cf. <xref ref-type="fig" rid="pcbi.1005685.g004">Fig 4A</xref> and <xref ref-type="supplementary-material" rid="pcbi.1005685.s005">S2 Video</xref>, and then obtained neural shapes <italic>A</italic><sub>1</sub> and fluorescence activity <italic>C</italic><sub>1</sub> using CNMF. The upper row in <xref ref-type="fig" rid="pcbi.1005685.g004">Fig 4</xref> (and <xref ref-type="supplementary-material" rid="pcbi.1005685.s005">S2 Video</xref>) shows the raw data <italic>Y</italic> and its reconstruction <italic>A</italic><sub>1</sub> ⋅ <italic>C</italic><sub>1</sub> based on CNMF, illustrating that all relevant ROIs have been detected and the matrix decomposition computed by CNMF captures the data well. The lower row shows the spatially decimated data <italic>Y</italic><sub><italic>l</italic></sub> and the reconstruction <italic>A</italic><sub>1</sub> ⋅ <italic>C</italic><sub><italic>l</italic></sub> based on sparse demixing of <italic>Y</italic><sub><italic>l</italic></sub> using knowledge of the neural shapes <italic>A</italic><sub>1</sub> from an initial cell identification imaging phase. As in the example in the last section, this illustrates that sparse demixing paired with cell shape identification applied to decimated data (panel D) captures the data virtually as well as CNMF without decimation (panel B). See <xref ref-type="supplementary-material" rid="pcbi.1005685.s005">S2 Video</xref> for full details.</p>
<fig id="pcbi.1005685.g004" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005685.g004</object-id>
<label>Fig 4</label>
<caption>
<title>Previously identified shapes allow reconstruction at high spatial resolution based on low resolution imaging (best seen in <xref ref-type="supplementary-material" rid="pcbi.1005685.s005">S2 Video</xref> for full details).</title>
<p><bold>(A)</bold> Max projection image of the raw data <italic>Y</italic> with identified ROIs, i.e. neurons or activity hotspots. Contour lines contain 90% of the energy of each neural shape. <bold>(B)</bold> Max projection image of the denoised estimate <italic>A</italic><sub>1</sub> ⋅ <italic>C</italic><sub>1</sub> (plus the estimated background). <bold>(C)</bold> Max projection image for data obtained at lower spatial resolution, <italic>Y</italic><sub><italic>l</italic></sub>; <italic>l</italic> = 16 here. <bold>(D)</bold> Reconstruction based on the low resolution data in (C) and previously identified shapes, <italic>A</italic><sub>1</sub> ⋅ <italic>C</italic><sub><italic>l</italic></sub>. The reconstruction looks very similar to the denoised high-resolution data of (B). Note: contours in (B-D) are not recomputed in each panel, but rather are copied from (A), to aid comparison.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005685.g004" xlink:type="simple"/>
</fig>
<p>
<xref ref-type="fig" rid="pcbi.1005685.g005">Fig 5</xref> shows, analogously to <xref ref-type="fig" rid="pcbi.1005685.g003">Fig 3A</xref>, the traces <italic>C</italic><sub><italic>l</italic></sub> recovered from spatially decimated data (using the 2-phase imaging approach) depend quite weakly on the decimation factor <italic>l</italic>, until <italic>l</italic> becomes so large that the resulting pixel size is comparable to the size of individual somas. In contrast, the traces recovered using the 1-phase imaging approach markedly differ from <italic>C</italic><sub>1</sub> even for small <italic>l</italic>. We also deconvolved the estimated calcium transients <italic>C</italic><sub><italic>l</italic></sub> into estimates of neural activity <italic>S</italic><sub><italic>l</italic></sub>, using the sparse non-negative deconvolution method described in [<xref ref-type="bibr" rid="pcbi.1005685.ref008">8</xref>, <xref ref-type="bibr" rid="pcbi.1005685.ref022">22</xref>]; we see similarly weak dependence of the results on <italic>l</italic> when comparisons are performed on this deconvolved activity. The ROIs were rank-sorted using a combination of maximal fluorescence intensity and a measure of the compactness of the neural shape (see <xref ref-type="sec" rid="sec008">Methods</xref>); we find that the similarity between <italic>C</italic><sub>1</sub> and <italic>C</italic><sub><italic>l</italic></sub> is strongest for the highest-ranked ROIs.</p>
<fig id="pcbi.1005685.g005" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005685.g005</object-id>
<label>Fig 5</label>
<caption>
<title>Inferred denoised and deconvolved traces for ROIs with rank 1, 40, 80 and 120 (top to bottom) out of a total of <italic>N</italic> = 187 ROIs in the 2P dataset.</title>
<p>In each row, a denoised trace from <italic>C</italic><sub><italic>l</italic></sub> is shown above the corresponding deconvolved trace from <italic>S</italic><sub><italic>l</italic></sub>. Shapes were decimated by averaging 4×4 or 16×16 pixels. The legend shows the resulting shapes <italic>A</italic><sub><italic>l</italic></sub> as well as the correlation of the inferred denoised fluorescence <italic>C</italic><sub><italic>l</italic></sub> versus the estimate <italic>C</italic><sub>1</sub> obtained without decimation. Further, the results obtained with merely 1-phase imaging for decimation by 4×4 pixels are shown as cyan traces.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005685.g005" xlink:type="simple"/>
</fig>
<p>We summarize the results over all neurons in this dataset in <xref ref-type="fig" rid="pcbi.1005685.g006">Fig 6</xref>. As in the examples shown in <xref ref-type="fig" rid="pcbi.1005685.g005">Fig 5</xref>, we see that the mean correlation between <italic>C</italic><sub>1</sub> and <italic>C</italic><sub><italic>l</italic></sub> decreases gracefully with <italic>l</italic> in the 2-phase imaging setting (orange lines). In contrast, the correlation decays much more sharply if the shapes <italic>A</italic><sub><italic>l</italic></sub> were obtained directly on low-resolution data (1 phase imaging; cyan lines), similarly but more dramatically than in <xref ref-type="fig" rid="pcbi.1005685.g003">Fig 3B</xref>. Similar results hold for the deconvolved activity <italic>S</italic><sub>1</sub> and <italic>S</italic><sub><italic>l</italic></sub> (dashed), though the correlation between <italic>S</italic><sub>1</sub> and <italic>S</italic><sub><italic>l</italic></sub> does decay more quickly than does the correlation between <italic>C</italic><sub>1</sub> and <italic>C</italic><sub><italic>l</italic></sub>. <xref ref-type="fig" rid="pcbi.1005685.g006">Fig 6C</xref> shows that the decrease in correlation is more pronounced for lower ranked ROIs; i.e., if we restrict attention to the most clearly-identified cells then we can safely spatially decimate even more aggressively. Smaller sized structures are more sensitive to binning, as shown in <xref ref-type="supplementary-material" rid="pcbi.1005685.s001">S1 Fig</xref>, which depicts all neural footprints sorted by increasing reconstruction loss for 16×16 decimation.</p>
<fig id="pcbi.1005685.g006" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005685.g006</object-id>
<label>Fig 6</label>
<caption>
<title>Quantifying the impact of decimation for 2P data.</title>
<p><bold>(A)</bold> Summary of correlations between denoised traces <italic>C</italic><sub>1</sub> and <italic>C</italic><sub><italic>l</italic></sub> and deconvolved traces <italic>S</italic><sub>1</sub> and <italic>S</italic><sub><italic>l</italic></sub>. Decimating in <italic>x</italic> and <italic>y</italic> direction. Thick lines show the median, thin lines and shaded region the IQR. The correlation of denoised fluorescence (solid) decays slowly for 2 phase imaging (orange) and abruptly if the shapes <italic>A</italic><sub><italic>l</italic></sub> are not inferred in the pre-screening phase but are instead estimated directly from downscaled data (cyan). The same holds for the deconvolved traces (dashed). <bold>(B)</bold> Analogous to (A), but with decimation applied just in the spatial horizontal direction. <bold>(C)</bold> Correlation of denoised fluorescence for each ROI plotted individually. Rank of ROI indicated by color; better ranked ROIs are less susceptible to decimation errors. <bold>(D-F)</bold> Analogous to (A-C), but comparing to simulated ground truth <italic>C</italic><sup>s</sup> instead of inferred <inline-formula id="pcbi.1005685.e001"><alternatives><graphic id="pcbi.1005685.e001g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e001" xlink:type="simple"/><mml:math display="inline" id="M1"><mml:msubsup><mml:mi>C</mml:mi> <mml:mn>1</mml:mn> <mml:mi mathvariant="normal">s</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula>. Traces were obtained on decimated simulated data with reshuffled residuals.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005685.g006" xlink:type="simple"/>
</fig>
<p>So far we have used the correlation between <italic>C</italic><sub>1</sub> and <italic>C</italic><sub><italic>l</italic></sub> (or <italic>S</italic><sub>1</sub> and <italic>S</italic><sub><italic>l</italic></sub>) to quantify the robustness of signal recovery from the decimated data <italic>Y</italic><sub><italic>l</italic></sub>. However, <italic>C</italic><sub>1</sub> and <italic>S</italic><sub>1</sub> should not be considered “ground truth”: these are merely estimates of the true underlying neural activity, inferred from noisy data <italic>Y</italic>, and it is not surprising that <italic>C</italic><sub>1</sub> and <italic>C</italic><sub><italic>l</italic></sub> are close for small values of <italic>l</italic>. A more critical question is the following: is <italic>C</italic><sub><italic>l</italic></sub> a significantly worse estimate of the true underlying neural activity <italic>C</italic> than <italic>C</italic><sub>1</sub>? Of course ground truth neural activity is not available for this dataset, but we can simulate data <italic>Y</italic><sup>s</sup> and compare how well <inline-formula id="pcbi.1005685.e002"><alternatives><graphic id="pcbi.1005685.e002g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e002" xlink:type="simple"/><mml:math display="inline" id="M2"><mml:msubsup><mml:mi>C</mml:mi> <mml:mn>1</mml:mn> <mml:mi mathvariant="normal">s</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1005685.e003"><alternatives><graphic id="pcbi.1005685.e003g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e003" xlink:type="simple"/><mml:math display="inline" id="M3"><mml:msubsup><mml:mi>C</mml:mi> <mml:mi>l</mml:mi> <mml:mi mathvariant="normal">s</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> recover the simulated ground truth <italic>C</italic><sup>s</sup>. To generate this simulated dataset, we started with <italic>A</italic><sup>s</sup> ≔ <italic>A</italic><sub>1</sub> and <italic>C</italic><sup>s</sup> ≔ <italic>C</italic><sub>1</sub> recovered from the full-resolution original data <italic>Y</italic>, and then generated a new simulated matrix <italic>Y</italic><sup>s</sup> = <italic>A</italic><sup>s</sup><italic>C</italic><sup>s</sup> + <italic>B</italic> + <italic>R</italic><sup>s</sup>, where <italic>B</italic> represents background terms and <italic>R</italic><sup>s</sup> is chosen to match the statistics of the original residual <italic>R</italic> = <italic>Y</italic> − <italic>A</italic><sub>1</sub><italic>C</italic><sub>1</sub> − <italic>B</italic> (specifically, for each pixel <italic>d</italic> we formed <inline-formula id="pcbi.1005685.e004"><alternatives><graphic id="pcbi.1005685.e004g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e004" xlink:type="simple"/><mml:math display="inline" id="M4"><mml:msubsup><mml:mi>R</mml:mi> <mml:mi>d</mml:mi> <mml:mi mathvariant="normal">s</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> by randomly re-ordering the original corresponding residual time series <italic>R</italic><sub><italic>d</italic></sub> in that pixel while keeping the link between variance and mean; see <xref ref-type="sec" rid="sec008">Methods</xref>. Adding Poisson noise instead of the reshuffled residual yielded similar results, <xref ref-type="supplementary-material" rid="pcbi.1005685.s002">S2 Fig</xref>). Then we estimated <inline-formula id="pcbi.1005685.e005"><alternatives><graphic id="pcbi.1005685.e005g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e005" xlink:type="simple"/><mml:math display="inline" id="M5"><mml:msubsup><mml:mi>A</mml:mi> <mml:mn>1</mml:mn> <mml:mi mathvariant="normal">s</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula>, <inline-formula id="pcbi.1005685.e006"><alternatives><graphic id="pcbi.1005685.e006g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e006" xlink:type="simple"/><mml:math display="inline" id="M6"><mml:msubsup><mml:mi>C</mml:mi> <mml:mn>1</mml:mn> <mml:mi mathvariant="normal">s</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1005685.e007"><alternatives><graphic id="pcbi.1005685.e007g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e007" xlink:type="simple"/><mml:math display="inline" id="M7"><mml:msubsup><mml:mi>S</mml:mi> <mml:mn>1</mml:mn> <mml:mi mathvariant="normal">s</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> from <italic>Y</italic><sup>s</sup>, and <inline-formula id="pcbi.1005685.e008"><alternatives><graphic id="pcbi.1005685.e008g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e008" xlink:type="simple"/><mml:math display="inline" id="M8"><mml:msubsup><mml:mi>C</mml:mi> <mml:mi>l</mml:mi> <mml:mi mathvariant="normal">s</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1005685.e009"><alternatives><graphic id="pcbi.1005685.e009g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e009" xlink:type="simple"/><mml:math display="inline" id="M9"><mml:msubsup><mml:mi>S</mml:mi> <mml:mi>l</mml:mi> <mml:mi mathvariant="normal">s</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> from decimated versions of <italic>Y</italic><sup>s</sup>, and compared the results in <xref ref-type="fig" rid="pcbi.1005685.g006">Fig 6D–6F</xref>. We see some important differences compared to <xref ref-type="fig" rid="pcbi.1005685.g006">Fig 6A–6C</xref>: the correlation curves no longer approach 1 as the decimation level <italic>l</italic> decreases towards 1 (for example, the mean correlation between ground truth and recovered <italic>S</italic><sup>s</sup> is about 0.8 even if no decimation is applied), and the correlation between ground truth and the recovered <inline-formula id="pcbi.1005685.e010"><alternatives><graphic id="pcbi.1005685.e010g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e010" xlink:type="simple"/><mml:math display="inline" id="M10"><mml:msubsup><mml:mi>C</mml:mi> <mml:mi>l</mml:mi> <mml:mi mathvariant="normal">s</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> (or <inline-formula id="pcbi.1005685.e011"><alternatives><graphic id="pcbi.1005685.e011g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e011" xlink:type="simple"/><mml:math display="inline" id="M11"><mml:msubsup><mml:mi>S</mml:mi> <mml:mi>l</mml:mi> <mml:mi mathvariant="normal">s</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula>) now decreases much more slowly as a function of <italic>l</italic>—indicating that signal recovery from spatially decimated data is even more robust than indicated in <xref ref-type="fig" rid="pcbi.1005685.g006">Fig 6A–6C</xref>. On the other hand, we continue to observe similar strong differences in recovery when comparing the 1- and 2-phase imaging results.</p>
<p>The autoregressive model for the calcium dynamics are of course not exact. Thus as a further control simulation we generated another dataset that used Poisson noise and ground truth fluorescence <italic>C</italic> obtained by convolving the spike trains and response kernels from a study that combined electrophysiological recordings and calcium imaging with GCaMP6f or GCaMP6s [<xref ref-type="bibr" rid="pcbi.1005685.ref023">23</xref>, <xref ref-type="bibr" rid="pcbi.1005685.ref024">24</xref>] (see <xref ref-type="sec" rid="sec008">Methods</xref>). Although the real calcium responses do not exactly follow the autoregressive assumptions, our model gives reasonable results, even in the context of spatial decimation (<xref ref-type="supplementary-material" rid="pcbi.1005685.s003">S3 Fig</xref>).</p>
<p>In practice we envision that the first phase of cell identification will only be performed on a small initial batch of the data (and maybe also at the end of the experiment to check for consistency). Therefore we experimented with reducing the amount of data used to infer the neural shapes from the full data (2,000 frames, 100 s) to 1,000 frames (50 s) and 500 frames (25 s) respectively. <xref ref-type="fig" rid="pcbi.1005685.g007">Fig 7A</xref> shows the shapes inferred based on the full data (orange) or using only the first half (blue) with a max projection of the first half of the data as background. While some neural shapes are less well defined using less data, we only seem to miss two suspects entirely (white arrows). However, closer inspection reveals that these ROIs are not missed neurons, but rather are highly correlated with and actually part of the neuron indicated by the blue arrow—so in this example 50 seconds was sufficient to identify all the necessary neural shapes. (If there were neurons missed in the first phase, we could in principle incorporate a new-neuron-detection step in the second phase, but this has not yet proven necessary in our experiments.) <xref ref-type="fig" rid="pcbi.1005685.g007">Fig 7B and 7C</xref> report the correlation values measured only on the second half of the data, using shapes <italic>A</italic> estimated just with the first half. The close proximity of the orange and blue trace is further evidence that the shapes <italic>A</italic> can be estimated sufficiently in a short pre-screening phase. Interestingly, estimating the shapes based on merely 500 frames leads to some slight overfitting; the correlation values shown here actually increase slightly for small decimation factors because decimation serves to partially regularize the overfitted shapes.</p>
<fig id="pcbi.1005685.g007" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005685.g007</object-id>
<label>Fig 7</label>
<caption>
<title>Estimating neural shapes on small initial batch of the data.</title>
<p><bold>(A)</bold> Shapes inferred on the full data (orange) or using only the first half (blue). Two apparently lost suspected ROIs (white arrows) are actually part of another neuron (blue arrow) <bold>(B)</bold> Average correlation (±SEM) between traces <italic>C</italic><sub><italic>l</italic></sub> obtained on decimated data and the reference <italic>C</italic><sub>1</sub> obtained without any decimation. Similar results hold for median and IQR, but the resulting plot is too cluttered. <bold>(C)</bold> Comparing to simulated ground truth <italic>C</italic><sup>s</sup>. Traces were obtained on decimated data with reshuffled residuals, otherwise analogous to (B).</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005685.g007" xlink:type="simple"/>
</fig>
<p>Finally, we investigated whether it would be possible to further improve the recovery of <italic>C</italic><sub><italic>l</italic></sub> from very highly decimated data via an interleaving strategy [<xref ref-type="bibr" rid="pcbi.1005685.ref025">25</xref>]. Instead of using the same large pixels on each frame, e.g. the ones corresponding to the cyan grid in <xref ref-type="fig" rid="pcbi.1005685.g008">Fig 8A</xref>, we alternate between imaging with the cyan pixelization and the half-shifted orange pixelization. This is helpful, for example, in distinguishing the activity of neurons 20 and 39: based on merely cyan pixels, these neurons contribute to only one and the same pixel and distinguishing their activity would therefore be impossible, whereas the information from the orange pixels afford their separation. It is straightforward to generalize the demixing strategy to exploit the information from the cyan and orange grids at alternating time points (see <xref ref-type="sec" rid="sec008">Methods</xref>); <xref ref-type="fig" rid="pcbi.1005685.g008">Fig 8B and 8C</xref> show that this interleaving is indeed able to improve recovery at very large decimation levels <italic>l</italic>.</p>
<fig id="pcbi.1005685.g008" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005685.g008</object-id>
<label>Fig 8</label>
<caption>
<title>Interleaving improves accuracy of recovered <italic>C</italic><sub><italic>l</italic></sub> at low spatial resolution.</title>
<p><bold>(A)</bold> Interleaving alternates between pixels corresponding to the cyan and orange grid. <bold>(B)</bold> Correlation between traces <italic>C</italic><sub><italic>l</italic></sub> obtained on decimated data and the reference <italic>C</italic><sub>1</sub> obtained without any decimation. The average correlation (±SEM) decays faster without (cyan) than with interleaving (green). Similar results hold for median and IQR, but the resulting plot is too cluttered. <bold>(C)</bold> Comparing to simulated ground truth <italic>C</italic><sup>s</sup>. Traces were obtained on decimated data with reshuffled residuals, otherwise analogous to (B).</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005685.g008" xlink:type="simple"/>
</fig>
</sec>
</sec>
</sec>
<sec id="sec007" sec-type="conclusions">
<title>Discussion</title>
<p>The basic message of this paper is that standard approaches for imaging calcium responses in large neuronal population—which have historically been optimized so that humans can clearly see cells blink in the resulting video—lead to highly redundant data, and we can exploit this redundancy in several ways. In the first part of the paper, we saw that we can decimate standard calcium imaging video data drastically, to obtain order-of-magnitude speedups in processing time with no loss (and in some cases even some gain) in accuracy of the recovered signals. In the second part of the paper, we saw that, once the cell shapes and locations are identified, we can drastically reduce the spatial resolution of the recording (losing the ability to cleanly identify cells by eye in the resulting heavily-pixelated movies) but still faithfully recover the neural activity of interest. This in turn leads naturally to a proposed two-phase imaging approach (first, identify cell shapes and locations at standard resolution; then image at much lower spatial resolution) that can be seen as an effort to reduce the redundancy of the resulting video data.</p>
<p>We anticipate a number of applications of the results presented here. Regarding the first part of the paper: faster computational processing times are always welcome, of course, but more fundamentally, the faster algorithms developed here open the door towards guided experimental design, in which experimenters can obtain images, process the data quickly, and immediately use this to guide the next experiment. With more effort this closed-loop approach can potentially be implemented in real-time, whether for improving optical brain-machine interfaces [<xref ref-type="bibr" rid="pcbi.1005685.ref026">26</xref>], or enabling closed-loop optogenetic control of neuronal population dynamics [<xref ref-type="bibr" rid="pcbi.1005685.ref027">27</xref>, <xref ref-type="bibr" rid="pcbi.1005685.ref028">28</xref>].</p>
<p>Highly redundant data streams are by definition highly compressible. The results shown in <xref ref-type="supplementary-material" rid="pcbi.1005685.s004">S1</xref> and <xref ref-type="supplementary-material" rid="pcbi.1005685.s005">S2</xref> Videos illustrate clearly that spatially-decimated image acquisition (the second phase of our two-phase imaging approach) can be seen as a computationally trivial low-loss compression scheme. Again, regarding applications of this compression viewpoint: reductions in memory usage are always welcome—but more fundamentally, this type of compression could for example help enable wireless applications in which bandwidth and power-budget limitations are currently a significant bottleneck [<xref ref-type="bibr" rid="pcbi.1005685.ref021">21</xref>, <xref ref-type="bibr" rid="pcbi.1005685.ref029">29</xref>–<xref ref-type="bibr" rid="pcbi.1005685.ref031">31</xref>].</p>
<p>Regarding applications of the proposed two-phase imaging approach: we can potentially use this approach to image either more cells, or image cells faster, or some combination of both. In most of the paper we have emphasized the first case, in which we ‘zoom out’ to image larger populations at standard temporal resolution. However, a number of applications require higher temporal resolution. One exciting example is the larval zebrafish, where it is already possible to image the whole brain, but light-sheet whole-brain volumetric imaging rates are low [<xref ref-type="bibr" rid="pcbi.1005685.ref001">1</xref>] and current efforts are focused on faster acquisition [<xref ref-type="bibr" rid="pcbi.1005685.ref003">3</xref>, <xref ref-type="bibr" rid="pcbi.1005685.ref004">4</xref>, <xref ref-type="bibr" rid="pcbi.1005685.ref032">32</xref>]. Higher temporal resolution is also needed for circuit connectivity inference [<xref ref-type="bibr" rid="pcbi.1005685.ref033">33</xref>, <xref ref-type="bibr" rid="pcbi.1005685.ref034">34</xref>] or the real-time closed-loop applications discussed above, where we need to detect changes in activity as quickly as possible. Finally, genetically encoded voltage indicators [<xref ref-type="bibr" rid="pcbi.1005685.ref035">35</xref>] may soon enable imaging of neuronal populations with single-cell, millisecond-scale resolution; these indicators are still undergoing intense development [<xref ref-type="bibr" rid="pcbi.1005685.ref036">36</xref>–<xref ref-type="bibr" rid="pcbi.1005685.ref039">39</xref>] but when more mature the resulting signals will be much faster than currently-employed calcium indicators and significantly higher temporal resolution will be required to capture these signals.</p>
<p>A number of previous papers can be interpreted in terms of reducing the redundancy of the output image data. Our work can be seen as one example of the general theme of increasing the ratio <italic>N</italic>/<italic>D</italic>, with <italic>N</italic> denoting the number of imaged neurons and <italic>D</italic> the number of observations per timestep, with demixing algorithms used post hoc to separate the overlapping contributions of each cell to each observed pixel. In a compressed sensing framework, [<xref ref-type="bibr" rid="pcbi.1005685.ref040">40</xref>] proposed to image randomized projections of the spatial calcium concentration at each timestep, instead of measuring the concentration at individual locations. In [<xref ref-type="bibr" rid="pcbi.1005685.ref041">41</xref>], [<xref ref-type="bibr" rid="pcbi.1005685.ref042">42</xref>], and [<xref ref-type="bibr" rid="pcbi.1005685.ref043">43</xref>], information is integrated primarily across depth, either by creating multiple foci, axially extended point spread functions (PSFs), or both, respectively. In contrast to these methods, [<xref ref-type="bibr" rid="pcbi.1005685.ref007">7</xref>] instead scanned an enlarged near-isotropic PSF, generated with temporal focusing, to quickly interrogate cells in a single plane at low spatial resolution. This approach is closest in spirit to the one-phase spatially decimated imaging approach analyzed in Figs <xref ref-type="fig" rid="pcbi.1005685.g006">6</xref>–<xref ref-type="fig" rid="pcbi.1005685.g008">8</xref>, and could potentially be combined with our two-phase approach to achieve further speed/accuracy gains.</p>
<p>We expect that different strategies for increasing <italic>N</italic>/<italic>D</italic> will have different advantages in different situations. One advantage of the approach developed here is its apparent simplicity—at least at a conceptual level, we just need to ‘zoom out’ without the need for radically new imaging hardware. Throughout this work we have remained deliberately agnostic regarding the physical implementation of the spatial decimation; all of the decimation results presented here were based on software decimation after acquisition of standard-resolution images. Thus to close we turn now to a discussion of potential experimental caveats.</p>
<p>One critical assumption in our simulations is that the total recorded photon flux per frame is the same for each decimation level <italic>l</italic>. This is a reasonable assumption for light-sheet imaging (assuming we are not limited by laser power or by the peak or average light power on the sample): in this case, increasing the effective pixel size could be achieved easily, either isotropically with a telescope, or anisotropically, with a cylindrical lens or anamorphic prism pair. However, faster whole-brain light-sheet imaging requires faster shifts of the light sheet and imaged focal plane. This challenge can be solved by extended depth-of-field (EDoF) pupil encoding [<xref ref-type="bibr" rid="pcbi.1005685.ref003">3</xref>, <xref ref-type="bibr" rid="pcbi.1005685.ref004">4</xref>, <xref ref-type="bibr" rid="pcbi.1005685.ref032">32</xref>], remote focusing [<xref ref-type="bibr" rid="pcbi.1005685.ref044">44</xref>], or with an electrically tunable lens [<xref ref-type="bibr" rid="pcbi.1005685.ref045">45</xref>]. Higher light-sheet imaging rates can also be obtained with swept confocally-aligned planar excitation (SCAPE) microscopy [<xref ref-type="bibr" rid="pcbi.1005685.ref006">6</xref>]. In short, we believe our proposed two-phase imaging approach fits well with a variety of proven light sheet methods; for similar reasons, the two-phase approach would also fit well with light-field imaging methods [<xref ref-type="bibr" rid="pcbi.1005685.ref046">46</xref>–<xref ref-type="bibr" rid="pcbi.1005685.ref048">48</xref>].</p>
<p>In traditional two-photon imaging the situation is more complicated. The image is created by serially sweeping a small, diffraction limited point across the sample. Along the “fast” axis, the beam moves continuously, and the integrated signal across a line is constant, regardless of detection pixelation—the signal is simply partitioned into more or fewer bins. Along the “slow” axis, however, the galvonometers are moved in discrete steps, and low pixel numbers generally mean that portions of the image are not scanned, increasing frame speed, but concomitantly these ‘missed’ areas generate no signal. This consequently reduces the total number of photons collected. Thus to achieve the same photon flux over the larger (lower spatially sampled) pixels, while maintaining the same SNR, we require an enlarged PSF, which maps a larger sampled volume to each pixel. This approach was recently demonstrated to be effective in [<xref ref-type="bibr" rid="pcbi.1005685.ref007">7</xref>]; alternative strategies for enlarging the PSF could involve fixed diffractive optical elements [<xref ref-type="bibr" rid="pcbi.1005685.ref049">49</xref>] or spatial light modulator (SLM) systems [<xref ref-type="bibr" rid="pcbi.1005685.ref050">50</xref>]. Programmable phase-only SLMs offer the additional benefit of being able to dynamically change the size and shape of the excitation PSF, even between frames, which may help disambiguate closely spaced sources, and effectively control the recorded source sparsity.</p>
<p>In any instantiation, maximal imaging speed will be limited by the time required to collect enough photons for adequate SNR, which in turn is limited by photophysics and the light tolerance of the sample. In future work we plan to pursue both light-sheet and 2P implementations of the proposed two-phase imaging approach, to quantify the gains in speed and FOV size that can be realized in practice.</p>
<p>We also expect techniques for denoising, demixing, and deconvolution of calcium imaging video to continue to improve in the near future, as more accurate nonlinear, non-Gaussian models for calcium signals and noise are developed; as new demixing methods become available, we can easily swap these methods in in place of the CNMF approach used here. We expect that the basic points about temporal and spatial decimation discussed in this paper will remain valid even as newer and better demixing algorithms become available.</p>
</sec>
<sec id="sec008" sec-type="materials|methods">
<title>Methods</title>
<sec id="sec009">
<title>Ethics statement</title>
<p>Light-sheet imaging of zebrafish was conducted according to protocols approved by the Institutional Animal Care and Use Committee of the Howard Hughes Medical Institute, Janelia Research Campus. Two-photon imaging of mouse was carried out in accordance with animal protocols approved by the Columbia University Institutional Animal Care and Use Committee.</p>
</sec>
<sec id="sec010">
<title>Neural data acquisition</title>
<p>The calcium fluorescence of the whole brain of a larval zebrafish was recorded using light-sheet imaging. It was a transgenic (GCaMP6f) zebrafish embedded in agarose but with the agarose around the tail removed. The fish was in a fictive swimming virtual environment as described in [<xref ref-type="bibr" rid="pcbi.1005685.ref051">51</xref>]. The closed loop setting, characterized by visual feedback being aligned with the recorded motor activity, was periodically interrupted by open loop phases. Whole-brain activity was recorded for 1,500 seconds with a rate of 2 volumes per second.</p>
<p>In vivo two-photon imaging was performed in a transgenic (GCaMP6s) mouse through a cranial window in visual cortex. The mouse was anesthetized (isoflurane) and head-fixed on a Bruker Ultima in vivo microscope with resonant scanners, and spontaneous activity was recorded. The field of view extended over 350 μm × 350 μm and was recorded for 100 seconds with a resolution of 512×512 pixels at 20 frames per second.</p>
</sec>
<sec id="sec011">
<title>Constrained non-negative matrix factorization</title>
<p>In the case of 2P imaging, the field of view contained <italic>N</italic> = 187 ROIs. It was observed for a total number of <italic>T</italic> = 2,000 timesteps and had a total number of <italic>D</italic> = 512×512 pixels. We restricted our analysis of the zebrafish data to a representative patch of size <italic>D</italic> = 96×96 pixels containing <italic>N</italic> = 46 ROIs, extracted from a medial z-layer of the whole-brain light-sheet imaging recording of <italic>T</italic> = 3,000 frames. The observations at any point in time can be vectorized in a single column vector of length <italic>D</italic>; thus all the observations can be described by a <italic>D</italic> × <italic>T</italic> matrix <italic>Y</italic>. Following [<xref ref-type="bibr" rid="pcbi.1005685.ref008">8</xref>], we model <italic>Y</italic> as
<disp-formula id="pcbi.1005685.e012"><alternatives><graphic id="pcbi.1005685.e012g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e012" xlink:type="simple"/><mml:math display="block" id="M12"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>Y</mml:mi> <mml:mo>=</mml:mo> <mml:mi>A</mml:mi> <mml:mi>C</mml:mi> <mml:mo>+</mml:mo> <mml:mi mathvariant="bold-italic">b</mml:mi> <mml:msup><mml:mi mathvariant="bold-italic">f</mml:mi> <mml:mi>⊤</mml:mi></mml:msup> <mml:mo>+</mml:mo> <mml:mi>E</mml:mi></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(1)</label></disp-formula>
where <inline-formula id="pcbi.1005685.e013"><alternatives><graphic id="pcbi.1005685.e013g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e013" xlink:type="simple"/><mml:math display="inline" id="M13"><mml:mrow><mml:mi>A</mml:mi> <mml:mo>∈</mml:mo> <mml:msubsup><mml:mi mathvariant="double-struck">R</mml:mi> <mml:mo>+</mml:mo> <mml:mrow><mml:mi>D</mml:mi> <mml:mo>×</mml:mo> <mml:mi>N</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula> is a spatial matrix that encodes the location and shape of each neuron, <inline-formula id="pcbi.1005685.e014"><alternatives><graphic id="pcbi.1005685.e014g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e014" xlink:type="simple"/><mml:math display="inline" id="M14"><mml:mrow><mml:mi>C</mml:mi> <mml:mo>∈</mml:mo> <mml:msubsup><mml:mi mathvariant="double-struck">R</mml:mi> <mml:mo>+</mml:mo> <mml:mrow><mml:mi>N</mml:mi> <mml:mo>×</mml:mo> <mml:mi>T</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula> is a temporal matrix that characterizes the calcium concentration of each neuron over time, <inline-formula id="pcbi.1005685.e015"><alternatives><graphic id="pcbi.1005685.e015g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e015" xlink:type="simple"/><mml:math display="inline" id="M15"><mml:mrow><mml:mi mathvariant="bold-italic">b</mml:mi> <mml:mo>∈</mml:mo> <mml:msubsup><mml:mi mathvariant="double-struck">R</mml:mi> <mml:mo>+</mml:mo> <mml:mi>D</mml:mi></mml:msubsup> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">f</mml:mi> <mml:mo>∈</mml:mo> <mml:msup><mml:mi mathvariant="double-struck">R</mml:mi> <mml:mi>T</mml:mi></mml:msup></mml:mrow></mml:math></alternatives></inline-formula> are nonnegative vectors encoding the background spatial structure and global intensity, respectively, and <italic>E</italic> is additive Gaussian noise with mean zero and diagonal covariance. Our model assumes a linear relationship between fluorescence and calcium concentration as well as Gaussian noise. As emphasized in [<xref ref-type="bibr" rid="pcbi.1005685.ref008">8</xref>], more elaborate models for <italic>C</italic> can be incorporated in the alternating updates, but we did not pursue this generalization here.</p>
<p>For the zebrafish data we ensured that the spatial components are localized, by constraining them to lie within spatial patches (which are not large compared to the size of the cell body) around the neuron centers, thus imposing sparsity on <italic>A</italic> by construction. Because of the low temporal resolution of these recordings, the inferred neural activity vectors are not expected to be particularly sparse, and therefore we do not impose sparsity in the temporal domain. This leads to the optimization problem
<disp-formula id="pcbi.1005685.e016"><alternatives><graphic id="pcbi.1005685.e016g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e016" xlink:type="simple"/><mml:math display="block" id="M16"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:munder><mml:mtext>minimize</mml:mtext> <mml:mrow><mml:mi>A</mml:mi> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">b</mml:mi> <mml:mo>,</mml:mo> <mml:mi>C</mml:mi> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">f</mml:mi></mml:mrow></mml:munder> <mml:mrow><mml:mo>∥</mml:mo> <mml:mi>Y</mml:mi> <mml:mo>-</mml:mo> <mml:mi>A</mml:mi> <mml:mi>C</mml:mi> <mml:mo>-</mml:mo> <mml:mi mathvariant="bold-italic">b</mml:mi> <mml:msup><mml:mi mathvariant="bold-italic">f</mml:mi> <mml:mi>⊤</mml:mi></mml:msup> <mml:mo>∥</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:mtext>subject to</mml:mtext> <mml:mo>:</mml:mo> <mml:mi>A</mml:mi> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">b</mml:mi> <mml:mo>,</mml:mo> <mml:mi>C</mml:mi> <mml:mo>≥</mml:mo> <mml:mn>0</mml:mn> <mml:mo>,</mml:mo> <mml:mspace width="3.33333pt"/><mml:mi>A</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>d</mml:mi> <mml:mo>,</mml:mo> <mml:mi>n</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:mn>0</mml:mn> <mml:mspace width="0.277778em"/><mml:mspace width="3.33333pt"/><mml:mo>∀</mml:mo> <mml:mi>d</mml:mi> <mml:mo>∉</mml:mo> <mml:msub><mml:mi>P</mml:mi> <mml:mi>n</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(2)</label></disp-formula>
where <italic>P</italic><sub><italic>n</italic></sub> denotes the <italic>n</italic>-th fixed spatial patch. This problem is biconvex, i.e. solving for <italic>C</italic> and <bold><italic>f</italic></bold> with fixed <italic>A</italic> and <bold><italic>b</italic></bold> is a convex problem; likewise solving for <italic>A</italic> and <bold><italic>b</italic></bold> with fixed <italic>C</italic> and <bold><italic>f</italic></bold> is convex. As discussed in the Results section, we solve this problem by block-coordinate descent, first applied to much smaller decimated data and then using this solution as a warm start for the optimization on the full data. In the resulting Algorithm 1 we appended for concision <bold><italic>b</italic></bold> and <bold><italic>f</italic></bold> as an additional column or row to <italic>A</italic> and <italic>C</italic> respectively.</p>
<p>The matrix products <italic>A</italic><sup>⊤</sup><italic>Y</italic> and <italic>CY</italic><sup>⊤</sup> in Algorithm 1 are computationally expensive for the full data. These matrix products can also be performed on GPU instead CPU; whereas for the comparatively small 96×96 patches we did not obtain any speed-ups using a GPU, we verified on patches of size 256×256 that some modest overall speedups (a factor of 1.5–2) can be obtained by porting this step to a GPU.</p>
<p>For the decimated data the matrix products are cheap enough to iterate just once over all neurons and instead alternate more often between updating shapes and activities (instead of performing many iterations within HALS<sc>activity</sc> or HALS<sc>shape</sc> in Algorithm 1). In early iterations our estimates of <italic>A</italic> and <italic>C</italic> are changing significantly and it is better to perform just one block-coordinate descent step for each neuron to update <italic>A</italic> (and similarly for <italic>C</italic>); for later iterations, and on the full data where it is more expensive to compute <italic>A</italic><sup>⊤</sup><italic>Y</italic> and <italic>CY</italic><sup>⊤</sup>, we increase the inner iterations in HAL<sc>Sactivity</sc> or HALS<sc>shape</sc>.</p>
<table-wrap id="pcbi.1005685.t002" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1005685.t002</object-id>
<label>Algorithm 1</label>
<caption>
<title>NMF algorithm using localization constraints and spatio-temporal decimation</title>
</caption>
<alternatives>
<graphic id="pcbi.1005685.t002g" mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005685.t002" xlink:type="simple"/>
<table border="0" frame="box" rules="all">
<colgroup>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
</colgroup>
<tbody>
<tr>
<td align="left" colspan="2"><monospace><bold>Required</bold>: data <inline-formula id="pcbi.1005685.e017"><alternatives><graphic id="pcbi.1005685.e017g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e017" xlink:type="simple"/><mml:math display="inline" id="M17"><mml:mrow><mml:mi>Y</mml:mi> <mml:mo>∈</mml:mo> <mml:msubsup><mml:mi mathvariant="double-struck">R</mml:mi> <mml:mo>+</mml:mo> <mml:mrow><mml:mi>D</mml:mi> <mml:mo>×</mml:mo> <mml:mi>T</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula>, <italic>N</italic> neuron centers, number of iterations <inline-formula id="pcbi.1005685.e018"><alternatives><graphic id="pcbi.1005685.e018g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e018" xlink:type="simple"/><mml:math display="inline" id="M18"><mml:mover accent="true"><mml:mi>I</mml:mi> <mml:mo>˜</mml:mo></mml:mover></mml:math></alternatives></inline-formula> and <italic>I</italic></monospace></td>
</tr>
<tr>
<td align="left" colspan="2"><monospace>1: successively take mean of e.g. 30 frames        ⊳ operate on decimated data</monospace></td>
</tr>
<tr>
<td align="left" colspan="2"><monospace>2: initialize centers using greedy (or group lasso) method from [<xref ref-type="bibr" rid="pcbi.1005685.ref008">8</xref>]</monospace></td>
</tr>
<tr>
<td align="left" colspan="2"><monospace>3: downscale spatially using local mean: <inline-formula id="pcbi.1005685.e019"><alternatives><graphic id="pcbi.1005685.e019g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e019" xlink:type="simple"/><mml:math display="inline" id="M19"><mml:mrow><mml:mi>Y</mml:mi> <mml:mo>→</mml:mo> <mml:mover accent="true"><mml:mi>Y</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mo>∈</mml:mo> <mml:msubsup><mml:mi mathvariant="double-struck">R</mml:mi> <mml:mo>+</mml:mo> <mml:mrow><mml:mover accent="true"><mml:mi>D</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mo>×</mml:mo> <mml:mover accent="true"><mml:mi>T</mml:mi> <mml:mo>˜</mml:mo></mml:mover></mml:mrow></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula></monospace></td>
</tr>
<tr>
<td align="left" colspan="2"><monospace>4: generate patches <inline-formula id="pcbi.1005685.e020"><alternatives><graphic id="pcbi.1005685.e020g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e020" xlink:type="simple"/><mml:math display="inline" id="M20"><mml:mover accent="true"><mml:mi>P</mml:mi> <mml:mo>˜</mml:mo></mml:mover></mml:math></alternatives></inline-formula> around centers</monospace></td>
</tr>
<tr>
<td align="left" colspan="2"><monospace>5: initialize spatial background as 20% percentile, neural shapes as Gaussians within patch: <inline-formula id="pcbi.1005685.e021"><alternatives><graphic id="pcbi.1005685.e021g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e021" xlink:type="simple"/><mml:math display="inline" id="M21"><mml:mrow><mml:mover accent="true"><mml:mi>A</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mo>∈</mml:mo> <mml:msubsup><mml:mi mathvariant="double-struck">R</mml:mi> <mml:mo>+</mml:mo> <mml:mrow><mml:mover accent="true"><mml:mi>D</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mo>×</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>N</mml:mi> <mml:mo>+</mml:mo> <mml:mn>1</mml:mn> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula></monospace></td>
</tr>
<tr>
<td align="left" colspan="2"><monospace>6: initialize temporal background as <inline-formula id="pcbi.1005685.e022"><alternatives><graphic id="pcbi.1005685.e022g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e022" xlink:type="simple"/><mml:math display="inline" id="M22"><mml:msub><mml:mn mathvariant="bold">1</mml:mn> <mml:mover accent="true"><mml:mi>T</mml:mi> <mml:mo>˜</mml:mo></mml:mover></mml:msub></mml:math></alternatives></inline-formula>, neural activities as data at centers: <inline-formula id="pcbi.1005685.e023"><alternatives><graphic id="pcbi.1005685.e023g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e023" xlink:type="simple"/><mml:math display="inline" id="M23"><mml:mrow><mml:mover accent="true"><mml:mi>C</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mo>∈</mml:mo> <mml:msubsup><mml:mi mathvariant="double-struck">R</mml:mi> <mml:mo>+</mml:mo> <mml:mrow><mml:mrow><mml:mo>(</mml:mo> <mml:mi>N</mml:mi> <mml:mo>+</mml:mo> <mml:mn>1</mml:mn> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>×</mml:mo> <mml:mover accent="true"><mml:mi>T</mml:mi> <mml:mo>˜</mml:mo></mml:mover></mml:mrow></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula></monospace></td>
</tr>
<tr>
<td align="left" colspan="2"><monospace>7: <bold>for</bold> <italic>i</italic> = 1, …, <inline-formula id="pcbi.1005685.e024"><alternatives><graphic id="pcbi.1005685.e024g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e024" xlink:type="simple"/><mml:math display="inline" id="M24"><mml:mrow><mml:mover accent="true"><mml:mi>I</mml:mi> <mml:mo>˜</mml:mo></mml:mover></mml:mrow></mml:math></alternatives></inline-formula> <bold>do</bold></monospace></td>
</tr>
<tr>
<td align="left" colspan="2"><monospace>8:  <inline-formula id="pcbi.1005685.e025"><alternatives><graphic id="pcbi.1005685.e025g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e025" xlink:type="simple"/><mml:math display="inline" id="M25"><mml:mrow><mml:mover accent="true"><mml:mi>C</mml:mi> <mml:mo>˜</mml:mo></mml:mover></mml:mrow></mml:math></alternatives></inline-formula> ← HALS<sc>activity</sc>(<inline-formula id="pcbi.1005685.e026"><alternatives><graphic id="pcbi.1005685.e026g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e026" xlink:type="simple"/><mml:math display="inline" id="M26"><mml:mrow><mml:mover accent="true"><mml:mi>Y</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mo>,</mml:mo> <mml:mover accent="true"><mml:mi>A</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mo>,</mml:mo> <mml:mover accent="true"><mml:mi>C</mml:mi> <mml:mo>˜</mml:mo></mml:mover></mml:mrow></mml:math></alternatives></inline-formula>)</monospace></td>
</tr>
<tr>
<td align="left" colspan="2"><monospace>9:  <inline-formula id="pcbi.1005685.e027"><alternatives><graphic id="pcbi.1005685.e027g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e027" xlink:type="simple"/><mml:math display="inline" id="M27"><mml:mrow><mml:mover accent="true"><mml:mi>A</mml:mi> <mml:mo>˜</mml:mo></mml:mover></mml:mrow></mml:math></alternatives></inline-formula> ← HALS<sc>shape</sc>(<inline-formula id="pcbi.1005685.e028"><alternatives><graphic id="pcbi.1005685.e028g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e028" xlink:type="simple"/><mml:math display="inline" id="M28"><mml:mrow><mml:mover accent="true"><mml:mi>Y</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mo>,</mml:mo> <mml:mover accent="true"><mml:mi>A</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mo>,</mml:mo> <mml:mover accent="true"><mml:mi>C</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mo>,</mml:mo> <mml:mover accent="true"><mml:mi>P</mml:mi> <mml:mo>˜</mml:mo></mml:mover></mml:mrow></mml:math></alternatives></inline-formula>)</monospace></td>
</tr>
<tr>
<td align="left" colspan="2"><monospace>10: initialize activities <inline-formula id="pcbi.1005685.e029"><alternatives><graphic id="pcbi.1005685.e029g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e029" xlink:type="simple"/><mml:math display="inline" id="M29"><mml:mrow><mml:mi>C</mml:mi> <mml:mo>∈</mml:mo> <mml:msubsup><mml:mi mathvariant="double-struck">R</mml:mi> <mml:mo>+</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>N</mml:mi> <mml:mo>+</mml:mo> <mml:mn>1</mml:mn> <mml:mo>)</mml:mo> <mml:mo>×</mml:mo> <mml:mi>T</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula> as mean of <inline-formula id="pcbi.1005685.e030"><alternatives><graphic id="pcbi.1005685.e030g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e030" xlink:type="simple"/><mml:math display="inline" id="M30"><mml:mover accent="true"><mml:mi>C</mml:mi> <mml:mo>˜</mml:mo></mml:mover></mml:math></alternatives></inline-formula> for each neuron     ⊳ back to full data</monospace></td>
</tr>
<tr>
<td align="left" colspan="2"><monospace>11: initialize shapes <inline-formula id="pcbi.1005685.e031"><alternatives><graphic id="pcbi.1005685.e031g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e031" xlink:type="simple"/><mml:math display="inline" id="M31"><mml:mrow><mml:mi>A</mml:mi> <mml:mo>∈</mml:mo> <mml:msubsup><mml:mi mathvariant="double-struck">R</mml:mi> <mml:mo>+</mml:mo> <mml:mrow><mml:mi>D</mml:mi> <mml:mo>×</mml:mo> <mml:mo>(</mml:mo> <mml:mi>N</mml:mi> <mml:mo>+</mml:mo> <mml:mn>1</mml:mn> <mml:mo>)</mml:mo></mml:mrow></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula> by zero-order-hold upsampling of <inline-formula id="pcbi.1005685.e032"><alternatives><graphic id="pcbi.1005685.e032g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e032" xlink:type="simple"/><mml:math display="inline" id="M32"><mml:mover accent="true"><mml:mi>A</mml:mi> <mml:mo>˜</mml:mo></mml:mover></mml:math></alternatives></inline-formula></monospace></td>
</tr>
<tr>
<td align="left" colspan="2"><monospace>12: generate patches <italic>P</italic></monospace></td>
</tr>
<tr>
<td align="left" colspan="2"><monospace>13: <bold>for</bold> <italic>i</italic> = 1, …, <italic>I</italic> <bold>do</bold></monospace></td>
</tr>
<tr>
<td align="left" colspan="2"><monospace>14:  <italic>C</italic> ← HALS<sc>activity</sc>(<italic>Y</italic>, <italic>A</italic>, <italic>C</italic>, 5)          ⊳ note the increased inner iterations</monospace></td>
</tr>
<tr>
<td align="left" colspan="2"><monospace>15:  <italic>A</italic> ← HALS<sc>shape</sc>(<italic>Y</italic>, <italic>A</italic>, <italic>C</italic>, <italic>P</italic>, 5)</monospace></td>
</tr>
<tr>
<td align="left" colspan="2"><monospace>16: denoise <italic>C</italic> using OASIS [<xref ref-type="bibr" rid="pcbi.1005685.ref018">18</xref>]</monospace></td>
</tr>
<tr>
<td align="left" colspan="2"><monospace>17: <bold>return</bold> <italic>A</italic>, <italic>C</italic></monospace></td>
</tr>
<tr>
<td align="left"><monospace>1: <bold>function</bold> HALS<sc>activity</sc>(<italic>Y</italic>, <italic>A</italic>, <italic>C</italic>, <italic>I</italic> = 1)</monospace></td>
<td align="left"><monospace>1: <bold>function</bold> HALS<sc>shape</sc>(<italic>Y</italic>, <italic>A</italic>, <italic>C</italic>, <italic>P</italic>, <italic>I</italic> = 1)</monospace></td>
</tr>
<tr>
<td align="left"><monospace>2:  <italic>U</italic> = <italic>A</italic><sup>⊤</sup><italic>Y</italic></monospace></td>
<td align="left"><monospace>2:  <italic>U</italic> = <italic>CY</italic><sup>⊤</sup></monospace></td>
</tr>
<tr>
<td align="left"><monospace>3:  <italic>V</italic> = <italic>A</italic><sup>⊤</sup><italic>A</italic></monospace></td>
<td align="left"><monospace>3:  <italic>V</italic> = <italic>CC</italic><sup>⊤</sup></monospace></td>
</tr>
<tr>
<td align="left"><monospace>4:  <bold>for</bold> <italic>i</italic> = 1, …, <italic>I</italic> <bold>do</bold></monospace></td>
<td align="left"><monospace>4:  <bold>for</bold> <italic>i</italic> = 1, …, <italic>I</italic> <bold>do</bold></monospace></td>
</tr>
<tr>
<td align="left"><monospace>5:   <bold>for</bold> <italic>n</italic> = 1, …, <italic>N</italic> <bold>do</bold></monospace></td>
<td align="left"><monospace>5:   <bold>for</bold> <italic>n</italic> = 1, …, <italic>N</italic> + 1 <bold>do</bold></monospace></td>
</tr>
<tr>
<td align="left"><monospace>6:    <inline-formula id="pcbi.1005685.e033"><alternatives><graphic id="pcbi.1005685.e033g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e033" xlink:type="simple"/><mml:math display="inline" id="M33"><mml:mrow><mml:msub><mml:mi>C</mml:mi> <mml:mrow><mml:mi>n</mml:mi> <mml:mo>,</mml:mo> <mml:mo>:</mml:mo></mml:mrow></mml:msub> <mml:mo>←</mml:mo> <mml:mtext>max</mml:mtext> <mml:mrow><mml:mo>(</mml:mo> <mml:mn>0</mml:mn> <mml:mo>,</mml:mo> <mml:msub><mml:mi>C</mml:mi> <mml:mrow><mml:mi>n</mml:mi> <mml:mo>,</mml:mo> <mml:mo>:</mml:mo></mml:mrow></mml:msub> <mml:mo>+</mml:mo> <mml:mfrac><mml:mrow><mml:msub><mml:mi>U</mml:mi> <mml:mrow><mml:mi>n</mml:mi> <mml:mo>,</mml:mo> <mml:mo>:</mml:mo></mml:mrow></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mo>∑</mml:mo> <mml:mi>j</mml:mi></mml:msub> <mml:msub><mml:mi>V</mml:mi> <mml:mrow><mml:mi>n</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi></mml:mrow></mml:msub> <mml:msub><mml:mi>C</mml:mi> <mml:mrow><mml:mi>j</mml:mi> <mml:mo>,</mml:mo> <mml:mo>:</mml:mo></mml:mrow></mml:msub></mml:mrow> <mml:msub><mml:mi>V</mml:mi> <mml:mrow><mml:mi>n</mml:mi> <mml:mo>,</mml:mo> <mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mfrac> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula></monospace></td>
<td align="left"><monospace>6:    <inline-formula id="pcbi.1005685.e034"><alternatives><graphic id="pcbi.1005685.e034g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e034" xlink:type="simple"/><mml:math display="inline" id="M34"><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mo>:</mml:mo></mml:mrow></mml:msub><mml:mo>←</mml:mo><mml:msub><mml:mi>P</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mo>:</mml:mo></mml:mrow></mml:msub><mml:mo>⊙</mml:mo><mml:mtext>max</mml:mtext><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>A</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mo>:</mml:mo></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:msub><mml:mi>U</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mo>:</mml:mo></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>Σ</mml:mi><mml:mi>j</mml:mi></mml:msub><mml:msub><mml:mi>V</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mi>A</mml:mi><mml:mrow><mml:mi>j</mml:mi><mml:mo>,</mml:mo><mml:mo>:</mml:mo></mml:mrow><mml:mo>⊤</mml:mo></mml:msubsup></mml:mrow><mml:mrow><mml:msub><mml:mi>V</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mo>,</mml:mo><mml:mi>n</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula></monospace></td>
</tr>
<tr>
<td align="left"><monospace>7:   <inline-formula id="pcbi.1005685.e035"><alternatives><graphic id="pcbi.1005685.e035g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e035" xlink:type="simple"/><mml:math display="inline" id="M35"><mml:mrow><mml:msub><mml:mi>C</mml:mi> <mml:mrow><mml:mi>N</mml:mi> <mml:mo>+</mml:mo> <mml:mn>1</mml:mn> <mml:mo>,</mml:mo> <mml:mo>:</mml:mo></mml:mrow></mml:msub> <mml:mo>←</mml:mo> <mml:msub><mml:mi>C</mml:mi> <mml:mrow><mml:mi>N</mml:mi> <mml:mo>+</mml:mo> <mml:mn>1</mml:mn> <mml:mo>,</mml:mo> <mml:mo>:</mml:mo></mml:mrow></mml:msub> <mml:mo>+</mml:mo> <mml:mfrac><mml:mrow><mml:msub><mml:mi>U</mml:mi> <mml:mrow><mml:mi>N</mml:mi> <mml:mo>+</mml:mo> <mml:mn>1</mml:mn> <mml:mo>,</mml:mo> <mml:mo>:</mml:mo></mml:mrow></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mo>∑</mml:mo> <mml:mi>j</mml:mi></mml:msub> <mml:msub><mml:mi>V</mml:mi> <mml:mrow><mml:mi>N</mml:mi> <mml:mo>+</mml:mo> <mml:mn>1</mml:mn> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi></mml:mrow></mml:msub> <mml:msub><mml:mi>C</mml:mi> <mml:mrow><mml:mi>j</mml:mi> <mml:mo>,</mml:mo> <mml:mo>:</mml:mo></mml:mrow></mml:msub></mml:mrow> <mml:msub><mml:mi>V</mml:mi> <mml:mrow><mml:mi>N</mml:mi> <mml:mo>+</mml:mo> <mml:mn>1</mml:mn> <mml:mo>,</mml:mo> <mml:mi>N</mml:mi> <mml:mo>+</mml:mo> <mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mfrac></mml:mrow></mml:math></alternatives></inline-formula></monospace></td>
<td align="left"><monospace>7:</monospace></td>
</tr>
<tr>
<td align="left"><monospace>8:  <bold>return</bold> <italic>C</italic></monospace></td>
<td align="left"><monospace>8:  <bold>return</bold> <italic>A</italic></monospace></td>
</tr>
</tbody>
</table>
</alternatives>
</table-wrap>
<p>Algorithm 1 is a constrained version of fast HALS. To further improve on fast HALS, [<xref ref-type="bibr" rid="pcbi.1005685.ref052">52</xref>] suggested to replace cyclic variable updates with a greedy selection scheme focusing on nonzero elements. This was unnecessary here because most nonzero elements are prespecified by the patches <italic>P</italic><sub><italic>n</italic></sub>; i.e., we are already focusing on the nonzero elements.</p>
<p>Because for the 2P data the observed imaging rate is much higher than the decay rate of the calcium indicator, we constrain the temporal traces <italic>C</italic> to obey the calcium indicator dynamics, to enable further denoising and deconvolution of the data. As in [<xref ref-type="bibr" rid="pcbi.1005685.ref008">8</xref>], we approximate the calcium concentration dynamics using an autoregressive process of order 2 (AR(2)),
<disp-formula id="pcbi.1005685.e036"><alternatives><graphic id="pcbi.1005685.e036g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e036" xlink:type="simple"/><mml:math display="block" id="M36"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>C</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>n</mml:mi> <mml:mo>,</mml:mo> <mml:mi>t</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:msub><mml:mi>γ</mml:mi> <mml:mn>1</mml:mn></mml:msub> <mml:mi>C</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>n</mml:mi> <mml:mo>,</mml:mo> <mml:mi>t</mml:mi> <mml:mo>-</mml:mo> <mml:mn>1</mml:mn> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>+</mml:mo> <mml:msub><mml:mi>γ</mml:mi> <mml:mn>2</mml:mn></mml:msub> <mml:mi>C</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>n</mml:mi> <mml:mo>,</mml:mo> <mml:mi>t</mml:mi> <mml:mo>-</mml:mo> <mml:mn>2</mml:mn> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>+</mml:mo> <mml:mi>S</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>n</mml:mi> <mml:mo>,</mml:mo> <mml:mi>t</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(3)</label></disp-formula>
where <italic>S</italic>(<italic>n</italic>, <italic>t</italic>) is the number of spikes that neuron <italic>n</italic> fired at timestep <italic>t</italic>. This equation can be conveniently expressed in matrix form as <italic>S</italic> = <italic>CG</italic> for a suitable sparse matrix <italic>G</italic>. We estimate the noise level of each pixel <italic>σ</italic><sub><italic>d</italic></sub> by averaging the power spectral density (PSD) over a range of high frequencies, and estimate the coefficients of the AR(2) process for each cell following [<xref ref-type="bibr" rid="pcbi.1005685.ref022">22</xref>]. Then we solve for <italic>A</italic>, <bold><italic>b</italic></bold>, <italic>C</italic>, <bold><italic>f</italic></bold> using the following iterative matrix updates:
<disp-formula id="pcbi.1005685.e037"><alternatives><graphic id="pcbi.1005685.e037g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e037" xlink:type="simple"/><mml:math display="block" id="M37"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:munder><mml:mtext>minimize</mml:mtext> <mml:mrow><mml:mi>A</mml:mi> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">b</mml:mi></mml:mrow></mml:munder> <mml:msub><mml:mrow><mml:mo>∥</mml:mo> <mml:mi>A</mml:mi> <mml:mo>∥</mml:mo></mml:mrow> <mml:mn>1</mml:mn></mml:msub> <mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:mrow><mml:mtext>subject to</mml:mtext> <mml:mo>:</mml:mo> <mml:mi>A</mml:mi> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">b</mml:mi> <mml:mo>≥</mml:mo> <mml:mn>0</mml:mn> <mml:mo>,</mml:mo> <mml:mspace width="1.em"/><mml:mo>∥</mml:mo> <mml:mi>Y</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>d</mml:mi> <mml:mo>,</mml:mo> <mml:mo>:</mml:mo> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>-</mml:mo> <mml:mi>A</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>d</mml:mi> <mml:mo>,</mml:mo> <mml:mo>:</mml:mo> <mml:mo>)</mml:mo></mml:mrow> <mml:mi>C</mml:mi> <mml:mo>-</mml:mo> <mml:mi>b</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>d</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:mrow> <mml:msup><mml:mi mathvariant="bold-italic">f</mml:mi> <mml:mi>⊤</mml:mi></mml:msup> <mml:mrow><mml:mo>∥</mml:mo> <mml:mo>≤</mml:mo></mml:mrow> <mml:msub><mml:mi>σ</mml:mi> <mml:mi>d</mml:mi></mml:msub> <mml:msqrt><mml:mi>T</mml:mi></mml:msqrt> <mml:mspace width="1.em"/><mml:mo>∀</mml:mo> <mml:mi>d</mml:mi> <mml:mo>∈</mml:mo> <mml:mrow><mml:mo>{</mml:mo> <mml:mn>1</mml:mn> <mml:mo>,</mml:mo> <mml:mn>2</mml:mn> <mml:mo>,</mml:mo> <mml:mo>.</mml:mo> <mml:mo>.</mml:mo> <mml:mo>.</mml:mo> <mml:mo>,</mml:mo> <mml:mi>D</mml:mi> <mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(4)</label></disp-formula>
<disp-formula id="pcbi.1005685.e038"><alternatives><graphic id="pcbi.1005685.e038g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e038" xlink:type="simple"/><mml:math display="block" id="M38"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:munder><mml:mtext>minimize</mml:mtext> <mml:mrow><mml:mi>C</mml:mi> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">f</mml:mi></mml:mrow></mml:munder> <mml:msub><mml:mrow><mml:mo>∥</mml:mo> <mml:mi>C</mml:mi> <mml:mi>G</mml:mi> <mml:mo>∥</mml:mo></mml:mrow> <mml:mn>1</mml:mn></mml:msub> <mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:mrow><mml:mtext>subject to</mml:mtext> <mml:mo>:</mml:mo> <mml:mi>C</mml:mi> <mml:mi>G</mml:mi> <mml:mo>≥</mml:mo> <mml:mn>0</mml:mn> <mml:mo>,</mml:mo> <mml:mspace width="1.em"/><mml:mo>∥</mml:mo> <mml:mi>Y</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>d</mml:mi> <mml:mo>,</mml:mo> <mml:mo>:</mml:mo> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>-</mml:mo> <mml:mi>A</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>d</mml:mi> <mml:mo>,</mml:mo> <mml:mo>:</mml:mo> <mml:mo>)</mml:mo></mml:mrow> <mml:mi>C</mml:mi> <mml:mo>-</mml:mo> <mml:mi>b</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>d</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:mrow> <mml:msup><mml:mi mathvariant="bold-italic">f</mml:mi> <mml:mi>⊤</mml:mi></mml:msup> <mml:mrow><mml:mo>∥</mml:mo> <mml:mo>≤</mml:mo></mml:mrow> <mml:msub><mml:mi>σ</mml:mi> <mml:mi>d</mml:mi></mml:msub> <mml:msqrt><mml:mi>T</mml:mi></mml:msqrt> <mml:mspace width="1.em"/><mml:mo>∀</mml:mo> <mml:mi>d</mml:mi> <mml:mo>∈</mml:mo> <mml:mrow><mml:mo>{</mml:mo> <mml:mn>1</mml:mn> <mml:mo>,</mml:mo> <mml:mn>2</mml:mn> <mml:mo>,</mml:mo> <mml:mo>.</mml:mo> <mml:mo>.</mml:mo> <mml:mo>.</mml:mo> <mml:mo>,</mml:mo> <mml:mi>D</mml:mi> <mml:mo>}</mml:mo></mml:mrow> <mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(5)</label></disp-formula>
These updates are initialized with the results from constrained fast HALS (Alg 1). They impose sparsity on the spatial as well as temporal components, using the estimates of the noise variance as hard constraints to derive a parameter-free convex program. Following the approach in [<xref ref-type="bibr" rid="pcbi.1005685.ref053">53</xref>] the spike signal <italic>S</italic> is relaxed from nonnegative integers to arbitrary nonnegative values. The basis pursuit denoising problems in Eqs (<xref ref-type="disp-formula" rid="pcbi.1005685.e037">4</xref> and <xref ref-type="disp-formula" rid="pcbi.1005685.e038">5</xref>) can be solved with one of the methods described in [<xref ref-type="bibr" rid="pcbi.1005685.ref008">8</xref>]. However, a faster update of the temporal matrix <italic>C</italic> is achieved by using OASIS [<xref ref-type="bibr" rid="pcbi.1005685.ref018">18</xref>].</p>
</sec>
<sec id="sec012">
<title>Normalization and ranking of the obtained components</title>
<p>Every spatial component in <italic>A</italic> was normalized to have unit <italic>ℓ</italic><sub>2</sub>-norm, with the corresponding temporal component scaled accordingly. Following [<xref ref-type="bibr" rid="pcbi.1005685.ref008">8</xref>] we then sort the components according to the product of the maximum value that the temporal component attains and the <italic>ℓ</italic><sub>4</sub>-norm of the corresponding spatial footprints, to penalize overly broad and/or noisy spatial shapes.</p>
<p>In order to calculate the Δ<italic>F</italic>/<italic>F</italic> values we divided the fluorescence trace <italic>C</italic>(<italic>n</italic>, :) of each neuron by its baseline fluorescence that was obtained by projecting the rank-1 background <bold><italic>bf</italic></bold><sup>⊤</sup> onto the shape <italic>A</italic>(:, <italic>n</italic>) of the neuron, <inline-formula id="pcbi.1005685.e039"><alternatives><graphic id="pcbi.1005685.e039g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e039" xlink:type="simple"/><mml:math display="inline" id="M39"><mml:mrow><mml:msub><mml:mrow><mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:mfrac><mml:mrow><mml:mi mathvariant="normal">Δ</mml:mi> <mml:mi>F</mml:mi></mml:mrow> <mml:mi>F</mml:mi></mml:mfrac></mml:mrow> <mml:mo>)</mml:mo></mml:mrow></mml:mrow> <mml:mi>t</mml:mi></mml:msub> <mml:mo>≔</mml:mo> <mml:mfrac><mml:mrow><mml:mi>A</mml:mi> <mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:mo>:</mml:mo> <mml:mo>,</mml:mo> <mml:mi>n</mml:mi></mml:mrow> <mml:mo>)</mml:mo></mml:mrow></mml:mrow> <mml:mo>⊤</mml:mo></mml:msup><mml:mi>A</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:mo>:</mml:mo> <mml:mo>,</mml:mo> <mml:mi>n</mml:mi></mml:mrow> <mml:mo>)</mml:mo></mml:mrow> <mml:mi>C</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:mi>n</mml:mi> <mml:mo>,</mml:mo> <mml:mi>t</mml:mi></mml:mrow> <mml:mo>)</mml:mo></mml:mrow></mml:mrow> <mml:mrow><mml:mi>A</mml:mi> <mml:msup><mml:mrow><mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:mo>:</mml:mo> <mml:mo>,</mml:mo> <mml:mi>n</mml:mi></mml:mrow> <mml:mo>)</mml:mo></mml:mrow></mml:mrow> <mml:mo>⊤</mml:mo></mml:msup> <mml:mi mathvariant="bold-italic">b</mml:mi> <mml:mi mathvariant="bold-italic">f</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>t</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:math></alternatives></inline-formula>. While we normalized <italic>A</italic> and <italic>C</italic> such that <italic>A</italic>(:, <italic>n</italic>)<sup>⊤</sup><italic>A</italic>(:, <italic>n</italic>) = 1, the Δ<italic>F</italic>/<italic>F</italic> values do not depend on this specific normalization because the scaling factor cancels out.</p>
</sec>
<sec id="sec013">
<title>Compression details</title>
<p>To compress the data using truncated SVD in <xref ref-type="fig" rid="pcbi.1005685.g001">Fig 1C</xref>, we followed [<xref ref-type="bibr" rid="pcbi.1005685.ref017">17</xref>] and computed the eigenvectors <inline-formula id="pcbi.1005685.e040"><alternatives><graphic id="pcbi.1005685.e040g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e040" xlink:type="simple"/><mml:math display="inline" id="M40"><mml:mrow><mml:mi>V</mml:mi> <mml:mo>∈</mml:mo> <mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow> <mml:mrow><mml:mi>M</mml:mi> <mml:mo>×</mml:mo> <mml:mi>T</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:math></alternatives></inline-formula> belonging to the <italic>M</italic> largest eigenvalues of the time by time covariance matrix <italic>Y</italic><sup>⊤</sup><italic>Y</italic>, which were then used to obtain the compressed data <italic>YV</italic><sup>⊤</sup>. This method was faster than the randomized method due to [<xref ref-type="bibr" rid="pcbi.1005685.ref054">54</xref>]. The spatial background <bold><italic>b</italic></bold> for the compressed data was again initialized as 20% percentile of the original data and the temporal background as <inline-formula id="pcbi.1005685.e041"><alternatives><graphic id="pcbi.1005685.e041g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e041" xlink:type="simple"/><mml:math display="inline" id="M41"><mml:mrow><mml:mover accent="true"><mml:mi mathvariant="bold-italic">f</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mo>=</mml:mo> <mml:mi>V</mml:mi> <mml:msub><mml:mn mathvariant="bold">1</mml:mn> <mml:mi>T</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>. Because the compressed data and temporal traces can be negative we did not enforce the non-negativity constraint of <inline-formula id="pcbi.1005685.e042"><alternatives><graphic id="pcbi.1005685.e042g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e042" xlink:type="simple"/><mml:math display="inline" id="M42"><mml:mover accent="true"><mml:mi>C</mml:mi> <mml:mo>˜</mml:mo></mml:mover></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1005685.e043"><alternatives><graphic id="pcbi.1005685.e043g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e043" xlink:type="simple"/><mml:math display="inline" id="M43"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">f</mml:mi> <mml:mo>˜</mml:mo></mml:mover></mml:math></alternatives></inline-formula>, which was crucial as enforcing it indeed yielded worse results.</p>
<p>Random compression was performed as described in [<xref ref-type="bibr" rid="pcbi.1005685.ref016">16</xref>]. We applied the structured random compression algorithm [<xref ref-type="bibr" rid="pcbi.1005685.ref054">54</xref>] to <italic>Y</italic> and <italic>Y</italic><sup>⊤</sup> to obtain <inline-formula id="pcbi.1005685.e044"><alternatives><graphic id="pcbi.1005685.e044g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e044" xlink:type="simple"/><mml:math display="inline" id="M44"><mml:mrow><mml:mi>L</mml:mi> <mml:mo>∈</mml:mo> <mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow> <mml:mrow><mml:mi>D</mml:mi> <mml:mo>×</mml:mo> <mml:mi>M</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1005685.e045"><alternatives><graphic id="pcbi.1005685.e045g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e045" xlink:type="simple"/><mml:math display="inline" id="M45"><mml:mrow><mml:mi>R</mml:mi> <mml:mo>∈</mml:mo> <mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow> <mml:mrow><mml:mi>M</mml:mi> <mml:mo>×</mml:mo> <mml:mi>T</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:math></alternatives></inline-formula>. Specifically, we drew a Gaussian random matrix <inline-formula id="pcbi.1005685.e046"><alternatives><graphic id="pcbi.1005685.e046g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e046" xlink:type="simple"/><mml:math display="inline" id="M46"><mml:mrow><mml:mo>Ω</mml:mo> <mml:mo>∈</mml:mo> <mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow> <mml:mrow><mml:mi>T</mml:mi> <mml:mo>×</mml:mo> <mml:mi>M</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:math></alternatives></inline-formula> and performed the QR decomposition of <italic>Y</italic>Ω to obtain an orthonormal basis <italic>L</italic>. Analogously we obtained <italic>R</italic> for <italic>Y</italic><sup>⊤</sup>. The iterated alternating fast HALS updates were <italic>C</italic> ← HALS<sc>activity</sc>(<italic>L</italic><sup>⊤</sup><italic>Y</italic>, <italic>L</italic><sup>⊤</sup><italic>A</italic>, <italic>C</italic>) and <italic>A</italic> ← HALS<sc>shape</sc>(<italic>YR</italic><sup>⊤</sup>, <italic>A</italic>, <italic>CR</italic><sup>⊤</sup>), with <italic>L</italic><sup>⊤</sup><italic>Y</italic> and <italic>YR</italic><sup>⊤</sup> computed once initially.</p>
</sec>
<sec id="sec014">
<title>Decimation details</title>
<p>Applying the code of [<xref ref-type="bibr" rid="pcbi.1005685.ref055">55</xref>] to the raw data we identified the neural shape matrix <italic>A</italic><sub>1</sub> and spatial background <bold><italic>b</italic></bold><sub>1</sub>. We use the convention that the presence of a lower index <italic>l</italic> signifies an estimate and its value the decimation factor, i.e. index <italic>l</italic> = 1 denotes an estimate inferred without decimation. Further, we also obtained the denoised and deconvolved traces <italic>C</italic><sub>1</sub>, <italic>S</italic><sub>1</sub> as well as <bold><italic>f</italic></bold><sub>1</sub>. To emulate imaging with lower spatial resolution, spatial decimation was performed by converting <italic>A</italic><sub>1</sub> back into a 512 × 512 × <italic>N</italic> tensor (<italic>Y</italic> into a 512 × 512 × <italic>T</italic> video tensor) and calculating the average of non-overlapping patches of size <italic>l</italic> × <italic>l</italic> or <italic>l</italic> × 1 pixels for each of the <italic>N</italic> neural shapes (<italic>T</italic> timesteps). Converting the tensors back to matrices yielded the decimated neural shapes <italic>A</italic><sub><italic>l</italic></sub> (data <italic>Y</italic><sub><italic>l</italic></sub>). We proceeded analogously for the spatial background to obtain <bold><italic>b</italic></bold><sub><italic>l</italic></sub>. The corresponding temporal traces were estimated by solving <xref ref-type="disp-formula" rid="pcbi.1005685.e038">Eq (5)</xref> (with <italic>Y</italic><sub><italic>l</italic></sub> replacing <italic>Y</italic>, <italic>C</italic><sub><italic>l</italic></sub> replacing <italic>C</italic>, etc.), initializing <italic>C</italic><sub><italic>l</italic></sub> and <bold><italic>f</italic></bold><sub><italic>l</italic></sub> with the result of plain NMF that does not impose temporal constraints, i.e. solving <inline-formula id="pcbi.1005685.e047"><alternatives><graphic id="pcbi.1005685.e047g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e047" xlink:type="simple"/><mml:math display="inline" id="M47"><mml:mrow><mml:mtext>minimize</mml:mtext><mml:msub><mml:mrow/><mml:mrow><mml:msub><mml:mi>C</mml:mi> <mml:mi>l</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">f</mml:mi> <mml:mi>l</mml:mi></mml:msub></mml:mrow></mml:msub> <mml:mrow><mml:mo>∥</mml:mo> <mml:msub><mml:mi>Y</mml:mi> <mml:mi>l</mml:mi></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mi>A</mml:mi> <mml:mi>l</mml:mi></mml:msub> <mml:msub><mml:mi>C</mml:mi> <mml:mi>l</mml:mi></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">b</mml:mi> <mml:mi>l</mml:mi></mml:msub> <mml:msubsup><mml:mi mathvariant="bold-italic">f</mml:mi> <mml:mi>l</mml:mi> <mml:mi>⊤</mml:mi></mml:msubsup> <mml:mo>∥</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> subject to <italic>C</italic><sub><italic>l</italic></sub> ≥ 0.</p>
<p>In order to obtain the results for 1-phase imaging without previous shape identification we solved <xref ref-type="disp-formula" rid="pcbi.1005685.e037">Eq (4)</xref> for the decimated data <italic>Y</italic><sub><italic>l</italic></sub>, initializing <italic>A</italic><sub><italic>l</italic></sub>, <bold><italic>b</italic></bold><sub><italic>l</italic></sub> by decimating <italic>A</italic><sub>1</sub>, <bold><italic>b</italic></bold><sub>1</sub> and setting the temporal components to <italic>C</italic><sub>1</sub>, <bold><italic>f</italic></bold><sub>1</sub>. With increasing decimation factors an increasing number of shapes got purged and absorbed in the background, reflecting the fact that it would have been difficult to detect all ROIs on low resolution data in the first place. Using the obtained remaining shapes we again solved <xref ref-type="disp-formula" rid="pcbi.1005685.e038">Eq (5)</xref> as above. The correlation values for purged neurons were set to zeros for the mean values reported in <xref ref-type="fig" rid="pcbi.1005685.g006">Fig 6</xref>.</p>
<p>To obtain some form of ground truth (Figs <xref ref-type="fig" rid="pcbi.1005685.g006">6D–6F</xref>, <xref ref-type="fig" rid="pcbi.1005685.g007">7C</xref> and <xref ref-type="fig" rid="pcbi.1005685.g008">8C</xref>) we generated a simulated dataset <italic>Y</italic><sup>s</sup> by taking the inferred quantities as actual ground truth: <italic>A</italic><sup>s</sup> ≔ <italic>A</italic><sub>1</sub>, <bold><italic>b</italic></bold><sup>s</sup> ≔ <bold><italic>b</italic></bold><sub>1</sub>, <italic>C</italic><sup>s</sup> ≔ <italic>C</italic><sub>1</sub>, <bold><italic>f</italic></bold><sup>s</sup> ≔ <bold><italic>f</italic></bold><sub>1</sub>. We calculated the residual <italic>Y</italic> − <italic>A</italic><sup>s</sup><italic>C</italic><sup>s</sup> − <bold><italic>b</italic></bold><sup>s</sup><bold><italic>f</italic></bold><sup><italic>s</italic>⊤</sup> and reshuffled it randomly but signal dependent for each pixel in time. We partitioned the residual for each pixel into 200 strata according to signal size and reshuffled it within each strata, thus retaining any potential link between noise variance and signal mean. The simulated dataset <italic>Y</italic><sup>s</sup> was obtained by adding the reshuffled residual to <italic>A</italic><sup>s</sup><italic>C</italic><sup>s</sup> + <bold><italic>b</italic></bold><sup>s</sup><bold><italic>f</italic></bold><sup>s⊤</sup> and the same analysis as for the original data was performed.</p>
<p>We performed additional control simulations that also took the inferred quantities as actual ground truth, <inline-formula id="pcbi.1005685.e048"><alternatives><graphic id="pcbi.1005685.e048g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e048" xlink:type="simple"/><mml:math display="inline" id="M48"><mml:mrow><mml:msup><mml:mi>Y</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>:</mml:mo> <mml:mo>=</mml:mo> <mml:msub><mml:mi>A</mml:mi> <mml:mn>1</mml:mn></mml:msub> <mml:msub><mml:mi>C</mml:mi> <mml:mn>1</mml:mn></mml:msub> <mml:mo>+</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">b</mml:mi> <mml:mn>1</mml:mn></mml:msub> <mml:msubsup><mml:mi mathvariant="bold-italic">f</mml:mi> <mml:mn>1</mml:mn> <mml:mi>⊤</mml:mi></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula>, but did not rely on a reshuffling procedure. Instead, we either added Gaussian noise, <inline-formula id="pcbi.1005685.e049"><alternatives><graphic id="pcbi.1005685.e049g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e049" xlink:type="simple"/><mml:math display="inline" id="M49"><mml:mrow><mml:msubsup><mml:mi>Y</mml:mi> <mml:mrow><mml:mi>d</mml:mi> <mml:mo>,</mml:mo> <mml:mi>t</mml:mi></mml:mrow> <mml:mi mathvariant="script">N</mml:mi></mml:msubsup> <mml:mo>∼</mml:mo> <mml:mi mathvariant="script">N</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mi>Y</mml:mi> <mml:mrow><mml:mi>d</mml:mi> <mml:mo>,</mml:mo> <mml:mi>t</mml:mi></mml:mrow> <mml:mo>*</mml:mo></mml:msubsup> <mml:mo>,</mml:mo> <mml:msup><mml:mi>σ</mml:mi> <mml:mn>2</mml:mn></mml:msup> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>, or Poisson noise <inline-formula id="pcbi.1005685.e050"><alternatives><graphic id="pcbi.1005685.e050g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e050" xlink:type="simple"/><mml:math display="inline" id="M50"><mml:mrow><mml:mi>ν</mml:mi> <mml:mo>+</mml:mo> <mml:msubsup><mml:mi>Y</mml:mi> <mml:mrow><mml:mi>d</mml:mi> <mml:mo>,</mml:mo> <mml:mi>t</mml:mi></mml:mrow> <mml:mi mathvariant="script">P</mml:mi></mml:msubsup> <mml:mo>∼</mml:mo> <mml:mi mathvariant="script">P</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>ν</mml:mi> <mml:mo>+</mml:mo> <mml:msubsup><mml:mi>Y</mml:mi> <mml:mrow><mml:mi>d</mml:mi> <mml:mo>,</mml:mo> <mml:mi>t</mml:mi></mml:mrow> <mml:mo>*</mml:mo></mml:msubsup> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>, where <italic>ν</italic> is the photon count that is not due to calcium fluorescence (but rather dark counts and background light). Whereas the Gaussian noise had fixed variance <italic>σ</italic><sup>2</sup>, the Poisson model results in heteroscedastic noise because its variance grows with the mean. The variance of the Gaussian noise was chosen to be equal to the average variance of the Poisson noise. The results shown in <xref ref-type="supplementary-material" rid="pcbi.1005685.s002">S2 Fig</xref> agree with those obtained by reshuffling the residual and are similar for Gaussian and Poisson noise, at least on average, though there is some spread if individual traces are considered (<xref ref-type="supplementary-material" rid="pcbi.1005685.s002">S2C Fig</xref>). Whereas the model (<xref ref-type="disp-formula" rid="pcbi.1005685.e012">Eq 1</xref>) assumes Gaussian noise, it nevertheless performs well under Poisson noise, consistent with the results of [<xref ref-type="bibr" rid="pcbi.1005685.ref053">53</xref>].</p>
<p>Another control simulation merely took <italic>A</italic><sub>1</sub>, <bold><italic>b</italic></bold><sub>1</sub> and <bold><italic>f</italic></bold><sub>1</sub> as ground truth. However, instead of taking the denoised fluorescence traces <italic>C</italic><sub>1</sub>, which by construction followed the autoregressive model, the fluorescence traces <inline-formula id="pcbi.1005685.e051"><alternatives><graphic id="pcbi.1005685.e051g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e051" xlink:type="simple"/><mml:math display="inline" id="M51"><mml:msup><mml:mi>C</mml:mi> <mml:mi mathvariant="script">D</mml:mi></mml:msup></mml:math></alternatives></inline-formula> were obtained from two datasets that combined electrophysiological recording and calcium imaging with GCaMP6f (11 cells) or GCaMP6s (9 cells) [<xref ref-type="bibr" rid="pcbi.1005685.ref023">23</xref>]. The calcium response kernel <inline-formula id="pcbi.1005685.e052"><alternatives><graphic id="pcbi.1005685.e052g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e052" xlink:type="simple"/><mml:math display="inline" id="M52"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> for each recorded cell was determined by solving the linear regression problem <inline-formula id="pcbi.1005685.e053"><alternatives><graphic id="pcbi.1005685.e053g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e053" xlink:type="simple"/><mml:math display="inline" id="M53"><mml:mrow><mml:mover accent="true"><mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mo>=</mml:mo> <mml:mo form="prefix">arg</mml:mo> <mml:msub><mml:mo form="prefix" movablelimits="true">min</mml:mo> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub> <mml:msup><mml:mrow><mml:mo>∥</mml:mo> <mml:mi mathvariant="bold-italic">y</mml:mi> <mml:mo>-</mml:mo> <mml:mi mathvariant="bold-italic">s</mml:mi> <mml:mo>*</mml:mo> <mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mo>∥</mml:mo></mml:mrow> <mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:math></alternatives></inline-formula> where <bold><italic>y</italic></bold> is the noisy fluorescence data of a neuron, <bold><italic>s</italic></bold> its spike counts per bin, and * denotes convolution. Because only few cells were recorded, but for a longer duration than the 100 s of our two-photon dataset, we assigned to each of our ROIs the ground truth fluorescence trace by randomly selecting a recorded cell, taking a 100 s interval of its spike train that included at least three spikes, and convolving it with the cell’s kernel <bold><italic>k</italic></bold>. The trace was scaled such that its maximum value was equal to the maximal value of the inferred trace <italic>C</italic><sub>1</sub>. Poisson noise was added, <inline-formula id="pcbi.1005685.e054"><alternatives><graphic id="pcbi.1005685.e054g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e054" xlink:type="simple"/><mml:math display="inline" id="M54"><mml:mrow><mml:mi>ν</mml:mi> <mml:mo>+</mml:mo> <mml:msup><mml:mi>Y</mml:mi> <mml:mi mathvariant="script">D</mml:mi></mml:msup> <mml:mo>∼</mml:mo> <mml:mi mathvariant="script">P</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>ν</mml:mi> <mml:mo>+</mml:mo> <mml:msub><mml:mi>A</mml:mi> <mml:mn>1</mml:mn></mml:msub> <mml:msup><mml:mi>C</mml:mi> <mml:mi mathvariant="script">D</mml:mi></mml:msup> <mml:mo>+</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">b</mml:mi> <mml:mn>1</mml:mn></mml:msub> <mml:msubsup><mml:mi mathvariant="bold-italic">f</mml:mi> <mml:mn>1</mml:mn> <mml:mi>⊤</mml:mi></mml:msubsup> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>, as described above. Results are shown in <xref ref-type="supplementary-material" rid="pcbi.1005685.s003">S3 Fig</xref>.</p>
</sec>
<sec id="sec015">
<title>Interleaving details</title>
<p>Projecting the noise of each pixel onto the neural shapes yields the noise of each neural time series. In practice the latter is estimated based on the noisy trace obtained by projecting the fluorescence data onto the shapes. For interleaved imaging (<xref ref-type="fig" rid="pcbi.1005685.g008">Fig 8</xref>) the shape of each neuron differs between alternating frames due to the varying pixelization. Therefore, instead of using one noise level for all timesteps, we estimated two noise levels <italic>σ</italic><sub>odd</sub> and <italic>σ</italic><sub>even</sub> based on the PSD for all odd and even frames respectively. The residuals in the noise constraint of the non-negative deconvolution were weighted accordingly by the inverse of the noise level.</p>
<disp-formula id="pcbi.1005685.e055"><alternatives><graphic id="pcbi.1005685.e055g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1005685.e055" xlink:type="simple"/><mml:math display="block" id="M55"><mml:mtable columnalign="left"><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:munder><mml:mrow><mml:mtext>minimize</mml:mtext></mml:mrow><mml:mrow><mml:mtext> </mml:mtext><mml:mi mathvariant="bold-italic">c</mml:mi></mml:mrow></mml:munder><mml:mtext> </mml:mtext><mml:mo>∥</mml:mo><mml:mi>G</mml:mi><mml:mi mathvariant="bold-italic">c</mml:mi><mml:msub><mml:mo>∥</mml:mo><mml:mn>1</mml:mn></mml:msub><mml:mo>,</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow/></mml:mtd></mml:mtr><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:mtext>subject to</mml:mtext><mml:mo>:</mml:mo><mml:mi>G</mml:mi><mml:mi mathvariant="bold-italic">c</mml:mi><mml:mo>≥</mml:mo><mml:mn>0</mml:mn><mml:mo>,</mml:mo></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mfrac><mml:mrow><mml:mo>∥</mml:mo><mml:msub><mml:mi mathvariant="bold-italic">y</mml:mi><mml:mrow><mml:mtext>odd</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mtext>odd</mml:mtext></mml:mrow></mml:msub><mml:msup><mml:mo>∥</mml:mo><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:mtext>odd</mml:mtext></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mfrac><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:mo>∥</mml:mo><mml:msub><mml:mi mathvariant="bold-italic">y</mml:mi><mml:mrow><mml:mtext>even</mml:mtext></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mi>c</mml:mi><mml:mrow><mml:mtext>even</mml:mtext></mml:mrow></mml:msub><mml:msup><mml:mo>∥</mml:mo><mml:mn>2</mml:mn></mml:msup></mml:mrow><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi><mml:mrow><mml:mtext>even</mml:mtext></mml:mrow><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mfrac><mml:mo>≤</mml:mo><mml:mi>T</mml:mi></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(6)</label></disp-formula>
<p specific-use="continuation">where <bold><italic>y</italic></bold> is the noisy fluorescence data of a neuron (cell index suppressed) obtained by subtracting the contribution of all other neurons as well as the background from the spatio-temporal raw pixel fluorescence data and projecting the odd and even frames of the result onto the considered neuron’s shapes <bold><italic>a</italic></bold><sub>odd</sub> and <bold><italic>a</italic></bold><sub>even</sub> respectively. <bold><italic>y</italic></bold><sub>odd</sub> and <bold><italic>y</italic></bold><sub>even</sub> denote the vectors obtained by taking only every second component of <bold><italic>y</italic></bold> starting with the first/second respectively. The denoised fluorescence <bold><italic>c</italic></bold> is denoted analogously. For simplicity we estimated the coefficients of the AR(2) process based on all frames without separating by noise level.</p>
</sec>
<sec id="sec016">
<title>Computing environment</title>
<p>All analyses were performed on a MacBook Pro with Intel Core i5-5257U 2.7 GHz CPU and 16 GB RAM. We wrote custom Python scripts that called the Python implementation [<xref ref-type="bibr" rid="pcbi.1005685.ref055">55</xref>] of CNMF [<xref ref-type="bibr" rid="pcbi.1005685.ref008">8</xref>]. Our scientific Python installation included Intel Math Kernel Library (MKL) Optimizations for improved performance of vectorized math routines.</p>
</sec>
</sec>
<sec id="sec017">
<title>Supporting information</title>
<supplementary-material id="pcbi.1005685.s001" mimetype="application/pdf" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005685.s001" xlink:type="simple">
<label>S1 Fig</label>
<caption>
<title>Neural footprints sorted by increasing reconstruction loss for 16×16 decimation.</title>
<p>Structures that are smaller in size are more sensitive to binning.</p>
<p>(PDF)</p>
</caption>
</supplementary-material>
<supplementary-material id="pcbi.1005685.s002" mimetype="application/pdf" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005685.s002" xlink:type="simple">
<label>S2 Fig</label>
<caption>
<title>Decimation for ground truth data generated using Gaussian or Poisson noise.</title>
<p>The simulated ground truth traces were obtained on decimated simulated data with Poisson (orange) or Gaussian (cyan) noise instead of reshuffling (<xref ref-type="fig" rid="pcbi.1005685.g006">Fig 6</xref>). <bold>(A)</bold> Correlations between denoised traces and ground truth generated from the light-sheet data. Thick lines show the median, thin lines and shaded region the IQR. <bold>(B)</bold> Correlations between denoised (solid) and deconvolved (dashed) traces and ground truth generated from the two-photon data. <bold>(C)</bold> Scatter plot showing the correlation values with ground truth for the individual traces summarized in (B). Spatial decimation was performed by averaging 16×16 pixels.</p>
<p>(PDF)</p>
</caption>
</supplementary-material>
<supplementary-material id="pcbi.1005685.s003" mimetype="application/pdf" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005685.s003" xlink:type="simple">
<label>S3 Fig</label>
<caption>
<title>Decimation for ground truth data generated using Poisson noise and calcium responses from [<xref ref-type="bibr" rid="pcbi.1005685.ref023">23</xref>].</title>
<p>The simulated ground truth traces were obtained on decimated simulated data with Poisson noise and calcium responses that were not modeled as AR process, but instead obtained from real data using <bold>(A)</bold> GCaMP6f or <bold>(B)</bold> GCaMP6s, as discussed in the methods text. Thick lines show the median, thin lines and shaded region the IQR for denoised (solid) and deconvolved (dashed) traces.</p>
<p>(PDF)</p>
</caption>
</supplementary-material>
<supplementary-material id="pcbi.1005685.s004" mimetype="video/mp4" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005685.s004" xlink:type="simple">
<label>S1 Video</label>
<caption>
<title>Illustration of CNMF and decimation for zebrafish light-sheet imaging data.</title>
<p>The supplementary video shows in the upper row the raw data, its reconstruction based on CNMF, and the residual. It illustrates that all relevant ROIs have been detected and the matrix decomposition afforded by CNMF captures the data well. The lower row shows spatially decimated raw data, corresponding to data acquisition at lower resolution, its reconstruction based on CNMF and knowledge of the neural shapes from an initial cell identification imaging phase, and the residual. It illustrates that demixing paired with cell shape identification captures the data virtually as well as CNMF without decimation, i.e. based on data of low resolution it enables its reconstruction at higher resolution.</p>
<p>(MP4)</p>
</caption>
</supplementary-material>
<supplementary-material id="pcbi.1005685.s005" mimetype="video/mp4" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1005685.s005" xlink:type="simple">
<label>S2 Video</label>
<caption>
<title>Illustration of CNMF and decimation for mouse 2P imaging data.</title>
<p>All panels of the supplementary video are analogous to <xref ref-type="supplementary-material" rid="pcbi.1005685.s004">S1 Video</xref>.</p>
<p>(MP4)</p>
</caption>
</supplementary-material>
</sec>
</body>
<back>
<ack>
<p>We would like to thank Weiqun Fang for preparing the mouse and Eftychios Pnevmatikakis, Lloyd Russell, Adam Packer, and Jeremy Freeman for helpful conversations. We thank Andrea Giovannucci for his efforts to make a Python implementation of CNMF available. Finally, thanks to Guillermo Sapiro and Mariano Tepper for helpful conversations about [<xref ref-type="bibr" rid="pcbi.1005685.ref016">16</xref>].</p>
<p>Part of this work was previously presented at the NIPS (2015) workshop on Statistical Methods for Understanding Neural Systems [<xref ref-type="bibr" rid="pcbi.1005685.ref056">56</xref>].</p>
<p>The U.S. Government is authorized to reproduce and distribute reprints for Governmental purposes notwithstanding any copyright annotation thereon. Disclaimer: The views and conclusions contained herein are those of the authors and should not be interpreted as necessarily representing the official policies or endorsements, either expressed or implied, of IARPA, DoI/IBC, or the U.S. Government.</p>
</ack>
<ref-list>
<title>References</title>
<ref id="pcbi.1005685.ref001">
<label>1</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Ahrens</surname> <given-names>MB</given-names></name>, <name name-style="western"><surname>Orger</surname> <given-names>MB</given-names></name>, <name name-style="western"><surname>Robson</surname> <given-names>DN</given-names></name>, <name name-style="western"><surname>Li</surname> <given-names>JM</given-names></name>, <name name-style="western"><surname>Keller</surname> <given-names>PJ</given-names></name>. <article-title>Whole-brain functional imaging at cellular resolution using light-sheet microscopy</article-title>. <source>Nat Methods</source>. <year>2013</year>;<volume>10</volume>(<issue>5</issue>):<fpage>413</fpage>–<lpage>420</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1038/nmeth.2434" xlink:type="simple">10.1038/nmeth.2434</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref002">
<label>2</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Dunn</surname> <given-names>TW</given-names></name>, <name name-style="western"><surname>Mu</surname> <given-names>Y</given-names></name>, <name name-style="western"><surname>Narayan</surname> <given-names>S</given-names></name>, <name name-style="western"><surname>Randlett</surname> <given-names>O</given-names></name>, <name name-style="western"><surname>Naumann</surname> <given-names>EA</given-names></name>, <name name-style="western"><surname>Yang</surname> <given-names>CT</given-names></name>, <etal>et al</etal>. <article-title>Brain-wide mapping of neural activity controlling zebrafish exploratory locomotion</article-title>. <source>eLife</source>. <year>2016</year>;<volume>5</volume>:<fpage>e12741</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.7554/eLife.12741" xlink:type="simple">10.7554/eLife.12741</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref003">
<label>3</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Tomer</surname> <given-names>R</given-names></name>, <name name-style="western"><surname>Lovett-Barron</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Kauvar</surname> <given-names>I</given-names></name>, <name name-style="western"><surname>Andalman</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Burns</surname> <given-names>VM</given-names></name>, <name name-style="western"><surname>Sankaran</surname> <given-names>S</given-names></name>, <etal>et al</etal>. <article-title>SPED light sheet microscopy: Fast mapping of biological system structure and function</article-title>. <source>Cell</source>. <year>2015</year>;<volume>163</volume>(<issue>7</issue>):<fpage>1796</fpage>–<lpage>1806</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1016/j.cell.2015.11.061" xlink:type="simple">10.1016/j.cell.2015.11.061</ext-link></comment> <object-id pub-id-type="pmid">26687363</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref004">
<label>4</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Quirin</surname> <given-names>S</given-names></name>, <name name-style="western"><surname>Vladimirov</surname> <given-names>N</given-names></name>, <name name-style="western"><surname>Yang</surname> <given-names>CT</given-names></name>, <name name-style="western"><surname>Peterka</surname> <given-names>DS</given-names></name>, <name name-style="western"><surname>Yuste</surname> <given-names>R</given-names></name>, <name name-style="western"><surname>Ahrens</surname> <given-names>MB</given-names></name>. <article-title>Calcium imaging of neural circuits with extended depth-of-field light-sheet microscopy</article-title>. <source>Opt Lett</source>. <year>2016</year>;<volume>41</volume>(<issue>5</issue>):<fpage>855</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1364/OL.41.000855" xlink:type="simple">10.1364/OL.41.000855</ext-link></comment> <object-id pub-id-type="pmid">26974063</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref005">
<label>5</label>
<mixed-citation publication-type="book" xlink:type="simple">
<name name-style="western"><surname>Grewe</surname> <given-names>BF</given-names></name>, <name name-style="western"><surname>Helmchen</surname> <given-names>F</given-names></name>, <name name-style="western"><surname>Kampa</surname> <given-names>BM</given-names></name>. <chapter-title>Two-Photon Imaging of Neuronal Network Dynamics in Neocortex</chapter-title>. In: <source>Optical Imaging of Neocortical Dynamics</source>. <publisher-name>Humana Press</publisher-name>; <year>2014</year>. p. <fpage>133</fpage>–<lpage>150</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1005685.ref006">
<label>6</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Bouchard</surname> <given-names>MB</given-names></name>, <name name-style="western"><surname>Voleti</surname> <given-names>V</given-names></name>, <name name-style="western"><surname>Mendes</surname> <given-names>CS</given-names></name>, <name name-style="western"><surname>Lacefield</surname> <given-names>C</given-names></name>, <name name-style="western"><surname>Grueber</surname> <given-names>WB</given-names></name>, <name name-style="western"><surname>Mann</surname> <given-names>RS</given-names></name>, <etal>et al</etal>. <article-title>Swept confocally-aligned planar excitation (SCAPE) microscopy for high-speed volumetric imaging of behaving organisms</article-title>. <source>Nat Photon</source>. <year>2015</year>;<volume>9</volume>(<issue>2</issue>):<fpage>113</fpage>–<lpage>119</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1038/nphoton.2014.323" xlink:type="simple">10.1038/nphoton.2014.323</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref007">
<label>7</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Prevedel</surname> <given-names>R</given-names></name>, <name name-style="western"><surname>Verhoef</surname> <given-names>AJ</given-names></name>, <name name-style="western"><surname>Pernía-Andrade</surname> <given-names>AJ</given-names></name>, <name name-style="western"><surname>Weisenburger</surname> <given-names>S</given-names></name>, <name name-style="western"><surname>Huang</surname> <given-names>BS</given-names></name>, <name name-style="western"><surname>Nöbauer</surname> <given-names>T</given-names></name>, <etal>et al</etal>. <article-title>Fast volumetric calcium imaging across multiple cortical layers using sculpted light</article-title>. <source>Nat Methods</source>. <year>2016</year>;<volume>13</volume>(<issue>12</issue>):<fpage>1021</fpage>–<lpage>1028</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1038/nmeth.4040" xlink:type="simple">10.1038/nmeth.4040</ext-link></comment> <object-id pub-id-type="pmid">27798612</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref008">
<label>8</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Pnevmatikakis</surname> <given-names>EA</given-names></name>, <name name-style="western"><surname>Soudry</surname> <given-names>D</given-names></name>, <name name-style="western"><surname>Gao</surname> <given-names>Y</given-names></name>, <name name-style="western"><surname>Machado</surname> <given-names>TA</given-names></name>, <name name-style="western"><surname>Merel</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Pfau</surname> <given-names>D</given-names></name>, <etal>et al</etal>. <article-title>Simultaneous Denoising, Deconvolution, and Demixing of Calcium Imaging Data</article-title>. <source>Neuron</source>. <year>2016</year>;<volume>89</volume>(<issue>2</issue>):<fpage>285</fpage>–<lpage>299</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1016/j.neuron.2015.11.037" xlink:type="simple">10.1016/j.neuron.2015.11.037</ext-link></comment> <object-id pub-id-type="pmid">26774160</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref009">
<label>9</label>
<mixed-citation publication-type="book" xlink:type="simple">
<name name-style="western"><surname>Cichocki</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Zdunek</surname> <given-names>R</given-names></name>, <name name-style="western"><surname>Amari</surname> <given-names>SI</given-names></name>. <chapter-title>Hierarchical ALS algorithms for nonnegative matrix and 3D tensor factorization</chapter-title>. In: <source>Independent Component Analysis and Signal Separation</source>. <publisher-name>Springer</publisher-name>; <year>2007</year>. p. <fpage>169</fpage>–<lpage>176</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1005685.ref010">
<label>10</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Kim</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>He</surname> <given-names>Y</given-names></name>, <name name-style="western"><surname>Park</surname> <given-names>H</given-names></name>. <article-title>Algorithms for nonnegative matrix and tensor factorizations: a unified view based on block coordinate descent framework</article-title>. <source>J Global Optim</source>. <year>2014</year>;<volume>58</volume>(<issue>2</issue>):<fpage>285</fpage>–<lpage>319</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1007/s10898-013-0035-4" xlink:type="simple">10.1007/s10898-013-0035-4</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref011">
<label>11</label>
<mixed-citation publication-type="book" xlink:type="simple">
<name name-style="western"><surname>Gillis</surname> <given-names>N</given-names></name>. <chapter-title>The why and how of nonnegative matrix factorization</chapter-title>. In: <source>Regularization, Optimization, Kernels, and Support Vector Machines</source>. <publisher-name>Chapman &amp; Hall/CRC</publisher-name>; <year>2014</year>. p. <fpage>257</fpage>–<lpage>291</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1005685.ref012">
<label>12</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Yu</surname> <given-names>HF</given-names></name>, <name name-style="western"><surname>Hsieh</surname> <given-names>CJ</given-names></name>, <name name-style="western"><surname>Si</surname> <given-names>S</given-names></name>, <name name-style="western"><surname>Dhillon</surname> <given-names>IS</given-names></name>. <article-title>Parallel matrix factorization for recommender systems</article-title>. <source>Knowl Inf Syst</source>. <year>2014</year>;<volume>41</volume>(<issue>3</issue>):<fpage>793</fpage>–<lpage>819</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1007/s10115-013-0682-2" xlink:type="simple">10.1007/s10115-013-0682-2</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref013">
<label>13</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Gillis</surname> <given-names>N</given-names></name>, <name name-style="western"><surname>Glineur</surname> <given-names>F</given-names></name>. <article-title>A multilevel approach for nonnegative matrix factorization</article-title>. <source>J Comput Appl Math</source>. <year>2012</year>;<volume>236</volume>(<issue>7</issue>):<fpage>1708</fpage>–<lpage>1723</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1016/j.cam.2011.10.002" xlink:type="simple">10.1016/j.cam.2011.10.002</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref014">
<label>14</label>
<mixed-citation publication-type="book" xlink:type="simple">
<name name-style="western"><surname>Ho</surname> <given-names>ND</given-names></name>, <name name-style="western"><surname>Van Dooren</surname> <given-names>P</given-names></name>, <name name-style="western"><surname>Blondel</surname> <given-names>VD</given-names></name>. <chapter-title>Descent methods for nonnegative matrix factorization</chapter-title>. In: <source>Numerical Linear Algebra in Signals, Systems and Control</source>. <publisher-name>Springer</publisher-name>; <year>2011</year>. p. <fpage>251</fpage>–<lpage>293</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1005685.ref015">
<label>15</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Cichocki</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Phan</surname> <given-names>AH</given-names></name>. <article-title>Fast local algorithms for large scale nonnegative matrix and tensor factorizations</article-title>. <source>IEICE Trans Fundam Electron Commun Comput Sci</source>. <year>2009</year>;<volume>92</volume>(<issue>3</issue>):<fpage>708</fpage>–<lpage>721</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1587/transfun.E92.A.708" xlink:type="simple">10.1587/transfun.E92.A.708</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref016">
<label>16</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Tepper</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Sapiro</surname> <given-names>G</given-names></name>. <article-title>Compressed Nonnegative Matrix Factorization is Fast and Accurate</article-title>. <source>IEEE Trans Signal Process</source>. <year>2016</year>;<volume>64</volume>(<issue>9</issue>):<fpage>2269</fpage>–<lpage>2283</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1109/TSP.2016.2516971" xlink:type="simple">10.1109/TSP.2016.2516971</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref017">
<label>17</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Pachitariu</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Stringer</surname> <given-names>C</given-names></name>, <name name-style="western"><surname>Schröder</surname> <given-names>S</given-names></name>, <name name-style="western"><surname>Dipoppa</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Rossi</surname> <given-names>LF</given-names></name>, <name name-style="western"><surname>Carandini</surname> <given-names>M</given-names></name>, <etal>et al</etal>. <article-title>Suite2p: beyond 10,000 neurons with standard two-photon microscopy</article-title>. <source>bioRxiv</source>. <year>2016</year>; p. <fpage>061507</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1005685.ref018">
<label>18</label>
<mixed-citation publication-type="book" xlink:type="simple">
<name name-style="western"><surname>Friedrich</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Paninski</surname> <given-names>L</given-names></name>. <chapter-title>Fast active set methods for online spike inference from calcium imaging</chapter-title>. In: <source>Adv Neural Inf Process Syst</source> <volume>29</volume>; <year>2016</year>. p. <fpage>1984</fpage>–<lpage>1992</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1005685.ref019">
<label>19</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Vladimirov</surname> <given-names>N</given-names></name>, <name name-style="western"><surname>Mu</surname> <given-names>Y</given-names></name>, <name name-style="western"><surname>Kawashima</surname> <given-names>T</given-names></name>, <name name-style="western"><surname>Bennett</surname> <given-names>DV</given-names></name>, <name name-style="western"><surname>Yang</surname> <given-names>CT</given-names></name>, <name name-style="western"><surname>Looger</surname> <given-names>LL</given-names></name>, <etal>et al</etal>. <article-title>Light-sheet functional imaging in fictively behaving zebrafish</article-title>. <source>Nat Methods</source>. <year>2014</year>;<volume>11</volume>(<issue>9</issue>):<fpage>883</fpage>–<lpage>884</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1038/nmeth.3040" xlink:type="simple">10.1038/nmeth.3040</ext-link></comment> <object-id pub-id-type="pmid">25068735</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref020">
<label>20</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Amat</surname> <given-names>F</given-names></name>, <name name-style="western"><surname>Höckendorf</surname> <given-names>B</given-names></name>, <name name-style="western"><surname>Wan</surname> <given-names>Y</given-names></name>, <name name-style="western"><surname>Lemon</surname> <given-names>WC</given-names></name>, <name name-style="western"><surname>McDole</surname> <given-names>K</given-names></name>, <name name-style="western"><surname>Keller</surname> <given-names>PJ</given-names></name>. <article-title>Efficient processing and analysis of large-scale light-sheet microscopy data</article-title>. <source>Nat Protoc</source>. <year>2015</year>;<volume>10</volume>(<issue>11</issue>):<fpage>1679</fpage>–<lpage>1696</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1038/nprot.2015.111" xlink:type="simple">10.1038/nprot.2015.111</ext-link></comment> <object-id pub-id-type="pmid">26426501</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref021">
<label>21</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Ghosh</surname> <given-names>KK</given-names></name>, <name name-style="western"><surname>Burns</surname> <given-names>LD</given-names></name>, <name name-style="western"><surname>Cocker</surname> <given-names>ED</given-names></name>, <name name-style="western"><surname>Nimmerjahn</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Ziv</surname> <given-names>Y</given-names></name>, <name name-style="western"><surname>El Gamal</surname> <given-names>A</given-names></name>, <etal>et al</etal>. <article-title>Miniaturized integration of a fluorescence microscope</article-title>. <source>Nat Methods</source>. <year>2011</year>;<volume>8</volume>(<issue>10</issue>):<fpage>871</fpage>–<lpage>878</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1038/nmeth.1694" xlink:type="simple">10.1038/nmeth.1694</ext-link></comment> <object-id pub-id-type="pmid">21909102</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref022">
<label>22</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Friedrich</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Zhou</surname> <given-names>P</given-names></name>, <name name-style="western"><surname>Paninski</surname> <given-names>L</given-names></name>. <article-title>Fast online deconvolution of calcium imaging data</article-title>. <source>PLoS Comput Biol</source>. <year>2017</year>;<volume>13</volume>(<issue>3</issue>):<fpage>e1005423</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1371/journal.pcbi.1005423" xlink:type="simple">10.1371/journal.pcbi.1005423</ext-link></comment> <object-id pub-id-type="pmid">28291787</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref023">
<label>23</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Chen</surname> <given-names>TW</given-names></name>, <name name-style="western"><surname>Wardill</surname> <given-names>T</given-names></name>, <name name-style="western"><surname>Sun</surname> <given-names>Y</given-names></name>, <name name-style="western"><surname>Pulver</surname> <given-names>SR</given-names></name>, <name name-style="western"><surname>Renninger</surname> <given-names>SL</given-names></name>, <name name-style="western"><surname>Baohan</surname> <given-names>A</given-names></name>, <etal>et al</etal>. <article-title>Ultrasensitive fluorescent proteins for imaging neuronal activity</article-title>. <source>Nature</source>. <year>2013</year>;<volume>499</volume>(<issue>7458</issue>):<fpage>295</fpage>–<lpage>300</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1038/nature12354" xlink:type="simple">10.1038/nature12354</ext-link></comment> <object-id pub-id-type="pmid">23868258</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref024">
<label>24</label>
<mixed-citation publication-type="other" xlink:type="simple">GENIE project, Janelia Research Campus, HHMI; Karel Svoboda (contact). Simultaneous imaging and loose-seal cell-attached electrical recordings from neurons expressing a variety of genetically encoded calcium indicators. CRCNS.org; 2015. Available from: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.6080/K02R3PMN" xlink:type="simple">http://dx.doi.org/10.6080/K02R3PMN</ext-link>.</mixed-citation>
</ref>
<ref id="pcbi.1005685.ref025">
<label>25</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Portugues</surname> <given-names>R</given-names></name>, <name name-style="western"><surname>Feierstein</surname> <given-names>CE</given-names></name>, <name name-style="western"><surname>Engert</surname> <given-names>F</given-names></name>, <name name-style="western"><surname>Orger</surname> <given-names>MB</given-names></name>. <article-title>Whole-brain activity maps reveal stereotyped, distributed networks for visuomotor behavior</article-title>. <source>Neuron</source>. <year>2014</year>;<volume>81</volume>(<issue>6</issue>):<fpage>1328</fpage>–<lpage>1343</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1016/j.neuron.2014.01.019" xlink:type="simple">10.1016/j.neuron.2014.01.019</ext-link></comment> <object-id pub-id-type="pmid">24656252</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref026">
<label>26</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Clancy</surname> <given-names>KB</given-names></name>, <name name-style="western"><surname>Koralek</surname> <given-names>AC</given-names></name>, <name name-style="western"><surname>Costa</surname> <given-names>RM</given-names></name>, <name name-style="western"><surname>Feldman</surname> <given-names>DE</given-names></name>, <name name-style="western"><surname>Carmena</surname> <given-names>JM</given-names></name>. <article-title>Volitional modulation of optically recorded calcium signals during neuroprosthetic learning</article-title>. <source>Nat Neurosci</source>. <year>2014</year>;<volume>17</volume>(<issue>6</issue>):<fpage>807</fpage>–<lpage>809</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1038/nn.3712" xlink:type="simple">10.1038/nn.3712</ext-link></comment> <object-id pub-id-type="pmid">24728268</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref027">
<label>27</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Packer</surname> <given-names>AM</given-names></name>, <name name-style="western"><surname>Russell</surname> <given-names>LE</given-names></name>, <name name-style="western"><surname>Dalgleish</surname> <given-names>HW</given-names></name>, <name name-style="western"><surname>Häusser</surname> <given-names>M</given-names></name>. <article-title>Simultaneous all-optical manipulation and recording of neural circuit activity with cellular resolution in vivo</article-title>. <source>Nat Methods</source>. <year>2015</year>;<volume>12</volume>(<issue>2</issue>):<fpage>140</fpage>–<lpage>146</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1038/nmeth.3217" xlink:type="simple">10.1038/nmeth.3217</ext-link></comment> <object-id pub-id-type="pmid">25532138</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref028">
<label>28</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Grosenick</surname> <given-names>L</given-names></name>, <name name-style="western"><surname>Marshel</surname> <given-names>JH</given-names></name>, <name name-style="western"><surname>Deisseroth</surname> <given-names>K</given-names></name>. <article-title>Closed-loop and activity-guided optogenetic control</article-title>. <source>Neuron</source>. <year>2015</year>;<volume>86</volume>(<issue>1</issue>):<fpage>106</fpage>–<lpage>139</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1016/j.neuron.2015.03.034" xlink:type="simple">10.1016/j.neuron.2015.03.034</ext-link></comment> <object-id pub-id-type="pmid">25856490</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref029">
<label>29</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Marblestone</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Zamft</surname> <given-names>B</given-names></name>, <name name-style="western"><surname>Maguire</surname> <given-names>Y</given-names></name>, <name name-style="western"><surname>Shapiro</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Cybulski</surname> <given-names>T</given-names></name>, <name name-style="western"><surname>Glaser</surname> <given-names>J</given-names></name>, <etal>et al</etal>. <article-title>Physical principles for scalable neural recording</article-title>. <source>Front Comput Neurosci</source>. <year>2013</year>;<volume>7</volume>:<fpage>137</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.3389/fncom.2013.00137" xlink:type="simple">10.3389/fncom.2013.00137</ext-link></comment> <object-id pub-id-type="pmid">24187539</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref030">
<label>30</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Hamel</surname> <given-names>EJO</given-names></name>, <name name-style="western"><surname>Grewe</surname> <given-names>BF</given-names></name>, <name name-style="western"><surname>Parker</surname> <given-names>JG</given-names></name>, <name name-style="western"><surname>Schnitzer</surname> <given-names>MJ</given-names></name>. <article-title>Cellular level brain imaging in behaving mammals: an engineering approach</article-title>. <source>Neuron</source>. <year>2015</year>;<volume>86</volume>(<issue>1</issue>):<fpage>140</fpage>–<lpage>159</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1016/j.neuron.2015.03.055" xlink:type="simple">10.1016/j.neuron.2015.03.055</ext-link></comment> <object-id pub-id-type="pmid">25856491</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref031">
<label>31</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Seo</surname> <given-names>D</given-names></name>, <name name-style="western"><surname>Neely</surname> <given-names>RM</given-names></name>, <name name-style="western"><surname>Shen</surname> <given-names>K</given-names></name>, <name name-style="western"><surname>Singhal</surname> <given-names>U</given-names></name>, <name name-style="western"><surname>Alon</surname> <given-names>E</given-names></name>, <name name-style="western"><surname>Rabaey</surname> <given-names>JM</given-names></name>, <etal>et al</etal>. <article-title>Wireless recording in the peripheral nervous system with ultrasonic neural dust</article-title>. <source>Neuron</source>. <year>2016</year>;<volume>91</volume>(<issue>3</issue>):<fpage>529</fpage>–<lpage>539</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1016/j.neuron.2016.06.034" xlink:type="simple">10.1016/j.neuron.2016.06.034</ext-link></comment> <object-id pub-id-type="pmid">27497221</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref032">
<label>32</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Olarte</surname> <given-names>OE</given-names></name>, <name name-style="western"><surname>Andilla</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Artigas</surname> <given-names>D</given-names></name>, <name name-style="western"><surname>Loza-Alvarez</surname> <given-names>P</given-names></name>. <article-title>Decoupled illumination detection in light sheet microscopy for fast volumetric imaging</article-title>. <source>Optica</source>. <year>2015</year>;<volume>2</volume>(<issue>8</issue>):<fpage>702</fpage>–<lpage>705</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1364/OPTICA.2.000702" xlink:type="simple">10.1364/OPTICA.2.000702</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref033">
<label>33</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Mishchencko</surname> <given-names>Y</given-names></name>, <name name-style="western"><surname>Vogelstein</surname> <given-names>JT</given-names></name>, <name name-style="western"><surname>Paninski</surname> <given-names>L</given-names></name>. <article-title>A Bayesian approach for inferring neuronal connectivity from calcium fluorescent imaging data</article-title>. <source>Ann Appl Stat</source>. <year>2011</year>; p. <fpage>1229</fpage>–<lpage>1261</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1214/09-AOAS303" xlink:type="simple">10.1214/09-AOAS303</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref034">
<label>34</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Soudry</surname> <given-names>D</given-names></name>, <name name-style="western"><surname>Keshri</surname> <given-names>S</given-names></name>, <name name-style="western"><surname>Stinson</surname> <given-names>P</given-names></name>, <name name-style="western"><surname>Oh</surname> <given-names>MH</given-names></name>, <name name-style="western"><surname>Iyengar</surname> <given-names>G</given-names></name>, <name name-style="western"><surname>Paninski</surname> <given-names>L</given-names></name>. <article-title>Efficient “shotgun” inference of neural connectivity from highly sub-sampled activity data</article-title>. <source>PLoS Comput Biol</source>. <year>2015</year>;<volume>11</volume>(<issue>10</issue>):<fpage>1</fpage>–<lpage>30</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1371/journal.pcbi.1004464" xlink:type="simple">10.1371/journal.pcbi.1004464</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref035">
<label>35</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Gong</surname> <given-names>Y</given-names></name>, <name name-style="western"><surname>Huang</surname> <given-names>C</given-names></name>, <name name-style="western"><surname>Li</surname> <given-names>JZ</given-names></name>, <name name-style="western"><surname>Grewe</surname> <given-names>BF</given-names></name>, <name name-style="western"><surname>Zhang</surname> <given-names>Y</given-names></name>, <name name-style="western"><surname>Eismann</surname> <given-names>S</given-names></name>, <etal>et al</etal>. <article-title>High-speed recording of neural spikes in awake mice and flies with a fluorescent voltage sensor</article-title>. <source>Science</source>. <year>2015</year>;<volume>350</volume>(<issue>6266</issue>):<fpage>1361</fpage>–<lpage>1366</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1126/science.aab0810" xlink:type="simple">10.1126/science.aab0810</ext-link></comment> <object-id pub-id-type="pmid">26586188</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref036">
<label>36</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Antic</surname> <given-names>SD</given-names></name>, <name name-style="western"><surname>Empson</surname> <given-names>RM</given-names></name>, <name name-style="western"><surname>Knoepfel</surname> <given-names>T</given-names></name>. <article-title>Voltage imaging to understand connections and functions of neuronal circuits</article-title>. <source>J Neurophysiol</source>. <year>2016</year>;<volume>116</volume>(<issue>1</issue>):<fpage>135</fpage>–<lpage>152</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1152/jn.00226.2016" xlink:type="simple">10.1152/jn.00226.2016</ext-link></comment> <object-id pub-id-type="pmid">27075539</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref037">
<label>37</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Gong</surname> <given-names>Y</given-names></name>. <article-title>The evolving capabilities of rhodopsin-based genetically encoded voltage indicators</article-title>. <source>Curr Opin Chem Biol</source>. <year>2015</year>;<volume>27</volume>:<fpage>84</fpage>–<lpage>89</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1016/j.cbpa.2015.05.006" xlink:type="simple">10.1016/j.cbpa.2015.05.006</ext-link></comment> <object-id pub-id-type="pmid">26143170</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref038">
<label>38</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>St-Pierre</surname> <given-names>F</given-names></name>, <name name-style="western"><surname>Chavarha</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Lin</surname> <given-names>MZ</given-names></name>. <article-title>Designs and sensing mechanisms of genetically encoded fluorescent voltage indicators</article-title>. <source>Curr Opin Chem Biol</source>. <year>2015</year>;<volume>27</volume>:<fpage>31</fpage>–<lpage>38</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1016/j.cbpa.2015.05.003" xlink:type="simple">10.1016/j.cbpa.2015.05.003</ext-link></comment> <object-id pub-id-type="pmid">26079047</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref039">
<label>39</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Yang</surname> <given-names>HH</given-names></name>, <name name-style="western"><surname>St-Pierre</surname> <given-names>F</given-names></name>, <name name-style="western"><surname>Sun</surname> <given-names>X</given-names></name>, <name name-style="western"><surname>Ding</surname> <given-names>X</given-names></name>, <name name-style="western"><surname>Lin</surname> <given-names>MZ</given-names></name>, <name name-style="western"><surname>Clandinin</surname> <given-names>TR</given-names></name>. <article-title>Subcellular Imaging of Voltage and Calcium Signals Reveals Neural Processing In Vivo</article-title>. <source>Cell</source>. <year>2016</year>;<volume>166</volume>(<issue>1</issue>):<fpage>245</fpage>–<lpage>257</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1016/j.cell.2016.05.031" xlink:type="simple">10.1016/j.cell.2016.05.031</ext-link></comment> <object-id pub-id-type="pmid">27264607</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref040">
<label>40</label>
<mixed-citation publication-type="book" xlink:type="simple">
<name name-style="western"><surname>Pnevmatikakis</surname> <given-names>EA</given-names></name>, <name name-style="western"><surname>Paninski</surname> <given-names>L</given-names></name>. <chapter-title>Sparse nonnegative deconvolution for compressive calcium imaging: algorithms and phase transitions</chapter-title>. In: <source>Adv Neural Inf Process Syst</source> <volume>26</volume>; <year>2013</year>. p. <fpage>1250</fpage>–<lpage>1258</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1005685.ref041">
<label>41</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Yang</surname> <given-names>W</given-names></name>, <name name-style="western"><surname>Miller</surname> <given-names>JK</given-names></name>, <name name-style="western"><surname>Carrillo-Reid</surname> <given-names>L</given-names></name>, <name name-style="western"><surname>Pnevmatikakis</surname> <given-names>E</given-names></name>, <name name-style="western"><surname>Paninski</surname> <given-names>L</given-names></name>, <name name-style="western"><surname>Yuste</surname> <given-names>R</given-names></name>, <etal>et al</etal>. <article-title>Simultaneous multi-plane imaging of neural circuits</article-title>. <source>Neuron</source>. <year>2016</year>;<volume>89</volume>(<issue>2</issue>):<fpage>269</fpage>–<lpage>284</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1016/j.neuron.2015.12.012" xlink:type="simple">10.1016/j.neuron.2015.12.012</ext-link></comment> <object-id pub-id-type="pmid">26774159</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref042">
<label>42</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Lu</surname> <given-names>R</given-names></name>, <name name-style="western"><surname>Sun</surname> <given-names>W</given-names></name>, <name name-style="western"><surname>Liang</surname> <given-names>Y</given-names></name>, <name name-style="western"><surname>Kerlin</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Bierfeld</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Seelig</surname> <given-names>J</given-names></name>, <etal>et al</etal>. <article-title>Video-rate volumetric functional imaging of the brain at synaptic resolution</article-title>. <source>Nat Neurosci</source>. <year>2017</year>;<volume>20</volume>(<issue>4</issue>):<fpage>620</fpage>–<lpage>628</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1038/nn.4516" xlink:type="simple">10.1038/nn.4516</ext-link></comment> <object-id pub-id-type="pmid">28250408</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref043">
<label>43</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Song</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Charles</surname> <given-names>AS</given-names></name>, <name name-style="western"><surname>Koay</surname> <given-names>SA</given-names></name>, <name name-style="western"><surname>Gauthier</surname> <given-names>JL</given-names></name>, <name name-style="western"><surname>Thiberge</surname> <given-names>SY</given-names></name>, <name name-style="western"><surname>Pillow</surname> <given-names>JW</given-names></name>, <etal>et al</etal>. <article-title>Volumetric two-photon imaging of neurons using stereoscopy (vTwINS)</article-title>. <source>Nat Methods</source>. <year>2017</year>;<volume>14</volume>(<issue>4</issue>):<fpage>420</fpage>–<lpage>426</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1038/nmeth.4226" xlink:type="simple">10.1038/nmeth.4226</ext-link></comment> <object-id pub-id-type="pmid">28319111</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref044">
<label>44</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Botcherby</surname> <given-names>EJ</given-names></name>, <name name-style="western"><surname>Juskaitis</surname> <given-names>R</given-names></name>, <name name-style="western"><surname>Booth</surname> <given-names>MJ</given-names></name>, <name name-style="western"><surname>Wilson</surname> <given-names>T</given-names></name>. <article-title>Aberration-free optical refocusing in high numerical aperture microscopy</article-title>. <source>Opt Lett</source>. <year>2007</year>;<volume>32</volume>(<issue>14</issue>):<fpage>2007</fpage>–<lpage>2009</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1364/OL.32.002007" xlink:type="simple">10.1364/OL.32.002007</ext-link></comment> <object-id pub-id-type="pmid">17632625</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref045">
<label>45</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Fahrbach</surname> <given-names>FO</given-names></name>, <name name-style="western"><surname>Voigt</surname> <given-names>FF</given-names></name>, <name name-style="western"><surname>Schmid</surname> <given-names>B</given-names></name>, <name name-style="western"><surname>Helmchen</surname> <given-names>F</given-names></name>, <name name-style="western"><surname>Huisken</surname> <given-names>J</given-names></name>. <article-title>Rapid 3D light-sheet microscopy with a tunable lens</article-title>. <source>Opt Express</source>. <year>2013</year>;<volume>21</volume>(<issue>18</issue>):<fpage>21010</fpage>–<lpage>21026</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1364/OE.21.021010" xlink:type="simple">10.1364/OE.21.021010</ext-link></comment> <object-id pub-id-type="pmid">24103973</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref046">
<label>46</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Broxton</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Grosenick</surname> <given-names>L</given-names></name>, <name name-style="western"><surname>Yang</surname> <given-names>S</given-names></name>, <name name-style="western"><surname>Cohen</surname> <given-names>N</given-names></name>, <name name-style="western"><surname>Andalman</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Deisseroth</surname> <given-names>K</given-names></name>, <etal>et al</etal>. <article-title>Wave optics theory and 3-D deconvolution for the light field microscope</article-title>. <source>Opt Express</source>. <year>2013</year>;<volume>21</volume>(<issue>21</issue>):<fpage>25418</fpage>–<lpage>25439</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1364/OE.21.025418" xlink:type="simple">10.1364/OE.21.025418</ext-link></comment> <object-id pub-id-type="pmid">24150383</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref047">
<label>47</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Prevedel</surname> <given-names>R</given-names></name>, <name name-style="western"><surname>Yoon</surname> <given-names>YG</given-names></name>, <name name-style="western"><surname>Hoffmann</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Pak</surname> <given-names>N</given-names></name>, <name name-style="western"><surname>Wetzstein</surname> <given-names>G</given-names></name>, <name name-style="western"><surname>Kato</surname> <given-names>S</given-names></name>, <etal>et al</etal>. <article-title>Simultaneous whole-animal 3D imaging of neuronal activity using light-field microscopy</article-title>. <source>Nat Methods</source>. <year>2014</year>;<volume>11</volume>(<issue>7</issue>):<fpage>727</fpage>–<lpage>730</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1038/nmeth.2964" xlink:type="simple">10.1038/nmeth.2964</ext-link></comment> <object-id pub-id-type="pmid">24836920</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref048">
<label>48</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Pegard</surname> <given-names>NC</given-names></name>, <name name-style="western"><surname>Liu</surname> <given-names>HY</given-names></name>, <name name-style="western"><surname>Antipa</surname> <given-names>N</given-names></name>, <name name-style="western"><surname>Gerlock</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Adesnik</surname> <given-names>H</given-names></name>, <name name-style="western"><surname>Waller</surname> <given-names>L</given-names></name>. <article-title>Compressive light-field microscopy for 3D neural activity recording</article-title>. <source>Optica</source>. <year>2016</year>;<volume>3</volume>(<issue>5</issue>):<fpage>517</fpage>–<lpage>524</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1364/OPTICA.3.000517" xlink:type="simple">10.1364/OPTICA.3.000517</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref049">
<label>49</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Watson</surname> <given-names>BO</given-names></name>, <name name-style="western"><surname>Nikolenko</surname> <given-names>V</given-names></name>, <name name-style="western"><surname>Araya</surname> <given-names>R</given-names></name>, <name name-style="western"><surname>Peterka</surname> <given-names>DS</given-names></name>, <name name-style="western"><surname>Woodruff</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Yuste</surname> <given-names>R</given-names></name>. <article-title>Two-photon microscopy with diffractive optical elements and spatial light modulators</article-title>. <source>Front Neurosci</source>. <year>2010</year>;<volume>4</volume>:<fpage>29</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.3389/fnins.2010.00029" xlink:type="simple">10.3389/fnins.2010.00029</ext-link></comment> <object-id pub-id-type="pmid">20859526</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref050">
<label>50</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Nikolenko</surname> <given-names>V</given-names></name>, <name name-style="western"><surname>Watson</surname> <given-names>BO</given-names></name>, <name name-style="western"><surname>Araya</surname> <given-names>R</given-names></name>, <name name-style="western"><surname>Woodruff</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Peterka</surname> <given-names>DS</given-names></name>, <name name-style="western"><surname>Yuste</surname> <given-names>R</given-names></name>. <article-title>SLM microscopy: Scanless two-photon imaging and photostimulation using spatial light modulators</article-title>. <source>Front Neural Circuits</source>. <year>2008</year>;<volume>2</volume>:<fpage>5</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.3389/neuro.04.005.2008" xlink:type="simple">10.3389/neuro.04.005.2008</ext-link></comment> <object-id pub-id-type="pmid">19129923</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref051">
<label>51</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Ahrens</surname> <given-names>MB</given-names></name>, <name name-style="western"><surname>Li</surname> <given-names>JM</given-names></name>, <name name-style="western"><surname>Orger</surname> <given-names>MB</given-names></name>, <name name-style="western"><surname>Robson</surname> <given-names>DN</given-names></name>, <name name-style="western"><surname>Schier</surname> <given-names>AF</given-names></name>, <name name-style="western"><surname>Engert</surname> <given-names>F</given-names></name>, <etal>et al</etal>. <article-title>Brain-wide neuronal dynamics during motor adaptation in zebrafish</article-title>. <source>Nature</source>. <year>2012</year>;<volume>485</volume>(<issue>7399</issue>):<fpage>471</fpage>–<lpage>477</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1038/nature11057" xlink:type="simple">10.1038/nature11057</ext-link></comment> <object-id pub-id-type="pmid">22622571</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref052">
<label>52</label>
<mixed-citation publication-type="other" xlink:type="simple">Hsieh C, Dhillon I. Fast coordinate descent methods with variable selection for non-negative matrix factorization. In: ACM SIGKDD Int Conf Knowl Discov Data Min 17; 2011. p. 1064–1072.</mixed-citation>
</ref>
<ref id="pcbi.1005685.ref053">
<label>53</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Vogelstein</surname> <given-names>JT</given-names></name>, <name name-style="western"><surname>Packer</surname> <given-names>AM</given-names></name>, <name name-style="western"><surname>Machado</surname> <given-names>TA</given-names></name>, <name name-style="western"><surname>Sippy</surname> <given-names>T</given-names></name>, <name name-style="western"><surname>Babadi</surname> <given-names>B</given-names></name>, <name name-style="western"><surname>Yuste</surname> <given-names>R</given-names></name>, <etal>et al</etal>. <article-title>Fast nonnegative deconvolution for spike train inference from population calcium imaging</article-title>. <source>J Neurophysiol</source>. <year>2010</year>;<volume>104</volume>(<issue>6</issue>):<fpage>3691</fpage>–<lpage>3704</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1152/jn.01073.2009" xlink:type="simple">10.1152/jn.01073.2009</ext-link></comment> <object-id pub-id-type="pmid">20554834</object-id></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref054">
<label>54</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Halko</surname> <given-names>N</given-names></name>, <name name-style="western"><surname>Martinsson</surname> <given-names>PG</given-names></name>, <name name-style="western"><surname>Tropp</surname> <given-names>JA</given-names></name>. <article-title>Finding structure with randomness: probabilistic algorithms for constructing approximate matrix decompositions</article-title>. <source>SIAM Review</source>. <year>2011</year>;<volume>53</volume>(<issue>2</issue>):<fpage>217</fpage>–<lpage>288</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.1137/090771806" xlink:type="simple">10.1137/090771806</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1005685.ref055">
<label>55</label>
<mixed-citation publication-type="other" xlink:type="simple">Giovannucci A, Friedrich J, Deverett B, Staneva V, Chklovskii D, Pnevmatikakis E. CaImAn: An open source toolbox for large scale calcium imaging data analysis on standalone machines; 2017. Cosyne Abstracts 2017, Salt Lake City USA. Available from: <ext-link ext-link-type="uri" xlink:href="https://github.com/simonsfoundation/CaImAn" xlink:type="simple">https://github.com/simonsfoundation/CaImAn</ext-link>.</mixed-citation>
</ref>
<ref id="pcbi.1005685.ref056">
<label>56</label>
<mixed-citation publication-type="other" xlink:type="simple">Friedrich J, Soudry D, Mu Y, Freeman J, Ahrens MB, Paninski L. Fast constrained non-negative matrix factorization for whole-brain calcium imaging data. In: NIPS workshop on statistical methods for understanding neural systems; 2015.</mixed-citation>
</ref>
</ref-list>
</back>
</article>