<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article
  PUBLIC "-//NLM//DTD Journal Publishing DTD v3.0 20080202//EN" "http://dtd.nlm.nih.gov/publishing/3.0/journalpublishing3.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="3.0" xml:lang="EN"><front><journal-meta><journal-id journal-id-type="publisher-id">plos</journal-id><journal-id journal-id-type="nlm-ta">PLoS Comput Biol</journal-id><journal-id journal-id-type="pmc">ploscomp</journal-id><!--===== Grouping journal title elements =====--><journal-title-group><journal-title>PLoS Computational Biology</journal-title></journal-title-group><issn pub-type="ppub">1553-734X</issn><issn pub-type="epub">1553-7358</issn><publisher><publisher-name>Public Library of Science</publisher-name><publisher-loc>San Francisco, USA</publisher-loc></publisher></journal-meta><article-meta><article-id pub-id-type="publisher-id">07-PLCB-RA-0370R3</article-id><article-id pub-id-type="doi">10.1371/journal.pcbi.1000090</article-id><article-categories><subj-group subj-group-type="heading"><subject>Research Article</subject></subj-group><subj-group subj-group-type="Discipline"><subject>Computational Biology/Comparative Sequence Analysis</subject><subject>Computational Biology/Evolutionary Modeling</subject><subject>Computational Biology/Sequence Motif Analysis</subject></subj-group></article-categories><title-group><article-title>CSMET: Comparative Genomic Motif Detection via Multi-Resolution Phylogenetic Shadowing</article-title><alt-title alt-title-type="running-head">Comparative Genomic Motif Scan Under Site Turnover</alt-title></title-group><contrib-group><contrib contrib-type="author" equal-contrib="yes" xlink:type="simple"><name name-style="western"><surname>Ray</surname><given-names>Pradipta</given-names></name><xref ref-type="aff" rid="aff1"/></contrib><contrib contrib-type="author" equal-contrib="yes" xlink:type="simple"><name name-style="western"><surname>Shringarpure</surname><given-names>Suyash</given-names></name><xref ref-type="aff" rid="aff1"/></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Kolar</surname><given-names>Mladen</given-names></name><xref ref-type="aff" rid="aff1"/></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Xing</surname><given-names>Eric P.</given-names></name><xref ref-type="aff" rid="aff1"/><xref ref-type="corresp" rid="cor1"><sup>*</sup></xref></contrib></contrib-group><aff id="aff1">          <addr-line>School of Computer Science, Carnegie Mellon University, Pittsburgh, Pennsylvania, United States of America</addr-line>       </aff><contrib-group><contrib contrib-type="editor" xlink:type="simple"><name name-style="western"><surname>Ohler</surname><given-names>Uwe</given-names></name><role>Editor</role><xref ref-type="aff" rid="edit1"/></contrib></contrib-group><aff id="edit1">Duke University, United States of America</aff><author-notes><corresp id="cor1">* E-mail: <email xlink:type="simple">eric.xing@gmail.com</email></corresp><fn fn-type="con"><p>Conceived and designed the experiments: EX. Performed the experiments: PR SS. Analyzed the data: PR SS MK EX. Wrote the paper: EX. Designed the model: EX.</p></fn><fn fn-type="conflict"><p>The authors have declared that no competing interests exist.</p></fn></author-notes><pub-date pub-type="collection"><month>6</month><year>2008</year></pub-date><pub-date pub-type="epub"><day>6</day><month>6</month><year>2008</year></pub-date><volume>4</volume><issue>6</issue><elocation-id>e1000090</elocation-id><history><date date-type="received"><day>29</day><month>6</month><year>2007</year></date><date date-type="accepted"><day>28</day><month>4</month><year>2008</year></date></history><!--===== Grouping copyright info into permissions =====--><permissions><copyright-year>2008</copyright-year><copyright-holder>Ray et al</copyright-holder><license><license-p>This is an open-access article distributed under the terms of the Creative Commons Attribution License, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p></license></permissions><abstract><p>Functional turnover of transcription factor binding sites (TFBSs), such as whole-motif loss or gain, are common events during genome evolution. Conventional probabilistic phylogenetic shadowing methods model the evolution of genomes only at nucleotide level, and lack the ability to capture the evolutionary dynamics of functional turnover of aligned sequence entities. As a result, comparative genomic search of non-conserved motifs across evolutionarily related taxa remains a difficult challenge, especially in higher eukaryotes, where the <italic>cis</italic>-regulatory regions containing motifs can be long and divergent; existing methods rely heavily on specialized pattern-driven heuristic search or sampling algorithms, which can be difficult to generalize and hard to interpret based on phylogenetic principles. We propose a new method: Conditional Shadowing via Multi-resolution Evolutionary Trees, or CSMET, which uses a context-dependent probabilistic graphical model that allows aligned sites from different taxa in a multiple alignment to be modeled by either a background or an appropriate motif phylogeny conditioning on the functional specifications of each taxon. The functional specifications themselves are the output of a phylogeny which models the evolution not of individual nucleotides, but of the overall functionality (e.g., functional retention or loss) of the aligned sequence segments over lineages. Combining this method with a hidden Markov model that autocorrelates evolutionary rates on successive sites in the genome, CSMET offers a principled way to take into consideration lineage-specific evolution of TFBSs during motif detection, and a readily computable analytical form of the posterior distribution of motifs under TFBS turnover. On both simulated and real <italic>Drosophila cis</italic>-regulatory modules, CSMET outperforms other state-of-the-art comparative genomic motif finders.</p></abstract><abstract abstract-type="summary"><title>Author Summary</title><p>Functional turnover of transcription factor binding sites (TFBSs), such as whole-motif loss or gain, are common events during genome evolution, and play a major role in shaping the genome and regulatory circuitry of contemporary species. Conventional methods for searching non-conserved motifs across evolutionarily related species have little or no probabilistic machinery to explicitly model this important evolutionary process; therefore, they offer little insight into the mechanism and dynamics of TFBS turnover and have limited power in finding motif patterns shaped by such processes. In this paper, we propose a new method: Conditional Shadowing via Multi-resolution Evolutionary Trees, or CSMET, which uses a mathematically elegant and computationally efficient way to model biological sequence evolution at both nucleotide level at each individual site, and functional level of a whole TFBS. CSMET offers the first principled way to take into consideration lineage-specific evolution of TFBSs and CRMs during motif detection, and offers a readily computable analytical form of the posterior distribution of motifs under TFBS turnover. Its performance improves upon current state-of-the-art programs. It represents an initial foray into the problem of statistical inference of functional evolution of TFBS, and offers a well-founded mathematical basis for the development of more realistic and informative models.</p></abstract><funding-group><funding-statement>This material is based upon work supported by an NSF CAREER Award to EPX under grant No. DBI-0546594.</funding-statement></funding-group><counts><page-count count="20"/></counts></article-meta></front><body><sec id="s1"><title>Introduction</title><p>Phylogenetic shadowing techniques based on probabilistic molecular evolution models have been widely used in various comparative genomic analyses to uncover sequence entities believed to be conserved across species <xref ref-type="bibr" rid="pcbi.1000090-Boffelli1">[1]</xref>–<xref ref-type="bibr" rid="pcbi.1000090-Wang1">[4]</xref>. It is nothworthy that in the literature, the term “Phylogenetic Shadowing” has sometimes been (unnecessarily) narrowed down to refer to methods tailored specifically to the case of analyzing extremely closely related species, after its successful application to functional annotation of the primate genomes <xref ref-type="bibr" rid="pcbi.1000090-Boffelli1">[1]</xref>. Here we adopt a more general interpretation reflecting the long-standing evolutionary principles and inferential technique underlying such analysis, rather than the choice of the study subjects. It refers to the class of methods that treat evolutionarily related entities as outcomes of some stochastic processes structured as a phylogeny, whereby the relationships between the studied entities can be inferred and utilized to unravel their underlying characteristics of interest. Typically, extant phylogenetic shadowing methods employ either a nucleotide (nt) or an amino-acid (aa) substitution process to model the evolution of orthologous entities, such as genes or proteins of interest at every nt or aa site. There are two key assumptions underlying the basic form of these approaches. 1) The orthology of the sequence entities across taxa, as captured by a multiple sequence alignment, is <italic>complete</italic> in the sense that there is no functional turnover of the aligned entities (e.g., no loss or gain of a gene) in any of the taxa; so that all aligned sequences can be modeled as descendants of a common ancestor following a <italic>single</italic> evolutionary tree model unique to the function (e.g., either gene or background) of the sequence entities. 2) Every site in the same entity evolves independently. Although not realistic, such a <italic>complete</italic> and <italic>independent</italic> shadowing model can lead to efficient algorithms for scoring aligned sequences; and in practice it works well for modeling large and highly conserved functional entities such as gene coding regions in phylogenetically closely related taxa, and it has led to a number of successful comparative genomic gene finders <xref ref-type="bibr" rid="pcbi.1000090-McAuliffe1">[5]</xref>–<xref ref-type="bibr" rid="pcbi.1000090-Siepel2">[7]</xref>.</p><p>Unlike genes, where functional turnover usually occurs only in distant species and the complete orthology assumption is largely satisfied when sequences are aligned across phylogenetically closely related species, short and degenerate sequence patterns such as transcription factor (TF) binding sites (i.e., motifs) exhibit frequent turnover even across closely related taxa, such as various fruit fly species <xref ref-type="bibr" rid="pcbi.1000090-Ludwig1">[8]</xref> (<xref ref-type="fig" rid="pcbi-1000090-g001">Figure 1</xref>). As we will discuss shortly, the functional heterogeneity of aligned regions across different taxa due to motif turnover often renders the conventional phylogenetic shadowing models inappropriate for comparative genomic motif finding. Some recent methods combine scoring functions modified from classic molecular evolution models with more flexible heuristic partial alignment search, and exhibit better sensitivity to non-conserved motifs <xref ref-type="bibr" rid="pcbi.1000090-Siddharthan1">[9]</xref>,<xref ref-type="bibr" rid="pcbi.1000090-Sinha1">[10]</xref>, but they offer little insight into the evolutionary dynamics of motif turnover and can have substantial computational complexity. In this paper, we present a principled approach that addresses the “incomplete orthology” issue arising from either functional gain/loss such as motif turnover or imperfect sequence alignment. We propose a new algorithm for searching binding sites of given TFs in multiple genomes based on a novel multi-resolution evolutionary model named CSMET. CSMET stands for Conditional Shadowing via Multi-resolution Evolutionary Trees. It explicitly models motif turnover across species through a “low resolution” phylogeny defined by a <italic>functional substitution process</italic>. Conditioning on the motif turnover states, which specify the presence or absence of TFBS functionality in each taxon, at any given location, specific “high resolution” phylogenies defined by function-specific <italic>nucleotide substitution processes</italic> are applied to different subsets (corresponding to taxa with different turnover status) of the aligned sequences at the attendant location. The model thereby captures function-specific sequence evolution in every taxon rather than subjecting all taxa to the same phylogeny as in the conventional model (<xref ref-type="fig" rid="pcbi-1000090-g002">Figure 2</xref>).</p><fig id="pcbi-1000090-g001" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1000090.g001</object-id><label>Figure 1</label><caption><title>A demonstration of motif turnover.</title><p>(A) Two examples of multiple alignments of <italic>Drosophila</italic> CRMs, showing functional turnover in known TFBSs. The first one (top) shows an instance of binding site loss in <italic>D. ananassae</italic>, the motif in question being <italic>Caudal</italic>, in the <italic>Hairy 6</italic> CRM. The second one (bottom) shows more instances of TFBS loss/gain. This example depicts a turnover with only <italic>melanogaster</italic>, <italic>simulans,</italic> and <italic>sechellia</italic> retaining the binding site functionality. (B) Putative TFBSs in <italic>eve</italic>2 enhancer across 4 taxa: <italic>D. melanogaster</italic>, <italic>D. yakuba</italic>, <italic>D. erecta</italic> and <italic>D. pseudoobscura</italic>. (Extracted and modified from Figure 4 in <xref ref-type="bibr" rid="pcbi.1000090-Ludwig2">[11]</xref>.) Notice that orthologs of <italic>melanogaster</italic> motifs bcd-3 and hb can not be identified from some of the other taxa.</p></caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000090.g001" xlink:type="simple"/></fig><fig id="pcbi-1000090-g002" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1000090.g002</object-id><label>Figure 2</label><caption><title>Diagrams showing the underlying generative models underlying basic phylogenetic shadowing approaches and the CSMET approach.</title><p>(A) The basic mixture of full-phylogeny model underlying PhyloHMM and EMnEM, where functional homogeneity across aligned sequences is assumed, and all aligned taxa (i.e., rows) are either under a full motif phylogeny (when <italic>Z<sub>t</sub></italic> = 1) or a full background phylogeny (when <italic>Z<sub>t</sub></italic> = 0). (B) The conditional shadowing model underlying CSMET, with an explicit evolutionary model <italic>T<sub>f</sub></italic> for species-specific functional turnover, and partial motif or background phylogenies over subsets of taxa according to the turnover status. See the <xref ref-type="sec" rid="s2">Results</xref> section for explanations of the notations.</p></caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000090.g002" xlink:type="simple"/></fig><sec id="s1a"><title>Comparative Genomic Motif Search Under Incomplete Orthology</title><p>We concern ourselves with uncovering motifs in eukaryotic <italic>cis</italic>-regulatory modules (CRM) from multiple evolutionarily related species, such as the members from the <italic>Drosophila</italic> clade. Due to high degeneracy of motif instances, and complex motif organization within the CRMs, pattern-matching-based motif search in higher eukaryotes remains a difficult problem, even when representations such as the position weight matrices (PWMs) of the motifs are given. Extant methods that operate on a single genome or simpler organisms such as yeast often yield a large number of false positives, especially when the sequence to be examined spans a long region (e.g., tens of thousands of bps) beyond the basal promoters, where possible CRMs could be located. As in gene finding, having orthologous sequences from multiple evolutionarily related taxa can potentially benefit motif detection because a reasonable alignment of these sequences could enhance the contrast of sequence conservation in motifs with respect to that of the non-motif regions, However, the alignment quality of non-coding regions is usually significantly worse than that of the coding regions, so that the aligned motif sequences are not reliably orthologous. This is often unavoidable even for the best possible local alignment software because of the short lengths and weak conservation of TFBSs. When applying a standard shadowing model on such alignments, motif instances aligned with non-orthologous sequences or gaps can be hard to identify due to low overall shadowing score of the aligned sequences (<xref ref-type="fig" rid="pcbi-1000090-g001">Figure 1A</xref>).</p><p>In addition to the <italic>incomplete orthology</italic> due to imperfect alignment, a more serious concern comes from a legitimate uncertainty over the actual functional orthology of regions that are <italic>alignment-wise</italic> orthologous.</p><p>A number of recent investigations have shown that TFBS loss and gain are fairly common events during genome evolution <xref ref-type="bibr" rid="pcbi.1000090-Ludwig1">[8]</xref>,<xref ref-type="bibr" rid="pcbi.1000090-Moses1">[12]</xref>. For example, Patel et al <xref ref-type="bibr" rid="pcbi.1000090-Ludwig3">[13]</xref> showed that aligned “motif sites” in orthologous CRMs in the <italic>Drosophila</italic> clade may have varying functionality in different taxa. Such cases usually occur in regions with reduced evolutionary constraints, such as regions where motifs are abundant, or near a duplication event. The sequence dissimilarities of CRMs across taxa include indel events in the spacers, as well as gains and losses of binding sites for TFs such as the bcd-3 and hb-1 motifs in the <italic>evenskipped</italic> stripe 2 (<italic>eve2</italic>) (<xref ref-type="fig" rid="pcbi-1000090-g001">Figure 1B</xref>). A recent statistical analysis of the <italic>Zeste</italic> binding sites in several <italic>Drosophila</italic> taxa also revealed existence of large-scale functional turnover <xref ref-type="bibr" rid="pcbi.1000090-Moses1">[12]</xref>. Nevertheless, the fact that sequence similarity is absent does not necessarily mean that the overall functional effect of the CRM as a whole is vastly different. In fact, for the <italic>Drosophila</italic> clade, despite the substantial sequence dissimilarity in gap-gene CRMs such as <italic>eve2</italic>, the expression of these gap genes shows similar spatio-temporal stripe patterns across the taxa <xref ref-type="bibr" rid="pcbi.1000090-Ludwig1">[8]</xref>,<xref ref-type="bibr" rid="pcbi.1000090-Ludwig3">[13]</xref>.</p><p>Although a clear understanding of the evolutionary dynamics underlying such inter- and intra-taxa diversity is still lacking, it is hypothesized that regulatory sequences such as TFBSs and CRMs may undergo adaptive evolution via stabilizing selections acting synergistically on different loci within the sequence elements <xref ref-type="bibr" rid="pcbi.1000090-Ludwig1">[8]</xref>,<xref ref-type="bibr" rid="pcbi.1000090-Moses1">[12]</xref>, which causes site evolution to be non-<italic>iid</italic> and non-<italic>isotropic</italic> across all taxa. In such a scenario, it is crucial to be able to model the evolution of biological entities not only at the resolution of individual nucleotides, but also at more macroscopic levels, such as the functionality of whole sequence elements such as TFBSs over lineages. To our knowledge, so far there have been few attempts along this line, especially in the context of motif detection. The CSMET model presented in this paper intends to address this issue.</p></sec><sec id="s1b"><title>Related Work</title><p>Orthology-based motif detection methods developed so far are mainly based on nucleotide-level conservation. Some of the methods do not resort to a formal evolutionary model <xref ref-type="bibr" rid="pcbi.1000090-Blanchette2">[14]</xref>, but are guided by either empirical conservation measures <xref ref-type="bibr" rid="pcbi.1000090-Blanchette3">[15]</xref>–<xref ref-type="bibr" rid="pcbi.1000090-Sandelin1">[17]</xref>, such as parsimonious substitution events or window-based nucleotide identity, or by empirical likelihood functions not explicitly modeling sequence evolution <xref ref-type="bibr" rid="pcbi.1000090-Wang1">[4]</xref>,<xref ref-type="bibr" rid="pcbi.1000090-Benos1">[18]</xref>,<xref ref-type="bibr" rid="pcbi.1000090-Kantorovitz1">[19]</xref>. The advantage of these non-phylogeny based methods lies in the simplicity of their design, and their non-reliance on strong evolutionary assumptions. However, since they do not correspond to explicit evolutionary models, their utility is restricted to purely pattern search, and not for analytical tasks such as ancestral inference or evolutionary parameter estimation. Some of these methods employ specialized heuristic search algorithms that are difficult to scale up to multiple species, or generalize to aligned sequences with high divergence.</p><p>Phylogenetic methods such as EMnEM <xref ref-type="bibr" rid="pcbi.1000090-Moses2">[20]</xref>, MONKEY <xref ref-type="bibr" rid="pcbi.1000090-Moses3">[21]</xref>, and our in-house implementation of PhyloHMM (originally implemented in <xref ref-type="bibr" rid="pcbi.1000090-Boffelli1">[1]</xref> for gene finding, but in our own version tailored for motif search) explicitly adopt a <italic>complete</italic> and <italic>independent</italic> shadowing model at the nucleotide level. These methods are all based on the assumption of homogeneity of functionality across orthologous nucleotides, which is not always true even among relatively closely related species (e.g., of divergence less than 50 mya in <italic>Drosophila</italic>).</p><p>Empirical estimation and simulation of turnover events is an emerging subject in the literature <xref ref-type="bibr" rid="pcbi.1000090-Moses1">[12]</xref>,<xref ref-type="bibr" rid="pcbi.1000090-Huang1">[22]</xref>, but to our knowledge, no explicit evolutionary model for functional turnover has been proposed and brought to bear in comparative genomic search of non-conserved motifs. Thus our CSMET model represents an initial foray in this direction. Closely related to our work, two recent algorithms, rMonkey <xref ref-type="bibr" rid="pcbi.1000090-Moses1">[12]</xref>—an extension over the MONKEY program, and PhyloGibbs <xref ref-type="bibr" rid="pcbi.1000090-Siddharthan1">[9]</xref>—a Gibbs sampling based motif detection algorithm, can also explicitly account for differential functionality among orthologs, both using the technique of shuffling or reducing the input alignment to create well conserved local subalignments. But in both methods, no explicit functional turnover model has been used to infer the turnover events. Another recent program, PhyME <xref ref-type="bibr" rid="pcbi.1000090-Sinha1">[10]</xref>, partially addresses the incomplete orthology issue via a heuristic that allows motifs only present in a pre-chosen <italic>reference</italic> taxon to be also detectable, but it is not clear how to generalize this ability to motifs present in arbitrary combination of other taxa, and so far no well-founded evolutionary hypothesis and model is provided to explain the heuristic. Non-homogeneous conservation due to selection across aligned sites has also been studied in DLESS <xref ref-type="bibr" rid="pcbi.1000090-Siepel3">[23]</xref> and PhastCons <xref ref-type="bibr" rid="pcbi.1000090-Margulies1">[24]</xref>, but unlike in CSMET, no explicit substitution model for lineage-specific functional evolution was used in these algorithms, and the HMM-based model employed there makes it computationally much more expensive than CSMET to systematically explore all possible evolutionary hypotheses. A notable work in the context of protein classification proposed a phylogenomic model over protein functions, which employs a regression-like functional to model the evolution of protein functions represented as feature vectors along lineages in a <italic>complete</italic> phylogeny <xref ref-type="bibr" rid="pcbi.1000090-Engelhardt1">[25]</xref>, but such ideas have not been explored so far for comparative genomic motif search.</p><p>Various nucleotide substitution models, including the Jukes-Cantor 69 (JC69) model <xref ref-type="bibr" rid="pcbi.1000090-Jukes1">[26]</xref>, and the Felsenstein 81 (F81) model <xref ref-type="bibr" rid="pcbi.1000090-Felsenstein1">[27]</xref>, have been employed in current phylogenetic shadowing or footprinting algorithms. PhyloGibbs and PhyME use an analogue of F81 proposed in <xref ref-type="bibr" rid="pcbi.1000090-Sinha2">[28]</xref>, which is one of the simplest models to handle arbitrary stationary distributions, necessary to model various specific PWMs of motifs. Both PhyME and PhyloGibbs also offer an alternative to use a simplified star-phylogeny to replace the phylogenetic tree when dealing with a large number of taxa, which corresponds to an even simpler substitution process.</p></sec><sec id="s1c"><title>The CSMET Approach</title><p>Our CSMET model differs from these existing methods in several important ways. First, it uses a different evolutionary model based on a coupled-set of both functional and nucleotide substitution processes, rather than a single nucleotide substitution model to score every alignment block. Second, it uses a more sophisticated and popular nucleotide substitution process based on the Felsenstein84 (F84) model <xref ref-type="bibr" rid="pcbi.1000090-Felsenstein2">[29]</xref>, which captures the transition/transversion bias. Third, it employs a hidden Markov model that explicitly models autocorrelation of evolutionary rates on successive sites in the genome. Fourth, it uses an efficient deterministic inference algorithm that is linear to the length of the input sequence and either exponential (under a full functional phylogeny) or linear (under a star-shaped functional phylogeny) to the number of the aligned taxa, rather than the Monte Carlo or heuristic search algorithms that require long convergence times.</p><p>Essentially, CSMET is a context-dependent probabilistic graphical model that allows a single column in a multiple alignment to be modeled by multiple evolutionary trees conditioned on the functional specifications of each row (i.e., the functional identity of a substring in the corresponding taxon) (<xref ref-type="fig" rid="pcbi-1000090-g002">Figure 2</xref>). When conjoined with a hidden Markov model that auto-correlates the choices of different evolutionary rates on the phylogenetic trees at different sites, we have a stochastic generative model of phylogenetically related CRM sequences that allows both binding site turnover in arbitrary subsets of taxa, and coupling of evolutionary forces at different sites based on the motif organizations within CRMs. Overall, CSMET offers an elegant and efficient way to take into consideration complex evolutionary mechanisms of regulatory sequences during motif detection. When such a model is properly trained on annotated sequences, it can be used for comparative genomic motif search in all aligned taxa based on a posterior probabilistic inference algorithm. This model can be also used for <italic>de novo</italic> motif finding as programs such as PhyloGibbs and PhyME, with a straightforward extension of the inference procedure that couples the training and prediction routines in an expectation-maximization (EM) iteration on unannotated sequence alignments. In this paper, we focus on supervised motif search in higher eukaryotic genomes.</p><p>We compare CSMET with representative competing algorithms, including EMnEm, PhyloHMM, PhyloGibbs, and a mono-genomic baseline Stubb (which uses an HMM on single species) on both simulated data, and a pre-aligned Drosophila dataset containing 14 developmental CRMs for 11 aligned <italic>Drosophila</italic> species. Annotations for motif occurrences in <italic>D. melanogaster</italic> of 5 gap-gene TFs - <italic>Bicoid</italic>, <italic>Caudal</italic>, <italic>Hunchback</italic>, <italic>Kruppel</italic> and <italic>Knirps</italic> - were obtained from the literature. We show that CSMET outperforms the other methods on both synthetic and real data, and identifies a number of previously unknown occurrences of motifs within and near the study CRMs. The CSMET program, the data used in this analysis, and the predicted TFBS in <italic>Drosophila</italic> sequences, are available for download at <ext-link ext-link-type="uri" xlink:href="http://www.sailing.cs.cmu.edu/csmet/" xlink:type="simple">http://www.sailing.cs.cmu.edu/csmet/</ext-link>.</p></sec></sec><sec id="s2"><title>Results</title><sec id="s2a"><title>The CSMET Model</title><sec id="s2a1"><title>Model for phylogenetically related motif sequences</title><p>To motivate and explain the statistical foundation and biological rationale underlying the CSMET model, we begin with a brief description of a conventional model for phylogenetically related sequences based on the classical molecular substitution process, where functional turnover of motifs is not explicitly modeled. This model will be used as a component in our proposed model.</p><p>Consider a multiple alignment of <italic>M</italic> instances of a motif of length <italic>L</italic>. Let <bold>A</bold> denote an <italic>M</italic> × <italic>L</italic> matrix containing <italic>M</italic> rows <italic>a</italic><sub>1</sub>,…,<italic>a<sub>M</sub></italic>, each representing an instance of this motif, i.e., <italic>a<sub>i</sub></italic> ≡ [<italic>a<sub>i</sub></italic><sub>,1</sub>,…,<italic>a<sub>i,L</sub></italic>], where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e001" xlink:type="simple"/></inline-formula>. Due to the stochastic nature of the sequence composition of TFBSs, a popular representation of a motif pattern is the <italic>position weight matrix</italic> (PWM), <bold>θ</bold>≡(<italic>θ</italic><sub>1</sub>,…,<italic>θ<sub>L</sub></italic>), of which each column vector <italic>θ<sub>l</sub></italic> defines a <italic>multinomial</italic> probability distribution of the nucleotides observed at the <italic>l<sup>th</sup></italic> position of instances of this motif. That is, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e002" xlink:type="simple"/></inline-formula>, where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e003" xlink:type="simple"/></inline-formula> is an indicator function that equals to 1 when <italic>x</italic> = <italic>y</italic> and 0 otherwise. Under a PWM, all sites in the motif are assumed to be mutually independent, thus the probability of a length-<italic>L</italic> instance is simply a product of the probabilities of nucleotides at every site: <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e004" xlink:type="simple"/></inline-formula>. When the motif instances in <bold>A</bold> are from different genomic locations of a single species (i.e., they are phylogenetically <italic>unrelated</italic>), the likelihood of the aligned motifs <bold>A</bold> is simply a product of the likelihoods of every instance <italic>a<sub>i</sub></italic>, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e005" xlink:type="simple"/></inline-formula>, which means all the rows in <bold>A</bold> are independent of each other (although in reality, they might not evolve independently.)</p><p>If <bold>A</bold> contains <italic>M</italic> phylogenetically related motif instances each from a different species, then a straightforward way to model the likelihood of <bold>A</bold> is to assume that the instances therein from different taxa are <italic>shadowed</italic> by a phylogenetic tree that defines a nucleotide-level substitution process from an ancestral sequence <xref ref-type="bibr" rid="pcbi.1000090-Felsenstein2">[29]</xref>,<xref ref-type="bibr" rid="pcbi.1000090-Felsenstein3">[30]</xref> (<xref ref-type="fig" rid="pcbi-1000090-g002">Figure 2A</xref>). Our proposed method uses this model as a building block.</p><p>Formally, a phylogenetic shadowing model <italic>T<sub>m</sub></italic> for a motif is a <italic>tree-likelihood model</italic> specified by a four-tuple <bold>{θ</bold>,<bold>τ</bold>,<bold>β</bold>,<bold>λ}</bold>, where <bold>θ</bold>≡(<italic>θ</italic><sub>1</sub>,…<italic>θ<sub>L</sub></italic>) represents the equilibrium nucleotide distributions at the root of the evolutionary tree of every site within the motif; <bold>τ</bold>≡(<italic>τ</italic><sub>1</sub>,…,<italic>τ<sub>L</sub></italic>) denotes the (usually identical) topologies of the evolutionary trees of every site; <bold>β</bold>≡(<italic>β</italic><sub>1</sub>,…,<italic>β<sub>L</sub></italic>) denotes the sets of branch lengths of the evolutionary trees; and <bold>λ</bold> represents where necessary some additional evolutionary parameters of the motif depending on the specific nucleotide substitution models. Under a phylogenetic shadowing model, the probability distribution of nucleotides in any taxon that corresponds to a leaf conditioning on its predecessor in the tree can be derived based on a continuous-time Markov model of nucleotide substitution along the tree branches <xref ref-type="bibr" rid="pcbi.1000090-Felsenstein3">[30]</xref>. We employ the F84 substitution model parameterized by a given equilibrium distribution, a transition/tranversion ratio <italic>ρ</italic>, and a total substitution rate <italic>μ</italic> that can be estimated from training data <xref ref-type="bibr" rid="pcbi.1000090-Felsenstein2">[29]</xref>. Detailed derivation and explicit expressions are provided in <xref ref-type="sec" rid="s4">Materials and Methods</xref>.</p><p>Typically, we can use the PWM of the motif as the equilibrium distribution of the motif phylogeny. For simplicity, one can also assume that all sites within the motif share the same topology <italic>τ</italic> and the same branch lengths <italic>β</italic>. This means that the evolutionary processes underlying each site within the motif are homogeneous. Similarly, we can define <italic>Tb</italic> ≡ {<italic>θ<sub>b</sub>, τ<sub>b</sub>, β<sub>b</sub>, λ<sub>b</sub></italic>} for the background. Assuming that sites within the motif evolve independently, the likelihood of <italic>M</italic> aligned <italic>L</italic>-mers can be expressed as:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e006" xlink:type="simple"/><label>(1)</label></disp-formula>where <italic>A<sub>l</sub></italic> denotes the <italic>l<sup>th</sup></italic> column in <bold>A</bold>, and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e007" xlink:type="simple"/></inline-formula> is the marginal likelihood of the leaves under an motif-site-specific evolutionary tree <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e008" xlink:type="simple"/></inline-formula> for nucleotide substitution, which can be computed using Felsenstein's pruning algorithm <xref ref-type="bibr" rid="pcbi.1000090-Felsenstein3">[30]</xref>, as detailed in <xref ref-type="sec" rid="s4">Materials and Methods</xref>.</p><p>To model a multiple alignment of regulatory regions that is <italic>N</italic> base-pairs long and contains motifs at unknown positions, we can assume that every <italic>L</italic>-mer block in the alignment can correspond to either a motif sequence, or the background, specified by a hidden <italic>functional state Z<sub>t</sub></italic>, where <italic>t</italic> denotes the position of the left-most column of the block in the alignment. (For simplicity, we consider only one motif type here, but the formulation readily generalizes to multiple motif types.) The state sequence <bold>Z</bold> ≡ <italic>Z</italic><sub>1:<italic>N</italic></sub> can be thought of as a functional annotation sequence of an ancestral regulatory region of length <italic>N</italic>. In the EMnEM model <xref ref-type="bibr" rid="pcbi.1000090-Moses2">[20]</xref>, the <italic>Z<sub>t</sub></italic>'s are assumed to be independently sampled from a Binomial distribution of motif and background states, similar to the classic mixture models of motif underlying MEME (<xref ref-type="fig" rid="pcbi-1000090-g002">Figure 2A</xref>). In a PhyloHMM originally proposed in <xref ref-type="bibr" rid="pcbi.1000090-Siepel1">[3]</xref> for comparative gene finding, which can be easily extended for motif search, <italic>Z</italic><sub>1:<italic>N</italic></sub> can follow a hidden Markov model that captures the transition probabilities between background and motifs.</p></sec><sec id="s2a2"><title>Model for motif turnover</title><p>A caveat of the phylogenetic shadowing model described above is that, at every location <italic>t</italic>, the functionality indicator <italic>Z<sub>t</sub></italic> must apply to all the taxa (i.e., rows) in the alignment (as illustrated in <xref ref-type="fig" rid="pcbi-1000090-g002">Figure 2A</xref>), meaning that the aligned substrings from all taxa at this position are derived from the same evolutionary tree (either the motif or the background tree, depending on the value of <italic>Z<sub>t</sub></italic>; when <italic>Z<sub>t</sub></italic> is hidden, this results in a mixture of two complete trees). This is a strong orthologous assumption which insists that every row in the alignment block must have evolved from the same most recent common ancestor (MRCA) according to the same molecular evolution model. This assumption might not be valid for every region in the alignment due to abrupt functional turnover such as whole motif insertion/deletion, or due to imperfect alignment that fails to identify the true sequence orthology.</p><p>We assume that every sequence segment in an alignment block, generically referred as <bold>A</bold><italic><sub>t</sub></italic> where <italic>t</italic> denotes the left-most position of the alignment, has its own functionality indicator <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e009" xlink:type="simple"/></inline-formula>. Generalizing the molecular evolution model for base substitution, we posit that the functional annotation vector <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e010" xlink:type="simple"/></inline-formula> of a block of aligned segments are themselves governed by a <italic>coarser-grained evolutionary tree</italic> that models the evolution of the functionalities of the attendant segments in different taxa (<xref ref-type="fig" rid="pcbi-1000090-g002">Figure 2B</xref>). We refer to this evolutionary tree as a (functional) <italic>annotation tree</italic> (or, interchangeably, a functional phylogeny), denoted by <italic>T<sub>f</sub></italic> ≡ {<italic>α</italic>, <italic>τ<sub>f</sub></italic>, <italic>b<sub>f</sub>, λ<sub>f</sub></italic>}. In such a tree model, each leaf represents a random variable <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e011" xlink:type="simple"/></inline-formula> whose value reveals the functional status (i.e., being a motif, background, or more detailed function information such as motif types, etc.) of the segment from taxon <italic>i</italic>, and the root is characterized by a hypothetical ancestral functionality indicator <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e012" xlink:type="simple"/></inline-formula> and an equilibrium distribution <italic>α</italic>. Along the branches of this tree, the functional states evolve according to a <italic>functionality substitution</italic> model, in much the same way the nucleotides do under a <italic>molecular substitution</italic> model, except that now the model parameters <italic>T<sub>f</sub></italic> are fitted differently (we will return to this point in the <xref ref-type="sec" rid="s4">Materials and Methods</xref> section) and the evolutionary dynamics can also have richer structures. For example, in the model proposed by <xref ref-type="bibr" rid="pcbi.1000090-Engelhardt1">[25]</xref> for protein function evolution, the evolutionary dynamics were captured by a logistic regression rather than a constant-rate continuous-time Markov process used in standard molecular substitution models. For simplicity,here we adopt a simple JC69 model for functionality substitution, which is denoted as <italic>P<sub>F</sub></italic>(<italic>Z<sub>t</sub></italic>|<italic>T<sub>f</sub></italic>) (see Equation 4 in <xref ref-type="sec" rid="s4">Materials and Methods</xref>), and defer the exploration of richer models to future research. In summary, the functional phylogeny <italic>T<sub>f</sub></italic> models the quantum changes of functional elements (rather than the fine-grained changes at the nucleotide level) during evolution in terms of whether an entire functional element is preserved, lost, or emerged, during the course of speciation.</p></sec><sec id="s2a3"><title>Conditional shadowing under motif turnover</title><p>To capture the effect of motif turnover, we assume that <italic>conditioning</italic> on the functional states of all rows (i.e., species), which are represented as a random column vector <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e013" xlink:type="simple"/></inline-formula> distributed according to the functional phylogeny specified by <italic>T<sub>f</sub></italic>, the sequences in alignment block <italic>t</italic> admit either a <italic>marginal</italic> motif phylogeny or a <italic>marginal</italic> background phylogeny. As shown in <xref ref-type="fig" rid="pcbi-1000090-g002">Figure 2B</xref>, typically, for a given block, only a subset of the rows <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e014" xlink:type="simple"/></inline-formula> correspond to conserved instances of a motif (e.g., rows 1, 2, and 3), and therefore their joint probability is defined by a <italic>marginal phylogeny</italic> <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e015" xlink:type="simple"/></inline-formula> of the full motif phylogeny (i.e., the subtree highlighted by solid red lines in <xref ref-type="fig" rid="pcbi-1000090-g002">Figure 2B</xref>). The remaining part of the motif phylogeny (represented by the subtree in dotted red lines in <xref ref-type="fig" rid="pcbi-1000090-g002">Figure 2B</xref>), which corresponds to taxa where the corresponding motifs had turned-over to background sequences, needs to be marginalized out. We can efficiently compute the likelihood of the preserved motif instances <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e016" xlink:type="simple"/></inline-formula> under the marginal motif phylogeny <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e017" xlink:type="simple"/></inline-formula>, expressed as <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e018" xlink:type="simple"/></inline-formula> using the standard pruning algorithm. Similarly, the subset of rows <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e019" xlink:type="simple"/></inline-formula> corresponding to the background or merely gaps admit a <italic>marginal background phylogeny</italic> <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e020" xlink:type="simple"/></inline-formula> (e.g., the blue tree with leaves only correspond to rows 4 and 5 in <xref ref-type="fig" rid="pcbi-1000090-g002">Figure 2B</xref>). Putting these two parts together, now for every position <italic>t</italic> in the input alignment, we have the following joint probability (i.e., the complete likelihood) of the observed alignment block <bold>A</bold><italic><sub>t</sub></italic>, the vector of instantiated extant functional states <bold>z</bold><italic><sub>t</sub></italic>, and an instantiated ancestral functional state <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e021" xlink:type="simple"/></inline-formula> under a conditional shadowing model with multiple evolutionary trees (aka, CSMET):<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e022" xlink:type="simple"/><label>(2)</label></disp-formula>In practice, the leaf functional states <bold>z</bold><italic><sub>t</sub></italic> of an alignment block starting at position <italic>t</italic>, and the ancestral functional state <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e023" xlink:type="simple"/></inline-formula> are not observed. Thus the likelihood score of <bold>A</bold><italic><sub>t</sub></italic> follows a complex mixture of <italic>marginal</italic> phylogenies defined by all possible joint configurations of functional states <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e024" xlink:type="simple"/></inline-formula> and the ancestral state <italic>z<sup>r</sup></italic>, rather than a simple motif/background mixture as in extant models. The typical tasks in motif detection involves either computing the marginal conditional likelihood <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e025" xlink:type="simple"/></inline-formula> for all possible states of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e026" xlink:type="simple"/></inline-formula>, which will be used as the emission probability in an HMM of the ancestral functional states over the entire alignment (to be detailed in the next section); or the marginal posterior <italic>P</italic>(<bold>z</bold><italic><sub>t</sub></italic>|<bold>A</bold><sub>1:<italic>T</italic></sub>), which will be used to extract the maximum <italic>a posteriori</italic> (MAP) motif annotation of the alignment. Both tasks involve a marginalization step that sums over all joint configurations of the internal tree nodes, <italic>z<sub>r</sub></italic>'s, and <bold>z</bold><italic><sub>t</sub></italic>'s. This leads to an inference problem in a state space defined by the product of multiple trees and therefore can be computationally intensive. Since in practice it is unusual to encounter more than 20 or so taxa in the comparative genomic setting, inference is still feasible. In this case, one can apply a <italic>coupled-pruning algorithm</italic> described in the <xref ref-type="sec" rid="s4">Materials and Methods</xref> or a standard junction tree algorithm <xref ref-type="bibr" rid="pcbi.1000090-Cowell1">[31]</xref> for exact inference.</p><p>For an alignment of a large number of species and/or for a problem which involves searching for a large number of motifs simultaneously, marginalization of the product space of trees can be prohibitive. In these circumstances, we can apply an approximate inference method such as the generalized mean field algorithm <xref ref-type="bibr" rid="pcbi.1000090-Xing1">[32]</xref>, which decomposes the coupled trees in CSMET into disjoint trees and applies iterative message-passing across these trees to obtain an approximate posterior of <bold>z</bold><italic><sub>t</sub></italic> or the conditional likelihood of <bold>A</bold><italic><sub>t</sub></italic>. Alternatively we can replace some or all of the full phylogenetic trees for motif, background and functional evolution by star-topology phylogenies as in PhyloGibbs <xref ref-type="bibr" rid="pcbi.1000090-Siddharthan1">[9]</xref>. For simplicity of the exposition, we omit details of these generalizations.</p></sec><sec id="s2a4"><title>Tree- and rate-transition along alignment</title><p>Different sites in the genome are subject to different evolutionary constraints and therefore follow phylogenetic trees with different equilibriums, topologies and rates. The conditional phylogenetic shadowing model described above couples multiple site-specific trees of all sites <italic>within</italic> a moving window of alignment block via a functional phylogeny; but it does not explicitly model transitions between possibly different evolutionary processes as the window scans over different functional entities along the aligned sequences, for example, transitions between motifs and different background regions, and among different motifs.</p><p>We introduce a hidden Markov model to model the transitions between functional annotations along the alignment. In principle, this HMM can employ highly structured transition models such as the global HMMs used in LOGOS <xref ref-type="bibr" rid="pcbi.1000090-Xing2">[33]</xref> or CISTER <xref ref-type="bibr" rid="pcbi.1000090-Frith1">[34]</xref>, which intend to capture sophisticated “motif grammars” underlying higher eukaryotic CRMs. In this paper, we adopt a simplistic 3-state HMM that models the length of the spacer between motifs as a geometric distribution, and allows the motifs to be on either strand of the DNA. We define the HMM over the sequence of ancestral functional states <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e027" xlink:type="simple"/></inline-formula>, modeling the spatial transitions of functionalities along a hypothetical ancestral regulatory sequence underlying the aligned sequences from the study species. To model TFBS on either DNA strand with opposite orientations, two functional states are needed for each type of motifs, which determine the appropriate orientation for the PWM employed by the motif tree <italic>T<sub>m</sub></italic> for defining the likelihood of a selected DNA substring; but these two functional states correspond to a degenerated motif state (i.e., <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e028" xlink:type="simple"/></inline-formula>) at the root of the functional tree <italic>T<sub>f</sub></italic> in CSMET, and follow the same turnover process. Details of such an HMM is given in <xref ref-type="sec" rid="s4">Materials and Methods</xref>.</p><p>Unlike the standard HMM for mono-genomic motif detection where the emission probability uses a simple conditional multinomial distribution of a single nucleotide, or a PhyloHMM for comparative-genomic motif detection ignoring motif turnover where the emission probability is defined by a conditional likelihood of a column of aligned nucleotides under a single phylogeny, to accommodate functional turnover of segments in certain species in the alignment, we define the emission model to be the CSMET conditional likelihood of an alignment block, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e029" xlink:type="simple"/></inline-formula>, and thereby enable conditional shadowing over the taxa at each site. A technical issue arising from this construction is that unlike the PhyloHMM, which is still a standard 1st-order HMM, in our case we have a higher-order HMM due to the contex-dependent coupling of all the sites within a motif by the functional phylogeny <italic>T<sub>f</sub></italic>, which models the whole sequence segment within a window of length <italic>L</italic> as a unit. In the next section, we outline statistical inference strategies that address this technical issue.</p></sec></sec><sec id="s2b"><title>Strategy</title><sec id="s2b1"><title>Posterior inference</title><p>The incorporation of the functional phylogeny <italic>T<sub>f</sub></italic> to explicitly model functional turnover of entire segments (rather than individual sites) of DNA sequences in different taxa in a multiple alignment introduces not only higher-order Markov dependencies among sites, but also context-dependent dependencies among taxa. Thus CSMET is essentially a probabilistic model with <italic>context-specific independencies</italic>, which is well-known to be intractable in general <xref ref-type="bibr" rid="pcbi.1000090-Boutilier1">[35]</xref>. <xref ref-type="fig" rid="pcbi-1000090-g003">Figure 3A and 3B</xref> show an example of the context-specific relationships among variables due to two different possible value-configurations of the hidden variables corresponding to ancestral and taxa-specific functional annotations (of a small chunk of the alignment). Computing the likelihood of the entire alignment requires a summation of all joint configurations of all of these hidden variables, for which no efficient exact algorithm resembling the dynamic programming algorithms applied to HMMs is available.</p><fig id="pcbi-1000090-g003" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1000090.g003</object-id><label>Figure 3</label><caption><title>Context-specific relationships among variables due to two possible value configurations of hidden variables shown in (A) and (B).</title><p>Note that when the ancestral state is a motif, the segment corresponding to the TBFS evolves as a unit (as shown by the arrow from an extant functional state pointing to a multi-column segment), either retaining its functionality as a motif, or turning-over to a background segment, as illustrated in (A). When the ancestral state is a background, then every position can evolve independently as long as it is still in the background (as shown by the arrow from a functional state pointing to a single column). But when a motif emerges out of the background, as shown in (B), the segments corresponding to the TFBS start to evolve as a unit, causing even the aligned nucleotide positions to evolve under different positional constraints. (C) Outlines the idea of a block approximation of the CSMET emission probability.</p></caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000090.g003" xlink:type="simple"/></fig><p>While it is possible to implement a Monte Carlo algorithm that performs sampling over the functional annotation space of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e030" xlink:type="simple"/></inline-formula> conditioning on the observed multiple alignment, we propose an approximate algorithm for posterior inference. As illustrated in <xref ref-type="fig" rid="pcbi-1000090-g003">Figure 3C</xref>, we can treat an <italic>N</italic>-column alignment as a sequence of (<italic>N</italic>−<italic>L</italic>+1) consecutive <italic>L</italic>-column aligned blocks. We assume each such block <bold>A</bold><italic><sub>t</sub></italic> is either generated from a CSMET emission model conditioning on the ancestral function of this segment being a background, i.e., <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e031" xlink:type="simple"/></inline-formula>, or it can be generated from a CSMET conditioning on the ancestral function being a motif, say, of type <italic>k</italic>, expressed as <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e032" xlink:type="simple"/></inline-formula>. We can pre-compute the emission probabilities for all the aligned blocks, plug them back into an equivalent HMM of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e033" xlink:type="simple"/></inline-formula>'s on blocks rather than on columns, and then compute the posterior probabilities or Viterbi-sequence of the labels of each block using the standard dynamic programming algorithms (e.g., forward-backward) for HMMs (see <xref ref-type="sec" rid="s4">Materials and Methods</xref> section for details). The approximation introduced here lies in the approximate computing of the emission probabilities for the blocks, specifically at the boundary between motifs and background. For these blocks the likelihood of the aligned sequences should be defined by two different emissions, one on the background sub-block and the other on the motif sub-block, whereas our approximation employs only a single emission—either an entirely background-derived CSMET <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e034" xlink:type="simple"/></inline-formula> or an entirely motif-derived CSMET <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e035" xlink:type="simple"/></inline-formula>. But since our approximation results in a poorer fit only for the boundary regions, we expect that the overall posterior indication of the motifs, which is primarily driven by the emission probabilities of the motif blocks, will only suffer moderate weakening of contrast at the boundaries. We refer to this approximation method as <italic>block-approximation</italic> (BA). Another more subtle approximation due to BA is the ignoring of different turnover behaviors within a block <bold>A</bold><italic><sub>t</sub></italic> conditioning on the ancestral function of this segment( being a motif or a background), as exemplified in <xref ref-type="fig" rid="pcbi-1000090-g003">Figure 3B</xref>. Unlike a motif block derived from an ancestral motif, a segment of ancestral background sites do not evolve as a whole block, thus a block <bold>A</bold><italic><sub>t</sub></italic> entirely originated from a ancestral background can contain rows (descendents) that are either entirely non-motif, or partially non-motif and partially motif (i.e., starting from an arbitrary position <italic>t′</italic> in window <italic>t</italic>:<italic>t</italic>+<italic>L</italic>, the segment <italic>t′</italic>: <italic>t′</italic>+<italic>L</italic>, part of which extends out of <bold>A</bold><italic><sub>t</sub></italic>, in an arbitrary taxon can evolve into a motif), whereas a block <bold>A</bold><italic><sub>t</sub></italic> entirely originated from a motif can only contain either fully preserved motif rows or turned-over non-motif rows. A detailed discussion of this subtlety is beyond the scope of this paper, and BA simply treats each entire row in <bold>A</bold><italic><sub>t</sub></italic> as a homogeneous functional evolutionary unit. The computational time for BA is linear in the length of the input, with a multiplicative factor determined by the length of the motif and the number of species concerned in the alignment. In case of multiple motifs, the emission probabilities of the blocks should be computed under the unique CSMET of each motif. Since motifs can have different lengths, bookkeeping of all the emissions can be slightly more complicated due to the need to handle blocks of different lengths. But the computational cost is only increased by the order of the number of the motifs in question. For simplicity, we defer details of this generalization to a later update of the CSMET.</p><p>With the BA strategy, we arrive at an approximation to the posterior distribution of motif annotation at every position given the entire alignment, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e036" xlink:type="simple"/></inline-formula>, and the posterior of the sequence of ancestral functions, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e037" xlink:type="simple"/></inline-formula>. For an alignment block of which only a few taxa correspond to motifs and others are merely background, under the CSMET model, the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e038" xlink:type="simple"/></inline-formula> of this block can be either motif or background. In the first case, it means that absence of motifs in some taxa is interpreted as the result of loss of ancestral motifs, whereas in the second case, the presence of motifs in some taxa is interpreted as the result of emergence of nascent motifs out of the background. As far as we are aware of, CSMET is the only motif-finding algorithm that rigorously offers a closed-form deterministic solution to the posterior probability distribution of motif annotations both in the alignment and in the ancestral sequence over the entire space of binding site configurations. PhyloGibbs <xref ref-type="bibr" rid="pcbi.1000090-Siddharthan1">[9]</xref> offers a sample-based solution to the posterior of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e039" xlink:type="simple"/></inline-formula> given <bold>A</bold><sub>1:<italic>N</italic></sub>, but as mentioned earlier, it is not based on an explicit model of binding site turnover, and thus does not have a closed-form expression that can motivate efficient deterministic approximation.</p></sec><sec id="s2b2"><title>Maximum likelihood training</title><p>The CSMET can be trained on annotated CRM alignments. We need to learn the nucleotide phylogenetic trees for motifs and backgrounds, and the phylogenetic tree that describes the evolution of functional annotation. We use the F84 model for nucleotide substitution on the motif and background trees; for evolution of functional annotation, we use the simpler JC69 model. As detailed in <xref ref-type="sec" rid="s4">Materials and Methods</xref> and <xref ref-type="supplementary-material" rid="pcbi.1000090.s001">Text S1</xref>, for a given tree topology, for the JC69 model all we need to estimate is the branch length on the tree, which relates to total substitution probability. For the F84 model, besides the tree topology, we need to estimate the stationary distribution, which we set to be the PWM for motif phylogenies or the background nucleotide frequencies for background phylogeny; and also two additional evolutionary parameters: the overall substitution rate per site <italic>μ</italic> and the transition/transversion ratio <italic>ρ</italic>.</p><p>Given a multiple alignment, the ground truth of functional annotation, the PWMs for motifs, and nucleotide frequency for the background, we use the following strategy for estimating the trees and the evolutionary parameters. Detailed derivation and explicit expressions are provided in <xref ref-type="sec" rid="s4">Materials and Methods</xref>.</p><list list-type="bullet"><list-item><p>Find a tree topology <italic>τ</italic> and the branch lengths <italic>β</italic> by running fastDNAml <xref ref-type="bibr" rid="pcbi.1000090-Olsen1">[36]</xref> over the entire alignment.</p></list-item><list-item><p>Find a scaling factor <italic>r<sub>f</sub></italic> over branch lengths <italic>β<sub>f</sub></italic> of the functional tree <italic>T<sub>f</sub></italic>, by maximizing the likelihood of aligned functional annotations under <italic>T<sub>f</sub></italic> via a line-search in parameter space.</p></list-item><list-item><p>Find a scaling factor <italic>r<sub>m</sub></italic> over branch lengths <italic>β<sub>m</sub></italic> of the motif tree <italic>T<sub>m</sub></italic>, and the Felsenstein rate <italic>μ<sub>m</sub></italic>, by maximizing the likelihood of aligned motif sequence under <italic>Tm</italic> with the F84 model.</p></list-item><list-item><p>Find a tree topology <italic>τ<sub>b</sub></italic> and branch lengths <italic>b</italic><sub>0</sub> for background tree <italic>T<sub>b</sub></italic> by running fastDNAml directly over only the background sequences. The Felsenstein rate <italic>μ<sub>b</sub></italic> is then estimated by maximizing the likelihood under <italic>T<sub>b</sub></italic> with a simple line-search.</p></list-item></list><p>To compute the Felsenstein substitution rate <italic>μ</italic>, we use a fixed transition-transversion ratio of 2. If the stationary nucleotide distribution defined by the motif PWM is incompatible with this value of the transition-transversion ratio, we set it to the smallest value that is compatible with the stationary distribution as in <xref ref-type="bibr" rid="pcbi.1000090-McAuliffe1">[5]</xref>.</p></sec></sec><sec id="s2c"><title>Performance on Synthetic Data</title><p>At present, biologically validated orthologous motifs and CRMs across multiple taxa are extremely rare in the literature. In most cases, motifs and CRMs are only known in some well-studied <italic>reference taxa</italic> such as the <italic>Drosophila melanogaster</italic>; and their orthologs in other species are deduced from multiple alignments of the corresponding regulatory sequences from these species according to the positions and PWMs of the “reference motifs” in the reference taxon. This is a process that demands substantial manual curation and biological expertise; rarely are the outcomes from such analysis validated <italic>in vivo</italic> (but see <xref ref-type="bibr" rid="pcbi.1000090-Ludwig1">[8]</xref> for a few such validations in some selected <italic>Drosophila</italic> species where the transgenic platforms have been successfully developed). At best, these real annotations would give us a limited number of true positives across taxa, but they are not suitable for a systematic performance evaluation based on precision and recall over true motif instances. Thus we first compare CSMET with a carefully chosen collection of competing methods on simulated CRM sequences, where the motif profiles across all taxa are completely known.</p><p>We choose to compare CSMET with 3 representative algorithms for comparative genomic motif search, PhyloGibbs, EMnEM, PhyloHMM; and the program Stubb, which is specialized for motif search in eukaryotic CRMs, and in our paper, set to operate in mono-genomic mode. The rationale for choosing these 4 benchmarks is detailed in the <xref ref-type="sec" rid="s4">Material and Methods</xref>.</p><sec id="s2c1"><title>Multi-specific CRM simulator</title><p>We developed a simulator of multi-specific CRMs with flexible TFBS turnover dynamics across taxa and realistic TFBS arrangement within CRM. The overall scheme is illustrated in <xref ref-type="fig" rid="pcbi-1000090-g004">Figure 4</xref>. Specifically, the input of the simulator includes: 1) topologies of the phylogenetic trees for nucleotide (e.g., in motif sites and background) and functionality substitutions; 2) prior distributions of the stationary distribution of states (i.e., nucleotide or functionalities) at the roots of the trees; 3) prior distributions of the branch lengths of the trees and the substitution rates, and other evolutionary parameters where necessary (e.g., the Felsenstein rate <italic>μ</italic> and <italic>ρ</italic> in F84 model); 4) a global HMM encoding the motif grammar in the CRMs. As detailed in the <xref ref-type="sec" rid="s4">Material and Methods</xref>, during simulation, all building blocks of a CRM, such as the motif instances, background sequences, functionality states (that determines motif turnover) in different taxa, and positions of the motifs in the CRM are sampled separately as illustrated in <xref ref-type="fig" rid="pcbi-1000090-g004">Figure 4</xref>, and put together to synthesize an artificial CRM. This simulator can be used to simulate realistic multi-specific CRMs resulting from various nontrivial evolutionary dynamics. It is useful in its own right for consistence/robustness analysis of motif evolution models and performance evaluation of comparative genomic motif-finding programs.</p><fig id="pcbi-1000090-g004" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1000090.g004</object-id><label>Figure 4</label><caption><title>An illustration of the generative scheme of a Multi-specific CRM simulator.</title></caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000090.g004" xlink:type="simple"/></fig><p>Below, we report results of four experiments based on simulated datasets. Each experiment was based upon varying one parameter of the model, keeping all the others fixed, in order to analyze robustness of CSMET and various other methods under different conditions. Every simulated CRM alignment contained 10 taxa, and for each experiment we simulated 50 datasets. The simulated data is available at the CSMET website to allow external comparisons. Performance of all the tested programs were based on the precision, recall and their F1 score (i.e., the harmonic mean of precision and recall) <xref ref-type="bibr" rid="pcbi.1000090-Tompa1">[37]</xref>.</p></sec><sec id="s2c2"><title>Performance under varying degrees of motif turnover</title><p>To examine the effect of motif turnover (i.e., functional conservation) in aligned regions across taxa on the motif-detection performance, we simulated CRM alignments with differing magnitudes of the evolutionary rate along the functional phylogeny. Since known motifs in the Drosophila species we are working with usually have around 75% conservation, we chose our evolutionary rates so as to achieve conservation percentages between 64%–75% (or equivalently, turnover percentages between 25%–36%) at the species-specific motif-instance level. (See <xref ref-type="supplementary-material" rid="pcbi.1000090.s001">Text S1</xref> for how this is achieved.)</p><p>We find that even with increasing rates of functional turnover, the performance of CSMET and Phylogibbs remain largely stable, with CSMET consistently dominating PhyloGibbs in F1 score with a modest margin (<xref ref-type="fig" rid="pcbi-1000090-g005">Figure 5</xref>). The margin is statistically significant with <italic>p</italic> = 2.48×10<sup>−7</sup> under a paired <italic>t</italic>-test. EMnEM has a high recall score, but overall its F1-scores are well below CSMET and PhyloGibbs, also it appears to be affected more by the increased turnover rates. PhyloHMM shows an interesting trend, it performs better than its non-phylogenetic cousin Stubb on data with low turnover rates, but its performance worsens when compared to Stubb on data with increasing turnover rate. This shows that a naive application of phylogenetic shadowing in multi-species alignment with high functional divergence can actually result in degraded performance compared even to just single species analysis.</p><fig id="pcbi-1000090-g005" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1000090.g005</object-id><label>Figure 5</label><caption><title>Performance under varying degrees of functional conservation.</title></caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000090.g005" xlink:type="simple"/></fig></sec><sec id="s2c3"><title>Performance under varying degrees of motif/background contrast</title><p>The difference in conservation between the motif and background sequences will have an impact on the performance of the model. However, this experiment can be performed in two different ways: changing the degree of similarity between motif and background stationary distributions; and changing the evolutionary rates of one or the other. We choose the second method and conduct the simulation as follows: we attribute the motif phylogeny with a low entropy stationary distribution resembling a PWM, and with a fixed evolutionary rate; and we let the background to have a stationary distribution similar to but with higher entropy than that of the motif, and have a variable evolutionary rate. The evolutionary rate in the background tree is changed gradually from low values to high values, by varying the scaling factor applied to the background tree from 1 to 8. This is to check how well the CSMET model may detect motifs emerging out of the background with differing degrees of sequence-level conservation with respect to the background caused by their relative evolutionary rates. The corresponding performances are shown in <xref ref-type="fig" rid="pcbi-1000090-g006">Figure 6</xref>.</p><fig id="pcbi-1000090-g006" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1000090.g006</object-id><label>Figure 6</label><caption><title>Performance under varying degrees of motif/background contrast.</title></caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000090.g006" xlink:type="simple"/></fig><p>We found that even under low variation between the motif and background, i.e., both following an evolutionary tree with similar stationary distribution, and the same branch lengths and scaling parameters, CSMET outperforms all the other methods. CSMET steadily improves in performance upto the scaling factor of 4, after which its performance roughly plateaus. PhyloGibbs behaviors similarly, but overall with lower F1 scores that is statistically significant (<italic>p</italic> = 1.41×10<sup>−14</sup>). EMnEM, on the other hand outperforms all other methods for scaling factors of 6 or more; meaning that when motifs are extremely highly conserved compared to the background, the advantage of modeling their turnover as in CSMET and PhyloGibbs over using a basic phylogenetic model diminishes, which is well expected. Since in real CRMs, the evolutionary rates of of the non-functional regions with respect to that of the functional regions (e.g., coding regions, TFBSs) in eukaryotes have been shown to be lie between 1.2 and 2.5 <xref ref-type="bibr" rid="pcbi.1000090-Boffelli1">[1]</xref>, we can claim that CSMET outperforms all other software in the region of biologically relevant parameter settings.</p></sec></sec><sec id="s2d"><title>Robustness on Data Violating CSMET Model Assumptions</title><sec id="s2d1"><title>Effect of non-uniform functional evolution rates</title><p>We analyzed the robustness of CSMET (compared to other algorithms) in the face of a breakdown of a key CSMET model assumption—that the motif turnover rates are allowed to vary along the simulated CRM sequences instead of staying constant, which is possible in real regulatory sequences. The CSMET model does not explicitly address this dynamics and simply assumes an invariant turnover rate throughout the sequence. We simulated a dataset where the motif turnover rates are chosen uniformly from 4 pre-specified categories, corresponding to branch scaling factors of 1.00, 1.50, 2,00 and 2.50, respectively, over the baseline phylogeny. The corresponding motif turnover rates were 20%, 25%, 30% and 32%, respectively. As shown in <xref ref-type="fig" rid="pcbi-1000090-g007">Figure 7</xref>, we found that while performance of CSMET on such data declines compared to its performance on data simulated with a invariant turnover rate, it still performs no worse than any of the other software even though a primary assumption it adopts (that of a constant functional turnover rate) is violated.</p><fig id="pcbi-1000090-g007" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1000090.g007</object-id><label>Figure 7</label><caption><title>Effect of varying motif turnover rates across sequence.</title><p>In the pair of barplots of each method, the left bar corresponds to performance with varying turnover rates ranging from 20% to 32%; the right bar corresponds to performance under a fixed turnover rate at 25%.</p></caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000090.g007" xlink:type="simple"/></fig></sec><sec id="s2d2"><title>Effect of different generative model</title><p>To examine the robustness of CSMET under the violation of many of its model assumptions all at the same time, we then performed an experiment using an external simulator PSPE <xref ref-type="bibr" rid="pcbi.1000090-Huang1">[22]</xref>, which is based on an entirely different generative model with respect to CSMET (in terms of nucleotide substitution, motif placement, motif turnover, etc.) to synthesize multi-specific CRM sequences. However, at times PSPE generates motifs in some species with some lateral displacements, which appears to be an empirical operation not universal to evolutionary mechanisms that lead to functional turnover in <italic>aligned</italic> motifs (e.g., see <xref ref-type="bibr" rid="pcbi.1000090-Moses1">[12]</xref>), but similar to an assumption underlying PhyloGibbs. To obtain a fair comparison, we suppress the lateral displacements by a post-processing of the sequences simulated by PSPE. In the post-processing step, we remove any motif instances that are laterally displaced in the multiple sequence alignment that is generated. This leaves us with a multiple sequence alignment with all the motif instances perfectly aligned.</p><p>We used PSPE driven by five different scaled versions of the phylogenetic tree on the 11 <italic>Drosophila</italic> species to simulate different degrees of motif evolution, and test CSMET and PhyloGibbs on simulations under each scaled tree. For sequence evolution, an HKY nucleotide substitution model with parameter set to 0.05 was used; for the gap distribution, a negative binomial distribution with parameters {1, 0.5} was used (note that none of these assumptions are used in CSMET). The motif sequence was generated by PSPE from the default constraints provided. We generated sequences of length 1000 for training, each with about 7–10 motifs; and we test on sequences of length 500 containing 4–5 motifs. For each tested simulation condition (i.e., tree scaling factor), 50 samples were generated, and the performance of CSMET and PhyloGibbs are shown in <xref ref-type="fig" rid="pcbi-1000090-g008">Figure 8</xref>. We can see that the F1 scores of CSMET are quite stable under different tested conditions and with low variance, and in all conditions CSMET outperforms Phylogibbs on F1 scores, and the margins are statistically significant (<italic>p</italic> = 1.875×10<sup>−13</sup>). This suggests that CSMET is reasonably robust with respect to violations of its model assumptions.</p><fig id="pcbi-1000090-g008" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1000090.g008</object-id><label>Figure 8</label><caption><title>Performance on modified PSPE data.</title><p>The label on the <italic>x</italic>-axis denotes the scaling factor used by the PSPE tree with respect to a reference <italic>Drosophila</italic> phylogeny.</p></caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000090.g008" xlink:type="simple"/></fig></sec></sec><sec id="s2e"><title>Performance on Aligned <italic>Drosophila</italic> CRMs</title><p>We applied CSMET and competing methods to a multi-specific dataset of <italic>Drosophila</italic> early developmental CRMs and motifs compiled from the literature <xref ref-type="bibr" rid="pcbi.1000090-Papatsenko1">[38]</xref>. However, in this situation, we score accuracy only on the motifs annotated in <italic>Drosophila melanogaster</italic> (rather than in all taxa), because they are the only available gold-standard. Upon concluding this section, we also report some interesting findings by CSMET of putative motifs, some of which only exist in other taxa and do not have known counterparts in <italic>melanogaster</italic>.</p><sec id="s2e1"><title>Real CRMs from 11 <italic>Drosophila</italic> taxa</title><p>To evaluate CSMET on real sequence data, we use a pre-aligned benchmark data set containing multiple alignments of orthologous CRMs from 11 related <italic>Drosophila</italic> species, whose divergence time with respect to the most recent common ancestor is roughly 50 million years. The species included are: <italic>melanogaster</italic>, <italic>simulans</italic>, <italic>sechellia</italic>, <italic>yakuba</italic>, <italic>erecta</italic>, <italic>ananassae</italic>, <italic>persimilis</italic>, <italic>pseudoobscura</italic>, <italic>mojavensis</italic>, <italic>virilis</italic>, and <italic>grimshawi</italic>. Our data set contains 14 different multiple-alignments ranging from 3640-bp to 5316 bp long; each alignment corresponds to a DNA segment containing a CRM (<xref ref-type="table" rid="pcbi-1000090-t001">Table 1</xref>) that has been annotated in <italic>Drosophila melanogaster</italic> <xref ref-type="bibr" rid="pcbi.1000090-Papatsenko1">[38]</xref>,<xref ref-type="bibr" rid="pcbi.1000090-Bergman1">[39]</xref> plus 1000bp flanking regions on both ends, and its putative orthologs in the other 10 taxa identified using the precompiled <italic>Drosophila</italic> genome data from the UCSC Genome browser website <xref ref-type="bibr" rid="pcbi.1000090-FlybaseConsortium1">[40]</xref>. Overall, our data set contains 250 instances of motifs in a total of 14 CRMs. To our knowledge, it represents one of the most complete multi-genomic collection of <italic>Drosophila</italic> CRM/motifs. This dataset, along with a full graphical representation of the CRMs and TFBSs, are available at the CSMET website.</p><table-wrap id="pcbi-1000090-t001" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1000090.t001</object-id><label>Table 1</label><caption><title>A short summary of the nature of the annotated CRMs.</title></caption><!--===== Grouping alternate versions of objects =====--><alternatives><graphic id="pcbi-1000090-t001-1" mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000090.t001" xlink:type="simple"/><table><colgroup span="1"><col align="left" span="1"/><col align="center" span="1"/><col align="center" span="1"/></colgroup><thead><tr><td align="left" colspan="1" rowspan="1">Name of CRM</td><td align="left" colspan="1" rowspan="1">Length</td><td align="left" colspan="1" rowspan="1">Motif types</td></tr></thead><tbody><tr><td align="left" colspan="1" rowspan="1">Abdominal A</td><td align="left" colspan="1" rowspan="1">1745</td><td align="left" colspan="1" rowspan="1">Hunchback, Kruppel</td></tr><tr><td align="left" colspan="1" rowspan="1">Buttonhead</td><td align="left" colspan="1" rowspan="1">1429</td><td align="left" colspan="1" rowspan="1">Bicoid, Hunchback</td></tr><tr><td align="left" colspan="1" rowspan="1">Engrailed</td><td align="left" colspan="1" rowspan="1">900</td><td align="left" colspan="1" rowspan="1">Caudal</td></tr><tr><td align="left" colspan="1" rowspan="1">Eve Str 2</td><td align="left" colspan="1" rowspan="1">730</td><td align="left" colspan="1" rowspan="1">Bicoid, Hunchback, Kruppel</td></tr><tr><td align="left" colspan="1" rowspan="1">Eve Str 3+7</td><td align="left" colspan="1" rowspan="1">512</td><td align="left" colspan="1" rowspan="1">Hunchback, Knirps</td></tr><tr><td align="left" colspan="1" rowspan="1">Eve Str 4+6</td><td align="left" colspan="1" rowspan="1">602</td><td align="left" colspan="1" rowspan="1">Hunchback, Knirps</td></tr><tr><td align="left" colspan="1" rowspan="1">FushiTarazu Zebra</td><td align="left" colspan="1" rowspan="1">653</td><td align="left" colspan="1" rowspan="1">Caudal</td></tr><tr><td align="left" colspan="1" rowspan="1">Hairy Str 5</td><td align="left" colspan="1" rowspan="1">1574</td><td align="left" colspan="1" rowspan="1">Kruppel</td></tr><tr><td align="left" colspan="1" rowspan="1">Hairy Str 6</td><td align="left" colspan="1" rowspan="1">556</td><td align="left" colspan="1" rowspan="1">Caudal, Hunchback, Knirps, Kruppel</td></tr><tr><td align="left" colspan="1" rowspan="1">Hairy Str 7</td><td align="left" colspan="1" rowspan="1">1471</td><td align="left" colspan="1" rowspan="1">Bicoid, Hunchback, Kruppel</td></tr><tr><td align="left" colspan="1" rowspan="1">Kruppel 730</td><td align="left" colspan="1" rowspan="1">1158</td><td align="left" colspan="1" rowspan="1">Bicoid, Hunchback, Knirps</td></tr><tr><td align="left" colspan="1" rowspan="1">Runt</td><td align="left" colspan="1" rowspan="1">1335</td><td align="left" colspan="1" rowspan="1">Bicoid, Hunchback, Knirps, Kruppel</td></tr><tr><td align="left" colspan="1" rowspan="1">Spalt</td><td align="left" colspan="1" rowspan="1">721</td><td align="left" colspan="1" rowspan="1">Bicoid, Caudal, Hunchback, Kruppel</td></tr><tr><td align="left" colspan="1" rowspan="1">Tailless</td><td align="left" colspan="1" rowspan="1">635</td><td align="left" colspan="1" rowspan="1">Caudal, Bicoid</td></tr></tbody></table></alternatives></table-wrap></sec><sec id="s2e2"><title>Results on real CRM data sets</title><p>Using a 1 versus <italic>K</italic>−1 cross validation scheme detailed in the <xref ref-type="sec" rid="s4">Materials and Methods</xref> section, where <italic>K</italic> is the total number of CRMs in which a motif in question is present, we tested all algorithms on five motifs, <italic>Bicoid</italic>, <italic>Caudal</italic>, <italic>Hunchback</italic>, <italic>Kruppel</italic> and <italic>Knirps</italic>, one motif type at a time, and the results are summarized in <xref ref-type="fig" rid="pcbi-1000090-g009">Figure 9</xref>. We used posterior decoding for CSMET and PhyloHMM, since even motifs of the same type can overlap on opposite strands or even on the same strand. For the other three algorithms, we explored their optimum parameter configuration to get meanful results. The five algorithms were compared on the basis of precision, recall, and their F1 score only on the <italic>melanogaster</italic> motifs they manage to identify within the CRMs. Overall, CSMET outperforms all other methods in all motifs except for Kruppel. For Kruppel, all methods perform poorly because the quality of the PWM that can be obtained from training data has very high entropy. <xref ref-type="fig" rid="pcbi-1000090-g009">Figure 9B and 9C</xref> also show that CSMET gives a much higher recall score than other softwares in most cases while maintaining a precision comparable to them (except in some cases where Stubb has very high precision but very low recall). It is worth mentioning that in these real CRMs, biological annotations tend to be conservative because they are only based on existing footprinting experiments performed in a non-exhaustive fashion in most of the CRMs. Thus a high recall is not very surprising.</p><fig id="pcbi-1000090-g009" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1000090.g009</object-id><label>Figure 9</label><caption><title>Comparison of algorithms on motif search performance over 5 motifs on real CRMs.</title></caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000090.g009" xlink:type="simple"/></fig><p>Since real CRM data are more complex than simulated data due to the presence of a significant number of gaps, broken motifs etc., there is a significant variance in the performances across different motifs by CSMET, as well as by all other algorithms; on the other hand, training data for fitting the model parameters needed in a CSMET is extremely limited. We found that the performance of CSMET can be improved over its maximum likelihood configuration (determined from training data) by adjusting the values of the evolutionary parameters. The evolutionary parameters that are estimated from the training data are: the tree evolutionary rates (represented as the scaling coefficients of the tree branches) for the motif and annotation tree, and the Felsenstein rates for the motif and background nucleotide substitution models. Of these parameters, we found that the predictive power of the model is most significantly affected by the evolutionary rate of the functional tree. <xref ref-type="fig" rid="pcbi-1000090-g010">Figure 10</xref> shows the ROC curve of CSMET performance under various values of the evolutionary rate <italic>r</italic> ranging from a half to 4 times the maximum likelihood estimator of <italic>r</italic>, along with the scores of 3 competing softwares at a working parameterization adjusted based on their default setting. From <xref ref-type="fig" rid="pcbi-1000090-g010">Figure 10</xref>, it is noteworthy that the performance of all programs on the Hunchback motif is generally good. This is probably because the <italic>Hunchback</italic> motif instances are generally very well conserved, and thus the quality of our training annotation based upon visual inspection is relatively more reliable.</p><fig id="pcbi-1000090-g010" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1000090.g010</object-id><label>Figure 10</label><caption><title>ROC of CSMET with different values of functional evolutionary (i.e., TFBS turnover) rates on <italic>Drosophila</italic> CRMs.</title></caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000090.g010" xlink:type="simple"/></fig></sec><sec id="s2e3"><title>Findings on real CRM data sets</title><p>CSMET has correctly retrieved a significant portion of previously known TFBSs within the 14 CRMs in the <italic>melanogaster</italic> taxon, along with their putative conserved orthologs in other taxa, or in some cases, apparent site turnovers in other taxa. Furthermore it has also found numerous interesting instances of alignment blocks of putative TFBSs not known before, both inside CRMs as well as in CRM flanking regions, where TFBS turnovers are apparent in some taxa. A database containing the complete summary of our predictions is available at <ext-link ext-link-type="uri" xlink:href="http://www.sailing.cs.cmu.edu/csmet/" xlink:type="simple">http://www.sailing.cs.cmu.edu/csmet/</ext-link>, where the positions and taxonomic-identities of all predicted TFBSs and turnovers are documented graphically with appropriate color highlights for each of the 14 CRM alignments we analyzed. <xref ref-type="fig" rid="pcbi-1000090-g011">Figure 11</xref> shows a snapshot of a fraction of one of the annotated alignments in our database. Some examples of the predicted TFBSs are presented in <xref ref-type="fig" rid="pcbi-1000090-g012">Figure 12</xref>.</p><fig id="pcbi-1000090-g011" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1000090.g011</object-id><label>Figure 11</label><caption><title>A screenshot of the summary of TFBS-predictions as displayed on the CSMET website.</title></caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000090.g011" xlink:type="simple"/></fig><fig id="pcbi-1000090-g012" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1000090.g012</object-id><label>Figure 12</label><caption><title>Example of previously unknown or biologically validated motif instances uncovered by CSMET in the presence of functional turnover or misalignment.</title><p>CRM regions are shown in yellow in the alignment. The genomic loci for the flanking region borders, CRM borders and display snippet borders for <italic>melanogaster</italic> assembly 4 are shown on the immediate left of the alignment; with the logos of the identified motifs shown on the far left <xref ref-type="bibr" rid="pcbi.1000090-Crooks1">[43]</xref>. (a) A <italic>Caudal</italic> motif in <italic>Engrailed</italic> CRM Alignment. (b) A <italic>Caudal</italic> in <italic>FushiTarazu Zebra</italic> CRM. (c) A <italic>Caudal</italic> in <italic>Tailless</italic>. (d) A <italic>Hunchback</italic> in the <italic>Abda</italic> CRM. (e) A <italic>Hunchback</italic> in <italic>Hairy stripe7</italic> CRM. (f) A <italic>Hunchback</italic> in <italic>Spalt</italic> CRM flanking region about 1000 bp apart from the CRM. (g) A <italic>Knirps</italic> in <italic>Even skipped stripe 4/6</italic> CRM. (h) A <italic>Knirps</italic> in <italic>Kruppel 730</italic> CRM flanking region 38bp apart from the CRM.</p></caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000090.g012" xlink:type="simple"/></fig><p>Due to the functional heterogeneity across taxa in many of these alignment blocks of putative TFBSs, these motifs can be difficult for other algorithms to detect. Some of these instances correspond to putative TFBSs appearing in non-melanogaster taxa, such as the putative Knirps motif block in the Kruppel 730 CRM (<xref ref-type="fig" rid="pcbi-1000090-g012">Figure 12H</xref>), and the putative Hunchback motif in the flanking region of Spalt CRM (<xref ref-type="fig" rid="pcbi-1000090-g012">Figure 12F</xref>). Another interesting observation is that numerous putative TFBS blocks were identified not just inside the developmental CRMs but also in the flanking regions of the CRMs we analyzed. We had chosen 1000 bp of flanking region from <italic>D. melanogaster</italic>, and found that while some putative sites are located within 100 bp of established CRM boundaries (e.g., <xref ref-type="fig" rid="pcbi-1000090-g012">Figure 12H</xref>), others may lie as far away as 1000 bp (our limit of analysis) and possibly further away from established CRM boundaries (e.g., <xref ref-type="fig" rid="pcbi-1000090-g012">Figure 12F</xref>). We also noted several interesting patterns in examples of functional turnover. These include single species loss of TFBSs, as for the <italic>Caudal</italic> motif in the Tailless CRM region (<xref ref-type="fig" rid="pcbi-1000090-g012">Figure 12C</xref>) and for the <italic>Knirps</italic> motif in Even Skipped Stripes 4+6 CRM region (<xref ref-type="fig" rid="pcbi-1000090-g012">Figure 12G</xref>); and subclade specific loss or gain of binding sites, as in the <italic>Hunchback</italic> motif block in the Abdominal A CRM region (<xref ref-type="fig" rid="pcbi-1000090-g012">Figure 12D</xref>) and the <italic>Hunchback</italic> motif block in the Hairy Stripe 7 CRM region (<xref ref-type="fig" rid="pcbi-1000090-g012">Figure 12E</xref>). A common form of subclade specific loss or gain is that they take place in closely related sister taxa, like <italic>D. pseudoobscura</italic> and <italic>D. persimilis</italic> as in the <italic>Caudal</italic> motif in the Fushi Tarazu Zebra CRM (<xref ref-type="fig" rid="pcbi-1000090-g012">Figure 12B</xref>) and the <italic>Hunchback</italic> motif in the Spalt CRM (<xref ref-type="fig" rid="pcbi-1000090-g012">Figure 12F</xref>).</p><p>To assess whether CSMET predicts TFBSs of biological significance, we tried validating our findings by checking which of our predicted motif blocks with functional turnover had been biologically validated. While this is not possible for motifs predicted only in non-melanogaster taxa, or for motifs predicted in CRM flanking regions, we found numerous examples of conserved motif blocks which were biologically validated for the ortholog in <italic>D. melanogaster</italic>. For example, based on the binding site database of papatsenko, the <italic>Caudal</italic> motif block in Tailless CRM (<xref ref-type="fig" rid="pcbi-1000090-g012">Figure 12C</xref>) and the <italic>Hunchback</italic> block in Abdominal A CRM (<xref ref-type="fig" rid="pcbi-1000090-g012">Figure 12D</xref>) were both biologically validated. We further used two recently available large public TF databases—Oreganno <xref ref-type="bibr" rid="pcbi.1000090-Montgomery1">[41]</xref> and the RegFly <xref ref-type="bibr" rid="pcbi.1000090-Bergman2">[42]</xref>—to check if we could find biologically validated binding sites outside those listed in papatsenko. Of the 8 motifs displayed, 2 additional cases were confirmed in this independent dataset—the <italic>Caudal</italic> motif in the Fushi Tarazu Zebra enhancer (<xref ref-type="fig" rid="pcbi-1000090-g012">Figure 12B</xref>) region, and the <italic>Hunchback</italic> in the Hairy Stripe 7 (<xref ref-type="fig" rid="pcbi-1000090-g012">Figure 12E</xref>) region. Even though we did not perform an exhaustive search to examine whether the validated binding sites (with functional turnover in other species) predicted by CSMET were also predicted by other programs, our results include several non-conserved biologically validated binding sites which are predicted by CSMET but not by PhyloGibbs, including the <italic>Hunchback</italic> motif in Abdominal A CRM (<xref ref-type="fig" rid="pcbi-1000090-g012">Figure 12D</xref>), and the <italic>Hunchback</italic> motif in Hairy Stripe 7 CRM (<xref ref-type="fig" rid="pcbi-1000090-g012">Figure 12E</xref>). Other such binding sites like mel3L+:8639083 were also noted.</p></sec></sec></sec><sec id="s3"><title>Discussion</title><p>CSMET is a novel phylogenetic shadowing method that can model biological sequence evolution at both nucleotide level at each individual site, and functional level of a whole TFBS. It offers a principled way of addressing the problem that can seriously compromise the performance of many extant conservation-based motif finding algorithms: motif turnover in aligned CRM sequences from different species, an evolutionary event that results in functional heterogeneity across aligned sequence entities and shatters the basis of conventional alignment scoring methods based on a single function-specific phylogeny. CSMET defines a new evolution-based score that explicitly models functional substitution along the phylogeny that causes motif turnover, and nucleotide divergence of aligned sites in each taxa under possibly different function-specific phylogenies conditioning on the turnover status of the site in each taxon.</p><p>In principle, CSMET can be used to estimate the rate of turnover of different motifs, which can elucidate the history and dynamics of functional diversification of regulatory binding sites. But we notice that experimentally validated multi-species CRM/TFBS annotations that support an unbiased estimate of turnover rates are yet to be generated, as currently almost all biologically validated motifs only exist in a small number of representative species in each clade of the tree of life, such as <italic>melanogaster</italic> in the <italic>Drosophila</italic> clade. Manual annotation on CRM alignments, as we used in this paper, tends to bias the model toward conserved motifs. Thus, at this time, the biological interpretation of evolutionary parameters on the functional phylogeny remains preliminary. Nevertheless, these estimated parameters do offer important utility from a statistical and algorithmic point of view, by elegantly controlling the trade-off between two competing molecular substitution processes—that of the motif sequence and of the background sequence—at every aligned site across all taxa beyond what is offered in any existing motif evolution model. Empirically, we find that such modelling is useful in motif detection.</p><p>On both synthetic data and 14 CRMs from 11 <italic>Drosophila</italic> taxa, we find that the CSMET performs competitively against the state-of-the-art comparative genomic motif finding algorithm, PhyloGibbs, and significantly outperforms other methods such as EMnEM, PhyloHMM and Stubb. In particular, CSMET demonstrates superior performance in certain important scenarios, such as cases where aligned sequences display significant divergence and motif functionalities are apparently not conserved across taxa or over multiple adjacent sites. We also find that both CSMET and PhyloGibbs significantly outperform Stubb when the latter is naively applied to sequences of all taxa without exploiting their evolutionary relationships. Our results suggest that a careful exploration of various levels of biological sequence evolution can significantly improve the performance of comparative genomic motif detection.</p><p>Recently, some alignment-free methods <xref ref-type="bibr" rid="pcbi.1000090-Kantorovitz1">[19]</xref> have emerged which search for conserved TFBS rich regions across species based on a common scoring function, e.g., distribution of word frequencies (which in some ways mirrors the PWM of a reference species). One may ask, given perhaps in the future a perfect search algorithm (in terms of only computational efficiency), do we still need explicit model-based methods such as CSMET? We believe that even if exhaustive search of arbitrary string patterns becomes possible, models such as CSMET still offer important advantage not only in terms of interpretability and evolutionary insight as discussed above, but possibly also in terms of performance because of the more plausible scoring schemes they use. This is because it is impractical to obtain the PWM of a motif in species other than a few reference taxa, thus the scores of putative motif instances in species where their own versions of the PWM are not available can be highly inaccurate under the PWM from the reference species due to evolution of the PWM itself in these study species with respect to the PWM in the reference species. The CSMET places the reference PWM only at the tree root as an equilibrium distribution; for the tree leaves where all study species are placed, the nucleotide substitution model along tree branches allows sequences in each species to be appropriately scored under a species-specific distribution that is different from the reference PWM, thereby increasing its sensitivity to species-specific instantiations of motifs.</p><p>A possible future direction for this work lies in developing better approximate inference techniques for posterior inference under the CSMET model, especially under the scenarios of studying sequences from a large clade with many taxa, and/or searching for multiple motifs simultaneously. It is noteworthy that our methods can be readily extended for <italic>de novo</italic> motif detection, for which an EM or a Monte Carlo algorithm can be applied for model-estimation based on the maximum likelihood principle. Currently we are exploring such extensions. Also we intend to develop a semi-supervised training algorithm that does not need manual annotation of motifs in other species on the training CRM alignment, so that we can obtain a less biased estimate of the evolutionary parameters of the CSMET model.</p><p>A problem with most of the extant motif finders, including the proposed CSMET, is that the length variation of aligned motifs (e.g., alignments with gaps) cannot be accommodated. In our model, while deletion events may be captured as gaps in the motif alignment, insertion events cannot be captured as the length of the motif is fixed. This is because in a typical HMM sequence model the state transitions between sites within motifs are designed to be deterministic. Thus stochastically accommodating gaps (insertion events) within motifs is not feasible. Hence, some of the actual motifs missed by the competing algorithms were “gapped” motifs. These issues deserve further investigation.</p></sec><sec id="s4"><title>Materials and Methods</title><sec id="s4a"><title>The Molecular and Functional Substitution Model</title><p>We use the Felsenstein 1984 model (F84) <xref ref-type="bibr" rid="pcbi.1000090-Felsenstein2">[29]</xref>, which is similar to the Hasegawa–Kishino–Yano's 1985 model (HKY85) <xref ref-type="bibr" rid="pcbi.1000090-Hasegawa1">[44]</xref> and widely used in the phylogenetic inference and footprinting literature <xref ref-type="bibr" rid="pcbi.1000090-McAuliffe1">[5]</xref>,<xref ref-type="bibr" rid="pcbi.1000090-Felsenstein2">[29]</xref>, for nucleotide substitution in our motif and background phylogeny. Formally, F84 is a five-parameter model, based on a stationary distribution <italic>π</italic> ≡ [<italic>π<sub>A</sub></italic>, <italic>π<sub>T</sub></italic>, <italic>π<sub>G</sub></italic>, <italic>π<sub>C</sub></italic>]′ (which constitutes three free parameters as the equilibrium frequencies sum to ) and the additional parameters <italic>κ</italic> and <italic>ι</italic> which impose the transition/transversion bias. According to this model, the nucleotide-substitution probability from an internal node <italic>c</italic> to its descendent <italic>c</italic>′ along a tree branch of length <italic>b</italic> can be expressed as follows:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e040" xlink:type="simple"/><label>(3)</label></disp-formula>where <italic>i</italic> and <italic>j</italic> denote nucleotides, <italic>δ<sub>ij</sub></italic> represents the Kronecker delta function, and <italic>ε<sub>ij</sub></italic> is a function similar to the Kronecker delta function which is 1 if <italic>i</italic> and <italic>j</italic> are both pyrimidines or both purines, but 0 otherwise. The summation in the denominator concisely computes purine frequency or pyrimidine frequency. A more intuitive parameterization for F84 involves the overall substitution rate per site <italic>μ</italic> and the transition/transversion ratio <italic>ρ</italic>, which can be easily estimated or specified. We can compute the transition matrix <italic>P<sub>N</sub></italic> from <italic>μ</italic> and <italic>ρ</italic> using Equation 3 based on the following relationship between (<italic>κ</italic>,<italic>ι</italic>) and (<italic>μ</italic>,<italic>ρ</italic>):<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e041" xlink:type="simple"/></disp-formula>To model functional turnover of aligned substrings along functional phylogeny <italic>T<sub>f</sub></italic>, we additionally define a substitution process over two characters (0 and 1) corresponding to presence or absence of functionality. Now we use the single parameter JC69 model <xref ref-type="bibr" rid="pcbi.1000090-Jukes1">[26]</xref> for functional turnover due to its simplicity and straightforward adaptability to an alphabet of size 2. The transition probability along a tree branch of length <italic>β</italic> (which represents the product of substitution rate <italic>μ</italic> and evolution time <italic>t</italic>, which are not identifiable independently,) is defined by:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e042" xlink:type="simple"/><label>(4)</label></disp-formula>We estimate the evolutionary parameters from training data based on maximum likelihood, details are available in the <xref ref-type="supplementary-material" rid="pcbi.1000090.s001">Text S1</xref>.</p></sec><sec id="s4b"><title>Computing Complete- and Partial-Alignment Likelihood</title><p>A complete phylogenetic tree <italic>T</italic> ≡ {<italic>τ</italic>, <italic>π</italic>, <italic>β</italic>, <italic>λ</italic>} with internal nodes {<italic>V<sub>i</sub></italic>; <italic>i</italic> = 1:<italic>K′</italic>} and leaf nodes {<italic>V<sub>i</sub></italic>; <italic>i</italic> = <italic>K′</italic>+1:<italic>K</italic>}, where <italic>K</italic> denotes the total number of nodes (i.e., current and ancestral species) instantiated in the tree and the node indexing follows a breath-first traversal from the root, defines a joint probability distribution of all-node configurations (i.e., the nucleotide contents at an aligned site in all species instantiated in the tree), which can be written as the following product of nt-substitution probabilities along tree branches:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e043" xlink:type="simple"/><label>(5)</label></disp-formula>where <italic>V<sub>pa</sub></italic><sub>(<italic>i</italic>)</sub> denotes the parent-node of the node <italic>i</italic> in the tree, and the substitution probability <italic>P<sub>N</sub></italic>() is defined by Equation 3. For each position <italic>l</italic> of the multiple alignment, computing the probability of the entire column denoted by <italic>A<sub>l</sub></italic> of aligned nucleotides from species corresponding to the leaves of a phylogenetic tree <italic>T</italic><sup>(<italic>l</italic>)</sup> defined on position <italic>l</italic>, i.e., <italic>P</italic>(<italic>A<sub>l</sub></italic>|<italic>T</italic><sup>(<italic>l</italic>)</sup>), where <italic>A<sub>l</sub></italic> correspond to an instantiation of the leaf nodes {<italic>V<sub>i</sub></italic>; <italic>i</italic> = <italic>K′</italic>+1:<italic>K</italic>}, takes exponential time if performed naively, since it involves the marginalization of all the internal nodes in the tree, i.e.,<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e044" xlink:type="simple"/><label>(6)</label></disp-formula>We use the Felsenstein pruning algorithm <xref ref-type="bibr" rid="pcbi.1000090-Felsenstein3">[30]</xref>, which is a dynamic programming method that computes the probability of a leaf-configuration under a tree from the bottom up. At each node of the tree, we store the probability of the subtree rooted at that node, for each possible nucleotide at that node. At the leaves, only the probability for the particular nucleotide instantiated in the corresponding taxon is non-zero, and for all the other nucleotides, it is zero. Unlike the naive algorithm, the pruning algorithm requires an amount of time that is proportional to the number of leaves in the tree.</p><p>We use a simple extension of this algorithm to compute the probabilities of a partial-alignment <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e045" xlink:type="simple"/></inline-formula> defined earlier under a marginal phylogeny, which is required in the coupled-pruning algorithm for CSMET, by considering only the leaves instantiated in <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e046" xlink:type="simple"/></inline-formula> (but not in <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e047" xlink:type="simple"/></inline-formula>) that is under a subtree <italic>T′</italic><sup>(<italic>l</italic>)</sup> that forms the marginal phylogeny we are interested in. Specifically, let <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e048" xlink:type="simple"/></inline-formula> correspond to possible instantiations of the subset of nodes we need to marginalized out. Since we already how to compute <italic>P</italic>(<italic>A<sub>l</sub></italic>|<italic>T</italic><sup>(<italic>l</italic>)</sup>) via marginalization over internal nodes <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e049" xlink:type="simple"/></inline-formula>, we simply further this marginalization over leaf nodes <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e050" xlink:type="simple"/></inline-formula> that corresponds to taxa instantiated in <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e051" xlink:type="simple"/></inline-formula>, i.e.,<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e052" xlink:type="simple"/><label>(7)</label></disp-formula>where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e053" xlink:type="simple"/></inline-formula> denotes the leaves instantiated in <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e054" xlink:type="simple"/></inline-formula>. This amounts to replacing the leaf-instantiation step, which was originally operated on all leaves in the Felsenstein pruning algorithm, by a node-summation step over those leaves in <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e055" xlink:type="simple"/></inline-formula>. In fact, in can be easily shown that this is equivalent to performing the Felsenstein pruning only on the partial tree <italic>T′</italic><sup>(<italic>l</italic>)</sup> that directly shadows <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e056" xlink:type="simple"/></inline-formula>, which is a smaller tree than the original <italic>T</italic><sup>(<italic>l</italic>)</sup>, and only requires time <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e057" xlink:type="simple"/></inline-formula>.</p></sec><sec id="s4c"><title>Computing the Block-Emission Probabilities</title><p>Under the CSMET model, to perform the forward-backward algorithm for either motif prediction or unsupervised model training, we need to compute the emission probability given each functional state at every alignment site. This is nontrivial because a CSMET is defined on an alignment block containing whole motifs across taxa rather than on a single alignment-column. We adopt a “block-approximation” scheme, where the emission probability of each state at a sequence position, say, <italic>t</italic>, is defined on an alignment block of length <italic>L</italic> started at <italic>t</italic>, i.e., <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e058" xlink:type="simple"/></inline-formula>, where <bold>A</bold><italic>t</italic>≡(<italic>A</italic><sub>1</sub>(<italic>t</italic>), <italic>A</italic><sub>2</sub>(<italic>t</italic>),…, <italic>A<sub>L</sub></italic>(<italic>t</italic>)), and <italic>A<sub>l</sub></italic>(<italic>t</italic>) denotes the <italic>l</italic>th column in an alignment block started from position <italic>t</italic>.</p><p>The conditional likelihood <bold>A</bold><italic><sub>t</sub></italic> given the nucleotide-evolutionary trees <italic>T</italic> and <italic>T<sub>b</sub></italic> coupled by the annotation tree <italic>T<sub>a</sub></italic> under a particular HMM state <italic>s<sub>t</sub></italic> is also hard to calculate directly, because the leaves of the two nucleotide trees are connected by the leaves of the annotation tree (<xref ref-type="fig" rid="pcbi-1000090-g002">Figure 2B</xref>). However, if the leaf-states of the annotation tree are known, the probability components coming from the two trees become conditionally independent and factor out (see Equation 2). Recall that for a motif of length <italic>L</italic>, the motif tree actually contains <italic>L</italic> site-specific trees, i.e., <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e059" xlink:type="simple"/></inline-formula>, and the the choice of these trees for every site in the same row (i.e., taxon), say, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e060" xlink:type="simple"/></inline-formula> in the alignment block <bold>A</bold><italic><sub>t</sub></italic>, is coupled by a common annotation state <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e061" xlink:type="simple"/></inline-formula>. Hence, given an annotation vector <italic>Z<sub>t</sub></italic> for all rows of <bold>A</bold><italic><sub>t</sub></italic>, we actually calculate the probability of two subset of the rows given two subtrees (i.e., marginal phylogenies) of the original phylogenetic trees for motif and backgrounds, respectively (<xref ref-type="fig" rid="pcbi-1000090-g002">Figure 2B</xref>).</p><p>The subset <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e062" xlink:type="simple"/></inline-formula> is constructed by simply stacking the DNA bases of those taxon for which the annotation variables indicate that they were generated from the motif tree.</p><p>The subtree <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e063" xlink:type="simple"/></inline-formula> is constructed by simply retaining the set of nodes which correspond to the chosen subset, and the ancestors thereof. Similarly we have <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e064" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e065" xlink:type="simple"/></inline-formula>. Hence, we obtain<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e066" xlink:type="simple"/><label>(8)</label></disp-formula></p><p>The probability of a particular leaf-configuration of a tree, be it a partial or complete nucleotide tree, or an annotation tree, can be computed efficiently using the pruning algorithm. Thus for each configuration of <bold>z</bold><italic><sub>t</sub></italic>, we can readily compute <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e067" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e068" xlink:type="simple"/></inline-formula>. The block emission probability <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e069" xlink:type="simple"/></inline-formula> under CSMET can be expressed as:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e070" xlink:type="simple"/><label>(9)</label></disp-formula></p><p>where we use <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e071" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e072" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e073" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e074" xlink:type="simple"/></inline-formula> to make explicit the dependence of the partial blocks and marginal trees on functional indicator vector <bold>z</bold><italic><sub>t</sub></italic>. We call this algorithm a <italic>coupled-pruning algorithm</italic>.</p><p>Note that in this algorithm we need to sum over a total number of 2<italic><sup>M</sup></italic> configurations of <bold>z</bold><italic><sub>t</sub></italic> where <italic>M</italic> is the total number of taxa (i.e., rows) in matrix <bold>A</bold><italic><sub>t</sub></italic>. It is possible to reduce the computational complexity using a full junction tree algorithm on CSMET, which will turn the graphical model underlying CSMET into a clique tree of width (i.e., maximum clique size) possibly smaller than <italic>M</italic>. But this algorithm is complicated and breaks the modularity of the tree-likelihood calculation by the coupled-pruning algorithm. In typical comparative genomic analysis, we expect that <italic>M</italic> will not be prohibitively large, so our algorithm may still be a convenient and easy-to-implement alternative to the junction-tree algorithm. Also this computation can be done off-line and in parallel.</p></sec><sec id="s4d"><title>Posterior Inference Under CSMET</title><p>Given the emission probabilities for each ancestral functional state at each site, we use the forward-backward algorithm for posterior decoding of the sequence of ancestral functional states <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e075" xlink:type="simple"/></inline-formula> along the input CRM alignment of length <italic>N</italic>. The procedure is the same as in a standard HMM applied to a single sequence, except that now the emission probability at each site, say with index <italic>t</italic>, is defined by the CSMET probability over an alignment block <bold>A</bold><italic><sub>t</sub></italic> at that position under an ancestral functional state <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e076" xlink:type="simple"/></inline-formula>, rather than the conditional probability of a single nucleotide observed at position <italic>t</italic> as in the standard HMM. The complexity of this FB-algorithm is <italic>O</italic>(<italic>Nk</italic><sup>2</sup>) where <italic>k</italic> denotes the total number of functional states. In this paper, we only implemented a simple HMM with one type motif allowed on either strand, so that <italic>k</italic> = 3. We defer a more elaborate implementation that allows multiple motifs and encodes sophisticated CRM architecture as in LOGOS <xref ref-type="bibr" rid="pcbi.1000090-Xing2">[33]</xref> to a future extension.</p><p>Given an estimate of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e077" xlink:type="simple"/></inline-formula>, we can infer the MAP estimates of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e078" xlink:type="simple"/></inline-formula>—the functional annotation of every site <italic>t</italic> in every taxon <italic>i</italic> of the alignment. Specifically, the posterior probability of a column of functional states <italic>Z<sub>t</sub></italic> under ancestral functional state <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e079" xlink:type="simple"/></inline-formula> can be expressed as:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e080" xlink:type="simple"/><label>(10)</label></disp-formula>Recall that in the coupled-pruning algorithm, we can readily compute all the three conditional probability terms in the above equation.</p><p>Performing posterior inference allows us to make motif predictions in two ways. A simple way is look at blocks in the alignment at which the posterior inference produces ones, and predict those to be motifs. Alternatively, we can also use the inferred state of the alignment block together with the inferred ancestral state to compute a probability score (as a heuristic) based on the functional annotation tree. The score for the block is the sum of probabilities of each block element being one.</p></sec><sec id="s4e"><title>Tree Estimation</title><p>Given blocks of aligned substrings {<bold>A</bold><italic><sub>t</sub></italic>} containing motif instances in at least one of the aligned taxa, in principle we can estimate both the <italic>annotation tree T<sub>f</sub></italic> ≡ {<italic>α</italic>, <italic>τ<sub>f</sub></italic>, <italic>β<sub>f</sub></italic>} and the <italic>motif trees T<sub>m</sub></italic> ≡ {<italic>θ</italic>, <italic>τ<sub>m</sub></italic>, <italic>β<sub>m</sub></italic>, <italic>λ<sub>m</sub></italic>} based on a maximum likelihood principle. But since in our case most training CRM sequences do not have enough motif data to warrant correct estimation of the motif and function tree, we use the topology and branch lengths of a tree estimated by fastDNAml <xref ref-type="bibr" rid="pcbi.1000090-Olsen1">[36]</xref> from the entire CRM sequence alignment (containing both motif and background) as the common basis to build the <italic>T<sub>f</sub></italic> and <italic>T<sub>m</sub></italic>. Specifically, fastDNAml estimates a maximum likelihood tree under the F84 model from the entire CRM alignment; we then scale the branch lengths of this tree to get the sets of branch lengths for <italic>T<sub>f</sub></italic> and <italic>T<sub>m</sub></italic> by doing a simple linear search (see below) of the scaling coefficient that maximize the likelihood of aligned motif sequences and aligned annotation sequences, under the <italic>T<sub>m</sub></italic> and <italic>T<sub>f</sub></italic> (scaled based on the coefficients) respectively.</p><p>For simplicity, we estimate the background tree <italic>T<sub>b</sub></italic> ≡ {<italic>θ</italic>, <italic>τ<sub>b</sub></italic>, <italic>β<sub>b</sub></italic>, <italic>λ<sub>b</sub></italic>} separately from only aligned background sequences that are completely orthologous (i.e., containing no motifs in any taxon).</p><p>For both motifs and background phylogenies, the Felsenstein rate parameter <italic>μ</italic> for the corresponding nucleotide substitution models must also be estimated from the training data. More technically, note that for <italic>T<sub>m</sub></italic> the scaling coefficient <italic>β</italic> and the rate parameter <italic>μ</italic> form a product in the expression of the substitution probability (see Equation 3) and are not identifiable independently. Thus we only need to estimate the compound rate parameter <italic>μ′</italic> = <italic>μβ</italic>. Ideally, the optimal value of the <italic>μ′</italic> should be obtained by performing a gradient descent on the likelihood under the corresponding phylogeny with respect to <italic>μ′</italic>. However, due to the phylogenetic tree probability terms involved in the likelihood computation, there is no closed form expression for the gradient that can be evaluated for a specific value of the compound rate parameter to determine the direction to choose for optimization. Therefore, to find an approximation to the optimal value of <italic>μ′</italic>, we perform a simple linear search in the space of <italic>μ′</italic> as follows:</p><list list-type="simple"><list-item><p><bold>for</bold> <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e081" xlink:type="simple"/></inline-formula> to <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e082" xlink:type="simple"/></inline-formula> in steps of <italic>δ</italic> <bold>do</bold></p></list-item><list-item><p><italic>L</italic>(<italic>μ′</italic>) = Training motif likelihood under motif phylogeny <italic>T</italic> with compound Felsenstein rate <italic>μ′</italic></p></list-item><list-item><p><bold>end for</bold></p></list-item><list-item><p>Choose <italic>μ</italic> that gives maximum likelihood: <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e083" xlink:type="simple"/></inline-formula></p></list-item></list><p><inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e084" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000090.e085" xlink:type="simple"/></inline-formula> are lower and upper bounds respectively on the space of <italic>μ′</italic> that is searched, and are heuristically chosen based on observation. The step <italic>δ</italic> can be chosen to be as small as desired or is allowable, since having a smaller <italic>δ</italic> increases the number of values of <italic>μ′</italic> that must be tested and hence increases computation, but gives a more accurate optimum.</p></sec><sec id="s4f"><title>Estimation of HMM Parameters</title><p>For prediction of motifs and non-motifs on test sequences, we use an HMM to find the highest probability state (i.e., motif or background) at each site. The parameters for the HMM are the initial probability vector <italic>π</italic> and the transition probability matrix <bold>B</bold>. In the simplest scenario, when binding sites are to be searched for one TF at a time, the basic HMM only needs to model transitions among three different functional states: the background state (indicated by 0), the forward-motif state (indicated by 1) which indicates that the current site is the start of a motif on the forward DNA strand, and a reverse-motif state (indicated by 2) which indicates that the current site is the end of a motif on the reverse-complementary strand. <xref ref-type="fig" rid="pcbi-1000090-g013">Figure 13</xref> shows the HMM corresponding to this scenario.</p><fig id="pcbi-1000090-g013" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1000090.g013</object-id><label>Figure 13</label><caption><title>A 3-state HMM for a single motif.</title></caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000090.g013" xlink:type="simple"/></fig><p>The initial probabilities are fixed by assuming that the HMM always starts in the background state. Thus, <italic>π</italic><sub>0</sub> = 1 and <italic>π</italic><sub>0</sub> = <italic>π</italic><sub>0</sub> = 0. For the transition matrix, we use the maximum likelihood estimator for transition from state <italic>i</italic> to state <italic>j</italic> (which has probability <italic>B<sub>i,j</sub></italic>), this is given by the count of the number of such events in the training data divided by the total number of sites in state <italic>i</italic>. We follow the no-strand-bias assumption, and allow equal transition probabilities from the background state to both the forward-motif and reverse-motif states. Also, in the case where we do not have annotated training alignments, we can use the Baum-Welch algorithm for unsupervised estimation of the transition probability matrix.</p></sec><sec id="s4g"><title>Comparison of CSMET to Available Software</title><p>We compare CSMET with four other programs—PhyloGibbs, EMnEM, PhyloHMM and Stubb. PhyloGibbs is chosen as it is presently a state of the art in multi-species motif detection <xref ref-type="bibr" rid="pcbi.1000090-Siddharthan1">[9]</xref> and it handles motif turnover. PhyloGibbs is an unsupervised algorithm for <italic>de novo</italic> motif detection, and it can also optionally run in supervised mode given PWM for motif search. For a fair comparison, we run PhyloGibbs by specifying the motif PWM based on a maximum likelihood estimation from training data. We run PhyloGibbs with the default set of parameters. We approximately specify the number of motifs expected to be seen, as needed by PhyloGibbs, since the actual number of conserved motifs can vary a lot in both our simulated data and in real biological data.</p><p>EMnEM is chosen as it is another popular multi-species motif detection algorithm based on a different phylogenetic model that does not handle motif turnover and evolutionary-rate autocorrelation. EMnEM performs <italic>de novo</italic> motif detection, but also has a supervised motif search mode, which we choose to operate on. Again, we also approximately specify the number of motifs expected to be seen, and run EMnEM with the default set of parameters.</p><p>PhyloHMM is chosen since it is a direct analog of CSMET, which assumes functional homogeniety across aligned sites. Available PhyloHMM-based tools are implemented for detecting genes <xref ref-type="bibr" rid="pcbi.1000090-McAuliffe1">[5]</xref> and conserved regions <xref ref-type="bibr" rid="pcbi.1000090-Siepel3">[23]</xref>,<xref ref-type="bibr" rid="pcbi.1000090-Margulies1">[24]</xref>, but no PhyloHMM implementations were available for motif finding. Hence, we implemented our own in-house PhyloHMM for the purpose of supervised motif detection.</p><p>Finally, Stubb is chosen as a representative single-species HMM based motif finder to investigate the advantage of comparative-genomic motif detection over traditional approaches that treat each species independently. Stubb can be run both as a single species or as an aligned two species model. Since we are interested in comparing our performance with single species motif detector, we use the single species mode. Also, it might not always be apparent as to which two species to compare in order to get the most meaningful contrast for separating functional sites and non-functional sites. Stubb was run individually on all the aligned sequences, with all the results collated for analysis.</p></sec><sec id="s4h"><title>Data Processing and Experimental Setup</title><p>The synthetic CRMs where true TFBS annotations are known for evaluating CSMET are generated according to the scheme outlined in <xref ref-type="fig" rid="pcbi-1000090-g004">Figure 4</xref>. Given each 1500 bp simulated multiple alignment, we use 1000 bp for training, and the remaining 500 for testing the performance of the trained models. Details of the simulation procedure and the experimental setup are available in the Supplemental Materials.</p><p>Our biological dataset was created based on the motif database in <xref ref-type="bibr" rid="pcbi.1000090-Papatsenko1">[38]</xref>,<xref ref-type="bibr" rid="pcbi.1000090-Bergman1">[39]</xref>, from which we chose to predict TFBS of TF which have at least 10 or more biologically validated training instances. The five TFs which met this requirement were Bicoid, Caudal, Kruppel, Knirps and Hunchback motifs. Motif finding was performed on 14 CRMs listed in <xref ref-type="table" rid="pcbi-1000090-t001">Table 1</xref> which contained instances for these 5 binding sites. The multiple sequence alignment corresponding to the CRMs were obtained by using the UCSC Genome Browser pre-compiled alignments <xref ref-type="bibr" rid="pcbi.1000090-FlybaseConsortium1">[40]</xref>. The sequence corresponding to <italic>willistoni</italic> was left out due to poor alignment quality and missing contigs. Flanking regions of 1000 bp on each side of the CRMs were also analyzed. For each CRM alignment, we use the motifs identified in <italic>melanogaster</italic> as references to mark all alignment blocks that contain at least one instance of motifs among the 11 taxa to be analyzed. As a result our benchmark is biased toward <italic>melanogaster</italic>, because annotations in other taxa are not available to mark motifs that are present in other <italic>Drosophila</italic> taxa but not in <italic>melanogaster</italic>. The <italic>melanogaster</italic> CRMs contain both biologically validated motifs and computationally identified but plausible motifs, as documented in <xref ref-type="bibr" rid="pcbi.1000090-Papatsenko1">[38]</xref>,<xref ref-type="bibr" rid="pcbi.1000090-Bergman1">[39]</xref>.</p><p>To train the CSMET, we manually annotated the functional states (i.e., <italic>Z<sub>t</sub></italic>) across all taxa in all alignment blocks (i.e., <bold>A</bold><italic><sub>t</sub></italic>) containing the <italic>melanogaster</italic> motif. We employ a 1 versus <italic>K</italic>−1 cross-validation scheme for testing on each motif type, where <italic>K</italic> is the total number of CRMs where a motif type is present. Specifically, for each motif type we trained all programs on <italic>K</italic>−1 out of the <italic>K</italic> CRMs hosting the motif, and tested on the remaining one, and we iterated this until all <italic>K</italic> CRMs had been tested. Recall that the test accuracy is assessed only for reported motifs in <italic>melanogaster</italic>, but not on those manually annotated ones in other taxa.</p><p>To avoid overfitting the motif and functional phylogenies of CSMET under limited training data, for all our experiments, we used a single phylogenetic tree estimated from the entire training sequence alignment dataset as the un-scaled version of the motif and functional trees. We assumed that the <italic>T<sub>f</sub></italic>'s of every type of motif share the same topology and branch lengths, but different equilibriums. Thus, <italic>T<sub>f</sub></italic> can be fitted from a concatenation of motif-instance alignments of all types of motifs. For the motif sequence phylogenies, we enforced the trees at every site in the same motif have the same topology, branch length, and the Felsenstein total substitution rate, but different equilibriums. A second tree was estimated on background sites only, and was used as the background phylogeny.</p><p>To handle real data which contains gaps and other complexities, it is necessary to change some settings of the competing software from their defaults to ensure proper behavior. EMnEM was run with default parameters, but with the threshold set to 0.999 to reduce false positives; as for the suggested threshold of 0.5, virtually every location was being classified as a motif. PhyloGibbs was run with default parameters, but for handling gaps, the modes of using the full alignment, as well as using partial alignments were tried, and the pre-estimated phylogeny on all species for the entire sequence was given to it. PhyloHMM was run naively using posterior decoding. Stubb was run with default settings with a slightly reduced threshold of 6.0. At the suggested threshold of 10.0 for a window size of 500, Stubb predicts no true positives.</p></sec><sec id="s4i"><title>Evaluation</title><p>We base our evaluation of every program on three commonly used evaluation metrics - precision, recall and the F1 score (i.e., the harmonic mean) based on precision and recall <xref ref-type="bibr" rid="pcbi.1000090-Tompa1">[37]</xref>. The precision is defined as the ratio of number of true predicted positives over number of all predicted instances; and recall is defined as the number of true predicted positives to the number of all positives in the gold-standard annotation. (By this choice of evaluation score we avoided trivial specificity measure due to very large number of both predicted and true negatives.) We also allow a little leeway in the prediction of the motif location—a predicted hit falling within a tolerance window of size 5bp on either side of the actual starting location of the motif is also counted as a correct hit. When an algorithm fails to make any predictions, both precision and recall are taken to be zero. F1 score in such cases is also taken to be zero. For simulation-based evaluation, since the ground-truth of motif locations is known in all taxa, the numbers of true and false predictions are counted over motif instances in all taxa. For each experiment, we report summary statistics of performance scores over all 50 alignments for each algorithm.</p></sec></sec><sec id="s5"><title>Supporting Information</title><supplementary-material id="pcbi.1000090.s001" mimetype="application/pdf" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000090.s001" xlink:type="simple"><label>Text S1</label><caption><p>Supplementary material for methods.</p><p>(1.40 MB PDF)</p></caption></supplementary-material></sec></body><back><ack><p>We thank Professor Martin Kreitman for helpful discussions, anonymous reviewers for insightful comments, and Dr. Judie Howrylak for proofreading the manuscript, which helped to significantly improve its quality and readability.</p></ack><ref-list><title>References</title><ref id="pcbi.1000090-Boffelli1"><label>1</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Boffelli</surname><given-names>D</given-names></name><name name-style="western"><surname>McAuliffe</surname><given-names>J</given-names></name><name name-style="western"><surname>Ovcharenko</surname><given-names>D</given-names></name><name name-style="western"><surname>Lewis</surname><given-names>KD</given-names></name><name name-style="western"><surname>Ovcharenko</surname><given-names>I</given-names></name><etal/></person-group>             <year>2003</year>             <article-title>Phylogenetic shadowing of primate sequences to find functional regions of the human genome.</article-title>             <source>Science</source>             <volume>299</volume>             <fpage>1391</fpage>             <lpage>1394</lpage>          </element-citation></ref><ref id="pcbi.1000090-Blanchette1"><label>2</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Blanchette</surname><given-names>M</given-names></name><name name-style="western"><surname>Tompa</surname><given-names>M</given-names></name></person-group>             <year>2002</year>             <article-title>Discovery of Regulatory Elements by a Computational Method for Phylogenetic Footprinting.</article-title>             <source>Genome Research</source>             <volume>12</volume>             <fpage>739</fpage>             <lpage>748s</lpage>          </element-citation></ref><ref id="pcbi.1000090-Siepel1"><label>3</label><element-citation publication-type="other" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Siepel</surname><given-names>AC</given-names></name><name name-style="western"><surname>Haussler</surname><given-names>D</given-names></name></person-group>             <year>2003</year>             <article-title>Combining phylogenetic and hidden Markov models in biosequence analysis.</article-title>             <source>Proceedings of the seventh annual international conference on Research in computational molecular biology (RECOMB)</source>             <fpage>277</fpage>             <lpage>286</lpage>          </element-citation></ref><ref id="pcbi.1000090-Wang1"><label>4</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Wang</surname><given-names>T</given-names></name><name name-style="western"><surname>Stormo</surname><given-names>GD</given-names></name></person-group>             <year>2003</year>             <article-title>Combining phylogenetic data with co-regulated genes to identify regulatory motifs.</article-title>             <source>Bioinformatics</source>             <volume>19</volume>             <fpage>2369</fpage>             <lpage>80</lpage>          </element-citation></ref><ref id="pcbi.1000090-McAuliffe1"><label>5</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>McAuliffe</surname><given-names>JD</given-names></name><name name-style="western"><surname>Pachter</surname><given-names>L</given-names></name><name name-style="western"><surname>Jordan</surname><given-names>M</given-names></name></person-group>             <year>2004</year>             <article-title>Multiple-sequence functional annotation and the generalized hidden markov phylogeny.</article-title>             <source>Bioinformatics</source>             <volume>20</volume>             <fpage>1850</fpage>             <lpage>1860</lpage>          </element-citation></ref><ref id="pcbi.1000090-Pedersen1"><label>6</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Pedersen</surname><given-names>J</given-names></name><name name-style="western"><surname>Hein</surname><given-names>J</given-names></name></person-group>             <year>2003</year>             <article-title>Gene finding with a hidden markov model of genome structure and evolution.</article-title>             <source>Bioinformatics</source>             <volume>19</volume>             <fpage>219</fpage>             <lpage>227</lpage>          </element-citation></ref><ref id="pcbi.1000090-Siepel2"><label>7</label><element-citation publication-type="other" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Siepel</surname><given-names>AC</given-names></name><name name-style="western"><surname>Haussler</surname><given-names>D</given-names></name></person-group>             <year>2004</year>             <source>Computational identification of evolutionarily conserved exons. Proceedings of the eighth annual international conference on Research in computational molecular biology (RECOMB)</source>             <fpage>177</fpage>             <lpage>186</lpage>          </element-citation></ref><ref id="pcbi.1000090-Ludwig1"><label>8</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Ludwig</surname><given-names>MZ</given-names></name><name name-style="western"><surname>Palsson</surname><given-names>A</given-names></name><name name-style="western"><surname>Alekseeva</surname><given-names>E</given-names></name><name name-style="western"><surname>Bergman</surname><given-names>CM</given-names></name><name name-style="western"><surname>Nathan</surname><given-names>J</given-names></name><etal/></person-group>             <year>2005</year>             <article-title>Functional evolution of a cisregulatory module.</article-title>             <source>PLoS Biol</source>             <volume>3</volume>             <fpage>e93</fpage>          </element-citation></ref><ref id="pcbi.1000090-Siddharthan1"><label>9</label><element-citation publication-type="other" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Siddharthan</surname><given-names>R</given-names></name><name name-style="western"><surname>van Nimwegen</surname><given-names>E</given-names></name><name name-style="western"><surname>Siggia</surname><given-names>ED</given-names></name></person-group>             <year>2004</year>             <article-title>Phylogibbs: A gibbs sampler incorporating phylogenetic information.</article-title>             <person-group person-group-type="editor"><name name-style="western"><surname>Eskin</surname><given-names>E</given-names></name><name name-style="western"><surname>Workman</surname><given-names>C</given-names></name></person-group>             <source>Regulatory Genomics. Springer, volume 3318 of <italic>Lecture Notes in Computer Science</italic></source>             <fpage>30</fpage>             <lpage>41</lpage>          </element-citation></ref><ref id="pcbi.1000090-Sinha1"><label>10</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Sinha</surname><given-names>S</given-names></name><name name-style="western"><surname>Blanchette</surname><given-names>M</given-names></name><name name-style="western"><surname>Tompa</surname><given-names>M</given-names></name></person-group>             <year>2004</year>             <article-title>PhyME: a probabilistic algorithm for finding motifs in sets of orthologous sequences.</article-title>             <source>BMC Bioinformatics</source>             <volume>5</volume>             <fpage>170</fpage>          </element-citation></ref><ref id="pcbi.1000090-Ludwig2"><label>11</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Ludwig</surname><given-names>MZ</given-names></name><name name-style="western"><surname>Patel</surname><given-names>NH</given-names></name><name name-style="western"><surname>Kreitman</surname><given-names>M</given-names></name></person-group>             <year>1998</year>             <article-title>Functional analysis of eve stripe 2 enhancer evolution in Drosophila: rules governing conservation and change.</article-title>             <source>Development</source>             <volume>12</volume>             <fpage>949</fpage>             <lpage>58</lpage>          </element-citation></ref><ref id="pcbi.1000090-Moses1"><label>12</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Moses</surname><given-names>AM</given-names></name><name name-style="western"><surname>Pollard</surname><given-names>DA</given-names></name><name name-style="western"><surname>Nix</surname><given-names>DA</given-names></name><name name-style="western"><surname>Iyer</surname><given-names>VN</given-names></name><name name-style="western"><surname>Li</surname><given-names>XY</given-names></name><etal/></person-group>             <year>2006</year>             <article-title>Large-scale turnover of functional transcription factor binding sites in Drosophila.</article-title>             <source>PLoS Comput Biol</source>             <volume>2</volume>             <fpage>e130</fpage>          </element-citation></ref><ref id="pcbi.1000090-Ludwig3"><label>13</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Ludwig</surname><given-names>MZ</given-names></name><name name-style="western"><surname>Bergman</surname><given-names>CM</given-names></name><name name-style="western"><surname>Patel</surname><given-names>NH</given-names></name><name name-style="western"><surname>Kreitman</surname><given-names>M</given-names></name></person-group>             <year>2000</year>             <article-title>Evidence for stabilizing selection in a eukaryotic enhancer element.</article-title>             <source>Nature</source>             <volume>403</volume>             <fpage>564</fpage>             <lpage>567</lpage>          </element-citation></ref><ref id="pcbi.1000090-Blanchette2"><label>14</label><element-citation publication-type="other" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Blanchette</surname><given-names>M</given-names></name><name name-style="western"><surname>Kwong</surname><given-names>S</given-names></name><name name-style="western"><surname>Tompa</surname><given-names>M</given-names></name></person-group>             <year>2003</year>             <article-title>An empirical comparison of tools for phylogenetic footprinting.</article-title>             <source>BIBE '03: Proceedings of the 3rd IEEE Symposium on BioInformatics and BioEngineering</source>             <publisher-loc>Washington, DC, USA</publisher-loc>             <publisher-name>IEEE Computer Society</publisher-name>             <fpage>69</fpage>          </element-citation></ref><ref id="pcbi.1000090-Blanchette3"><label>15</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Blanchette</surname><given-names>M</given-names></name><name name-style="western"><surname>Tompa</surname><given-names>M</given-names></name></person-group>             <year>2003</year>             <article-title>FootPrinter: A program designed for phylogenetic footprinting.</article-title>             <source>Nucleic Acids Res</source>             <volume>31</volume>             <fpage>3840</fpage>             <lpage>3842</lpage>          </element-citation></ref><ref id="pcbi.1000090-Dubchak1"><label>16</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Dubchak</surname><given-names>I</given-names></name><name name-style="western"><surname>Ryaboy</surname><given-names>DV</given-names></name></person-group>             <year>2006</year>             <article-title>VISTA family of computational tools for comparative analysis of DNA sequences and whole genomes.</article-title>             <source>Methods Mol Biol</source>             <volume>338</volume>             <fpage>69</fpage>             <lpage>89</lpage>          </element-citation></ref><ref id="pcbi.1000090-Sandelin1"><label>17</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Sandelin</surname><given-names>A</given-names></name><name name-style="western"><surname>Wasserman</surname><given-names>WW</given-names></name><name name-style="western"><surname>Lenhard</surname><given-names>B</given-names></name></person-group>             <year>2004</year>             <article-title>ConSite: web-based prediction of regulatory elements using cross-species comparison.</article-title>             <source>Nucleic Acids Res</source>             <volume>32</volume>             <fpage>249</fpage>             <lpage>252</lpage>          </element-citation></ref><ref id="pcbi.1000090-Benos1"><label>18</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Benos</surname><given-names>PV</given-names></name><name name-style="western"><surname>Corcoran</surname><given-names>DL</given-names></name><name name-style="western"><surname>Feingold</surname><given-names>E</given-names></name></person-group>             <year>2007</year>             <article-title>Web-Based Identification of Evolutionary Conserved DNA cis-Regulatory Elements.</article-title>             <source>Methods Mol Biol</source>             <volume>395</volume>             <fpage>425</fpage>             <lpage>436</lpage>          </element-citation></ref><ref id="pcbi.1000090-Kantorovitz1"><label>19</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Kantorovitz</surname><given-names>MR</given-names></name><name name-style="western"><surname>Robinson</surname><given-names>GE</given-names></name><name name-style="western"><surname>Sinha</surname><given-names>S</given-names></name></person-group>             <year>2007</year>             <article-title>A statistical method for alignment-free comparison of regulatory sequences.</article-title>             <source>Bioinformatics</source>             <volume>23</volume>             <fpage>i249</fpage>             <lpage>55</lpage>          </element-citation></ref><ref id="pcbi.1000090-Moses2"><label>20</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Moses</surname><given-names>AM</given-names></name><name name-style="western"><surname>Chiang</surname><given-names>DY</given-names></name><name name-style="western"><surname>Eisen</surname><given-names>MB</given-names></name></person-group>             <year>2004</year>             <article-title>Phylogenetic motif detection by expectation-maximization on evolutionary mixtures.</article-title>             <source>Pac Symp Biocomput</source>             <fpage>324</fpage>             <lpage>35</lpage>          </element-citation></ref><ref id="pcbi.1000090-Moses3"><label>21</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Moses</surname><given-names>AM</given-names></name><name name-style="western"><surname>Chiang</surname><given-names>DY</given-names></name><name name-style="western"><surname>Pollard</surname><given-names>DA</given-names></name><name name-style="western"><surname>N</surname><given-names>IV</given-names></name><name name-style="western"><surname>Eisen</surname><given-names>MB</given-names></name></person-group>             <year>2004</year>             <article-title>Monkey: Identifying conserved transcription-factor binding sites in multiple alignments using a binding site-specific evolutionary model.</article-title>             <source>Genome Biol</source>             <volume>5</volume>             <fpage>R98</fpage>          </element-citation></ref><ref id="pcbi.1000090-Huang1"><label>22</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Huang</surname><given-names>W</given-names></name><name name-style="western"><surname>Nevins</surname><given-names>JR</given-names></name><name name-style="western"><surname>Ohler</surname><given-names>U</given-names></name></person-group>             <year>2007</year>             <article-title>Phylogenetic Simulation of Promoter Evolution: Estimation and Modeling of Binding Site Turnover Events and Assessing Their Impact on Alignment Tools.</article-title>             <source>Genome Biol</source>             <volume>8</volume>             <fpage>R225</fpage>          </element-citation></ref><ref id="pcbi.1000090-Siepel3"><label>23</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Siepel</surname><given-names>A</given-names></name><name name-style="western"><surname>Pollard</surname><given-names>KS</given-names></name><name name-style="western"><surname>Haussler</surname><given-names>D</given-names></name></person-group>             <year>2006</year>             <article-title>New methods for detecting lineage-specific selection.</article-title>             <source>Lecture Notes in Computer Science</source>             <volume>3909</volume>          </element-citation></ref><ref id="pcbi.1000090-Margulies1"><label>24</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Margulies</surname><given-names>EH</given-names></name><name name-style="western"><surname>Blanchette</surname><given-names>M</given-names></name><name name-style="western"><surname>Haussler</surname><given-names>D</given-names></name><name name-style="western"><surname>Green</surname><given-names>ED</given-names></name></person-group>             <year>2003</year>             <article-title>Identification and characterization of multi-species conserved sequences.</article-title>             <source>Genome Res</source>             <volume>13</volume>             <fpage>2507</fpage>             <lpage>2518</lpage>          </element-citation></ref><ref id="pcbi.1000090-Engelhardt1"><label>25</label><element-citation publication-type="other" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Engelhardt</surname><given-names>BE</given-names></name><name name-style="western"><surname>Jordan</surname><given-names>MI</given-names></name><name name-style="western"><surname>Brenner</surname><given-names>SE</given-names></name></person-group>             <year>2006</year>             <article-title>A graphical model for predicting protein molecular function.</article-title>             <person-group person-group-type="editor"><name name-style="western"><surname>Cohen</surname><given-names>WW</given-names></name><name name-style="western"><surname>Moore</surname><given-names>A</given-names></name></person-group>             <source>Proceedings of the Twenty-Third International Conference (ICML 2006), Pittsburgh, Pennsylvania, USA, June 25–29, 2006</source>             <publisher-name>ACM</publisher-name>             <fpage>297</fpage>             <lpage>304</lpage>          </element-citation></ref><ref id="pcbi.1000090-Jukes1"><label>26</label><element-citation publication-type="other" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Jukes</surname><given-names>TH</given-names></name><name name-style="western"><surname>Cantor</surname><given-names>CR</given-names></name></person-group>             <year>1969</year>             <article-title>Evolution of protein molecules.</article-title>             <person-group person-group-type="editor"><name name-style="western"><surname>Munro</surname><given-names>HN</given-names></name></person-group>             <source>Mammalian Protein Metabolism</source>             <publisher-loc>New York</publisher-loc>             <publisher-name>Academic Press</publisher-name>             <fpage>21</fpage>             <lpage>32</lpage>          </element-citation></ref><ref id="pcbi.1000090-Felsenstein1"><label>27</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Felsenstein</surname><given-names>J</given-names></name></person-group>             <year>1981</year>             <article-title>Evolutionary trees from DNA sequences: a maximum likelihood approach.</article-title>             <source>J Mol Evol</source>             <volume>17</volume>             <fpage>368</fpage>             <lpage>76</lpage>          </element-citation></ref><ref id="pcbi.1000090-Sinha2"><label>28</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Sinha</surname><given-names>S</given-names></name><name name-style="western"><surname>van Nimwegen</surname><given-names>E</given-names></name><name name-style="western"><surname>Siggia</surname><given-names>ED</given-names></name></person-group>             <year>2003</year>             <article-title>A probabilistic method to detect regulatory modules.</article-title>             <source>Bioinformatics</source>             <volume>19</volume><supplement>Suppl 1</supplement>             <fpage>292</fpage>             <lpage>301</lpage>          </element-citation></ref><ref id="pcbi.1000090-Felsenstein2"><label>29</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Felsenstein</surname><given-names>J</given-names></name><name name-style="western"><surname>Churchill</surname><given-names>GA</given-names></name></person-group>             <year>1996</year>             <article-title>A Hidden Markov Model approach to variation among sites in rate of evolution.</article-title>             <source>Mol Biol Evol</source>             <volume>13</volume>             <fpage>93</fpage>             <lpage>104</lpage>          </element-citation></ref><ref id="pcbi.1000090-Felsenstein3"><label>30</label><element-citation publication-type="other" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Felsenstein</surname><given-names>J</given-names></name></person-group>             <year>2001</year>             <source>Inferring Phylogenies</source>             <publisher-name>Sinauer</publisher-name>          </element-citation></ref><ref id="pcbi.1000090-Cowell1"><label>31</label><element-citation publication-type="other" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Cowell</surname><given-names>RG</given-names></name><name name-style="western"><surname>Lauritzen</surname><given-names>SL</given-names></name><name name-style="western"><surname>Spiegelhater</surname><given-names>DJ</given-names></name></person-group>             <year>2005</year>             <source>Probabilistic Networks and Expert Systems</source>             <publisher-name>Springer</publisher-name>          </element-citation></ref><ref id="pcbi.1000090-Xing1"><label>32</label><element-citation publication-type="other" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Xing</surname><given-names>EP</given-names></name><name name-style="western"><surname>Jordan</surname><given-names>MI</given-names></name><name name-style="western"><surname>Russell</surname><given-names>S</given-names></name></person-group>             <year>2003</year>             <article-title>A generalized mean field algorithm for variational inference in exponential families.</article-title>             <source>Proceedings of the 19th Annual Conference on Uncertainty in AI</source>          </element-citation></ref><ref id="pcbi.1000090-Xing2"><label>33</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Xing</surname><given-names>EP</given-names></name><name name-style="western"><surname>Wu</surname><given-names>W</given-names></name><name name-style="western"><surname>Jordan</surname><given-names>MI</given-names></name><name name-style="western"><surname>Karp</surname><given-names>RM</given-names></name></person-group>             <year>2003</year>             <article-title>LOGOS: a modular Bayesian model for de novo motif detection.</article-title>             <source>Proc IEEE Comput Soc Bioinform Conf</source>             <volume>2</volume>             <fpage>266</fpage>             <lpage>276</lpage>          </element-citation></ref><ref id="pcbi.1000090-Frith1"><label>34</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Frith</surname><given-names>MC</given-names></name><name name-style="western"><surname>Spouge</surname><given-names>JL</given-names></name><name name-style="western"><surname>Hansen</surname><given-names>U</given-names></name><name name-style="western"><surname>Weng</surname><given-names>Z</given-names></name></person-group>             <year>2002</year>             <article-title>Statistical significance of clusters of motifs represented by position specific scoring matrices in nucleotide sequences.</article-title>             <source>Nucleic Acids Research</source>             <volume>30</volume>             <fpage>3214</fpage>             <lpage>3224</lpage>          </element-citation></ref><ref id="pcbi.1000090-Boutilier1"><label>35</label><element-citation publication-type="other" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Boutilier</surname><given-names>C</given-names></name><name name-style="western"><surname>Friedman</surname><given-names>N</given-names></name><name name-style="western"><surname>Goldszmidt</surname><given-names>M</given-names></name><name name-style="western"><surname>Koller</surname><given-names>D</given-names></name></person-group>             <year>1996</year>             <article-title>Context-specific independence in Bayesian networks.</article-title>             <source>Uncertainty in Artificial Intelligence</source>             <fpage>115</fpage>             <lpage>123</lpage>          </element-citation></ref><ref id="pcbi.1000090-Olsen1"><label>36</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Olsen</surname><given-names>GJ</given-names></name><name name-style="western"><surname>Matsuda</surname><given-names>H</given-names></name><name name-style="western"><surname>Hagstrom</surname><given-names>R</given-names></name><name name-style="western"><surname>Overbeek</surname><given-names>R</given-names></name></person-group>             <year>1994</year>             <article-title>fastDNAmL: a tool for construction of phylogenetic trees of DNA sequences using maximum likelihood.</article-title>             <source>Comput Appl Biosci</source>             <volume>10</volume>             <fpage>41</fpage>             <lpage>8</lpage>          </element-citation></ref><ref id="pcbi.1000090-Tompa1"><label>37</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Tompa</surname><given-names>M</given-names></name><name name-style="western"><surname>Li</surname><given-names>N</given-names></name><name name-style="western"><surname>Bailey</surname><given-names>TL</given-names></name><name name-style="western"><surname>Church</surname><given-names>GM</given-names></name><name name-style="western"><surname>Moor</surname><given-names>BD</given-names></name><etal/></person-group>             <year>2005</year>             <article-title>Assessing computational tools for the discovery of transcription factor binding sites.</article-title>             <source>Nat Biotechnol</source>             <volume>23</volume>             <fpage>137</fpage>             <lpage>44</lpage>          </element-citation></ref><ref id="pcbi.1000090-Papatsenko1"><label>38</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Papatsenko</surname><given-names>DA</given-names></name><name name-style="western"><surname>Makeev</surname><given-names>VJ</given-names></name><name name-style="western"><surname>Lifanov</surname><given-names>AP</given-names></name><name name-style="western"><surname>Regnier</surname><given-names>M</given-names></name><name name-style="western"><surname>Nazina</surname><given-names>AG</given-names></name><etal/></person-group>             <year>2002</year>             <article-title>Extraction of functional binding sites from unique regulatory regions: the Drosophila early developmental enhancers.</article-title>             <source>Genome Res</source>             <volume>12</volume>             <fpage>470</fpage>             <lpage>481</lpage>          </element-citation></ref><ref id="pcbi.1000090-Bergman1"><label>39</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Bergman</surname><given-names>C</given-names></name></person-group>             <year>2005</year>             <article-title>Drosophila DNase I footprint database: a systematic genome annotation of transcription factor binding sites in the fruitfly, Drosophila melanogaster.</article-title>             <source>Bioinformatics</source>             <volume>21</volume>             <fpage>1747</fpage>             <lpage>1749</lpage>          </element-citation></ref><ref id="pcbi.1000090-FlybaseConsortium1"><label>40</label><element-citation publication-type="journal" xlink:type="simple">             <collab xlink:type="simple">FlybaseConsortium</collab>             <year>2003</year>             <article-title>The FlyBase Database of the Drosophila Genome Projects and community literature.</article-title>             <source>Nucleic Acids Research</source>             <volume>31</volume>             <fpage>172</fpage>             <lpage>175</lpage>          </element-citation></ref><ref id="pcbi.1000090-Montgomery1"><label>41</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Montgomery</surname><given-names>SB</given-names></name><name name-style="western"><surname>Griffith</surname><given-names>OL</given-names></name><name name-style="western"><surname>Sleumer</surname><given-names>MC</given-names></name><name name-style="western"><surname>Bergman</surname><given-names>CM</given-names></name><name name-style="western"><surname>Bilenky</surname><given-names>M</given-names></name><etal/></person-group>             <year>2006</year>             <article-title>Oreganno: an open access database and curation system for literature-derived promoters, transcription factor binding sites and regulatory variation.</article-title>             <source>Bioinformatics</source>             <volume>22</volume>             <fpage>637</fpage>             <lpage>640</lpage>          </element-citation></ref><ref id="pcbi.1000090-Bergman2"><label>42</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Bergman</surname><given-names>CM</given-names></name><name name-style="western"><surname>Carlson</surname><given-names>SE</given-names></name><name name-style="western"><surname>Joseph</surname><given-names>W</given-names></name><name name-style="western"><surname>Celniker</surname></name></person-group>             <year>2005</year>             <article-title>Drosophila dnase i footprint database:a systematic genome annotation of transcription factor binding sites in the fruitfly, drosophila melanogaster.</article-title>             <source>Bioinformatics</source>             <volume>21</volume>             <fpage>1747</fpage>             <lpage>1749</lpage>          </element-citation></ref><ref id="pcbi.1000090-Crooks1"><label>43</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Crooks</surname><given-names>GE</given-names></name><name name-style="western"><surname>Hon</surname><given-names>G</given-names></name><name name-style="western"><surname>Chandonia</surname><given-names>JM</given-names></name><name name-style="western"><surname>Brenner</surname><given-names>SE</given-names></name></person-group>             <year>2004</year>             <article-title>WebLogo: A Sequence Logo Generator.</article-title>             <source>Genome Res</source>             <volume>14</volume>             <fpage>1188</fpage>             <lpage>1190</lpage>          </element-citation></ref><ref id="pcbi.1000090-Hasegawa1"><label>44</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Hasegawa</surname><given-names>M</given-names></name><name name-style="western"><surname>Kishino</surname><given-names>H</given-names></name><name name-style="western"><surname>Yano</surname><given-names>T</given-names></name></person-group>             <year>1985</year>             <article-title>Dating of the human-ape splitting by a molecular clock of mitochondrial DNA.</article-title>             <source>J Mol Evol</source>             <volume>22</volume>             <fpage>160</fpage>             <lpage>74</lpage>          </element-citation></ref></ref-list></back></article>