<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article
  PUBLIC "-//NLM//DTD Journal Publishing DTD v3.0 20080202//EN" "http://dtd.nlm.nih.gov/publishing/3.0/journalpublishing3.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="3.0" xml:lang="EN">
    <front>
        <journal-meta><journal-id journal-id-type="publisher-id">plos</journal-id><journal-id journal-id-type="nlm-ta">PLoS Comput Biol</journal-id><journal-id journal-id-type="pmc">ploscomp</journal-id><!--===== Grouping journal title elements =====--><journal-title-group><journal-title>PLoS Computational Biology</journal-title></journal-title-group><issn pub-type="ppub">1553-734X</issn><issn pub-type="epub">1553-7358</issn><publisher>
                <publisher-name>Public Library of Science</publisher-name>
                <publisher-loc>San Francisco, USA</publisher-loc>
            </publisher></journal-meta>
        <article-meta><article-id pub-id-type="publisher-id">07-PLCB-RA-0709R2</article-id><article-id pub-id-type="doi">10.1371/journal.pcbi.1000379</article-id><article-categories>
                <subj-group subj-group-type="heading">
                    <subject>Research Article</subject>
                </subj-group>
                <subj-group subj-group-type="Discipline">
                    <subject>Biophysics/Experimental Biophysical Methods</subject>
                    <subject>Biophysics/Theory and Simulation</subject>
                    <subject>Computational Biology/Computational Neuroscience</subject>
                    <subject>Neuroscience/Theoretical Neuroscience</subject>
                    <subject>Physiology/Neuronal Signaling Mechanisms</subject>
                </subj-group>
            </article-categories><title-group><article-title>Smoothing of, and Parameter Estimation from, Noisy Biophysical
                    Recordings</article-title><alt-title alt-title-type="running-head">Smoothing Biophysical Data</alt-title></title-group><contrib-group>
                <contrib contrib-type="author" xlink:type="simple">
                    <name name-style="western">
                        <surname>Huys</surname>
                        <given-names>Quentin J. M.</given-names>
                    </name>
                    <xref ref-type="aff" rid="aff1">
                        <sup>1</sup>
                    </xref>
                    <xref ref-type="aff" rid="aff2">
                        <sup>2</sup>
                    </xref>
                    <xref ref-type="corresp" rid="cor1">
                        <sup>*</sup>
                    </xref>
                </contrib>
                <contrib contrib-type="author" xlink:type="simple">
                    <name name-style="western">
                        <surname>Paninski</surname>
                        <given-names>Liam</given-names>
                    </name>
                    <xref ref-type="aff" rid="aff2">
                        <sup>2</sup>
                    </xref>
                    <xref ref-type="aff" rid="aff3">
                        <sup>3</sup>
                    </xref>
                </contrib>
            </contrib-group><aff id="aff1">
                <label>1</label>
                <addr-line>Gatsby Computational Neuroscience Unit, University College London,
                    London, United Kingdom</addr-line>
            </aff><aff id="aff2">
                <label>2</label>
                <addr-line>Center for Theoretical Neuroscience, Columbia University, New York, New
                    York, United States of America</addr-line>
            </aff><aff id="aff3">
                <label>3</label>
                <addr-line>Statistics Department, Columbia University, New York, New York, United
                    States of America</addr-line>
            </aff><contrib-group>
                <contrib contrib-type="editor" xlink:type="simple">
                    <name name-style="western">
                        <surname>Friston</surname>
                        <given-names>Karl J.</given-names>
                    </name>
                    <role>Editor</role>
                    <xref ref-type="aff" rid="edit1"/>
                </contrib>
            </contrib-group><aff id="edit1">University College London, United Kingdom</aff><author-notes>
                <corresp id="cor1">* E-mail: <email xlink:type="simple">qhuys@cantab.net</email></corresp>
                <fn fn-type="con">
                    <p>Conceived and designed the experiments: QJH LP. Performed the experiments:
                        QJH LP. Analyzed the data: QJH LP. Wrote the paper: QJH LP.</p>
                </fn>
            <fn fn-type="conflict">
                <p>The authors have declared that no competing interests exist.</p>
            </fn></author-notes><pub-date pub-type="collection">
                <month>5</month>
                <year>2009</year>
            </pub-date><pub-date pub-type="epub">
                <day>8</day>
                <month>5</month>
                <year>2009</year>
            </pub-date><volume>5</volume><issue>5</issue><elocation-id>e1000379</elocation-id><history>
                <date date-type="received">
                    <day>15</day>
                    <month>11</month>
                    <year>2007</year>
                </date>
                <date date-type="accepted">
                    <day>1</day>
                    <month>4</month>
                    <year>2009</year>
                </date>
            </history><!--===== Grouping copyright info into permissions =====--><permissions><copyright-year>2009</copyright-year><copyright-holder>Huys, Paninski</copyright-holder><license><license-p>This is an open-access article distributed under
                the terms of the Creative Commons Attribution License, which permits unrestricted
                use, distribution, and reproduction in any medium, provided the original author and
                source are credited.</license-p></license></permissions><abstract>
                <p>Biophysically detailed models of single cells are difficult to fit to real data.
                    Recent advances in imaging techniques allow simultaneous access to various
                    intracellular variables, and these data can be used to significantly facilitate
                    the modelling task. These data, however, are noisy, and current approaches to
                    building biophysically detailed models are not designed to deal with this. We
                    extend previous techniques to take the noisy nature of the measurements into
                    account. Sequential Monte Carlo (“particle filtering”)
                    methods, in combination with a detailed biophysical description of a cell, are
                    used for principled, model-based smoothing of noisy recording data. We also
                    provide an alternative formulation of smoothing where the neural nonlinearities
                    are estimated in a non-parametric manner. Biophysically important parameters of
                    detailed models (such as channel densities, intercompartmental conductances,
                    input resistances, and observation noise) are inferred automatically from noisy
                    data via expectation-maximisation. Overall, we find that model-based smoothing
                    is a powerful, robust technique for smoothing of noisy biophysical data and for
                    inference of biophysical parameters in the face of recording noise.</p>
            </abstract><abstract abstract-type="summary">
                <title>Author Summary</title>
                <p>Cellular imaging techniques are maturing at a great pace, but are still plagued
                    by high levels of noise. Here, we present two methods for smoothing individual,
                    noisy traces. The first method fits a full, biophysically accurate description
                    of the cell under study to the noisy data. This allows both smoothing of the
                    data and inference of biophysically relevant parameters such as the density of
                    (active) channels, input resistance, intercompartmental conductances, and noise
                    levels; it does, however, depend on knowledge of active channel kinetics. The
                    second method achieves smoothing of noisy traces by fitting arbitrary kinetics
                    in a non-parametric manner. Both techniques can additionally be used to infer
                    unobserved variables, for instance voltage from calcium concentration. This
                    paper gives a detailed account of the methods and should allow for
                    straightforward modification and inclusion of additional measurements.</p>
            </abstract><funding-group><funding-statement>QH: Gatsby Charitable Foundation, UCL Bogue Fellowship, Swartz Foundation; LP:
                    NSF Career Award and Alfred P. Sloan Research Fellowship. The funders had no
                    role in study design, data collection and analysis, decision to publish, or
                    preparation of the manuscript.</funding-statement></funding-group><counts>
                <page-count count="16"/>
            </counts></article-meta>
    </front>
    <body>
        <sec id="s1">
            <title>Introduction</title>
            <p>Recent advances in imaging techniques allow measurements of time-varying biophysical
                quantities of interest at high spatial and temporal resolution. For example,
                voltage-sensitive dye imaging allows the observation of the backpropagation of
                individual action potentials up the dendritic tree <xref ref-type="bibr" rid="pcbi.1000379-Chien1">[1]</xref>–<xref ref-type="bibr" rid="pcbi.1000379-Stuart1">[6]</xref>. Calcium
                imaging techniques similarly allow imaging of synaptic events in individual
                synapses. Such data are very well-suited to constrain biophysically detailed models
                of single cells. Both the dimensionality of the parameter space and the noisy and
                (temporally and spatially) undersampled nature of the observed data renders the use
                of statistical techniques desirable. Here, we here use sequential Monte Carlo
                methods (“particle filtering”) <xref ref-type="bibr" rid="pcbi.1000379-Doucet1">[7]</xref>,<xref ref-type="bibr" rid="pcbi.1000379-Douc1">[8]</xref>—a standard
                machine-learning approach to hidden dynamical systems estimation—to
                automatically smooth the noisy data. In a first step, we will do this while
                inferring biophysically detailed models; in a second step, by inferring
                non-parametric models of the cellular nonlinearities.</p>
            <p>Given the laborious nature of building biophysically detailed cellular models by hand
                    <xref ref-type="bibr" rid="pcbi.1000379-Traub1">[9]</xref>–<xref ref-type="bibr" rid="pcbi.1000379-Schaefer1">[11]</xref>, there has long been
                a strong emphasis on robust automatic methods <xref ref-type="bibr" rid="pcbi.1000379-Bhalla1">[12]</xref>–<xref ref-type="bibr" rid="pcbi.1000379-Achard1">[19]</xref>.
                Large-scale efforts (e.g. <ext-link ext-link-type="uri" xlink:href="http://microcircuit.epfl.ch" xlink:type="simple">http://microcircuit.epfl.ch</ext-link>)
                have added to the need for such methods and yielded exciting advances. The
                Neurofitter <xref ref-type="bibr" rid="pcbi.1000379-Geit1">[20]</xref> package, for example, provides tight integration with
                a number of standard simulation tools; implements a large number of search methods;
                and uses a combination of a wide variety of cost functions to measure the quality of
                a model's fit to the data. These are, however, highly complex approaches
                that, while extremely flexible, arguably make optimal use neither of the richness of
                the structure present in the statistical problem nor of the richness of new data
                emerging from imaging techniques. In the past, it has been shown by us and others
                    <xref ref-type="bibr" rid="pcbi.1000379-Bush1">[18]</xref>,
                    <xref ref-type="bibr" rid="pcbi.1000379-Morse1">[21]</xref>–<xref ref-type="bibr" rid="pcbi.1000379-Huys1">[23]</xref> that knowledge of the
                true transmembrane voltage decouples a number of fundamental parameters, allowing
                simultaneous estimation of the spatial distribution of multiple kinetically
                differing conductances; of intercompartmental conductances; and of time-varying
                synaptic input. Importantly, this inference problem has the form of a constrained
                linear regression with a single, global optimum for all these parameters given the
                data.</p>
            <p>None of these approaches, however, at present take the various noise sources (channel
                noise, unobserved variables etc.) in recording situations explicitly into account.
                Here, we extend the findings from <xref ref-type="bibr" rid="pcbi.1000379-Huys1">[23]</xref>, applying standard inference procedures to
                well-founded statistical descriptions of the recording situations in the hope that
                this more specifically tailored approach will provide computationally cheaper, more
                flexible, robust solutions, and that a probabilistic approach will allow noise to be
                addressed in a principled manner.</p>
            <p>Specifically, we approach the issue of noisy observations and interpolation of
                undersampled data first in a model-based, and then in a model-free setting. We start
                by exploring how an accurate description of a cell can be used for optimal
                de-noising and to infer unobserved variables, such as Ca<sup>2+</sup>
                concentration from voltage. We then proceed to show how an accurate model of a cell
                can be inferred from the noisy signals in the first place; this relies on using
                model-based smoothing as the first step of a standard, two-step, iterative machine
                learning algorithm known as Expectation-Maximisation <xref ref-type="bibr" rid="pcbi.1000379-Dempster1">[24]</xref>,<xref ref-type="bibr" rid="pcbi.1000379-MacKay1">[25]</xref>. The
                “Maximisation” step here turns out to be a weighted version of
                our previous regression-based inference method, which assumed exact knowledge of the
                biophysical signals.</p>
            <sec id="s1a">
                <title>Overview</title>
                <p>The aim of this paper is to fit biophysically detailed models to noisy
                    electrophysiological or imaging data. We first give an overview of the kinds of
                    models we consider; which parameters in those models we seek to infer; how this
                    inference is affected by the noise inherent in the measurements; and how
                    standard machine learning techniques can be applied to this inference problem.
                    The overview will be couched in terms of voltage measurements, but we later also
                    consider measurements of calcium concentrations.</p>
                <sec id="s1a1">
                    <title>Compartmental models</title>
                    <p>Compartmental models are spatially discrete approximations to the cable
                        equation <xref ref-type="bibr" rid="pcbi.1000379-Baldi1">[13]</xref>,<xref ref-type="bibr" rid="pcbi.1000379-Koch1">[26]</xref>,<xref ref-type="bibr" rid="pcbi.1000379-Dayan1">[27]</xref>
                        and allow the temporal evolution of a compartment's voltage to be
                        written as<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e001" xlink:type="simple"/><label>(1)</label></disp-formula>where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e002" xlink:type="simple"/></inline-formula> is the voltage in compartment <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e003" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e004" xlink:type="simple"/></inline-formula> is the specific membrane capacitance, and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e005" xlink:type="simple"/></inline-formula> is current evolution noise (here assumed to be white and
                        Gaussian). Note the important factor <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e006" xlink:type="simple"/></inline-formula> which ensures that the noise variance grows linearly with
                        time <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e007" xlink:type="simple"/></inline-formula>. The currents <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e008" xlink:type="simple"/></inline-formula> we will consider here are of three types:</p>
                    <list list-type="bullet">
                        <list-item>
                            <p>Axial currents along dendrites<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e009" xlink:type="simple"/><label>(2)</label></disp-formula></p>
                        </list-item>
                        <list-item>
                            <p>Transmembrane currents from active (voltage-dependent), passive, or
                                other (e.g. Ca<sup>2+</sup> -dependent) membrane conductances<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e010" xlink:type="simple"/><label>(3)</label></disp-formula></p>
                        </list-item>
                        <list-item>
                            <p>Experimentally injected currents<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e011" xlink:type="simple"/><label>(4)</label></disp-formula>where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e012" xlink:type="simple"/></inline-formula> indicates one particular current type
                                (“channel”), <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e013" xlink:type="simple"/></inline-formula> its reversal potential and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e014" xlink:type="simple"/></inline-formula> its maximal conductance in compartment <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e015" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e016" xlink:type="simple"/></inline-formula> is the membrane resistivity and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e017" xlink:type="simple"/></inline-formula> is the current experimentally injected into that
                                compartment. The variable <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e018" xlink:type="simple"/></inline-formula> represents the time-varying open fraction of the
                                conductance, and is typically given by complex, highly nonlinear
                                functions of time and voltage. For example, for the Hodgkin and
                                Huxley (HH) K<sup>+</sup> -channel, the kinetics are given
                                by <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e019" xlink:type="simple"/></inline-formula>, with<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e020" xlink:type="simple"/><label>(5)</label></disp-formula>and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e021" xlink:type="simple"/></inline-formula> themselves nonlinear functions of the voltage
                                    <xref ref-type="bibr" rid="pcbi.1000379-Hodgkin1">[28]</xref> and we again have an additive
                                noise term. In practice, the gate noise is either drawn from a
                                truncated Gaussian, or one can work with the transformed variable <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e022" xlink:type="simple"/></inline-formula>. Similar equations can be formulated for other
                                variables such as the intracellular free Ca<sup>2+</sup>
                                concentration <xref ref-type="bibr" rid="pcbi.1000379-Dayan1">[27]</xref>.</p>
                        </list-item>
                    </list>
                </sec>
                <sec id="s1a2">
                    <title>Noiseless observations</title>
                    <p>A detailed discussion of the case when the voltage is observed approximately
                        noiselessly (such as with a patch-clamp electrode) is presented in <xref ref-type="bibr" rid="pcbi.1000379-Huys1">[23]</xref>
                        (see also <xref ref-type="bibr" rid="pcbi.1000379-Bush1">[18]</xref>,<xref ref-type="bibr" rid="pcbi.1000379-Morse1">[21]</xref>,<xref ref-type="bibr" rid="pcbi.1000379-Wood1">[22]</xref>).
                        We here give a short review over the material on which the present work will
                        build. Let us henceforth assume that all the kinetics (such as <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e023" xlink:type="simple"/></inline-formula>) of all conductances are known. Once the voltage is known,
                        the kinetic equations can be evaluated to yield the open fraction <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e024" xlink:type="simple"/></inline-formula> of each conductance <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e025" xlink:type="simple"/></inline-formula> of interest. We further assume knowledge of the reversal
                        potentials <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e026" xlink:type="simple"/></inline-formula>, although this can be relaxed, and of the membrane
                        specific capacitance <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e027" xlink:type="simple"/></inline-formula> (which is henceforth neglected for notational clarity and
                        fixed at 1 nF/cm<sup>2</sup>; see <xref ref-type="bibr" rid="pcbi.1000379-Roth1">[29]</xref> for a discussion
                        of this assumption).</p>
                    <p>Knowledge of channel kinetics and voltage in each of the cell's
                        compartments allows inference of the linear parameters <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e028" xlink:type="simple"/></inline-formula> and of the noise terms by constrained linear regression
                            <xref ref-type="bibr" rid="pcbi.1000379-Huys1">[23]</xref>. As an example, consider a single-compartment
                        cell containing one active (Hodgkin-Huxley K<sup>+</sup>) and one
                        leak conductance and assume the voltage <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e029" xlink:type="simple"/></inline-formula> has been recorded at sampling intervals <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e030" xlink:type="simple"/></inline-formula> for a time period of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e031" xlink:type="simple"/></inline-formula>. Let <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e032" xlink:type="simple"/></inline-formula> be the number of data points and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e033" xlink:type="simple"/></inline-formula> index them successively <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e034" xlink:type="simple"/></inline-formula>:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e035" xlink:type="simple"/><label>(6)</label></disp-formula>where we see that only <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e036" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e037" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e038" xlink:type="simple"/></inline-formula> are now unknown; that they mediate the linear relationship
                        between <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e039" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e040" xlink:type="simple"/></inline-formula>; and that these parameters can be concatenated into a
                        vector <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e041" xlink:type="simple"/></inline-formula> as illustrated in equation 6. The maximum likelihood (ML)
                        estimate of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e042" xlink:type="simple"/></inline-formula> (in vectorized form) and of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e043" xlink:type="simple"/></inline-formula> are given by<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e044" xlink:type="simple"/><label>(7)</label></disp-formula><disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e045" xlink:type="simple"/><label>(8)</label></disp-formula>where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e046" xlink:type="simple"/></inline-formula>. Note that the last equality in equation 7 expresses the
                        solution of the model fitting problem as a quadratic minimization with
                        linear constraints on the parameters and is straightforwardly performed with
                        standard packages such as quadprog.m in Matlab. The quadratic log-likelihood
                        in equation 7 and therefore the linear form of the regression depends on the
                        assumption that the evolution noise <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e047" xlink:type="simple"/></inline-formula> of the observed variable in equation 6 is Gaussian white
                        noise. Parameters that can be simultaneously inferred in this manner from
                        the true voltage trace are <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e048" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e049" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e050" xlink:type="simple"/></inline-formula>, time-varying synaptic input strengths and the evolution
                        noise variances <xref ref-type="bibr" rid="pcbi.1000379-Huys1">[23]</xref>.</p>
                    <p>In the following, we will write all the dynamical equations as simultaneous equations<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e051" xlink:type="simple"/><label>(9)</label></disp-formula>where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e052" xlink:type="simple"/></inline-formula> is the evolution noise variance of the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e053" xlink:type="simple"/></inline-formula> dynamic variable, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e054" xlink:type="simple"/></inline-formula> if <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e055" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e056" xlink:type="simple"/></inline-formula> denotes a vector of independent, identically distributed
                        (iid) random variables. These are Gaussian for unconstrained variables such
                        as the voltage, and drawn from truncated Gaussians for constrained variables
                        such as the gates. For the voltage we have <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e057" xlink:type="simple"/></inline-formula> and we remind ourselves that <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e058" xlink:type="simple"/></inline-formula> is a function of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e059" xlink:type="simple"/></inline-formula> (equation 6).</p>
                </sec>
                <sec id="s1a3">
                    <title>Observation noise</title>
                    <p>Most recording techniques yield estimates of the underlying variable of
                        interest that are much more noisy than the essentially noise-free estimates
                        patch-clamping can provide. Imaging techniques, for example, do not provide
                        access to the true voltage which is necessary for the inference in equation
                        7. <xref ref-type="fig" rid="pcbi-1000379-g001">Figure 1</xref> describes
                        the hidden dynamical system setting that applies to this situation.
                        Crucially, measurements <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e060" xlink:type="simple"/></inline-formula> are instantaneously related to the underlying voltage <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e061" xlink:type="simple"/></inline-formula> by a probabilistic relationship (the turquoise arrows in
                            <xref ref-type="fig" rid="pcbi-1000379-g001">Figure 1</xref>) which is
                        dependent on the recording configuration. Together, the model of the
                        observations, combined with the (Markovian) model of the dynamics given by
                        the compartmental model define the following hidden dynamical system:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e062" xlink:type="simple"/><label>(10)</label></disp-formula><disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e063" xlink:type="simple"/><label>(11)</label></disp-formula>where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e064" xlink:type="simple"/></inline-formula> denotes a Gaussian or truncated Gaussian distribution over <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e065" xlink:type="simple"/></inline-formula> with mean <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e066" xlink:type="simple"/></inline-formula> and variance <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e067" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e068" xlink:type="simple"/></inline-formula> denotes the linear measurement process (in the following
                        simply a linear projection such that <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e069" xlink:type="simple"/></inline-formula> or <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e070" xlink:type="simple"/></inline-formula>). We assume Gaussian noise both for the observations and
                        the voltage; and truncated Gaussian noise for the gates. The Gaussian
                        assumption on the evolution noise for the observed variable allows us to use
                        a simple regression (equation 7) in the inference of the channel densities.
                        Note that although the noise processes are i.i.d., the fact that noise is
                        injected into all gates means that the effective noise in the observations
                        can show strong serial correlations.</p>
                    <fig id="pcbi-1000379-g001" position="float">
                        <object-id pub-id-type="doi">10.1371/journal.pcbi.1000379.g001</object-id>
                        <label>Figure 1</label>
                        <caption>
                            <title>Hidden dynamical system.</title>
                            <p>The dynamical system comprises the <italic>hidden</italic> variables <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e071" xlink:type="simple"/></inline-formula> and evolves as a Markov chain according to the
                                compartmental model and kinetic equations. The dynamical system is
                                hidden, because only noisy measurements of the true voltage are
                                observed. To perform inference, one has to take the observation
                                process <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e072" xlink:type="simple"/></inline-formula> into account. Inference is now possible because
                                the total likelihood of both observed and unobserved quantities
                                given the parameters can be expressed in terms of these two
                                probabilistic relations.</p>
                        </caption>
                        <graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.g001" xlink:type="simple"/>
                    </fig>
                    <p>Importantly, we do not assume that <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e073" xlink:type="simple"/></inline-formula> bas the same dimensionality as <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e074" xlink:type="simple"/></inline-formula>; in a typical cellular setting, there are several
                        unobserved variables per compartment, only one or a few of them being
                        measured. For <xref ref-type="fig" rid="pcbi-1000379-g002">Figure 2</xref>,
                        which illustrates the particle filter for a single-compartment model with
                        leak, Na<sup>+</sup> and K<sup>+</sup> Hodgkin-Huxley
                        conductances, only <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e075" xlink:type="simple"/></inline-formula> is measured, although the hidden variable <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e076" xlink:type="simple"/></inline-formula> is 4-dimensional and includes the three gates for the
                            Na<sup>+</sup> and K<sup>+</sup> channels in the
                        classical Hodgkin-Huxley model. It is, however, possible to have <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e077" xlink:type="simple"/></inline-formula> of dimensionality equal to (or even greater than) <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e078" xlink:type="simple"/></inline-formula>. For example, <xref ref-type="bibr" rid="pcbi.1000379-Canepari1">[5]</xref> simultaneously
                        image voltage- and [Ca<sup>2+</sup>]-sensitive
                        dyes.</p>
                    <fig id="pcbi-1000379-g002" position="float">
                        <object-id pub-id-type="doi">10.1371/journal.pcbi.1000379.g002</object-id>
                        <label>Figure 2</label>
                        <caption>
                            <title>Model-based smoothing.</title>
                            <p>A: Data; generated by adding Gaussian noise
                                    (<italic>σ<sub>O</sub></italic> = 30
                                mV) to the voltage trace and subsampling every seven timesteps
                                (Δ = 0.02 ms and Δ<italic>
                                    <sub>s</sub>
                                </italic> = 0.14 ms). The voltage
                                trace was generated by running the equation 1 for the single
                                compartment with the correct parameters once and adding noise of
                                variance <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e079" xlink:type="simple"/></inline-formula>. B: Voltage paths corresponding to the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e080" xlink:type="simple"/></inline-formula> particles which were run with the correct, known
                                parameters. C: Effective particle number <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e081" xlink:type="simple"/></inline-formula>. As soon as enough particles have
                                ‘drifted’ away from the data (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e082" xlink:type="simple"/></inline-formula> reaches the threshold <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e083" xlink:type="simple"/></inline-formula>), a resampling step eliminates the stray particles
                                (they are reset to a particle with larger weight) all weights are
                                reset to <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e084" xlink:type="simple"/></inline-formula> and the effective number returns to <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e085" xlink:type="simple"/></inline-formula>. D: expected voltage trace <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e086" xlink:type="simple"/></inline-formula> st. dev. in shaded colours. The mean reproduces
                                the underlying voltage trace with high accuracy. E: Conditional
                                expectations for the gates of the particles (mean ±1 st.
                                dev.); blue: HH <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e087" xlink:type="simple"/></inline-formula>; green: HH <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e088" xlink:type="simple"/></inline-formula>; red: HH <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e089" xlink:type="simple"/></inline-formula>. Thus, using model-based smoothing, a highly
                                accurate estimate of the underlying voltage and the gates can be
                                recovered from very noisy, undersampled data.</p>
                        </caption>
                        <graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.g002" xlink:type="simple"/>
                    </fig>
                </sec>
            </sec>
            <sec id="s1b">
                <title>Expectation-Maximisation</title>
                <p>Expectation-Maximisation (EM) is one standard machine-learning technique that
                    allows estimation of parameters in precisely the circumstances just outlined,
                    i.e. where inference depends on unobserved variables and certain expectations
                    can be evaluated. The EM algorithm achieves a local maximisation of the data
                    likelihood by iterating over two steps. For the case where voltage is recorded,
                    it consists of:</p>
                <list list-type="order">
                    <list-item>
                        <p><bold>Expectation step</bold> (E-Step): The parameters are fixed at their
                            current estimate <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e090" xlink:type="simple"/></inline-formula>; based on this (initally inaccurate) parameter
                            setting, the conditional distribution of the hidden variables <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e091" xlink:type="simple"/></inline-formula> (where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e092" xlink:type="simple"/></inline-formula> are all the observations) is inferred. This
                            effectively amounts to model-based smoothing of the noisy data and will
                            be discussed in the first part of the paper.</p>
                    </list-item>
                    <list-item>
                        <p><bold>Maximisation step</bold> (M-Step): Based on the model-based
                            estimate of the hidden variables <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e093" xlink:type="simple"/></inline-formula>, a new estimate of the parameters <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e094" xlink:type="simple"/></inline-formula> is inferred, such that it maximises the expected joint
                            log likelihood of the observations and the inferred distribution over
                            the unobserved variables. This procedure is a generalisation of
                            parameter inference in the case mentioned in equation 7, where the
                            voltage was observed noiselessly.</p>
                    </list-item>
                </list>
                <p>The EM algorithm can be shown to increase the likelihood of the parameters at
                    each iteration <xref ref-type="bibr" rid="pcbi.1000379-Dempster1">[24]</xref>,<xref ref-type="bibr" rid="pcbi.1000379-MacKay1">[25]</xref>,<xref ref-type="bibr" rid="pcbi.1000379-Roweis1">[30]</xref>,<xref ref-type="bibr" rid="pcbi.1000379-Salakhutdinov1">[31]</xref>, and will
                    typically converge to a local maximum. Although in combination with the
                    Monte-Carlo estimation these guarantees no longer hold, in practice, we have
                    never encountered nonglobal optima.</p>
            </sec>
        </sec>
        <sec id="s2">
            <title>Methods</title>
            <sec id="s2a">
                <title>Model-based smoothing</title>
                <p>We first assume that the true parameters <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e095" xlink:type="simple"/></inline-formula> are known, and in the E-step infer the conditional marginal
                    distributions <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e096" xlink:type="simple"/></inline-formula> for all times <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e097" xlink:type="simple"/></inline-formula>. The conditional mean <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e098" xlink:type="simple"/></inline-formula> is a model-based, smoothed estimate of the true underlying
                    signal <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e099" xlink:type="simple"/></inline-formula> at each point in time <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e100" xlink:type="simple"/></inline-formula> which is optimal under mean squared error. The E-step is
                    implemented using standard sequential Monte Carlo techniques <xref ref-type="bibr" rid="pcbi.1000379-Doucet1">[7]</xref>.
                    Here we present the detailed equations as applied to noisy recordings of
                    cellular dynamic variables such as the transmembrane voltage or intracellular
                    calcium concentration.</p>
                <p>The smoothed distribution <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e101" xlink:type="simple"/></inline-formula> is computed via a backward recursion which relies on the
                    filtering distribution <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e102" xlink:type="simple"/></inline-formula>, which in turn is inferred by writing the following recursion
                    (suppressing the dependence on <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e103" xlink:type="simple"/></inline-formula> for clarity):<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e104" xlink:type="simple"/><label>(12)</label></disp-formula>This recursion relies on the fact that the hidden variables are Markovian<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e105" xlink:type="simple"/><label>(13)</label></disp-formula>Based on this, the smoothed distribution, which gives estimates
                    of the hidden variables that incorporate all, not just the past, observations,
                    can then be inferred by starting with <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e106" xlink:type="simple"/></inline-formula> and iterating backwards:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e107" xlink:type="simple"/><label>(14)</label></disp-formula>where all quantities inside the integral are now known.</p>
            </sec>
            <sec id="s2b">
                <title>Sequential Monte Carlo</title>
                <p>The filtering and smoothing equations demand integrals over the hidden variables.
                    In the present case, these integrals are not analytically tractable, because of
                    the complex nonlinearities in the kinetics <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e108" xlink:type="simple"/></inline-formula>. They can, however, be approximated using Sequential Monte
                    Carlo methods. Such methods (also known as “particle
                    filters”) are a special version of importance sampling, in which
                    distributions and expectations are represented by weighted samples <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e109" xlink:type="simple"/></inline-formula><disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e110" xlink:type="simple"/></disp-formula>with <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e111" xlink:type="simple"/></inline-formula>. If samples are drawn from the distribution <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e112" xlink:type="simple"/></inline-formula> directly, the weights <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e113" xlink:type="simple"/></inline-formula>. In the present case, this would mean drawing samples from the
                    distributions <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e114" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e115" xlink:type="simple"/></inline-formula>, which is not possible because they themselves depend on
                    integrals at adjacent timesteps which are hard to evaluate exactly. Instead,
                    importance sampling allows sampling from a different
                    “proposal” distribution <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e116" xlink:type="simple"/></inline-formula> and compensating by setting <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e117" xlink:type="simple"/></inline-formula>. Here, we first seek samples and forward filtering weights <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e118" xlink:type="simple"/></inline-formula> such that<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e119" xlink:type="simple"/><label>(15)</label></disp-formula>and based on these will then derive backwards, smoothing weights
                    such that<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e120" xlink:type="simple"/><label>(16)</label></disp-formula>Substituting the desideratum in equation 15 for time <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e121" xlink:type="simple"/></inline-formula> into equation 12<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e122" xlink:type="simple"/><label>(17)</label></disp-formula>As a proposal distribution for our setting we use the one-step
                    predictive probability distribution (derived from the Markov property in
                    equation 13):<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e123" xlink:type="simple"/><label>(18)</label></disp-formula>where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e124" xlink:type="simple"/></inline-formula> is termed the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e125" xlink:type="simple"/></inline-formula> “particle”. The samples are made to
                    reflect the conditional distribution by adjusting the weights, for which the
                    probabilities <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e126" xlink:type="simple"/></inline-formula> need to be computed. These are given by<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e127" xlink:type="simple"/></disp-formula>which involves a sum over <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e128" xlink:type="simple"/></inline-formula> that is quadratic in <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e129" xlink:type="simple"/></inline-formula>. We approximate this by<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e130" xlink:type="simple"/><label>(19)</label></disp-formula>which neglects the probability that the particle <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e131" xlink:type="simple"/></inline-formula> at time <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e132" xlink:type="simple"/></inline-formula> could in fact have arisen from particle <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e133" xlink:type="simple"/></inline-formula> at time <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e134" xlink:type="simple"/></inline-formula>. The weights for each of the particles are then given by a
                    simple update equation:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e135" xlink:type="simple"/><label>(20)</label></disp-formula><disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e136" xlink:type="simple"/><label>(21)</label></disp-formula></p>
                <p>One well-known consequence of the approximation in equations 19–21 is
                    that over time, the variance of the weights becomes large; this means that most
                    particles have negligible weight, and only one particle is used to represent a
                    whole distribution. Classically, this problem is prevented by resampling, and we
                    here use stratified resampling <xref ref-type="bibr" rid="pcbi.1000379-Douc1">[8]</xref>. This procedure, illustrated in <xref ref-type="fig" rid="pcbi-1000379-g002">Figure 2</xref>, results in
                    eliminating particles that assign little, and duplicating particles that assign
                    large likelihood to the data whenever the effective number of particles <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e137" xlink:type="simple"/></inline-formula> drops below some threshold, here <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e138" xlink:type="simple"/></inline-formula>.</p>
                <p>It should be pointed out that it is also possible to interpolate between
                    observations, or to do learning (see below) from subsampled traces. For example,
                    assume we have a recording frequency of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e139" xlink:type="simple"/></inline-formula> but wish to infer the underlying signal at a higher frequency <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e140" xlink:type="simple"/></inline-formula>, with <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e141" xlink:type="simple"/></inline-formula>. At time points without observation the likelihood term in
                    equation 21 is uninformative (flat) and we therefore set<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e142" xlink:type="simple"/><label>(22)</label></disp-formula>keeping equation 21 for the remainder of times. In this paper, we
                    will run compartmental models (equation 1) at sampling intervals <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e143" xlink:type="simple"/></inline-formula>, and recover signals to that same temporal precision from data
                    subsampled at intervals <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e144" xlink:type="simple"/></inline-formula>. See e.g. <xref ref-type="bibr" rid="pcbi.1000379-Vogelstein1">[32]</xref> for further details on incorporating
                    intermittently-sampled observations into the alternative predictive distribution <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e145" xlink:type="simple"/></inline-formula>.</p>
                <p>We have so far derived the filtering weights such that particles are
                    representative of the distribution conditioned on the past data <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e146" xlink:type="simple"/></inline-formula>. It often is more appropriate to condition on the entire set
                    of measurements, i.e. represent the distribution <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e147" xlink:type="simple"/></inline-formula>. We will see that this is also necessary for the parameter
                    inference in the M-step. Substituting equations 15 and 16 into equation 14, we
                    arrive at the updates for the smoothing weights<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e148" xlink:type="simple"/></disp-formula>where the weights <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e149" xlink:type="simple"/></inline-formula> now represent the joint distribution of the hidden variables
                    at adjacent timesteps:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e150" xlink:type="simple"/></disp-formula></p>
            </sec>
            <sec id="s2c">
                <title>Parameter inference</title>
                <p>The maximum likelihood estimate of the parameters can be inferred via a
                    maximisation of an expectation over the hidden variables:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e151" xlink:type="simple"/></disp-formula>where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e152" xlink:type="simple"/></inline-formula>. This is achieved by iterating over the two steps of the EM
                    algorithm. In the M-step of the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e153" xlink:type="simple"/></inline-formula> iteration, the likelihood of the entire set of measurements <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e154" xlink:type="simple"/></inline-formula> with respect to the parameters <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e155" xlink:type="simple"/></inline-formula> is maximised by maximising the expected total log likelihood
                        <xref ref-type="bibr" rid="pcbi.1000379-MacKay1">[25]</xref><disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e156" xlink:type="simple"/></disp-formula>which is achieved by setting the gradients with respect to <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e157" xlink:type="simple"/></inline-formula> to zero (see <xref ref-type="bibr" rid="pcbi.1000379-Salakhutdinov1">[31]</xref>,<xref ref-type="bibr" rid="pcbi.1000379-Olsson1">[33]</xref> for
                    alternative approaches). For the main linear parameters we seek to infer in the
                    compartmental model (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e158" xlink:type="simple"/></inline-formula>), these equations are solved by performing a constrained
                    linear regression, akin to that in equation 7. We write the total likelihood in
                    terms of the dynamic and the observation models (equations 10 and 11):<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e159" xlink:type="simple"/></disp-formula>Let us assume that we have noisy measurements of the voltage.
                    Because the parametrisation of the evolution of the voltage is linear, but that
                    of the other hidden variables is not, we separate the two as <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e160" xlink:type="simple"/></inline-formula> where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e161" xlink:type="simple"/></inline-formula> are the gates of the conductances affecting the voltage (a
                    similar formulation can be written for
                    [Ca<sup>2+</sup>] observations). Approximating the
                    expectations by the weighted sums of the particles defined in the previous
                    section, we arrive at<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e162" xlink:type="simple"/><label>(23)</label></disp-formula>where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e163" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e164" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e165" xlink:type="simple"/></inline-formula> parametrise the distribution <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e166" xlink:type="simple"/></inline-formula> over the initial hidden variables at time <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e167" xlink:type="simple"/></inline-formula>, and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e168" xlink:type="simple"/></inline-formula> is the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e169" xlink:type="simple"/></inline-formula> row of the matrix <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e170" xlink:type="simple"/></inline-formula> derived from particle <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e171" xlink:type="simple"/></inline-formula>. Note that because we are not inferring the kinetics of the
                    channels, the evolution term for the gates (a sum over terms of the form <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e172" xlink:type="simple"/></inline-formula>) is a constant and can be neglected. Now setting the gradients
                    of equation 23 with respect to the parameters to zero, we find that the linear
                    parameters can be written, as in equation 7, as a straightforward quadratic
                    minimisation with linear constraints<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e173" xlink:type="simple"/><label>(24)</label></disp-formula>where we see that the Hessian <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e174" xlink:type="simple"/></inline-formula> and the linear term <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e175" xlink:type="simple"/></inline-formula> of the problem are given by an expectation involving the
                    particles. Importantly, this is still a quadratic optimisation problem with
                    linear constraints, and which is efficiently solved by standard packages.
                    Similarly, the initialisation parameters for the unobserved hidden variables are
                    given by<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e176" xlink:type="simple"/></disp-formula>which are just the conditional mean and variance of the particles
                    at time <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e177" xlink:type="simple"/></inline-formula>; and the evolution and observation noise terms finally by<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e178" xlink:type="simple"/></disp-formula>Thus, the procedure iterates over running the particle smoother
                    in section <italic>Sequential Monte Carlo</italic> and then inferring the
                    optimal parameters from the smoothed estimates of the unobserved variables.</p>
            </sec>
        </sec>
        <sec id="s3">
            <title>Results</title>
            <sec id="s3a">
                <title>Model-based smoothing</title>
                <p>We first present results on model-based smoothing. Here, we assume that we have a
                        <italic>correct</italic> description of the parameters of the cell under
                    scrutiny, and use this description to infer the true underlying signal from
                    noisy measurements. These results may be considered as one possible application
                    of a detailed model. <xref ref-type="fig" rid="pcbi-1000379-g002">Figure
                    2A</xref> shows the data, which was generated from a known, single-compartment
                    cell with Hodgkin-Huxley-like conductances by adding Gaussian noise. The
                    variance of the noise was chosen to replicate typical signal-to-noise ratios
                    from voltage-dye experiments <xref ref-type="bibr" rid="pcbi.1000379-Djurisic1">[2]</xref>. <xref ref-type="fig" rid="pcbi-1000379-g002">Figure 2B</xref> shows the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e179" xlink:type="simple"/></inline-formula> particles used here, and <xref ref-type="fig" rid="pcbi-1000379-g002">Figure 2C</xref> the number of particles with
                    non-negligible weights (the “effective” number <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e180" xlink:type="simple"/></inline-formula> of particles). We see that when <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e181" xlink:type="simple"/></inline-formula> hits a threshold of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e182" xlink:type="simple"/></inline-formula>, resampling results in large jumps in some particles. At
                    around 3 ms, we see that some particles, which produced a spike at a time when
                    there is little evidence for it in the data, are re-set to a value that is in
                    better accord with the data. <xref ref-type="fig" rid="pcbi-1000379-g002">Figure
                        2D</xref> shows the close match between the true underlying signal and the
                    inferred mean <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e183" xlink:type="simple"/></inline-formula>, while <xref ref-type="fig" rid="pcbi-1000379-g002">Figure
                    2E</xref> shows that even the unobserved channel open fractions are inferred
                    very accurately. The match for both the voltage and the open channel fractions
                    improves with the number of particles. Code for the implementation of this
                    smoothing step is available online at <ext-link ext-link-type="uri" xlink:href="http://www.gatsby.ucl.ac.uk/~qhuys/code.html" xlink:type="simple">http://www.gatsby.ucl.ac.uk/̃qhuys/code.html</ext-link>.</p>
                <p>For imaging data, the laser often has to be moved between recording locations,
                    leading to intermittent sampling at any one location (see <xref ref-type="bibr" rid="pcbi.1000379-Djurisic2">[34]</xref>–<xref ref-type="bibr" rid="pcbi.1000379-Saggau1">[36]</xref>).
                        <xref ref-type="fig" rid="pcbi-1000379-g003">Figure 3</xref> illustrates the
                    performance of the model-based smoother both for varying noise levels and for
                    temporal subsampling. We see that even for very noisy and highly subsampled
                    data, the spikes can be recovered very well.</p>
                <fig id="pcbi-1000379-g003" position="float">
                    <object-id pub-id-type="doi">10.1371/journal.pcbi.1000379.g003</object-id>
                    <label>Figure 3</label>
                    <caption>
                        <title>Performance of the model-based smoother with varying observation
                            noise <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e184" xlink:type="simple"/></inline-formula> and temporal subsampling <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e185" xlink:type="simple"/></inline-formula>.</title>
                        <p>True underlying voltage trace in dashed black lines, the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e186" xlink:type="simple"/></inline-formula> particles in gray and the data in black circles.
                            Accurate inference of underlying voltage signals, and thus of spike
                            times, is possible with accurate descriptions of the cell, over a wide
                            range of noise levels and even at low sampling frequencies.</p>
                    </caption>
                    <graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.g003" xlink:type="simple"/>
                </fig>
                <p><xref ref-type="fig" rid="pcbi-1000379-g004">Figure 4</xref> shows a different
                    aspect of the same issue, whereby the laser moves linearly across an extended
                    linear dendrite. Here, samples are taken every <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e187" xlink:type="simple"/></inline-formula> timesteps, but samples from each individual compartment are
                    only obtained each <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e188" xlink:type="simple"/></inline-formula>. The true voltage across the entire passive dendrite is shown
                    in <xref ref-type="fig" rid="pcbi-1000379-g004">Figure 4A</xref>, and the sparse
                    data points distributed over the dendrite are shown in panel B. The inferred
                    mean in panel C matches the true voltage very well. For this
                    <italic>passive</italic>, linear example, the equations for the hidden dynamical
                    system are exactly those of a Kalman smoother model <xref ref-type="bibr" rid="pcbi.1000379-Durbin1">[37]</xref>; thus the standard
                    Kalman smoother performs the correct spatial and temporal smoothing once the
                    parameters are known, with no need for the more general (but more
                    computationally costly) particle smoother introduced above. More precisely, in
                    this case the integrals in equations 12 and 14 can be evaluated analytically,
                    and no sampling is necessary. The supplemental <xref ref-type="supplementary-material" rid="pcbi.1000379.s001">video S1</xref>
                    shows the results of a similar linear (passive-membrane) simulation, performed
                    on a branched simulated dendrite (instead of the linear dendritic segment
                    illustrated in <xref ref-type="fig" rid="pcbi-1000379-g004">Figure 4</xref>).</p>
                <fig id="pcbi-1000379-g004" position="float">
                    <object-id pub-id-type="doi">10.1371/journal.pcbi.1000379.g004</object-id>
                    <label>Figure 4</label>
                    <caption>
                        <title>Inferring spatiotemporal voltage distribution from scanning,
                            intermittent samples.</title>
                        <p>A: True underlying voltage signal as a function of time for all 15
                            compartments. This was generated by injecting white noise current into a
                            passive cell containing 50 linearly arranged compartments. B: Samples
                            obtained by scanning repeatedly along the dendrite. The samples are seen
                            as diagonal lines extending downwards, ie each compartment was sampled
                            in sequence, overall 10 times and 25 ms apart. Note that the samples
                            were noisy
                            (<italic>σ<sub>O</sub></italic> = 3.16
                            mV). C: Conditional expected voltage time course for all compartments
                            reconstructed by Kalman smoothing. The colorbar indicates the voltage
                            for all three panels. Note that even though there is only sparse data
                            over time and space, a smooth version of the full spatiotemporal pattern
                            is recovered. D: Variance of estimated voltage. It is smallest at the
                            observation times and rapidly reaches a steady state between
                            observations. Due to the smoothing, which takes future data into
                            account, the variance diminishes <italic>ahead</italic> of
                        observations.</p>
                    </caption>
                    <graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.g004" xlink:type="simple"/>
                </fig>
                <p>We emphasize that the strong performance of the particle smoother and the Kalman
                    smoother here should not be surprising, since the data were generated from a
                    known model and in these cases these methods perform smoothing in a
                    statistically optimal manner. Rather, these results should illustrate the power
                    of using an exact, correct description of the cell and its dynamics.</p>
            </sec>
            <sec id="s3b">
                <title>EM – inferring cellular parameters</title>
                <p>We have so far shown model-based filtering assuming that a full model of the cell
                    under scrutiny is available. Here, we instead infer some of the main parameters
                    from the data; specifically the linear parameters <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e189" xlink:type="simple"/></inline-formula>, the observation noise <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e190" xlink:type="simple"/></inline-formula> and the evolution noise <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e191" xlink:type="simple"/></inline-formula>. We continue to assume, however, that the kinetics of all
                    channels that may be present in the cell are known exactly (see <xref ref-type="bibr" rid="pcbi.1000379-Huys1">[23]</xref> for a
                    discussion of this assumption).</p>
                <p><xref ref-type="fig" rid="pcbi-1000379-g005">Figure 5</xref> illustrates the
                    inference for a passive multicompartmental model, similar to that in <xref ref-type="fig" rid="pcbi-1000379-g004">Figure 4</xref>, but driven by a
                    square current injection into the second compartment. <xref ref-type="fig" rid="pcbi-1000379-g005">Figure 5B</xref> shows statistics of the inference
                    of the leak conductance maximal density <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e192" xlink:type="simple"/></inline-formula>, the intercompartmental conductance <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e193" xlink:type="simple"/></inline-formula>, the input resistance <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e194" xlink:type="simple"/></inline-formula> and the observation noise <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e195" xlink:type="simple"/></inline-formula> across 50 different randomly generated noisy voltage traces.
                    All the parameters are reliably recovered from 2 seconds of data at a 1 ms
                    sampling frequency.</p>
                <fig id="pcbi-1000379-g005" position="float">
                    <object-id pub-id-type="doi">10.1371/journal.pcbi.1000379.g005</object-id>
                    <label>Figure 5</label>
                    <caption>
                        <title>Inferring biophysical parameters from noisy measurements in a passive
                            cell.</title>
                        <p>A: True voltage (black) and noisy data (grey dots) from the 5
                            compartments of the cell with noise level
                            <italic>σ<sub>O</sub></italic> = 10
                            mV. B–E: Parameter inference with EM. Each panel shows the
                            average inference time course±one st. dev. of one of the
                            cellular parameters. B: Leak conductance; C: intercompartmental
                            conductance; D: input resistivity; E: Observation noise variance. The
                            grey dotted line shows the true values. The coloured lines show the
                            inference for varying levels of noise <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e196" xlink:type="simple"/></inline-formula>. Blue:
                            <italic>σ<sub>O</sub></italic> = 1
                            mV, Green:
                            <italic>σ<sub>O</sub></italic> = 5
                            mV, Red:
                            <italic>σ<sub>O</sub></italic> = 10
                            mV, Cyan:
                            <italic>σ<sub>O</sub></italic> = 20
                            mV, Magenta:
                            <italic>σ<sub>O</sub></italic> = 50
                            mV. Throughout Δ<italic>
                                <sub>s</sub>
                            </italic> = 1
                            ms = 10Δ. Note that accurate
                            estimation of the leak, input resistance and noise levels is even
                            possible when the noise is five times as large as that shown in panel A.
                            Inference of the intercompartmental conductance suffers most from the
                            added noise because the small intercompartmental currents have to be
                            distinguished from the apparent currents arising from noise fluctuations
                            in the observations from neighbouring compartments. Throughout, the
                            underlying voltage was estimated highly accurately (data not shown),
                            which is also reflected in the accurate estimates of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e197" xlink:type="simple"/></inline-formula>.</p>
                    </caption>
                    <graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.g005" xlink:type="simple"/>
                </fig>
                <p>We now proceed to infer channel densities and observation noise from active
                    compartments with either four or eight channels. <xref ref-type="fig" rid="pcbi-1000379-g006">Figure 6</xref> shows an example trace and inference
                    for the four channel case (using Hodgkin-Huxley like channel kinetics). Again,
                    we stimulated with square current pulses. Only 10 ms of data were recorded, but
                    at a very high temporal resolution Δ<italic>
                        <sub>s</sub>
                    </italic> = Δ = 0.02
                    ms. We see that both the underlying voltage trace and the channel and input
                    resistance are recovered with high accuracy. <xref ref-type="fig" rid="pcbi-1000379-g007">Figure 7</xref> presents batch data over 50 runs for
                    varying levels of observation noise <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e198" xlink:type="simple"/></inline-formula>. The observation noise here has two effects: first, it slows
                    down the inference (as every data point is less informative), but secondly the
                    variance across runs increases with increasing noise (although the mean is still
                    accurate). For illustration purposes, we started the maximal
                    K<sup>+</sup> conductance at its correct value. As can be seen,
                    however, the inference initially moves <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e199" xlink:type="simple"/></inline-formula>
                    <italic>away</italic> from the optimum, to compensate for the other conductance
                    misestimations. (This nonmonotonic behavior in <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e200" xlink:type="simple"/></inline-formula> is a result of the fact that the EM algorithm is searching for
                    an optimal setting of all of the cell's conductance parameters, not
                    just a single parameter; we will return to this issue below.)</p>
                <fig id="pcbi-1000379-g006" position="float">
                    <object-id pub-id-type="doi">10.1371/journal.pcbi.1000379.g006</object-id>
                    <label>Figure 6</label>
                    <caption>
                        <title>Example inference for single compartment with active conductances.</title>
                        <p>A: Noisy data,
                            <italic>σ<sub>O</sub></italic> = 10
                            mV; B: True underlying voltage (black dashed line) resulting from
                            current pulse injection shown in E. The gray trace shows the mean
                            inferred voltage after inferring the paramter values in C. C: Initial
                            (blue +) and inferred parameter values (red ×) in
                            percent relative to true values (gray bars <italic>ḡ</italic><italic>
                                <sub>Na</sub>
                            </italic> = 120 mS/cm<sup>2</sup>,
                                <italic>ḡ</italic><italic>
                                <sub>K</sub>
                            </italic> = 20 mS/cm<sup>2</sup>,
                                <italic>ḡ</italic><italic>
                                <sub>Leak</sub>
                            </italic> = 3 mS/cm<sup>2</sup>,
                                    <italic>R<sub>m</sub></italic> = 1
                                mS/cm<sup>2</sup>). At the initial values the cell was non-spiking.
                            D: Magnified view showing data, inferred and true voltage traces for the
                            first spike. Thus, despite the very high noise levels and an initially
                            inaccurate, non-spiking model of the cell, knowledge of the channel
                            kinetics allows accurate inference of the channel densities and very
                            precise reconstruction of the underlying voltage trace.</p>
                    </caption>
                    <graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.g006" xlink:type="simple"/>
                </fig>
                <fig id="pcbi-1000379-g007" position="float">
                    <object-id pub-id-type="doi">10.1371/journal.pcbi.1000379.g007</object-id>
                    <label>Figure 7</label>
                    <caption>
                        <title>Time course of parameter estimation with HH channels.</title>
                        <p>The four panels show, respectively, the inference for the conductance
                            parameters A: <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e201" xlink:type="simple"/></inline-formula> B: <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e202" xlink:type="simple"/></inline-formula> C: <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e203" xlink:type="simple"/></inline-formula> and D: <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e204" xlink:type="simple"/></inline-formula>. The thick coloured lines indicate the mean over 50
                            data samples and the shaded areas 1 st. dev. The colours indicate
                            varying noise levels <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e205" xlink:type="simple"/></inline-formula>. Blue:
                            <italic>σ<sub>O</sub></italic> = 1
                            mV, Green:
                            <italic>σ<sub>O</sub></italic> = 5
                            mV, Red:
                            <italic>σ<sub>O</sub></italic> = 10
                            mV, Cyan:
                            <italic>σ<sub>O</sub></italic> = 20
                            mV. The true parameters are indicated by the horizontal gray dashed
                            lines. Throughout Δ<italic>
                                <sub>s</sub>
                            </italic> = Δ = 0.02
                            ms. The main effect of increasing observation noise is to slow down the
                            inference. In addition, larger observation noise also adds variance to
                            the parameter estimates. Throughout, only 10 ms of data were used.</p>
                    </caption>
                    <graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.g007" xlink:type="simple"/>
                </fig>
                <p>Parametric inference here has so far employed densely sampled traces (see <xref ref-type="fig" rid="pcbi-1000379-g006">Figure 6A</xref>). The algorithm
                    however applies equally to subsampled traces (see equation 22). <xref ref-type="fig" rid="pcbi-1000379-g008">Figure 8</xref> shows the effect of
                    subsampling. We see that subsampling, just as noise, slows down the inference,
                    until the active conductances are no longer inferred accurately (the yellow
                    trace for Δ<italic>
                        <sub>s</sub>
                    </italic> = 0.5 ms). In this case, the total
                    recording length of 10 ms meant that inference had to be done based on one
                    single spike. For longer recordings, information about multiple spikes can of
                    course be combined, partially alleviating this problem; however, we have found
                    that in highly active membranes, sampling frequencies below about 1 KHz led to
                    inaccurate estimates of sodium channel densities (since at slower sampling rates
                    we will typically miss significant portions of the upswing of the action
                    potential, leading the EM algorithm to underestimate the sodium channel
                    density). Note that we kept the length of the recording in <xref ref-type="fig" rid="pcbi-1000379-g008">Figure 8</xref> constant, and thus subsampling
                    reduced the total number of measurements.</p>
                <fig id="pcbi-1000379-g008" position="float">
                    <object-id pub-id-type="doi">10.1371/journal.pcbi.1000379.g008</object-id>
                    <label>Figure 8</label>
                    <caption>
                        <title>Subsampling slows down parametric inference.</title>
                        <p>Inference of the same parameters as in previous Figure (A: <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e206" xlink:type="simple"/></inline-formula>, B: <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e207" xlink:type="simple"/></inline-formula>, C: <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e208" xlink:type="simple"/></inline-formula>, D: <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e209" xlink:type="simple"/></inline-formula>), but the different colours now indicate increasing
                            subsampling. Particles evolved at timesteps of
                            Δ = 0.04 ms. The coloured
                            traces inference with show sampling timesteps of Δ<italic>
                                <sub>s</sub>
                            </italic> = {0.01,0.02,0.05,0.1,0.5} ms
                            respectively. All particles were run with a
                            Δ = 0.01 ms timestep, and the
                            total recording was always 10 ms long, meaning that progressive
                            subsampling decreased the total number of data points. Thus, it can be
                            seen that parameter inference is quite relatively to undersampling. At
                            very large subsampling times, 10 ms of data supplied too few
                            observations during a spike to justify inference of high levels of
                                Na<sup>+</sup> and K<sup>+</sup> conductances, but
                            the input resistance and the leak were still reliably and accurately
                            inferred.</p>
                    </caption>
                    <graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.g008" xlink:type="simple"/>
                </fig>
                <p>As with any importance sampling method, particle filtering is known to suffer in
                    higher dimensions <xref ref-type="bibr" rid="pcbi.1000379-Bickel1">[38]</xref>. To investigate the dependence of the
                    particle smoother's accuracy on the dimensionality of the state space,
                    we applied the method to a compartment with a larger number of channels: fast (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e210" xlink:type="simple"/></inline-formula>) and persistent Na<sup>+</sup> (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e211" xlink:type="simple"/></inline-formula>) channels in addition to leak (L) and delayed rectivier (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e212" xlink:type="simple"/></inline-formula>), A-type (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e213" xlink:type="simple"/></inline-formula>), K2-type (K<sub>2</sub>) and M-type (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e214" xlink:type="simple"/></inline-formula>) K<sup>+</sup> channels (channel kinetics from
                    ModelDB <xref ref-type="bibr" rid="pcbi.1000379-Hines1">[39]</xref>, from <xref ref-type="bibr" rid="pcbi.1000379-Traub1">[9]</xref>,<xref ref-type="bibr" rid="pcbi.1000379-Royeck1">[40]</xref>). <xref ref-type="fig" rid="pcbi-1000379-g009">Figure 9</xref> shows the evolution
                    of the channel intensities during inference. Estimates of most channel densities
                    are correct up to a factor of approximately 2. Unlike in the previous, smaller
                    example, as either observation noise or subsampling increase, significant biases
                    in the estimation of channel densities appear. For instance, the density of the
                    fast sodium channel observed with noise of standard deviation 20 mV is only
                    about half the true value.</p>
                <fig id="pcbi-1000379-g009" position="float">
                    <object-id pub-id-type="doi">10.1371/journal.pcbi.1000379.g009</object-id>
                    <label>Figure 9</label>
                    <caption>
                        <title>Time course of parameter estimation in a model with eight
                            conductances.</title>
                        <p>Evolution of estimates of channel densities for compartment with eight
                            channels. Colours show inference with changes in the observation noise <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e215" xlink:type="simple"/></inline-formula> and the subsampling <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e216" xlink:type="simple"/></inline-formula>. True levels are indicated by dotted gray lines. A: Δ<italic>
                                <sub>s</sub>
                            </italic> = .02 ms,
                                    <italic>σ<sub>O</sub></italic> = {1,2,5,10,20}
                            mV respectively for blue, green, red, cyan and purple lines B:
                                    <italic>σ<sub>O</sub></italic> = 5
                            mV, Δ<italic>
                                <sub>s</sub>
                            </italic> = {.02,.04,.1,.2,.4} ms again
                            for blue, green, red, cyan and purple lines respectively. Thick lines
                            show median, thin lines show 10 and 90% quantiles of
                            distribution across 50 runs.</p>
                    </caption>
                    <graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.g009" xlink:type="simple"/>
                </fig>
                <p>It is worth noting that this bias problem is not observed in the passive linear
                    case, where the analytic Kalman smoother suffices to perform the inference: we
                    can infer the linear dynamical parameters of neurons with many compartments, as
                    long as we sample information from each compartment <xref ref-type="bibr" rid="pcbi.1000379-Huys1">[23]</xref>. Instead, the
                    difficulty here is due to multicollinearity of the regression performed in the
                    M-step of the EM algorithm and to the fact that the particle smoother leads to
                    biased estimation of covariance parameters in high-dimensional cases <xref ref-type="bibr" rid="pcbi.1000379-Bickel1">[38]</xref>. We
                    will discuss some possible remedies for these biases below.</p>
                <p>Somewhat surprisingly, however, these observed estimation biases do not prove
                    catastrophic if we care about predicting or smoothing the subthreshold voltage.
                        <xref ref-type="fig" rid="pcbi-1000379-g010">Figure 10A</xref> compares the
                    response to a new, random, input current of a compartment with the true
                    parameters to that of a compartment with parameters as estimated during EM
                    inference, while <xref ref-type="fig" rid="pcbi-1000379-g010">Figure 10B</xref>
                    shows an example prediction with <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e217" xlink:type="simple"/></inline-formula>. Note the large plateau potentials after the spikes due to the
                    persistent sodium channel <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e218" xlink:type="simple"/></inline-formula>. We see that even the parameters as estimated under high noise
                    accurately come to predict the response to a new, previously unseen, input
                    current. The asymptote in <xref ref-type="fig" rid="pcbi-1000379-g010">Figure
                        10A</xref> is determined by the true evolution noise level (here
                        <italic>σ</italic> = 1 mV): the
                    more inherent noise, the less a response to a specific input is actually
                    predictable.</p>
                <fig id="pcbi-1000379-g010" position="float">
                    <object-id pub-id-type="doi">10.1371/journal.pcbi.1000379.g010</object-id>
                    <label>Figure 10</label>
                    <caption>
                        <title>Predictive performance of inferred parameter settings on new input
                            current.</title>
                        <p>A: Parameter estimates as shown in <xref ref-type="fig" rid="pcbi-1000379-g009">Figure 9A</xref> were used to predict
                            response to a new input stimulus. The plot shows the absolute error
                            averaged over the entire trace (3000 timesteps, Δ<italic>
                                <sub>t</sub>
                            </italic> = .02 ms), for 40 runs. Thick
                            lines show the median, shaded areas 10 and 90% quantiles over
                            the same 40 runs as in <xref ref-type="fig" rid="pcbi-1000379-g009">Figure 9</xref>. Blue:
                            <italic>σ<sub>O</sub></italic> = 1
                            mV, Green:
                            <italic>σ<sub>O</sub></italic> = 2
                            mV, Red:
                            <italic>σ<sub>O</sub></italic> = 5
                            mV, Cyan:
                            <italic>σ<sub>O</sub></italic> = 10
                            mV, Magenta:
                            <italic>σ<sub>O</sub></italic> = 20
                            mV. Note logarithmic y axis. B: Example prediction trace. The dashed
                            black line shows the response of the cell with the true parameters, the
                            red line that with the inferred parameters. The observation noise was
                                    <italic>σ<sub>O</sub></italic> = 20
                            mV, while the average error for this trace
                                    〈|<italic>V</italic>−<italic>V<sub>est</sub></italic>|〉 = 2.96
                            mV.</p>
                    </caption>
                    <graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.g010" xlink:type="simple"/>
                </fig>
                <p>Some further insight into the problem can be gained by looking at the structure
                    of the Hessian of the total likelihood <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e219" xlink:type="simple"/></inline-formula> around the true parameters. We estimate <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e220" xlink:type="simple"/></inline-formula> by running the particle smoother with a large number of
                    particles once at the true parameter value; more generally, one could perform a
                    similar analysis about the inferred parameter setting to obtain a parametric
                    bootstrap estimate of the posterior uncertainty. <xref ref-type="fig" rid="pcbi-1000379-g011">Figure 11</xref> shows that, around the true value,
                    changes in either the fast Na<sup>+</sup> or the K<sub>2</sub>-type
                        K<sup>+</sup> channel have the least effect; i.e., the curvature in
                    the loglikelihood is smallest in these directions, indicating that the observed
                    data does not adequately constrain our parameter estimates in these directions,
                    and prior information must be used to constrain these estimates instead. This
                    explains why these channels showed disproportionately large amounts of inference
                    variability, and why the prediction error did not suffer catastrophically from
                    their relatively inaccurate inference (<xref ref-type="fig" rid="pcbi-1000379-g010">Figure 10A</xref>). See <xref ref-type="bibr" rid="pcbi.1000379-Huys1">[23]</xref> for further
                    discussion of this multicollinearity issue in large multichannel models.</p>
                <fig id="pcbi-1000379-g011" position="float">
                    <object-id pub-id-type="doi">10.1371/journal.pcbi.1000379.g011</object-id>
                    <label>Figure 11</label>
                    <caption>
                        <title>Eigenstructure of Hessian <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e221" xlink:type="simple"/></inline-formula> with varying observation noise.</title>
                        <p>Eigenvector 1 has the largest (&gt;10<sup>4</sup>), and eigenvector 8
                            respectively the smallest eigenvalue (∼0.5). Independently of
                            the noise, the smalles eigenvectors involve those channels for which
                            inference in <xref ref-type="fig" rid="pcbi-1000379-g009">Figure
                            9</xref> appeared least reliable: the fast Na<sup>+</sup> and
                            the K<sub>2</sub>-type K<sup>+</sup> channel.</p>
                    </caption>
                    <graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.g011" xlink:type="simple"/>
                </fig>
            </sec>
            <sec id="s3c">
                <title>Estimation of subthreshold nonlinearity by nonparametric EM</title>
                <p>We saw in the last section that as the dimensionality of the state vector <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e222" xlink:type="simple"/></inline-formula> grows, we may lose the ability to simultaneously estimate all
                    of the system parameters. How can we deal with this issue? One approach is to
                    take a step back: in many statistical settings we do not care primarily about
                    estimating the underlying model parameters accurately, but rather we just need a
                    model that predicts the data well. It is worth emphasizing that the methods we
                    have intrduced here can be quite useful in this setting as well. As an important
                    example, consider the problem of estimating the subthreshold voltage given noisy
                    observations. In many applications, we are more interested in a method which
                    will reliably extract the subthreshold voltage than in the parameters underlying
                    the method. For example, if a linear smoother (e.g., the Kalman smoother
                    discussed above) works well, it might be more efficient and stable to stick with
                    this simpler method, rather than attempting to estimate the parameters defining
                    the cell's full complement of active membrane channels (indeed,
                    depending on the signal-to-noise ratio and the collinearity structure of the
                    problem, the latter goal may not be tractable, even in cases where the voltage
                    may be reliably measured <xref ref-type="bibr" rid="pcbi.1000379-Huys1">[23]</xref>).</p>
                <p>Of course, in many cases linear smoothers are not appropriate. For example, the
                    linear (Kalman) model typically leads to oversmoothing if the voltage dynamics
                    are sufficiently nonlinear (data not shown), because action potentials take
                    place on a much faster timescale than the passive membrane time constant. Thus
                    it is worth looking for a method which can incorporate a flexible nonlinearity
                    and whose parameters may not be directly interpretable biophysically but which
                    nonetheless leads to good estimation of the signal of interest. We could just
                    throw a lot of channels into the mix, but this increases the dimensionality of
                    the state space, hurting the performance of the particle smoother and leading to
                    multicollinearity problems in the M-step, as illustrated in the last subsection.</p>
                <p>A more promising approach is to fit nonlinear dynamics directly, while keeping
                    the dimensionality of the state space as small as possible. This has been a
                    major theme in computational neuroscience, where the reduction of complicated
                    multichannel models into low-dimensional models, useful for phase plane
                    analysis, has led to great insights into qualitative neural dynamics <xref ref-type="bibr" rid="pcbi.1000379-Koch1">[26]</xref>,<xref ref-type="bibr" rid="pcbi.1000379-Gerstner1">[41]</xref>.</p>
                <p>As a concrete example, we generated data from a strongly nonlinear
                    (Fitzhugh-Nagumo) two-dimensional model, and then attempted to perform optimal
                    smoothing, without prior knowledge of the underlying voltage nonlinearity. We
                    initialized our analysis with a linear model, and then fit the nonlinearity
                    nonparametrically via a straightforward nonparametric modification of the EM
                    approach developed above.</p>
                <p>In more detail, we generated data from the following model <xref ref-type="bibr" rid="pcbi.1000379-Gerstner1">[41]</xref>:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e223" xlink:type="simple"/><label>(25)</label></disp-formula><disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e224" xlink:type="simple"/><label>(26)</label></disp-formula>where the nonlinear function <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e225" xlink:type="simple"/></inline-formula> is cubic in this case, and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e226" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e227" xlink:type="simple"/></inline-formula> denote independent white Gaussian noise processes. Then, given
                    noisy observations of the voltage <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e228" xlink:type="simple"/></inline-formula> (<xref ref-type="fig" rid="pcbi-1000379-g012">Figure
                    12</xref>, left middle panel), we used a nonparametric version of our EM
                    algorithm to estimate <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e229" xlink:type="simple"/></inline-formula>. The E-step of the EM algorithm is unchanged in this context:
                    we compute <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e230" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e231" xlink:type="simple"/></inline-formula>, along with the other pairwise sufficient statistics, using
                    our standard particle forward-backward smoother, given our current estimate of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e232" xlink:type="simple"/></inline-formula>. The M-step here is performed using a penalized spline method
                        <xref ref-type="bibr" rid="pcbi.1000379-Green1">[42]</xref>: we represent <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e233" xlink:type="simple"/></inline-formula> as a linearly weighted combination of fixed basis functions <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e234" xlink:type="simple"/></inline-formula>:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e235" xlink:type="simple"/></disp-formula>and then determine the optimal weights <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e236" xlink:type="simple"/></inline-formula> by maximum penalized likelihood:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e237" xlink:type="simple"/></disp-formula>The first term here corresponds to the expected complete
                    loglikelihood (as in equation (23)), while the second term is a penalty which
                    serves to smooth the inferred function <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e238" xlink:type="simple"/></inline-formula> (by penalizing non-smooth solutions, i.e., functions <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e239" xlink:type="simple"/></inline-formula> whose derivative has a large squared norm); the scalar <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e240" xlink:type="simple"/></inline-formula> serves to set the balance between the smoothness of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e241" xlink:type="simple"/></inline-formula> and the fit to the data. Despite its apparent complexity, in
                    fact this expression is just a quadratic function of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e242" xlink:type="simple"/></inline-formula> (just like equation (24)), and the update <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e243" xlink:type="simple"/></inline-formula> may be obtained by solving a simple linear equation. If the
                    basis functions <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e244" xlink:type="simple"/></inline-formula> have limited overlap, then the Hessian of this objective
                    function with respect to <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e245" xlink:type="simple"/></inline-formula> is banded (with bandwidth equal to the degree of overlap in
                    the basis functions <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e246" xlink:type="simple"/></inline-formula>), and therefore this linear equation can be solved quickly
                    using sparse banded matrix solvers <xref ref-type="bibr" rid="pcbi.1000379-Green1">[42]</xref>,<xref ref-type="bibr" rid="pcbi.1000379-Paninski1">[43]</xref>.
                    We used 50 nonoverlapping simple step functions to represent <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e247" xlink:type="simple"/></inline-formula> in <xref ref-type="fig" rid="pcbi-1000379-g012">Figures.
                        12</xref>–<xref ref-type="fig" rid="pcbi-1000379-g013">13</xref>,
                    and each M-step took negligible time (≪1 sec). The penalty term <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e248" xlink:type="simple"/></inline-formula> was fit crudely by eye here (we chose a <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e249" xlink:type="simple"/></inline-formula> that led to a reasonable fit to the data, without drastically
                    oversmoothing <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e250" xlink:type="simple"/></inline-formula>); this could be done more systematically by model selection
                    criteria such as maximum marginal likelihood or cross-validation, but the
                    results were relatively insensitive to the precise choice of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e251" xlink:type="simple"/></inline-formula>. Finally, it is worth noting that the EM algorithm for maximum
                    penalized likelihood estimation is guaranteed to (locally) optimize the
                    penalized likelihood, just as the standard EM algorithm (locally) optimizes the
                    unpenalized likelihood.</p>
                <fig id="pcbi-1000379-g012" position="float">
                    <object-id pub-id-type="doi">10.1371/journal.pcbi.1000379.g012</object-id>
                    <label>Figure 12</label>
                    <caption>
                        <title>Estimating subthreshold nonlinearity via nonparametric EM, given
                            noisy voltage measurements.</title>
                        <p>A, B: input current and observed noisy voltage fluorescence data. C:
                            inferred and true voltage trace. Black dashed trace: true voltage; gray
                            solid trace: voltage inferred using nonlinearity given tenth EM
                            iteration (red trace from right panel). Note that voltage is inferred
                            quite accurately, despite the significant observation noise. D: voltage
                            nonlinearity estimated over ten iterations of nonparametric EM. Black
                            dashed trace: true nonlinearity; blue dotted trace: original estimate
                            (linear initialization); solid traces: estimated nonlinearity. Color
                            indicates iteration number: blue trace is first and red trace is
                        last.</p>
                    </caption>
                    <graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.g012" xlink:type="simple"/>
                </fig>
                <fig id="pcbi-1000379-g013" position="float">
                    <object-id pub-id-type="doi">10.1371/journal.pcbi.1000379.g013</object-id>
                    <label>Figure 13</label>
                    <caption>
                        <title>Estimating voltage given noisy calcium measurements, with
                            nonlinearity estimated via nonparametric EM.</title>
                        <p>A: Input current. B: Observed time derivative of calcium-sensitive
                            fluorescence. Note the low SNR. C: True and inferred voltage. Black
                            dashed trace: true voltage; gray solid trace: voltage inferred using
                            nonlinearity following five EM iterations. Here the voltage-dependent
                            calcium current had an activation potential at −20 mV (i.e.,
                            the calcium current is effectively zero at voltages significantly below
                            −20 mV; at voltages &gt;10 mV the current is ohmic). The
                            superthreshold voltage behavior is captured fairly well, as are the
                            post-spike hyperpolarized dynamics, but the details of the resting
                            subthreshold behavior are lost.</p>
                    </caption>
                    <graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.g013" xlink:type="simple"/>
                </fig>
                <p>Results are shown in <xref ref-type="fig" rid="pcbi-1000379-g012">Figures
                    12</xref> and <xref ref-type="fig" rid="pcbi-1000379-g013">13</xref>. In <xref ref-type="fig" rid="pcbi-1000379-g012">Figure 12</xref>, we observe a noisy
                    version of the voltage <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e252" xlink:type="simple"/></inline-formula>, iterate the nonparametric penalized EM algorithm ten times to
                    estimate <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e253" xlink:type="simple"/></inline-formula>, then compute the inferred voltage <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e254" xlink:type="simple"/></inline-formula>. In <xref ref-type="fig" rid="pcbi-1000379-g013">Figure
                    13</xref>, instead of observing the noise-contaminated voltage directly, we
                    observe the internal calcium concentration. This calcium concentration variable <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e255" xlink:type="simple"/></inline-formula> followed its own noisy dynamics,<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e256" xlink:type="simple"/></disp-formula>where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e257" xlink:type="simple"/></inline-formula> denotes white Gaussian noise, and the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e258" xlink:type="simple"/></inline-formula> term represents a fast voltage-activated inward calcium
                    current which activates at −20 mV (i.e., this current is negligible at
                    rest; it is effectively only activated during spiking). We then observed a noisy
                    fluorescence signal <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e259" xlink:type="simple"/></inline-formula> which was linearly related to the calcium concentration <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e260" xlink:type="simple"/></inline-formula>
                    <xref ref-type="bibr" rid="pcbi.1000379-Vogelstein1">[32]</xref>. Since the informative signal in <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e261" xlink:type="simple"/></inline-formula> is not its absolute magnitude but rather how quickly it is
                    currently changing (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e262" xlink:type="simple"/></inline-formula> is dominated by <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e263" xlink:type="simple"/></inline-formula> during an action potential), we plot the time derivative <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e264" xlink:type="simple"/></inline-formula> in <xref ref-type="fig" rid="pcbi-1000379-g013">Figure
                    13</xref>; note that the effective signal-to-noise in both <xref ref-type="fig" rid="pcbi-1000379-g012">Figures 12</xref> and <xref ref-type="fig" rid="pcbi-1000379-g013">13</xref> is quite low.</p>
                <p>The nonparametric EM-smoothing method effectively estimates the subthreshold
                    voltage <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e265" xlink:type="simple"/></inline-formula> in each case, despite the low observation SNR. In <xref ref-type="fig" rid="pcbi-1000379-g012">Figure 12</xref>, our estimate of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e266" xlink:type="simple"/></inline-formula> is biased towards a constant by our smoothing prior; this
                    low-SNR data is not informative enough to overcome the effect of the smoothing
                    penalty term here; indeed, since this oversmoothed estimate of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e267" xlink:type="simple"/></inline-formula> is sufficient to explain the data well, as seen in the left
                    panels of <xref ref-type="fig" rid="pcbi-1000379-g012">Figure 12</xref>, the
                    smoother estimate is preferred by the optimizer. With more data, or a higher
                    SNR, the estimated <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e268" xlink:type="simple"/></inline-formula> becomes more accurate (data not shown). It is also worth
                    noting that if we attempt to estimate <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e269" xlink:type="simple"/></inline-formula> from <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e270" xlink:type="simple"/></inline-formula> using a linear smoother in <xref ref-type="fig" rid="pcbi-1000379-g013">Figure 13</xref>, we completely miss the
                    hyperpolarization following each action potential; this further illustrates the
                    advantages of the model-based approach in the context of these highly nonlinear
                    dynamical observations.</p>
            </sec>
        </sec>
        <sec id="s4">
            <title>Discussion</title>
            <p>This paper applied standard machine learning techniques to the problem of inferring
                biophysically detailed models of single neurones automatically and directly from
                single-trial imaging data. In the first part, the paper presented techniques for the
                use of detailed models to filter noisy and temporally and spatially subsampled data
                in a principled way. The second part of the paper used this approach to infer
                unknown parameters by EM.</p>
            <p>Our approach is somewhat different from standard approaches in the cellular
                computational neuroscience literature (<xref ref-type="bibr" rid="pcbi.1000379-Bhalla1">[12]</xref>,<xref ref-type="bibr" rid="pcbi.1000379-Vanier1">[14]</xref>,<xref ref-type="bibr" rid="pcbi.1000379-Prinz1">[15]</xref>,<xref ref-type="bibr" rid="pcbi.1000379-Achard1">[19]</xref>, although see <xref ref-type="bibr" rid="pcbi.1000379-Bush1">[18]</xref>), in that
                we argue that the inference problem posed is equivalent to problems in many other
                statistical situations. We thus postulate a full probabilistic model of the
                observations and then use standard machine learning tools to do inference about
                biophysically relevant parameters. This is an approach that is more standard in
                other, closely related fields in neuroscience <xref ref-type="bibr" rid="pcbi.1000379-Friston1">[44]</xref>,<xref ref-type="bibr" rid="pcbi.1000379-Sotero1">[45]</xref>. Importantly, we
                attempt to use the description of the problem in detail to arrive at as efficient as
                possible a method of using the data. This implies that we directly compare recording
                traces (the voltage or calcium trace), rather than attempting to fit measures of the
                traces such as the ISI distribution, and the sufficient statistics that are used for
                the parameter inference involves aspects of the data these parameters influence
                directly. One alternative is to include a combination of such physiologically
                relevant objective functions and to apply more general fitting routines <xref ref-type="bibr" rid="pcbi.1000379-Druckmann1">[46]</xref>,<xref ref-type="bibr" rid="pcbi.1000379-Druckmann2">[47]</xref>. A key assumption in
                our approach is that accurately fitting the voltage trace will lead to accurate fits
                of such other measures derived from the voltage trace, such as the inter-spike
                interval distribution. In the present approach this means that variability is
                explicitly captured by parameters internal to the model. In our experience, this is
                important to avoid both overfitting individual traces and neglecting the inherently
                stochastic nature of neural responses.</p>
            <p>A number of possible alternatives to sequential Monte Carlo methods exist, such as
                variations of Kalman filtering like extended or unscented Kalman filters <xref ref-type="bibr" rid="pcbi.1000379-Wan1">[48]</xref>,<xref ref-type="bibr" rid="pcbi.1000379-Julier1">[49]</xref>,
                variational approaches (see <xref ref-type="bibr" rid="pcbi.1000379-Penny1">[50]</xref>) and approximate innovation methods <xref ref-type="bibr" rid="pcbi.1000379-Sotero1">[45]</xref>,<xref ref-type="bibr" rid="pcbi.1000379-Jimenez1">[51]</xref>,<xref ref-type="bibr" rid="pcbi.1000379-Riera1">[52]</xref>. We here
                opted for a sequential Monte Carlo method because it has the advantage of allowing
                the approximation of arbitrary distributions and expectations. This is of particular
                importance in the problem at hand because a) we specifically wish to capture the
                nonlinearities in the problem as well as possible and b) the distributions over the
                unobserved states are highly non-Gaussian, due to both the nonlinearities but also
                due to unit bounds on the gates.</p>
            <p>Model-based smoothing thus provides a well-founded alternative to standard smoothing
                techniques, and, importantly, allows smoothing of data without any averaging over
                either multiple cells or multiple trials <xref ref-type="bibr" rid="pcbi.1000379-Golowasch1">[53]</xref>. This allows the
                inference of unobserved variables that have an effect on the observed variable. For
                example, just as one can infer the channels' open fractions, one can
                estimate the voltage from pure [Ca<sup>2+</sup>]
                recordings (data not shown). The formulation presented makes it also straightforward
                to combine measurements from various variables, say
                [Ca<sup>2+</sup>] and transmembrane voltage, simply by
                appropriately defining the observation density <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e271" xlink:type="simple"/></inline-formula>. We should emphasize, though, that the techniques themselves are
                not novel. Rather, this paper aims to point out to what extent these techniques are
                promising for cellular imaging.</p>
            <p>The demand, when smoothing, for an accurate knowledge of the cell's
                parameters is addressed in the learning part of the paper where some of the
                important parameters are inferred accurately from small amounts of data. One
                instructive finding is that adding noise to the observations did not hurt our
                inference on average, though it did make it slower and more variable (note the wider
                error bars in <xref ref-type="fig" rid="pcbi-1000379-g007">Figure 7</xref>). In the
                higher-dimensional cases, we found that the dimensions in parameter space which have
                least effect on the models' behavior were also least well inferred. This
                may replicate the reports of significant flat (although not disconnected) regions in
                parameter space revealed in extensive parametric fits using other methods <xref ref-type="bibr" rid="pcbi.1000379-Achard1">[19]</xref>. A
                number of parameters also remain beyond the reach of the methods discussed here,
                notably the kinetic channel parameters; this is the objective of the non-parametric
                inference in the last section of the <xref ref-type="sec" rid="s3">
                    <italic>Results</italic>
                </xref>, and also of further ongoing work.</p>
            <p>A number of additional questions remain open. Perhaps the fundamental direction for
                future research involves the analysis of models in which the nonlinear hidden
                variable <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000379.e272" xlink:type="simple"/></inline-formula> is high-dimensional. As we saw in section <italic>EM –
                    inferrring cellular parameters</italic>, our basic particle smoothing-EM
                methodology can break down in this high-dimensional setting. The statistical
                literature suggests two standard options here. First, we could replace the particle
                smoothing method with more general (but more computationally expensive) Markov chain
                Monte Carlo (MCMC) methods <xref ref-type="bibr" rid="pcbi.1000379-Liu1">[54]</xref> for computing the necessary sufficient statistics
                for inference in our model. Designing efficient MCMC techniques suitable for
                high-dimensional multicompartmental neural models remains a completely open research
                topic. Second, to combat the multicollinearity diagnosed in <xref ref-type="fig" rid="pcbi-1000379-g011">Figure 11</xref> (see also Figure 6 of <xref ref-type="bibr" rid="pcbi.1000379-Huys1">[23]</xref>), we could replace the
                maximum-likelihood estimates considered here with maximum a posteriori (maximum
                penalized likelihood) estimates, by incorporating terms in our objective function
                (7) to penalize parameter settings which are believed to be unlikely a priori. As
                discussed in section <italic>Estimation of subthreshold nonlinearity by
                    nonparametric EM</italic>, the EM algorithm for maximum penalized likelihood
                estimation follows exactly the same structure as the standard EM algorithm for
                maximum likelihood estimation, and therefore our methodology may easily be adapted
                for this case. Finally, a third option is to proceed along the direction indicated
                in section <italic>Estimation of subthreshold nonlinearity by nonparametric
                EM</italic>: instead of attempting to fit the parameters of our model perfectly, in
                many cases we can develop good voltage smoothers using a cruder, approximate model
                whose parameters may be estimated much more tractably. We expect that a combination
                of these three strategies will prove to be crucial as optimal filtering of nonlinear
                voltage- and calcium-sensitive dendritic imaging data becomes more prevalent as a
                basic tool in systems neuroscience.</p>
        </sec>
        <sec id="s5">
            <title>Supporting Information</title>
            <supplementary-material id="pcbi.1000379.s001" mimetype="video/quicktime" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000379.s001" xlink:type="simple">
                <label>Video S1</label>
                <caption>
                    <p>Kalman smoother video. The video shows the inference of the underlying
                        voltage in a passive cell from intermittent recordings along the dendrites.
                        The left panel shows the true voltage; the middle panel the measurements
                        (black means no measurement from that dendritic location at that time, cf.
                            <xref ref-type="fig" rid="pcbi-1000379-g004">Figure 4</xref>); and the
                        right panel the reconstructed voltage in the entire cell.</p>
                    <p>(1.63 MB MOV)</p>
                </caption>
            </supplementary-material>
        </sec>
    </body>
    <back>
        <ack>
            <p>We would like to thank Misha Ahrens, Arnd Roth and Joshua Vogelstein for very
                valuable discussions and detailed comments. A preliminary version of this work has
                appeared in abstract form as <xref ref-type="bibr" rid="pcbi.1000379-Huys2">[55]</xref>.</p>
        </ack>
        <ref-list>
            <title>References</title>
            <ref id="pcbi.1000379-Chien1">
                <label>1</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Chien</surname>
                            <given-names>CB</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Pine</surname>
                            <given-names>J</given-names>
                        </name>
                    </person-group>
                    <year>1991</year>
                    <article-title>Voltage-sensitive dye recording of action potentials and synaptic
                        potentials from sympathetic microcultures.</article-title>
                    <source>Biophys J</source>
                    <volume>60</volume>
                    <fpage>697</fpage>
                    <lpage>711</lpage>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Djurisic1">
                <label>2</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Djurisic</surname>
                            <given-names>M</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Antic</surname>
                            <given-names>S</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Chen</surname>
                            <given-names>W</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Zecevic</surname>
                            <given-names>D</given-names>
                        </name>
                    </person-group>
                    <year>2004</year>
                    <article-title>Voltage imaging from dendrites of mitral cells: EPSP attenuation
                        and spike trigger zones.</article-title>
                    <source>J Neurosci</source>
                    <volume>24</volume>
                    <fpage>6703</fpage>
                    <lpage>6714</lpage>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Baker1">
                <label>3</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Baker</surname>
                            <given-names>BJ</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Kosmidis</surname>
                            <given-names>EK</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Vucinic</surname>
                            <given-names>D</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Falk</surname>
                            <given-names>CX</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Cohen</surname>
                            <given-names>LB</given-names>
                        </name>
                        <etal/>
                    </person-group>
                    <year>2005</year>
                    <article-title>Imaging brain activity with voltage- and calcium-sensitive dyes.</article-title>
                    <source>Cell Mol Neurobiol</source>
                    <volume>25</volume>
                    <fpage>245</fpage>
                    <lpage>82</lpage>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Nuriya1">
                <label>4</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Nuriya</surname>
                            <given-names>M</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Jiang</surname>
                            <given-names>J</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Nemet</surname>
                            <given-names>B</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Eisenthal</surname>
                            <given-names>KB</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Yuste</surname>
                            <given-names>R</given-names>
                        </name>
                    </person-group>
                    <year>2006</year>
                    <article-title>Imaging membrane potential in dendritic spines.</article-title>
                    <source>Proc Natl Acad Sci USA</source>
                    <volume>103</volume>
                    <fpage>786</fpage>
                    <lpage>9</lpage>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Canepari1">
                <label>5</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Canepari</surname>
                            <given-names>M</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Djurisic</surname>
                            <given-names>M</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Zecevic</surname>
                            <given-names>D</given-names>
                        </name>
                    </person-group>
                    <year>2007</year>
                    <article-title>Dendritic signals from rat hippocampal CA1 pyramidal neurons
                        during coincident pre- and post-synaptic activity: a combined voltage- and
                        calciumimaging study.</article-title>
                    <source>J Physiol</source>
                    <volume>580</volume>
                    <fpage>463</fpage>
                    <lpage>484</lpage>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Stuart1">
                <label>6</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Stuart</surname>
                            <given-names>GJ</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Palmer</surname>
                            <given-names>LM</given-names>
                        </name>
                    </person-group>
                    <year>2006</year>
                    <article-title>Imaging membrane potential in dendrites and axons of single
                        neurons.</article-title>
                    <source>Pflugers Arch</source>
                    <volume>453</volume>
                    <fpage>403</fpage>
                    <lpage>410</lpage>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Doucet1">
                <label>7</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Doucet</surname>
                            <given-names>A</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Godsill</surname>
                            <given-names>S</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Andrieu</surname>
                            <given-names>C</given-names>
                        </name>
                    </person-group>
                    <year>2000</year>
                    <article-title>On sequential Monte Carlo sampling methods for Bayesian
                        filtering.</article-title>
                    <source>Stat Comput</source>
                    <volume>10</volume>
                    <fpage>197</fpage>
                    <lpage>208</lpage>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Douc1">
                <label>8</label>
                <element-citation publication-type="other" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Douc</surname>
                            <given-names>R</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Cappe</surname>
                            <given-names>O</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Moulines</surname>
                            <given-names>E</given-names>
                        </name>
                    </person-group>
                    <year>2005</year>
                    <article-title>Comparison of Resampling Schemes for Particle Filtering.</article-title>
                    <fpage>64</fpage>
                    <lpage>69</lpage>
                    <comment>Image and Signal Processing and Analysis, 2005 ISPA 2005 Proceedings of
                        the 4th International Symposium on</comment>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Traub1">
                <label>9</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Traub</surname>
                            <given-names>RD</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Wong</surname>
                            <given-names>RK</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Miles</surname>
                            <given-names>R</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Michelson</surname>
                            <given-names>H</given-names>
                        </name>
                    </person-group>
                    <year>1991</year>
                    <article-title>A model of a CA3 hippocampal pyramidal neuron incorporating
                        voltage-clamp data on intrinsic conductances.</article-title>
                    <source>J Neurophysiol</source>
                    <volume>66</volume>
                    <fpage>635</fpage>
                    <lpage>650</lpage>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Poirazi1">
                <label>10</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Poirazi</surname>
                            <given-names>P</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Brannon</surname>
                            <given-names>T</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Mel</surname>
                            <given-names>BW</given-names>
                        </name>
                    </person-group>
                    <year>2003</year>
                    <article-title>Arithmetic of subthreshold synaptic summation in a model CA1
                        pyramidal cell.</article-title>
                    <source>Neuron</source>
                    <volume>37</volume>
                    <fpage>977</fpage>
                    <lpage>87</lpage>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Schaefer1">
                <label>11</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Schaefer</surname>
                            <given-names>AT</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Larkum</surname>
                            <given-names>ME</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Sakmann</surname>
                            <given-names>B</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Roth</surname>
                            <given-names>A</given-names>
                        </name>
                    </person-group>
                    <year>2003</year>
                    <article-title>Coincidence detection in pyramidal neurons is tuned by their
                        dendritic branching pattern.</article-title>
                    <source>J Neurophysiol</source>
                    <volume>89</volume>
                    <fpage>3143</fpage>
                    <lpage>54</lpage>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Bhalla1">
                <label>12</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Bhalla</surname>
                            <given-names>US</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Bower</surname>
                            <given-names>JM</given-names>
                        </name>
                    </person-group>
                    <year>1993</year>
                    <article-title>Exploring parameter space in detailed single neuron models:
                        Simulations of the mitral and granule cells of the olfactory bulb.</article-title>
                    <source>J Neurophysiol</source>
                    <volume>69</volume>
                    <fpage>1948</fpage>
                    <lpage>1965</lpage>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Baldi1">
                <label>13</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Baldi</surname>
                            <given-names>P</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Vanier</surname>
                            <given-names>M</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Bower</surname>
                            <given-names>JM</given-names>
                        </name>
                    </person-group>
                    <year>1998</year>
                    <article-title>On the use of Bayesian methods for evaluating compartmental
                        neural models.</article-title>
                    <source>J Comput Neurosci</source>
                    <volume>5</volume>
                    <fpage>285</fpage>
                    <lpage>314</lpage>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Vanier1">
                <label>14</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Vanier</surname>
                            <given-names>MC</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Bower</surname>
                            <given-names>JM</given-names>
                        </name>
                    </person-group>
                    <year>1999</year>
                    <article-title>A comparative survey of automated parameter-search methods for
                        compartmental neural models.</article-title>
                    <source>J Comput Neurosci</source>
                    <volume>7</volume>
                    <fpage>149</fpage>
                    <lpage>171</lpage>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Prinz1">
                <label>15</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Prinz</surname>
                            <given-names>AA</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Billimoria</surname>
                            <given-names>CP</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Marder</surname>
                            <given-names>E</given-names>
                        </name>
                    </person-group>
                    <year>2003</year>
                    <article-title>Hand-tuning conductance-based models: Construction and analysis
                        of databases of model neurons.</article-title>
                    <source>J Neurophysiol</source>
                    <volume>90</volume>
                    <fpage>3998</fpage>
                    <lpage>4015</lpage>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Jolivet1">
                <label>16</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Jolivet</surname>
                            <given-names>R</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Lewis</surname>
                            <given-names>TJ</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Gerstner</surname>
                            <given-names>W</given-names>
                        </name>
                    </person-group>
                    <year>2004</year>
                    <article-title>Generalized integrate-and-fire models of neuronal activity
                        approximate spike trains of a detailed model to a high degree of accuracy.</article-title>
                    <source>J Neurophysiol</source>
                    <volume>92</volume>
                    <fpage>959</fpage>
                    <lpage>976</lpage>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Keren1">
                <label>17</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Keren</surname>
                            <given-names>N</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Peled</surname>
                            <given-names>N</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Korngreen</surname>
                            <given-names>A</given-names>
                        </name>
                    </person-group>
                    <year>2005</year>
                    <article-title>Constraining compartmental models using multiple voltage
                        recordings and genetic algorithms.</article-title>
                    <source>J Neurophysiol</source>
                    <volume>94</volume>
                    <fpage>3730</fpage>
                    <lpage>42</lpage>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Bush1">
                <label>18</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Bush</surname>
                            <given-names>K</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Knight</surname>
                            <given-names>J</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Anderson</surname>
                            <given-names>C</given-names>
                        </name>
                    </person-group>
                    <year>2005</year>
                    <article-title>Optimizing conductance parameters of cortical neural models via
                        electrotonic partitions.</article-title>
                    <source>Neural Netw</source>
                    <volume>18</volume>
                    <fpage>488</fpage>
                    <lpage>496</lpage>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Achard1">
                <label>19</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Achard</surname>
                            <given-names>P</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Schutter</surname>
                            <given-names>ED</given-names>
                        </name>
                    </person-group>
                    <year>2006</year>
                    <article-title>Complex parameter landscape for a complex neuron model.</article-title>
                    <source>PLoS Comput Biol</source>
                    <volume>2</volume>
                    <fpage>e94</fpage>
                    <comment>doi:10.1371/journal.pcbi.0020094</comment>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Geit1">
                <label>20</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Geit</surname>
                            <given-names>WV</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Achard</surname>
                            <given-names>P</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Schutter</surname>
                            <given-names>ED</given-names>
                        </name>
                    </person-group>
                    <year>2007</year>
                    <article-title>Neurofitter: a parameter tuning package for a wide range of
                        electrophysiological neuron models.</article-title>
                    <source>Front Neuroinformatics</source>
                    <volume>1</volume>
                    <fpage>1</fpage>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Morse1">
                <label>21</label>
                <element-citation publication-type="other" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Morse</surname>
                            <given-names>TM</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Davison</surname>
                            <given-names>AP</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Hines</surname>
                            <given-names>ML</given-names>
                        </name>
                    </person-group>
                    <year>2001</year>
                    <article-title>Parameter space reduction in neuron model optimization through
                        minimization of residual voltage clamp current.</article-title>
                    <comment>Soc Neurosci, Online Viewer Abstract, Program No 6065</comment>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Wood1">
                <label>22</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Wood</surname>
                            <given-names>R</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Gurney</surname>
                            <given-names>KN</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Wilson</surname>
                            <given-names>CJ</given-names>
                        </name>
                    </person-group>
                    <year>2004</year>
                    <article-title>A novel parameter optimisation technique for compartmental models
                        applied to a model of a striatal medium spiny neuron.</article-title>
                    <source>Neurocomputing</source>
                    <volume>58–60</volume>
                    <fpage>1109</fpage>
                    <lpage>1116</lpage>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Huys1">
                <label>23</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Huys</surname>
                            <given-names>QJM</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Ahrens</surname>
                            <given-names>MB</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Paninski</surname>
                            <given-names>L</given-names>
                        </name>
                    </person-group>
                    <year>2006</year>
                    <article-title>Efficient estimation of detailed single-neuron models.</article-title>
                    <source>J Neurophysiol</source>
                    <volume>96</volume>
                    <fpage>872</fpage>
                    <lpage>890</lpage>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Dempster1">
                <label>24</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Dempster</surname>
                            <given-names>A</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Laird</surname>
                            <given-names>N</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Rubin</surname>
                            <given-names>D</given-names>
                        </name>
                    </person-group>
                    <year>1977</year>
                    <article-title>Maximum Likelihood from Incomplete Data via the EM Algorithm.</article-title>
                    <source>J Royal Stat Soc Series B (Methodological)</source>
                    <volume>39</volume>
                    <fpage>1</fpage>
                    <lpage>38</lpage>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-MacKay1">
                <label>25</label>
                <element-citation publication-type="other" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>MacKay</surname>
                            <given-names>DJ</given-names>
                        </name>
                    </person-group>
                    <year>2003</year>
                    <source>Information theory, inference and learning algorithms</source>
                    <publisher-loc>Cambridge, UK</publisher-loc>
                    <publisher-name>Cambridge University Press</publisher-name>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Koch1">
                <label>26</label>
                <element-citation publication-type="other" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Koch</surname>
                            <given-names>C</given-names>
                        </name>
                    </person-group>
                    <year>1999</year>
                    <article-title>Biophysics of Computation.</article-title>
                    <comment>Information processing in single neurons. OUP</comment>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Dayan1">
                <label>27</label>
                <element-citation publication-type="other" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Dayan</surname>
                            <given-names>P</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Abbott</surname>
                            <given-names>LF</given-names>
                        </name>
                    </person-group>
                    <year>2001</year>
                    <source>Theoretical Neuroscience. Computational Neuroscience</source>
                    <publisher-name>MIT Press</publisher-name>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Hodgkin1">
                <label>28</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Hodgkin</surname>
                            <given-names>AL</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Huxley</surname>
                            <given-names>AF</given-names>
                        </name>
                    </person-group>
                    <year>1952</year>
                    <article-title>A quantitative description of membrane current and its
                        application to conduction and excitation in nerve.</article-title>
                    <source>J Physiol</source>
                    <volume>117</volume>
                    <fpage>500</fpage>
                    <lpage>544</lpage>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Roth1">
                <label>29</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Roth</surname>
                            <given-names>A</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Häusser</surname>
                            <given-names>M</given-names>
                        </name>
                    </person-group>
                    <year>2001</year>
                    <article-title>Compartmental models of rat cerebellar purkinje cells based on
                        simultaneous somatic and dendritic patch-clamp recordings.</article-title>
                    <source>J Physiol</source>
                    <volume>535</volume>
                    <fpage>445</fpage>
                    <lpage>472</lpage>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Roweis1">
                <label>30</label>
                <element-citation publication-type="other" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Roweis</surname>
                            <given-names>S</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Ghahramani</surname>
                            <given-names>Z</given-names>
                        </name>
                    </person-group>
                    <year>1998</year>
                    <article-title>Learning nonlinear dynamical systems using an EM algorithm.</article-title>
                    <source>Advances in Neural Information Processing Systems (NIPS) 11</source>
                    <publisher-loc>Cambridge, MA</publisher-loc>
                    <publisher-name>MIT Press</publisher-name>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Salakhutdinov1">
                <label>31</label>
                <element-citation publication-type="other" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Salakhutdinov</surname>
                            <given-names>R</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Roweis</surname>
                            <given-names>S</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Ghahramani</surname>
                            <given-names>Z</given-names>
                        </name>
                    </person-group>
                    <year>2003</year>
                    <article-title>Optimization with EM and Expectation-Conjugate-Gradient.</article-title>
                    <fpage>672</fpage>
                    <lpage>679</lpage>
                    <comment>In: International Conference on Machine Learning. volume 20</comment>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Vogelstein1">
                <label>32</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Vogelstein</surname>
                            <given-names>J</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Watson</surname>
                            <given-names>B</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Packer</surname>
                            <given-names>A</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Jedynak</surname>
                            <given-names>B</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Yuste</surname>
                            <given-names>R</given-names>
                        </name>
                        <etal/>
                    </person-group>
                    <year>2008</year>
                    <article-title>Spike inference from calcium imaging using sequential monte carlo
                        methods.</article-title>
                    <source>Biophys J</source>
                    <comment>In Press</comment>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Olsson1">
                <label>33</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Olsson</surname>
                            <given-names>R</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Petersen</surname>
                            <given-names>K</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Lehn-Schioler</surname>
                            <given-names>T</given-names>
                        </name>
                    </person-group>
                    <year>2007</year>
                    <article-title>State-Space Models: From the EM Algorithm to a Gradient Approach.</article-title>
                    <source>Neural Computation</source>
                    <volume>19</volume>
                    <fpage>1097</fpage>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Djurisic2">
                <label>34</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Djurisic</surname>
                            <given-names>M</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Zecevic</surname>
                            <given-names>D</given-names>
                        </name>
                    </person-group>
                    <year>2005</year>
                    <article-title>Imaging of spiking and subthreshold activity of mitral cells with
                        voltage-sensitive dyes.</article-title>
                    <source>Ann N Y Acad Sci</source>
                    <volume>1048</volume>
                    <fpage>92</fpage>
                    <lpage>102</lpage>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Iyer1">
                <label>35</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Iyer</surname>
                            <given-names>V</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Hoogland</surname>
                            <given-names>TM</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Saggau</surname>
                            <given-names>P</given-names>
                        </name>
                    </person-group>
                    <year>2005</year>
                    <article-title>Fast functional imaging of single neurons using randomaccess
                        multiphoton (RAMP) microscopy.</article-title>
                    <source>J Neurophysiol</source>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Saggau1">
                <label>36</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Saggau</surname>
                            <given-names>P</given-names>
                        </name>
                    </person-group>
                    <year>2006</year>
                    <article-title>New methods and uses for fast optical scanning.</article-title>
                    <source>Curr Opin Neurobiol</source>
                    <volume>16</volume>
                    <fpage>543</fpage>
                    <lpage>550</lpage>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Durbin1">
                <label>37</label>
                <element-citation publication-type="other" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Durbin</surname>
                            <given-names>J</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Koopman</surname>
                            <given-names>S</given-names>
                        </name>
                    </person-group>
                    <year>2001</year>
                    <source>Time Series Analysis by State Space Methods</source>
                    <publisher-name>Oxford University Press</publisher-name>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Bickel1">
                <label>38</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Bickel</surname>
                            <given-names>P</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Li</surname>
                            <given-names>B</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Bengtsson</surname>
                            <given-names>T</given-names>
                        </name>
                    </person-group>
                    <year>2008</year>
                    <article-title>Sharp failure rates for the bootstrap particle filter in high
                        dimensions.</article-title>
                    <source>IMS Collections</source>
                    <volume>3</volume>
                    <fpage>318</fpage>
                    <lpage>329</lpage>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Hines1">
                <label>39</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Hines</surname>
                            <given-names>ML</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Morse</surname>
                            <given-names>T</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Migliore</surname>
                            <given-names>M</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Carnevale</surname>
                            <given-names>NT</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Shepherd</surname>
                            <given-names>GM</given-names>
                        </name>
                    </person-group>
                    <year>2004</year>
                    <article-title>Modeldb: A database to support computational neuroscience.</article-title>
                    <source>J Comput Neurosci</source>
                    <volume>17</volume>
                    <fpage>7</fpage>
                    <lpage>11</lpage>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Royeck1">
                <label>40</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Royeck</surname>
                            <given-names>M</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Horstmann</surname>
                            <given-names>MT</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Remy</surname>
                            <given-names>S</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Reitze</surname>
                            <given-names>M</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Yaari</surname>
                            <given-names>Y</given-names>
                        </name>
                        <etal/>
                    </person-group>
                    <year>2008</year>
                    <article-title>Role of axonal NaV1.6 sodium channels in action potential
                        initiation of CA1 pyramidal neurons.</article-title>
                    <source>J Neurophysiol</source>
                    <volume>100</volume>
                    <fpage>2361</fpage>
                    <lpage>80</lpage>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Gerstner1">
                <label>41</label>
                <element-citation publication-type="other" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Gerstner</surname>
                            <given-names>W</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Kistler</surname>
                            <given-names>WM</given-names>
                        </name>
                    </person-group>
                    <year>2002</year>
                    <source>Spiking Neuron Models: Single Neurons, Populations, Plasticity</source>
                    <publisher-loc>Cambridge, UK</publisher-loc>
                    <publisher-name>Cambridge University Press</publisher-name>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Green1">
                <label>42</label>
                <element-citation publication-type="other" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Green</surname>
                            <given-names>PJ</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Silverman</surname>
                            <given-names>BW</given-names>
                        </name>
                    </person-group>
                    <year>1994</year>
                    <source>Nonparametric regression and generalized linear models</source>
                    <publisher-name>Chapman &amp; Hall</publisher-name>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Paninski1">
                <label>43</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Paninski</surname>
                            <given-names>L</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Ahmadian</surname>
                            <given-names>Y</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Ferreira</surname>
                            <given-names>D</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Koyama</surname>
                            <given-names>S</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Rad</surname>
                            <given-names>KR</given-names>
                        </name>
                        <etal/>
                    </person-group>
                    <year>2009</year>
                    <article-title>A new look at state-space models for neural data.</article-title>
                    <source>J Comp Neuro Under Review</source>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Friston1">
                <label>44</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Friston</surname>
                            <given-names>K</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Mattout</surname>
                            <given-names>J</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Trujillo-Barreto</surname>
                            <given-names>N</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Ashburner</surname>
                            <given-names>J</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Penny</surname>
                            <given-names>W</given-names>
                        </name>
                    </person-group>
                    <year>2007</year>
                    <article-title>Variational free energy and the Laplace approximation.</article-title>
                    <source>Neuroimage</source>
                    <volume>34</volume>
                    <fpage>220</fpage>
                    <lpage>234</lpage>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Sotero1">
                <label>45</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Sotero</surname>
                            <given-names>R</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Trujillo-Barreto</surname>
                            <given-names>N</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Jimnez</surname>
                            <given-names>J</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Carbonell</surname>
                            <given-names>F</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Rodrguez-Rojas</surname>
                            <given-names>R</given-names>
                        </name>
                    </person-group>
                    <year>2008</year>
                    <article-title>Identification and comparison of stochastic metabolic/hemodynamic
                        models (sMHM) for the generation of the BOLD signal.</article-title>
                    <source>J Comput Neurosci</source>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Druckmann1">
                <label>46</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Druckmann</surname>
                            <given-names>S</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Banitt</surname>
                            <given-names>Y</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Gidon</surname>
                            <given-names>A</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Schrmann</surname>
                            <given-names>F</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Markram</surname>
                            <given-names>H</given-names>
                        </name>
                        <etal/>
                    </person-group>
                    <year>2007</year>
                    <article-title>A novel multiple objective optimization framework for
                        constraining conductance-based neuron models by experimental data.</article-title>
                    <source>Front Neurosci</source>
                    <volume>1</volume>
                    <fpage>7</fpage>
                    <lpage>18</lpage>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Druckmann2">
                <label>47</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Druckmann</surname>
                            <given-names>S</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Berger</surname>
                            <given-names>TK</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Hill</surname>
                            <given-names>S</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Schrmann</surname>
                            <given-names>F</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Markram</surname>
                            <given-names>H</given-names>
                        </name>
                        <etal/>
                    </person-group>
                    <year>2008</year>
                    <article-title>Evaluating automated parameter constraining procedures of neuron
                        models by experimental and surrogate data.</article-title>
                    <source>Biol Cybern</source>
                    <volume>99</volume>
                    <fpage>371</fpage>
                    <lpage>379</lpage>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Wan1">
                <label>48</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Wan</surname>
                            <given-names>E</given-names>
                        </name>
                        <name name-style="western">
                            <surname>van der Merwe</surname>
                            <given-names>R</given-names>
                        </name>
                    </person-group>
                    <year>2001</year>
                    <article-title>The Unscented Kalman Filter.</article-title>
                    <source>Kalman Filtering and Neural Networks</source>
                    <fpage>221</fpage>
                    <lpage>280</lpage>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Julier1">
                <label>49</label>
                <element-citation publication-type="other" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Julier</surname>
                            <given-names>S</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Uhlmann</surname>
                            <given-names>J</given-names>
                        </name>
                    </person-group>
                    <year>1997</year>
                    <article-title>A new extension of the Kalman filter to nonlinear systems.</article-title>
                    <comment>In: Int. Symp. Aerospace/Defense Sensing, Simul. and Controls. volume
                    3</comment>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Penny1">
                <label>50</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Penny</surname>
                            <given-names>W</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Kiebel</surname>
                            <given-names>S</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Friston</surname>
                            <given-names>K</given-names>
                        </name>
                    </person-group>
                    <year>2003</year>
                    <article-title>Variational Bayesian inference for fMRI time series.</article-title>
                    <source>Neuroimage</source>
                    <volume>19</volume>
                    <fpage>727</fpage>
                    <lpage>741</lpage>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Jimenez1">
                <label>51</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Jimenez</surname>
                            <given-names>J</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Ozaki</surname>
                            <given-names>T</given-names>
                        </name>
                    </person-group>
                    <year>2006</year>
                    <article-title>An approximate innovation method for the estimation of diffusion
                        processes from discrete data.</article-title>
                    <source>Journal of Time Series Analysis</source>
                    <volume>27</volume>
                    <fpage>77</fpage>
                    <lpage>97</lpage>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Riera1">
                <label>52</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Riera</surname>
                            <given-names>JJ</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Watanabe</surname>
                            <given-names>J</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Kazuki</surname>
                            <given-names>I</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Naoki</surname>
                            <given-names>M</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Aubert</surname>
                            <given-names>E</given-names>
                        </name>
                        <etal/>
                    </person-group>
                    <year>2004</year>
                    <article-title>A state-space model of the hemodynamic approach: nonlinear
                        filtering of BOLD signals.</article-title>
                    <source>Neuroimage</source>
                    <volume>21</volume>
                    <fpage>547</fpage>
                    <lpage>567</lpage>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Golowasch1">
                <label>53</label>
                <element-citation publication-type="journal" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Golowasch</surname>
                            <given-names>J</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Goldman</surname>
                            <given-names>MS</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Abbott</surname>
                            <given-names>LF</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Marder</surname>
                            <given-names>E</given-names>
                        </name>
                    </person-group>
                    <year>2002</year>
                    <article-title>Failure of averaging in the construction of a conductance-based
                        neuron model.</article-title>
                    <source>J Neurophysiol</source>
                    <volume>87</volume>
                    <fpage>1129</fpage>
                    <lpage>1131</lpage>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Liu1">
                <label>54</label>
                <element-citation publication-type="other" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Liu</surname>
                            <given-names>J</given-names>
                        </name>
                    </person-group>
                    <year>2002</year>
                    <article-title>Monte Carlo Strategies in Scientific Computing.</article-title>
                    <publisher-name>Springer</publisher-name>
                </element-citation>
            </ref>
            <ref id="pcbi.1000379-Huys2">
                <label>55</label>
                <element-citation publication-type="other" xlink:type="simple">
                    <person-group person-group-type="author">
                        <name name-style="western">
                            <surname>Huys</surname>
                            <given-names>QJM</given-names>
                        </name>
                        <name name-style="western">
                            <surname>Paninski</surname>
                            <given-names>L</given-names>
                        </name>
                    </person-group>
                    <year>2006</year>
                    <article-title>Model-based optimal interpolation and filtering for noisy,
                        intermittent biophysical recordings.</article-title>
                    <comment>Fifteenth Annual Computational Neuroscience Meeting</comment>
                </element-citation>
            </ref>
        </ref-list>
        
    </back>
</article>