<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article
  PUBLIC "-//NLM//DTD Journal Publishing DTD v3.0 20080202//EN" "http://dtd.nlm.nih.gov/publishing/3.0/journalpublishing3.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="3.0" xml:lang="en">
<front>
<journal-meta>
<journal-id journal-id-type="publisher-id">plos</journal-id>
<journal-id journal-id-type="nlm-ta">PLoS Comput Biol</journal-id>
<journal-id journal-id-type="pmc">ploscomp</journal-id><journal-title-group>
<journal-title>PLoS Computational Biology</journal-title></journal-title-group>
<issn pub-type="ppub">1553-734X</issn>
<issn pub-type="epub">1553-7358</issn>
<publisher>
<publisher-name>Public Library of Science</publisher-name>
<publisher-loc>San Francisco, USA</publisher-loc></publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="publisher-id">PCOMPBIOL-D-12-01980</article-id>
<article-id pub-id-type="doi">10.1371/journal.pcbi.1003189</article-id>
<article-categories><subj-group subj-group-type="heading"><subject>Research Article</subject></subj-group><subj-group subj-group-type="Discipline-v2"><subject>Biology</subject><subj-group><subject>Computational biology</subject></subj-group><subj-group><subject>Genomics</subject></subj-group></subj-group><subj-group subj-group-type="Discipline-v2"><subject>Engineering</subject><subj-group><subject>Signal processing</subject></subj-group></subj-group></article-categories>
<title-group>
<article-title>A Self-Directed Method for Cell-Type Identification and Separation of Gene Expression Microarrays</article-title>
<alt-title alt-title-type="running-head">Self-Directed Separation of Gene Expression</alt-title>
</title-group>
<contrib-group>
<contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Zuckerman</surname><given-names>Neta S.</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref></contrib>
<contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Noam</surname><given-names>Yair</given-names></name><xref ref-type="aff" rid="aff2"><sup>2</sup></xref></contrib>
<contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Goldsmith</surname><given-names>Andrea J.</given-names></name><xref ref-type="aff" rid="aff2"><sup>2</sup></xref></contrib>
<contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Lee</surname><given-names>Peter P.</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref><xref ref-type="corresp" rid="cor1"><sup>*</sup></xref></contrib>
</contrib-group>
<aff id="aff1"><label>1</label><addr-line>Department of Cancer Immunotherapeutics and Tumor Immunology, City of Hope and Beckman Research Institute, Duarte, California, United States of America</addr-line></aff>
<aff id="aff2"><label>2</label><addr-line>Department of Electrical Engineering, Stanford University, Stanford, California, United States of America</addr-line></aff>
<contrib-group>
<contrib contrib-type="editor" xlink:type="simple"><name name-style="western"><surname>Przytycka</surname><given-names>Teresa M.</given-names></name>
<role>Editor</role>
<xref ref-type="aff" rid="edit1"/></contrib>
</contrib-group>
<aff id="edit1"><addr-line>National Center for Biotechnology Information (NCBI), United States of America</addr-line></aff>
<author-notes>
<corresp id="cor1">* E-mail: <email xlink:type="simple">plee@coh.org</email></corresp>
<fn fn-type="conflict"><p>The authors have declared that no competing interests exist.</p></fn>
<fn fn-type="con"><p>Conceived the project: NSZ PPL. Led the project, carried out designing and coding the algorithm, data mining and acquisition, algorithm simulations and drafting the manuscript: NSZ. Carried out the design of the algorithm and helped draft the manuscript: YN. Contributed to discussions and revised the manuscript: AJG PPL.</p></fn>
</author-notes>
<pub-date pub-type="collection"><month>8</month><year>2013</year></pub-date>
<pub-date pub-type="epub"><day>22</day><month>8</month><year>2013</year></pub-date>
<volume>9</volume>
<issue>8</issue>
<elocation-id>e1003189</elocation-id>
<history>
<date date-type="received"><day>18</day><month>12</month><year>2012</year></date>
<date date-type="accepted"><day>7</day><month>7</month><year>2013</year></date>
</history>
<permissions>
<copyright-year>2013</copyright-year>
<copyright-holder>Zuckerman et al</copyright-holder><license xlink:type="simple"><license-p>This is an open-access article distributed under the terms of the Creative Commons Attribution License, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p></license></permissions><related-article id="RA1" related-article-type="companion" ext-link-type="uri" vol="" page="e1002972" xlink:type="simple" xlink:href="info:doi/10.1371/journal.pcbi.1002972"> <article-title>New Methods Section in PLOS Computational Biology</article-title></related-article>
<abstract>
<p>Gene expression analysis is generally performed on heterogeneous tissue samples consisting of multiple cell types. Current methods developed to separate heterogeneous gene expression rely on prior knowledge of the cell-type composition and/or signatures - these are not available in most public datasets. We present a novel method to identify the cell-type composition, signatures and proportions per sample without need for a-priori information. The method was successfully tested on controlled and semi-controlled datasets and performed as accurately as current methods that do require additional information. As such, this method enables the analysis of cell-type specific gene expression using existing large pools of publically available microarray datasets.</p>
</abstract>
<abstract abstract-type="summary"><title>Author Summary</title>
<p>Gene expression microarrays are widely used to uncover biological insights. Most microarray experiments profile whole tissues containing mixtures of multiple cell-types. As such, gene expression differences between samples may be due to different cellular compositions or biological differences, highly limiting the conclusions derived from the analysis. All current approaches to computationally separate the heterogeneous gene expression to individual cell-types require that the identity, relative amount of the cell-types in the tissue or their individual gene expression are known. Publically available microarray-based datasets, which include thousands of patient samples, do not usually measure this information, rendering existing separation methods unusable. We developed a novel approach to estimate the number of cell-types, identities, individual gene expression and relative proportions in heterogeneous tissues with no a-priori information except for an initial estimate of the cell-types in the tissue analyzed and general reference signatures of these cell-types that may be easily obtained from public databases. We successfully applied our method to microarray datasets, yielding highly accurate estimations, which often exceed the performance of separation methods that require prior information. Thus, our method can be accurately applied to any heterogeneous dataset, where re-examination and analysis of the individual cell-types in the heterogeneous tissue can aid in discovering new aspects regarding these diseases.</p>
</abstract>
<funding-group><funding-statement>This work was supported by DoD Era of Hope Scholar Award BC051650 (NSZ and PPL) and the NSF Center for Science of Information (YN and AJG). The funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.</funding-statement></funding-group><counts><page-count count="12"/></counts></article-meta>
</front>
<body><sec id="s1">
<title/>
<disp-quote>
<p>This is a <italic>PLOS Computational Biology</italic> Methods article.</p>
</disp-quote></sec><sec id="s2">
<title>Introduction</title>
<p>Gene-expression profiling of whole tissues is affected by the different cell types that exist in the tissue and their relative proportions. Thus, changes detected by differential expression analysis may reflect differences in the proportions of the cell-types between samples rather than an important mechanistic change in gene-expression. For example, the proportion of tumor cells in breast cancer biopsies were found to significantly affect expression profiles, where consideration of these proportions improved response prediction <xref ref-type="bibr" rid="pcbi.1003189-Cleator1">[1]</xref>. Therefore, profiling of heterogeneous tissues rather than sorted cell-types can greatly limit the conclusions derived from such analyses.</p>
<p>Solutions for experimentally separating cell-types from heterogeneous tissues include laser-capture microdissection to isolate morphologically distinguishable cells and flow cell sorting to purify cell-types from a tissue. However, in addition to the time-consuming nature of these methods, they may result in insufficient quantities of RNA, where amplification steps may introduce artifacts to the gene expression data <xref ref-type="bibr" rid="pcbi.1003189-Mills1">[2]</xref>. Single cell RNA sequencing is becoming feasible; however, experimental costs are high and few studies utilize this method on a large patient pool. To address this issue, several approaches to computationally separate expression profiles of heterogeneous tissues into their constituent cell-types along with their relative proportions per sample have been developed. Most approaches utilize a linear model that has been demonstrated to yield accurate expression estimates <xref ref-type="bibr" rid="pcbi.1003189-ShenOrr1">[3]</xref>, <xref ref-type="bibr" rid="pcbi.1003189-Abbas1">[4]</xref>; in this model the gene-expressions of each cell-type are added up to form a mixed expression, where each cell-type is weighted according to its relative proportion in the tissue.</p>
<p>All currently existing separation methods require some a-priori information about the tissue analyzed, such as the number of cell-types and their relative proportions in the tissue <xref ref-type="bibr" rid="pcbi.1003189-ShenOrr1">[3]</xref>, <xref ref-type="bibr" rid="pcbi.1003189-Stuart1">[5]</xref>, or the number of cell-types, their identity and their purified gene expression <xref ref-type="bibr" rid="pcbi.1003189-Abbas1">[4]</xref>, <xref ref-type="bibr" rid="pcbi.1003189-Wang1">[6]</xref>–<xref ref-type="bibr" rid="pcbi.1003189-Lu1">[8]</xref>, or just the number of cell-types in the tissue <xref ref-type="bibr" rid="pcbi.1003189-Venet1">[9]</xref>–<xref ref-type="bibr" rid="pcbi.1003189-Kuhn1">[11]</xref>. A preliminary attempt to estimate the number of cell-types in the mixed data, but not their identities, has also been proposed <xref ref-type="bibr" rid="pcbi.1003189-Lahdesmaki1">[12]</xref>. However, most studies do not purify the different cell populations in the tissue, enumerate their proportions or verify their identity, rendering these methods inapplicable to separation of such heterogeneous gene-expression datasets.</p>
<p>In this study, we have developed a novel approach to blindly separate heterogeneous gene-expression data, i.e., without using any specific prior information regarding the analyzed dataset. In addition to separating the heterogeneous tissue to the individual gene expression profiles of its constituent cell-types and their relative proportions per sample, the algorithm described here performs an extra step of identifying the number of cell-types in the tissue and their identities. Compared to existing methods, the only a-priori information the algorithm requires is an initial guess of the cell-types that may exist in the analyzed tissue and purified reference signatures of these cell-types, which may be found in abundance in publically available databases. We have successfully tested our algorithm on three publically available databases in which all the conditions are controlled and on a publically available semi-controlled dataset with estimated cell-type proportions.</p>
<p>To our knowledge, this method is the first that can practically be applied, in a “plug and play” fashion, to any existing dataset of heterogeneous tissue samples, in order to identify the cell-types in the samples, their identities, their proportions per sample and their separated gene-expression signatures without requiring any prior knowledge.</p>
</sec><sec id="s3">
<title>Results</title>
<sec id="s3a">
<title>A novel approach to blindly identify and separate the cell-types in heterogeneous tissues</title>
<p>The proposed algorithm is based on a hyper-spectral imaging method developed by Piper <italic>et al.</italic> <xref ref-type="bibr" rid="pcbi.1003189-Piper1">[13]</xref>. It is designed to identify the number of cell-types in heterogeneous tissue samples, their identities, their relative proportions per sample and separate their individual gene expression signatures. The proposed algorithm includes three parts (see <xref ref-type="sec" rid="s5">methods</xref> section for more details). In the first part, non-negative matrix factorization <xref ref-type="bibr" rid="pcbi.1003189-Piper1">[13]</xref> is used to obtain an initial estimate of expression profiles for each cell-type. A rough initial estimate of the numbers and identities of the cell-types in the tissue is required. This estimate can include cell-types that may not exist in the tissue. However, if a true cell-type is not included in the initial estimate, then the algorithm will not detect this cell-type and there may be ambiguities in the resulting cell-type signatures and proportions. In addition, purified reference signatures are required for each of the cell-types included in the initial estimate. Such reference signatures may be found in abundance in the Gene Expression Omnibus (GEO) <xref ref-type="bibr" rid="pcbi.1003189-Barrett1">[14]</xref> and may be general, i.e., not be disease, tissue, experiment or study-specific. In the second part of the algorithm, the true number of cell-types is estimated using the symmetric Kullback-Leibler divergence (SKLD) between each of the estimated cell-type profiles and the initial cell-type reference signatures, where the closest estimated profiles are then chosen as the final cell-types. SKLD, a measure used to calculate the difference between two probability distributions, is used here as a measure of distance, as we describe in the <xref ref-type="sec" rid="s5">methods</xref> section under (5). In the final part, the cell-type proportions are computed per sample, using the method of non-negative least squares (NNLS), a method that solves matrix equations algebraically with an added constraint for non-negative elements, as we describe in the <xref ref-type="sec" rid="s5">methods</xref> section under <xref ref-type="disp-formula" rid="pcbi.1003189.e025">equation (3)</xref>. Additional adjustments, motivated by the application of the algorithm to gene-expression data include: (a) majority voting, where the final identity of the cell-types is chosen from the results of several algorithm runs with random initializations, and (b) usage of classes, where several input reference signatures may be grouped into one “class” of cell-type. These adjustments were added to the algorithm to improve separation capabilities of cell-types with similar signatures and increase the algorithm's robustness to noisy reference signatures (for additional details see the <xref ref-type="sec" rid="s5">methods</xref> section).</p>
</sec><sec id="s3b">
<title>Application of the algorithm to controlled datasets</title>
<p>We tested the algorithm on three publically available datasets in which known proportions of known cell types were mixed and their gene-expression was measured. The liver-brain-lung dataset includes samples of rat liver, brain and lung cell mixtures <xref ref-type="bibr" rid="pcbi.1003189-ShenOrr1">[3]</xref>. The purified cell-type reference signatures were collected from GEO and included rat liver, brain, lung, intestine, heart and granulosa cell gene-expression profiles from different studies (see “microarray data” in <xref ref-type="sec" rid="s5">methods</xref> section; <xref ref-type="supplementary-material" rid="pcbi.1003189.s001">Figure S1A</xref>). Although the mixed samples included only three cell-types, more than three cell-types were inputted to the algorithm as the initial number of cell-types to test the algorithm's ability to discern the correct number. The algorithm successfully identified three cell-types in the mixed samples and their correct identities, i.e., liver, brain and lung. High correlations were found between the gene-expression profiles of each estimated cell-type to the profile of its corresponding purified cell-type taken from the same study (<xref ref-type="fig" rid="pcbi-1003189-g001">Figure 1A</xref>), in addition to shortest SKLD distances (<xref ref-type="supplementary-material" rid="pcbi.1003189.s001">Figure S1B</xref>). These correlations, obtained by our blind separation method, were in the range of the correlations reported in the Shen Orr <italic>et al.</italic> study where the number of cell-types, their identities and their proportions per sample were input to the algorithm, and even higher in the case of the lung cell-type <xref ref-type="bibr" rid="pcbi.1003189-ShenOrr1">[3]</xref>. High correlations were also obtained between the actual and estimated cell-type proportions (<xref ref-type="fig" rid="pcbi-1003189-g002">Figure 2A</xref>), in addition to shortest SKLD distances (<xref ref-type="supplementary-material" rid="pcbi.1003189.s001">Figure S1C</xref>). Sample-by-sample comparison of the estimated proportions of each cell-type shows that our algorithm is successful in reconstructing accurate proportions per cell-type per sample, with an average absolute error of 3.4%±2.3 (<xref ref-type="fig" rid="pcbi-1003189-g003">Figure 3A</xref>). In addition, the resulting expression signatures had shorter SKLD distances and thus were closer to the original purified expression profiles compared to the input profiles, demonstrating that the algorithm successfully advanced the input signatures (<xref ref-type="supplementary-material" rid="pcbi.1003189.s001">Figure S1D</xref>). Note that we use SKLD distances as the distance measure in results testing, as it is the measure used in the algorithm itself.</p>
<fig id="pcbi-1003189-g001" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003189.g001</object-id><label>Figure 1</label><caption>
<title>Blind separation yields accurate estimations of separated cell-type gene-expression.</title>
<p>Gene expression measurements of each separated cell-type plotted against the gene expression of its corresponding purified cell type from the same study, in (<bold>A</bold>) liver-brain-lung dataset <xref ref-type="bibr" rid="pcbi.1003189-ShenOrr1">[3]</xref>, (<bold>B</bold>) heart-brain dataset <xref ref-type="bibr" rid="pcbi.1003189-Affymetrix1">[15]</xref>, and (<bold>C</bold>) T-B-Monocytes dataset <xref ref-type="bibr" rid="pcbi.1003189-Abbas1">[4]</xref>. Correlation coefficients between the separated and purified gene expressions are denoted for each cell type. CT = cell-type, r = correlation coefficient.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003189.g001" position="float" xlink:type="simple"/></fig><fig id="pcbi-1003189-g002" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003189.g002</object-id><label>Figure 2</label><caption>
<title>Blind separation yields accurate estimations of separated cell-type proportions.</title>
<p>Known cell-type proportions plotted against the estimated cell-type proportions in (<bold>A</bold>) liver-brain-lung dataset <xref ref-type="bibr" rid="pcbi.1003189-ShenOrr1">[3]</xref>, (<bold>B</bold>) heart-brain dataset <xref ref-type="bibr" rid="pcbi.1003189-Affymetrix1">[15]</xref>, (<bold>C</bold>) T-B-Monocytes dataset <xref ref-type="bibr" rid="pcbi.1003189-Abbas1">[4]</xref>, and (<bold>D</bold>) prostate cancer dataset <xref ref-type="bibr" rid="pcbi.1003189-Wang2">[7]</xref>. Correlation coefficients between the known and estimated proportions are denoted for each cell-type.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003189.g002" position="float" xlink:type="simple"/></fig><fig id="pcbi-1003189-g003" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003189.g003</object-id><label>Figure 3</label><caption>
<title>Blind separation yields accurate estimates of cell-type proportions per sample.</title>
<p>Comparisons between the known cell-type proportions and the estimated proportions per-sample for cell-types in the controlled datasets. (<bold>A</bold>) The liver-brain-lung dataset <xref ref-type="bibr" rid="pcbi.1003189-ShenOrr1">[3]</xref> included 33 samples, (B) The heart-brain dataset <xref ref-type="bibr" rid="pcbi.1003189-Affymetrix1">[15]</xref> included 27 samples, and (<bold>C</bold>) The T-B-Monocytes dataset <xref ref-type="bibr" rid="pcbi.1003189-Abbas1">[4]</xref> included 12 samples. Known proportions are shown in the grey columns, denoted by “s” and were measured as triplicates; estimates yielded by the blind separation algorithm are shown in the white columns and are denoted by “e”.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003189.g003" position="float" xlink:type="simple"/></fig>
<p>The Heart-Brain dataset includes samples of heart and brain human cell mixtures <xref ref-type="bibr" rid="pcbi.1003189-Affymetrix1">[15]</xref>. Purified cell reference signatures were collected from GEO and included myocardial (heart) cells, brain cells from the entorhinal cortex and grey matter, oocytes and hepatocytes from different studies (see “microarray data” in <xref ref-type="sec" rid="s5">methods</xref> section; <xref ref-type="supplementary-material" rid="pcbi.1003189.s002">Figure S2A</xref>). We unified the two heart signatures obtained from different studies under the class “heart” and the two brain signatures obtained from different brain tissues under the class “brain”. The algorithm successfully identified the true cell-types, i.e., heart and brain. The cortex brain cell-type was identified in all algorithm majority voting runs whereas the brain grey-matter cell-type was identified in only 20% of the majority voting runs, suggesting that the cells in the mixtures are most probably cortex cells or cells with a similar signature. The estimated cell-type expression profiles showed the highest correlations (<xref ref-type="fig" rid="pcbi-1003189-g001">Figure 1B</xref>) and shortest SKLD distances (<xref ref-type="supplementary-material" rid="pcbi.1003189.s002">Figure S2B</xref>) to their corresponding purified cell-types taken from the same study. High correlations (<xref ref-type="fig" rid="pcbi-1003189-g002">Figure 2B</xref>) and shortest SKLD distances (<xref ref-type="supplementary-material" rid="pcbi.1003189.s002">Figure S2C</xref>) between the estimated and known cell-type proportions were obtained, with a low average absolute error of 1.7%±1.85 (<xref ref-type="fig" rid="pcbi-1003189-g003">Figure 3B</xref>). Finally, the resulting expression signatures were closer to the original purified expression profiles compared to the input profiles (<xref ref-type="supplementary-material" rid="pcbi.1003189.s002">Figure S2D</xref>).</p>
<p>To test separation of cell-types with similar signatures, we chose the T-B-Monocytes dataset, containing mixtures of T, Monocyte and two types of B cell lines <xref ref-type="bibr" rid="pcbi.1003189-Abbas1">[4]</xref>. Purified cell reference signatures collected from GEO included human immune cell lines of T-cells, B-cells, Monocytes, NK cells and epithelial cells (see “microarray data” in <xref ref-type="sec" rid="s5">methods</xref> section; <xref ref-type="supplementary-material" rid="pcbi.1003189.s003">Figure S3A</xref>). The algorithm successfully identified all three cell-types (T, B, Monocytes) and also successfully discerned between the two types of B cell-lines, yielding a total of four resulting cell-types – T Jurkat, B Raji, B IM-9 and Monocyte THP-1 cell lines. High correlations were obtained between the gene-expression profiles of each estimated cell-type to the profile of its corresponding purified cell-type taken from the same study (<xref ref-type="fig" rid="pcbi-1003189-g001">Figure 1C</xref>) and between the estimated and known cell-type proportions (<xref ref-type="fig" rid="pcbi-1003189-g002">Figure 2C</xref>), in addition to shortest SKLD distances (<xref ref-type="supplementary-material" rid="pcbi.1003189.s003">Figures S3B–C</xref>). The average error in cell-type proportions per-sample obtained by our blind separation method was 5.7%±3.3 (<xref ref-type="fig" rid="pcbi-1003189-g003">Figure 3C</xref>), which is close to the error reported by the original study separating these same samples, where the number of cell-types, their identity and their gene expression profiles were given as an input <xref ref-type="bibr" rid="pcbi.1003189-Abbas1">[4]</xref>. In addition, the resulting expression signatures were closer to the original purified expression profiles compared to the input profiles (<xref ref-type="supplementary-material" rid="pcbi.1003189.s003">Figure S3D</xref>). A lower average error in cell-type proportions per sample (3.67%±3.04) and higher correlations between the estimated and known cell-type specific gene-expression profiles were obtained in an algorithm run where the two B cell-line types were unified under the “B cells” class (<xref ref-type="supplementary-material" rid="pcbi.1003189.s003">Figures S3E–I</xref>). In this run, where the goal was to separate between the different immune cell-types in the mixed samples, the algorithm successfully identified the three cell-types – T-cells, B-cells and Monocytes.</p>
</sec><sec id="s3c">
<title>Application of the algorithm to a semi-controlled dataset</title>
<p>We tested the algorithm on a semi-controlled dataset of prostate cancer in which cell-type proportions were estimated by a pathologist <xref ref-type="bibr" rid="pcbi.1003189-Wang2">[7]</xref>. The cell-types in the analyzed tissue were carcinoma, benign (BPHE) and dilated (DCAE) epithelial and stromal cells. Purified cell signatures of prostate tumor cell lines, benign prostate cells, normal prostate epithelial cells, stroma surrounding invasive prostate tumors and normal stroma were collected from GEO (see “microarray data” in <xref ref-type="sec" rid="s5">methods</xref> section; <xref ref-type="supplementary-material" rid="pcbi.1003189.s004">Figure S4A</xref>). Data were available for the percentage of tumor cells in each sample, thus classes unifying the prostate cell-lines and the other cell-types under “tumor” and “other”, respectively, were used. High correlations were obtained between the pathologist's estimated cell-type proportions and the cell-type proportions estimated by the algorithm (<xref ref-type="fig" rid="pcbi-1003189-g002">Figure 2D</xref>), with an average error per sample of 12.44%±12.41 (<xref ref-type="supplementary-material" rid="pcbi.1003189.s004">Figures S4B–C</xref>). Compared to the results obtained in the controlled datasets, the cell-type proportions prediction error was higher in this case. This could be due to the fact that no specific signatures for BPHE and DCAE cells were found within the same/similar microarray platforms. Therefore, general signatures for stromal and epithelial cells were used, which may have decreased the prediction accuracy. However, it is more likely that the pathologist's estimations of cell-type proportions were not fully accurate. Indeed, the lowest error calculated between the actual and estimated cell-type proportions in that study was: 9.5% and 12.5% for tumor and stromal cells, respectively <xref ref-type="bibr" rid="pcbi.1003189-Wang2">[7]</xref>, where our blind separation algorithm reached similar error rates with non-specific signatures.</p>
</sec></sec><sec id="s4">
<title>Discussion</title>
<p>Gene-expression analysis of whole tissues, which are heterogeneous in nature and consist of a mixture of several cell-types, are utilized extensively and are highly abundant in public repositories such as GEO <xref ref-type="bibr" rid="pcbi.1003189-Barrett1">[14]</xref>. However, it is now becoming clear that the identity, composition and profiles of individual cell-types are extremely important to the process of unraveling the biology of each cell-type population and the interplay between the populations in both healthy and disease states. Due to the expense and difficulties of separating them, only a limited amount of studies profile and analyze individual cell-types. More importantly, public repositories are replete with existing data of whole tissues including thousands of patients, treatments, tissues and cell-types. This rich trove of data is from experiments that may never be repeated using such large patient pool or experimental conditions. Our techniques can realize the great potential of these data, which contains much information about the constituent individual cell-types in heterogeneous tissues that, to date, have not been fully interrogated.</p>
<p>Computational methods have been developed to allow the separation of heterogeneous tissues into their cell-type constituent profiles and/or relative proportions <xref ref-type="bibr" rid="pcbi.1003189-ShenOrr1">[3]</xref>–<xref ref-type="bibr" rid="pcbi.1003189-Lahdesmaki1">[12]</xref>. However, all currently existing separation methods require that the number of cell-types in the tissue, their identity, or their relative proportions in the analyzed tissue are known. Such information rarely exists, as most profiling studies do not purify the cell-types in the tissue, extract their proportions or verify their identity, rendering the existing separation methods non-usable for most existing datasets; Rather, these datasets are usable only in experiments designed in advance to allow for the separation technique.</p>
<p>We have developed a separation method that requires no a-priori information about the tissue analyzed other than an initial rough estimate of the cell-types that may exist in the tissue samples analyzed. This is a reasonable input to ask for and relatively easy to find, as information regarding the composition of most tissues is readily available in the literature and public databases such as GEO are replete with many types of purified cell-types from various experiments. As our algorithm does not require the purified cell-type profiles to be disease, tissue or even study-specific, one can simply use any relevant purified profile as an input to the algorithm. These properties render our algorithm the only useful method to separate most publically available heterogeneous microarray datasets.</p>
<p>We successfully applied our separation technique to three controlled datasets with known proportions and cell types <xref ref-type="bibr" rid="pcbi.1003189-ShenOrr1">[3]</xref>, <xref ref-type="bibr" rid="pcbi.1003189-Abbas1">[4]</xref>, <xref ref-type="bibr" rid="pcbi.1003189-Affymetrix1">[15]</xref> in addition to a semi-controlled dataset where cell-type proportions per sample were estimated by a pathologist <xref ref-type="bibr" rid="pcbi.1003189-Wang2">[7]</xref>, to test the method on a dataset that resembles the heterogeneous datasets available in the literature rather than on datasets specifically engineered for separation. Our blind separation technique accurately extracted the relative cell-type proportions per sample and their separated gene-expression signatures and performed just as well, and in some cell-types even better, than other reported separation techniques that require different types of input information about the dataset analyzed to be available. Most importantly, our technique successfully identified the number of cell-types in the tissues analyzed and their identities. These features are not included in any of the reported separation techniques, and are in fact considered as an integral input for the usage of these techniques. It is these features that are mostly unavailable for publically available datasets, or any dataset in which they have not been experimentally identified. In addition, the cell-type populations and proportions in a tissue are not always consistent amongst different individuals, which renders the identification of those populations and their identities crucial.</p>
<p>The algorithm's robustness to varying input signatures was demonstrated by using additional cell-type signatures that were not related to the analyzed tissue as input to each controlled dataset (e.g. the intestine, heart and granulosa cell-types were input to the liver-brain-lung dataset). To address the algorithm's robustness to signatures of different qualities, signatures from different studies were used for the same cell-type and gathered under the same class (e.g two T-cell Jurkat and B-cell Raji cell-lines from different studies were input to the T-B-Monocytes dataset). The algorithm identified the correct number of cell-types and their correct identities in all examples. In general, the algorithm performed better when separating cell-types that were very different from one another as in the heart-brain dataset, compared to cell-types that were very similar to each other such as in the T-B-Monocyte dataset. However, in the latter example, given that no a-priori data about the mixed tissue was provided, the algorithm still yielded accurate results. In particular, the algorithm identified all three cell-types (T, B and Monocytes) with an error that was close to that reported by the original study where the number of cell-types, their identity and their true gene-expression profiles were given as an input <xref ref-type="bibr" rid="pcbi.1003189-Abbas1">[4]</xref>. Moreover, the algorithm also successfully separated the two B cell-lines, cell-types with an almost identical gene expression. A comparison between the true purified signatures from the same study to the input signatures mined from GEO and the resulting signatures inferred by our algorithm showed that, in each of the datasets explored, the resulting signatures were always closer to the true signatures than the signatures from GEO, demonstrating that our algorithm successfully identifies the input signatures close to the true ones.</p>
<p>Compared to existing algorithms, our algorithm yielded at least comparable results, and in some cases better results (such as predicting the lung cell-type in the liver-brain-lung dataset). An important distinction is that our algorithm does not require the a-priori information required in existing algorithms and, in contrast with those algorithms, it is able to determine the number of cell-types in the heterogeneous tissue and their identities. To demonstrate the importance of this added capability, we compared the performance of our algorithm to an NNMF approach, without the cell-type determination step, which is initialized in the same manner as our algorithm (<xref ref-type="supplementary-material" rid="pcbi.1003189.s005">Figures S5</xref>, <xref ref-type="supplementary-material" rid="pcbi.1003189.s006">S6</xref>). We also compared our algorithm's performance to that of a simple NNLS-based algorithm, used here as a bench-mark due to the fact that most existing algorithms are based on NNLS <xref ref-type="bibr" rid="pcbi.1003189-ShenOrr1">[3]</xref>–<xref ref-type="bibr" rid="pcbi.1003189-Lahdesmaki1">[12]</xref>, <xref ref-type="bibr" rid="pcbi.1003189-Repsilber1">[16]</xref> (<xref ref-type="supplementary-material" rid="pcbi.1003189.s007">Figure S7</xref>, <xref ref-type="supplementary-material" rid="pcbi.1003189.s008">S8</xref>). In both cases, even a small error in the guess of the number of cell-types (e.g. guessing 4 cell-types instead of 3) deteriorates the performance of these existing algorithms, demonstrating that the cell-type determination step is crucial for good separation. This emphasizes the usefulness of our algorithm not only in situations where no a-priori information exists, but also in the more common scenarios where one has a good but not perfect guess of the cell composition with an error of at most one or two cell-types.</p>
<p>In summary, our blind separation technique successfully identifies the cell-type composition in heterogeneous gene-expression data, and provides high-accuracy estimates of cell-type specific signatures and their relative proportions per sample. The only information the algorithm requires is an initial estimate of the cell-types that may exist in the tissue analyzed and their signatures, which can be easily found in public databases such as GEO. This method is especially advantageous for re-analyzing existing microarray data for which no additional information is available, allowing re-examination and extraction of information for individual cell-type populations while taking advantage of already-existing, large-scale microarray datasets.</p>
</sec><sec id="s5" sec-type="methods">
<title>Methods</title>
<sec id="s5a">
<title>Linear model for separation of gene-expression</title>
<p>The following linear model is widely used for separation of gene expression <xref ref-type="bibr" rid="pcbi.1003189-ShenOrr1">[3]</xref>–<xref ref-type="bibr" rid="pcbi.1003189-Lahdesmaki1">[12]</xref>, <xref ref-type="bibr" rid="pcbi.1003189-Repsilber1">[16]</xref>:<disp-formula id="pcbi.1003189.e001"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003189.e001" xlink:type="simple"/><label>(1)</label></disp-formula>Where <italic>M</italic><sub>ij</sub> is the mixed expression matrix of gene <italic>i</italic> in sample j, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e002" xlink:type="simple"/></inline-formula> is the separated cell-type specific gene-expression matrix of gene i in cell type <italic>k</italic> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e003" xlink:type="simple"/></inline-formula> is the matrix of relative proportion of cell type <italic>k</italic> in sample <italic>j</italic>; <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e004" xlink:type="simple"/></inline-formula> is the total number of cell-types in the tissue, <italic>m</italic> and <italic>n</italic> are the total number of genes and samples, respectively <xref ref-type="bibr" rid="pcbi.1003189-Venet1">[9]</xref>. Studies based on the model in (1) have shown that separation of mixed data with known proportions yielded cell-type specific expression estimates that were highly correlated with the corresponding purified cell gene-expression <xref ref-type="bibr" rid="pcbi.1003189-ShenOrr1">[3]</xref>, <xref ref-type="bibr" rid="pcbi.1003189-Abbas1">[4]</xref>, rendering the linearity assumption acceptable. All currently existing approaches, whether they use the linear model or not, require some a-priori information about the tissue analyzed, such as the number of cell types, their identity or their relative proportions in each sample <xref ref-type="bibr" rid="pcbi.1003189-ShenOrr1">[3]</xref>–<xref ref-type="bibr" rid="pcbi.1003189-Lahdesmaki1">[12]</xref>, <xref ref-type="bibr" rid="pcbi.1003189-Repsilber1">[16]</xref>. In this work, we are interested in estimating <bold>G</bold> and <bold>C</bold>, from the observation <bold>M</bold>, without explicit a-priory knowledge of the number of cell-types in the tissue, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e005" xlink:type="simple"/></inline-formula>, or their identities (note that we will use upper-case boldface letters to denote matrices and lower-case boldface letters to denote vectors). Rather, we consider a collection of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e006" xlink:type="simple"/></inline-formula> cell-types representing all possible cell-types assumed to comprise the analyzed tissue. This is a hypothesis-testing problem, where each possible combination of cell-types is a hypothesis. Our objective is to choose the correct hypothesis, i.e., to determine which cell-types exist in the analyzed tissue. Assume that <italic>T</italic> is a label of a cell-type. We begin with a collection of labels <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e007" xlink:type="simple"/></inline-formula> that contains the true composition of cell-types. Specifically, if the true composition of cell-types in a given tissue sample are labeled by <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e008" xlink:type="simple"/></inline-formula>, we require that for each <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e009" xlink:type="simple"/></inline-formula>, there exists <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e010" xlink:type="simple"/></inline-formula>, such that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e011" xlink:type="simple"/></inline-formula>. This is a reasonable assumption from a biological point of view, since if the tissue type is known then in most cases the cell-types that may exist in that tissue are also known. Note that if the initial collection of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e012" xlink:type="simple"/></inline-formula> cell-types does not include one of the true cell-types, then this specific cell-type, its expression signature and relative proportions per sample will not be detected by the algorithm and there may be ambiguities in the resulting cell-type signatures and proportions. After estimating the true hypothesis, we estimate the parameters under that hypothesis, i.e. the specific cell-type expression (<bold>G</bold>) and the relative proportion of each cell-type per sample (<bold>C</bold>). The algorithm that we propose requires as input purified gene-expression reference signatures <bold>l</bold><italic><sub>i</sub></italic> for each cell-type label <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e013" xlink:type="simple"/></inline-formula>, where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e014" xlink:type="simple"/></inline-formula>. The latter constraint is necessary to have a unique solution to (1), i.e. unique matrices <bold>G</bold> and <bold>C</bold>, up to normalization and permutation, which satisfies the decomposition in (1). These reference signatures need not be identical to the purified signatures that comprise the original columns of the matrix <bold>G</bold> but only need to be taken from the same cell-type. Note that these reference signatures may be acquired from a different experiment, lab or tissue and are found in abundance in gene expression repositories such as GEO <xref ref-type="bibr" rid="pcbi.1003189-Barrett1">[14]</xref>.</p>
</sec><sec id="s5b">
<title>The relation to hyper spectral Imaging</title>
<p>Separation of gene-expression can be viewed as a special case of a more general class of problems known as Nonnegative Matrix Factorization (NMF) problems, defined as follows: given a nonnegative data matrix M, find the smallest dimension matrices G and C with non-negative entries such that<disp-formula id="pcbi.1003189.e015"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003189.e015" xlink:type="simple"/><label>(2)</label></disp-formula>where G is referred to as an end-members matrix (where end-members are classes of composing materials that make up the object M <xref ref-type="bibr" rid="pcbi.1003189-Piper1">[13]</xref>), and C represents the relative proportions in which the end-members are mixed in M i.e, G's ith column represents the signature of the ith end-member, and C's kth entry represent the relative proportion of the kth end-member in the jth data vector <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e016" xlink:type="simple"/></inline-formula>. This is equivalent to writing (1) in a matrix form, where each data vector <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e017" xlink:type="simple"/></inline-formula> represents microarray measurements of sample j. Each cell-type is an end-member, where G's ith column represents the gene signature of the ith cell-type. The jth column of C represents the relative proportions of the cell-types (whose signatures comprise the columns of G) in sample j. If the number of cell-types is smaller than the number of samples, the dimensions of G and C are smaller than the dimension of M, and the problem in (1) is a special case of the problem in (2).</p>
<p>The algorithm proposed in this paper is an adaptation of an NMF algorithm by Piper et al. <xref ref-type="bibr" rid="pcbi.1003189-Piper1">[13]</xref> that was originally designed for spectral analysis of space objects. Piper et al. studied the problem of identification and classification of space objects whose orbits are significantly distant (e.g., geosynchronous satellites) or whose dimensions are small (e.g., nanosatellites) from ground-based telescope spectral measurements. In their problem, an object is classified by determining the characteristics of the material that make up its spectral trace. Each data vector m<sub>j</sub> represents a spectral trace (i.e. the spectral image) of the jth object. G's ith column represents the spectral signature of the ith material in the object (end-member). Piper et al.'s hyper-spectral analysis approach is useful for analysis of gene-expression microarrays due to the use of prior knowledge. Their method uses a stored set of laboratory-obtained spectral signatures of space object materials obtained in a different experiment to determine the number of end-members. These stored signatures are not necessarily identical to the underline signatures but are only close to them. This approach is very appealing for separation of gene-expression, since in most cases the purified cell-types are not separated and profiled separately in the same experiment. Furthermore, it is possible to obtain cell-type specific reference signatures and use them for any analysis involving similar cell types. Despite the similarity between the two NMF applications, i.e. gene-expression analysis and spectral analysis, extensions to Piper et al.'s algorithm designed for spectral analysis were needed for the gene-expression analysis, as described in the following section.</p>
</sec><sec id="s5c">
<title>Algorithm</title>
<p>The proposed algorithm includes three major parts. In the first part, we obtain an initial estimate of the matrix <bold>G</bold> using <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e018" xlink:type="simple"/></inline-formula> as the number of columns. In the second part we estimate the true number of cell-types, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e019" xlink:type="simple"/></inline-formula>, their identities, and the cell-type expression signatures matrix <bold>G</bold>. In the final part we compute the cell-type proportions matrix <bold>C</bold>. A detailed description of these steps is given in the following.</p>
<sec id="s5c1">
<title>Initialization</title>
<p>The algorithm receives as input: (a) an <italic>m×n</italic> matrix <bold>M</bold>, and (b) an <italic>m×</italic><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e020" xlink:type="simple"/></inline-formula> matrix <bold>L</bold>, where <bold>M</bold> is the mixed matrix to be separated with <italic>m</italic> genes and <italic>n</italic> samples and <bold>L</bold> is the reference signatures matrix with <italic>m</italic> genes and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e021" xlink:type="simple"/></inline-formula> columns. Both <bold>M</bold> and <bold>L</bold> have non-negative entries and are normalized such that each column sums to its mean. The matrices <bold>H</bold> and <bold>W</bold>, which represent intermediate estimates of the <bold>C</bold> and <bold>G</bold> matrices, are initialized as follows. The entries <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e022" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e023" xlink:type="simple"/></inline-formula> are realized values of independent random variables, uniformly distributed between zero to one. The matrix <bold>W</bold> is initialized with the reference signatures matrix <bold>L</bold> and the columns of <bold>W</bold> are scaled to sum to one.</p>
</sec><sec id="s5c2">
<title>Evaluation of H and W</title>
<p>In the first stage, the algorithm receives the matrix <bold>M</bold> and the integer <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e024" xlink:type="simple"/></inline-formula> as inputs and outputs <bold>H</bold> and <bold>W</bold> such that<disp-formula id="pcbi.1003189.e025"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003189.e025" xlink:type="simple"/><label>(3)</label></disp-formula>using NMF <xref ref-type="bibr" rid="pcbi.1003189-Piper1">[13]</xref>; i.e., <bold>H</bold>, <bold>W</bold> minimizes <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e026" xlink:type="simple"/></inline-formula> where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e027" xlink:type="simple"/></inline-formula> is the Frobenius norm (the root sum of squares of the entries of the matrix), under the constraint that <bold>H</bold> and <bold>W</bold> have positive entries and the columns of <bold>W</bold> sum to one. The matrices <bold>H</bold> and <bold>W</bold> serve as intermediate representations of the matrices <bold>C</bold> and <bold>G</bold>, respectively.</p>
</sec><sec id="s5c3">
<title>Estimation of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e028" xlink:type="simple"/></inline-formula> and G</title>
<p>The true number of cell-types in <bold>M</bold>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e029" xlink:type="simple"/></inline-formula> is estimated by:<disp-formula id="pcbi.1003189.e030"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003189.e030" xlink:type="simple"/><label>(4)</label></disp-formula>Recall that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e031" xlink:type="simple"/></inline-formula> is greater than the true number of cell-types <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e032" xlink:type="simple"/></inline-formula>, thus some of the columns of the matrix <bold>W</bold> are redundant. Each column in <bold>L</bold>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e033" xlink:type="simple"/></inline-formula>, is associated with a column in in <bold>W</bold>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e034" xlink:type="simple"/></inline-formula>, to which it has the minimal distance <italic>D</italic>. Here, SKLD is used, as in Piper <italic>et al.</italic> <xref ref-type="bibr" rid="pcbi.1003189-Piper1">[13]</xref>. The SKLD is defined as follows, let <italic>w</italic> and <italic>d</italic> be two signatures and let <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e035" xlink:type="simple"/></inline-formula>, the SKLD defined as<disp-formula id="pcbi.1003189.e036"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003189.e036" xlink:type="simple"/><label>(5)</label></disp-formula> where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e037" xlink:type="simple"/></inline-formula>. We have also run the algorithm using Euclidean distance and correlation as the distance measures, however the results were not as accurate as using SKLD (not shown). This may be explained by the fact that the SKLD is most suitable with the NMF used in our algorithm, as it only considers arguments with positive values. The estimated number of cell types, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e038" xlink:type="simple"/></inline-formula>, is set to the number of chosen columns in <bold>W</bold>. Note that it is possible that some of the columns in <bold>W</bold> will not be chosen. The cell type identity of each of the chosen <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e039" xlink:type="simple"/></inline-formula> columns is determined according to its corresponding <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e040" xlink:type="simple"/></inline-formula> column. In cases where more than one column in <bold>L</bold> is associated with a certain <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e041" xlink:type="simple"/></inline-formula>, the identity of that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e042" xlink:type="simple"/></inline-formula> is determined according to the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e043" xlink:type="simple"/></inline-formula> it has the minimal SKLD from. The estimated <bold>G</bold> matrix, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e044" xlink:type="simple"/></inline-formula>, is then constituted from the chosen columns of <bold>W</bold>.</p>
</sec><sec id="s5c4">
<title>Estimation of C</title>
<p>The estimate of the matrix <bold>C</bold> matrix, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e045" xlink:type="simple"/></inline-formula>, is obtained by using NNLS <xref ref-type="bibr" rid="pcbi.1003189-ShenOrr1">[3]</xref>, <xref ref-type="bibr" rid="pcbi.1003189-Venet1">[9]</xref>, <xref ref-type="bibr" rid="pcbi.1003189-Piper1">[13]</xref> using <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e046" xlink:type="simple"/></inline-formula> and <bold>M</bold>, such that<disp-formula id="pcbi.1003189.e047"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003189.e047" xlink:type="simple"/><label>(6)</label></disp-formula>under the constraint that the entries of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e048" xlink:type="simple"/></inline-formula> are greater than or equal to zero. Finally, the rows of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e049" xlink:type="simple"/></inline-formula> are normalized to 1 to represent cell-type proportions. The output of the algorithm is the matrices <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e050" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e051" xlink:type="simple"/></inline-formula>, representing the proportions of each cell type in each sample and the specific gene expression for each separated cell type, respectively. Pseudo code of the algorithm is given in <xref ref-type="supplementary-material" rid="pcbi.1003189.s009">Text S1</xref>.</p>
</sec><sec id="s5c5">
<title>Majority voting</title>
<p>The NMF algorithm used to evaluate <bold>H</bold> and <bold>W</bold> is not guaranteed to converge to a global minimum <xref ref-type="bibr" rid="pcbi.1003189-Piper1">[13]</xref>, as the NMF is not a convex optimization problem. This problem is most significant in cases where the cell-types have similar signatures (e.g. immune cell subsets as in the T-B-Monocytes dataset). To overcome this problem, we have initialized the <bold>W</bold> matrix with the input signatures matrix <bold>L</bold> and, in addition, set an option to run the algorithm several times using random initializations of <bold>H</bold>. Each run yields the estimate <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e052" xlink:type="simple"/></inline-formula> in which each column represents a cell-type that was chosen by the algorithm. The algorithm decides whether a certain cell-type is chosen for the final estimate of <bold>G</bold>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e053" xlink:type="simple"/></inline-formula>, if it is chosen more than a certain threshold, defined as the percentage of the number of times this cell-type was chosen out of the number of total runs. The estimated gene expression of each chosen cell-type is set to the average of the gene-expression of all corresponding estimates of this cell-type in each run it was chosen. The final estimate of the number of cell-types <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e054" xlink:type="simple"/></inline-formula> is set to the number of columns of the final <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e055" xlink:type="simple"/></inline-formula> matrix.</p>
</sec><sec id="s5c6">
<title>Classes</title>
<p>The algorithm utilizes the reference signatures matrix <bold>L</bold>. As such, it is sensitive to the signatures provided by the user and may fail to accurately separate cell-types in cases where the cell-types are very similar or if the user is missing a-priori information regarding the tissue to be separated, e.g. the exact nature of the cell type, tissue or experimental conditions. To improve performance in such cases, we have allowed for reference signatures to be grouped into classes with a single label. For example, to separate colorectal tumor cells of an unknown subtype from a mixed tissue, reference signatures for several colorectal tumor types representing different tumor subtypes may be provided and will constitute the class “colorectal tumor”. An additional example for using classes includes unifying several signatures for one cell type taken from different studies, e.g. purified heart cells from two different studies, under the class “heart”. This allows us to use more than one signature for each cell-type, which increases the robustness of the algorithm in cases where the reference signatures are noisy. The algorithm first estimates <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003189.e056" xlink:type="simple"/></inline-formula> as if there are no classes. Then, all <bold>W</bold> columns associated with the same class are averaged and labeled according to that class.</p>
</sec></sec><sec id="s5d">
<title>Microarray data</title>
<p>All microarray data was downloaded from GEO <xref ref-type="bibr" rid="pcbi.1003189-Barrett1">[14]</xref> as raw .CEL files and RMA normalized using R© package “affy”. The datasets and reference signatures used in each analysis were jointly quantile normalized using R© package “limma”. The following accession numbers were used for each dataset: <bold>(1)</bold> Liver-brain lung dataset <xref ref-type="bibr" rid="pcbi.1003189-ShenOrr1">[3]</xref> (GSE19830), with reference signatures of purified rat liver (GSE8252), brain (GSE3428), lung (GSE16849), intestine (GSE16849), heart (GSE5085) and granulosa (GSE13883) cells. All reference signatures were chosen from the same platform as the analyzed data - Affymetrix Rat Genome 230 2.0 Array. <bold>(2)</bold> Heart-brain dataset <xref ref-type="bibr" rid="pcbi.1003189-Affymetrix1">[15]</xref>, with reference signatures of purified human myocardial (heart) cells from two different studies (GSE21610, GSE29819), brain cells from the entorhinal cortex (GSE4757) grey matter (GSE28146), oocytes (GSE12034) and hepatocyte (GSE31264). All reference signatures were from the same platform as the analyzed data - Human Genome U133 Plus 2.0 Array. <bold>(3)</bold> T-B-Monocytes dataset <xref ref-type="bibr" rid="pcbi.1003189-Abbas1">[4]</xref> (GSE11058), with reference signatures of purified T cell Jurkat (GSE7508, GSE30678), Monocyte THP-1 (GSE26868), B cell Raji (GSE12278, GSE13210) and IM-9 (GSE24147), IMC-1 NK (GSE19067) and MCF-10A epithelial (GSE10196) cell-lines. All reference signatures were from the same platform as the analyzed data - Affymetrix Human Genome U133 Plus 2.0 Array. <bold>(4)</bold> Prostate cancer dataset <xref ref-type="bibr" rid="pcbi.1003189-Wang2">[7]</xref>(GSE17951). The dataset included 154 patient samples with proportions of the tumor cells were available for 137 samples. Reference signatures included purified prostate tumor cell lines - DU145, PC3, CWR22Rv, LAPC4, C42B, LNCaP (GSE12348), benign prostate cells (GSE3325), normal prostate epithelial cells (GSE9951), stroma surrounding invasive prostate primary tumors and normal stroma (GSE26910). All reference signatures and analyzed data were from two similar platforms - Affymetrix Human Genome U133A Array and U133 Plus 2.0 Array.</p>
</sec><sec id="s5e">
<title>Mining purified signatures</title>
<p>To separate a heterogeneous tissue, the user should have some knowledge regarding the nature of the tissue that is being separated and its possible cell-type constituents. Purified signatures of the candidate cell-types may be found in public repositories such as GEO via a simple search for the required cell-type and species. The chosen signatures need not be from the same disease, tissue study or experiment as the heterogeneous tissue to be separated. In case there are many possible relevant options from different studies for a cell-type, one can input several signatures of the same cell-type to the algorithm and gather them under the same class. This was demonstrated in the heart-brain and T-B-Monocyte dataset examples. The limit in the total number of signatures used for all cell-types is the number of samples of the mixed tissue that is being separated, as explained under “Linear model for separation of gene-expression”. In case of uncertainty as to what cell-types constitute the tissue, one does not have to be precise and can over-guess by inputting many, even un-related, cell-types into the algorithm. Note that under-guessing the number of cell-types may cause ambiguities in the algorithm results, as explained above.</p>
</sec><sec id="s5f">
<title>Parameters setting</title>
<p>Parameters concerning majority voting (threshold, number of majority voting runs) and classes were set according to the nature of the cell-type signatures in each dataset, based on trial and error and common sense. In the case of majority voting, the more the input reference signatures are similar (such as in the T-B-Monocyte dataset <xref ref-type="bibr" rid="pcbi.1003189-Abbas1">[4]</xref>, see also <xref ref-type="supplementary-material" rid="pcbi.1003189.s003">Figure S3A</xref>), the more likely that the algorithm will be farther away from the global minimum and therefore it will be harder to converge to a minimum that is close to the global minimum. Indeed, we noticed that the algorithm performs better with a lower threshold (i.e., a lower percentage of the number of times this cell-type is chosen out of the number of total runs) and a higher number of majority voting runs in such cases. In cases where the input reference signatures are less similar to each other (such as in the liver-brain-lung dataset <xref ref-type="bibr" rid="pcbi.1003189-ShenOrr1">[3]</xref>, see also <xref ref-type="supplementary-material" rid="pcbi.1003189.s001">Figure S1A</xref>), less majority voting runs are needed to yield accurate results.</p>
<p>For classes' parameters, we observed that the algorithm encounters difficulties in separating cell-types for which the input reference signatures are very similar. In such instances, one might consider unifying these signatures under one class (where biologically relevant) or seek reference signatures from a different source. Observation of the input reference signatures, e.g. by drawing their heatmaps (<xref ref-type="supplementary-material" rid="pcbi.1003189.s001">Figures S1</xref>, <xref ref-type="supplementary-material" rid="pcbi.1003189.s002">S2</xref>, <xref ref-type="supplementary-material" rid="pcbi.1003189.s003">S3</xref>, <xref ref-type="supplementary-material" rid="pcbi.1003189.s004">S4A</xref>), can provide an indication regarding which reference signatures are similar.</p>
<p>The algorithm was run with the following parameters for each dataset: <bold>(1)</bold> liver-brain-lung dataset <xref ref-type="bibr" rid="pcbi.1003189-ShenOrr1">[3]</xref>: majority voting threshold = 70%, majority voting runs = 10, classes = none. <bold>(2)</bold> Heart-brain dataset <xref ref-type="bibr" rid="pcbi.1003189-Affymetrix1">[15]</xref>: majority voting threshold = 70%, majority voting runs = 10, classes = unifying the two brain and two heart cell types to the classes “brain” and “heart”, respectively. <bold>(3)</bold> T-B-Monocytes dataset <xref ref-type="bibr" rid="pcbi.1003189-Abbas1">[4]</xref>: majority voting threshold = 70%, majority voting runs = 20, classes = unifying the two B cell line types to the class “B cells”. <bold>(4)</bold> Prostate cancer dataset <xref ref-type="bibr" rid="pcbi.1003189-Wang2">[7]</xref>: majority voting threshold = 70%, majority voting runs = 10, classes = unifying the 6 different prostate tumor cell lines to the class “tumor” and the epithelial and stromal cells to the class “other”.</p>
</sec></sec><sec id="s6">
<title>Supporting Information</title>
<supplementary-material id="pcbi.1003189.s001" mimetype="image/tiff" xlink:href="info:doi/10.1371/journal.pcbi.1003189.s001" position="float" xlink:type="simple"><label>Figure S1</label><caption>
<p><bold>Blind separation of the liver-brain-lung dataset.</bold> (<bold>A</bold>) Heatmap of the gene-expression signatures used in the liver-brain-lung dataset <xref ref-type="bibr" rid="pcbi.1003189-ShenOrr1">[3]</xref>. Top 10% variable probes (3,110) are shown. Publically available datasets mined from GEO were used for the signatures, as follows: liver - GSE8252, heart - GSE5085, granuloza - GSE13883, brain - GSE3428, lung - GSE16849, intestine - GSE16849. Gene expression from each dataset was averaged to yield a signature representative of that cell-type. Heatmap was generated in R© BioConductor using the gplots package. (<bold>B</bold>) Kullback-Leibler distances between the gene-expression of each separated cell type (CT1–CT3) to the gene-expression of each of the purified cell-types taken from the same study <xref ref-type="bibr" rid="pcbi.1003189-ShenOrr1">[3]</xref>. The distance is calculated between gene expression vectors; i.e. each vector represents a different cell-type and each entry of the vector represents the gene expression of a particular gene. The shortest distances between each separated cell-type and its corresponding purified cell-type are circled. (<bold>C</bold>) Kullback-Leibler distances between the known cell-type proportions and the estimated cell-type proportions (CT1–CT3) for all samples. The distance is calculated between vectors, such that each vector represents a different cell-type and each entry of the vector represents the relative proportion in a particular sample. The shortest distances between the estimated and known cell-type proportions are circled. (<bold>D</bold>) Kullback-Leibler distances between the purified gene-expression signatures taken from the same study <xref ref-type="bibr" rid="pcbi.1003189-ShenOrr1">[3]</xref>, denoted as “real”, the estimated cell-type signatures inferred by the algorithm and the input cell-type reference signatures mined from GEO. The shortest distances are circled.</p>
<p>(TIF)</p>
</caption></supplementary-material><supplementary-material id="pcbi.1003189.s002" mimetype="image/tiff" xlink:href="info:doi/10.1371/journal.pcbi.1003189.s002" position="float" xlink:type="simple"><label>Figure S2</label><caption>
<p><bold>Blind separation of the heart-brain dataset.</bold> (<bold>A</bold>) Heatmap of the gene-expression signatures used in the heart-brain dataset <xref ref-type="bibr" rid="pcbi.1003189-Affymetrix1">[15]</xref>. Top 10% variable probes (5,468) are shown. Publically available datasets mined from GEO were used for the signatures, as follows: Brain cortex - GSE4757, Brain GM (grey matter) - GSE28146, ooctyes - GSE12034, hepatocytes - GSE31264, Heart 1 - GSE21610, Heart 2 - GSE29819. Gene expression from each dataset was averaged to yield a signature representative of that cell-type. Heatmap was generated in R© BioConductor using the gplots package. (<bold>B</bold>) Kullback-Leibler distances between the gene-expression of each separated cell type (CT1, CT2) to the gene-expression of each of the purified cell-types taken from the same study <xref ref-type="bibr" rid="pcbi.1003189-Affymetrix1">[15]</xref>. The distance is calculated between gene expression vectors; i.e. each vector represents a different cell-type and each entry of the vector represents the gene expression of a particular gene. The shortest distances between each separated cell-type and its corresponding purified cell-type are circled. (<bold>C</bold>) Kullback-Leibler distances between the known cell-type proportions and the estimated cell-type proportions (CT1, CT2) for all samples. The distance is calculated between vectors, such that each vector represents a different cell-type and each entry of the vector represents the relative proportion in a particular sample. The shortest distances between the estimated and known cell-type proportions are circled. (<bold>D</bold>) Kullback-Leibler distances between the purified gene-expression signatures taken from the same study <xref ref-type="bibr" rid="pcbi.1003189-Affymetrix1">[15]</xref>, denoted as “real”, the estimated cell-type signatures inferred by the algorithm and the input reference cell-type signatures mined from GEO. The shortest distances are circled. The GEO accession numbers of the two signatures taken from different studies for both the heart and brain cell-types are denoted next to each comparison.</p>
<p>(TIF)</p>
</caption></supplementary-material><supplementary-material id="pcbi.1003189.s003" mimetype="image/tiff" xlink:href="info:doi/10.1371/journal.pcbi.1003189.s003" position="float" xlink:type="simple"><label>Figure S3</label><caption>
<p><bold>Blind separation of the T-B-Monocytes dataset.</bold> (<bold>A</bold>) Heatmap of the gene-expression signatures used in the T-B-Monocytes dataset <xref ref-type="bibr" rid="pcbi.1003189-Abbas1">[4]</xref>. Top 10% variable probes (2,734) are shown. Publically available datasets mined from GEO were used for the signatures, as follows: B IM9 cell line - GSE24147, B Raji cell line 1 - GSE12278, B Raji cell line 2 - GSE13210, Epithelial MCF10A cell line - GSE10196, Monocyte THP-1 cell-line - GSE26868, NK IMC-1 cell line - GSE19067, T Jurkat cell line 1 - GSE7508, T Jurkat cell line 2 - GSE30678. Gene expression from each dataset was averaged to yield a signature representative of that cell-type/dataset. Heatmap was generated in R© BioConductor using the gplots package. (<bold>B</bold>) Kullback-Leibler distances between the gene expressions of each separated cell-type (CT1–CT4) to the gene-expression of each of the purified cell-types taken from the same study<sup>2</sup>. The distance is calculated between gene expression vectors; i.e. each vector represents a different cell-type and each entry of the vector represents the gene expression of a particular gene. The shortest distances between each separated cell-type and its corresponding purified cell-type are circled. (<bold>C</bold>) Kullback-Leibler distances between the known cell-type proportions and the estimated cell-type proportions (CT1–CT4) for all samples. The distance is calculated between vectors, such that each vector represents a different cell-type and each entry of the vector represents the relative proportion in a particular sample. The shortest distances between the estimated and known cell-type proportions are circled. (<bold>D</bold>) Kullback-Leibler distances between the purified gene-expression signatures taken from the same study <xref ref-type="bibr" rid="pcbi.1003189-Abbas1">[4]</xref>, denoted as “real”, the estimated cell-type signatures inferred by the algorithm and the input reference cell-type signatures mined from GEO. The shortest distances are circled. The GEO accession numbers of the two signatures taken from different studies for both the T (Jurkat) and B (Raji) cell lines are denoted next to each comparison. (<bold>E</bold>) Gene expression measurements of each separated cell-type (the two B cell-types were unified under the same class – “B cells”) plotted against the gene expression of its corresponding purified cell type from the same study. The known purified gene expression of the two B cell-types was averaged. (<bold>F</bold>) Kullback-Leibler distances between the gene expressions of each separated cell-type (CT1–CT3; the two B cell-types were unified under the same class – “B cells”) to the gene-expression of each of the purified cell-types taken from the same study<sup>2</sup>. The known purified gene expression of the two B cell-types was averaged. The distance is calculated between gene expression vectors; i.e. each vector represents a different cell-type and each entry of the vector represents the gene expression of a particular gene. The shortest distances between each separated cell-type and its corresponding purified cell-type are circled. (<bold>G</bold>) Kullback-Leibler distances between the known cell-type proportions and the estimated cell-type proportions (CT1–CT3) for all samples. The unified B cell-types (“B cells”) were compared to the sum of the proportions of the two B cell-types. The distance is calculated between vectors, such that each vector represents a different cell-type and each entry of the vector represents the relative proportion in a particular sample. The shortest distances between the estimated and known cell-type proportions are circled. (<bold>H</bold>) Comparisons between the known cell-type proportions and the estimated proportions per-sample for cell-types in the controlled datasets. Known proportions are shown in the grey columns, denoted by “s” and were measured as triplicates; estimates yielded by the blind separation algorithm are shown in the white columns and are denoted by “e”. (<bold>I</bold>) Known cell-type proportions plotted against the estimated cell-type proportions for all samples. The unified B cell-types (“B cells”) were compared to the sum of the proportions of the two B cell-types. Correlation coefficients between the known and estimated proportions are denoted for each cell-type.</p>
<p>(TIF)</p>
</caption></supplementary-material><supplementary-material id="pcbi.1003189.s004" mimetype="image/tiff" xlink:href="info:doi/10.1371/journal.pcbi.1003189.s004" position="float" xlink:type="simple"><label>Figure S4</label><caption>
<p><bold>Blind separation of the prostate tumor dataset.</bold> (<bold>A</bold>) Heatmap of the gene-expression signatures used in the heart-brain dataset <xref ref-type="bibr" rid="pcbi.1003189-Wang2">[7]</xref>. Top 10% variable probes (2,228) are shown. Publically available datasets mined from GEO were used for the signatures, as follows: normal prostate epithelial cells (epithelial) - GSE9951, benign prostate tissue (benign) - GSE3325, stroma surrounding invasive prostate tumors (stromal surround) and normal stroma (stromal normal) - GSE26910, 6 prostate tumor cell-lines (DU145, PC3, CWR22Rv, LAPC4, C42B, LNCaP) - GSE12348. Gene expression from each dataset was averaged to yield a signature representative of that cell-type. Heatmap was generated in R© BioConductor using the gplots package. (<bold>B</bold>) Kullback-Leibler distances between the known cell-type proportions and the estimated cell-type proportions (CT1, CT2) for all samples. The distance is calculated between vectors, such that each vector represents a different cell-type and each entry of the vector represents the relative proportion in a particular sample. The shortest distances between the estimated and known cell-type proportions are circled. (<bold>C</bold>) Comparison of the known and estimated cell-type proportions per sample in the prostate cancer dataset. The average absolute error per sample is 12.44±12.41. Highlighted cells show the samples in which the absolute error was lower or equal to the average absolute error.</p>
<p>(TIF)</p>
</caption></supplementary-material><supplementary-material id="pcbi.1003189.s005" mimetype="image/tiff" xlink:href="info:doi/10.1371/journal.pcbi.1003189.s005" position="float" xlink:type="simple"><label>Figure S5</label><caption>
<p><bold>Algorithm without the cell-type determination step – liver brain lung dataset.</bold> A modified version of the separation algorithm without the cell-type determination step was run on the three cell-types liver-brain-lung dataset, using six, five and four reference cell-type signatures mined from GEO. The results show that in the case of algorithms that do not have a cell-type determination mechanism, such an over-fit (addition of extra cell-types) is insignificant if the resulting proportions of the additional cell-types are close to zero. However, this example clearly shows that this is not the case and that the over-fit significantly degraded the performance of the algorithm. Hence the cell-type determination step is crucial. (<bold>A</bold>) A run using all six input cell-types mined from GEO (liver, brain, lung, heart, intestine, granulosa). Correlations were calculated between the gene-expression of each separated cell type (CT1–CT6) to the gene-expression of each of the purified cell-types taken from the same study <xref ref-type="bibr" rid="pcbi.1003189-ShenOrr1">[3]</xref>. As the cell-type determination step was not performed, correlations between the purified signatures from the same study and the resulting cell-types were used to determine the identity of the resulting cell-types. The highest correlation between each separated cell-type and its corresponding purified cell-type are circled, thus pointing to the correct cell-types, i.e., liver = CT1, brain = CT3, lung = CT5. (<bold>B</bold>) Estimated cell-type proportions for all cell-types. The average absolute error per sample for cell-types CT1, CT3 and CT5 is 26.5±7.8. This is a much higher error compared to the error produced by our complete algorithm, which was 3.4%±2.3 (<xref ref-type="fig" rid="pcbi-1003189-g003">Figure 3A</xref>). Cells highlighted in orange show the real proportions (where liver = CT1, brain = CT3, lung = CT5); cells highlighted in grey are the cell-types which were mistakenly assumed to be present but were not removed because the cell-type determination step was not included here, as in our complete algorithm. (<bold>C</bold>) Correlations between the gene-expression of five input cell-types - liver, brain, lung, intestine and heart (CT1–CT5) and the gene-expression of each of the purified cell-types taken from the same study <xref ref-type="bibr" rid="pcbi.1003189-ShenOrr1">[3]</xref>. As the cell-type determination step was not performed, correlations between the purified signatures from the same study and the resulting cell-types were used to determine the identity of the resulting cell-types. The highest correlation between each separated cell-type and its corresponding purified cell-type are circled, pointing to the correct cell-types, i.e., liver = CT1, brain = CT2, lung = CT4. (<bold>D</bold>) Estimated cell-type proportions for five cell-types. The average absolute error per sample for cell-types CT1,CT2 and CT4 is 22.3±11.9. This is a much higher error compared to the error produced by our complete algorithm, which was 3.4%±2.3 (<xref ref-type="fig" rid="pcbi-1003189-g003">Figure 3A</xref>). Cells highlighted in orange show the real proportions (where liver = CT1, brain = CT2, lung = CT4); cells highlighted in grey are the cell-types which were mistakenly assumed to be present but were not removed because the cell-type determination step was not included here, as in our complete algorithm. (<bold>E</bold>) Correlations between the gene-expression of four input cell-types - liver, brain, lung and intestine (CT1–CT4) and the gene-expression of each of the purified cell-types taken from the same study <xref ref-type="bibr" rid="pcbi.1003189-ShenOrr1">[3]</xref>. As the cell-type determination step was not performed, correlations between the purified signatures from the same study and the resulting cell-types were used to determine the identity of the resulting cell-types. The highest correlation between each separated cell-type and its corresponding purified cell-type are circled, pointing to the correct cell-types, i.e., liver = CT1, brain = CT2, lung = CT3. (<bold>F</bold>) Estimated cell-type proportions for all cell-types. The average absolute error per sample for cell-types CT1,CT2 and CT3 is 11.7±4.75. This is a higher error compared to the error produced by our complete algorithm, which was 3.4%±2.3 (<xref ref-type="fig" rid="pcbi-1003189-g003">Figure 3A</xref>). Cells highlighted in orange show the real proportions (where liver = CT1, brain = CT2, lung = CT3); cells highlighted in grey are the cell-types which were mistakenly assumed to be present but were not removed because the cell-type determination step was not included here, as in our complete algorithm.</p>
<p>(TIF)</p>
</caption></supplementary-material><supplementary-material id="pcbi.1003189.s006" mimetype="image/tiff" xlink:href="info:doi/10.1371/journal.pcbi.1003189.s006" position="float" xlink:type="simple"><label>Figure S6</label><caption>
<p><bold>Algorithm without the cell-type determination step – T-B-Monocytes dataset.</bold> A modified version of the separation algorithm without the cell-type determination step was run on the four cell-types T-B-Monocytes dataset (which includes two different B cell line types), using six and five reference cell-type signatures mined from GEO. The results show that in the case of algorithms that do not have a cell-type determination mechanism, such an over-fit (addition of extra cell-types) is insignificant if the resulting proportions of the additional cell-types are close to zero. However, this example clearly shows that this is not the case and that the over-fit significantly degraded the performance of the algorithm. Hence the cell-type determination step is crucial. (<bold>A</bold>) A run using all six input cell-types mined from GEO (T-Jurkat, B-Raji, B-IM9, Monocytes, NK cells and epithelial cells). Correlations were calculated between the gene-expression of each separated cell type (CT1–CT6) to the gene-expression of each of the purified cell-types taken from the same study <xref ref-type="bibr" rid="pcbi.1003189-Abbas1">[4]</xref>. As the cell-type determination step was not performed, correlations between the purified signatures from the same study and the resulting cell-types were used to determine the identity of the resulting cell-types. The highest correlation between each separated cell-type and its corresponding purified cell-type are circled, pointing to the correct cell-types, i.e., T-Jurkat = CT1, B-Raji/IM9 = CT2, Monocytes = CT4. CT2 was identified as both B cell lines. (<bold>B</bold>) Estimated cell-type proportions for all cell-types. The average absolute error per sample for cell-types CT1,CT3 and CT4 is 21.2±6.7. This is a much higher error compared to the error produced by our complete algorithm, which was 5.7%±3.3 (<xref ref-type="fig" rid="pcbi-1003189-g003">Figure 3C</xref>). Cells highlighted in orange show the real proportions (where T-Jurkat = CT1, B-Raji/IM9 = CT2, Monocytes = CT4); cells highlighted in grey are the cell-types which were mistakenly assumed to be present but were not removed because the cell-type determination step was not included here, as in our complete algorithm. (<bold>C</bold>) Correlations between the gene-expression of five input cell-types – T-Jurkat, B-Raji, B-IM9, Monocytes and epithelial cells (CT1–CT5) and the gene-expression of each of the purified cell-types taken from the same study <xref ref-type="bibr" rid="pcbi.1003189-Abbas1">[4]</xref>. As the cell-type determination step was not performed, correlations between the purified signatures from the same study and the resulting cell-types were used to determine the identity of the resulting cell-types. The highest correlation between each separated cell-type and its corresponding purified cell-type are circled, pointing to the correct cell-types, i.e., T-Jurkat = CT1, B-Raji = CT2, B-IM9 = CT3, Monocytes = CT4. (<bold>D</bold>) Estimated cell-type proportions for all cell-types. The average absolute error per sample for cell-types CT1–CT4 is 13.7±4.9. This is a much higher error compared to the error produced by our complete algorithm, which was 5.7%±3.3 (<xref ref-type="fig" rid="pcbi-1003189-g003">Figure 3C</xref>). Cells highlighted in orange show the real proportions (where T-Jurkat = CT1, B-Raji = CT2, B-IM9 = CT3, Monocytes = CT4); cells highlighted in grey are the cell-types which were mistakenly assumed to be present but were not removed because the cell-type determination step was not included here, as in our complete algorithm.</p>
<p>(TIF)</p>
</caption></supplementary-material><supplementary-material id="pcbi.1003189.s007" mimetype="image/tiff" xlink:href="info:doi/10.1371/journal.pcbi.1003189.s007" position="float" xlink:type="simple"><label>Figure S7</label><caption>
<p><bold>NNLS-based algorithm – liver brain lung dataset.</bold> A NNLS (non-negative least squares)-based algorithm, which was used as a benchmark to most NNLS-based separation algorithms. The reference signatures were used to extract the proportions matrix. This algorithm was run on the three cell-types liver-brain-lung dataset, using six, five and four reference cell-type signatures mined from GEO. For NNLS-based algorithms which do not require any prior information, an over-fit (i.e., assume that there are more cell-types than actually exist) is insignificant if the resulting proportions of the additional cell-types are close to zero. However, this example clearly shows that this is not the case and that the over-fit significantly degraded the performance of the algorithm. Hence the cell-type determination step and the usage of NNMF (non-negative matrix factorization) is crucial. (<bold>A</bold>) A run using all six input cell-types mined from GEO (liver, brain, lung, heart, intestine, granulosa). Correlations were calculated between the gene-expression of each separated cell type (CT1–CT6) to the gene-expression of each of the purified cell-types taken from the same study <xref ref-type="bibr" rid="pcbi.1003189-ShenOrr1">[3]</xref>. As the cell-type determination step was not performed, correlations between the purified signatures from the same study and the resulting cell-types were used to determine the identity of the resulting cell-types. The highest correlation between each separated cell-type and its corresponding purified cell-type are circled, pointing to the correct cell-types, i.e., liver = CT1, brain = CT2, lung = CT4. (<bold>B</bold>) Estimated cell-type proportions for all cell-types. The average absolute error per sample for cell-types CT1,CT2 and CT4 is 24.2±8.72. This is a much higher error compared to the error produced by our complete algorithm, which was 3.4%±2.3 (<xref ref-type="fig" rid="pcbi-1003189-g003">Figure 3A</xref>). Cells highlighted in orange show the real proportions (where liver = CT1, brain = CT2, lung = CT4); cells highlighted in grey are the cell-types which were mistakenly assumed to be present but were not removed because the cell-type determination step was not included here, as in our complete algorithm. (<bold>C</bold>) Correlations between the gene-expression of five input cell-types - liver, brain, lung, intestine and heart (CT1–CT5) and the gene-expression of each of the purified cell-types taken from the same study <xref ref-type="bibr" rid="pcbi.1003189-ShenOrr1">[3]</xref>. As the cell-type determination step was not performed, correlations between the purified signatures from the same study and the resulting cell-types were used to determine the identity of the resulting cell-types. The highest correlation between each separated cell-type and its corresponding purified cell-type are circled, pointing to the correct cell-types, i.e., liver = CT1, brain = CT2, lung = CT4. (<bold>D</bold>) Estimated cell-type proportions for all cell-types. The average absolute error per sample for cell-types CT1,CT2 and CT4 is 18.4±5.81. This is a much higher error compared to the error produced by our complete algorithm, which was 3.4%±2.3 (<xref ref-type="fig" rid="pcbi-1003189-g003">Figure 3A</xref>). Cells highlighted in orange show the real proportions (where liver = CT1, brain = CT2, lung = CT4); cells highlighted in grey are the cell-types which were mistakenly assumed to be present but were not removed because the cell-type determination step was not included here, as in our complete algorithm. (<bold>E</bold>) Correlations between the gene-expression of four input cell-types - liver, brain, lung and intestine (CT1–CT4) and the gene-expression of each of the purified cell-types taken from the same study <xref ref-type="bibr" rid="pcbi.1003189-ShenOrr1">[3]</xref>. As the cell-type determination step was not performed, correlations between the purified signatures from the same study and the resulting cell-types were used to determine the identity of the resulting cell-types. The highest correlation between each separated cell-type and its corresponding purified cell-type are circled, pointing to the correct cell-types, i.e., liver = CT1, brain = CT2, lung = CT4. (<bold>F</bold>) Estimated cell-type proportions for all cell-types. The average absolute error per sample for cell-types CT1,CT2 and CT4 is 12.3±4.78. This is a higher error compared to the error produced by our complete algorithm, which was 3.4%±2.3 (<xref ref-type="fig" rid="pcbi-1003189-g003">Figure 3A</xref>). Cells highlighted in orange show the real proportions (where liver = CT1, brain = CT2, lung = CT4); cells highlighted in grey are the cell-types which were mistakenly assumed to be present but were not removed because the cell-type determination step was not included here, as in our complete algorithm.</p>
<p>(TIF)</p>
</caption></supplementary-material><supplementary-material id="pcbi.1003189.s008" mimetype="image/tiff" xlink:href="info:doi/10.1371/journal.pcbi.1003189.s008" position="float" xlink:type="simple"><label>Figure S8</label><caption>
<p><bold>NNLS-based algorithm – T-B-Monocytes dataset.</bold> A NNLS (non-negative least squares)-based algorithm, which was used as a benchmark to most NNLS-based separation algorithms. The reference signatures were used to extract the proportions matrix. This algorithm was run on the four cell-types T-B-Monocytes dataset (which includes two different B cell line types), using six and five reference cell-type signatures mined from GEO. For NNLS-based algorithms that do not require any prior information, an over-fit (i.e., assume that there are more cell-types than actually exist) is insignificant if the resulting proportions of the additional cell-types are close to zero. However, this example clearly shows that this is not the case and that the over-fit significantly degraded the performance of the algorithm. Hence the cell-type determination step and the usage of NNMF (non-negative matrix factorization) is crucial. (<bold>A</bold>) A run using six input cell-type signatures mined from GEO (T-Jurkat, B-Raji, B-IM9, Monocytes, NK cells and epithelial cells). Correlations were calculated between the gene-expression of each separated cell type (CT1–CT6) to the gene-expression of each of the purified cell-types taken from the same study <xref ref-type="bibr" rid="pcbi.1003189-Abbas1">[4]</xref>. As the cell-type determination step was not performed, correlations between the purified signatures from the same study and the resulting cell-types were used to determine the identity of the resulting cell-types. The highest correlation between each separated cell-type and its corresponding purified cell-type are circled, pointing to the correct cell-types, i.e., T-Jurkat = CT1, B-Raji/IM9 = CT2, Monocytes = CT4. CT2 was identified as both B cell lines. (<bold>B</bold>) Estimated cell-type proportions for all cell-types. The average absolute error per sample for cell-types CT1,CT2 and CT4 is 14.2±3.8. This is a much higher error compared to the error produced by our complete algorithm, which was 5.7%±3.3 (<xref ref-type="fig" rid="pcbi-1003189-g003">Figure 3C</xref>). Cells highlighted in orange show the real proportions (where T-Jurkat = CT1, B-Raji/IM9 = CT2, Monocytes = CT4); cells highlighted in grey are the cell-types which were mistakenly assumed to be present but were not removed because the cell-type determination step was not included here, as in our complete algorithm. (<bold>C</bold>) Correlations between the separated cell-types (CT1–CT5) and the gene-expression of each of the purified cell-types taken from the same study <xref ref-type="bibr" rid="pcbi.1003189-Abbas1">[4]</xref>. As the cell-type determination step was not performed, correlations between the purified signatures from the same study and the resulting cell-types were used to determine the identity of the resulting cell-types. The highest correlation between each separated cell-type and its corresponding purified cell-type are circled, pointing to the correct cell-types, i.e., T-Jurkat = CT1, B-Raji/IM9 = CT2, Monocytes = CT4. (<bold>D</bold>) Estimated cell-type proportions for all cell-types. The average absolute error per sample for cell-types CT1,CT2 and CT4 is 11.5±3.4. This is a much higher error compared to the error produced by our complete algorithm, which was 5.7%±3.3 (<xref ref-type="fig" rid="pcbi-1003189-g003">Figure 3C</xref>). Cells highlighted in orange show the real proportions (where T-Jurkat = CT1, B-Raji/IM9 = CT2, Monocytes = CT4); cells highlighted in grey are the cell-types which were mistakenly assumed to be present but were not removed because the cell-type determination step was not included here, as in our complete algorithm.</p>
<p>(TIF)</p>
</caption></supplementary-material><supplementary-material id="pcbi.1003189.s009" mimetype="application/vnd.openxmlformats-officedocument.wordprocessingml.document" xlink:href="info:doi/10.1371/journal.pcbi.1003189.s009" position="float" xlink:type="simple"><label>Text S1</label><caption>
<p><bold>Algorithm pseudo code.</bold> A matlab program of this code will be provided by the authors upon request.</p>
<p>(DOCX)</p>
</caption></supplementary-material></sec></body>
<back>
<ack>
<p>The authors would like to thank Prof. Hagit Messer and Prof. Yonina Eldar for useful discussions.</p>
</ack>
<ref-list>
<title>References</title>
<ref id="pcbi.1003189-Cleator1"><label>1</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Cleator</surname><given-names>SJ</given-names></name>, <name name-style="western"><surname>Powles</surname><given-names>TJ</given-names></name>, <name name-style="western"><surname>Dexter</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Fulford</surname><given-names>L</given-names></name>, <name name-style="western"><surname>Mackay</surname><given-names>A</given-names></name>, <etal>et al</etal>. (<year>2006</year>) <article-title>The effect of the stromal component of breast tumours on prediction of clinical outcome using gene expression microarray analysis</article-title>. <source>Breast Cancer Res</source> <volume>8</volume>: <fpage>R32</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003189-Mills1"><label>2</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Mills</surname><given-names>JC</given-names></name>, <name name-style="western"><surname>Roth</surname><given-names>KA</given-names></name>, <name name-style="western"><surname>Cagan</surname><given-names>RL</given-names></name>, <name name-style="western"><surname>Gordon</surname><given-names>JI</given-names></name> (<year>2001</year>) <article-title>DNA microarrays and beyond: completing the journey from tissue to cell</article-title>. <source>Nat Cell Biol</source> <volume>3</volume>: <fpage>E175</fpage>–<lpage>178</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003189-ShenOrr1"><label>3</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Shen-Orr</surname><given-names>SS</given-names></name>, <name name-style="western"><surname>Tibshirani</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Khatri</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Bodian</surname><given-names>DL</given-names></name>, <name name-style="western"><surname>Staedtler</surname><given-names>F</given-names></name>, <etal>et al</etal>. (<year>2010</year>) <article-title>Cell type-specific gene expression differences in complex tissues</article-title>. <source>Nat Methods</source> <volume>7</volume>: <fpage>287</fpage>–<lpage>289</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003189-Abbas1"><label>4</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Abbas</surname><given-names>AR</given-names></name>, <name name-style="western"><surname>Wolslegel</surname><given-names>K</given-names></name>, <name name-style="western"><surname>Seshasayee</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Modrusan</surname><given-names>Z</given-names></name>, <name name-style="western"><surname>Clark</surname><given-names>HF</given-names></name> (<year>2009</year>) <article-title>Deconvolution of blood microarray data identifies cellular activation patterns in systemic lupus erythematosus</article-title>. <source>PLoS One</source> <volume>4</volume>: <fpage>e6098</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003189-Stuart1"><label>5</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Stuart</surname><given-names>RO</given-names></name>, <name name-style="western"><surname>Wachsman</surname><given-names>W</given-names></name>, <name name-style="western"><surname>Berry</surname><given-names>CC</given-names></name>, <name name-style="western"><surname>Wang-Rodriguez</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Wasserman</surname><given-names>L</given-names></name>, <etal>et al</etal>. (<year>2004</year>) <article-title>In silico dissection of cell-type-associated patterns of gene expression in prostate cancer</article-title>. <source>Proc Natl Acad Sci U S A</source> <volume>101</volume>: <fpage>615</fpage>–<lpage>620</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003189-Wang1"><label>6</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Wang</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Master</surname><given-names>SR</given-names></name>, <name name-style="western"><surname>Chodosh</surname><given-names>LA</given-names></name> (<year>2006</year>) <article-title>Computational expression deconvolution in a complex mammalian organ</article-title>. <source>BMC Bioinformatics</source> <volume>7</volume>: <fpage>328</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003189-Wang2"><label>7</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Wang</surname><given-names>Y</given-names></name>, <name name-style="western"><surname>Xia</surname><given-names>XQ</given-names></name>, <name name-style="western"><surname>Jia</surname><given-names>Z</given-names></name>, <name name-style="western"><surname>Sawyers</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Yao</surname><given-names>H</given-names></name>, <etal>et al</etal>. (<year>2010</year>) <article-title>In silico estimates of tissue components in surgical samples based on expression profiling data</article-title>. <source>Cancer Res</source> <volume>70</volume>: <fpage>6448</fpage>–<lpage>6455</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003189-Lu1"><label>8</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Lu</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Nakorchevskiy</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Marcotte</surname><given-names>EM</given-names></name> (<year>2003</year>) <article-title>Expression deconvolution: a reinterpretation of DNA microarray data reveals dynamic changes in cell populations</article-title>. <source>Proc Natl Acad Sci U S A</source> <volume>100</volume>: <fpage>10370</fpage>–<lpage>10375</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003189-Venet1"><label>9</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Venet</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Pecasse</surname><given-names>F</given-names></name>, <name name-style="western"><surname>Maenhaut</surname><given-names>C</given-names></name>, <name name-style="western"><surname>Bersini</surname><given-names>H</given-names></name> (<year>2001</year>) <article-title>Separation of samples into their constituents using gene expression data</article-title>. <source>Bioinformatics</source> <volume>17 Suppl 1</volume>: <fpage>S279</fpage>–<lpage>287</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003189-Erkkila1"><label>10</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Erkkila</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Lehmusvaara</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Ruusuvuori</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Visakorpi</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Shmulevich</surname><given-names>I</given-names></name>, <etal>et al</etal>. (<year>2010</year>) <article-title>Probabilistic analysis of gene expression measurements from heterogeneous tissues</article-title>. <source>Bioinformatics</source> <volume>26</volume>: <fpage>2571</fpage>–<lpage>2577</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003189-Kuhn1"><label>11</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Kuhn</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Thu</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Waldvogel</surname><given-names>HJ</given-names></name>, <name name-style="western"><surname>Faull</surname><given-names>RL</given-names></name>, <name name-style="western"><surname>Luthi-Carter</surname><given-names>R</given-names></name> (<year>2011</year>) <article-title>Population-specific expression analysis (PSEA) reveals molecular changes in diseased brain</article-title>. <source>Nat Methods</source> <volume>8</volume>: <fpage>945</fpage>–<lpage>947</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003189-Lahdesmaki1"><label>12</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Lahdesmaki</surname><given-names>H</given-names></name>, <name name-style="western"><surname>Shmulevich</surname><given-names>L</given-names></name>, <name name-style="western"><surname>Dunmire</surname><given-names>V</given-names></name>, <name name-style="western"><surname>Yli-Harja</surname><given-names>O</given-names></name>, <name name-style="western"><surname>Zhang</surname><given-names>W</given-names></name> (<year>2005</year>) <article-title>In silico microdissection of microarray data from heterogeneous cell populations</article-title>. <source>BMC Bioinformatics</source> <volume>6</volume>: <fpage>54</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003189-Piper1"><label>13</label>
<mixed-citation publication-type="other" xlink:type="simple">Piper J, Pauca VP, Plemmons RJ, Giffin M (2004) Object Characterization from spectral data using nonnegative factorization and information theory. In In Proc. Amos Technical Conf., Maui, HI.</mixed-citation>
</ref>
<ref id="pcbi.1003189-Barrett1"><label>14</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Barrett</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Troup</surname><given-names>DB</given-names></name>, <name name-style="western"><surname>Wilhite</surname><given-names>SE</given-names></name>, <name name-style="western"><surname>Ledoux</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Rudnev</surname><given-names>D</given-names></name>, <etal>et al</etal>. (<year>2009</year>) <article-title>NCBI GEO: archive for high-throughput functional genomic data</article-title>. <source>Nucleic Acids Res</source> <volume>37</volume>: <fpage>D885</fpage>–<lpage>890</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003189-Affymetrix1"><label>15</label>
<mixed-citation publication-type="other" xlink:type="simple">Affymetrix. Gene 1.0 ST Array Data Set. Available: <ext-link ext-link-type="uri" xlink:href="http://www.affymetrix.com/support/technical/sample_data/gene_1_0_array_data.affx" xlink:type="simple">http://www.affymetrix.com/support/technical/sample_data/gene_1_0_array_data.affx</ext-link>.</mixed-citation>
</ref>
<ref id="pcbi.1003189-Repsilber1"><label>16</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Repsilber</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Kern</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Telaar</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Walzl</surname><given-names>G</given-names></name>, <name name-style="western"><surname>Black</surname><given-names>GF</given-names></name>, <etal>et al</etal>. (<year>2010</year>) <article-title>Biomarker discovery in heterogeneous tissue samples -taking the in-silico deconfounding approach</article-title>. <source>BMC Bioinformatics</source> <volume>11</volume>: <fpage>27</fpage>.</mixed-citation>
</ref>
</ref-list></back>
</article>