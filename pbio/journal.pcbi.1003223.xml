<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article
  PUBLIC "-//NLM//DTD Journal Publishing DTD v3.0 20080202//EN" "http://dtd.nlm.nih.gov/publishing/3.0/journalpublishing3.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="3.0" xml:lang="en">
<front>
<journal-meta>
<journal-id journal-id-type="publisher-id">plos</journal-id>
<journal-id journal-id-type="nlm-ta">PLoS Comput Biol</journal-id>
<journal-id journal-id-type="pmc">ploscomp</journal-id><journal-title-group>
<journal-title>PLoS Computational Biology</journal-title></journal-title-group>
<issn pub-type="ppub">1553-734X</issn>
<issn pub-type="epub">1553-7358</issn>
<publisher>
<publisher-name>Public Library of Science</publisher-name>
<publisher-loc>San Francisco, USA</publisher-loc></publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="publisher-id">PCOMPBIOL-D-13-00522</article-id>
<article-id pub-id-type="doi">10.1371/journal.pcbi.1003223</article-id>
<article-categories><subj-group subj-group-type="heading"><subject>Research Article</subject></subj-group></article-categories>
<title-group>
<article-title>Analyzing and Synthesizing Phylogenies Using Tree Alignment Graphs</article-title>
<alt-title alt-title-type="running-head">Synthesizing Phylogenies with Graphs</alt-title>
</title-group>
<contrib-group>
<contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Smith</surname><given-names>Stephen A.</given-names></name><xref ref-type="aff" rid="aff1"/><xref ref-type="corresp" rid="cor1"><sup>*</sup></xref></contrib>
<contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Brown</surname><given-names>Joseph W.</given-names></name><xref ref-type="aff" rid="aff1"/></contrib>
<contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Hinchliff</surname><given-names>Cody E.</given-names></name><xref ref-type="aff" rid="aff1"/></contrib>
</contrib-group>
<aff id="aff1"><addr-line>Department of Ecology and Evolutionary Biology, University of Michigan, Ann Arbor, Michigan, United States of America</addr-line></aff>
<contrib-group>
<contrib contrib-type="editor" xlink:type="simple"><name name-style="western"><surname>Kosakovsky Pond</surname><given-names>Sergei L.</given-names></name>
<role>Editor</role>
<xref ref-type="aff" rid="edit1"/></contrib>
</contrib-group>
<aff id="edit1"><addr-line>University of California San Diego, United States of America</addr-line></aff>
<author-notes>
<corresp id="cor1">* E-mail: <email xlink:type="simple">eebsmith@umich.edu</email></corresp>
<fn fn-type="conflict"><p>The authors have declared that no competing interests exist.</p></fn>
<fn fn-type="con"><p>Conceived and designed the experiments: SAS JWB CEH. Performed the experiments: SAS JWB CEH. Analyzed the data: SAS JWB CEH. Contributed reagents/materials/analysis tools: SAS JWB CEH. Wrote the paper: SAS JWB CEH.</p></fn>
</author-notes>
<pub-date pub-type="collection"><month>9</month><year>2013</year></pub-date>
<pub-date pub-type="epub"><day>26</day><month>9</month><year>2013</year></pub-date>
<volume>9</volume>
<issue>9</issue>
<elocation-id>e1003223</elocation-id>
<history>
<date date-type="received"><day>28</day><month>3</month><year>2013</year></date>
<date date-type="accepted"><day>31</day><month>7</month><year>2013</year></date>
</history>
<permissions>
<copyright-year>2013</copyright-year>
<copyright-holder>Smith et al</copyright-holder><license xlink:type="simple"><license-p>This is an open-access article distributed under the terms of the Creative Commons Attribution License, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p></license></permissions><related-article id="RA1" related-article-type="companion" ext-link-type="uri" vol="" page="e1002972" xlink:type="simple" xlink:href="info:doi/10.1371/journal.pcbi.1002972"> <article-title>New Methods Section in PLOS Computational Biology</article-title></related-article>
<abstract>
<p>Phylogenetic trees are used to analyze and visualize evolution. However, trees can be imperfect datatypes when summarizing multiple trees. This is especially problematic when accommodating for biological phenomena such as horizontal gene transfer, incomplete lineage sorting, and hybridization, as well as topological conflict between datasets. Additionally, researchers may want to combine information from sets of trees that have partially overlapping taxon sets. To address the problem of analyzing sets of trees with conflicting relationships and partially overlapping taxon sets, we introduce methods for aligning, synthesizing and analyzing rooted phylogenetic trees within a graph, called a tree alignment graph (TAG). The TAG can be queried and analyzed to explore uncertainty and conflict. It can also be synthesized to construct trees, presenting an alternative to supertrees approaches. We demonstrate these methods with two empirical datasets. In order to explore uncertainty, we constructed a TAG of the bootstrap trees from the Angiosperm Tree of Life project. Analysis of the resulting graph demonstrates that areas of the dataset that are unresolved in majority-rule consensus tree analyses can be understood in more detail within the context of a graph structure, using measures incorporating node degree and adjacency support. As an exercise in synthesis (i.e., summarization of a TAG constructed from the alignment trees), we also construct a TAG consisting of the taxonomy and source trees from a recent comprehensive bird study. We synthesized this graph into a tree that can be reconstructed in a repeatable fashion and where the underlying source information can be updated. The methods presented here are tractable for large scale analyses and serve as a basis for an alternative to consensus tree and supertree methods. Furthermore, the exploration of these graphs can expose structures and patterns within the dataset that are otherwise difficult to observe.</p>
</abstract>
<abstract abstract-type="summary"><title>Author Summary</title>
<p>Phylogenetic trees are the most common datatype by which we examine evolutionary patterns. However, biological and practical considerations require the exploration of other models. Here, we address a problem concerning the representation of conflicting and partially overlapping datasets in phylogenetics. We examine the problem of aligning many source trees from independent phylogenetic analyses into a structure that can be analyzed and synthesized but retain all of the original structure and source information. We present methods to map trees into a common graph structure using a graph database. This allows the information in the trees to be stored and synthesized in several ways. Specifically, we demonstrate how these graphs can be used to construct enormous trees as an alternative to labor-intensive grafting exercise and other methods that make the synthetic tree difficult to update. We also show how examination of the relationships in the graph allows patterns to emerge concerning support and information that are difficult to discern with existing methods. Because these methods scale well into the millions of nodes, these techniques should lead to the construction and maintenance of even larger phylogenies and new techniques for analyzing graphs that maintain the structure of the underlying trees.</p>
</abstract>
<funding-group><funding-statement>SAS, JWB, and CEH were supported by the NSF AVATOL 1207915. The funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.</funding-statement></funding-group><counts><page-count count="15"/></counts></article-meta>
</front>
<body><sec id="s1">
<title/>
<disp-quote>
<p><bold>This is a </bold><bold><italic>PLOS Computational Biology</italic></bold><bold> Methods article.</bold></p>
</disp-quote></sec><sec id="s2">
<title>Introduction</title>
<p>Evolutionary biologists use phylogenetic trees to conceptualize, visualize, and analyze the relationships among biological lineages. However, when examining trees from individual datasets (e.g., posterior distribution of trees, bootstrapped trees, individual gene trees) or multiple partially overlapping datasets, topological conflict is inevitably present. Conflict resulting from incomplete lineage sorting, horizontal gene transfer, and hybridization, as well as uncertainty due to lack of phylogenetic signal, provide reasons to consider alternatives to strictly acyclic data structures for analysis and/or visualization <xref ref-type="bibr" rid="pcbi.1003223-Maddison1">[1]</xref>–<xref ref-type="bibr" rid="pcbi.1003223-Knowles1">[3]</xref>. While trees perform well for many analytical purposes, practical and biological reasons exist to explore other potential models for encoding information about evolutionary relationships <xref ref-type="bibr" rid="pcbi.1003223-Huson1">[4]</xref>. Here, we examine methods for combining trees into a graph datatype while retaining all of the original information from the source phylogenies.</p>
<p>The need to visualize and analyze variability among phylogenetic trees has fostered the development of many methods, including consensus trees, cloudograms, concordance analysis, bipartition support, splits graphs, and supertree algorithms <xref ref-type="bibr" rid="pcbi.1003223-Huson1">[4]</xref>–<xref ref-type="bibr" rid="pcbi.1003223-Larget1">[10]</xref>. Huson and Scornavacca <xref ref-type="bibr" rid="pcbi.1003223-Huson2">[11]</xref> review a number of phylogenetic network methods that make use of graphs of higher complexity than strictly-bifurcating trees. Many of these attempt to infer a network structure from a sequence alignment instead of aligning source trees into a common structure. Other methods, used to identify hybridization and recombination events, recognize conflict in source trees. However, like network methods, they explicitly assume specific biological events to be the source of the conflict. Although many of these methods continue to be useful in exploring certain events, they do not fully retain the structure of the original source trees in the output statistics or summary networks.</p>
<p>Phylogenies can also be combined to construct a synthetic tree from source trees with partially overlapping taxon sets. Supertree methods are commonly used for this purpose <xref ref-type="bibr" rid="pcbi.1003223-BinindaEmonds1">[5]</xref>, <xref ref-type="bibr" rid="pcbi.1003223-Sanderson1">[12]</xref>, <xref ref-type="bibr" rid="pcbi.1003223-Davis1">[13]</xref>. These methods often produce a tree or trees (the supertree) intended to represent the relationships supported by the input trees. Although this has been demonstrated to be useful in many studies <xref ref-type="bibr" rid="pcbi.1003223-BinindaEmonds2">[14]</xref>–<xref ref-type="bibr" rid="pcbi.1003223-Pisani1">[16]</xref>, one drawback of supertree methods is that the identifiability of the source trees themselves is lost in the supertree-building process. Furthermore, supertree methods can reconstruct relationships that are not found in any of the input trees <xref ref-type="bibr" rid="pcbi.1003223-Wilkinson1">[17]</xref> making it difficult to interpret the source for such relationships. In addition to these criticisms, supertree methods are not explicitly targeted toward the exploration of variability among the input trees. One recent supertree method <xref ref-type="bibr" rid="pcbi.1003223-Berry1">[18]</xref> makes explicit use of a graph to construct a supertree from source trees that sample nodes from different taxonomic levels. The graph structure in this method functions as an temporary intermediate step. In the Berry et al. <xref ref-type="bibr" rid="pcbi.1003223-Berry1">[18]</xref> graphs, nodes and edges from source trees are mapped in a way that facilitates the extraction of the supertree from the graph, but the semantic identity of nodes and edges is different in the graphs than it is in the source trees (for instance, sibling nodes in source trees are directly connected by edges in the graph). In addition to addressing supertree analyses and bootstrap or posterior probability summaries, the benefit of more generalized data structures for combining trees can simplify practical exercises such as tree grafting <xref ref-type="bibr" rid="pcbi.1003223-Jetz1">[19]</xref> and comparisons among trees with fully or partially overlapping tip sets.</p>
<p>Existing solutions to both the tree synthesis and exploration of conflict problems involve analyses that result in a tree or set of trees that contain nodes and edges that are difficult to trace back to the source. Whether because of lack of available database technology or somewhat different goals, the problem of mapping a set of trees, while retaining all of the original information, into a common structure is not often addressed.</p>
<p>We present a set of methods intended to facilitate generalized analyses involving potentially conflicting phylogenetic trees with fully or partially overlapping sets of taxa. These methods address the problem of identifying common nodes and edges across sets of phylogenetic trees and constructing a data structure that efficiently contains this information while retaining original source information. We achieve this with algorithms that align trees into a graph structure called a tree alignment graph (TAG) and stores this information so it can be queried. These methods, which align and identify equivalent nodes across trees or graphs, fall within a class of methods known as graph alignment, and are analogous to the alignment methods of other domains <xref ref-type="bibr" rid="pcbi.1003223-Berg1">[20]</xref>–<xref ref-type="bibr" rid="pcbi.1003223-Lytynoja1">[22]</xref>. The goals achieved by aligning trees into a TAG are distinct from the amalgamation of sets of trees into a single tree (e.g. supertree methods), though, in addition to many other analyses, TAGs can be used to facilitate supertree and grafting exercises. As mentioned above, Berry et al. <xref ref-type="bibr" rid="pcbi.1003223-Berry1">[18]</xref> have also examined placing trees into graphs for the specific purpose of constructing supertrees. The methods presented here are intended to be more generally applicable and provide additional means for storing and querying. Other uses of TAGs include mapping uncertainty across trees, synthesis and extraction of a diverse set of summary trees, and more extensive queries that have previously been difficult to address.</p>
<p>Mapping trees into a TAG exploits the fact that rooted phylogenetic trees are in fact a specific type of graph: they are directed, acyclic, and require that each node has, at most, one parent. By relaxing these requirements, we can combine multiple trees into a common graph, while minimizing changes to the semantic interpretations of nodes and edges in the trees. Because they contain nodes and edges directly analogous to those from their source trees, TAGs have the desirable quality of retaining the full identifiability of the original source trees they contain. Additionally, because they are not restricted to the bifurcating model of evolution, TAGs may represent conflict among source trees as reticulations in the graph. Despite having higher complexity than trees, the graphs we present are amenable to fast traversals and straightforward interpretations regarding the evolutionary relationships they imply. In addition to the extraction of synthetic trees by customizable queries, TAGs also support the extraction of the original source trees themselves for the purposes of further analysis or updating.</p>
<p>Here we provide a description of the TAG datatype and some associated analyses. We also demonstrate the alignment of disparate phylogenetic trees with partially overlapping sets of terminal nodes into a graph, the exploration of conflicting and complementary hypotheses of ancestry defined by the input trees, and the extraction of synthesized trees summarizing compatible relationships from multiple input source trees.</p>
</sec><sec id="s3" sec-type="methods">
<title>Methods</title>
<p>The goals of aligning trees into a common graph are to 1) efficiently store potentially conflicting hypotheses about evolutionary relationships and 2) provide a framework by which information encoded in the source trees can be synthesized to test and develop evolutionary hypotheses. There are potentially many ways in which trees can be aligned into a graph. Here we describe ways to align trees into a TAG for partially and fully overlapping taxa. We will use <xref ref-type="fig" rid="pcbi-1003223-g001">Figure 1</xref> as a motivating example. First, showing the mapping of fully overlapping taxa (<xref ref-type="fig" rid="pcbi-1003223-g001">Figure 1A</xref>), then partially overlapping taxa (<xref ref-type="fig" rid="pcbi-1003223-g001">Figure 1B</xref>), and finally synthesis of the graph into a tree (<xref ref-type="fig" rid="pcbi-1003223-g001">Figure 1C</xref>).</p>
<fig id="pcbi-1003223-g001" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003223.g001</object-id><label>Figure 1</label><caption>
<title>Mapping schematic.</title>
<p>A basic schematic of the results of mapping and synthesis. A) Three source trees with completely overlapping taxon sets (left) mapped into a graph (right). The colored edges in the graph correspond to the source trees on the left, with graph nodes represented as gray circles. Internal graph nodes represent least inclusive common ancestors (LICAs), and are labelled with their descendant terminal taxa. B) A grey taxonomy hierarchy and additional green source tree added to the black, blue, and orange trees from A. The relationships presented in the black, blue, and orange trees are in light grey to cut down on clutter. C) A synthetic tree resulting from preferring source blue, green, and taxonomic source trees.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003223.g001" position="float" xlink:type="simple"/></fig><sec id="s3a">
<title>Definitions</title>
<p>The procedures discussed below require as input a set of rooted, acyclic, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e001" xlink:type="simple"/></inline-formula>-furcating source trees <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e002" xlink:type="simple"/></inline-formula>, whose terminal nodes are labeled according to a common convention (see below). A source tree, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e003" xlink:type="simple"/></inline-formula>, may typically be a phylogenetic tree but can be any hierarchy implying ancestry (e.g. a taxonomic classification). The complete set of source tree nodes from <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e004" xlink:type="simple"/></inline-formula> is defined as <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e005" xlink:type="simple"/></inline-formula>, with each tree <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e006" xlink:type="simple"/></inline-formula> containing a set of nodes <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e007" xlink:type="simple"/></inline-formula>. A branch extending from node <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e008" xlink:type="simple"/></inline-formula> to parent node <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e009" xlink:type="simple"/></inline-formula> in source tree <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e010" xlink:type="simple"/></inline-formula> is defined as <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e011" xlink:type="simple"/></inline-formula>. The set of all branches in the set of all sources trees <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e012" xlink:type="simple"/></inline-formula> is defined as <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e013" xlink:type="simple"/></inline-formula>.</p>
<p>The graph <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e014" xlink:type="simple"/></inline-formula> defines a common data structure into which the complete set of trees <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e015" xlink:type="simple"/></inline-formula> are aligned. We define the set of nodes <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e016" xlink:type="simple"/></inline-formula> in the graph <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e017" xlink:type="simple"/></inline-formula> to represent the set of realized hypothetical ancestors for the lineages exemplified in the set of all source tree nodes <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e018" xlink:type="simple"/></inline-formula>. Each node <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e019" xlink:type="simple"/></inline-formula> from a source tree <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e020" xlink:type="simple"/></inline-formula> is aligned to at least one node in the graph <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e021" xlink:type="simple"/></inline-formula>. The edges connecting nodes <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e022" xlink:type="simple"/></inline-formula> in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e023" xlink:type="simple"/></inline-formula> are enumerated in the set <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e024" xlink:type="simple"/></inline-formula>.</p>
<p>A least inclusive common ancestor (LICA) is an internal graph node to which internal source tree nodes can be aligned (<xref ref-type="fig" rid="pcbi-1003223-g001">Figure 1</xref>).</p>
</sec><sec id="s3b">
<title>Taxonomic requirements</title>
<p>For multiple trees to be combined, they must all subscribe to a consistent taxonomic naming convention. For simplicity we use labels on the trees as identifiers, though the use of node labels as unique identifiers introduces potential problems regarding lineage identifiability when data from sources using different naming conventions (i.e. taxonomies) are combined. To alleviate these problems, one could use defined identifiers (e.g., global unique identifiers). When using labels to match nodes, all node labels in each input tree are required to be unique. Before source trees are added, the TAG will be loaded with a taxonomy, either with a hierarchy or with no additional information (i.e. where each terminal node is connected to a root node). This provides the graph with the complete set of node labels.</p>
</sec><sec id="s3c">
<title>Overlapping taxon sets</title>
<p>Suppose we want to combine three trees each with the same four taxa: a,b,c, and d (<xref ref-type="fig" rid="pcbi-1003223-g001">Figure 1A</xref>). First, each terminal node in each input source tree is aligned to a graph node based on the node labels. The taxonomy is not shown in <xref ref-type="fig" rid="pcbi-1003223-g001">Figure 1A</xref> to reduce clutter, but is shown as the grey tree in <xref ref-type="fig" rid="pcbi-1003223-g001">Figure 1B</xref>.</p>
<p>After terminal nodes are aligned, internal nodes of each source tree are aligned to nodes identified as LICAs in the TAG. When the taxa are completely overlapping in source trees, a TAG node is a LICA for an internal node in a source tree if the descendants of the graph node (a) include all terminal descendants of the source tree node and (b) does not include any terminal descendants of the source tree excluding those contained within the current source tree node. To state that more technically, we need to define some terms. Let <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e025" xlink:type="simple"/></inline-formula> be the set of all subtending nodes arising from an internal source tree node <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e026" xlink:type="simple"/></inline-formula>. Let <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e027" xlink:type="simple"/></inline-formula> be the set of nodes in the source tree <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e028" xlink:type="simple"/></inline-formula> that are not descended from <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e029" xlink:type="simple"/></inline-formula>. Let <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e030" xlink:type="simple"/></inline-formula> be the set of all subtending nodes arising from a TAG node <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e031" xlink:type="simple"/></inline-formula>. A TAG node in the set of TAG nodes <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e032" xlink:type="simple"/></inline-formula> will be a potential LICA if <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e033" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e034" xlink:type="simple"/></inline-formula>. An alternative LICA mapping technique is described below. If no graph node represents a valid LICA for a given source tree node <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e035" xlink:type="simple"/></inline-formula>, then a new graph node is created and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e036" xlink:type="simple"/></inline-formula> is aligned to it. When mapping the first input tree <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e037" xlink:type="simple"/></inline-formula> into an empty TAG, a new graph node will be created for every node in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e038" xlink:type="simple"/></inline-formula>, leading to the exact duplication of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e039" xlink:type="simple"/></inline-formula> in the graph <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e040" xlink:type="simple"/></inline-formula>. If a LICA is not found a new one is created.</p>
<p>As the set of all input source tree nodes <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e041" xlink:type="simple"/></inline-formula> are aligned to LICA graph nodes in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e042" xlink:type="simple"/></inline-formula>, appropriate edges <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e043" xlink:type="simple"/></inline-formula> are created. Edges in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e044" xlink:type="simple"/></inline-formula> are directed, from children to parents, and individual input branches are mapped directly to one edge (that is, an identical branch from two input trees will be represented by two parallel graph edges). Upon these edges, any amount of branch- or tree-specific metadata may be stored (e.g., branch lengths, branch labels, bibliographic citations, dataset information, inference techniques). Given this structure, the TAG provides lossless storage of all source data. Tree-wise metadata about a source tree may be stored as a property of the source tree root node in the graph. This includes, at a minimum, the set of all terminal node labels that occur in that source tree, but could also include any other information such as provenance, taxonomic scope, authorship, etc. These properties may be queried to return information about (and handles to) source trees stored in the graph, thus providing lossless storage and queryable access to the source trees themselves (within the TAG). With this framework, as demonstrated in <xref ref-type="fig" rid="pcbi-1003223-g001">Figure 1A</xref>, we can align multiple trees with overlapping taxon sets into a graph.</p>
</sec><sec id="s3d">
<title>Partially overlapping taxon sets</title>
<p>In addition to aligning trees with completely overlapping taxon sets, we may align trees with partially overlapping taxon sets (<xref ref-type="fig" rid="pcbi-1003223-g001">Figure 1B</xref>). This example includes a taxonomy (the gray tree) with two internal node names (x and y), the three source trees from <xref ref-type="fig" rid="pcbi-1003223-g001">Figure 1A</xref>, as well as an additional green source tree. For partially overlapping taxon sets, depending on the nature of the overlap and conflict, we can use the procedure described above, or we can align source tree nodes to LICAs in the TAG using slightly modified criteria. This modified criteria includes recording the bipartion, including the information on the taxa subtending the TAG node, as well as the taxa that must be excluded. Therefore the bipartition LICA requirement is as follows. As with above, let <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e045" xlink:type="simple"/></inline-formula> be the set of all subtending nodes arising from an internal source tree node <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e046" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e047" xlink:type="simple"/></inline-formula> be the set of nodes in the source tree <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e048" xlink:type="simple"/></inline-formula> that are not descended from <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e049" xlink:type="simple"/></inline-formula>. Let <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e050" xlink:type="simple"/></inline-formula> be the set of all subtending nodes arising from a TAG node <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e051" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e052" xlink:type="simple"/></inline-formula> is the set of nodes that are recorded to not be descended from <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e053" xlink:type="simple"/></inline-formula>. A TAG node is then a potential LICA if <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e054" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e055" xlink:type="simple"/></inline-formula>, and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e056" xlink:type="simple"/></inline-formula>. This procedure also requires that all lineages from the source tree be represented in the set of source trees that make up the TAG LICA. The procedure for overlapping taxon sets assumes that any taxa not within a clade are in the other partition. That is not the case for this procedure and so we record what members of the other bipartition have been realized. When there is incomplete overlap in taxa sampled among the source trees the LICAs may partially overlap (e.g., the LICA for a,d in the green tree is the same graph node as the LICA for a,b,c,d in the black, blue and orange trees). It may be the case, with partially overlapping taxon sets, that a node in set of graph nodes <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e057" xlink:type="simple"/></inline-formula> and its parent are both LICAs. In these cases, the LICA is mapped to the shallowest node. It is also possible that multiple LICAs will be found, in which case, each will be mapped. For a specific source tree node this can occur when multiple LICAs contain all of the subtending nodes for the source tree node, but also contain sets of additional nodes that are not present in the source tree.</p>
<p>For partially overlapping taxon sets, the order of trees can influence the alignment of trees into the TAG because of the order of new nodes created. As source trees are aligned into the TAG, graph nodes may be created which represent new LICAs for nodes from previously imported source trees, and in some cases may invalidate LICA mappings for previously added nodes. For example, this can occur when an input tree node <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e058" xlink:type="simple"/></inline-formula> in a source tree <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e059" xlink:type="simple"/></inline-formula> is aligned to a graph node whose subgraph contains terminal nodes not aligned to any nodes in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e060" xlink:type="simple"/></inline-formula>. So, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e061" xlink:type="simple"/></inline-formula> contains a subset of the taxa that are associated with the current LICA(s). A source tree may be added later that necessitates the creation of a new graph node that is aligned to all the descendant terminal nodes of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e062" xlink:type="simple"/></inline-formula>, but which is nested shallower than the current LICA of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e063" xlink:type="simple"/></inline-formula>. In this case, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e064" xlink:type="simple"/></inline-formula> should be re-aligned to the new TAG node. This order-dependence can be overcome, however, by re-aligning the nodes from a source tree. We do this by re-processing source trees once all have been added to determine if there are better LICA mappings, and the final structure is independent of the order of addition. This final graph is what is seen in <xref ref-type="fig" rid="pcbi-1003223-g001">Figure 1B</xref>.</p>
</sec><sec id="s3e">
<title>TAG synthesis techniques</title>
<p>Many operations and queries can be conducted on a graph with trees aligned as shown in <xref ref-type="fig" rid="pcbi-1003223-g001">Figure 1</xref>. One common operation is synthesis of the TAG. By synthesis, we mean the selection of relationships in the graph either by filtering or other procedure to produce a synthetic or composite tree. There are a number of different ways to synthesize the TAG and here we describe a few including (1) preference for specific source trees, (2) preference for more highly supported nodes, and (3) routes with a maximum number of taxa using a branch-and-bound optimization. In <xref ref-type="fig" rid="pcbi-1003223-g001">Figure 1C</xref>, we show the result of one synthetic analysis on the graph where we prefer source trees and specifically (in order) blue, green, and taxonomy source trees.</p>
<p>In each case, synthesis begins by identifying a starting node. For example, this may be a particular clade identified by name or by its set of descendant terminal nodes (i.e. the identification of a LICA). To make a tree from an entire TAG the procedure starts at the root node. From this focal node, it proceeds breadth-first in determining which nodes to include in the synthesis as we traverse the TAG. At each node, the procedure examines the subtending nodes, and determines if any of them conflict. For synthesis, downstream conflict is determined by comparing the LICAs for each child. If the LICAs from nodes subtending the current node overlap, then these descendant subgraphs define incompatible subtrees, and are said to be in conflict (see the sections on measurements of support and conflict for an alternative method of detecting such conflict). In such cases, the procedure must make a decision about which path to prefer. In <xref ref-type="fig" rid="pcbi-1003223-g001">Figure 1C</xref>, we prefer specific source trees, but there are many criteria that can be used to inform these decisions. The resulting synthetic tree in <xref ref-type="fig" rid="pcbi-1003223-g001">Figure 1C</xref> is a composite of the source trees stored in the TAG. Because of the mapping of the source trees to common graph nodes, the synthetic tree includes the internal node names that originate from the taxonomy. Although we present a tree as the result of synthesis, there is no requirement that the synthetic product be a tree. However, a tree will likely be a more common product.</p>
<sec id="s3e1">
<title>Preferring certain source trees</title>
<p>One of the simplest but most useful methods for constructing a synthesized tree is to prefer paths from specific source trees included in the graph. This procedure can generate a tree that is entirely congruent with the most-preferred source tree, but which may contain more lineages. In fact, the synthetic tree will contain terminal lineages from all other source trees in the TAG that are compatible with the preferred set. This procedure requires the identification of a preferred list of source trees, sorted by preference. The trees in the preferred list are consulted in order, and any conflicts among them are resolved in favor of those with higher positions in the list. This procedure could easily be extended to use any kind of source tree metadata, such as pre-calculated node support (e.g. posterior probabilities, bootstrap proportions), presence or absence of branch lengths, or other properties.</p>
</sec><sec id="s3e2">
<title>Preferring better-supported nodes</title>
<p>Properties such as node and edge support can also be used to resolve conflict. In the examples below, node support <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e065" xlink:type="simple"/></inline-formula> is measured as the proportion of source trees in which the given node is observed. In a TAG constructed from source trees with completely overlapping terminal node sets, the proportion of trees exhibiting a node is the number of outgoing branches (these point to the parent of the specified node). In TAGs containing source trees with incompletely overlapping terminal node sets, node support for a given node <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e066" xlink:type="simple"/></inline-formula> must be corrected to reflect (1) the number of source trees containing any node that may be mapped to <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e067" xlink:type="simple"/></inline-formula>, and (2) the potential that the parent of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e068" xlink:type="simple"/></inline-formula> in some source tree could have been aligned to more than one LICA. In this case, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e069" xlink:type="simple"/></inline-formula> is the number of source trees associated with the set of outgoing edges of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e070" xlink:type="simple"/></inline-formula>, divided by the number of source trees containing any terminal node aligned to any descendant of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e071" xlink:type="simple"/></inline-formula> (these are the source trees that could be aligned to <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e072" xlink:type="simple"/></inline-formula>).</p>
<p>In a support-based tie-breaking procedure, preference is given to the node with the highest support. In datasets with completely overlapping taxon sets, the nodes chosen by this procedure are frequently the same as those chosen by a traditional consensus tree analysis. However, this is a greedy procedure and does not guarantee that the resulting synthetic tree is the best supported tree. Differences between a majority-rule consensus and a best-support synthesis tree will lie mostly in poorly supported areas of a tree.</p>
</sec><sec id="s3e3">
<title>Preferring complete trees using branch and bound optimization</title>
<p>When constructing a synthetic tree from a TAG containing conflict, one challenge lies in maximizing the number of the terminal nodes that will be present in the final synthetic tree. The worst-case for this problem is presented when no additional information is provided to break conflicts. In a general sense, this is related to a classic set cover problem (Aho et al., 1974), and is likely to be NP-complete. The solution can be greatly simplified by specifying other properties (such as those mentioned in the previous two sections) with which to break conflicts. In lieu of such specified properties, however, we present a branch-and-bound approach to attempt to maximize the number of terminal nodes in the synthesized tree. There are two implementations of this algorithm: in the first, the bound is based on minimizing cost; in the second, it is based on maximizing scores. The algorithms are presented in the supplemental materials.</p>
</sec></sec><sec id="s3f">
<title>Measuring support and conflict within a TAG</title>
<p>In simple examples as in <xref ref-type="fig" rid="pcbi-1003223-g001">Figure 1</xref>, conflict and support is easy to observe. For more complex TAGs, such as the angiosperm TAG described below, we can calculate node- and edge-based statistics on the graph <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e073" xlink:type="simple"/></inline-formula> to describe support and conflict throughout. Node support is calculated as the number of source trees aligned to the focal graph node, scaled by the number of source trees that could be aligned to that node (i.e. contain overlapping taxon sets). Edge support, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e074" xlink:type="simple"/></inline-formula> for the edge between the child node <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e075" xlink:type="simple"/></inline-formula> and its parent <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e076" xlink:type="simple"/></inline-formula>, is calculated in a similar fashion to node support: it is the number of times that edge is observed (i.e. the number of exactly parallel graph edges between the same parent and child nodes) scaled by the number of source trees in which that edge may be observed.</p>
<p>Complementary to edge-based metrics of support, node-degree (the number of nodes adjacent to a focal node) reflects node-based conflict and uncertainty. As a TAG is a directed graph, we partition node-degree into 1) child- and 2) parent-node relationships. Simple child- or parent-degree counts are not directly informative, as node relationships can be supported to different extents (i.e. by the number of source trees exhibiting the relationships). Because all node relationships from all input source trees are preserved in the graph (even identical relationships), we can instead calculate the <italic>effective</italic> number (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e077" xlink:type="simple"/></inline-formula>) of directed node relationships. Consider a focal graph node <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e078" xlink:type="simple"/></inline-formula> with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e079" xlink:type="simple"/></inline-formula> parent nodes, but <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e080" xlink:type="simple"/></inline-formula> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e081" xlink:type="simple"/></inline-formula> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e082" xlink:type="simple"/></inline-formula> parent-node relationships (that is, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e083" xlink:type="simple"/></inline-formula> is present in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e084" xlink:type="simple"/></inline-formula> source trees, all of which may potentially differ in taxon overlap). Each parent node <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e085" xlink:type="simple"/></inline-formula> is supported by some proportion <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e086" xlink:type="simple"/></inline-formula> of the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e087" xlink:type="simple"/></inline-formula> trees. The effective number of parent nodes for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e088" xlink:type="simple"/></inline-formula> is given by:<disp-formula id="pcbi.1003223.e089"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003223.e089" xlink:type="simple"/><label>(1)</label></disp-formula></p>
<p>The effective number of child nodes <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e090" xlink:type="simple"/></inline-formula> is calculated similarly, dealing with the number of child nodes and child-node relationships. This metric corresponds to the inverse Simpson diversity index (Simpson, 1949), and is larger when directed node relationships are more evenly supported. For example, a graph node with two parent nodes each supported by 500 trees will have 2 effective parents, whereas another graph node with one parent supported by 999 trees and another parent supported by 1 tree will have 1.002002 effective parents. Note that terminal graph nodes possess no children, and the root graph node has no parent. In general, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e091" xlink:type="simple"/></inline-formula> reflects phylogenetic uncertainty (or lack of information), while <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e092" xlink:type="simple"/></inline-formula> reflects immediate topological conflict (e.g. when a node has 2 or more parent nodes; <xref ref-type="fig" rid="pcbi-1003223-g001">Figure 1A</xref>). In a fully bifurcating TAG, each internal node will have <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e093" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e094" xlink:type="simple"/></inline-formula>. Note that in the tree synthesis procedures above, an overlap of LICA descendants indicates that one or more topological conflicts (that is, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e095" xlink:type="simple"/></inline-formula>) resides somewhere within the subtending graph.</p>
<p>While the effective number of parents indicates the degree of immediate topological conflict, it ignores the frequency at which a given node <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e096" xlink:type="simple"/></inline-formula> occurs across a set of source trees. We therefore also define a measure of destabilization, which is the number of effective parents for node <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e097" xlink:type="simple"/></inline-formula> scaled by its support:<disp-formula id="pcbi.1003223.e098"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003223.e098" xlink:type="simple"/><label>(2)</label></disp-formula></p>
<p>Destabilization measures the contribution of a given LICA to the conflict in the neighboring nodes. Graph nodes with high values of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e099" xlink:type="simple"/></inline-formula> are frequently observed in source trees but rarely in the same topological position. These nodes contribute heavily to the collapse of clades in traditional consensus methods.</p>
<p>For each internal node <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e100" xlink:type="simple"/></inline-formula> in the graph we also calculate the average <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e101" xlink:type="simple"/></inline-formula> for all <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e102" xlink:type="simple"/></inline-formula> descendant nodes:<disp-formula id="pcbi.1003223.e103"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003223.e103" xlink:type="simple"/><label>(3)</label></disp-formula></p>
<p>A <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e104" xlink:type="simple"/></inline-formula> value greater than 1 indicates that the subgraph of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e105" xlink:type="simple"/></inline-formula> contains conflict. This statistic has the useful property of being directly comparable among TAGs constructed from different data sets.</p>
<p>It is also useful to quantify how average downstream conflict <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e106" xlink:type="simple"/></inline-formula> changes with the inclusion of a graph node <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e107" xlink:type="simple"/></inline-formula> and its descendant subgraph. We therefore compute a metric of resolution, which quantifies the difference in average downstream conflict between a node <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e108" xlink:type="simple"/></inline-formula> and its <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e109" xlink:type="simple"/></inline-formula> immediate parent node(s):<disp-formula id="pcbi.1003223.e110"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003223.e110" xlink:type="simple"/><label>(4)</label></disp-formula>where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e111" xlink:type="simple"/></inline-formula> is the node support for node <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e112" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e113" xlink:type="simple"/></inline-formula> is the edge support connecting node <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e114" xlink:type="simple"/></inline-formula> to its parent node <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e115" xlink:type="simple"/></inline-formula>, and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e116" xlink:type="simple"/></inline-formula> is the average downstream conflict experienced by parent node <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e117" xlink:type="simple"/></inline-formula>. High values of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e118" xlink:type="simple"/></inline-formula> indicate clades that are frequently observed but whose inclusion in the graph contributes heavily to overall conflict within their parent clade.</p>
</sec><sec id="s3g">
<title>Implementation</title>
<p>These methods have been implemented in the software treemachine, which makes use of the NoSQL graph database Neo4j (<ext-link ext-link-type="uri" xlink:href="http://www.neo4j.org/" xlink:type="simple">http://www.neo4j.org/</ext-link>). Treemachine is an open source application developed for the Open Tree of Life project (<ext-link ext-link-type="uri" xlink:href="http://opentreeoflife.org/" xlink:type="simple">http://opentreeoflife.org/</ext-link>). The source code and executable used for the examples presented here are available from the treemachine repository on GitHub <ext-link ext-link-type="uri" xlink:href="https://github.com/OpenTreeOfLife/treemachine" xlink:type="simple">https://github.com/OpenTreeOfLife/treemachine</ext-link>.</p>
</sec></sec><sec id="s4">
<title>Results/Discussion</title>
<sec id="s4a">
<title>Empirical example datasets</title>
<p>We demonstrate the methods described above using two empirical datasets. First, we use bootstrap trees for 640 species representing the majority of known seed plant lineages from the Angiosperm Tree of Life analyses <xref ref-type="bibr" rid="pcbi.1003223-Soltis1">[23]</xref>. These bootstrap samples are used to demonstrate the utility of TAGs for exploring conflict within a dataset of completely overlapping taxa. Second, we explore a bird dataset analyzed in Jetz et al. <xref ref-type="bibr" rid="pcbi.1003223-Jetz1">[19]</xref> that includes source trees for individual clades of birds, a backbone phylogeny, and taxonomic information. We use this to show how TAGs may be employed for tree-grafting procedures that can combine less-inclusive trees to create more-inclusive ones. Data used in this study has been deposited in Dryad (<ext-link ext-link-type="uri" xlink:href="http://datadryad.org/" xlink:type="simple">http://datadryad.org/</ext-link>).</p>
</sec><sec id="s4b">
<title>Mapping uncertainty in seed plant phylogeny</title>
<p>The methods discussed here can be useful for exploring conflict and congruence among source trees with completely overlapping terminal nodes (e.g. a bootstrap or posterior distribution of trees). We explore this on the Angiosperm Tree of Life dataset <xref ref-type="bibr" rid="pcbi.1003223-Soltis1">[23]</xref>. This dataset is one of the most comprehensive phylogenetic datasets available for flowering plants, and represents confidence, or lack thereof, in flowering plant relationships. Although relationships in many clades have been well described, relationships within some have proven difficult to resolve. The conflict introduced by these unresolved clades provides an ideal case for the exploration of TAGs as a datatype to investigate uncertainty.</p>
<p>The TAG was constructed by loading one hundred bootstrap trees constructed with the full dataset of all 17 gene regions and 640 taxa included in the original study. No additional structural information (e.g. a taxonomy tree) was given. <xref ref-type="fig" rid="pcbi-1003223-g002">Figures 2</xref>–<xref ref-type="fig" rid="pcbi-1003223-g004">4</xref> depict this graph. Much of the structure of the graph is resolved (denoted by the large proportion of blue nodes in <xref ref-type="fig" rid="pcbi-1003223-g002">Figure 2</xref>), in accordance with the consensus tree presented in the original publication. Though some areas have significantly more complex structure (denoted by the large complex reticulate structures).</p>
<fig id="pcbi-1003223-g002" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003223.g002</object-id><label>Figure 2</label><caption>
<title>Graph of Angiosperm Tree of Life with effective parents.</title>
<p>A graph showing the mapping of the Angiosperm Tree of Life project bootstrap dataset of 100 trees that includes 640 taxa with chloroplast, mitochondrial, and ribosomal data <xref ref-type="bibr" rid="pcbi.1003223-Soltis1">[23]</xref>. Larger node size indicates higher node support. Node color indicates the number of effective parents (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e119" xlink:type="simple"/></inline-formula>) of each node, with blue nodes having relatively small values of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e120" xlink:type="simple"/></inline-formula>, orange nodes with values between <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e121" xlink:type="simple"/></inline-formula> and red to pink nodes with values of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e122" xlink:type="simple"/></inline-formula>.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003223.g002" position="float" xlink:type="simple"/></fig><fig id="pcbi-1003223-g003" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003223.g003</object-id><label>Figure 3</label><caption>
<title>Graph of Angiosperm Tree of Life with average effective parents.</title>
<p>A graph showing the mapping of the Angiosperm Tree of Life project bootstrap dataset of 100 trees that includes 640 taxa with chloroplast, mitochondrial, and ribosomal data <xref ref-type="bibr" rid="pcbi.1003223-Soltis1">[23]</xref>. Larger node size indicates higher node support. Node color indicates the average subgraph destabilization (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e123" xlink:type="simple"/></inline-formula>) of each node, with blue nodes having relatively small values of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e124" xlink:type="simple"/></inline-formula>, orange nodes with values between <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e125" xlink:type="simple"/></inline-formula> and red to pink nodes with values of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e126" xlink:type="simple"/></inline-formula>.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003223.g003" position="float" xlink:type="simple"/></fig><fig id="pcbi-1003223-g004" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003223.g004</object-id><label>Figure 4</label><caption>
<title>Graph of Angiosperm Tree of Life with nodes having the highest amount of conflict highlighted.</title>
<p>A graph showing the mapping of the Angiosperm Tree of Life project bootstrap dataset of 100 trees that includes 640 taxa with chloroplast, mitochondrial, and ribosomal data <xref ref-type="bibr" rid="pcbi.1003223-Soltis1">[23]</xref>. Large purple nodes are those corresponding to nodes in <xref ref-type="table" rid="pcbi-1003223-t002">Table 2</xref>.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003223.g004" position="float" xlink:type="simple"/></fig>
<p>To characterize conflict within this TAG we use several statistics described above including node support (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e127" xlink:type="simple"/></inline-formula>) and the effective number of parent nodes (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e128" xlink:type="simple"/></inline-formula>). Highly supported nodes with a low number of effective parents (i.e. high <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e129" xlink:type="simple"/></inline-formula>, low <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e130" xlink:type="simple"/></inline-formula>), represent nodes that are frequently recovered and confidently placed in the source trees (large blue nodes in <xref ref-type="fig" rid="pcbi-1003223-g002">Figure 2</xref>). Highly supported nodes with high <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e131" xlink:type="simple"/></inline-formula> (large, orange to pink) are nodes that are frequently resolved in source trees but their placement varies among bootstrap replicates. We calculated destabilization statistics (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e132" xlink:type="simple"/></inline-formula>) for this TAG as well. Nodes with high support and low confidence have high <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e133" xlink:type="simple"/></inline-formula> and represent major sources of conflict, whereas nodes with low <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e134" xlink:type="simple"/></inline-formula> contribute little to overall conflict. <xref ref-type="table" rid="pcbi-1003223-t001">Table 1</xref> presents the nodes with the highest <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e135" xlink:type="simple"/></inline-formula> values in the dataset. Note that a high proportion of destabilizing nodes are from the order Malpighiales.</p>
<table-wrap id="pcbi-1003223-t001" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003223.t001</object-id><label>Table 1</label><caption>
<title>Twenty-five destabilizing plant clades.</title>
</caption><alternatives><graphic id="pcbi-1003223-t001-1" position="float" mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003223.t001" xlink:type="simple"/>
<table><colgroup span="1"><col align="left" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/></colgroup>
<thead>
<tr>
<td align="left" rowspan="1" colspan="1">rank</td>
<td align="left" rowspan="1" colspan="1">order</td>
<td align="left" rowspan="1" colspan="1">taxon</td>
<td align="left" rowspan="1" colspan="1"><italic>s</italic></td>
<td align="left" rowspan="1" colspan="1"><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e136" xlink:type="simple"/></inline-formula></td>
<td align="left" rowspan="1" colspan="1"><italic>d</italic></td>
</tr>
</thead>
<tbody>
<tr>
<td align="left" rowspan="1" colspan="1">1</td>
<td align="left" rowspan="1" colspan="1">Malpighiales</td>
<td align="left" rowspan="1" colspan="1">Lophopyxidaceae + Putranjivaceae</td>
<td align="left" rowspan="1" colspan="1">1.00</td>
<td align="left" rowspan="1" colspan="1">18.38</td>
<td align="left" rowspan="1" colspan="1">18.38</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">2</td>
<td align="left" rowspan="1" colspan="1">Malpighiales</td>
<td align="left" rowspan="1" colspan="1">Pandaceae</td>
<td align="left" rowspan="1" colspan="1">1.00</td>
<td align="left" rowspan="1" colspan="1">18.25</td>
<td align="left" rowspan="1" colspan="1">18.25</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">3</td>
<td align="left" rowspan="1" colspan="1">Malpighiales</td>
<td align="left" rowspan="1" colspan="1">Salicaceae + Lacistemataceae</td>
<td align="left" rowspan="1" colspan="1">0.99</td>
<td align="left" rowspan="1" colspan="1">17.22</td>
<td align="left" rowspan="1" colspan="1">17.05</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">4</td>
<td align="left" rowspan="1" colspan="1">Malpighiales</td>
<td align="left" rowspan="1" colspan="1">Picodendraceae + Phyllanthaceae</td>
<td align="left" rowspan="1" colspan="1">0.99</td>
<td align="left" rowspan="1" colspan="1">15.43</td>
<td align="left" rowspan="1" colspan="1">15.28</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">5</td>
<td align="left" rowspan="1" colspan="1">Malpighiales</td>
<td align="left" rowspan="1" colspan="1">Malpighiaceae + Elatinaceae</td>
<td align="left" rowspan="1" colspan="1">1.00</td>
<td align="left" rowspan="1" colspan="1">15.02</td>
<td align="left" rowspan="1" colspan="1">15.02</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">6</td>
<td align="left" rowspan="1" colspan="1">Malpighiales</td>
<td align="left" rowspan="1" colspan="1">clade 1</td>
<td align="left" rowspan="1" colspan="1">1.00</td>
<td align="left" rowspan="1" colspan="1">9.75</td>
<td align="left" rowspan="1" colspan="1">9.75</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">7</td>
<td align="left" rowspan="1" colspan="1">Ericales</td>
<td align="left" rowspan="1" colspan="1">clade 2</td>
<td align="left" rowspan="1" colspan="1">0.98</td>
<td align="left" rowspan="1" colspan="1">9.42</td>
<td align="left" rowspan="1" colspan="1">9.23</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">8</td>
<td align="left" rowspan="1" colspan="1">Malpighiales</td>
<td align="left" rowspan="1" colspan="1">Linaceae</td>
<td align="left" rowspan="1" colspan="1">1.00</td>
<td align="left" rowspan="1" colspan="1">7.52</td>
<td align="left" rowspan="1" colspan="1">7.52</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">9</td>
<td align="left" rowspan="1" colspan="1">Malpighiales</td>
<td align="left" rowspan="1" colspan="1">clade 3</td>
<td align="left" rowspan="1" colspan="1">0.48</td>
<td align="left" rowspan="1" colspan="1">15.16</td>
<td align="left" rowspan="1" colspan="1">7.28</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">10</td>
<td align="left" rowspan="1" colspan="1">Malpighiales</td>
<td align="left" rowspan="1" colspan="1">clade 4</td>
<td align="left" rowspan="1" colspan="1">1.00</td>
<td align="left" rowspan="1" colspan="1">6.95</td>
<td align="left" rowspan="1" colspan="1">6.95</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">11</td>
<td align="left" rowspan="1" colspan="1">Malpighiales</td>
<td align="left" rowspan="1" colspan="1">Euphorbiaceae + Ochnaceae</td>
<td align="left" rowspan="1" colspan="1">1.00</td>
<td align="left" rowspan="1" colspan="1">6.79</td>
<td align="left" rowspan="1" colspan="1">6.79</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">12</td>
<td align="left" rowspan="1" colspan="1">Bruniales</td>
<td align="left" rowspan="1" colspan="1">Columelliaceae</td>
<td align="left" rowspan="1" colspan="1">1.00</td>
<td align="left" rowspan="1" colspan="1">5.26</td>
<td align="left" rowspan="1" colspan="1">5.26</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">13</td>
<td align="left" rowspan="1" colspan="1">Bruniales</td>
<td align="left" rowspan="1" colspan="1">Bruniaceae</td>
<td align="left" rowspan="1" colspan="1">1.00</td>
<td align="left" rowspan="1" colspan="1">5.25</td>
<td align="left" rowspan="1" colspan="1">5.25</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">14</td>
<td align="left" rowspan="1" colspan="1">Oxalidales</td>
<td align="left" rowspan="1" colspan="1">Cunoniaceae</td>
<td align="left" rowspan="1" colspan="1">1.00</td>
<td align="left" rowspan="1" colspan="1">5.21</td>
<td align="left" rowspan="1" colspan="1">5.21</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">15</td>
<td align="left" rowspan="1" colspan="1">Lamiales</td>
<td align="left" rowspan="1" colspan="1">Martynia + Sesamum</td>
<td align="left" rowspan="1" colspan="1">0.61</td>
<td align="left" rowspan="1" colspan="1">8.40</td>
<td align="left" rowspan="1" colspan="1">5.12</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">16</td>
<td align="left" rowspan="1" colspan="1">Escalloniales</td>
<td align="left" rowspan="1" colspan="1">Escalloniaceae</td>
<td align="left" rowspan="1" colspan="1">0.91</td>
<td align="left" rowspan="1" colspan="1">5.47</td>
<td align="left" rowspan="1" colspan="1">4.98</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">17</td>
<td align="left" rowspan="1" colspan="1">Solanales</td>
<td align="left" rowspan="1" colspan="1">Solanales</td>
<td align="left" rowspan="1" colspan="1">1.00</td>
<td align="left" rowspan="1" colspan="1">4.78</td>
<td align="left" rowspan="1" colspan="1">4.78</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">18</td>
<td align="left" rowspan="1" colspan="1">Malpighiales</td>
<td align="left" rowspan="1" colspan="1">Ochnaceae</td>
<td align="left" rowspan="1" colspan="1">1.00</td>
<td align="left" rowspan="1" colspan="1">4.74</td>
<td align="left" rowspan="1" colspan="1">4.74</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">19</td>
<td align="left" rowspan="1" colspan="1">Asterales</td>
<td align="left" rowspan="1" colspan="1">clade 5</td>
<td align="left" rowspan="1" colspan="1">1.00</td>
<td align="left" rowspan="1" colspan="1">4.69</td>
<td align="left" rowspan="1" colspan="1">4.69</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">20</td>
<td align="left" rowspan="1" colspan="1">Gentianales</td>
<td align="left" rowspan="1" colspan="1">Gentianales</td>
<td align="left" rowspan="1" colspan="1">1.00</td>
<td align="left" rowspan="1" colspan="1">4.66</td>
<td align="left" rowspan="1" colspan="1">4.66</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">21</td>
<td align="left" rowspan="1" colspan="1">Lamiales</td>
<td align="left" rowspan="1" colspan="1">Lamiales</td>
<td align="left" rowspan="1" colspan="1">1.00</td>
<td align="left" rowspan="1" colspan="1">4.44</td>
<td align="left" rowspan="1" colspan="1">4.44</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">22</td>
<td align="left" rowspan="1" colspan="1">Malpighiales</td>
<td align="left" rowspan="1" colspan="1">Manihot + Hevea</td>
<td align="left" rowspan="1" colspan="1">1.00</td>
<td align="left" rowspan="1" colspan="1">4.34</td>
<td align="left" rowspan="1" colspan="1">4.34</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">23</td>
<td align="left" rowspan="1" colspan="1">Malpighiales</td>
<td align="left" rowspan="1" colspan="1">clade 6</td>
<td align="left" rowspan="1" colspan="1">0.96</td>
<td align="left" rowspan="1" colspan="1">4.42</td>
<td align="left" rowspan="1" colspan="1">4.24</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">24</td>
<td align="left" rowspan="1" colspan="1">Oxalidales</td>
<td align="left" rowspan="1" colspan="1">Elaeocarpaceae</td>
<td align="left" rowspan="1" colspan="1">0.97</td>
<td align="left" rowspan="1" colspan="1">4.20</td>
<td align="left" rowspan="1" colspan="1">4.08</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">25</td>
<td align="left" rowspan="1" colspan="1">Apiales</td>
<td align="left" rowspan="1" colspan="1">Apiales</td>
<td align="left" rowspan="1" colspan="1">1.00</td>
<td align="left" rowspan="1" colspan="1">4.03</td>
<td align="left" rowspan="1" colspan="1">4.03</td>
</tr>
</tbody>
</table>
</alternatives><table-wrap-foot><fn id="nt101"><label/><p>Top twenty-five nodes with the highest <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e137" xlink:type="simple"/></inline-formula> scores, representing destabilizing clades. These clades are relatively well-supported but their placement in the tree is uncertain. Clades that are too large for the table are listed here. Clade 1: Tetrorchidium + Omphalea + Endospermum. Clade 2: Ericaceae + Clethraceae+ Cyrillaceae + Sarraceniaceae + Actinidiaceae. Clade 3: Rhizophoraceae + Erythroxylaceae + Ctenolophonaceae. Clade 4: Chrysobalanaceae + Euphroniaceae + Dichapetalaceae + Trigoniaceae + Balanopaceae. Clade 5:Asteraceae + Calyceraceae + Goodeniaceae + Menyanthaceae + Stylidaceae + Alseuosmiaceae + Argophyllaceae + Phellinaceae + Campanulaceae + Rousseaceae. Clade 6: Homalanthus + Euphorbia + Pimelodendron + Hura.</p></fn></table-wrap-foot></table-wrap>
<p>We also summarize the information regarding destabilization for descendent subgraphs. <xref ref-type="fig" rid="pcbi-1003223-g003">Figure 3</xref> presents the same information as in <xref ref-type="fig" rid="pcbi-1003223-g002">Figure 2</xref>, except that color corresponds to the average destabilization for all descendant nodes (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e138" xlink:type="simple"/></inline-formula>). <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e139" xlink:type="simple"/></inline-formula> is large (orange to pink color) when the descendant subgraph has a large amount of conflict, and small (blue) when the descendant subgraph has little conflict. This statistic is helpful for identifying when a clade originating from a particular node contains significant conflict.</p>
<p>These graph visualizations facilitate a rapid assessment of patterns of phylogenetic conflict, and can reveal details that are not as easily discerned with traditional consensus methods. Regions of the tree that are characterized by high conflict are indicated in the graph as highly reticulated subgraphs or ‘hairballs’ (<xref ref-type="fig" rid="pcbi-1003223-g002">Figures 2</xref> and <xref ref-type="fig" rid="pcbi-1003223-g003">3</xref>). The three largest of these problem areas in this dataset correspond to the clades Malpighiales, Lamiales, and Ericales. Other, smaller areas of conflict include regions in the Apiales, Asparagales, Asterales, Dipsacales, Escalloniales, Caryophyllales, Fabales, Ranunculales, Santalales, and Solanales. In <xref ref-type="fig" rid="pcbi-1003223-g002">Figure 2</xref>, these areas are characterized by the presence of bright orange to pink (high <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e140" xlink:type="simple"/></inline-formula>) nodes, whose placement is uncertain. When nodes of uncertain placement are observed in a large proportion of trees (i.e. highly supported nodes; large orange to pink nodes in <xref ref-type="fig" rid="pcbi-1003223-g004">Figure 4</xref>), the differences in their phylogenetic position cause a proliferation of relationships, leading to the reticulated regions. In typical consensus trees, these areas are indicated by the presence of polytomies and overall low support values. However, typical consensus trees display only edges occurring in some minimal proportion of input trees (e.g. 50% in majority-rule consensus trees). In such summary trees, equally-supported but conflicting edges in the source trees, as well as bipartitions slightly less frequent than the minimum threshold (e.g. node 9 from <xref ref-type="table" rid="pcbi-1003223-t001">Table 1</xref>), are never displayed.</p>
<p>To assess overall conflict within clades, we calculated <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e141" xlink:type="simple"/></inline-formula>, a measure of phylogenetic conflict within the descendant subgraph, scaled by its support, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e142" xlink:type="simple"/></inline-formula>. This differs from the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e143" xlink:type="simple"/></inline-formula> statistic in incorporating the conflict within the subgraph. High values of this statistic indicate nodes that contribute heavily to the overall level of conflict within their parent clade. This statistic is useful for identifying putative clades with the highest overall levels of conflict in the tree. <xref ref-type="table" rid="pcbi-1003223-t002">Table 2</xref> identifies the 25 nodes with the highest values for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e144" xlink:type="simple"/></inline-formula>. <xref ref-type="fig" rid="pcbi-1003223-g004">Figure 4</xref> identifies the precise location of these nodes within the graph.</p>
<table-wrap id="pcbi-1003223-t002" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003223.t002</object-id><label>Table 2</label><caption>
<title>Twenty-five plant clades with low resolution.</title>
</caption><alternatives><graphic id="pcbi-1003223-t002-2" position="float" mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003223.t002" xlink:type="simple"/>
<table><colgroup span="1"><col align="left" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/></colgroup>
<thead>
<tr>
<td align="left" rowspan="1" colspan="1">rank</td>
<td align="left" rowspan="1" colspan="1">order</td>
<td align="left" rowspan="1" colspan="1">taxon</td>
<td align="left" rowspan="1" colspan="1"><italic>s</italic></td>
<td align="left" rowspan="1" colspan="1"><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e145" xlink:type="simple"/></inline-formula></td>
<td align="left" rowspan="1" colspan="1"><italic>z</italic></td>
<td align="left" rowspan="1" colspan="1"><italic>c</italic></td>
</tr>
</thead>
<tbody>
<tr>
<td align="left" rowspan="1" colspan="1">1</td>
<td align="left" rowspan="1" colspan="1">Ericales</td>
<td align="left" rowspan="1" colspan="1">Sapotaceae + Pentaphylacaceae</td>
<td align="left" rowspan="1" colspan="1">0.18</td>
<td align="left" rowspan="1" colspan="1">8.53</td>
<td align="left" rowspan="1" colspan="1">10.19</td>
<td align="left" rowspan="1" colspan="1">1.32</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">2</td>
<td align="left" rowspan="1" colspan="1">Asterales</td>
<td align="left" rowspan="1" colspan="1">Calyceraceae</td>
<td align="left" rowspan="1" colspan="1">1.00</td>
<td align="left" rowspan="1" colspan="1">1.13</td>
<td align="left" rowspan="1" colspan="1">2.08</td>
<td align="left" rowspan="1" colspan="1">0.97</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">3</td>
<td align="left" rowspan="1" colspan="1">Ericales</td>
<td align="left" rowspan="1" colspan="1">Theaceae + Pentaphylacaceae</td>
<td align="left" rowspan="1" colspan="1">0.13</td>
<td align="left" rowspan="1" colspan="1">3.45</td>
<td align="left" rowspan="1" colspan="1">9.59</td>
<td align="left" rowspan="1" colspan="1">0.92</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">4</td>
<td align="left" rowspan="1" colspan="1">Malpighiales</td>
<td align="left" rowspan="1" colspan="1">Suregada + Moultonianthus</td>
<td align="left" rowspan="1" colspan="1">0.18</td>
<td align="left" rowspan="1" colspan="1">4.91</td>
<td align="left" rowspan="1" colspan="1">7.13</td>
<td align="left" rowspan="1" colspan="1">0.90</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">5</td>
<td align="left" rowspan="1" colspan="1">Ericales</td>
<td align="left" rowspan="1" colspan="1">Theaceae + Ebenaceae</td>
<td align="left" rowspan="1" colspan="1">0.27</td>
<td align="left" rowspan="1" colspan="1">6.45</td>
<td align="left" rowspan="1" colspan="1">5.76</td>
<td align="left" rowspan="1" colspan="1">0.86</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">6</td>
<td align="left" rowspan="1" colspan="1">Escalloniales</td>
<td align="left" rowspan="1" colspan="1">Polyosma + Tribeles</td>
<td align="left" rowspan="1" colspan="1">0.35</td>
<td align="left" rowspan="1" colspan="1">1.00</td>
<td align="left" rowspan="1" colspan="1">3.51</td>
<td align="left" rowspan="1" colspan="1">0.82</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">7</td>
<td align="left" rowspan="1" colspan="1">Malpighiales</td>
<td align="left" rowspan="1" colspan="1">Caryocar + Octhocosmus</td>
<td align="left" rowspan="1" colspan="1">0.16</td>
<td align="left" rowspan="1" colspan="1">8.53</td>
<td align="left" rowspan="1" colspan="1">6.84</td>
<td align="left" rowspan="1" colspan="1">0.78</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">8</td>
<td align="left" rowspan="1" colspan="1">Caryophyllales</td>
<td align="left" rowspan="1" colspan="1">Phytolaccaceae + Sarcobataceae</td>
<td align="left" rowspan="1" colspan="1">0.36</td>
<td align="left" rowspan="1" colspan="1">1.48</td>
<td align="left" rowspan="1" colspan="1">3.74</td>
<td align="left" rowspan="1" colspan="1">0.74</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">9</td>
<td align="left" rowspan="1" colspan="1">Asparagales</td>
<td align="left" rowspan="1" colspan="1">Asparagus + Beaucarnea</td>
<td align="left" rowspan="1" colspan="1">0.50</td>
<td align="left" rowspan="1" colspan="1">2.13</td>
<td align="left" rowspan="1" colspan="1">3.11</td>
<td align="left" rowspan="1" colspan="1">0.69</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">10</td>
<td align="left" rowspan="1" colspan="1">Lamiales</td>
<td align="left" rowspan="1" colspan="1">Martynia + Sesamum</td>
<td align="left" rowspan="1" colspan="1">0.61</td>
<td align="left" rowspan="1" colspan="1">8.40</td>
<td align="left" rowspan="1" colspan="1">2.58</td>
<td align="left" rowspan="1" colspan="1">0.68</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">11</td>
<td align="left" rowspan="1" colspan="1">Ericales</td>
<td align="left" rowspan="1" colspan="1">Diapensiaceae + Styracaceae</td>
<td align="left" rowspan="1" colspan="1">0.41</td>
<td align="left" rowspan="1" colspan="1">3.68</td>
<td align="left" rowspan="1" colspan="1">3.93</td>
<td align="left" rowspan="1" colspan="1">0.65</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">12</td>
<td align="left" rowspan="1" colspan="1">Lamiales</td>
<td align="left" rowspan="1" colspan="1">clade 1</td>
<td align="left" rowspan="1" colspan="1">0.28</td>
<td align="left" rowspan="1" colspan="1">1.24</td>
<td align="left" rowspan="1" colspan="1">3.00</td>
<td align="left" rowspan="1" colspan="1">0.62</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">13</td>
<td align="left" rowspan="1" colspan="1">Ericales</td>
<td align="left" rowspan="1" colspan="1">clade 2</td>
<td align="left" rowspan="1" colspan="1">1.00</td>
<td align="left" rowspan="1" colspan="1">1.11</td>
<td align="left" rowspan="1" colspan="1">1.23</td>
<td align="left" rowspan="1" colspan="1">0.62</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">14</td>
<td align="left" rowspan="1" colspan="1">Lamiales</td>
<td align="left" rowspan="1" colspan="1">Scrophulariaceae + Stilbaceae</td>
<td align="left" rowspan="1" colspan="1">0.19</td>
<td align="left" rowspan="1" colspan="1">1.36</td>
<td align="left" rowspan="1" colspan="1">4.26</td>
<td align="left" rowspan="1" colspan="1">0.62</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">15</td>
<td align="left" rowspan="1" colspan="1">Fagales</td>
<td align="left" rowspan="1" colspan="1">Juglandaceae + Myricaceae</td>
<td align="left" rowspan="1" colspan="1">0.58</td>
<td align="left" rowspan="1" colspan="1">1.07</td>
<td align="left" rowspan="1" colspan="1">2.04</td>
<td align="left" rowspan="1" colspan="1">0.59</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">16</td>
<td align="left" rowspan="1" colspan="1">Oxlidales</td>
<td align="left" rowspan="1" colspan="1">Brunelliaceae + Cephalotaceae</td>
<td align="left" rowspan="1" colspan="1">0.44</td>
<td align="left" rowspan="1" colspan="1">2.35</td>
<td align="left" rowspan="1" colspan="1">3.05</td>
<td align="left" rowspan="1" colspan="1">0.57</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">17</td>
<td align="left" rowspan="1" colspan="1">Malpighiales</td>
<td align="left" rowspan="1" colspan="1">Caryocaraceae + Putranjivaceae</td>
<td align="left" rowspan="1" colspan="1">0.16</td>
<td align="left" rowspan="1" colspan="1">9.14</td>
<td align="left" rowspan="1" colspan="1">5.14</td>
<td align="left" rowspan="1" colspan="1">0.55</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">18</td>
<td align="left" rowspan="1" colspan="1">(asterids)</td>
<td align="left" rowspan="1" colspan="1">Garryales + Icacinaceae</td>
<td align="left" rowspan="1" colspan="1">0.69</td>
<td align="left" rowspan="1" colspan="1">1.66</td>
<td align="left" rowspan="1" colspan="1">1.46</td>
<td align="left" rowspan="1" colspan="1">0.53</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">19</td>
<td align="left" rowspan="1" colspan="1">Brassicales</td>
<td align="left" rowspan="1" colspan="1">Caricaceae + Tropaeolaceae</td>
<td align="left" rowspan="1" colspan="1">0.42</td>
<td align="left" rowspan="1" colspan="1">1.00</td>
<td align="left" rowspan="1" colspan="1">2.40</td>
<td align="left" rowspan="1" colspan="1">0.53</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">20</td>
<td align="left" rowspan="1" colspan="1">Dipsacales</td>
<td align="left" rowspan="1" colspan="1">Dipsacus + Pterocephalodes</td>
<td align="left" rowspan="1" colspan="1">0.54</td>
<td align="left" rowspan="1" colspan="1">1.00</td>
<td align="left" rowspan="1" colspan="1">2.26</td>
<td align="left" rowspan="1" colspan="1">0.52</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">21</td>
<td align="left" rowspan="1" colspan="1">Santalales</td>
<td align="left" rowspan="1" colspan="1">Santalaceae + Opiliaceae</td>
<td align="left" rowspan="1" colspan="1">0.28</td>
<td align="left" rowspan="1" colspan="1">1.00</td>
<td align="left" rowspan="1" colspan="1">3.42</td>
<td align="left" rowspan="1" colspan="1">0.52</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">22</td>
<td align="left" rowspan="1" colspan="1">Malpighiales</td>
<td align="left" rowspan="1" colspan="1">Irvingiaceae + Ixonanthaceae</td>
<td align="left" rowspan="1" colspan="1">0.38</td>
<td align="left" rowspan="1" colspan="1">1.69</td>
<td align="left" rowspan="1" colspan="1">2.51</td>
<td align="left" rowspan="1" colspan="1">0.51</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">23</td>
<td align="left" rowspan="1" colspan="1">Aquifoliales</td>
<td align="left" rowspan="1" colspan="1">Cardiopteridaceae</td>
<td align="left" rowspan="1" colspan="1">0.97</td>
<td align="left" rowspan="1" colspan="1">1.00</td>
<td align="left" rowspan="1" colspan="1">1.54</td>
<td align="left" rowspan="1" colspan="1">0.50</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">24</td>
<td align="left" rowspan="1" colspan="1">Ericales</td>
<td align="left" rowspan="1" colspan="1">Sarraceniaceae + Actinidiaceae</td>
<td align="left" rowspan="1" colspan="1">0.73</td>
<td align="left" rowspan="1" colspan="1">1.00</td>
<td align="left" rowspan="1" colspan="1">1.68</td>
<td align="left" rowspan="1" colspan="1">0.49</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">25</td>
<td align="left" rowspan="1" colspan="1">Malpighiales</td>
<td align="left" rowspan="1" colspan="1">Acalypha + Spathiostemon</td>
<td align="left" rowspan="1" colspan="1">0.54</td>
<td align="left" rowspan="1" colspan="1">1.50</td>
<td align="left" rowspan="1" colspan="1">2.63</td>
<td align="left" rowspan="1" colspan="1">0.47</td>
</tr>
</tbody>
</table>
</alternatives><table-wrap-foot><fn id="nt102"><label/><p>Top twenty-five nodes with the highest <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e146" xlink:type="simple"/></inline-formula> scores, indicating clades with relatively low phylogenetic resolution compared to surrounding parts of the tree. Clades that are too large for the table are listed here. Clade 1: Plantaginaceae + Scrophulariaceae + Stilbaceae. Clade 2: Tetrameristaceae + Balsaminaceae + Marcgraviaceae.</p></fn></table-wrap-foot></table-wrap>
<p>Specific patterns within areas of conflict differ among major clades. In Malpighiales, for instance, the relatively low frequency of nodes in <xref ref-type="table" rid="pcbi-1003223-t002">Table 2</xref> compared to <xref ref-type="table" rid="pcbi-1003223-t001">Table 1</xref>, as well as the high proportion of blue nodes in this clade in <xref ref-type="fig" rid="pcbi-1003223-g005">Figure 5</xref>, indicates that despite the relatively high level of conflict regarding the placement of several Malpighialean nodes (<xref ref-type="table" rid="pcbi-1003223-t001">Table 1</xref>), relationships within this clade are better known than those in other areas of the tree. Only a few large, pink nodes in Malpighiales in <xref ref-type="fig" rid="pcbi-1003223-g002">Figure 2</xref> appear to be driving the conflict within the clade as a whole. This contrasts with the patterns in Lamiales and Ericales, where little agreement exists among source trees regarding the placement of most nodes, as indicated by the high proportion of orange to pink nodes in <xref ref-type="fig" rid="pcbi-1003223-g003">Figure 3</xref>. Many of these nodes have support values of less than 0.5 (<xref ref-type="table" rid="pcbi-1003223-t002">Table 2</xref>), indicating that they will never appear in majority-rule consensus trees. Indeed, overall support values throughout these clades are low, suggesting little to no clear phylogenetic signal within these groups. Numerous other areas with relatively high levels of phylogenetic conflict can be identified with the TAG (<xref ref-type="table" rid="pcbi-1003223-t002">Table 2</xref>; smaller reticulated subgraphs with orange to pink nodes in <xref ref-type="fig" rid="pcbi-1003223-g003">Figure 3</xref>) and represent uncertain regions of the dataset and that may benefit from additional sampling.</p>
<fig id="pcbi-1003223-g005" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003223.g005</object-id><label>Figure 5</label><caption>
<title>Avian tree alignment graph.</title>
<p>A graph showing the relationship of birds using input source trees from Jetz et al. <xref ref-type="bibr" rid="pcbi.1003223-Jetz1">[19]</xref>. Each edge color is a different source tree with the red being taxonomy. The names at the internal nodes are scaled by the number of edges and refer to those in the taxonomy from the original reference.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003223.g005" position="float" xlink:type="simple"/></fig>
<p>TAGs provide a means for analysis and visualization of uncertainty and alignment of trees. As demonstrated, in addition to edge-based indices of support (analogous to consensus tree bipartition support), TAG-specific metrics (e.g. <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e147" xlink:type="simple"/></inline-formula>) can more extensively quantify phylogenetic conflict. The information presented in <xref ref-type="fig" rid="pcbi-1003223-g002">Figures 2</xref> and <xref ref-type="fig" rid="pcbi-1003223-g003">3</xref>, and <xref ref-type="table" rid="pcbi-1003223-t001">Tables 1</xref> and <xref ref-type="table" rid="pcbi-1003223-t002">2</xref> reveals a detailed picture of the patterns of conflict within the seed plant phylogeny. The high proportion of large blue nodes in both <xref ref-type="fig" rid="pcbi-1003223-g002">Figures 2</xref> and <xref ref-type="fig" rid="pcbi-1003223-g003">3</xref> indicates that the major structure of the graph is well resolved, but several areas of high conflict are easily noted and can be explored in great detail (<xref ref-type="fig" rid="pcbi-1003223-g002">Figures 2</xref>–<xref ref-type="fig" rid="pcbi-1003223-g004">4</xref> and <xref ref-type="table" rid="pcbi-1003223-t001">Tables 1</xref> and <xref ref-type="table" rid="pcbi-1003223-t002">2</xref>). The clades identified in <xref ref-type="table" rid="pcbi-1003223-t002">Table 2</xref> based on the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003223.e148" xlink:type="simple"/></inline-formula> statistic represent the areas of angiosperm phylogeny in which we are least confident, and as such are those regions with the highest potential for improvement. Their identification should inform future sampling efforts to target these groups.</p>
<p>The information summarized by the statistics calculated on the TAG is challenging to obtain with traditional consensus methods but is easily browsed and queried within a TAG. Although, the results from the TAG analyses agree with the interpretation of these data in Soltis et al. <xref ref-type="bibr" rid="pcbi.1003223-Soltis1">[23]</xref>, the TAG and the graph-based statistics allow for a more flexible, detailed, and targeted exploration of these patterns. The use of TAGs provides a complementary approach to traditional consensus methods, facilitating the analysis and visualization of this information in powerful and detailed new ways. In particular, as demonstrated, measures such as destabilization and other subgraph summaries can assist in identifying nodes that need more attention or data collected. Although not explored here, researchers could load tree sets from different analyses, and even partially overlapping taxon sets, to explore the same statistics and perform similar analyses.</p>
</sec><sec id="s4c">
<title>Synthesizing the avian TAG</title>
<p>The methods discussed here are not only useful for examining uncertainty in datasets with fully overlapping taxon sets, but also can be used for exploring trees with partially overlapping taxon sets. In particular, the graph procedures described perform well on datasets with very hierarchical strucuture. One of the most ambitious manual tree grafting exercises performed to date involved the recent complete phylogeny of birds <xref ref-type="bibr" rid="pcbi.1003223-Jetz1">[19]</xref>. Combining a set of partially-overlapping clade-specific trees with a comprehensive taxonomy, Jetz et al. <xref ref-type="bibr" rid="pcbi.1003223-Jetz1">[19]</xref> were able to construct a phylogeny of all extant bird species, despite many taxa lacking genetic data. This type of analysis can be very useful when conducting evolutionary analyses at large taxonomic scales, as sampling in molecular phylogenies is often incomplete. The type of grafting used by Jetz et al. <xref ref-type="bibr" rid="pcbi.1003223-Jetz1">[19]</xref> not only allows for the inclusion of taxa not sampled in molecular phylogenies, but also takes advantage of the phylogenies constructed at deeper phylogenetic levels to join phylogenies constructed at shallower levels. One challenge of manual tree grafting exercises is the process of updating based on new or different source trees as well as repeatability of the synthesis of the generated trees. Another challenge is, when there is conflict, communicating the specific algorithmic decisions for repeatability or updating with new data <xref ref-type="bibr" rid="pcbi.1003223-Beaulieu1">[24]</xref>. The Jetz et al. <xref ref-type="bibr" rid="pcbi.1003223-Jetz1">[19]</xref> dataset serves to demonstrate the strength of the methods presented here in automating the alignment and synthesis of trees with different taxonomic levels, and with different levels of completeness.</p>
<p>To construct the TAG we first used the taxonomy defined by the original publication that consists of species names and their placement within broader clades (genera, families, orders, and higher). These species are meant to represent all known extant bird diversity. For the 6800 taxa that possess some genetic data, we constructed maximum clade credibility (MCC) trees for each of the 129 clade-specific datasets defined by Jetz et al. <xref ref-type="bibr" rid="pcbi.1003223-Jetz1">[19]</xref> (available at <ext-link ext-link-type="uri" xlink:href="http://birdtree.org/" xlink:type="simple">http://birdtree.org/</ext-link>). The entire posterior distribution, or samples thereof, could be added instead of a MCC tree; however, to allow for a simpler graph presentation in this proof-of-concept exercise, we restricted consideration to MCC trees. As in the original study, in addition to the clade-specific source trees, we also employ the backbone phylogeny based on the Hackett et al. <xref ref-type="bibr" rid="pcbi.1003223-Hackett1">[25]</xref> study. The backbone phylogeny and each of these 129 clade-specific MCC trees were added to the graph of the taxonomy (<xref ref-type="fig" rid="pcbi-1003223-g005">Figure 5</xref>). We then updated the mapping of the source trees based on the addition of potentially new least inclusive common ancestors.</p>
<p>The final TAG (<xref ref-type="fig" rid="pcbi-1003223-g005">Figure 5</xref>) represents the taxonomy, backbone tree, and all 129 clade-specific MCC trees. To demonstrate the ability to construct a grafted tree from this final TAG, we constructed a synthetic tree (<xref ref-type="fig" rid="pcbi-1003223-g006">Figure 6</xref>). In order to construct a synthetic tree on the TAG, the criteria for resolution of conflict needs to be established. The criteria used for this example favored (in order) the Hackett et al. <xref ref-type="bibr" rid="pcbi.1003223-Hackett1">[25]</xref> backbone, each of the trees based on genetic trees where available, and taxonomy. The synthetic tree (<xref ref-type="fig" rid="pcbi-1003223-g006">Figure 6</xref>) contains some taxa that are only present in the taxonomy and are represented as large polytomies. Unlike the original publication, we do not resolve these branches. This could be done but is not specifically part of the graph procedure, and so we do not conduct that additional analysis here. The alignment and synthesis analyses takes a relatively short amount of time despite the number of trees and the size of the dataset (&lt;2 minutes on a quad-core Xeon 2.67 GHz desktop). This relatively simple analysis demonstrates the ability of the methods discussed here to be applied to the problem of constructing large phylogenies based on source trees with only partially overlapping taxon sets. The automated nature of this analysis makes for easy updating with new source tree information, accommodation of uncertainty, and a regular and repeatable way to construct additional synthetic trees based on different criteria.</p>
<fig id="pcbi-1003223-g006" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003223.g006</object-id><label>Figure 6</label><caption>
<title>Synthetic avian phylogeny.</title>
<p>The synthetic tree produced from processing the graph of bird source trees and taxonomy from Jetz et al. <xref ref-type="bibr" rid="pcbi.1003223-Jetz1">[19]</xref> presented in <xref ref-type="fig" rid="pcbi-1003223-g003">Figure 3</xref>. Names at the internal nodes represent the larger taxonomic groups as recognized by the original publication. The tree is the product of each of the source trees and the taxonomy. The large blocks represent species that are unresolved but present in the taxonomy.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003223.g006" position="float" xlink:type="simple"/></fig>
<p>In addition to helping visualize and analyze conflict among sets of trees, the avian example demonstrates the utility of TAGs for automated synthesis of trees. The synthesis performed can be communicated easily, performed algorithmically, and repeated. Unlike some supertree methods, it is also easy to trace each branch that is recovered in the final synthesis to the original source tree(s) that supports it. Furthermore, in both synthesis and conflict analysis, the graph can continue to be updated with additional source trees (e.g., from additional bootstrap, Bayesian analyses, or other sources).</p>
</sec><sec id="s4d">
<title>Comparison to existing methods</title>
<p>There is a rich literature of methods and approaches for accommodating reticulation events in phylogenetics that fall under the title phylogenetic networks <xref ref-type="bibr" rid="pcbi.1003223-Huson2">[11]</xref>. A large number of these approaches are implemented in the program SplitsTrees <xref ref-type="bibr" rid="pcbi.1003223-Huson1">[4]</xref> and Dendroscope <xref ref-type="bibr" rid="pcbi.1003223-Huson3">[26]</xref>. Many of these procedures are intended to use the sequence data to infer structures other than trees. This is notably different than the methods presented above where we aim to align trees into a common structure that may require the creation of nodes that have conflict. The methods presented here also differ from those generally considered to be rooted phylogenetic networks <xref ref-type="bibr" rid="pcbi.1003223-Huson2">[11]</xref>. Those methods are intended to infer network structures instead of aligning trees into a general graph. The graph methods presented here address a different problem than existing phylogenetic network methods.</p>
<p>More recently, Berry et al. <xref ref-type="bibr" rid="pcbi.1003223-Berry1">[18]</xref> introduced a graph solution to combining trees of partially overlapping taxa at different taxonomic levels. Our approach differs in key aspects. Their MLS (MultiLevelSupertree) is restricted to returning a single supertree compatible with all source trees. It is not presently possible to ascertain the degree of topological conflict involved in the production of a MLS supertree. In addition, graphs in the MLS method exist only during runtime, and so cannot be distributed or augmented without rerunning the amalgamation steps as presented in their manuscript. MLS graphs also differ in that they contain both descendant and non-descendant (sibling) edges (the latter not represented in any of the source trees), and so are not as amenable to interpretation, querying, or visualization. Finally, unlike the MLS method, our approach retains all source tree information (e.g. branch lengths, node support), including an arbitrary number of tree annotations (e.g. genome, tree reconstruction method, etc.). We believe such metadata will feature prominently in many customized user queries of phylogenetic tree graphs.</p>
<p>The graph framework presented here provides an accurate representation of the input source trees, methods for identification of congruence and conflict among source trees, methods for synthesis of source trees, and efficient storage that can be queried and scale adequately with the ever increasing number and size of present-day phylogenetic trees. The set of algorithms described here can be used to map any set of evolutionary trees or hierarchies (source trees) into a common graph, while retaining all of the phylogenetic information present in the source trees. The methods discussed here are implemented in a graph database. By utilizing a database for the storage of this information, queries, visualizations, and synthesis using a large number of different methods can take advantage of shortened runtime and frequent updates. Importantly, each analysis does not require reanalysis of the source trees.</p>
</sec><sec id="s4e">
<title>Other applications</title>
<p>The methods presented here are agnostic to data source. The underlying model assumes only that the input trees define ancestor-descendant relationships. Neither do the source trees need be derived from the same dataset, nor do their tip sets need to extensively overlap. Terminal nodes in source trees represent lineages (e.g. species, populations, alleles, etc.). However, the terminal nodes need not be extant, nor reside at the same hierarchical level-terminal nodes from a given input tree may correspond to internal nodes in another. In the implementation we present, the set of all labels must be pre-identified, and terminal nodes from input trees with labels not in the pre-identified set are not added to the graph. This constraint, however, is not inherent in the procedures themselves. Individual applications of TAGs could vary these requirements for specific purposes. As a result, the methods presented here could potentially be applied and adopted for a wide range of applications in evolutionary biology and phylogenetics. For example, as demonstrated with the avian dataset, taxonomic hierarchies can be combined with phylogenetic datasets. Phylogenetic trees based on morphological data and/or phylogenetic trees of extinct taxa can be easily combined with phylogenies built using extant and molecular data. Other hierarchies could be incorporated into these graphs for analysis and synthesis.</p>
</sec><sec id="s4f">
<title>Conclusion</title>
<p>TAGs provide a means to examine conflict, conduct phylogenetic synthesis, develop complex queries, and allow for detailed visualization. The methods presented here can scale to millions of nodes and can be extended in several ways. However, these methods are not meant to be exhaustive. There are potentially many ways of parameterizing a graph and aligning trees into a graph. Nevertheless, by aligning sets of trees into a graph that can be queried and that retains all the source tree information, we can conduct powerful analyzes on enormous datasets.</p>
</sec></sec></body>
<back>
<ack>
<p>We would like to thank all of the people involved in the OpenTree of Life project. Many of the discussions involving the methodology were greatly improved from comments and suggestions by Mark Holder, Richard Ree, and Karen Cranston. We would also like to thank Ya Yang for comments on early versions of manuscript. Carleton Coffrin assisted in the development of the branch and bound algorithm.</p>
</ack>
<ref-list>
<title>References</title>
<ref id="pcbi.1003223-Maddison1"><label>1</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Maddison</surname><given-names>WP</given-names></name> (<year>1997</year>) <article-title>Gene Trees in Species Trees</article-title>. <source>Systematic Biology</source> <volume>46</volume>: <fpage>523</fpage>–<lpage>536</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003223-Page1"><label>2</label>
<mixed-citation publication-type="other" xlink:type="simple">Page RDM (2002) Tangled Trees: Phylogeny, Cospeciation, and Coevolution. University Of Chicago Press, 378 pp.</mixed-citation>
</ref>
<ref id="pcbi.1003223-Knowles1"><label>3</label>
<mixed-citation publication-type="other" xlink:type="simple">Knowles LL, Kubatko LS, editors (2010) Estimating Species Trees: Practical and Theoretical Aspects. Wiley-Blackwell, 232 pp.</mixed-citation>
</ref>
<ref id="pcbi.1003223-Huson1"><label>4</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Huson</surname><given-names>DH</given-names></name>, <name name-style="western"><surname>Bryant</surname><given-names>D</given-names></name> (<year>2006</year>) <article-title>Application of phylogenetic networks in evolutionary studies</article-title>. <source>Molecular Biology and Evolution</source> <volume>23</volume>: <fpage>254</fpage>–<lpage>267</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003223-BinindaEmonds1"><label>5</label>
<mixed-citation publication-type="other" xlink:type="simple">Bininda-Emonds OR, editor (2004) Phylogenetic supertrees: Combining information to reveal the Tree of Life (Computational Biology). Springer, 564 pp.</mixed-citation>
</ref>
<ref id="pcbi.1003223-Hillis1"><label>6</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Hillis</surname><given-names>DM</given-names></name>, <name name-style="western"><surname>Heath</surname><given-names>TA</given-names></name>, <name name-style="western"><surname>St John</surname><given-names>K</given-names></name> (<year>2005</year>) <article-title>Analysis and visualization of tree space</article-title>. <source>Systematic Biology</source> <volume>54</volume>: <fpage>471</fpage>–<lpage>482</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003223-Cranston1"><label>7</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Cranston</surname><given-names>KA</given-names></name>, <name name-style="western"><surname>Rannala</surname><given-names>B</given-names></name> (<year>2007</year>) <article-title>Summarizing a posterior distribution of trees using agreement subtrees</article-title>. <source>Systematic Biology</source> <volume>56</volume>: <fpage>578</fpage>–<lpage>590</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003223-Bouckaert1"><label>8</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Bouckaert</surname><given-names>RR</given-names></name> (<year>2010</year>) <article-title>DensiTree: making sense of sets of phylogenetic trees</article-title>. <source>Bioinformatics</source> <volume>26</volume>: <fpage>1372</fpage>–<lpage>1373</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003223-Scornavacca1"><label>9</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Scornavacca</surname><given-names>C</given-names></name>, <name name-style="western"><surname>Zickmann</surname><given-names>F</given-names></name>, <name name-style="western"><surname>Huson</surname><given-names>DH</given-names></name> (<year>2011</year>) <article-title>Tanglegrams for rooted phylogenetic trees and networks</article-title>. <source>Bioinformatics</source> <volume>27</volume>: <fpage>i248</fpage>–<lpage>i256</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003223-Larget1"><label>10</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Larget</surname><given-names>BR</given-names></name>, <name name-style="western"><surname>Kotha</surname><given-names>SK</given-names></name>, <name name-style="western"><surname>Dewey</surname><given-names>CN</given-names></name>, <name name-style="western"><surname>Ané</surname><given-names>C</given-names></name> (<year>2010</year>) <article-title>BUCKy: gene tree/species tree reconciliation with Bayesian concordance analysis</article-title>. <source>Bioinformatics</source> <volume>26</volume>: <fpage>2910</fpage>–<lpage>2911</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003223-Huson2"><label>11</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Huson</surname><given-names>DH</given-names></name>, <name name-style="western"><surname>Scornavacca</surname><given-names>C</given-names></name> (<year>2011</year>) <article-title>A survey of combinatorial methods for phylogenetic networks</article-title>. <source>Genome biology and evolution</source> <volume>3</volume>: <fpage>23</fpage>–<lpage>35</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003223-Sanderson1"><label>12</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Sanderson</surname><given-names>MJ</given-names></name>, <name name-style="western"><surname>Purvis</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Henze</surname><given-names>C</given-names></name> (<year>1998</year>) <article-title>Phylogenetic supertrees: Assembling the trees of life</article-title>. <source>Trends in Ecology &amp; Evolution</source> <volume>13</volume>: <fpage>105</fpage>–<lpage>109</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003223-Davis1"><label>13</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Davis</surname><given-names>KE</given-names></name>, <name name-style="western"><surname>Hill</surname><given-names>J</given-names></name> (<year>2010</year>) <article-title>The Supertree Tool Kit</article-title>. <source>BMC Research Notes</source> <volume>3</volume>: <fpage>1</fpage>–<lpage>6</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003223-BinindaEmonds2"><label>14</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Bininda-Emonds</surname><given-names>ORP</given-names></name>, <name name-style="western"><surname>Cardillo</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Jones</surname><given-names>KE</given-names></name>, <name name-style="western"><surname>MacPhee</surname><given-names>RDE</given-names></name>, <name name-style="western"><surname>Beck</surname><given-names>RMD</given-names></name>, <etal>et al</etal>. (<year>2007</year>) <article-title>The delayed rise of present-day mammals</article-title>. <source>Nature</source> <volume>446</volume>: <fpage>507</fpage>–<lpage>512</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003223-Davies1"><label>15</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Davies</surname><given-names>TJ</given-names></name>, <name name-style="western"><surname>Barraclough</surname><given-names>TG</given-names></name>, <name name-style="western"><surname>Chase</surname><given-names>MW</given-names></name>, <name name-style="western"><surname>Soltis</surname><given-names>PS</given-names></name>, <name name-style="western"><surname>Soltis</surname><given-names>DE</given-names></name>, <etal>et al</etal>. (<year>2004</year>) <article-title>Darwin's abominable mystery: Insights from a supertree of the angiosperms</article-title>. <source>Proceedings of the National Academy of Sciences of the United States of America</source> <volume>101</volume>: <fpage>1904</fpage>–<lpage>1909</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003223-Pisani1"><label>16</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Pisani</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Cotton</surname><given-names>JA</given-names></name>, <name name-style="western"><surname>McInerney</surname><given-names>JO</given-names></name> (<year>2007</year>) <article-title>Supertrees disentangle the chimerical origin of eukaryotic genomes</article-title>. <source>Molecular Biology and Evolution</source> <volume>24</volume>: <fpage>1752</fpage>–<lpage>1760</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003223-Wilkinson1"><label>17</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Wilkinson</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Pisani</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Cotton</surname><given-names>JA</given-names></name>, <name name-style="western"><surname>Corfe</surname><given-names>I</given-names></name> (<year>2005</year>) <article-title>Measuring support and finding unsupportedrelationships in supertrees</article-title>. <source>Systematic Biology</source> <volume>54</volume>: <fpage>823</fpage>–<lpage>831</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003223-Berry1"><label>18</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Berry</surname><given-names>V</given-names></name>, <name name-style="western"><surname>Bininda-Emonds</surname><given-names>ORP</given-names></name>, <name name-style="western"><surname>Semple</surname><given-names>C</given-names></name> (<year>2013</year>) <article-title>Amalgamating source trees with different taxonomic levels</article-title>. <source>Systematic biology</source> <volume>62</volume>: <fpage>231</fpage>–<lpage>49</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003223-Jetz1"><label>19</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Jetz</surname><given-names>W</given-names></name>, <name name-style="western"><surname>Thomas</surname><given-names>GH</given-names></name>, <name name-style="western"><surname>Joy</surname><given-names>JB</given-names></name>, <name name-style="western"><surname>Hartmann</surname><given-names>K</given-names></name>, <name name-style="western"><surname>Mooers</surname><given-names>AO</given-names></name> (<year>2012</year>) <article-title>The global diversity of birds in space and time</article-title>. <source>Nature</source> <volume>491</volume>: <fpage>444</fpage>–<lpage>8</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003223-Berg1"><label>20</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Berg</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Lässig</surname><given-names>M</given-names></name> (<year>2004</year>) <article-title>Local graph alignment and motif search in biological networks</article-title>. <source>Proceedings of the National Academy of Sciences of the United States of America</source> <volume>101</volume>: <fpage>14689</fpage>–<lpage>14694</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003223-Memievi1"><label>21</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Memišević</surname><given-names>V</given-names></name>, <name name-style="western"><surname>Pržulj</surname><given-names>N</given-names></name> (<year>2012</year>) <article-title>C-GRAAL: Common-neighbors-based global GRAph ALignment of biological networks</article-title>. <source>Integrative biology quantitative biosciences from nano to macro</source> <volume>4</volume>: <fpage>10</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003223-Lytynoja1"><label>22</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Löytynoja</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Vilella</surname><given-names>AJ</given-names></name>, <name name-style="western"><surname>Goldman</surname><given-names>N</given-names></name> (<year>2012</year>) <article-title>Accurate extension of multiple sequence alignments using a phylogeny-aware graph algorithm</article-title>. <source>Bioinformatics</source> <fpage>1</fpage>–<lpage>8</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003223-Soltis1"><label>23</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Soltis</surname><given-names>DE</given-names></name>, <name name-style="western"><surname>Smith</surname><given-names>SA</given-names></name>, <name name-style="western"><surname>Cellinese</surname><given-names>N</given-names></name>, <name name-style="western"><surname>Wurdack</surname><given-names>KJ</given-names></name>, <name name-style="western"><surname>Tank</surname><given-names>DC</given-names></name>, <etal>et al</etal>. (<year>2011</year>) <article-title>Angiosperm phylogeny: 17 genes, 640 taxa</article-title>. <source>American Journal of Botany</source> <volume>98</volume>: <fpage>704</fpage>–<lpage>730</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003223-Beaulieu1"><label>24</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Beaulieu</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Ree</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Cavender-Bares</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Weiblen</surname><given-names>G</given-names></name>, <name name-style="western"><surname>Donoghue</surname><given-names>M</given-names></name> (<year>2012</year>) <article-title>Synthesizing phylogenetic knowledge for ecological research</article-title>. <source>Ecology</source> <volume>93</volume>: <fpage>S4</fpage>–<lpage>S13</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003223-Hackett1"><label>25</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Hackett</surname><given-names>SJ</given-names></name>, <name name-style="western"><surname>Kimball</surname><given-names>RT</given-names></name>, <name name-style="western"><surname>Reddy</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Bowie</surname><given-names>RCK</given-names></name>, <name name-style="western"><surname>Braun</surname><given-names>EL</given-names></name>, <etal>et al</etal>. (<year>2008</year>) <article-title>A phylogenomic study of birds reveals their evolutionary history</article-title>. <source>Science</source> <volume>320</volume>: <fpage>1763</fpage>–<lpage>1768</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003223-Huson3"><label>26</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Huson</surname><given-names>DH</given-names></name>, <name name-style="western"><surname>Scornavacca</surname><given-names>C</given-names></name> (<year>2012</year>) <article-title>Dendroscope 3: An interactive tool for rooted phylogenetic trees and networks</article-title>. <source>Systematic Biology</source> <volume>61</volume>: <fpage>1061</fpage>–<lpage>7</lpage>.</mixed-citation>
</ref>
</ref-list></back>
</article>