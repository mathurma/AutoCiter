<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="1.1d3" xml:lang="en">
<front>
<journal-meta>
<journal-id journal-id-type="nlm-ta">PLoS Comput Biol</journal-id>
<journal-id journal-id-type="publisher-id">plos</journal-id>
<journal-id journal-id-type="pmc">ploscomp</journal-id>
<journal-title-group>
<journal-title>PLOS Computational Biology</journal-title>
</journal-title-group>
<issn pub-type="ppub">1553-734X</issn>
<issn pub-type="epub">1553-7358</issn>
<publisher>
<publisher-name>Public Library of Science</publisher-name>
<publisher-loc>San Francisco, CA USA</publisher-loc>
</publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="publisher-id">PCOMPBIOL-D-18-00992</article-id>
<article-id pub-id-type="doi">10.1371/journal.pcbi.1006299</article-id>
<article-categories>
<subj-group subj-group-type="heading">
<subject>Research Article</subject>
</subj-group>
<subj-group subj-group-type="Discipline-v3"><subject>Physical sciences</subject><subj-group><subject>Mathematics</subject><subj-group><subject>Probability theory</subject><subj-group><subject>Random variables</subject><subj-group><subject>Covariance</subject></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Neuroscience</subject><subj-group><subject>Brain mapping</subject><subj-group><subject>Functional magnetic resonance imaging</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Medicine and health sciences</subject><subj-group><subject>Diagnostic medicine</subject><subj-group><subject>Diagnostic radiology</subject><subj-group><subject>Magnetic resonance imaging</subject><subj-group><subject>Functional magnetic resonance imaging</subject></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Research and analysis methods</subject><subj-group><subject>Imaging techniques</subject><subj-group><subject>Diagnostic radiology</subject><subj-group><subject>Magnetic resonance imaging</subject><subj-group><subject>Functional magnetic resonance imaging</subject></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Medicine and health sciences</subject><subj-group><subject>Radiology and imaging</subject><subj-group><subject>Diagnostic radiology</subject><subj-group><subject>Magnetic resonance imaging</subject><subj-group><subject>Functional magnetic resonance imaging</subject></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Research and analysis methods</subject><subj-group><subject>Imaging techniques</subject><subj-group><subject>Neuroimaging</subject><subj-group><subject>Functional magnetic resonance imaging</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Neuroscience</subject><subj-group><subject>Neuroimaging</subject><subj-group><subject>Functional magnetic resonance imaging</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Research and analysis methods</subject><subj-group><subject>Mathematical and statistical techniques</subject><subj-group><subject>Mathematical models</subject></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Research and analysis methods</subject><subj-group><subject>Simulation and modeling</subject></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Engineering and technology</subject><subj-group><subject>Signal processing</subject><subj-group><subject>Signal to noise ratio</subject></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Engineering and technology</subject><subj-group><subject>Signal processing</subject><subj-group><subject>White noise</subject></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Neuroscience</subject><subj-group><subject>Brain mapping</subject><subj-group><subject>Functional magnetic resonance imaging</subject><subj-group><subject>Resting state functional magnetic resonance imaging</subject></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Medicine and health sciences</subject><subj-group><subject>Diagnostic medicine</subject><subj-group><subject>Diagnostic radiology</subject><subj-group><subject>Magnetic resonance imaging</subject><subj-group><subject>Functional magnetic resonance imaging</subject><subj-group><subject>Resting state functional magnetic resonance imaging</subject></subj-group></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Research and analysis methods</subject><subj-group><subject>Imaging techniques</subject><subj-group><subject>Diagnostic radiology</subject><subj-group><subject>Magnetic resonance imaging</subject><subj-group><subject>Functional magnetic resonance imaging</subject><subj-group><subject>Resting state functional magnetic resonance imaging</subject></subj-group></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Medicine and health sciences</subject><subj-group><subject>Radiology and imaging</subject><subj-group><subject>Diagnostic radiology</subject><subj-group><subject>Magnetic resonance imaging</subject><subj-group><subject>Functional magnetic resonance imaging</subject><subj-group><subject>Resting state functional magnetic resonance imaging</subject></subj-group></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Research and analysis methods</subject><subj-group><subject>Imaging techniques</subject><subj-group><subject>Neuroimaging</subject><subj-group><subject>Functional magnetic resonance imaging</subject><subj-group><subject>Resting state functional magnetic resonance imaging</subject></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Neuroscience</subject><subj-group><subject>Neuroimaging</subject><subj-group><subject>Functional magnetic resonance imaging</subject><subj-group><subject>Resting state functional magnetic resonance imaging</subject></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Neuroscience</subject><subj-group><subject>Cognitive science</subject><subj-group><subject>Cognitive psychology</subject><subj-group><subject>Learning</subject></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Psychology</subject><subj-group><subject>Cognitive psychology</subject><subj-group><subject>Learning</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Social sciences</subject><subj-group><subject>Psychology</subject><subj-group><subject>Cognitive psychology</subject><subj-group><subject>Learning</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Neuroscience</subject><subj-group><subject>Learning and memory</subject><subj-group><subject>Learning</subject></subj-group></subj-group></subj-group></subj-group></article-categories>
<title-group>
<article-title>Representational structure or task structure? Bias in neural representational similarity analysis and a Bayesian method for reducing bias</article-title>
<alt-title alt-title-type="running-head">Bayesian representational similarity analysis</alt-title>
</title-group>
<contrib-group>
<contrib contrib-type="author" corresp="yes" xlink:type="simple">
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0003-0768-7215</contrib-id>
<name name-style="western">
<surname>Cai</surname> <given-names>Ming Bo</given-names></name>
<role content-type="http://credit.casrai.org/">Conceptualization</role>
<role content-type="http://credit.casrai.org/">Data curation</role>
<role content-type="http://credit.casrai.org/">Formal analysis</role>
<role content-type="http://credit.casrai.org/">Methodology</role>
<role content-type="http://credit.casrai.org/">Software</role>
<role content-type="http://credit.casrai.org/">Validation</role>
<role content-type="http://credit.casrai.org/">Visualization</role>
<role content-type="http://credit.casrai.org/">Writing – original draft</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff001"><sup>1</sup></xref>
<xref ref-type="corresp" rid="cor001">*</xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-0150-8776</contrib-id>
<name name-style="western">
<surname>Schuck</surname> <given-names>Nicolas W.</given-names></name>
<role content-type="http://credit.casrai.org/">Data curation</role>
<role content-type="http://credit.casrai.org/">Visualization</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff002"><sup>2</sup></xref>
<xref ref-type="aff" rid="aff003"><sup>3</sup></xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<name name-style="western">
<surname>Pillow</surname> <given-names>Jonathan W.</given-names></name>
<role content-type="http://credit.casrai.org/">Methodology</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff001"><sup>1</sup></xref>
<xref ref-type="aff" rid="aff004"><sup>4</sup></xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-0259-8371</contrib-id>
<name name-style="western">
<surname>Niv</surname> <given-names>Yael</given-names></name>
<role content-type="http://credit.casrai.org/">Funding acquisition</role>
<role content-type="http://credit.casrai.org/">Methodology</role>
<role content-type="http://credit.casrai.org/">Supervision</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff001"><sup>1</sup></xref>
<xref ref-type="aff" rid="aff004"><sup>4</sup></xref>
</contrib>
</contrib-group>
<aff id="aff001">
<label>1</label>
<addr-line>Princeton Neuroscience Institute, Princeton University, Princeton, New Jersey, United States of America</addr-line>
</aff>
<aff id="aff002">
<label>2</label>
<addr-line>Max Planck Research Group Neurocode, Max Planck Institute for Human Development, Berlin, Germany</addr-line>
</aff>
<aff id="aff003">
<label>3</label>
<addr-line>Max Planck UCL Centre for Computational Psychiatry and Ageing Research, Berlin, Germany</addr-line>
</aff>
<aff id="aff004">
<label>4</label>
<addr-line>Department of Psychology, Princeton University, Princeton, New Jersey, United States of America</addr-line>
</aff>
<contrib-group>
<contrib contrib-type="editor" xlink:type="simple">
<name name-style="western">
<surname>Jbabdi</surname> <given-names>Saad</given-names></name>
<role>Editor</role>
<xref ref-type="aff" rid="edit1"/>
</contrib>
</contrib-group>
<aff id="edit1">
<addr-line>Oxford University, UNITED KINGDOM</addr-line>
</aff>
<author-notes>
<fn fn-type="conflict" id="coi001">
<p>The authors have declared that no competing interests exist.</p>
</fn>
<corresp id="cor001">* E-mail: <email xlink:type="simple">mcai@princeton.edu</email></corresp>
</author-notes>
<pub-date pub-type="collection">
<month>5</month>
<year>2019</year>
</pub-date>
<pub-date pub-type="epub">
<day>24</day>
<month>5</month>
<year>2019</year>
</pub-date>
<volume>15</volume>
<issue>5</issue>
<elocation-id>e1006299</elocation-id>
<history>
<date date-type="received">
<day>11</day>
<month>6</month>
<year>2018</year>
</date>
<date date-type="accepted">
<day>6</day>
<month>4</month>
<year>2019</year>
</date>
</history>
<permissions>
<copyright-year>2019</copyright-year>
<copyright-holder>Cai et al</copyright-holder>
<license xlink:href="http://creativecommons.org/licenses/by/4.0/" xlink:type="simple">
<license-p>This is an open access article distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/" xlink:type="simple">Creative Commons Attribution License</ext-link>, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p>
</license>
</permissions>
<self-uri content-type="pdf" xlink:href="info:doi/10.1371/journal.pcbi.1006299"/>
<abstract>
<p>The activity of neural populations in the brains of humans and animals can exhibit vastly different spatial patterns when faced with different tasks or environmental stimuli. The degrees of similarity between these neural activity patterns in response to different events are used to characterize the representational structure of cognitive states in a neural population. The dominant methods of investigating this similarity structure first estimate neural activity patterns from noisy neural imaging data using linear regression, and then examine the similarity between the estimated patterns. Here, we show that this approach introduces spurious bias structure in the resulting similarity matrix, in particular when applied to fMRI data. This problem is especially severe when the signal-to-noise ratio is low and in cases where experimental conditions cannot be fully randomized in a task. We propose Bayesian Representational Similarity Analysis (BRSA), an alternative method for computing representational similarity, in which we treat the covariance structure of neural activity patterns as a hyper-parameter in a generative model of the neural data. By marginalizing over the unknown activity patterns, we can directly estimate this covariance structure from imaging data. This method offers significant reductions in bias and allows estimation of neural representational similarity with previously unattained levels of precision at low signal-to-noise ratio, without losing the possibility of deriving an interpretable distance measure from the estimated similarity. The method is closely related to Pattern Component Model (PCM), but instead of modeling the estimated neural patterns as in PCM, BRSA models the imaging data directly and is suited for analyzing data in which the order of task conditions is not fully counterbalanced. The probabilistic framework allows for jointly analyzing data from a group of participants. The method can also simultaneously estimate a signal-to-noise ratio map that shows where the learned representational structure is supported more strongly. Both this map and the learned covariance matrix can be used as a structured prior for maximum <italic>a posteriori</italic> estimation of neural activity patterns, which can be further used for fMRI decoding. Our method therefore paves the way towards a more unified and principled analysis of neural representations underlying fMRI signals. We make our tool freely available in Brain Imaging Analysis Kit (BrainIAK).</p>
</abstract>
<abstract abstract-type="summary">
<title>Author summary</title>
<p>We show the severity of the bias introduced when performing representational similarity analysis (RSA) based on neural activity pattern estimated within imaging runs. Our Bayesian RSA method significantly reduces the bias and can learn a shared representational structure across multiple participants. We also demonstrate its extension as a new multi-class decoding tool.</p>
</abstract>
<funding-group>
<award-group id="award001">
<funding-source>
<institution-wrap>
<institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/100000925</institution-id>
<institution>John Templeton Foundation</institution>
</institution-wrap>
</funding-source>
<award-id>57876</award-id>
</award-group>
<award-group id="award002">
<funding-source>
<institution-wrap>
<institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/100002418</institution-id>
<institution>Intel Corporation</institution>
</institution-wrap>
</funding-source>
<award-id>1004372</award-id>
</award-group>
<award-group id="award003">
<funding-source>
<institution>McKnight Foundation</institution>
</funding-source>
<award-id>McKnight Scholar Award</award-id>
<principal-award-recipient>
<name name-style="western">
<surname>Pillow</surname> <given-names>Jonathan W.</given-names></name>
</principal-award-recipient>
</award-group>
<award-group id="award004">
<funding-source>
<institution-wrap>
<institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/100000893</institution-id>
<institution>Simons Foundation</institution>
</institution-wrap>
</funding-source>
<award-id>SCGB AWD1004351</award-id>
<principal-award-recipient>
<name name-style="western">
<surname>Pillow</surname> <given-names>Jonathan W.</given-names></name>
</principal-award-recipient>
</award-group>
<award-group id="award005">
<funding-source>
<institution-wrap>
<institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/100000083</institution-id>
<institution>Directorate for Computer and Information Science and Engineering</institution>
</institution-wrap>
</funding-source>
<award-id>IIS-1150186</award-id>
<principal-award-recipient>
<name name-style="western">
<surname>Pillow</surname> <given-names>Jonathan W.</given-names></name>
</principal-award-recipient>
</award-group>
<award-group id="award006">
<funding-source>
<institution-wrap>
<institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/100000026</institution-id>
<institution>National Institute on Drug Abuse</institution>
</institution-wrap>
</funding-source>
<award-id>1R01DA042065</award-id>
<principal-award-recipient>
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-0259-8371</contrib-id>
<name name-style="western">
<surname>Niv</surname> <given-names>Yael</given-names></name>
</principal-award-recipient>
</award-group>
<funding-statement>This work was funded by the Intel Corporation (1004372, <ext-link ext-link-type="uri" xlink:href="https://www.intel.com" xlink:type="simple">https://www.intel.com</ext-link>), the John Templeton Foundation (15541, <ext-link ext-link-type="uri" xlink:href="https://www.templeton.org/" xlink:type="simple">https://www.templeton.org/</ext-link>) and National Institute on Drug Abuse (1R01DA042065, <ext-link ext-link-type="uri" xlink:href="https://www.drugabuse.gov/" xlink:type="simple">https://www.drugabuse.gov/</ext-link>). JWP was supported by grants from the Simons Collaboration on the Global Brain (SCGB AWD1004351 and AWD543027), the NSF CAREER Award (IIS-1150186, <ext-link ext-link-type="uri" xlink:href="https://www.nsf.gov/funding/pgm_summ.jsp?pims_id=503214" xlink:type="simple">https://www.nsf.gov/funding/pgm_summ.jsp?pims_id=503214</ext-link>). NWS was supported by a Max Planck Research Group grant M.TN.A.BILD0004. The funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.</funding-statement>
</funding-group>
<counts>
<fig-count count="6"/>
<table-count count="0"/>
<page-count count="30"/>
</counts>
<custom-meta-group>
<custom-meta>
<meta-name>PLOS Publication Stage</meta-name>
<meta-value>vor-update-to-uncorrected-proof</meta-value>
</custom-meta>
<custom-meta>
<meta-name>Publication Update</meta-name>
<meta-value>2019-06-06</meta-value>
</custom-meta>
<custom-meta id="data-availability">
<meta-name>Data Availability</meta-name>
<meta-value>The original data and design matrix used to demonstrate the bias in Figure 1 are from the Schuck et al., 2016 Neuron. They are available at <ext-link ext-link-type="uri" xlink:href="http://dx.doi.org/10.6080/K0FN14CH" xlink:type="simple">http://dx.doi.org/10.6080/K0FN14CH</ext-link>. The original fMRI data used to generate Figures 3-6 are publicly available from Human Connectome Project (<ext-link ext-link-type="uri" xlink:href="https://www.humanconnectome.org/study/hcp-young-adult/document/900-subjects-data-release" xlink:type="simple">https://www.humanconnectome.org/study/hcp-young-adult/document/900-subjects-data-release</ext-link>).</meta-value>
</custom-meta>
</custom-meta-group>
</article-meta>
</front>
<body>
<sec id="sec001" sec-type="intro">
<title>Introduction</title>
<p>Functional magnetic resonance imaging (fMRI) measures the blood-oxygen-level-dependent (BOLD) signals [<xref ref-type="bibr" rid="pcbi.1006299.ref001">1</xref>], which rise to peak ∼6 seconds after neuronal activity increases in a local region [<xref ref-type="bibr" rid="pcbi.1006299.ref002">2</xref>]. Because of its non-invasiveness, full-brain coverage, and relatively favorable trade-off between spatial and temporal resolution, fMRI has been a powerful tool to study the neural correlates of cognition [<xref ref-type="bibr" rid="pcbi.1006299.ref003">3</xref>–<xref ref-type="bibr" rid="pcbi.1006299.ref005">5</xref>]. In the last decade, research has moved beyond simply localizing the brain regions selectively activated by cognitive processes and the focus has been increasingly placed on the relationship between the detailed spatial patterns of neural activity and cognitive processes [<xref ref-type="bibr" rid="pcbi.1006299.ref006">6</xref>, <xref ref-type="bibr" rid="pcbi.1006299.ref007">7</xref>].</p>
<p>An important tool for characterizing the functional architecture of the brain is representational similarity analysis (RSA) [<xref ref-type="bibr" rid="pcbi.1006299.ref008">8</xref>]. This classic method first estimates the neural activity patterns from fMRI data recorded as participants observe a set of stimuli or experience a set of task conditions, and then calculates the similarity (e.g., by Pearson correlation) between each pair of the estimated patterns. The rationale is that if two stimuli are represented with similar codes in a brain region, the spatial patterns of neural activation in that region would be similar when processing these two stimuli. When using Pearson correlation as a similarity metric, the activity profile of each voxel to all the task conditions is essentially viewed as one independent sample from a multivariate normal distribution in a space spanned by the experimental conditions, which is characterized by its covariance matrix. Recently, it has been pointed out that RSA and two other approaches for understanding neural representational structure, namely encoding model [<xref ref-type="bibr" rid="pcbi.1006299.ref009">9</xref>] and pattern component modeling (PCM) [<xref ref-type="bibr" rid="pcbi.1006299.ref010">10</xref>], are closely related through the second moment statistics (the covariance matrix) of the true (unknown) activity patterns [<xref ref-type="bibr" rid="pcbi.1006299.ref011">11</xref>].</p>
<p>After the similarity matrix between all pairs of estimated activity patterns is calculated in a region of interest (ROI), it can be compared against similarity matrices predicted by candidate computational models. Researchers can also convert the similarity matrix into a representational dissimilarity matrix (RDM, e.g., 1 − <italic>C</italic>, for similarity <italic>C</italic> based on correlation) and visualize the structure of the representational space in the ROI by projecting the dissimilarity matrix to a low dimensional space [<xref ref-type="bibr" rid="pcbi.1006299.ref008">8</xref>]. Researchers might also test whether certain experimental manipulations change the degrees of similarity between neural patterns of interest [<xref ref-type="bibr" rid="pcbi.1006299.ref012">12</xref>, <xref ref-type="bibr" rid="pcbi.1006299.ref013">13</xref>]. To list just a few applications from the field of visual neuroscience, RSA has revealed that humans and monkeys have highly similar representational structures in the inferotemporal (IT) cortex for images across various semantic categories [<xref ref-type="bibr" rid="pcbi.1006299.ref014">14</xref>]. It also revealed a continuum in the abstract representation of biological classes in human ventral object visual cortex [<xref ref-type="bibr" rid="pcbi.1006299.ref015">15</xref>] and that basic categorical structure gradually emerges through the hierarchy of visual cortex [<xref ref-type="bibr" rid="pcbi.1006299.ref016">16</xref>]. Because of the additional flexibility of exploring the structure of neural representation without building explicit computational models, RSA has also gained popularity among cognitive neuroscientists for studying more complex tasks beyond perception, such as decision making.</p>
<p>While RSA has been widely adopted in many fields of cognitive neuroscience, a few recent studies have revealed that the similarity structure estimated by standard RSA might be confounded by various factors. First, the calculated similarity between two neural patterns strongly depends on the time that elapsed between the two measured patterns: the closer the two patterns are in time, the more similar they are [<xref ref-type="bibr" rid="pcbi.1006299.ref017">17</xref>] [<xref ref-type="bibr" rid="pcbi.1006299.ref018">18</xref>]. Second, it was found that because different brain regions share some common time courses of fluctuation independent of the stimuli being presented (intrinsic fluctuations), RDMs between regions are highly similar when calculated based on patterns of the same trials of tasks but not when they are calculated based on separate trials (thus the intrinsic fluctuation are not shared across regions). This indicates that RSA can be strongly influenced by intrinsic fluctuation [<xref ref-type="bibr" rid="pcbi.1006299.ref017">17</xref>]. Lastly, Diedrichsen et al. (2011) pointed out that the noise in the estimated activity patterns can add a diagonal component to the condition-by-condition covariance matrix of the spatial patterns. This leads to over-estimation of the variance of the neural pattern and underestimation of correlation between true patterns, and this underestimation depends on signal-to-noise ratio in each ROI, making it difficult to make comparison of RDMs between regions [<xref ref-type="bibr" rid="pcbi.1006299.ref010">10</xref>].</p>
<p>Recognizing the first two issues, several groups have recently suggested modifications to RSA such as calculating similarity or distance between activity patterns estimated from separate fMRI runs [<xref ref-type="bibr" rid="pcbi.1006299.ref018">18</xref>, <xref ref-type="bibr" rid="pcbi.1006299.ref019">19</xref>], henceforth referred to as cross-run RSA, and using a Taylor expansion to approximate and regress out the dependency of pattern similarity on the interval between events [<xref ref-type="bibr" rid="pcbi.1006299.ref018">18</xref>]. For the last issue, Diedrichsen et al. (2011) proposed PCM which models the condition-by-condition covariance matrix between estimated neural patterns as the sum of a diagonal component that reflects the contribution of noise in the estimated neural patterns to the covariance matrix and components reflecting the researcher’s hypothetical representational structure in the ROI [<xref ref-type="bibr" rid="pcbi.1006299.ref010">10</xref>]. These methods improve on traditional RSA, but are not explicitly directed at the source of the bias, and therefore only offer partial solutions.</p>
<p>Indeed, the severity of confounds in traditional RSA is not yet widely recognized. RSA based on neural patterns estimated within an imaging run is still commonly performed. Furthermore, sometimes a study might need to examine the representational similarity between task conditions within an imaging run, such that cross-run RSA is not feasible. The Taylor expansion approach to model the effect of event-interval can be difficult to set up when a task condition repeats several times in an experiment. There also lacks a detailed mathematical examination of the source of the bias and how different ways of applying RSA affect the bias. Researchers sometimes hold the view that RSA of raw fMRI patterns, instead of activity patterns (<bold><italic>β</italic></bold>) estimated through a general linear model (GLM) [<xref ref-type="bibr" rid="pcbi.1006299.ref020">20</xref>], does not suffer from the confounds mentioned above. Last but not least, the contribution of noise in the estimated neural patterns to the sample covariance matrix between patterns may not be restricted to the diagonal elements, as we will demonstrate below.</p>
<p>In this paper, we first compare the result of performing traditional RSA on a task-based fMRI dataset with the results obtained when performing the same analysis on white noise, to illustrate the severe bias and spurious similarity structure that can result from performing RSA on pattern estimates within imaging runs. By applying task-specific RSA on irrelevant resting-state fMRI data, we show that spurious structure also emerges when RSA is performed on the raw fMRI pattern rather than estimated task activation patterns. We observed that the spurious structure can be far from a diagonal matrix, and masks any true similarity structure. We then provide an analytic derivation to help understand the source of the bias in traditional RSA. Previously, we have proposed a method named Bayesian RSA (BRSA), which significantly reduced this bias and allows analysis within imaging runs [<xref ref-type="bibr" rid="pcbi.1006299.ref021">21</xref>]. BRSA is related to PCM in the sense that they both treat the true and unknown activity profiles of each voxel as a sample from a multivariate normal distribution and marginalize the true activity pattern in their analysis. The critical difference is that PCM models the estimated activity patterns of each trial or task condition, in which complex spurious correlation structure could have already been introduced during the estimation, while BRSA directly models the raw imaging data. Here, we further extend BRSA to explicitly model spatial noise correlation, thereby mitigating the second issue identified by Heriksson et al. [<xref ref-type="bibr" rid="pcbi.1006299.ref017">17</xref>], namely the intrinsic fluctuation not modelled by task events in an experiment. Furthermore, inspired by the methods of hyper-alignment [<xref ref-type="bibr" rid="pcbi.1006299.ref022">22</xref>] and shared response models [<xref ref-type="bibr" rid="pcbi.1006299.ref023">23</xref>], we extend our method to learn a shared representational similarity structure across multiple participants (Group BRSA) and demonstrate improved accuracy of this approach. Since our method significantly reduces bias in the estimated similarity matrix but does not fully eliminate it at regimes of very low signal-to-noise ratio (SNR), we further provide a cross-validation approach to detecting over-fitting to the data. Finally, we show that the learned representational structure can serve as an empirical prior to constrain the posterior estimation of activity patterns, which can be used to decode the cognitive state underlying activity observed in new fMRI data.</p>
<p>The algorithm in this paper is publicly available in the Python package Brain Imaging Analysis Kit (<ext-link ext-link-type="uri" xlink:href="http://brainiak.org/" xlink:type="simple">BrainIAK</ext-link>), under the <italic>brainiak.reprsimil.brsa</italic> module. Our previous version of Bayesian RSA method [<xref ref-type="bibr" rid="pcbi.1006299.ref021">21</xref>] with newly added modeling of spatial noise correlation is in the <italic>BRSA</italic> class of the module. The new version described in this paper is implemented in the <italic>GBRSA</italic> class and can be applied to either a single participant or a group of participants.</p>
</sec>
<sec id="sec002" sec-type="results">
<title>Results</title>
<sec id="sec003">
<title>Traditional RSA translates structured noise in estimated activity patterns into spurious similarity structure</title>
<p>Traditional RSA [<xref ref-type="bibr" rid="pcbi.1006299.ref008">8</xref>] first estimates the response amplitudes (<italic>β</italic>) of each voxel in an ROI to each task condition, and then calculates the similarity between the estimated spatial response patterns of that ROI to each pair of task conditions.</p>
<p>The estimation of <italic>β</italic> is based on a GLM. We denote the fMRI time series from an experiment as <inline-formula id="pcbi.1006299.e001"><alternatives><graphic id="pcbi.1006299.e001g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e001" xlink:type="simple"/><mml:math display="inline" id="M1"><mml:mrow><mml:mi mathvariant="bold">Y</mml:mi> <mml:mo>∈</mml:mo> <mml:msup><mml:mi mathvariant="double-struck">R</mml:mi> <mml:mrow><mml:msub><mml:mi>n</mml:mi> <mml:mi>T</mml:mi></mml:msub> <mml:mo>×</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mi>V</mml:mi></mml:msub></mml:mrow></mml:msup></mml:mrow></mml:math></alternatives></inline-formula>, with <italic>n</italic><sub><italic>T</italic></sub> being the number of time points and <italic>n</italic><sub><italic>V</italic></sub> the number of voxels. The GLM assumes that
<disp-formula id="pcbi.1006299.e002"><alternatives><graphic id="pcbi.1006299.e002g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e002" xlink:type="simple"/><mml:math display="block" id="M2"><mml:mrow><mml:mi mathvariant="bold">Y</mml:mi> <mml:mo>=</mml:mo> <mml:mi mathvariant="bold">X</mml:mi> <mml:mo>·</mml:mo> <mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>+</mml:mo> <mml:mi mathvariant="bold-italic">ϵ</mml:mi> <mml:mo>.</mml:mo></mml:mrow></mml:math></alternatives> <label>(1)</label></disp-formula> <inline-formula id="pcbi.1006299.e003"><alternatives><graphic id="pcbi.1006299.e003g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e003" xlink:type="simple"/><mml:math display="inline" id="M3"><mml:mrow><mml:mi mathvariant="bold">X</mml:mi> <mml:mo>∈</mml:mo> <mml:msup><mml:mi mathvariant="double-struck">R</mml:mi> <mml:mrow><mml:msub><mml:mi>n</mml:mi> <mml:mi>T</mml:mi></mml:msub> <mml:mo>×</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mi>C</mml:mi></mml:msub></mml:mrow></mml:msup></mml:mrow></mml:math></alternatives></inline-formula> is the “design matrix,” where <italic>n</italic><sub><italic>C</italic></sub> is the number of task conditions. Each column of the design matrix is constructed by convolving a hemodynamic response function (HRF) with a time series describing the onsets and duration of all events belonging to one task condition. The regressors composing the design matrix express the hypothesized response time course elicited by each task condition. Each voxel’s response amplitudes to different task conditions can differ. The response amplitudes of one voxel to all conditions forms that voxel’s response profile. All voxels’ response profiles form a matrix of spatial activity patterns <inline-formula id="pcbi.1006299.e004"><alternatives><graphic id="pcbi.1006299.e004g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e004" xlink:type="simple"/><mml:math display="inline" id="M4"><mml:mrow><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>∈</mml:mo> <mml:msup><mml:mi mathvariant="double-struck">R</mml:mi> <mml:mrow><mml:msub><mml:mi>n</mml:mi> <mml:mi>C</mml:mi></mml:msub> <mml:mo>×</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mi>V</mml:mi></mml:msub></mml:mrow></mml:msup></mml:mrow></mml:math></alternatives></inline-formula>, with each row representing the spatial pattern of activity elicited by one task condition. The responses to all conditions are assumed to contribute linearly to the spatio-temporal fMRI signal through the temporal profile of hemodynamic response expressed in <bold>X</bold>. Thus, the measured <bold>Y</bold> is assumed to be a linear sum of <bold>X</bold> weighted by response amplitudes <bold><italic>β</italic></bold>, corrupted by zero-mean noise <bold><italic>ϵ</italic></bold>.</p>
<p>The goal of RSA is to understand the degree of similarity between each pair of spatial response patterns (i.e., between the rows of <bold><italic>β</italic></bold>). But because the true <bold><italic>β</italic></bold> is not accessible, a point estimate of <bold><italic>β</italic></bold>, derived through linear regression, is usually used as a surrogate:
<disp-formula id="pcbi.1006299.e005"><alternatives><graphic id="pcbi.1006299.e005g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e005" xlink:type="simple"/><mml:math display="block" id="M5"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mo>=</mml:mo> <mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:msup><mml:mi mathvariant="bold">X</mml:mi> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msup> <mml:mi mathvariant="bold">X</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>-</mml:mo> <mml:mn mathvariant="bold">1</mml:mn></mml:mrow></mml:msup> <mml:msup><mml:mi mathvariant="bold">X</mml:mi> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msup> <mml:mi mathvariant="bold">Y</mml:mi></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(2)</label></disp-formula>
Similarity is then calculated between rows of <inline-formula id="pcbi.1006299.e006"><alternatives><graphic id="pcbi.1006299.e006g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e006" xlink:type="simple"/><mml:math display="inline" id="M6"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula>. For instance, one measure of similarity that is frequently used is Pearson correlation. The similarity between patterns of condition <bold><italic>i</italic></bold> and <bold><italic>j</italic></bold> is assessed as
<disp-formula id="pcbi.1006299.e007"><alternatives><graphic id="pcbi.1006299.e007g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e007" xlink:type="simple"/><mml:math display="block" id="M7"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">C</mml:mi> <mml:mrow><mml:mi mathvariant="bold-italic">i</mml:mi> <mml:mi mathvariant="bold-italic">j</mml:mi></mml:mrow></mml:msub> <mml:mo>=</mml:mo> <mml:mfrac><mml:mrow><mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mi mathvariant="bold-italic">i</mml:mi></mml:msub> <mml:mo>-</mml:mo> <mml:mover><mml:msub><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mi mathvariant="bold-italic">i</mml:mi></mml:msub> <mml:mo>¯</mml:mo></mml:mover> <mml:mo>)</mml:mo></mml:mrow> <mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mi mathvariant="bold-italic">i</mml:mi></mml:msub> <mml:mo>-</mml:mo> <mml:mover><mml:msub><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mi mathvariant="bold-italic">j</mml:mi></mml:msub> <mml:mo>¯</mml:mo></mml:mover> <mml:mo>)</mml:mo></mml:mrow> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msup></mml:mrow> <mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mi mathvariant="bold-italic">V</mml:mi></mml:msub> <mml:msub><mml:mi mathvariant="bold-italic">σ</mml:mi> <mml:msub><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mi mathvariant="bold-italic">i</mml:mi></mml:msub></mml:msub> <mml:msub><mml:mi mathvariant="bold-italic">σ</mml:mi> <mml:msub><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mi mathvariant="bold-italic">j</mml:mi></mml:msub></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(3)</label></disp-formula>
where <inline-formula id="pcbi.1006299.e008"><alternatives><graphic id="pcbi.1006299.e008g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e008" xlink:type="simple"/><mml:math display="inline" id="M8"><mml:mover><mml:msub><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mi mathvariant="bold-italic">i</mml:mi></mml:msub> <mml:mo>¯</mml:mo></mml:mover></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1006299.e009"><alternatives><graphic id="pcbi.1006299.e009g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e009" xlink:type="simple"/><mml:math display="inline" id="M9"><mml:msub><mml:mi mathvariant="bold-italic">σ</mml:mi> <mml:msub><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mi mathvariant="bold-italic">i</mml:mi></mml:msub></mml:msub></mml:math></alternatives></inline-formula> are the mean and standard deviation of the estimated pattern of condition <bold><italic>i</italic></bold> across voxels.</p>
<p>To demonstrate the spurious structure that may appear in the result of traditional RSA, we first performed RSA on the fMRI data in one ROI, the orbitofrontal cortex, in a previous dataset involving a decision-making task [<xref ref-type="bibr" rid="pcbi.1006299.ref024">24</xref>]. The task included 16 different task conditions, or “states.” In each state, participants paid attention to one of two overlapping images (face or house) and made judgments about the image in the attended category. The transition between the 16 task states followed the Markov chain shown in <xref ref-type="fig" rid="pcbi.1006299.g001">Fig 1A</xref>, thus some states often preceded certain other states. The 16 states could be grouped into 3 categories according to the structure of transitions among states (the exact meaning of the states, or the 3 categories, are not important in the context of the discussion here.) We performed traditional RSA on the 16 estimated spatial response patterns corresponding to the 16 task states. To visualize the structure of the neural representation of the task states in the ROI, we used multi-dimensional scaling (MDS) [<xref ref-type="bibr" rid="pcbi.1006299.ref025">25</xref>] to project the 16-dimensional space defined by the distance (1—correlation) between states onto a 3-dimensional space (<xref ref-type="fig" rid="pcbi.1006299.g001">Fig 1B</xref>).</p>
<fig id="pcbi.1006299.g001" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1006299.g001</object-id>
<label>Fig 1</label>
<caption>
<title>Standard RSA introduces bias structure to the similarity matrix.</title>
<p>(<bold>A</bold>) A cognitive task including 16 different experimental conditions. Transitions between conditions follow a Markov process. Arrows indicate possible transitions, each with <bold><italic>p</italic></bold> = <bold>0</bold>.<bold>5</bold>. The task conditions can be grouped into 3 categories (color coded) according to their characteristic transition structure. (<bold>B</bold>) Standard RSA of activity patterns corresponding to each condition estimated from a brain region reveals a highly structured similarity matrix (left) that reflects aspects of the transition structure in the task. Converting the similarity matrix C to a distance matrix 1-C and projecting it to a low-dimensional space using MDS reveals a highly regular structure (right). Seeing such a result, one may infer that representational structure in the ROI strongly reflects the task structure. (<bold>C</bold>) However, applying RSA to regression estimates of of patterns obtained from pure white noise generates a very close similarity matrix (left), with a similar low-dimensional projection (right). This indicates that standard RSA can introduce spurious structure in the similarity matrix that does not exist in the data. (<bold>D</bold>) RSA Using Euclidean distance as a similarity metric applied to patterns estimated from the same noise (left) yields a slightly different, but still structured, similarity structure (right). (<bold>E</bold>) Calculating the correlation between raw patterns of resting state fMRI data (instead of patterns estimated by a GLM), assuming the same task structure as in (A), also generates spurious similarity structure, albeit different from those in (B-D). This structure is significantly correlated with the theoretical bias structure (details in main text). Left: average of the similarity structure based on raw patterns. Right: average of the theoretical bias similarity structure arising purely from task structure and fMRI noise autocorrelation. (<bold>F</bold>) The bias in this case comes from structured noise introduced during the GLM analysis. Assuming the true patterns <bold><italic>β</italic></bold> (red dots) of two task conditions are anti-correlated (the horizontal and vertical coordinates of each dot represent the response amplitudes of one voxel to the two task conditions), regression turns the noise <bold><italic>ϵ</italic></bold> in fMRI data into structured noise (<bold>X</bold><sup><bold><italic>T</italic></bold></sup> <bold>X</bold>)<sup>−<bold>1</bold></sup> <bold>X</bold><sup><bold><italic>T</italic></bold></sup><bold><italic>ϵ</italic></bold> (blue dots). The correlation between the noises in the estimated patterns is often non-zero (assumed to be positive correlation here) due to the correlation structure in the design matrix and the autocorrelation property of the noise. The estimated patterns <inline-formula id="pcbi.1006299.e010"><alternatives><graphic id="pcbi.1006299.e010g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e010" xlink:type="simple"/><mml:math display="inline" id="M10"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> (purple dots) are the sum of <bold><italic>β</italic></bold> and (<bold>X</bold><sup><bold><italic>T</italic></bold></sup> <bold>X</bold>)<sup>−<bold>1</bold></sup> <bold>X</bold><sup><bold><italic>T</italic></bold></sup><bold><italic>ϵ</italic></bold>. The correlation structure between estimated activity vectors for each condition will therefore differ from the correlation structure between the true patterns <bold><italic>β</italic></bold>. (<bold>G</bold>) Distribution of the autocorrelation coefficients in a resting state fMRI dataset, estimated by fitting AR(1) model to the time series of each voxel resampled at TR = 2.4s. The wide range of degree of autocorrelation across voxels makes it difficulty to calculate a simple analytic form of the bias structure introduced by the structured noise, and calls for modeling the noise structure of each voxel separately.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1006299.g001" xlink:type="simple"/>
</fig>
<p>This projection appears to show clear grouping of the states in the orbitofrontal cortex consistent with the 3 categories, suggesting that this brain area represent this aspect of the task. However, a similar representational structure was also observed in other ROIs. In addition, when we applied the same GLM to randomly generated white noise and performed RSA on the resulting parameter estimates, the similarity matrix closely resembled the result found in the real fMRI data (<xref ref-type="fig" rid="pcbi.1006299.g001">Fig 1C</xref>). Since there is no task-related activity in the white noise, the structure obtained from white noise is clearly spurious and must reflect a bias introduced by the analysis. In fact, we found that the off-diagonal structure obtained from white noise (<xref ref-type="fig" rid="pcbi.1006299.g001">Fig 1C</xref>) explained <bold>84</bold> ± <bold>12</bold>% of the variance of the off-diagonals obtained from real data (<xref ref-type="fig" rid="pcbi.1006299.g001">Fig 1B</xref>). This shows that the bias introduced by traditional RSA can dominate the result, masking the real representational structure in the data.</p>
<p>To help understand this observation, we provide an analytic derivation of the bias with a few simplifying assumptions [<xref ref-type="bibr" rid="pcbi.1006299.ref021">21</xref>]. The calculation of the sample correlation of <inline-formula id="pcbi.1006299.e011"><alternatives><graphic id="pcbi.1006299.e011g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e011" xlink:type="simple"/><mml:math display="inline" id="M11"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> in traditional RSA implies the implicit assumption that an underlying covariance structure exists that describes the distribution of <bold><italic>β</italic></bold>, and the activity profile of each voxel is one sample from this distribution. Therefore, examining the relation between the covariance of <inline-formula id="pcbi.1006299.e012"><alternatives><graphic id="pcbi.1006299.e012g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e012" xlink:type="simple"/><mml:math display="inline" id="M12"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> and that of true <bold><italic>β</italic></bold> will help us understand the bias in traditional RSA.</p>
<p>We assume that a covariance matrix <bold>U</bold> (of size <bold><italic>n</italic></bold><sub><bold><italic>C</italic></bold></sub> × <bold><italic>n</italic></bold><sub><bold><italic>C</italic></bold></sub>) captures the true covariance structure of <bold><italic>β</italic></bold> across all voxels in the ROI: <bold><italic>β</italic></bold> ∼ <bold>N</bold>(<bold>0</bold>, <bold>U</bold>). Similarity measures such as correlation are derived from <bold>U</bold> by normalizing the diagonal elements to 1. It is well known that temporal autocorrelation exists in fMRI noise [<xref ref-type="bibr" rid="pcbi.1006299.ref026">26</xref>, <xref ref-type="bibr" rid="pcbi.1006299.ref027">27</xref>]. To capture this, we assume that in each voxel <bold><italic>ϵ</italic></bold> ∼ <bold><italic>N</italic></bold>(<bold>0</bold>, <bold>Σ</bold><sub><bold><italic>ϵ</italic></bold></sub>), where <inline-formula id="pcbi.1006299.e013"><alternatives><graphic id="pcbi.1006299.e013g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e013" xlink:type="simple"/><mml:math display="inline" id="M13"><mml:mrow><mml:msub><mml:mo mathvariant="bold">Σ</mml:mo> <mml:mi mathvariant="bold-italic">ϵ</mml:mi></mml:msub> <mml:mo>∈</mml:mo> <mml:msup><mml:mi mathvariant="double-struck">R</mml:mi> <mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msub> <mml:mo>×</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msub></mml:mrow></mml:msup></mml:mrow></mml:math></alternatives></inline-formula> is the temporal covariance of the noise (for illustration purposes, here we assume that all voxels have the same noise variance and autocorrelation, and temporarily assume the noise is spatially independent).</p>
<p>By substituting the expression for <bold>Y</bold> from <xref ref-type="disp-formula" rid="pcbi.1006299.e002">Eq (1)</xref> into the point estimate of <bold><italic>β</italic></bold> (<xref ref-type="disp-formula" rid="pcbi.1006299.e005">2</xref>), we obtain
<disp-formula id="pcbi.1006299.e014"><alternatives><graphic id="pcbi.1006299.e014g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e014" xlink:type="simple"/><mml:math display="block" id="M14"><mml:mrow><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mo>=</mml:mo> <mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:msup><mml:mi mathvariant="bold">X</mml:mi> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msup> <mml:mi mathvariant="bold">X</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>-</mml:mo> <mml:mn mathvariant="bold">1</mml:mn></mml:mrow></mml:msup> <mml:msup><mml:mi mathvariant="bold">X</mml:mi> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msup> <mml:mi mathvariant="bold">X</mml:mi> <mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>+</mml:mo> <mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:msup><mml:mi mathvariant="bold">X</mml:mi> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msup> <mml:mi mathvariant="bold">X</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>-</mml:mo> <mml:mn mathvariant="bold">1</mml:mn></mml:mrow></mml:msup> <mml:msup><mml:mi mathvariant="bold">X</mml:mi> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msup> <mml:mi mathvariant="bold-italic">ϵ</mml:mi> <mml:mo>=</mml:mo> <mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>+</mml:mo> <mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:msup><mml:mi mathvariant="bold">X</mml:mi> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msup> <mml:mi mathvariant="bold">X</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>-</mml:mo> <mml:mn mathvariant="bold">1</mml:mn></mml:mrow></mml:msup> <mml:msup><mml:mi mathvariant="bold">X</mml:mi> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msup> <mml:mi mathvariant="bold-italic">ϵ</mml:mi></mml:mrow></mml:math></alternatives> <label>(4)</label></disp-formula>
which means the point estimate of <bold><italic>β</italic></bold> is contaminated by a noise term (<bold>X</bold><sup><bold><italic>T</italic></bold></sup> <bold>X</bold>)<sup>−<bold>1</bold></sup> <bold>X</bold><sup><bold><italic>T</italic></bold></sup><bold><italic>ϵ</italic></bold>. Assuming that the signal <bold><italic>β</italic></bold> is independent from the noise <bold><italic>ϵ</italic></bold>, it is then also independent from the linear transformation of the noise, (<bold>X</bold><sup><bold><italic>T</italic></bold></sup> <bold>X</bold>)<sup>−<bold>1</bold></sup> <bold>X</bold><sup><bold><italic>T</italic></bold></sup><bold><italic>ϵ</italic></bold>. Thus the covariance of <inline-formula id="pcbi.1006299.e015"><alternatives><graphic id="pcbi.1006299.e015g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e015" xlink:type="simple"/><mml:math display="inline" id="M15"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> is the sum of the covariance of true <bold><italic>β</italic></bold> and the covariance of (<bold>X</bold><sup><bold><italic>T</italic></bold></sup> <bold>X</bold>)<sup>−<bold>1</bold></sup> <bold>X</bold><sup><bold><italic>T</italic></bold></sup><bold><italic>ϵ</italic></bold>:
<disp-formula id="pcbi.1006299.e016"><alternatives><graphic id="pcbi.1006299.e016g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e016" xlink:type="simple"/><mml:math display="block" id="M16"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mo>∼</mml:mo> <mml:mi mathvariant="bold">N</mml:mi> <mml:mo>(</mml:mo> <mml:mn mathvariant="bold">0</mml:mn> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">U</mml:mi> <mml:mo>+</mml:mo> <mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:msup><mml:mi mathvariant="bold">X</mml:mi> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msup> <mml:mi mathvariant="bold">X</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>-</mml:mo> <mml:mn mathvariant="bold">1</mml:mn></mml:mrow></mml:msup> <mml:msup><mml:mi mathvariant="bold">X</mml:mi> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msup> <mml:msub><mml:mo mathvariant="bold">Σ</mml:mo> <mml:mi mathvariant="bold-italic">ϵ</mml:mi></mml:msub> <mml:mi mathvariant="bold">X</mml:mi> <mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:msup><mml:mi mathvariant="bold">X</mml:mi> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msup> <mml:mi mathvariant="bold">X</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>-</mml:mo> <mml:mn mathvariant="bold">1</mml:mn></mml:mrow></mml:msup> <mml:mo>)</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(5)</label></disp-formula></p>
<p>The term (<bold>X</bold><sup><bold><italic>T</italic></bold></sup> <bold>X</bold>)<sup>−<bold>1</bold></sup> <bold>X</bold><sup><bold><italic>T</italic></bold></sup><bold><italic>∑</italic></bold><sub><bold><italic>ϵ</italic></bold></sub> <bold>X</bold>(<bold>X</bold><sup><bold><italic>T</italic></bold></sup> <bold>X</bold>)<sup>−<bold>1</bold></sup> is the source of the bias in RSA. This bias originates from the structured noise (<bold>X</bold><sup><bold><italic>T</italic></bold></sup> <bold>X</bold>)<sup>−<bold>1</bold></sup> <bold>X</bold><sup><bold><italic>T</italic></bold></sup><bold><italic>ϵ</italic></bold> in estimating <inline-formula id="pcbi.1006299.e017"><alternatives><graphic id="pcbi.1006299.e017g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e017" xlink:type="simple"/><mml:math display="inline" id="M17"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula>. It depends on both the design matrix <bold>X</bold> and the temporal autocorrelation of the noise <bold><italic>ϵ</italic></bold>. <xref ref-type="fig" rid="pcbi.1006299.g001">Fig 1F</xref> illustrates how structured noise can alter the correlation of noisy pattern estimates in a simple case of just two task conditions. Even if we assume the noise is temporally independent (i.e., <bold>Σ</bold><sub><bold><italic>ϵ</italic></bold></sub> is a diagonal matrix, which may be a valid assumption if one “pre-whitens” the data before further analysis [<xref ref-type="bibr" rid="pcbi.1006299.ref027">27</xref>]), the bias structure still exists but reduces to (<bold>X</bold><sup><bold><italic>T</italic></bold></sup> <bold>X</bold>)<sup>−<bold>1</bold></sup> <bold><italic>σ</italic></bold><sup><bold>2</bold></sup>, where <bold><italic>σ</italic></bold><sup><bold>2</bold></sup> is the variance of the noise.</p>
<p>Since the covariance matrix of <inline-formula id="pcbi.1006299.e018"><alternatives><graphic id="pcbi.1006299.e018g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e018" xlink:type="simple"/><mml:math display="inline" id="M18"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> is biased, its correlation is also distorted from the true correlation structure. This is because correlation is merely a rescaling of rows and columns of a covariance matrix. <xref ref-type="fig" rid="pcbi.1006299.g001">Fig 1C</xref> essentially illustrates this bias structure after being converted to correlation matrix (in this case, <bold><italic>σ</italic></bold> = 1 and <bold><italic>β</italic></bold> = <bold>0</bold>) as this RSA structure, by virture of being derived for white noise, can only result from structure in the design matrix <bold>X</bold>. In reality, both spatial and temporal correlations exist in fMRI noise, which complicates the structure of the bias. But the fact that bias in <xref ref-type="fig" rid="pcbi.1006299.g001">Fig 1C</xref> arises even when applying RSA to white noise which itself has no spatial-temporal correlation helps to emphasize the first contributor to the bias: the timing structure of the task, which is exhibited in the correlations between the regressors in the design matrix. Whenever the interval between events of two task conditions is shorter than the length of the HRF (which typically outlasts 12 s), correlation is introduced between their corresponding columns in the design matrix. The degree of correlation depends on the overlapping of the HRFs. If one task condition often closely precedes another, which is the case here as a consequence of the Markovian property of the task, their corresponding columns in the design matrix are more strongly correlated. As a result of these correlations, <bold>X</bold><sup><bold><italic>T</italic></bold></sup> <bold>X</bold> is not a diagonal matrix, and neither is its inverse (<bold>X</bold><sup><bold><italic>T</italic></bold></sup> <bold>X</bold>)<sup>−<bold>1</bold></sup>.</p>
<p>In general, unless the order of task conditions is very well counterbalanced and randomized across participants, the noise (<bold>X</bold><sup><bold><italic>T</italic></bold></sup> <bold>X</bold>)<sup>−<bold>1</bold></sup> <bold>X</bold><sup><bold><italic>T</italic></bold></sup><bold><italic>ϵ</italic></bold> in <inline-formula id="pcbi.1006299.e019"><alternatives><graphic id="pcbi.1006299.e019g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e019" xlink:type="simple"/><mml:math display="inline" id="M19"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> is not i.i.d between task conditions. The bias term <bold>B</bold> = (<bold>X</bold><sup><bold><italic>T</italic></bold></sup> <bold>X</bold>)<sup>−<bold>1</bold></sup> <bold>X</bold><sup><bold><italic>T</italic></bold></sup> <bold>Σ</bold><sub><italic>ϵ</italic></sub> <bold>X</bold>(<bold>X</bold><sup><bold><italic>T</italic></bold></sup> <bold>X</bold>)<sup>−<bold>1</bold></sup> then deviates from a diagonal matrix and causes unequal distortion of the off-diagonal elements in the resulting correlation matrix of <inline-formula id="pcbi.1006299.e020"><alternatives><graphic id="pcbi.1006299.e020g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e020" xlink:type="simple"/><mml:math display="inline" id="M20"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula>. These unequal distortions alter the order of ranking of the values of the off-diagonal elements. Therefore, rank correlation between the similarity matrix from traditional RSA and the similarity matrix of any candidate computational model is necessarily influenced by the bias. Conclusion based on such comparison between two similarity matrices or based on comparing a pair of off-diagonal elements within a neural similarity matrix becomes problematic, as long as the bias causes unequal distortion. Furthermore, if the design matrices also depend on participants’ performance such as errors and reaction time, the bias structure could depend on their performance as well. Comparison between neural representational structure and participants’ behavioral performance may also become problematic in such situations.</p>
<p>It is worth pointing out that the bias is not restricted to using correlation as metric of similarity. Because structured noise exists in <inline-formula id="pcbi.1006299.e021"><alternatives><graphic id="pcbi.1006299.e021g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e021" xlink:type="simple"/><mml:math display="inline" id="M21"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula>, any distance metrics between rows of <inline-formula id="pcbi.1006299.e022"><alternatives><graphic id="pcbi.1006299.e022g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e022" xlink:type="simple"/><mml:math display="inline" id="M22"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> estimated within imaging runs of fMRI data are likely biased. We can take Euclidean distance as an example. For any two task conditions <italic>i</italic> and <italic>j</italic>, the expectation of the distance between <inline-formula id="pcbi.1006299.e023"><alternatives><graphic id="pcbi.1006299.e023g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e023" xlink:type="simple"/><mml:math display="inline" id="M23"><mml:mover accent="true"><mml:msub><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mi mathvariant="bold-italic">i</mml:mi></mml:msub> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1006299.e024"><alternatives><graphic id="pcbi.1006299.e024g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e024" xlink:type="simple"/><mml:math display="inline" id="M24"><mml:mover accent="true"><mml:msub><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mi mathvariant="bold-italic">j</mml:mi></mml:msub> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> is <inline-formula id="pcbi.1006299.e025"><alternatives><graphic id="pcbi.1006299.e025g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e025" xlink:type="simple"/><mml:math display="inline" id="M25"><mml:mrow><mml:msubsup><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>k</mml:mi> <mml:mo>=</mml:mo> <mml:mn mathvariant="bold">1</mml:mn></mml:mrow> <mml:msub><mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mi mathvariant="bold-italic">V</mml:mi></mml:msub></mml:msubsup> <mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mrow><mml:mi mathvariant="bold-italic">i</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:mrow></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mrow><mml:mi mathvariant="bold-italic">j</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:mrow></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mn mathvariant="bold">2</mml:mn></mml:msup> <mml:mo>+</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mi mathvariant="bold-italic">V</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mi mathvariant="bold-italic">B</mml:mi> <mml:mrow><mml:mi mathvariant="bold-italic">i</mml:mi> <mml:mi mathvariant="bold-italic">i</mml:mi></mml:mrow> <mml:mn mathvariant="bold">2</mml:mn></mml:msubsup> <mml:mo>+</mml:mo> <mml:msubsup><mml:mi mathvariant="bold-italic">B</mml:mi> <mml:mrow><mml:mi mathvariant="bold-italic">j</mml:mi> <mml:mi mathvariant="bold-italic">j</mml:mi></mml:mrow> <mml:mn mathvariant="bold">2</mml:mn></mml:msubsup> <mml:mo>-</mml:mo> <mml:mn mathvariant="bold">2</mml:mn> <mml:msubsup><mml:mi mathvariant="bold-italic">B</mml:mi> <mml:mrow><mml:mi mathvariant="bold-italic">i</mml:mi> <mml:mi mathvariant="bold-italic">j</mml:mi></mml:mrow> <mml:mn mathvariant="bold">2</mml:mn></mml:msubsup> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>, where <bold>B</bold> is the bias in the covariance structure. Therefore, the bias <inline-formula id="pcbi.1006299.e026"><alternatives><graphic id="pcbi.1006299.e026g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e026" xlink:type="simple"/><mml:math display="inline" id="M26"><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mi mathvariant="bold-italic">V</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mi mathvariant="bold-italic">B</mml:mi> <mml:mrow><mml:mi mathvariant="bold-italic">i</mml:mi> <mml:mi mathvariant="bold-italic">i</mml:mi></mml:mrow> <mml:mn mathvariant="bold">2</mml:mn></mml:msubsup> <mml:mo>+</mml:mo> <mml:msubsup><mml:mi mathvariant="bold-italic">B</mml:mi> <mml:mrow><mml:mi mathvariant="bold-italic">j</mml:mi> <mml:mi mathvariant="bold-italic">j</mml:mi></mml:mrow> <mml:mn mathvariant="bold">2</mml:mn></mml:msubsup> <mml:mo>-</mml:mo> <mml:mn mathvariant="bold">2</mml:mn> <mml:msubsup><mml:mi mathvariant="bold-italic">B</mml:mi> <mml:mrow><mml:mi mathvariant="bold-italic">i</mml:mi> <mml:mi mathvariant="bold-italic">j</mml:mi></mml:mrow> <mml:mn mathvariant="bold">2</mml:mn></mml:msubsup> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> in Euclidean distance also depends on the task timing structure and the property of noise. (See <xref ref-type="fig" rid="pcbi.1006299.g001">Fig 1D</xref>).</p>
<p>In our derivations above, point estimates of <inline-formula id="pcbi.1006299.e027"><alternatives><graphic id="pcbi.1006299.e027g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e027" xlink:type="simple"/><mml:math display="inline" id="M27"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> introduce structured noise due to the correlation structure in the design matrix. One might think that the bias can be avoided if a design matrix is not used, i.e., if RSA is not performed after GLM analysis, but directly on the raw fMRI patterns. Such an approach still suffers from bias, for two reasons that we detail below.</p>
<p>First, RSA on the raw activity patterns suffers from the second contributor to the bias in RSA that comes from the temporal properties of fMRI noise. To understand this, consider that estimating activity pattern by averaging the raw patterns, for instance 6 sec after each event of a task condition (that is, at the approximate peak of the event-driven HRF) is equivalent to performing an alternative GLM analysis with a design matrix <bold>X</bold><sub><bold>6</bold></sub> that has delta functions 6 sec after each event. Although the columns of this design matrix <bold>X</bold><sub><bold>6</bold></sub> are orthogonal and <inline-formula id="pcbi.1006299.e028"><alternatives><graphic id="pcbi.1006299.e028g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e028" xlink:type="simple"/><mml:math display="inline" id="M28"><mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mi mathvariant="bold">X</mml:mi> <mml:mn mathvariant="bold">6</mml:mn> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msubsup> <mml:msub><mml:mi mathvariant="bold">X</mml:mi> <mml:mn mathvariant="bold">6</mml:mn></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>-</mml:mo> <mml:mn mathvariant="bold">1</mml:mn></mml:mrow></mml:msup></mml:math></alternatives></inline-formula> becomes diagonal, the bias term is still not a diagonal matrix. Because of the autocorrelation structure <bold>Σ</bold><sub><bold><italic>ϵ</italic></bold></sub> in the noise, the bias term <inline-formula id="pcbi.1006299.e029"><alternatives><graphic id="pcbi.1006299.e029g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e029" xlink:type="simple"/><mml:math display="inline" id="M29"><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mi mathvariant="bold">X</mml:mi> <mml:mn mathvariant="bold">6</mml:mn> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msubsup> <mml:msub><mml:mi mathvariant="bold">X</mml:mi> <mml:mn mathvariant="bold">6</mml:mn></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>-</mml:mo> <mml:mn mathvariant="bold">1</mml:mn></mml:mrow></mml:msup> <mml:msubsup><mml:mi mathvariant="bold">X</mml:mi> <mml:mn mathvariant="bold">6</mml:mn> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msubsup> <mml:msub><mml:mo mathvariant="bold">Σ</mml:mo> <mml:mi mathvariant="bold-italic">ϵ</mml:mi></mml:msub> <mml:msub><mml:mi mathvariant="bold">X</mml:mi> <mml:mn mathvariant="bold">6</mml:mn></mml:msub> <mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mi mathvariant="bold">X</mml:mi> <mml:mn mathvariant="bold">6</mml:mn> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msubsup> <mml:msub><mml:mi mathvariant="bold">X</mml:mi> <mml:mn mathvariant="bold">6</mml:mn></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>-</mml:mo> <mml:mn mathvariant="bold">1</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></alternatives></inline-formula> essentially becomes a sampling of the temporal covariance structure of noise at the distances of the inter-event intervals. In this way, timing structure of the task and autocorrelation of noise together still cause bias in the RSA result.</p>
<p>To illustrate this, we applied RSA to the raw patterns of an independent set of resting state fMRI data from the Human Connectome Project [<xref ref-type="bibr" rid="pcbi.1006299.ref028">28</xref>], pretending that the participants experienced events according to the 16-state task in <xref ref-type="fig" rid="pcbi.1006299.g001">Fig 1A</xref>. As shown in <xref ref-type="fig" rid="pcbi.1006299.g001">Fig 1E</xref>, even in the absence of any task-related signal spurious similarity structure emerges when RSA is applied to the raw patterns of resting state data. We then calculated the theoretical bias structure <inline-formula id="pcbi.1006299.e030"><alternatives><graphic id="pcbi.1006299.e030g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e030" xlink:type="simple"/><mml:math display="inline" id="M30"><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mi mathvariant="bold">X</mml:mi> <mml:mn mathvariant="bold">6</mml:mn> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msubsup> <mml:msub><mml:mi mathvariant="bold">X</mml:mi> <mml:mn mathvariant="bold">6</mml:mn></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>-</mml:mo> <mml:mn mathvariant="bold">1</mml:mn></mml:mrow></mml:msup> <mml:msubsup><mml:mi mathvariant="bold">X</mml:mi> <mml:mn mathvariant="bold">6</mml:mn> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msubsup> <mml:msub><mml:mo mathvariant="bold">Σ</mml:mo> <mml:mi mathvariant="bold-italic">ϵ</mml:mi></mml:msub> <mml:msub><mml:mi mathvariant="bold">X</mml:mi> <mml:mn mathvariant="bold">6</mml:mn></mml:msub> <mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mi mathvariant="bold">X</mml:mi> <mml:mn mathvariant="bold">6</mml:mn> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msubsup> <mml:msub><mml:mi mathvariant="bold">X</mml:mi> <mml:mn mathvariant="bold">6</mml:mn></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>-</mml:mo> <mml:mn mathvariant="bold">1</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></alternatives></inline-formula> for each task sequence based on <bold>X</bold><sub><bold>6</bold></sub> of that sequence and <bold>Σ</bold><sub><bold><italic>ϵ</italic></bold></sub> estimated as the average noise temporal correlation matrix of the resting state data of three other participants (right figure of <xref ref-type="fig" rid="pcbi.1006299.g001">Fig 1E</xref>). The off-diagonal elements of all the similarity matrices based on raw patterns were significantly correlated with the theoretical bias structure (the largest Bonferroni-corrected p-value of Pearson correlation is 0.0007) and 51 ± 18% of the variance in the off-diagonal elements can be explained by the theoretical bias.</p>
<p>Second, averaging raw data 6 sec after events of interest over-estimates the similarity between neural patterns of adjacent events, an effect independent of the fMRI noise property. This is because the true HRF in the brain has a protracted time course regardless of how one analyzes the data. Thus the estimated patterns (we denote by <inline-formula id="pcbi.1006299.e031"><alternatives><graphic id="pcbi.1006299.e031g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e031" xlink:type="simple"/><mml:math display="inline" id="M31"><mml:msub><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mn mathvariant="bold">6</mml:mn></mml:msub></mml:math></alternatives></inline-formula>) in this approach are themselves biased due to the mismatch between the implicit HRF that this averaging assumes and the real HRF. The expectation of <inline-formula id="pcbi.1006299.e032"><alternatives><graphic id="pcbi.1006299.e032g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e032" xlink:type="simple"/><mml:math display="inline" id="M32"><mml:msub><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mn mathvariant="bold">6</mml:mn></mml:msub></mml:math></alternatives></inline-formula> becomes <inline-formula id="pcbi.1006299.e033"><alternatives><graphic id="pcbi.1006299.e033g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e033" xlink:type="simple"/><mml:math display="inline" id="M33"><mml:mrow><mml:mi mathvariant="bold-italic">E</mml:mi> <mml:mrow><mml:mo>[</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mn mathvariant="bold">6</mml:mn></mml:msub> <mml:mo>]</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:mi mathvariant="bold-italic">E</mml:mi> <mml:mrow><mml:mo>[</mml:mo> <mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mi mathvariant="bold">X</mml:mi> <mml:mn mathvariant="bold">6</mml:mn> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msubsup> <mml:msub><mml:mi mathvariant="bold">X</mml:mi> <mml:mn mathvariant="bold">6</mml:mn></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>-</mml:mo> <mml:mn mathvariant="bold">1</mml:mn></mml:mrow></mml:msup> <mml:msubsup><mml:mi mathvariant="bold">X</mml:mi> <mml:mn mathvariant="bold">6</mml:mn> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msubsup> <mml:mi mathvariant="bold">Y</mml:mi> <mml:mo>]</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:mi mathvariant="bold-italic">E</mml:mi> <mml:mrow><mml:mo>[</mml:mo> <mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mi mathvariant="bold">X</mml:mi> <mml:mn mathvariant="bold">6</mml:mn> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msubsup> <mml:msub><mml:mi mathvariant="bold">X</mml:mi> <mml:mn mathvariant="bold">6</mml:mn></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>-</mml:mo> <mml:mn mathvariant="bold">1</mml:mn></mml:mrow></mml:msup> <mml:msubsup><mml:mi mathvariant="bold">X</mml:mi> <mml:mn mathvariant="bold">6</mml:mn> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msubsup> <mml:mrow><mml:mo>(</mml:mo> <mml:mi mathvariant="bold">X</mml:mi> <mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>+</mml:mo> <mml:mi mathvariant="bold-italic">ϵ</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>]</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mi mathvariant="bold">X</mml:mi> <mml:mn mathvariant="bold">6</mml:mn> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msubsup> <mml:msub><mml:mi mathvariant="bold">X</mml:mi> <mml:mn mathvariant="bold">6</mml:mn></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>-</mml:mo> <mml:mn mathvariant="bold">1</mml:mn></mml:mrow></mml:msup> <mml:msubsup><mml:mi mathvariant="bold">X</mml:mi> <mml:mn mathvariant="bold">6</mml:mn> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msubsup> <mml:mi mathvariant="bold">X</mml:mi> <mml:mi mathvariant="bold-italic">β</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> instead of <bold><italic>β</italic></bold>. Intuitively, <bold>X</bold> temporarily smears the BOLD patterns of neural responses close in time but <inline-formula id="pcbi.1006299.e034"><alternatives><graphic id="pcbi.1006299.e034g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e034" xlink:type="simple"/><mml:math display="inline" id="M34"><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mi mathvariant="bold">X</mml:mi> <mml:mn mathvariant="bold">6</mml:mn> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msubsup> <mml:msub><mml:mi mathvariant="bold">X</mml:mi> <mml:mn mathvariant="bold">6</mml:mn></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>-</mml:mo> <mml:mn mathvariant="bold">1</mml:mn></mml:mrow></mml:msup> <mml:msubsup><mml:mi mathvariant="bold">X</mml:mi> <mml:mn mathvariant="bold">6</mml:mn> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula> only averages the smeared BOLD patterns without disentangling the smearing. <inline-formula id="pcbi.1006299.e035"><alternatives><graphic id="pcbi.1006299.e035g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e035" xlink:type="simple"/><mml:math display="inline" id="M35"><mml:msub><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mn mathvariant="bold">6</mml:mn></mml:msub></mml:math></alternatives></inline-formula> thus mixes the BOLD activity patterns elicited by all neural events within a time window of approximately 12 sec (the duration of HRF) around the event of interest, causing over-estimation of the similarity between neural patterns of adjacent events. If the order of task conditions is not fully counterbalanced, this method would therefore still introduce into the estimated similarity matrix a bias caused by the structure of the task.</p>
<p>Similar effect can also be introduced if <inline-formula id="pcbi.1006299.e036"><alternatives><graphic id="pcbi.1006299.e036g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e036" xlink:type="simple"/><mml:math display="inline" id="M36"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> is estimated with regularized least square regression [<xref ref-type="bibr" rid="pcbi.1006299.ref029">29</xref>]. Regression with regularization of the amplitude of <inline-formula id="pcbi.1006299.e037"><alternatives><graphic id="pcbi.1006299.e037g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e037" xlink:type="simple"/><mml:math display="inline" id="M37"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> trades off bias in the estimates for variance (noise). On the surface, reducing noise in the pattern estimates may reduce the bias introduced into the similarity matrix. However, the bias in <inline-formula id="pcbi.1006299.e038"><alternatives><graphic id="pcbi.1006299.e038g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e038" xlink:type="simple"/><mml:math display="inline" id="M38"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> itself alters the similarity matrix again. For example, in ridge regression, an additional penalization term <bold>λ<italic>β</italic></bold><sup><bold><italic>T</italic></bold></sup> <bold><italic>β</italic></bold> is imposed for <bold><italic>β</italic></bold> of each voxel. This turns estimates <inline-formula id="pcbi.1006299.e039"><alternatives><graphic id="pcbi.1006299.e039g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e039" xlink:type="simple"/><mml:math display="inline" id="M39"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> to <inline-formula id="pcbi.1006299.e040"><alternatives><graphic id="pcbi.1006299.e040g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e040" xlink:type="simple"/><mml:math display="inline" id="M40"><mml:mrow><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mo>=</mml:mo> <mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:msup><mml:mi mathvariant="bold">X</mml:mi> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msup> <mml:mi mathvariant="bold">X</mml:mi> <mml:mo>+</mml:mo> <mml:mo mathvariant="bold">λ</mml:mo> <mml:mi mathvariant="bold-italic">I</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>-</mml:mo> <mml:mn mathvariant="bold">1</mml:mn></mml:mrow></mml:msup> <mml:msup><mml:mi mathvariant="bold">X</mml:mi> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msup> <mml:mi mathvariant="bold">Y</mml:mi></mml:mrow></mml:math></alternatives></inline-formula>. The component contributed to <inline-formula id="pcbi.1006299.e041"><alternatives><graphic id="pcbi.1006299.e041g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e041" xlink:type="simple"/><mml:math display="inline" id="M41"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> by the true signal <bold><italic>Xβ</italic></bold> becomes (<bold>X</bold><sup><bold><italic>T</italic></bold></sup> <bold>X</bold> + <bold>λ<italic>I</italic></bold>)<sup>−<bold>1</bold></sup> <bold>X</bold><sup><bold><italic>T</italic></bold></sup><bold>X<italic>β</italic></bold>. As <bold>λ</bold> increases, this component increasingly attributes neural activity triggered by other task events near the time of an event of interest to this event’s activity. Therefore, this method too would overestimate pattern similarity between adjacent events.</p>
<p>In all the derivations above, we have assumed for simplicity of illustration that the noise in all voxels has the same temporal covariance structure. In reality, the autocorrelation can vary over a large range across voxels (<xref ref-type="fig" rid="pcbi.1006299.g001">Fig 1G</xref>). So the structured noise in each voxel would follow a different distribution. Furthermore, the spatial correlation in noise means the noise in <inline-formula id="pcbi.1006299.e042"><alternatives><graphic id="pcbi.1006299.e042g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e042" xlink:type="simple"/><mml:math display="inline" id="M42"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> is also correlated across voxels. Because noise correlation between voxels violates the assumption of Pearson correlation that observations (activity profiles of different voxels) are independent, the p-values associated with the correlation coefficients will not be interpretable. Although we made these simplified assumption for ease of illustration, in the model development below, variation of auto-correlation across voxels and spatial noise correlation are both considered in our proposed method.</p>
</sec>
<sec id="sec004">
<title>Bayesian RSA significantly reduces bias in the estimated similarity</title>
<p>As shown above, the covariance structure of the noise in the point estimates of neural activity patterns <inline-formula id="pcbi.1006299.e043"><alternatives><graphic id="pcbi.1006299.e043g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e043" xlink:type="simple"/><mml:math display="inline" id="M43"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> leads to bias in the subsequent similarity measures. The bias can distort off-diagonal elements of the resulting similarity matrix unequally if the order of task conditions is not fully counterbalanced. In order to reduce this bias, we propose a new strategy that aims to infer directly the covariance structure <bold><italic>U</italic></bold> that underlies the similarity of neural patterns, using raw fMRI data. Our method avoids estimating <inline-formula id="pcbi.1006299.e044"><alternatives><graphic id="pcbi.1006299.e044g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e044" xlink:type="simple"/><mml:math display="inline" id="M44"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> altogether, and instead marginalizes over the unknown activity patterns <bold><italic>β</italic></bold> without discarding uncertainty about them. The marginalization avoids the structured noise introduced by the point estimates, which was the central cause of the bias. Given that the bias comes not only from the experimental design but also from the spatial and temporal correlation in noise, we explicitly model these properties in the data. We name this approach Bayesian RSA (BRSA) as it is an empirical Bayesian method [<xref ref-type="bibr" rid="pcbi.1006299.ref030">30</xref>] for estimating <bold><italic>U</italic></bold> as a parameter of the prior distribution of <bold><italic>β</italic></bold> directly from data.</p>
<sec id="sec005">
<title>Direct estimation of similarity matrix while marginalizing unknown neural patterns</title>
<p>BRSA assumes a hierarchical generative model of fMRI data. In this generative model, the covariance structure <bold><italic>U</italic></bold> serves as a hyper-parameter that governs the distribution of <bold><italic>β</italic></bold> in an ROI, which in turn generates the observed fMRI signal <bold>Y</bold>. <bold><italic>U</italic></bold> can be different across ROIs, yielding different similarity structures among ROIs. Each voxel <bold><italic>k</italic></bold> has its own noise parameters, including auto-correlation coefficient <bold><italic>ρ</italic></bold><sub><bold><italic>k</italic></bold></sub> and standard deviation <bold><italic>σ</italic></bold><sub><bold><italic>k</italic></bold></sub> of the “shock” (the noise component at each time step that is unpredictable from the previous time step, sometimes termed “innovation”) in the first-order autoregressive (AR(1)) process used to model the auto-correlated noise in each voxel, and pseudo-SNR <bold><italic>s</italic></bold><sub><bold><italic>k</italic></bold></sub> (we use the term ‘pseudo-SNR’ because the actual SNR depends on both the value of the shared covariance structure <bold><italic>U</italic></bold> and the voxel-specific scaling factor <bold><italic>s</italic></bold><sub><bold><italic>k</italic></bold></sub>. Therefore, <bold><italic>s</italic></bold><sub><bold><italic>k</italic></bold></sub> are restricted to a fixed range while the magnitude of <bold><italic>U</italic></bold> is allowed to vary freely). Given these, (<bold><italic>σ</italic></bold><sub><bold><italic>k</italic></bold></sub><bold><italic>s</italic></bold><sub><bold><italic>k</italic></bold></sub>)<sup><bold>2</bold></sup><bold><italic>U</italic></bold> is the covariance matrix of the distribution of the activity profile <bold><italic>β</italic></bold><sub>⋅<bold><italic>k</italic></bold></sub> in voxel <bold><italic>k</italic></bold> (<inline-formula id="pcbi.1006299.e045"><alternatives><graphic id="pcbi.1006299.e045g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e045" xlink:type="simple"/><mml:math display="inline" id="M45"><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mrow><mml:mo>·</mml:mo> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:mrow></mml:msub> <mml:mo>∈</mml:mo> <mml:msup><mml:mi mathvariant="double-struck">R</mml:mi> <mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mi mathvariant="bold-italic">C</mml:mi></mml:msub> <mml:mo>×</mml:mo> <mml:mn mathvariant="bold">1</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></alternatives></inline-formula>). The model allows different signal and noise parameters across voxels to accommodate situations in which only a fraction of voxels in an ROI might have high response to tasks [<xref ref-type="bibr" rid="pcbi.1006299.ref029">29</xref>] and because the noise property can vary widely across voxels (e.g., <xref ref-type="fig" rid="pcbi.1006299.g001">Fig 1G</xref>). We denote the voxel-specific parameters (<inline-formula id="pcbi.1006299.e046"><alternatives><graphic id="pcbi.1006299.e046g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e046" xlink:type="simple"/><mml:math display="inline" id="M46"><mml:msubsup><mml:mi mathvariant="bold-italic">σ</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mn mathvariant="bold">2</mml:mn></mml:msubsup></mml:math></alternatives></inline-formula>, <bold><italic>ρ</italic></bold><sub><bold><italic>k</italic></bold></sub> and <bold><italic>s</italic></bold><sub><bold><italic>k</italic></bold></sub>) of all voxels together as <bold><italic>θ</italic></bold>.</p>
<p>If the fMRI noise can be assumed to be independent across voxels [<xref ref-type="bibr" rid="pcbi.1006299.ref021">21</xref>], then for any single voxel <bold><italic>k</italic></bold>, we can marginalize over the unknown latent variable <bold><italic>β</italic></bold><sub>⋅<bold><italic>k</italic></bold></sub> to obtain an analytic form of the likelihood of observing the fMRI data <bold><italic>Y</italic></bold><sub><bold><italic>k</italic></bold></sub> in that voxel <bold><italic>p</italic></bold>(<bold><italic>Y</italic></bold><sub><bold><italic>k</italic></bold></sub>|<bold>X</bold>, <bold><italic>U</italic></bold>, <bold><italic>θ</italic></bold><sub><bold><italic>k</italic></bold></sub>). Multiplying the likelihoods for all voxels will result in the likelihood for the entire dataset: <bold><italic>p</italic></bold>(<bold>Y</bold>|<bold>X</bold>, <bold><italic>U</italic></bold>, <bold><italic>θ</italic></bold>). Note that this computation marginalizes over <bold><italic>β</italic></bold>, avoiding altogether the secondary analysis on the point estimates <inline-formula id="pcbi.1006299.e047"><alternatives><graphic id="pcbi.1006299.e047g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e047" xlink:type="simple"/><mml:math display="inline" id="M47"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> that is at the heart of traditional RSA. Through the marginalization, all the uncertainty about <bold><italic>β</italic></bold> is correctly incorporated into the likelihood. By searching for the optimal <inline-formula id="pcbi.1006299.e048"><alternatives><graphic id="pcbi.1006299.e048g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e048" xlink:type="simple"/><mml:math display="inline" id="M48"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">U</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> and other parameters <inline-formula id="pcbi.1006299.e049"><alternatives><graphic id="pcbi.1006299.e049g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e049" xlink:type="simple"/><mml:math display="inline" id="M49"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">θ</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> that maximize the data likelihood, we can therefore obtain a much less biased estimate of <bold><italic>U</italic></bold> for the case of spatially independent noise [<xref ref-type="bibr" rid="pcbi.1006299.ref021">21</xref>].</p>
<p>However, as illustrated by [<xref ref-type="bibr" rid="pcbi.1006299.ref017">17</xref>], intrinsic fluctuation shared across brain areas that is not driven by stimuli can dominate the fMRI time series and influence the RSA result. If one labels any fluctuation not captured by the design matrix as noise, then intrinsic fluctuation shared across voxels can manifest as spatial correlation in the noise, which violates our assumption above. To reduce the impact of intrinsic fluctuation on the similarity estimation, we therefore incorporate this activity explicitly into the BRSA method, with inspiration from the GLM denoising approach [<xref ref-type="bibr" rid="pcbi.1006299.ref031">31</xref>, <xref ref-type="bibr" rid="pcbi.1006299.ref032">32</xref>].</p>
<p>We start by assuming that the shared intrinsic fluctuation across voxels can be explained by a finite set of time courses, which we denote as <bold><italic>X</italic></bold><sub><bold>0</bold></sub>, and the rest of the noise in each voxel is spatially independent. If <bold><italic>X</italic></bold><sub><bold>0</bold></sub> were known, the modulation <bold><italic>β</italic></bold><sub><bold>0</bold></sub> of the fMRI signal <bold>Y</bold> by <bold><italic>X</italic></bold><sub><bold>0</bold></sub> can be marginalized together with the response amplitude <bold><italic>β</italic></bold> to the experimental design matrix <bold><italic>X</italic></bold> (note that we still infer <bold><italic>U</italic></bold>, the covariance structure of <bold><italic>β</italic></bold>, not of <bold><italic>β</italic></bold><sub><bold>0</bold></sub>). Since <bold><italic>X</italic></bold><sub><bold>0</bold></sub> is unknown, BRSA uses an iterative fitting procedure that alternates between a step of fitting the covariance structure <bold><italic>U</italic></bold> while marginalizing <bold><italic>β</italic></bold><sub><bold>0</bold></sub> and <bold><italic>β</italic></bold>, and a step of estimating the intrinsic fluctuation <bold><italic>X</italic></bold><sub><bold>0</bold></sub> from the residual noise with principal component analysis (PCA). Details of this procedure are described in <italic>Part 2 Model fitting procedure</italic> of <xref ref-type="supplementary-material" rid="pcbi.1006299.s001">S1 Material</xref>.</p>
<p>Since our goal is to estimate <bold><italic>U</italic></bold>, voxel-specific parameters <bold><italic>θ</italic></bold> can also be analytically or numerically marginalized so that we only need to fit <bold><italic>U</italic></bold> for the marginal likelihood <bold><italic>p</italic></bold>(<bold>Y</bold>|<bold>X</bold>, <bold>X</bold><sub><bold>0</bold></sub>, <bold><italic>U</italic></bold>). This reduces the number of free parameters in the model and further allows for the extension of estimating a shared representational structure across a group of participants, as shown later. <xref ref-type="fig" rid="pcbi.1006299.g002">Fig 2</xref> shows a diagram of the generative model. More details regarding the generative model and the marginalization can be found in the Materials and Methods, under <italic>Generative model of Bayesian RSA</italic>.</p>
<fig id="pcbi.1006299.g002" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1006299.g002</object-id>
<label>Fig 2</label>
<caption>
<title>Generative model of Bayesian RSA.</title>
<p>The covariance structure <bold><italic>U</italic></bold> shared across all voxels in an ROI is treated as a hyper-parameter of the unknown response amplitude <bold><italic>β</italic></bold>. For voxel <bold><italic>k</italic></bold>, the BOLD time series <bold><italic>Y</italic></bold><sub><bold><italic>k</italic></bold></sub> are the only observable data. We assume <bold><italic>Y</italic></bold><sub><bold><italic>k</italic></bold></sub> is generated by task-related activity amplitudes <bold><italic>β</italic></bold><sub>⋅<bold><italic>k</italic></bold></sub> (the <bold><italic>k</italic></bold>-th column of <bold><italic>β</italic></bold>), intrinsic fluctuation amplitudes <bold><italic>β</italic></bold><sub><bold>0</bold>⋅<bold><italic>k</italic></bold></sub> and spatially independent noise <bold><italic>ϵ</italic></bold><sub><bold><italic>k</italic></bold></sub>: <bold><italic>Y</italic></bold><sub><bold><italic>k</italic></bold></sub> = <bold>X<italic>β</italic></bold><sub><bold><italic>k</italic></bold></sub> + <bold>X</bold><sub><bold>0</bold></sub> <bold><italic>β</italic></bold><sub><bold>0</bold>⋅<bold><italic>k</italic></bold></sub> + <bold><italic>ϵ</italic></bold><sub><bold><italic>k</italic></bold></sub>, where <bold>X</bold> is the design matrix and <bold>X</bold><sub><bold>0</bold></sub> is the set of time courses of intrinsic fluctuations. <bold><italic>ϵ</italic></bold><sub><bold><italic>k</italic></bold></sub> is modeled as an AR(1) process with autocorrelation coefficient <bold><italic>ρ</italic></bold><sub><bold><italic>k</italic></bold></sub> and noise standard deviation <bold><italic>σ</italic></bold><sub><bold><italic>k</italic></bold></sub>. <bold><italic>β</italic></bold><sub>⋅<bold><italic>k</italic></bold></sub> depends on the voxel’s pseudo-SNR <bold><italic>s</italic></bold><sub><bold><italic>k</italic></bold></sub> and noise level <bold><italic>σ</italic></bold><sub><bold><italic>k</italic></bold></sub> in addition to <bold><italic>U</italic></bold>: <bold><italic>β</italic></bold><sub>⋅<bold><italic>k</italic></bold></sub> ∼ <bold><italic>N</italic></bold>(<bold>0</bold>, (<bold><italic>s</italic></bold><sub><bold><italic>k</italic></bold></sub> <bold><italic>σ</italic></bold><sub><bold><italic>k</italic></bold></sub>)<sup><bold>2</bold></sup> <bold><italic>U</italic></bold>). By marginalizing over <bold><italic>β</italic></bold><sub>⋅<bold><italic>k</italic></bold></sub>, <bold><italic>β</italic></bold><sub><bold>0</bold>⋅<bold><italic>k</italic></bold></sub>, <bold><italic>σ</italic></bold><sub><bold><italic>k</italic></bold></sub>, <bold><italic>ρ</italic></bold><sub><bold><italic>k</italic></bold></sub> and <bold><italic>s</italic></bold><sub><bold><italic>k</italic></bold></sub> for each voxel, we can obtain the likelihood function <bold><italic>p</italic></bold>(<bold><italic>Y</italic></bold><sub><bold><italic>k</italic></bold></sub>|<bold>X</bold>, <bold>X</bold><sub><bold>0</bold></sub>, <bold><italic>U</italic></bold>) and search for <bold><italic>U</italic></bold> which maximizes the total log likelihood <inline-formula id="pcbi.1006299.e050"><alternatives><graphic id="pcbi.1006299.e050g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e050" xlink:type="simple"/><mml:math display="inline" id="M50"><mml:mrow><mml:mtext mathvariant="bold">log</mml:mtext><mml:mspace width="4pt"/><mml:mrow><mml:mi mathvariant="bold-italic">p</mml:mi> <mml:mo>(</mml:mo> <mml:mi mathvariant="bold">Y</mml:mi> <mml:mo>|</mml:mo> <mml:mi mathvariant="bold">X</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi mathvariant="bold">X</mml:mi> <mml:mn mathvariant="bold">0</mml:mn></mml:msub> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">U</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:msubsup><mml:mo>∑</mml:mo> <mml:mi mathvariant="bold-italic">k</mml:mi> <mml:msub><mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mi mathvariant="bold-italic">V</mml:mi></mml:msub></mml:msubsup> <mml:mtext mathvariant="bold">log</mml:mtext><mml:mspace width="4pt"/><mml:mrow><mml:mi mathvariant="bold-italic">p</mml:mi> <mml:mo>(</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">Y</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub> <mml:mo>|</mml:mo> <mml:mi mathvariant="bold">X</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi mathvariant="bold">X</mml:mi> <mml:mn mathvariant="bold">0</mml:mn></mml:msub> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">U</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> of the observed data <bold>Y</bold> for all <bold><italic>n</italic></bold><sub><bold><italic>V</italic></bold></sub> voxels. The optimal <inline-formula id="pcbi.1006299.e051"><alternatives><graphic id="pcbi.1006299.e051g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e051" xlink:type="simple"/><mml:math display="inline" id="M51"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">U</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> can be converted to a correlation matrix, representing the estimated similarity between patterns.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1006299.g002" xlink:type="simple"/>
</fig>
<p>The covariance matrix <bold><italic>U</italic></bold> can be parameterized by its Cholesky factor <bold><italic>L</italic></bold>, a lower-triangular matrix. To find the <inline-formula id="pcbi.1006299.e052"><alternatives><graphic id="pcbi.1006299.e052g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e052" xlink:type="simple"/><mml:math display="inline" id="M52"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">U</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> that best explains the data <bold><italic>Y</italic></bold>, we first calculate the <inline-formula id="pcbi.1006299.e053"><alternatives><graphic id="pcbi.1006299.e053g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e053" xlink:type="simple"/><mml:math display="inline" id="M53"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">L</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> that best explains the data by maximizing the marginal log likelihood:
<disp-formula id="pcbi.1006299.e054"><alternatives><graphic id="pcbi.1006299.e054g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e054" xlink:type="simple"/><mml:math display="block" id="M54"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mover accent="true"><mml:mi mathvariant="bold-italic">L</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mo>=</mml:mo></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:munder><mml:mrow><mml:mtext mathvariant="bold">arg</mml:mtext> <mml:mspace width="4pt"/><mml:mtext mathvariant="bold">max</mml:mtext></mml:mrow> <mml:mi mathvariant="bold-italic">L</mml:mi></mml:munder><mml:mspace width="4pt"/><mml:mtext mathvariant="bold">log</mml:mtext><mml:mspace width="4pt"/><mml:mi mathvariant="bold-italic">p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi mathvariant="bold">Y</mml:mi> <mml:mo>|</mml:mo> <mml:mi mathvariant="bold">X</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi mathvariant="bold">X</mml:mi> <mml:mn mathvariant="bold">0</mml:mn></mml:msub> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">L</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd columnalign="right"><mml:mo>=</mml:mo></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:munder><mml:mrow><mml:mtext mathvariant="bold">arg</mml:mtext> <mml:mspace width="4pt"/><mml:mtext mathvariant="bold">max</mml:mtext></mml:mrow> <mml:mi mathvariant="bold-italic">L</mml:mi></mml:munder> <mml:munderover><mml:mo>∑</mml:mo> <mml:mrow><mml:mi mathvariant="bold-italic">k</mml:mi></mml:mrow> <mml:msub><mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mi mathvariant="bold-italic">V</mml:mi></mml:msub></mml:munderover> <mml:mtext mathvariant="bold">log</mml:mtext> <mml:mo>∫</mml:mo> <mml:mo>∫</mml:mo> <mml:mo>∫</mml:mo> <mml:mi mathvariant="bold-italic">d</mml:mi> <mml:msub><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mrow><mml:mo>·</mml:mo> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:mrow></mml:msub> <mml:mi mathvariant="bold-italic">d</mml:mi> <mml:msub><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mrow><mml:mn mathvariant="bold">0</mml:mn> <mml:mo>·</mml:mo> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:mrow></mml:msub> <mml:mi mathvariant="bold-italic">d</mml:mi> <mml:msub><mml:mi mathvariant="bold-italic">θ</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub> <mml:mi mathvariant="bold-italic">p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">Y</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub> <mml:mo>|</mml:mo> <mml:mi mathvariant="bold">X</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi mathvariant="bold">X</mml:mi> <mml:mn mathvariant="bold">0</mml:mn></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mrow><mml:mo>·</mml:mo> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:mrow></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mrow><mml:mn mathvariant="bold">0</mml:mn> <mml:mo>·</mml:mo> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:mrow></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">θ</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:mo>·</mml:mo> <mml:mi mathvariant="bold-italic">p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mrow><mml:mo>·</mml:mo> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:mrow></mml:msub> <mml:mo>|</mml:mo> <mml:mi mathvariant="bold-italic">L</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">θ</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mi mathvariant="bold-italic">p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mrow><mml:mn mathvariant="bold">0</mml:mn> <mml:mo>·</mml:mo> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:mrow></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mi mathvariant="bold-italic">p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">θ</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(6)</label></disp-formula>
And then obtain the estimated covariance matrix
<disp-formula id="pcbi.1006299.e055"><alternatives><graphic id="pcbi.1006299.e055g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e055" xlink:type="simple"/><mml:math display="block" id="M55"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mover accent="true"><mml:mi mathvariant="bold-italic">U</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mo>=</mml:mo> <mml:mover accent="true"><mml:mi mathvariant="bold-italic">L</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:msup><mml:mover accent="true"><mml:mi mathvariant="bold-italic">L</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msup></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(7)</label></disp-formula>
Once <inline-formula id="pcbi.1006299.e056"><alternatives><graphic id="pcbi.1006299.e056g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e056" xlink:type="simple"/><mml:math display="inline" id="M56"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">U</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> is estimated (after the iterative fitting procedure for <bold><italic>L</italic></bold> and <bold><italic>X</italic></bold><sub><bold>0</bold></sub>), <inline-formula id="pcbi.1006299.e057"><alternatives><graphic id="pcbi.1006299.e057g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e057" xlink:type="simple"/><mml:math display="inline" id="M57"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">U</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> is converted to a correlation matrix to yield BRSA’s estimation of the similarity structure in the ROI.</p>
</sec>
<sec id="sec006">
<title>BRSA recovers simulated similarity structure</title>
<p>To test the performance of BRSA in a case where the ground-truth covariance structure is known, we embedded a structure into resting state fMRI data. Signals were simulated by first sampling response amplitudes according to a hypothetical covariance structure for the “16-state” task conditions (<xref ref-type="fig" rid="pcbi.1006299.g003">Fig 3A</xref>) for voxels assumed to respond to the task, and then weighting the design matrix of the task in <xref ref-type="fig" rid="pcbi.1006299.g001">Fig 1A</xref> by the simulated response amplitudes. The resulting simulated signals were then added to resting state fMRI data. In this way, the “noise” in the test data reflected the spatial and temporal structure of realistic fMRI noise. To make the estimation task even more challenging, we simulated a situation in which within the ROI (<xref ref-type="fig" rid="pcbi.1006299.g003">Fig 3B</xref>; we took the lateral occipital cortex as an ROI in this simulation, as an example) only a small proportion (∼ 4%) of voxels respond to the task conditions (<xref ref-type="fig" rid="pcbi.1006299.g003">Fig 3C</xref>). This is to reflect the fact that SNR often varies across voxels and that an ROI is often pre-selected based on anatomical criteria or independent functional localizer, which do not guarantee that all the selected voxels will have task-related activity. We evaluated the performance of BRSA at different levels of SNR and on different amounts of data (1, 2 and 4 runs of data, where each run includes fMRI data of 182±12 time points. The simulated ROI includes more than 4000 voxels.) The results of additional simulation in which signals were added in all voxels at lower SNR are similar, and provided in <italic>Part 4 Performance of all methods when all voxels have task-related signals</italic> of <xref ref-type="supplementary-material" rid="pcbi.1006299.s001">S1 Material</xref>.</p>
<fig id="pcbi.1006299.g003" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1006299.g003</object-id>
<label>Fig 3</label>
<caption>
<title>Performance of BRSA and other methods on simulated data.</title>
<p>(<bold>A</bold>) We simulate task-related activation magnitude according to a multivariate normal distribution with a hypothetical “true” covariance structure <italic>U</italic> as displayed. (<bold>B</bold>) We use lateral occipital cortex (bright region) as an example ROI and resting state fMRI data from the Human Connectome Project as noise. (<bold>C</bold>) We multiplied the design matrix of the task in <xref ref-type="fig" rid="pcbi.1006299.g001">Fig 1A</xref> with the activity pattern simulated according to A and then added this “signal” to voxels in a cubical region of the ROI. The colors show the actual SNR of the added signal for one example simulated brain, corresponding to the plot circumvented by a red square in F. SNR here is defined as the ratio of standard deviation of the simulated signal to that of the noise (the time series of the resting state fMRI data): <inline-formula id="pcbi.1006299.e058"><alternatives><graphic id="pcbi.1006299.e058g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e058" xlink:type="simple"/><mml:math display="inline" id="M58"><mml:mfrac><mml:mrow><mml:mtext>std</mml:mtext> <mml:mo>(</mml:mo> <mml:mi mathvariant="bold-italic">X</mml:mi> <mml:msub><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mrow><mml:mo>·</mml:mo> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:mrow></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mtext>std</mml:mtext> <mml:mo>(</mml:mo> <mml:msub><mml:mtext>noise</mml:mtext> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow></mml:mfrac></mml:math></alternatives></inline-formula>, where noise<sub><bold><italic>k</italic></bold></sub> is the time series of the resting state fMRI data in voxel <bold><italic>k</italic></bold>, treated as task-irrelevant noise in our simulation. (<bold>D</bold>) The pseudo-SNR map estimated by BRSA for the data with a true SNR map shown in C. The scale does not match the scale of true SNR, but the spatial pattern of SNR is recovered. The result corresponds to the simulation condition with red box in F. (<bold>E</bold>) The distributions of the fitted pseudo-SNR of task-active (pink) and inactive (blue) voxels are highly separable. The inset shows the SNR in active voxels and their fitted pseudo-SNR are significantly correlated. r = 0.62, p&lt;1.4e-20. (<bold>F</bold>) Average covariance matrix (top) and similarity matrix (bottom) estimated by BRSA in the cubic area in C, across different SNR levels (columns) and different numbers of runs (rows). The average SNRs within the voxels with signals added (i.e., voxels with color in C) are displayed at the bottom. Note that we do not expect the values in the covariance or correlation matrix to scale linearly with SNR. The major effect of SNR is that the similarity structure becomes noisier as SNR decreases. (<bold>G</bold>) The corresponding result obtained by standard RSA based on activity patterns estimated within runs, which are spatially whitened. The major effect of SNR is that bias structure is stronger in the result as SNR decreases. (<bold>H</bold>) The corresponding result of RSA based on cross-correlating patterns estimated from separate runs, which are spatially whitened based on the residuals of all scanning runs. The major effect of SNR is noisier result and smaller correlational coefficients overall as SNR decreases. (<bold>I</bold>) Top: average correlation (mean ± std) between the off-diagonal elements of the estimated and true similarity matrices, for each method, across SNR levels (x-axis) and amounts of data (separate plots). Bottom: The correlation between the average estimated similarity matrix of each method (for GBRSA, this is the single similarity matrix estimated) and the true similarity matrix. “point-est”: methods based on point estimates of activity patterns; “-crossrun”: similarity based on cross-correlation between runs; “-whiten”: patterns were spatially whitened.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1006299.g003" xlink:type="simple"/>
</fig>
<p>In addition to comparing the performance of BRSA with traditional RSA, we also evaluated the performance of a few other approaches that have been proposed to improve the performance of RSA. One such approach is cross-run RSA [<xref ref-type="bibr" rid="pcbi.1006299.ref017">17</xref>–<xref ref-type="bibr" rid="pcbi.1006299.ref019">19</xref>]. Cross-run RSA calculates the similarity between patterns estimated from separate scanning runs, in contrast to the traditional RSA (here denoted as within-run RSA) which uses patterns estimated from the same scanning runs:
<disp-formula id="pcbi.1006299.e059"><alternatives><graphic id="pcbi.1006299.e059g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e059" xlink:type="simple"/><mml:math display="block" id="M59"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="left"><mml:mi mathvariant="bold-italic">C</mml:mi><mml:msub><mml:mrow/><mml:mrow><mml:mi mathvariant="bold-italic">i</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">j</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi mathvariant="bold-italic">c</mml:mi> <mml:mi mathvariant="bold-italic">r</mml:mi> <mml:mi mathvariant="bold-italic">o</mml:mi> <mml:mi mathvariant="bold-italic">s</mml:mi> <mml:mi mathvariant="bold-italic">s</mml:mi> <mml:mo>-</mml:mo> <mml:mi mathvariant="bold-italic">r</mml:mi> <mml:mi mathvariant="bold-italic">u</mml:mi> <mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mtd></mml:mtr> <mml:mtr><mml:mtd><mml:mrow><mml:mo>=</mml:mo> <mml:mfrac><mml:mn mathvariant="bold">1</mml:mn> <mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mrow><mml:mi mathvariant="bold-italic">r</mml:mi> <mml:mi mathvariant="bold-italic">u</mml:mi> <mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mi mathvariant="bold-italic">s</mml:mi></mml:mrow></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mrow><mml:mi mathvariant="bold-italic">r</mml:mi> <mml:mi mathvariant="bold-italic">u</mml:mi> <mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mi mathvariant="bold-italic">s</mml:mi></mml:mrow></mml:msub> <mml:mo>-</mml:mo> <mml:mn mathvariant="bold">1</mml:mn> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mfrac> <mml:munderover><mml:mo>∑</mml:mo> <mml:mrow><mml:mi mathvariant="bold-italic">m</mml:mi> <mml:mo>=</mml:mo> <mml:mn mathvariant="bold">1</mml:mn></mml:mrow> <mml:msub><mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mrow><mml:mi mathvariant="bold-italic">r</mml:mi> <mml:mi mathvariant="bold-italic">u</mml:mi> <mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mi mathvariant="bold-italic">s</mml:mi></mml:mrow></mml:msub></mml:munderover> <mml:munderover><mml:mo>∑</mml:mo> <mml:mrow><mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mo>=</mml:mo> <mml:mn mathvariant="bold">1</mml:mn> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mo>≠</mml:mo> <mml:mi mathvariant="bold-italic">m</mml:mi></mml:mrow> <mml:msub><mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mrow><mml:mi mathvariant="bold-italic">r</mml:mi> <mml:mi mathvariant="bold-italic">u</mml:mi> <mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mi mathvariant="bold-italic">s</mml:mi></mml:mrow></mml:msub></mml:munderover> <mml:mfrac><mml:mrow><mml:mfrac><mml:mn mathvariant="bold">1</mml:mn> <mml:msub><mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mi mathvariant="bold-italic">V</mml:mi></mml:msub></mml:mfrac> <mml:msubsup><mml:mo>∑</mml:mo> <mml:mrow><mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mo>=</mml:mo> <mml:mn mathvariant="bold">1</mml:mn></mml:mrow> <mml:msub><mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mi mathvariant="bold-italic">V</mml:mi></mml:msub></mml:msubsup> <mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mrow><mml:mi mathvariant="bold-italic">i</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:mrow> <mml:mrow><mml:mo>(</mml:mo> <mml:mi mathvariant="bold-italic">m</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:msubsup> <mml:mo>-</mml:mo> <mml:mover><mml:msubsup><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mrow><mml:mi mathvariant="bold-italic">i</mml:mi></mml:mrow> <mml:mrow><mml:mo>(</mml:mo> <mml:mi mathvariant="bold-italic">m</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:msubsup> <mml:mo>¯</mml:mo></mml:mover> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mrow><mml:mi mathvariant="bold-italic">j</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:mrow> <mml:mrow><mml:mo>(</mml:mo> <mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:msubsup> <mml:mo>-</mml:mo> <mml:mover><mml:msubsup><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mrow><mml:mi mathvariant="bold-italic">j</mml:mi></mml:mrow> <mml:mrow><mml:mo>(</mml:mo> <mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:msubsup> <mml:mo>¯</mml:mo></mml:mover> <mml:mo>)</mml:mo></mml:mrow></mml:mrow> <mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">σ</mml:mi> <mml:msubsup><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mrow><mml:mi mathvariant="bold-italic">i</mml:mi></mml:mrow> <mml:mrow><mml:mo>(</mml:mo> <mml:mi mathvariant="bold-italic">m</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:msubsup></mml:msub> <mml:msub><mml:mi mathvariant="bold-italic">σ</mml:mi> <mml:msubsup><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mrow><mml:mi mathvariant="bold-italic">j</mml:mi></mml:mrow> <mml:mrow><mml:mo>(</mml:mo> <mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:msubsup></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(8)</label></disp-formula>
Where <bold><italic>n</italic></bold><sub><bold><italic>runs</italic></bold></sub> is the total number of scanning runs; <inline-formula id="pcbi.1006299.e060"><alternatives><graphic id="pcbi.1006299.e060g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e060" xlink:type="simple"/><mml:math display="inline" id="M60"><mml:msubsup><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mrow><mml:mi mathvariant="bold-italic">i</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:mrow> <mml:mrow><mml:mo>(</mml:mo> <mml:mi mathvariant="bold-italic">m</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:msubsup></mml:math></alternatives></inline-formula> is the estimated activity of condition <bold><italic>i</italic></bold> at voxel <bold><italic>k</italic></bold> in the <bold><italic>m</italic></bold>-th run, and <inline-formula id="pcbi.1006299.e061"><alternatives><graphic id="pcbi.1006299.e061g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e061" xlink:type="simple"/><mml:math display="inline" id="M61"><mml:mover><mml:msubsup><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mrow><mml:mi mathvariant="bold-italic">i</mml:mi></mml:mrow> <mml:mrow><mml:mo>(</mml:mo> <mml:mi mathvariant="bold-italic">m</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:msubsup> <mml:mo>¯</mml:mo></mml:mover></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1006299.e062"><alternatives><graphic id="pcbi.1006299.e062g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e062" xlink:type="simple"/><mml:math display="inline" id="M62"><mml:msub><mml:mi mathvariant="bold-italic">σ</mml:mi> <mml:msubsup><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mrow><mml:mi mathvariant="bold-italic">i</mml:mi></mml:mrow> <mml:mrow><mml:mo>(</mml:mo> <mml:mi mathvariant="bold-italic">m</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:msubsup></mml:msub></mml:math></alternatives></inline-formula> are the mean and standard deviation of the estimated pattern of condition <bold><italic>i</italic></bold> in the <bold><italic>m</italic></bold>-th run calculated across voxels. The idea is that because the noises in the estimated patterns of different runs (e.g., <inline-formula id="pcbi.1006299.e063"><alternatives><graphic id="pcbi.1006299.e063g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e063" xlink:type="simple"/><mml:math display="inline" id="M63"><mml:msup><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mrow><mml:mo>(</mml:mo> <mml:mi mathvariant="bold-italic">m</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:msup></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1006299.e064"><alternatives><graphic id="pcbi.1006299.e064g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e064" xlink:type="simple"/><mml:math display="inline" id="M64"><mml:msup><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mrow><mml:mo>(</mml:mo> <mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:msup></mml:math></alternatives></inline-formula>) are independent, the expectation of the numerator of <xref ref-type="disp-formula" rid="pcbi.1006299.e059">Eq 8</xref> does not contain the bias term (<bold>X</bold><sup><bold><italic>T</italic></bold></sup> <bold>X</bold>)<sup>−<bold>1</bold></sup> <bold>X</bold><sup><bold><italic>T</italic></bold></sup><bold>Σ</bold><sub><bold><italic>ϵ</italic></bold></sub><bold>X</bold>(<bold>X</bold><sup><bold><italic>T</italic></bold></sup> <bold>X</bold>)<sup>−<bold>1</bold></sup> of <xref ref-type="disp-formula" rid="pcbi.1006299.e016">Eq 5</xref>. However, the standard deviations in the denominator are still inflated by the noise in the estimates of patterns. Therefore this metric overall underestimates the pattern similarity [<xref ref-type="bibr" rid="pcbi.1006299.ref018">18</xref>]. This is reflected in the low correlation coefficients between any two conditions at low SNR. The resulting similarity matrix is also generally not positive semi-definite. For example, one may observe a result in which the pattern of condition <bold><italic>i</italic></bold> is more similar to that of condition <bold><italic>j</italic></bold> than to itself in cross-run RSA, or even negative correlation between patterns of the same condition across runs. Another approach is to spatially whiten the estimated patterns before calculating frequentist-based similarity metrics, either within-run or cross-run [<xref ref-type="bibr" rid="pcbi.1006299.ref019">19</xref>]. This serves to reduce the correlation between estimated activity profiles across voxels, making the whitened samples more conforming to the assumption of sample independence made by Pearson correlation. Following the procedure in [<xref ref-type="bibr" rid="pcbi.1006299.ref019">19</xref>], after estimating activity patterns <inline-formula id="pcbi.1006299.e065"><alternatives><graphic id="pcbi.1006299.e065g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e065" xlink:type="simple"/><mml:math display="inline" id="M65"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> from each run, residuals of all runs were taken together to estimate a spatial covariance matrix of noise. Since there are more voxels than time points, the spatial noise covariance matrix is shrunk towards a diagonal matrix using the optimal shrinkage method proposed by Ledoit and Wolf [<xref ref-type="bibr" rid="pcbi.1006299.ref033">33</xref>], to make the covariance matrix invertible.</p>
<p><xref ref-type="fig" rid="pcbi.1006299.g003">Fig 3F</xref> shows the average covariance structure and similarity matrix estimated by BRSA across 24 simulated subjects. The four-condition block in the simulated structure of <xref ref-type="fig" rid="pcbi.1006299.g003">Fig 3A</xref> can still be observed at low SNR and small amount of data. Spatial whitening improved the performance of both standard within-run RSA and cross-run RSA. Therefore, in <xref ref-type="fig" rid="pcbi.1006299.g003">Fig 3G and 3H</xref> we display the average covariance structure and similarity matrix estimated by within-run and cross-run RSA with spatial whitening. Even with spatial whitening, standard within-run RSA is still overwhelmed by the bias structure (<xref ref-type="disp-formula" rid="pcbi.1006299.e016">Eq 5</xref>) in most of the simulations. Among the three displayed methods, cross-run RSA with spatial whitening has the least bias structure at the highest SNR. But at low SNR, as expected, noise impacts the result so much that the estimated similarity between patterns among condition 9-12 (refer to <xref ref-type="fig" rid="pcbi.1006299.g003">Fig 3A</xref>) can appear higher than the similarity between patterns of the same condition across runs (<bold>3H</bold>), making the result difficult to interpret. Furthermore, cross-run RSA can only be applied when there are more than one run of data. BRSA, in contrast, recovers the simulated similarity structure even at low SNR and small amount of data, and can be applied when there is only one run of data.</p>
<p><xref ref-type="fig" rid="pcbi.1006299.g003">Fig 3I</xref> summarizes the average correlation between the off-diagonal elements of the estimated similarity matrix and those of the simulated similarity matrix. A 3-factor (RSA method, SNR and amounts of data) repeated-measure ANOVA on the simulation results with 2 and 4 runs of data shows significant main effect of RSA methods (F = 239.8, p&lt;1e-47), main effect of SNR (F = 1647.6, p&lt;4e-64), main effect of amounts of data (F = 76.1, p&lt;1e-8), interaction between methods with SNR (F = 81.8, p&lt;2e-83), interaction between amounts of data and SNR (F = 19.3, p&lt;3e-9) and interaction among the three factors (F = 35.5, p&lt;4e-49). Post-hoc paired t-tests between BRSA and every other method show that BRSA performs significantly better (highest p = 0.03). The second best method, cross-run RSA with spatial whitening, is also significantly better than the three other approaches (highest p = 2e-12). To confirm the impression that BRSA performs better at low SNR while cross-run RSA with spatial whitening performs better at high SNR, we performed an additional repeated-measures ANOVA with only these two approaches. The results indeed showed a significant interaction between RSA method and SNR (F = 3.0, p&lt;4e-21). At the lowest SNR, the correlation between the simulated similarity structure and the similarity matrix estimated by within-run RSA with whitening is -0.057±0.056. This is consistent with the correlation between the simulated similarity structure and the theoretical spurious similarity structure of within-run RSA when assuming the analyzed data is pure white noise (-0.055±0.036), and further confirms our theoretical analysis.</p>
<p>The peak height of task-triggered response is often in the range of 0.1-0.5% of fMRI signal magnitudes in cognitive studies [<xref ref-type="bibr" rid="pcbi.1006299.ref034">34</xref>] while the noise level is often a few percents. This means that except when studying primary sensory stimulation, the SNRs expected in real studies are likely in the lower range in our simulation, where BRSA shows the most benefit.</p>
</sec>
<sec id="sec007">
<title>Added bonus: Inferring pseudo-SNR map</title>
<p>Although the voxel-specific parameters <bold><italic>θ</italic></bold> are marginalized during fitting of the model, we can obtain their posterior distribution and estimate their posterior means. The estimated pseudo-SNR <inline-formula id="pcbi.1006299.e066"><alternatives><graphic id="pcbi.1006299.e066g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e066" xlink:type="simple"/><mml:math display="inline" id="M66"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">s</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> is of particular interest, as it informs us of where the estimated representational structure is more strongly supported in the ROI chosen by the researcher. As shown in <xref ref-type="fig" rid="pcbi.1006299.g003">Fig 3D</xref>, the estimated pseudo-SNR map highly resembles the actual map of SNR in our simulated data in <xref ref-type="fig" rid="pcbi.1006299.g003">Fig 3C</xref> and they are significantly correlated. The correlation between estimated pseudo-SNR and actual SNR is 0.82 (p = 0) over all voxels in the ROI, and 0.62 (p&lt;1.4e-20) in the active voxels with task-related signals added. The distributions of the estimated pseudo-SNR of task-active and inactive voxels are highly separable (<xref ref-type="fig" rid="pcbi.1006299.g003">Fig 3E</xref>).</p>
</sec>
<sec id="sec008">
<title>Estimating shared representational similarity across participants</title>
<p>As mentioned above, BRSA can be extended to jointly fit the data of a group of participants, thus identifying the shared representational similarity structure that best explains the data of all participants. This is achieved by searching for a single <bold><italic>U</italic></bold> that maximizes the joint probability of observing all participants’ data (Group Bayesian RSA; GBRSA). The rationale of GBRSA is that it searches for the representational structure that best explains all the data. Using all the data to constrain the estimation of <bold><italic>U</italic></bold> reduces the variance of estimation for individual participants, an inspiration from hyper-alignment [<xref ref-type="bibr" rid="pcbi.1006299.ref022">22</xref>] and shared response model [<xref ref-type="bibr" rid="pcbi.1006299.ref023">23</xref>]. <xref ref-type="fig" rid="pcbi.1006299.g003">Fig 3I</xref> shows that the similarity structure recovered by GBRSA has slightly higher correlation with the true similarity structure than the average similarity structure estimated by other methods, across most of the SNR levels and amounts of data. Cross-run RSA with spatial whitening performs better only at the highest simulated SNRs. However, low average SNR is common in many brain areas and this is where (G)BRSA offers more power for detecting the true but weak similarity structure.</p>
</sec>
</sec>
<sec id="sec009">
<title>Controlling for over-fitting: Model selection by cross-validation on left-out data</title>
<p>Although <xref ref-type="fig" rid="pcbi.1006299.g003">Fig 3</xref> shows that BRSA reduces bias, it does not eliminate it completely. This may be due to over-fitting to noise. Because it is unlikely that the time course of intrinsic fluctuation <bold><italic>X</italic></bold><sub><bold>0</bold></sub> and the design matrix <bold><italic>X</italic></bold> are perfectly orthogonal, part of the intrinsic fluctuation cannot be distinguished from task-related activity. Therefore, the structure of <bold><italic>β</italic></bold><sub><bold>0</bold></sub>, the modulation of intrinsic fluctuation, could also influence the estimated <inline-formula id="pcbi.1006299.e067"><alternatives><graphic id="pcbi.1006299.e067g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e067" xlink:type="simple"/><mml:math display="inline" id="M67"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">U</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> when SNR is low.</p>
<p>For instance, in <xref ref-type="fig" rid="pcbi.1006299.g003">Fig 3F</xref>, at the lowest SNR and least amount of data (top left subplot), the true similarity structure is almost undetectable using BRSA. Is this due to large variance in the estimates, or is it because BRSA is still biased, but to a lesser degree than standard RSA? If the result is still biased, then averaging results across subjects will not remove the bias, and the deviation of the average estimated similarity structure from the true similarity structure should not approach 0. To test this, we simulated many more subjects by preserving the spatial patterns of intrinsic fluctuation and the auto-regressive properties of the voxel-specific noise in the data used in <xref ref-type="fig" rid="pcbi.1006299.g003">Fig 3</xref>, and generating intrinsic fluctuations that maintain the amplitudes of power spectrum in the frequency domain. To expose the limit of the performance of BRSA, we focused on the lower range of SNR and simulated only one run of data per “subject”. <xref ref-type="fig" rid="pcbi.1006299.g004">Fig 4A</xref> shows the quality of the average estimated similarity matrix with increasing number of simulated subjects. The average similarity matrices estimated by BRSA do not approach the true similarity matrix indefinitely as the number of subjects increase. Instead, their correlation saturates to a value smaller than 1. This indicates that the result of BRSA is still weakly biased, with the bias depending on the SNR. It is possible that as the SNR approaches 0, the estimated <inline-formula id="pcbi.1006299.e068"><alternatives><graphic id="pcbi.1006299.e068g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e068" xlink:type="simple"/><mml:math display="inline" id="M68"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">U</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> is gradually dominated by the impact of the part of <bold><italic>X</italic></bold><sub><bold>0</bold></sub> not orthogonal to <bold><italic>X</italic></bold>. This bias is not due to underestimating the number of regressors in <bold><italic>X</italic></bold><sub><bold>0</bold></sub> (see <italic>Part 6 The effect of the number of nuisance regressors on BRSA performance</italic> of <xref ref-type="supplementary-material" rid="pcbi.1006299.s001">S1 Material</xref>). We leave investigation of the source of this bias to future work. Empirically, the algorithm [<xref ref-type="bibr" rid="pcbi.1006299.ref035">35</xref>] we use to estimate the number of regressors in <bold><italic>X</italic></bold><sub><bold>0</bold></sub> yields more stable and reasonable estimation than other methods we have tested (e.g., [<xref ref-type="bibr" rid="pcbi.1006299.ref036">36</xref>]). It should be noted that BRSA still performs much better than standard RSA, for which the correlation between the estimated similarity matrix and the true similarity matrix never passed 0.1 in these simulations.</p>
<fig id="pcbi.1006299.g004" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1006299.g004</object-id>
<label>Fig 4</label>
<caption>
<title>Limited performance of BRSA at very low SNR and small amount of data.</title>
<p>(<bold>A</bold>) The average correlation between the off-diagonal elements of the estimated and the true similarity matrices (mean ± std) as the number of simulated subjects increases. Each simulated subject had one run of data. Legend shows average SNR in task-responsive voxels. Half of the voxels do not include any signal related to the design matrix. The correlation reaches asymptotic levels slightly below 1 with increasing numbers of participants except when the SNR is extremely low (0.07), indicating that the bias is not fully eliminated. (<bold>B</bold>) The average correlation between the estimated similarity matrix and the expected bias structure assuming white noise. The estimated similarity structure is most dominated by the bias structure at the lowest SNR simulated (0.07). The negative correlation at the highest SNR reflects the weak negative correlation between the true similarity structure and expected bias structure (-0.055).</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1006299.g004" xlink:type="simple"/>
</fig>
<p>The expected bias structure when spatial noise correlation exists is difficult to derive. We used (<bold>X</bold><sup><bold><italic>T</italic></bold></sup> <bold>X</bold>)<sup>−<bold>1</bold></sup> as a proxy to evaluate the residual bias in the estimated similarity using BRSA. As expected, when the SNR approached zero, the model over-fit to the noise and the bias structure increasingly dominated the estimated structure despite increasing the number of simulated participants (<xref ref-type="fig" rid="pcbi.1006299.g004">Fig 4B</xref>). This observation calls for an evaluation procedure to detect over-fitting in applications to real data, when the ground truth of the similarity structure is unknown.</p>
<p>One approach to assess whether a BRSA model has over-fit the noise is cross-validation. In addition to estimating <bold><italic>U</italic></bold>, the model can also estimate the posterior mean of all other parameters, including the neural patterns <bold><italic>β</italic></bold> of task-related activity, <bold><italic>β</italic></bold><sub><bold>0</bold></sub> of intrinsic fluctuation, noise variances <bold><italic>σ</italic></bold><sup><bold>2</bold></sup> and auto-correlation coefficients <bold><italic>ρ</italic></bold>. For a left-out testing data set, the design matrix <bold><italic>X</italic></bold><sub>test</sub> is known given the task design. Together with the parameters estimated from the training data as well as the estimated variance and auto-correlation properties of the intrinsic fluctuation in the training data, we can calculate the log predictive probability of observing the test data. The unknown intrinsic fluctuation in the test data can be marginalized by assuming their statistical property stays unchanged from training data to test data. The predictive probability can then be contrasted against the cross-validated predictive probability provided by a null model separately fitted to the training data. The null model would have all the same assumptions as the full BRSA model, except that it would not assume any task-related activity captured by <bold><italic>X</italic></bold>. When BRSA over-fits the data, the estimated spatial pattern <inline-formula id="pcbi.1006299.e069"><alternatives><graphic id="pcbi.1006299.e069g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e069" xlink:type="simple"/><mml:math display="inline" id="M69"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> would not reflect the true response pattern to the task and is unlikely to be modulated by the time course in <bold><italic>X</italic></bold><sub>test</sub>. Thus the full model would predict signals that do not occur in the test data, and yield a lower predictive probability than the null model. The result of the full BRSA model on training data can therefore be accepted if the log predictive probability by the full model is higher than that of the null model significantly more often than chance.</p>
<p>Over-fitting might also arise when the assumed design matrix <bold><italic>X</italic></bold> does not correctly reflect task-related activity. When there is a sufficient amount of data but the design matrix does not reflect the true activity, the estimated covariance matrix <inline-formula id="pcbi.1006299.e070"><alternatives><graphic id="pcbi.1006299.e070g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e070" xlink:type="simple"/><mml:math display="inline" id="M70"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">U</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> in BRSA would approach zero, as would the posterior estimates of <inline-formula id="pcbi.1006299.e071"><alternatives><graphic id="pcbi.1006299.e071g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e071" xlink:type="simple"/><mml:math display="inline" id="M71"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula>. In this case as well, the full model would perform worse than the null model, because the form of the predictive likelihood automatically penalize more complex models.</p>
<p>We tested the effectiveness of relying on cross-validation to reject over-fitted results using the same simulation procedure as in <xref ref-type="fig" rid="pcbi.1006299.g003">Fig 3</xref>, and repeated this simulation 36 times, each time with newly simulated signals and data from a new group of participants in HCP [<xref ref-type="bibr" rid="pcbi.1006299.ref037">37</xref>] as “noise”. Each such simulated group represents one replication study. The ROI to extract “noise” from HCP dataset and the region to add signals were the same as in <xref ref-type="fig" rid="pcbi.1006299.g003">Fig 3</xref>. <xref ref-type="fig" rid="pcbi.1006299.g005">Fig 5A</xref> shows the rate of correct acceptance when both training and test data have signals. We counted each simulation in which the cross-validation score (log predictive probability) of the full BRSA model was significantly higher than the score of the null model (based on a one-sided student’s t-test at a threshold of <bold><italic>α</italic></bold> = 0.05) as one incidence of correct acceptance. When the SNR is high (at least 0.27 in the active voxels when there are two runs of training data, or at least 0.54 when there is one run of data), warranting reliable estimation of the similarity structures as indicated in <xref ref-type="fig" rid="pcbi.1006299.g003">Fig 3I</xref>, the cross-validation procedure selected the full model significantly more often than chance across simulation (the highest p = 0.03, binomial test with Bonferroni correction [<xref ref-type="bibr" rid="pcbi.1006299.ref038">38</xref>]). At low SNRs and with less training data (SNR below 0.27 when there is only one run of data or at 0.14 when there are two runs of data), the full model was almost never selected (p&lt;9e-9), although in some cases the true similarity structure is still visible in the result of <xref ref-type="fig" rid="pcbi.1006299.g003">Fig 3F</xref>. This indicates that the cross-validation procedure is relatively conservative. The means and standard deviations of the t-statistics across simulated groups for all simulation configurations are displayed in <xref ref-type="fig" rid="pcbi.1006299.g005">Fig 5B</xref>. The differences in cross-validation scores between full and null models are displayed in <xref ref-type="fig" rid="pcbi.1006299.g005">Fig 5C</xref>. The reason that the null model can have a higher cross-validation score than the full model at low SNR is not only because of potential overfitting of the full model to the noise, but also because the full model’s log likelihood function has an additional log determinant term due to the inclusion of <bold><italic>β</italic></bold>, which naturally penalizes for the extra complexity of the model compared to the null model (see Eqs <xref ref-type="disp-formula" rid="pcbi.1006299.e085">(12)</xref>, <xref ref-type="disp-formula" rid="pcbi.1006299.e091">(13)</xref> and <xref ref-type="disp-formula" rid="pcbi.1006299.e098">(15)</xref> in <xref ref-type="sec" rid="sec012">Materials and methods</xref>).</p>
<fig id="pcbi.1006299.g005" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1006299.g005</object-id>
<label>Fig 5</label>
<caption>
<title>Cross-validation reduces the chance of false positive results.</title>
<p>A group of 24 subjects with different SNRs were simulated as in <xref ref-type="fig" rid="pcbi.1006299.g003">Fig 3</xref>. 1 or 2 runs of data were used as training data and 1 left-out run was used as test data. The full BRSA model and a null model that assumes no task-related activity were fit to each simulated subject’s training data. Student’s t-test was performed on the differences between the cross-validation scores (the predictive log likelihoods for the test data) of the full model and null model across the simulated subjects to determine whether the full model should be accepted for each group of simulated subjects. This procedure was repeated on 36 different groups of simulated data (all using real fMRI data of non-overlapping subjects from HCP dataset as noise). (<bold>A</bold>) Task-related signals were added to both training and test data. The frequencies with which the full models were accepted based on the t-test (correct acceptance) are displayed for each simulation condition, grouped by the amounts of training data (1 or 2 runs). SNRs in the task-active voxels (about 4% of all) are displayed on the top-right and correspond to the SNRs in <xref ref-type="fig" rid="pcbi.1006299.g003">Fig 3</xref>. Full model was almost always rejected at the lowest simulated SNR. (<bold>B</bold>) Mean ± std of the t-statistics of the difference between cross-validation scores of the full and null models across simulated groups, for the corresponding amounts of data and SNR in A. (<bold>C</bold>) Mean ± std of the difference between the cross-validation scores of the full models and the null models across simulated groups in A. (<bold>D</bold>) Mean ± std of the difference between the cross-validation scores when only the training data but not test data were added with task-related signals. The statistical test correctly rejected the full model in all simulated groups. (<bold>E</bold>) Mean ± std of the difference between the cross-validation scores when neither training nor test data contain task-related signals. The statistical test correctly rejected the full model in all simulated groups.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1006299.g005" xlink:type="simple"/>
</fig>
<p>The cross-validation procedure also helps avoid false acceptance when activity patterns are not consistently reproducible across runs. To illustrate this, we simulated the case when signals are only added to the training data but not to the test data. Now, the full model was always rejected across the simulated SNR and amounts of data. Finally, when neither training data nor testing data included signal, the cross-validation procedure also correctly rejected the full model in all cases. <xref ref-type="fig" rid="pcbi.1006299.g005">Fig 5D and 5E</xref> illustrate the difference between cross-validation scores of full and null models for the two simulations, respectively. The advantage of the null model was smaller with 2 runs of training data in <xref ref-type="fig" rid="pcbi.1006299.g005">Fig 5E</xref> (t = -4.1, p = 2e-4, paired t-test), because in the full model the magnitudes of the posterior estimates of task-related activity patterns <inline-formula id="pcbi.1006299.e072"><alternatives><graphic id="pcbi.1006299.e072g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e072" xlink:type="simple"/><mml:math display="inline" id="M72"><mml:msub><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mrow><mml:mo>(</mml:mo> <mml:mtext>post</mml:mtext> <mml:mo>)</mml:mo></mml:mrow></mml:msub></mml:math></alternatives></inline-formula> are smaller with more training data, and this causes less mis-prediction for the test data.</p>
</sec>
<sec id="sec010">
<title>Extension: Decoding task-related activity from new data</title>
<p>BRSA has a relatively rich model for the data: it attempts to model both the task-related signal and intrinsic fluctuation, and to capture voxel-specific SNR and noise properties. The covariance matrix <bold><italic>U</italic></bold> and the pseudo-SNR of each voxel serve as structured prior that make the estimation of <inline-formula id="pcbi.1006299.e073"><alternatives><graphic id="pcbi.1006299.e073g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e073" xlink:type="simple"/><mml:math display="inline" id="M73"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> more precise. In addition to allowing cross-validation, the more precise estimation of activity patterns and the richer model of data also enable decoding of signals related to task conditions from new data. Similarly to the procedure of calculating cross-validated log likelihood, but without pre-assuming a design matrix for the test data, we can calculate the posterior mean of <inline-formula id="pcbi.1006299.e074"><alternatives><graphic id="pcbi.1006299.e074g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e074" xlink:type="simple"/><mml:math display="inline" id="M74"><mml:msub><mml:mover accent="true"><mml:mi mathvariant="bold-italic">X</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mtext>test</mml:mtext></mml:msub></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1006299.e075"><alternatives><graphic id="pcbi.1006299.e075g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e075" xlink:type="simple"/><mml:math display="inline" id="M75"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi mathvariant="bold-italic">X</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mrow><mml:mn>0</mml:mn><mml:mtext>test</mml:mtext></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> in the testing data. <xref ref-type="fig" rid="pcbi.1006299.g006">Fig 6A</xref> shows the decoded design matrix <inline-formula id="pcbi.1006299.e076"><alternatives><graphic id="pcbi.1006299.e076g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e076" xlink:type="simple"/><mml:math display="inline" id="M76"><mml:msub><mml:mover accent="true"><mml:mi mathvariant="bold-italic">X</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mtext>test</mml:mtext></mml:msub></mml:math></alternatives></inline-formula> for one task condition (condition 6 in Figs <xref ref-type="fig" rid="pcbi.1006299.g001">1B</xref> and <xref ref-type="fig" rid="pcbi.1006299.g006">6B</xref>) and one participant, using one run of training data with the second-highest SNR. Although our method decodes some spurious responses when there is no event of this task condition and that there is slight shift of baseline, overall the result captures most of the true responses in the design matrix. The average correlation between the decoded design matrix and the true design matrix is displayed in <xref ref-type="fig" rid="pcbi.1006299.g006">Fig 6B</xref>. High values on the diagonal elements indicate that overall, the decoder based on BRSA can recover the task-related signals well. These values are mostly beyond the range of the null distribution of correlations if task conditions were randomly shuffled (<xref ref-type="fig" rid="pcbi.1006299.g006">Fig 6C</xref>. The 7 percentile of the distribution of the values in the diagonal elements of <xref ref-type="fig" rid="pcbi.1006299.g006">Fig 6B</xref> is beyond the 93 percentile of the distribution of the shuffled correlations). The structure of the off-diagonal elements appears highly similar to those of the correlation structure between corresponding columns in the original design matrix(r = 0.82, p&lt;6e-30) and also similar to the true pattern similarity structure we simulated (r = 0.30, p&lt;1e-3). The resemblance to correlation in design matrix means that the signals corresponding to task conditions which often occur closely in time in training data are more likely to be confused when they are decoded from testing data. This is likely because the overlapping time courses between frequently co-occurring conditions make it difficult to distinguish which of two nearby events triggered the BOLD response during training, and reduced the accuracy of the posterior estimation of response patterns. We suspect that such confusion is not limited to decoding based on BRSA, but should be a general limitation of multi-variate pattern analysis of fMRI data: due to the slow smooth BOLD response, the more often the events of two task conditions occur closely in time in the training data, the more difficult it becomes for the classifier to discern their patterns. The resemblance to the true pattern similarity is not surprising since activity in conditions with similar neural patterns are expected to be more difficult to discern. The diagonal values were higher in conditions 1-8, because these conditions occurred for more times in the task design. This is expected, since more measurements lead to more reliable estimation of activity patterns.</p>
<fig id="pcbi.1006299.g006" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1006299.g006</object-id>
<label>Fig 6</label>
<caption>
<title>Decoding capabilities of the BRSA method.</title>
<p>(<bold>A</bold>) Decoded task-related activity of the sixth condition from one simulated subject in one run of test data, and the true design matrix of that condition in the test data. The simulated data with the second highest SNR in <xref ref-type="fig" rid="pcbi.1006299.g003">Fig 3</xref> were used. BRSA model was fitted to one run of training data. (<bold>B</bold>) Average correlation between the decoded signals for each task condition (rows) and the time courses for each condition in the design matrix used to simulate the test data (columns). (<bold>C</bold>) The distribution of correlation between the decoded signals of each condition with the time series in design matrix of the corresponding condition across 24 simulated subjects (pink), and the null distribution of correlation between condition-permuted decoded signals and design matrix (blue). The Bhattacharyya coefficient [<xref ref-type="bibr" rid="pcbi.1006299.ref039">39</xref>] between the two distributions is 0.36.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1006299.g006" xlink:type="simple"/>
</fig>
</sec>
</sec>
<sec id="sec011" sec-type="conclusions">
<title>Discussion</title>
<p>In this paper, we demonstrated that bias can arise in the result of representational similarity analysis, a popular method in many recent fMRI studies. By analytically deriving the source of the bias with simplifying assumptions, we showed that it is determined by both the timing structure of the experiment design and the correlation structure of the noise (and task-unrelated neural activity) in the data. Traditional RSA is based on point estimates of neural activation patterns which unavoidably include high amounts of noise. The task design and noise property induce covariance structure in the noise of the pattern estimates. This structure, in turn, biases the covariance structure of these point estimates, and a bias persists in the similarity matrix. Such bias is especially severe when the SNR is low and when the order of the task conditions is not fully counterbalanced.</p>
<p>The bias demonstrated in this paper does not necessarily question the validity of all previous results generated by RSA. It does call for more caution when applying RSA to higher-level brain areas in which SNR of fMRI is typically low, and when the order of different task conditions cannot be fully counterbalanced. Counterbalancing a design could be done at different levels. The lowest level is randomizing the order of task conditions within a run. At higher levels, task sequences can also be randomized across runs and participants. If there are few measurements of each task condition within a run, randomizing trial order only within a run does not guarantee a perfectly counterbalanced design. The bias structure can then deviate from a diagonal matrix. If the same random sequence is used for all runs, or for all participants, small biases can persist across runs and participants and become a confound. Therefore, it is also important to use different task sequences across runs and participants when possible. Although such counterbalancing at different levels is desirable, it may not be achievable when studying high-level cognition, for instance in decision making tasks that involve learning or structured sequential decisions. These tasks often require (or impose) a specific relationship among conditions and events cannot be randomly shuffled.</p>
<p>To reduce this bias, especially for cases when counterbalancing task conditions is not possible, we proposed a Bayesian framework that interprets the representational structure as reflecting the shared covariance structure of activity levels across voxels. Our BRSA method estimates this covariance structure directly from data, bypassing the structured noise in the point estimates of activity profiles, and explicitly modeling the spatial and temporal structure of the noise. This is different from many other methods that attempt to correct the bias after it has been introduced. Interestingly, Lindquist et al. recently pointed out that when applying a sequence of processing steps to fMRI data, a later step can reintroduce nuisance effects that earlier steps attempted to remove. They therefore suggest combining all the processing steps into one single filtering step [<xref ref-type="bibr" rid="pcbi.1006299.ref040">40</xref>], which is similar in spirit to the method we propose here. Although the issues of performing multiple analyses steps sequentially arise in different context, these works together raise caution for developing new analyses on quantities estimated by existing processing pipelines. Furthermore, in the view of [<xref ref-type="bibr" rid="pcbi.1006299.ref040">40</xref>], regression analysis is one but many possible projections of the original data to a subspace. Therefore, other preprocessing steps can also potentially alter the covariance structure of noise in the point estimates of patterns, and consequently alter the bias structure in standard RSA.</p>
<p>In addition to inferring the representational similarity structure, our method also infers activation patterns (as an alternative to the traditional GLM), SNR for different voxels, and even the “design matrix” for data recorded without knowledge of the underlying conditions. The inferred activation patterns are regularized not only by the SNR, but also by the learned similarity structure. The inference of an unknown “design matrix” allows one to uncover uninstructed task conditions (e.g., in free thought) using the full Bayesian machinery and all available data.</p>
<p>In a realistic simulation using real fMRI data as background noise, we showed that BRSA generally outperforms standard RSA and cross-run RSA, especially when the SNR is low and when the amount of data is limited, making our method a good candidate in scenarios of low SNR (e.g., higher order cortices) and difficult-to-balance tasks (e.g., learning and sequential decision making). Because temporal and spatial correlations also exist in the noise of data from other neural recording modalities, the method can also be applied to other types of data when the bias in standard RSA is of concern. To detect overfitting to noise, the difference between the cross-validated score of the full model of BRSA and a null model can serve as the basis for model selection. We further extended the model to allow for estimating the shared representational structure across a group of participants. This shared structure can be very useful in model testing. As suggested by [<xref ref-type="bibr" rid="pcbi.1006299.ref041">41</xref>], the correlation between similarity matrices estimated from individual participants’ data and the group average similarity matrix reflects the “noise ceiling”: the expected correlation one can achieve between the similarity matrix from an unknown “true” computational model and the similarity matrix from data, given the amount of noise in the data. The shared similarity matrix obtained through the joint fitting of GBRSA can be used in place of the group average similarity matrix for the purpose of calculating this noise ceiling.</p>
<p>Prior proposals suggested the use of similarity between patterns estimated from separate scanning runs (cross-run RSA) [<xref ref-type="bibr" rid="pcbi.1006299.ref018">18</xref>, <xref ref-type="bibr" rid="pcbi.1006299.ref019">19</xref>, <xref ref-type="bibr" rid="pcbi.1006299.ref042">42</xref>], in order to overcome “pattern drift” [<xref ref-type="bibr" rid="pcbi.1006299.ref018">18</xref>], which can be seen as being caused by an interaction between the study design and auto-correlated fMRI noise. The inner product between noise pattern estimates from separate runs is indeed theoretically unbiased. Cross-run RSA was also proposed for assessing the extent to which brain patterns can discriminate between different conditions [<xref ref-type="bibr" rid="pcbi.1006299.ref043">43</xref>]. In our simulations, cross-run RSA generally performs better than within-run RSA, but worse than BRSA. However, after spatial whitening of the point estimates of activity patterns, cross-run RSA outperforms BRSA at high SNR, with the results of both methods very close to the true similarity structure in this case. On the other hand, at low SNR, BRSA performs better. The limitation of cross-run RSA is that even though the cross-run covariance matrix is unbiased, the magnitude of cross-run correlation is underestimated. Additionally, the high noise in the pattern estimates can also lead to results that are difficult to interpret, such as an anti-correlation between estimated patterns of the same condition from different runs. In general, it is not guaranteed that cross-run RSA will obtain a measure of distance that satisfies the triangle inequality. In contrast, although BRSA is not fully unbiased, it does guarantee that the estimated similarity matrix is positive semi-definite, and that an interpretable distance metric can be derived by subtracting the similarity matrix from 1. In sum, it is difficult to predict whether BRSA or cross-run RSA with spatial whitening will be more suitable for any specific study and brain area of interest since their performance depends on SNR and both methods have limitations. Nonetheless, based on our results, both approaches should always be favored over traditional within-run RSA.</p>
<p>While spatial whitening might be desirable for the purpose of cross-run RSA since it improves the performance, one should take caution when interpreting activity pattern after whitening. This is because spatial whitening remixes data across voxels and risks moving task-related signals from voxels responding to a task to non-responsive voxels. Instead of performing spatial whitening, BRSA estimates several time series <bold><italic>X</italic></bold><sub><bold>0</bold></sub> that best explain the correlation of noise between voxels, and marginalizes over their modulations of activity in each voxel. Therefore, BRSA can capture spatial noise correlation without the risk of misattributing signals across voxels.</p>
<p>In our study, we did not directly compare BRSA to cross-validated Mahalanobis distance [<xref ref-type="bibr" rid="pcbi.1006299.ref019">19</xref>] because these two methods are fundamentally different measures: BRSA aims to estimate the correlation between patterns, which is close to the cosine angle between two patterns vectors [<xref ref-type="bibr" rid="pcbi.1006299.ref044">44</xref>–<xref ref-type="bibr" rid="pcbi.1006299.ref046">46</xref>]; in contrast, Mahalanobis distance aims to measure the distance between patterns. Nonetheless, given the theoretical soundness of the cross-validated Mahalanobis distance and the possibility of statistically testing the distances against 0, it could also be a good alternative to BRSA when there are multiple runs in a study.</p>
<p>Our BRSA method is closely related to pattern component modeling (PCM) [<xref ref-type="bibr" rid="pcbi.1006299.ref010">10</xref>, <xref ref-type="bibr" rid="pcbi.1006299.ref047">47</xref>]. A major difference is that PCM models the point estimates <inline-formula id="pcbi.1006299.e077"><alternatives><graphic id="pcbi.1006299.e077g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e077" xlink:type="simple"/><mml:math display="inline" id="M77"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> after a GLM analysis while BRSA models fMRI data <bold>Y</bold> directly. The original PCM [<xref ref-type="bibr" rid="pcbi.1006299.ref010">10</xref>] in fact considered the contribution of noise in pattern estimates to the similarity matrix, but assumed that the noise in <inline-formula id="pcbi.1006299.e078"><alternatives><graphic id="pcbi.1006299.e078g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e078" xlink:type="simple"/><mml:math display="inline" id="M78"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> is i.i.d across task conditions. This means that the bias in the covariance matrix was assumed to be restricted to a diagonal matrix. We showed here that when the order of task conditions cannot be fully counterbalanced, such as in the example in <xref ref-type="fig" rid="pcbi.1006299.g001">Fig 1</xref>, this assumption is violated and the bias cannot be accounted for by methods such as PCM. Another difference is that BRSA explicitly models spatial noise correlation, which can improve the results (see Figure <bold>3</bold> of <xref ref-type="supplementary-material" rid="pcbi.1006299.s001">S1 Material</xref>).</p>
<p>If the covariance structure of the noise <bold>Σ</bold><sub><bold><italic>ϵ</italic></bold></sub> were known, the diagonal component of the noise covariance structure assumed in PCM [<xref ref-type="bibr" rid="pcbi.1006299.ref010">10</xref>] could be replaced by the bias term (<bold>X</bold><sup><bold><italic>T</italic></bold></sup> <bold>X</bold>)<sup>−<bold>1</bold></sup> <bold>X</bold><sup><bold><italic>T</italic></bold></sup><bold>Σ</bold><sub><bold><italic>ϵ</italic></bold></sub> <bold>X</bold>(<bold>X</bold><sup><bold><italic>T</italic></bold></sup> <bold>X</bold>)<sup>−<bold>1</bold></sup> to adapt PCM to estimate the covariance structure <inline-formula id="pcbi.1006299.e079"><alternatives><graphic id="pcbi.1006299.e079g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e079" xlink:type="simple"/><mml:math display="inline" id="M79"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">U</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> that best explains <inline-formula id="pcbi.1006299.e080"><alternatives><graphic id="pcbi.1006299.e080g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e080" xlink:type="simple"/><mml:math display="inline" id="M80"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> [<xref ref-type="bibr" rid="pcbi.1006299.ref047">47</xref>], ignoring spatial noise correlation. However, as shown in <xref ref-type="fig" rid="pcbi.1006299.g001">Fig 1G</xref>, different voxels can have a wide range of different autocorrelation coefficients, therefore assuming a single <bold>Σ</bold><sub><bold><italic>ϵ</italic></bold></sub> for all voxels may be over-simplifying. PCM also assumes all voxels within one ROI have equal SNR. However, typically only a small fraction of voxels exhibit high SNR [<xref ref-type="bibr" rid="pcbi.1006299.ref029">29</xref>]. Therefore, it is useful to model the noise property and SNR of each voxel individually. Relatedly, Alink et al. proposed to model the bias structure in the similarity matrix as a polynomial function of the temporal distance between each pair of conditions and regress out such structure [<xref ref-type="bibr" rid="pcbi.1006299.ref018">18</xref>]. This regression approach is plausible when each task condition contains a single event. If one were to accept the simplifying assumptions above, a more principled choice for regressing out the bias structure would use the analytic form of the bias structure we derived above as a regressor.</p>
<p>BRSA comes with the ability to select between a full model and null model based on cross-validated log likelihood, and can be applied to fMRI decoding. PCM can evaluate the likelihood of a few fixed candidate representational structures given by different computational models. It can also estimate the additive contributions of several candidate pattern covariance structures to the observed covariance structure. These options are not yet available in the current implementation of BRSA. Combining the strengths of PCM and BRSA is an interesting direction for future research. Another future direction is to cross-validate full and null models on the data of left-out subjects, instead of cross-validating within subjects on a left-out run of data.</p>
<p>Many aspects of flexibility may be incorporated to BRSA. For example, the success of the analysis hinges on the assumption that the hemodynamic response function (HRF) used in the design matrix correctly reflects the true hemodynamics in the region of interest, but the HRF in fact varies across people and across brain regions [<xref ref-type="bibr" rid="pcbi.1006299.ref048">48</xref>, <xref ref-type="bibr" rid="pcbi.1006299.ref049">49</xref>]. Jointly fitting the shape of the HRF and the representational structure using BRSA may thus improve the estimation. In addition, it is possible that even if the landscape of activity patterns for a task condition stays the same, the global amplitude of the response pattern may vary across trials due to repetition suppression [<xref ref-type="bibr" rid="pcbi.1006299.ref050">50</xref>–<xref ref-type="bibr" rid="pcbi.1006299.ref052">52</xref>] and attention [<xref ref-type="bibr" rid="pcbi.1006299.ref053">53</xref>, <xref ref-type="bibr" rid="pcbi.1006299.ref054">54</xref>]. Allowing global amplitude modulation of patterns associated with a task condition to vary across trials might capture such variability and increase the power of the method.</p>
<p>Finally, our simulations revealed that BRSA is not entirely unbiased, that is, the results cannot be improved indefinitely by adding more subjects. This bias is not a consequence of the number of components estimated by the algorithm we chose [<xref ref-type="bibr" rid="pcbi.1006299.ref035">35</xref>] (see <italic>Part 6</italic> of <xref ref-type="supplementary-material" rid="pcbi.1006299.s001">S1 Material</xref>), and further investigation is needed to understand the source of this remaining bias. The residual bias occurs when SNR is very low and may be due to overfitting of the model to noise. Fortunately, the cross-validation procedure we provided helps to detect overfitting when the SNR is too low. When this happens, it is advisable to focus on taking measures to improve the design of study. Ultimately, task designs that are not fully counterbalanced and low SNR in fMRI data are two critical factors that cause bias in traditional RSA and impact the power of detecting similarity structure in neural representations. Carefully designing tasks that balance the task conditions as much as possible, using different randomized task sequences across runs and across participants, and increasing the number of measurements, are our first line of recommendations. In the analysis phase of the project, one can then use BRSA.</p>
</sec>
<sec id="sec012" sec-type="materials|methods">
<title>Materials and methods</title>
<sec id="sec013">
<title>Ethics statement</title>
<p>The fMRI data used in the current manuscript came from two sources. Part of them came from a previously published study, which was approved by the Princeton Institutional Review Board and all subjects gave informed written consent prior to participation. The other part came from open access data of the Human Connectome Project (<ext-link ext-link-type="uri" xlink:href="https://www.humanconnectome.org/" xlink:type="simple">https://www.humanconnectome.org/</ext-link>).</p>
</sec>
<sec id="sec014">
<title>Generative model of Bayesian RSA</title>
<p>The detailed derivation of the generative model, the model fitting procedure, model selection based on cross-validation and decoding task-related signals are in the <italic>Parts 1, 2 and 3</italic> of <xref ref-type="supplementary-material" rid="pcbi.1006299.s001">S1 Material</xref>. Here we provide the major assumptions and the formula of the likelihood of fMRI data in our model.</p>
<p>Our generative model of fMRI data follows the general assumption of GLM. In addition, we model spatial noise correlation by a few time series <bold><italic>X</italic></bold><sub><bold>0</bold></sub> shared across all voxels. The contribution of <bold><italic>X</italic></bold><sub><bold>0</bold></sub> to the <bold><italic>k</italic></bold>-th voxel is <bold><italic>β</italic></bold><sub><bold>0</bold>⋅<bold><italic>k</italic></bold></sub>. Thus, for voxel <bold><italic>k</italic></bold>, we assume that
<disp-formula id="pcbi.1006299.e081"><alternatives><graphic id="pcbi.1006299.e081g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e081" xlink:type="simple"/><mml:math display="block" id="M81"><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">Y</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub> <mml:mo>=</mml:mo> <mml:mi mathvariant="bold-italic">X</mml:mi> <mml:msub><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mrow><mml:mo>·</mml:mo> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:mrow></mml:msub> <mml:mo>+</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">X</mml:mi> <mml:mn mathvariant="bold">0</mml:mn></mml:msub> <mml:msub><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mrow><mml:mn mathvariant="bold">0</mml:mn> <mml:mo>·</mml:mo> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:mrow></mml:msub> <mml:mo>+</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">ϵ</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub></mml:mrow></mml:math></alternatives> <label>(9)</label></disp-formula> <bold><italic>Y</italic></bold><sub><bold><italic>k</italic></bold></sub> is the time series of voxel <bold><italic>k</italic></bold>. <bold><italic>X</italic></bold> is the design matrix shared by all voxels. <bold><italic>β</italic></bold><sub>⋅<bold><italic>k</italic></bold></sub> is the response amplitudes of the voxel <bold><italic>k</italic></bold> to all the task conditions. <bold><italic>ϵ</italic></bold><sub><bold><italic>k</italic></bold></sub> is the residual noise in voxel <bold><italic>k</italic></bold> which cannot be explained by either <bold><italic>X</italic></bold> or <bold><italic>X</italic></bold><sub><bold>0</bold></sub>. We assume that <bold><italic>ϵ</italic></bold> is spatially independent across voxels, and all the correlation in noise between voxels are captured by the shared intrinsic fluctuation <bold><italic>X</italic></bold><sub><bold>0</bold></sub>.</p>
<p>We use an AR(1) process to model <bold><italic>ϵ</italic></bold><sub><bold><italic>k</italic></bold></sub>: for the <bold><italic>k</italic></bold>-th voxel, we denote the noise at time <bold><italic>t</italic></bold> &gt; <bold>0</bold> as <bold><italic>ϵ</italic></bold><sub><bold><italic>t</italic></bold>,<bold><italic>k</italic></bold></sub>, and assume
<disp-formula id="pcbi.1006299.e082"><alternatives><graphic id="pcbi.1006299.e082g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e082" xlink:type="simple"/><mml:math display="block" id="M82"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">ϵ</mml:mi> <mml:mrow><mml:mi mathvariant="bold-italic">t</mml:mi> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:mrow></mml:msub> <mml:mo>=</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">ρ</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub> <mml:msub><mml:mi mathvariant="bold-italic">ϵ</mml:mi> <mml:mrow><mml:mi mathvariant="bold-italic">t</mml:mi> <mml:mo>-</mml:mo> <mml:mn mathvariant="bold">1</mml:mn> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:mrow></mml:msub> <mml:mo>+</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">η</mml:mi> <mml:mrow><mml:mi mathvariant="bold-italic">t</mml:mi> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:mrow></mml:msub> <mml:mo>,</mml:mo> <mml:mspace width="1.em"/><mml:msub><mml:mi mathvariant="bold-italic">η</mml:mi> <mml:mrow><mml:mi mathvariant="bold-italic">t</mml:mi> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:mrow></mml:msub> <mml:mo>∼</mml:mo> <mml:mi mathvariant="bold">N</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mn mathvariant="bold">0</mml:mn> <mml:mo>,</mml:mo> <mml:msubsup><mml:mi mathvariant="bold-italic">σ</mml:mi> <mml:mrow><mml:mi mathvariant="bold-italic">k</mml:mi></mml:mrow> <mml:mn mathvariant="bold">2</mml:mn></mml:msubsup> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(10)</label></disp-formula>
where <inline-formula id="pcbi.1006299.e083"><alternatives><graphic id="pcbi.1006299.e083g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e083" xlink:type="simple"/><mml:math display="inline" id="M83"><mml:msubsup><mml:mi mathvariant="bold-italic">σ</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mn mathvariant="bold">2</mml:mn></mml:msubsup></mml:math></alternatives></inline-formula> is the variance of the “shock” (innovation), the component at each time point <bold><italic>t</italic></bold> that is independent from <bold><italic>ϵ</italic></bold><sub><bold><italic>t</italic></bold>−<bold>1</bold>,<bold><italic>k</italic></bold></sub>, and <bold><italic>ρ</italic></bold><sub><bold><italic>k</italic></bold></sub> is the autoregressive coefficient for the <bold><italic>k</italic></bold>-th voxel.</p>
<p>We assume that the covariance of the multivariate Gaussian distribution from which the activity amplitudes <bold><italic>β</italic></bold><sub><bold><italic>k</italic></bold></sub> are generated has a scaling factor that depends on its pseudo-SNR <bold><italic>s</italic></bold><sub><bold><italic>k</italic></bold></sub>:
<disp-formula id="pcbi.1006299.e084"><alternatives><graphic id="pcbi.1006299.e084g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e084" xlink:type="simple"/><mml:math display="block" id="M84"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mrow><mml:mo>·</mml:mo> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:mrow></mml:msub> <mml:mo>∼</mml:mo> <mml:mi mathvariant="bold">N</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mn mathvariant="bold">0</mml:mn> <mml:mo>,</mml:mo> <mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">s</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub> <mml:msub><mml:mi mathvariant="bold-italic">σ</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mn mathvariant="bold">2</mml:mn></mml:msup> <mml:mi mathvariant="bold">U</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(11)</label></disp-formula>
This is to reflect the fact that not all voxels in an ROI have equal SNR.</p>
<p>We further use Cholesky decomposition to parametrize the covariance structure <bold><italic>U</italic></bold>: <bold><italic>U</italic></bold> = <bold><italic>LL</italic></bold><sup><bold><italic>T</italic></bold></sup>, where <bold><italic>L</italic></bold> is a lower triangular matrix.</p>
<p>With the above assumption of the distributions of activity profiles and noise in each voxel, after marginalizing <bold><italic>β</italic></bold><sub><bold>0</bold>⋅<bold><italic>k</italic></bold></sub> and <bold><italic>β</italic></bold><sub>⋅<bold><italic>k</italic></bold></sub>, we have
<disp-formula id="pcbi.1006299.e085"><alternatives><graphic id="pcbi.1006299.e085g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e085" xlink:type="simple"/><mml:math display="block" id="M85"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:mi mathvariant="bold-italic">p</mml:mi> <mml:mo>(</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">Y</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub> <mml:mo>|</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">X</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">X</mml:mi> <mml:mn mathvariant="bold">0</mml:mn></mml:msub> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">L</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">σ</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">ρ</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">s</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub> <mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd columnalign="left"><mml:mspace width="1em"/><mml:mrow><mml:mo>=</mml:mo><mml:mo>∫</mml:mo> <mml:mo>∫</mml:mo> <mml:mi mathvariant="bold-italic">p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">Y</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub> <mml:mo>|</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mrow><mml:mo>·</mml:mo> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:mrow></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mrow><mml:mn mathvariant="bold">0</mml:mn> <mml:mo>·</mml:mo> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:mrow></mml:msub> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">X</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">X</mml:mi> <mml:mn mathvariant="bold">0</mml:mn></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">σ</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">ρ</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mi mathvariant="bold-italic">p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mrow><mml:mn mathvariant="bold">0</mml:mn> <mml:mo>·</mml:mo> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:mrow></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mi mathvariant="bold-italic">p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mrow><mml:mo>·</mml:mo> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:mrow></mml:msub> <mml:mo>|</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">s</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">σ</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">L</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mi mathvariant="bold-italic">d</mml:mi> <mml:msub><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mrow><mml:mn mathvariant="bold">0</mml:mn> <mml:mo>·</mml:mo> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:mrow></mml:msub> <mml:mi mathvariant="bold-italic">d</mml:mi> <mml:msub><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mrow><mml:mo>·</mml:mo> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd columnalign="left"><mml:mspace width="1em"/><mml:mrow><mml:mo mathvariant="bold">∝</mml:mo><mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:mn mathvariant="bold">2</mml:mn> <mml:mi mathvariant="bold-italic">π</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>-</mml:mo> <mml:mfrac><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mn mathvariant="bold">0</mml:mn></mml:msub></mml:mrow> <mml:mn mathvariant="bold">2</mml:mn></mml:mfrac></mml:mrow></mml:msup> <mml:mrow><mml:mo>|</mml:mo></mml:mrow> <mml:msubsup><mml:mo mathvariant="bold">Σ</mml:mo> <mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">ϵ</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub></mml:mrow> <mml:mrow><mml:mo>-</mml:mo> <mml:mn mathvariant="bold">1</mml:mn></mml:mrow></mml:msubsup> <mml:msup><mml:mrow><mml:mo>|</mml:mo></mml:mrow> <mml:mfrac><mml:mn mathvariant="bold">1</mml:mn> <mml:mn mathvariant="bold">2</mml:mn></mml:mfrac></mml:msup> <mml:mrow><mml:mo>|</mml:mo></mml:mrow> <mml:msubsup><mml:mi mathvariant="bold-italic">X</mml:mi> <mml:mn mathvariant="bold">0</mml:mn> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msubsup> <mml:msubsup><mml:mo mathvariant="bold">Σ</mml:mo> <mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">ϵ</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub></mml:mrow> <mml:mrow><mml:mo>-</mml:mo> <mml:mn mathvariant="bold">1</mml:mn></mml:mrow></mml:msubsup> <mml:msub><mml:mi mathvariant="bold-italic">X</mml:mi> <mml:mn mathvariant="bold">0</mml:mn></mml:msub> <mml:msup><mml:mrow><mml:mo>|</mml:mo></mml:mrow> <mml:mrow><mml:mo>-</mml:mo> <mml:mfrac><mml:mn mathvariant="bold">1</mml:mn> <mml:mn mathvariant="bold">2</mml:mn></mml:mfrac></mml:mrow></mml:msup> <mml:msup><mml:mrow><mml:mo>|</mml:mo> <mml:msubsup><mml:mo mathvariant="bold">Λ</mml:mo> <mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mo>*</mml:mo></mml:msubsup> <mml:mo>|</mml:mo></mml:mrow> <mml:mfrac><mml:mn mathvariant="bold">1</mml:mn> <mml:mn mathvariant="bold">2</mml:mn></mml:mfrac></mml:msup></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd columnalign="left"><mml:mspace width="2em"/><mml:mrow><mml:mo>·</mml:mo> <mml:mtext mathvariant="bold">exp</mml:mtext> <mml:mo>[</mml:mo> <mml:mo>-</mml:mo> <mml:mfrac><mml:mn mathvariant="bold">1</mml:mn> <mml:mn mathvariant="bold">2</mml:mn></mml:mfrac> <mml:mrow><mml:mo>(</mml:mo> <mml:mfrac><mml:mn mathvariant="bold">1</mml:mn> <mml:msubsup><mml:mi mathvariant="bold-italic">σ</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mn mathvariant="bold">2</mml:mn></mml:msubsup></mml:mfrac> <mml:msubsup><mml:mi mathvariant="bold-italic">Y</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msubsup> <mml:msubsup><mml:mi mathvariant="bold-italic">A</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mo>*</mml:mo></mml:msubsup> <mml:msub><mml:mi mathvariant="bold-italic">Y</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub> <mml:mo>-</mml:mo> <mml:msubsup><mml:mi mathvariant="bold-italic">μ</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mrow><mml:mo>*</mml:mo> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:mrow></mml:msubsup> <mml:msubsup><mml:mo mathvariant="bold">Λ</mml:mo> <mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mrow><mml:mo>*</mml:mo> <mml:mo>-</mml:mo> <mml:mn mathvariant="bold">1</mml:mn></mml:mrow></mml:msubsup> <mml:msubsup><mml:mi mathvariant="bold-italic">μ</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mo>*</mml:mo></mml:msubsup> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>]</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(12)</label></disp-formula>
In the equation above, <inline-formula id="pcbi.1006299.e086"><alternatives><graphic id="pcbi.1006299.e086g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e086" xlink:type="simple"/><mml:math display="inline" id="M86"><mml:msubsup><mml:mo mathvariant="bold">Σ</mml:mo> <mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">ϵ</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub></mml:mrow> <mml:mrow><mml:mo>-</mml:mo> <mml:mn mathvariant="bold">1</mml:mn></mml:mrow></mml:msubsup></mml:math></alternatives></inline-formula> is the temporal autocorrelation matrix of the AR(1) noise in voxel <italic>k</italic>. <inline-formula id="pcbi.1006299.e087"><alternatives><graphic id="pcbi.1006299.e087g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e087" xlink:type="simple"/><mml:math display="inline" id="M87"><mml:mrow><mml:msubsup><mml:mi mathvariant="bold-italic">A</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mo>*</mml:mo></mml:msubsup> <mml:mo>=</mml:mo> <mml:msubsup><mml:mi mathvariant="bold-italic">σ</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mn mathvariant="bold">2</mml:mn></mml:msubsup> <mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mo mathvariant="bold">Σ</mml:mo> <mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">ϵ</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub></mml:mrow> <mml:mrow><mml:mo>-</mml:mo> <mml:mn mathvariant="bold">1</mml:mn></mml:mrow></mml:msubsup> <mml:mo>-</mml:mo> <mml:msubsup><mml:mo mathvariant="bold">Σ</mml:mo> <mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">ϵ</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub></mml:mrow> <mml:mrow><mml:mo>-</mml:mo> <mml:mn mathvariant="bold">1</mml:mn></mml:mrow></mml:msubsup> <mml:msub><mml:mi mathvariant="bold-italic">X</mml:mi> <mml:mn mathvariant="bold">0</mml:mn></mml:msub> <mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mi mathvariant="bold-italic">X</mml:mi> <mml:mn mathvariant="bold">0</mml:mn> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msubsup> <mml:msubsup><mml:mo mathvariant="bold">Σ</mml:mo> <mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">ϵ</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub></mml:mrow> <mml:mrow><mml:mo>-</mml:mo> <mml:mn mathvariant="bold">1</mml:mn></mml:mrow></mml:msubsup> <mml:msub><mml:mi mathvariant="bold-italic">X</mml:mi> <mml:mn mathvariant="bold">0</mml:mn></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>-</mml:mo> <mml:mn mathvariant="bold">1</mml:mn></mml:mrow></mml:msup> <mml:msubsup><mml:mi mathvariant="bold-italic">X</mml:mi> <mml:mn mathvariant="bold">0</mml:mn> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msubsup> <mml:msubsup><mml:mo mathvariant="bold">Σ</mml:mo> <mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">ϵ</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub></mml:mrow> <mml:mrow><mml:mo>-</mml:mo> <mml:mn mathvariant="bold">1</mml:mn></mml:mrow></mml:msubsup> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">A</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">A</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub> <mml:msub><mml:mi mathvariant="bold-italic">X</mml:mi> <mml:mn mathvariant="bold">0</mml:mn></mml:msub> <mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mi mathvariant="bold-italic">X</mml:mi> <mml:mn mathvariant="bold">0</mml:mn> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msubsup> <mml:msub><mml:mi mathvariant="bold-italic">A</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub> <mml:msub><mml:mi mathvariant="bold-italic">X</mml:mi> <mml:mn mathvariant="bold">0</mml:mn></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>-</mml:mo> <mml:mn mathvariant="bold">1</mml:mn></mml:mrow></mml:msup> <mml:msubsup><mml:mi mathvariant="bold-italic">X</mml:mi> <mml:mn mathvariant="bold">0</mml:mn> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msubsup> <mml:msub><mml:mi mathvariant="bold-italic">A</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>, where <inline-formula id="pcbi.1006299.e088"><alternatives><graphic id="pcbi.1006299.e088g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e088" xlink:type="simple"/><mml:math display="inline" id="M88"><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">A</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub> <mml:mo>=</mml:mo> <mml:mi mathvariant="bold-italic">A</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">ρ</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:msubsup><mml:mi mathvariant="bold-italic">σ</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mn mathvariant="bold">2</mml:mn></mml:msubsup> <mml:msubsup><mml:mo mathvariant="bold">Σ</mml:mo> <mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">ϵ</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub></mml:mrow> <mml:mrow><mml:mo>-</mml:mo> <mml:mn mathvariant="bold">1</mml:mn></mml:mrow></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula>. <inline-formula id="pcbi.1006299.e089"><alternatives><graphic id="pcbi.1006299.e089g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e089" xlink:type="simple"/><mml:math display="inline" id="M89"><mml:mrow><mml:msubsup><mml:mo mathvariant="bold">Λ</mml:mo> <mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mo>*</mml:mo></mml:msubsup> <mml:mo>=</mml:mo> <mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:mi mathvariant="bold-italic">i</mml:mi> <mml:mo>+</mml:mo> <mml:msubsup><mml:mi mathvariant="bold-italic">s</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mn mathvariant="bold">2</mml:mn></mml:msubsup> <mml:msup><mml:mi mathvariant="bold-italic">L</mml:mi> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msup> <mml:msup><mml:mi mathvariant="bold-italic">X</mml:mi> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msup> <mml:msubsup><mml:mi mathvariant="bold-italic">A</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mo>*</mml:mo></mml:msubsup> <mml:mi mathvariant="bold-italic">X</mml:mi> <mml:mi mathvariant="bold-italic">L</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>-</mml:mo> <mml:mn mathvariant="bold">1</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1006299.e090"><alternatives><graphic id="pcbi.1006299.e090g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e090" xlink:type="simple"/><mml:math display="inline" id="M90"><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">μ</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub> <mml:mo>=</mml:mo> <mml:mfrac><mml:msub><mml:mi mathvariant="bold-italic">s</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub> <mml:msub><mml:mi mathvariant="bold-italic">σ</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub></mml:mfrac> <mml:msubsup><mml:mo mathvariant="bold">Λ</mml:mo> <mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mo>*</mml:mo></mml:msubsup> <mml:msup><mml:mi mathvariant="bold-italic">L</mml:mi> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msup> <mml:msup><mml:mi mathvariant="bold-italic">X</mml:mi> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msup> <mml:msubsup><mml:mi mathvariant="bold-italic">A</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mo>*</mml:mo></mml:msubsup> <mml:msub><mml:mi mathvariant="bold-italic">Y</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>.</p>
<p><bold><italic>σ</italic></bold><sub><bold><italic>k</italic></bold></sub> can be further analytically marginalized. <bold><italic>s</italic></bold><sub><bold><italic>k</italic></bold></sub> and <bold><italic>ρ</italic></bold><sub><bold><italic>k</italic></bold></sub> cannot be analytically marginalized. But we can numerically marginalize them by weighted sum of the likelihood at <bold><italic>n</italic></bold><sub><bold><italic>l</italic></bold></sub> × <bold><italic>n</italic></bold><sub><bold><italic>m</italic></bold></sub> discrete grids <bold>{<italic>ρ</italic></bold><sub><bold><italic>kl</italic></bold></sub>, <bold><italic>s</italic></bold><sub><bold><italic>km</italic></bold></sub><bold>}</bold> (<bold>0</bold> &lt; <bold><italic>l</italic></bold> &lt; <bold><italic>n</italic></bold><sub><bold><italic>l</italic></bold></sub>, <bold>0</bold> &lt; <bold><italic>m</italic></bold> &lt; <bold><italic>n</italic></bold><sub><bold><italic>m</italic></bold></sub>) with each grid representing one area of the parameter space of (<bold><italic>ρ</italic></bold>, <bold><italic>s</italic></bold>). The weights <bold><italic>w</italic></bold>(<bold><italic>ρ</italic></bold><sub><bold><italic>kl</italic></bold></sub>, <bold><italic>s</italic></bold><sub><bold><italic>km</italic></bold></sub>) reflect the prior probabilities of the two parameters in the area represented by <bold>{<italic>ρ</italic></bold><sub><bold><italic>kl</italic></bold></sub>, <bold><italic>s</italic></bold><sub><bold><italic>km</italic></bold></sub><bold>}</bold>. We assume uniform prior of <bold><italic>ρ</italic></bold> in (-1, 1). All the simulations in this paper used an exponential distribution as prior for <bold><italic>s</italic></bold>. Alternative forms of priors such as uniform in (0, 1), log normal distribution, and Delta distribution of fixed pseudo-SNR are also implemented in the tool. A comparison of the impact of different forms of prior assumption on BRSA’s performance is provided in <italic>Part 5 Comparison of BRSA with different assumptions of the prior of pseudo-SNR</italic> of <xref ref-type="supplementary-material" rid="pcbi.1006299.s001">S1 Material</xref>. This procedure yields the marginalized log likelihood for each voxel:
<disp-formula id="pcbi.1006299.e091"><alternatives><graphic id="pcbi.1006299.e091g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e091" xlink:type="simple"/><mml:math display="block" id="M91"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:mi mathvariant="bold-italic">p</mml:mi> <mml:mo>(</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">Y</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub> <mml:mo>|</mml:mo></mml:mrow><mml:mrow><mml:mi mathvariant="bold-italic">X</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">X</mml:mi> <mml:mn mathvariant="bold">0</mml:mn></mml:msub> <mml:mrow><mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">L</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd columnalign="left"><mml:mspace width="1em"/><mml:mrow><mml:mo>≈</mml:mo><mml:munderover><mml:mo>∑</mml:mo> <mml:mrow><mml:mi mathvariant="bold-italic">l</mml:mi> <mml:mo>=</mml:mo> <mml:mn mathvariant="bold">1</mml:mn></mml:mrow> <mml:msub><mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mi mathvariant="bold-italic">l</mml:mi></mml:msub></mml:munderover> <mml:munderover><mml:mo>∑</mml:mo> <mml:mrow><mml:mi mathvariant="bold-italic">m</mml:mi> <mml:mo>=</mml:mo> <mml:mn mathvariant="bold">1</mml:mn></mml:mrow> <mml:msub><mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mi mathvariant="bold-italic">m</mml:mi></mml:msub></mml:munderover> <mml:mi mathvariant="bold-italic">p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">Y</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub> <mml:mo>|</mml:mo> <mml:mi mathvariant="bold-italic">X</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">X</mml:mi> <mml:mn mathvariant="bold">0</mml:mn></mml:msub> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">L</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">ρ</mml:mi> <mml:mrow><mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mi mathvariant="bold-italic">l</mml:mi></mml:mrow></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">s</mml:mi> <mml:mrow><mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mi mathvariant="bold-italic">m</mml:mi></mml:mrow></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mi mathvariant="bold-italic">w</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">ρ</mml:mi> <mml:mrow><mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mi mathvariant="bold-italic">l</mml:mi></mml:mrow></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">s</mml:mi> <mml:mrow><mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mi mathvariant="bold-italic">m</mml:mi></mml:mrow></mml:msub> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd columnalign="left"><mml:mspace width="1em"/><mml:mrow><mml:mo mathvariant="bold">∝</mml:mo><mml:munderover><mml:mo>∑</mml:mo> <mml:mrow><mml:mi mathvariant="bold-italic">l</mml:mi> <mml:mo>=</mml:mo> <mml:mn mathvariant="bold">1</mml:mn></mml:mrow> <mml:msub><mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mi mathvariant="bold-italic">l</mml:mi></mml:msub></mml:munderover> <mml:munderover><mml:mo>∑</mml:mo> <mml:mrow><mml:mi mathvariant="bold-italic">m</mml:mi> <mml:mo>=</mml:mo> <mml:mn mathvariant="bold">1</mml:mn></mml:mrow> <mml:msub><mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mi mathvariant="bold-italic">m</mml:mi></mml:msub></mml:munderover> <mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:mn mathvariant="bold">2</mml:mn> <mml:mi mathvariant="bold-italic">π</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>-</mml:mo> <mml:mfrac><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mn mathvariant="bold">0</mml:mn></mml:msub></mml:mrow> <mml:mn mathvariant="bold">2</mml:mn></mml:mfrac></mml:mrow></mml:msup> <mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:mn mathvariant="bold">1</mml:mn> <mml:mo>-</mml:mo> <mml:msubsup><mml:mi mathvariant="bold-italic">ρ</mml:mi> <mml:mrow><mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mi mathvariant="bold-italic">l</mml:mi></mml:mrow> <mml:mn mathvariant="bold">2</mml:mn></mml:msubsup> <mml:mo>)</mml:mo></mml:mrow> <mml:mfrac><mml:msub><mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mi mathvariant="bold-italic">r</mml:mi></mml:msub> <mml:mn mathvariant="bold">2</mml:mn></mml:mfrac></mml:msup> <mml:mrow><mml:mo>|</mml:mo></mml:mrow> <mml:msubsup><mml:mi mathvariant="bold-italic">X</mml:mi> <mml:mn mathvariant="bold">0</mml:mn> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msubsup> <mml:msub><mml:mi mathvariant="bold-italic">A</mml:mi> <mml:mrow><mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mi mathvariant="bold-italic">l</mml:mi></mml:mrow></mml:msub> <mml:msub><mml:mi mathvariant="bold-italic">X</mml:mi> <mml:mn mathvariant="bold">0</mml:mn></mml:msub> <mml:msup><mml:mrow><mml:mo>|</mml:mo></mml:mrow> <mml:mrow><mml:mo>-</mml:mo> <mml:mfrac><mml:mn mathvariant="bold">1</mml:mn> <mml:mn mathvariant="bold">2</mml:mn></mml:mfrac></mml:mrow></mml:msup> <mml:msup><mml:mrow><mml:mo>|</mml:mo> <mml:msubsup><mml:mo mathvariant="bold">Λ</mml:mo> <mml:mrow><mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mi mathvariant="bold-italic">l</mml:mi> <mml:mi mathvariant="bold-italic">m</mml:mi></mml:mrow> <mml:mo>*</mml:mo></mml:msubsup> <mml:mo>|</mml:mo></mml:mrow> <mml:mfrac><mml:mn mathvariant="bold">1</mml:mn> <mml:mn mathvariant="bold">2</mml:mn></mml:mfrac></mml:msup> <mml:mo mathvariant="bold">Γ</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:mfrac><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mn mathvariant="bold">0</mml:mn></mml:msub></mml:mrow> <mml:mn mathvariant="bold">2</mml:mn></mml:mfrac> <mml:mo>-</mml:mo> <mml:mn mathvariant="bold">1</mml:mn> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd columnalign="left"><mml:mspace width="2em"/><mml:mrow><mml:mo>·</mml:mo> <mml:msup><mml:mrow><mml:mo>[</mml:mo> <mml:mfrac><mml:mrow><mml:msubsup><mml:mi mathvariant="bold-italic">Y</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msubsup> <mml:msubsup><mml:mi mathvariant="bold-italic">A</mml:mi> <mml:mrow><mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mi mathvariant="bold-italic">l</mml:mi></mml:mrow> <mml:mo>*</mml:mo></mml:msubsup> <mml:msub><mml:mi mathvariant="bold-italic">Y</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub> <mml:mo>-</mml:mo> <mml:msubsup><mml:mi mathvariant="bold-italic">s</mml:mi> <mml:mrow><mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mi mathvariant="bold-italic">m</mml:mi></mml:mrow> <mml:mn mathvariant="bold">2</mml:mn></mml:msubsup> <mml:msubsup><mml:mi mathvariant="bold-italic">Y</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msubsup> <mml:msubsup><mml:mi mathvariant="bold-italic">A</mml:mi> <mml:mrow><mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mi mathvariant="bold-italic">l</mml:mi></mml:mrow> <mml:mo>*</mml:mo></mml:msubsup> <mml:mi mathvariant="bold-italic">X</mml:mi> <mml:mi mathvariant="bold-italic">L</mml:mi> <mml:msubsup><mml:mo mathvariant="bold">Λ</mml:mo> <mml:mrow><mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mi mathvariant="bold-italic">l</mml:mi> <mml:mi mathvariant="bold-italic">m</mml:mi></mml:mrow> <mml:mo>*</mml:mo></mml:msubsup> <mml:msup><mml:mi mathvariant="bold-italic">L</mml:mi> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msup> <mml:msup><mml:mi mathvariant="bold-italic">X</mml:mi> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msup> <mml:msubsup><mml:mi mathvariant="bold-italic">A</mml:mi> <mml:mrow><mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mi mathvariant="bold-italic">l</mml:mi></mml:mrow> <mml:mo>*</mml:mo></mml:msubsup> <mml:msub><mml:mi mathvariant="bold-italic">Y</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub></mml:mrow> <mml:mn mathvariant="bold">2</mml:mn></mml:mfrac> <mml:mo>]</mml:mo></mml:mrow> <mml:mrow><mml:mn mathvariant="bold">1</mml:mn> <mml:mo>-</mml:mo> <mml:mfrac><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mn mathvariant="bold">0</mml:mn></mml:msub></mml:mrow> <mml:mn mathvariant="bold">2</mml:mn></mml:mfrac></mml:mrow></mml:msup> <mml:mi mathvariant="bold-italic">w</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">ρ</mml:mi> <mml:mrow><mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mi mathvariant="bold-italic">l</mml:mi></mml:mrow></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">s</mml:mi> <mml:mrow><mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mi mathvariant="bold-italic">m</mml:mi></mml:mrow></mml:msub> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(13)</label></disp-formula>
where <inline-formula id="pcbi.1006299.e092"><alternatives><graphic id="pcbi.1006299.e092g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e092" xlink:type="simple"/><mml:math display="inline" id="M92"><mml:msubsup><mml:mi mathvariant="bold-italic">A</mml:mi> <mml:mrow><mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mi mathvariant="bold-italic">l</mml:mi></mml:mrow> <mml:mo>*</mml:mo></mml:msubsup></mml:math></alternatives></inline-formula> is <inline-formula id="pcbi.1006299.e093"><alternatives><graphic id="pcbi.1006299.e093g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e093" xlink:type="simple"/><mml:math display="inline" id="M93"><mml:msubsup><mml:mi mathvariant="bold-italic">A</mml:mi> <mml:mrow><mml:mi mathvariant="bold-italic">k</mml:mi></mml:mrow> <mml:mo>*</mml:mo></mml:msubsup></mml:math></alternatives></inline-formula> assessed at parameter grid <bold><italic>ρ</italic></bold><sub><bold><italic>kl</italic></bold></sub>, <inline-formula id="pcbi.1006299.e094"><alternatives><graphic id="pcbi.1006299.e094g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e094" xlink:type="simple"/><mml:math display="inline" id="M94"><mml:msubsup><mml:mo mathvariant="bold">Λ</mml:mo> <mml:mrow><mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mi mathvariant="bold-italic">l</mml:mi> <mml:mi mathvariant="bold-italic">m</mml:mi></mml:mrow> <mml:mo>*</mml:mo></mml:msubsup></mml:math></alternatives></inline-formula> is <inline-formula id="pcbi.1006299.e095"><alternatives><graphic id="pcbi.1006299.e095g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e095" xlink:type="simple"/><mml:math display="inline" id="M95"><mml:msubsup><mml:mo mathvariant="bold">Λ</mml:mo> <mml:mrow><mml:mi mathvariant="bold-italic">k</mml:mi></mml:mrow> <mml:mo>*</mml:mo></mml:msubsup></mml:math></alternatives></inline-formula> assessed at grid <bold>{<italic>ρ</italic></bold><sub><bold><italic>kl</italic></bold></sub>, <bold><italic>s</italic></bold><sub><bold><italic>km</italic></bold></sub><bold>}</bold>.</p>
<p>Because we made the assumption that <bold><italic>ϵ</italic></bold><sub><bold><italic>k</italic></bold></sub> is independent across voxels, the log likelihood for all data is the sum of the log likelihood for each voxel.
<disp-formula id="pcbi.1006299.e096"><alternatives><graphic id="pcbi.1006299.e096g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e096" xlink:type="simple"/><mml:math display="block" id="M96"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mtext mathvariant="bold">log</mml:mtext><mml:mspace width="4pt"/><mml:mi mathvariant="bold-italic">p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi mathvariant="bold-italic">Y</mml:mi> <mml:mo>|</mml:mo> <mml:mi mathvariant="bold-italic">X</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">X</mml:mi> <mml:mn mathvariant="bold">0</mml:mn></mml:msub> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">L</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:munderover><mml:mo>∑</mml:mo> <mml:mrow><mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mo>=</mml:mo> <mml:mn mathvariant="bold">1</mml:mn></mml:mrow> <mml:msub><mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mi mathvariant="bold-italic">V</mml:mi></mml:msub></mml:munderover> <mml:mtext mathvariant="bold">log</mml:mtext><mml:mspace width="4pt"/><mml:mi mathvariant="bold-italic">p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">Y</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub> <mml:mo>|</mml:mo> <mml:mi mathvariant="bold-italic">X</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">X</mml:mi> <mml:mn mathvariant="bold">0</mml:mn></mml:msub> <mml:mo>,</mml:mo> <mml:mi mathvariant="bold-italic">L</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(14)</label></disp-formula></p>
<p>For the null model, the likelihood for each voxel after marginalizing <bold><italic>β</italic></bold><sub><bold>0 · <italic>k</italic></bold></sub> and <inline-formula id="pcbi.1006299.e097"><alternatives><graphic id="pcbi.1006299.e097g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e097" xlink:type="simple"/><mml:math display="inline" id="M97"><mml:msubsup><mml:mi mathvariant="bold-italic">σ</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mn mathvariant="bold">2</mml:mn></mml:msubsup></mml:math></alternatives></inline-formula> can be similarly derived,
<disp-formula id="pcbi.1006299.e098"><alternatives><graphic id="pcbi.1006299.e098g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e098" xlink:type="simple"/><mml:math display="block" id="M98"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:mi mathvariant="bold-italic">p</mml:mi> <mml:mo>(</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">Y</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub></mml:mrow><mml:mrow><mml:mrow><mml:mo>|</mml:mo></mml:mrow> <mml:msub><mml:mi mathvariant="bold-italic">X</mml:mi> <mml:mn mathvariant="bold">0</mml:mn></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">ρ</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub> <mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd columnalign="right"><mml:mo mathvariant="bold">∝</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:mn mathvariant="bold">2</mml:mn> <mml:mi mathvariant="bold-italic">π</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>-</mml:mo> <mml:mfrac><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mn mathvariant="bold">0</mml:mn></mml:msub></mml:mrow> <mml:mn mathvariant="bold">2</mml:mn></mml:mfrac></mml:mrow></mml:msup> <mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:mn mathvariant="bold">1</mml:mn> <mml:mo>-</mml:mo> <mml:msubsup><mml:mi mathvariant="bold-italic">ρ</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mn mathvariant="bold">2</mml:mn></mml:msubsup> <mml:mo>)</mml:mo></mml:mrow> <mml:mfrac><mml:msub><mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mi mathvariant="bold-italic">r</mml:mi></mml:msub> <mml:mn mathvariant="bold">2</mml:mn></mml:mfrac></mml:msup> <mml:msup><mml:mrow><mml:mo>|</mml:mo> <mml:msubsup><mml:mi mathvariant="bold-italic">X</mml:mi> <mml:mn mathvariant="bold">0</mml:mn> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msubsup> <mml:msub><mml:mi mathvariant="bold-italic">A</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub> <mml:msub><mml:mi mathvariant="bold-italic">X</mml:mi> <mml:mn mathvariant="bold">0</mml:mn></mml:msub> <mml:mo>|</mml:mo></mml:mrow> <mml:mrow><mml:mo>-</mml:mo> <mml:mfrac><mml:mn mathvariant="bold">1</mml:mn> <mml:mn mathvariant="bold">2</mml:mn></mml:mfrac></mml:mrow></mml:msup></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mo>·</mml:mo> <mml:mo mathvariant="bold">Γ</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:mfrac><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mn mathvariant="bold">0</mml:mn></mml:msub></mml:mrow> <mml:mn mathvariant="bold">2</mml:mn></mml:mfrac> <mml:mo>-</mml:mo> <mml:mn mathvariant="bold">1</mml:mn> <mml:mo>)</mml:mo></mml:mrow> <mml:msup><mml:mrow><mml:mo>[</mml:mo> <mml:mfrac><mml:mrow><mml:msubsup><mml:mi mathvariant="bold-italic">Y</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msubsup> <mml:msubsup><mml:mi mathvariant="bold-italic">A</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi> <mml:mo>*</mml:mo></mml:msubsup> <mml:msub><mml:mi mathvariant="bold-italic">Y</mml:mi> <mml:mi mathvariant="bold-italic">k</mml:mi></mml:msub></mml:mrow> <mml:mn mathvariant="bold">2</mml:mn></mml:mfrac> <mml:mo>]</mml:mo></mml:mrow> <mml:mrow><mml:mn mathvariant="bold">1</mml:mn> <mml:mo>-</mml:mo> <mml:mfrac><mml:mrow><mml:msub><mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mi mathvariant="bold-italic">T</mml:mi></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mi mathvariant="bold-italic">n</mml:mi> <mml:mn mathvariant="bold">0</mml:mn></mml:msub></mml:mrow> <mml:mn mathvariant="bold">2</mml:mn></mml:mfrac></mml:mrow></mml:msup></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(15)</label></disp-formula>
and the total log likelihood can be calculated similarly by numerically marginalizing <bold><italic>ρ</italic></bold><sub><bold><italic>k</italic></bold></sub> and summing the log likelihood for all voxels.</p>
</sec>
<sec id="sec015">
<title>Data processing and analysis</title>
<p>Data used in <xref ref-type="fig" rid="pcbi.1006299.g001">Fig 1B</xref> are from the experiments of Schuck et al. [<xref ref-type="bibr" rid="pcbi.1006299.ref024">24</xref>], following the same preprocessing procedure as the original study. The fMRI data were acquired at TR = 2.4s. Data of 24 participants were used. Their design matrices were used for all the following analyses and simulations. Data in Figs <xref ref-type="fig" rid="pcbi.1006299.g001">1E, 1G</xref> and <xref ref-type="fig" rid="pcbi.1006299.g003">3</xref> were preprocessed data obtained from Human Connectome Project (HCP) [<xref ref-type="bibr" rid="pcbi.1006299.ref037">37</xref>]. The first 24 participants who have completed all 3T protocols and whose data were acquired in quarter 8 of the HCP acquiring period without image quality issues were selected for analysis in <xref ref-type="fig" rid="pcbi.1006299.g003">Fig 3</xref>. Data from 864 participants without image quality issues in HCP were used in the analysis in <xref ref-type="fig" rid="pcbi.1006299.g005">Fig 5</xref>. Each participants in the HCP data have 2 runs of resting state data with left-right phase encoding direction and 2 runs with right-left phase encoding direction. Denoising pipeline ICA-AROMA [<xref ref-type="bibr" rid="pcbi.1006299.ref055">55</xref>] with default parameters was performed on each run of data. The time series of the aggressively denoised data were resampled at the same TR as the design matrix and truncated to the length of each run in that design matrix before further analysis (all results were similar without ICA-AROMA denoising). Each run contained 182 ± 12 time points.</p>
<p><inline-formula id="pcbi.1006299.e099"><alternatives><graphic id="pcbi.1006299.e099g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e099" xlink:type="simple"/><mml:math display="inline" id="M99"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi><mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> point estimates in <xref ref-type="fig" rid="pcbi.1006299.g001">Fig 1</xref> were obtained with AFNI’s <italic>3ddeconvolve</italic> [<xref ref-type="bibr" rid="pcbi.1006299.ref056">56</xref>]. The design matrices were set up by convolving the stereotypical double-Gamma HRF in SPM [<xref ref-type="bibr" rid="pcbi.1006299.ref057">57</xref>] with event time courses composed with impulses lasting for the duration of the participants’ reaction time. AR(1) coefficients in <xref ref-type="fig" rid="pcbi.1006299.g001">Fig 1G</xref> were estimated after upsampling the fMRI time series in the HCP data to the TR in Schuck et al. [<xref ref-type="bibr" rid="pcbi.1006299.ref024">24</xref>] and linear detrending. Upsampling is to reflect the lower temporal resolution more typically employed in task-related fMRI studies.</p>
<p>In the experiments of <xref ref-type="fig" rid="pcbi.1006299.g003">Fig 3</xref>, lateral occipital cortex was chosen as the ROI, which included 4802 ± 31 (mean ± standard deviation) voxels. Task related signals were only added to voxels within a bounding box (<xref ref-type="fig" rid="pcbi.1006299.g003">Fig 3C</xref>) of which the coordinates satisfy 25 &lt; <bold><italic>x</italic></bold> &lt; 35, -95&lt; <bold><italic>y</italic></bold> &lt; −5 and -15&lt; <bold><italic>z</italic></bold> &lt;5. 181.9±0.3 voxels fell within this bounding box. To generate activity patterns at different SNR, <bold><italic>β</italic></bold> were sampled independently from a multivarite Gaussian distribution with the covariance matrix in <xref ref-type="fig" rid="pcbi.1006299.g003">Fig 3A</xref> for each voxel within the bounding box mentioned above (resting state data from HCP), and were scaled by one values in 1, 2, 4, 8 times the standard deviation of the detrended noise in that voxel. The design matrix <bold><italic>X</italic></bold> mentioned above were then multiplied with <bold><italic>β</italic></bold> for each voxel and added to the noise. Different random seeds were used in the simulation for different subjects, different SNR levels and different amounts of simulated data. But the same simulated data were used across different RSA analysis methods. Due to the small magnitude of the design matrix, the resulting ratios of the standard deviation of the simulated signals <bold><italic>Xβ</italic></bold><sub>⋅<bold><italic>k</italic></bold></sub> to that of the detrended noise were on average 0.14, 0.27, 0.54 and 1.08 within the bounding box (<xref ref-type="fig" rid="pcbi.1006299.g003">Fig 3C</xref>). To estimate the similarity matrix of this task involving 16 conditions, the fitting time on an Intel Xeon processor employing 12 CPUs is 751±105 s, 1274±414 s and 2206±564 s, for data of 1 run, 2 runs and 4 runs, respectively. This suggests that our method is practically feasible even for relatively large ROIs. To evaluate the performance of the recovered correlation structure by different methods, the off-diagonal elements of the similarity matrix recovered from data of each simulated participant was correlated with those elements of the ideal similarity matrix to yield the top panel of <xref ref-type="fig" rid="pcbi.1006299.g003">Fig 3I</xref>. The top panel reflects the correlation of individual results. The bottom panel reflects the correlation of average results over simulated participants.</p>
<p>In order to make fair comparison with BRSA which considers temporal auto-correlation in noise, all the point estimates of <inline-formula id="pcbi.1006299.e100"><alternatives><graphic id="pcbi.1006299.e100g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e100" xlink:type="simple"/><mml:math display="inline" id="M100"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> by other methods in <xref ref-type="fig" rid="pcbi.1006299.g003">Fig 3</xref> were performed with restricted maximum likelihood estimation, which model the auto-correlation in noise. AR(1) parameters of each voxel were estimated after initial regular regression. The AR(1) parameters were used to re-compute the temporal noise covariance matrices for each voxel and <inline-formula id="pcbi.1006299.e101"><alternatives><graphic id="pcbi.1006299.e101g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e101" xlink:type="simple"/><mml:math display="inline" id="M101"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> were calculated again assuming these noise covariance matrices. To account for task-irrelevant time courses in the data, extra nuisance regressors were included in all methods based on point estimates of activity patterns. These included Legendre polynomial functions of volume index, up to the fourth order, to model slow drift of fMRI signals, and the first three principal components of the fMRI data in each of white matter and ventricles, to capture intrinsic fluctuations. The principal components were also included as nuisance regressors for BRSA. When spatial whitening of <inline-formula id="pcbi.1006299.e102"><alternatives><graphic id="pcbi.1006299.e102g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e102" xlink:type="simple"/><mml:math display="inline" id="M102"><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> was performed, residuals of fitting from all runs of data from the same simulated subject were concatenated in time. One covariance matrix <bold>Σ</bold><sub><bold><italic>spatial</italic></bold></sub> across voxels was then estimated from these residuals using the optimal shrinkage method [<xref ref-type="bibr" rid="pcbi.1006299.ref033">33</xref>] implemented in scikit-learn [<xref ref-type="bibr" rid="pcbi.1006299.ref058">58</xref>]. This covariance matrix was then used to whiten the estimated pattern of all the runs. That is, <inline-formula id="pcbi.1006299.e103"><alternatives><graphic id="pcbi.1006299.e103g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e103" xlink:type="simple"/><mml:math display="inline" id="M103"><mml:mrow><mml:mover accent="true"><mml:mi mathvariant="bold-italic">β</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:msubsup><mml:mo mathvariant="bold">Σ</mml:mo> <mml:mrow><mml:mi mathvariant="bold-italic">s</mml:mi> <mml:mi mathvariant="bold-italic">p</mml:mi> <mml:mi mathvariant="bold-italic">a</mml:mi> <mml:mi mathvariant="bold-italic">t</mml:mi> <mml:mi mathvariant="bold-italic">i</mml:mi> <mml:mi mathvariant="bold-italic">a</mml:mi> <mml:mi mathvariant="bold-italic">l</mml:mi></mml:mrow> <mml:mrow><mml:mo>-</mml:mo> <mml:mfrac><mml:mn mathvariant="bold">1</mml:mn> <mml:mn mathvariant="bold">2</mml:mn></mml:mfrac></mml:mrow></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula> of each run were treated as the spatially whitened pattern estimates. When performing within-run RSA, the estimated patterns of each run (being spatially whitened or not) were averaged over the simulated runs before subjecting to a Pearson correlation. When performing cross-run RSA, the correlations were calculated between the estimated patterns corresponding to any two conditions from two different runs. This calculation was repeated for each combination of two runs in the data. And finally all the correlation coefficients between the two conditions calculated over all pairs of runs were averaged (e.g., 12 cross-run similarity matrix would be calculated from 4 runs of data and averaged to generate one matrix).</p>
<p>To simulate the fMRI noise in <xref ref-type="fig" rid="pcbi.1006299.g004">Fig 4</xref>, we first estimated the number of principal components to describe the spatial noise correlation in the 24 resting state fMRI data from HCP database using the algoritm of Gavish and Donoho [<xref ref-type="bibr" rid="pcbi.1006299.ref035">35</xref>]. The spatial patterns of these principal components were kept fixed as the modulation magnitude <bold><italic>β</italic></bold><sub><bold>0</bold></sub> by the intrinsic fluctuation. AR(1) parameters for each voxel’s spatially indepndent noise were estimated from the residuals after subtrating these principal components. For each simulated subject, time courses of intrinsic flucutations were newly simulated by scrambling the phase of the Fourier transformation of the <bold><italic>X</italic></bold><sub><bold>0</bold></sub> estimated from the real data, thus preserving the amplitudes of their frequency spectrum. AR(1) noise were then added to each voxel with the same parameters as estimated from the real data. To speed up the simulation, only 200 random voxels from the ROI in <xref ref-type="fig" rid="pcbi.1006299.g003">Fig 3B</xref> were kept for each participant in these simulations. Among them, 100 random voxels were added with simulated task-related signals. Thus, each simulated participant has different spatial patterns of <bold><italic>β</italic></bold><sub><bold>0</bold></sub> due to the random selection of voxels. 500 simulated datasets were generated based on the real data of each participant, for each of the three SNR levels. In total 36000 subjects were simulated. The simulated pool of subjects were sub-divided into bins with a fixed number of simulated subjects ranging from 24 to 1200. The mean and standard deviation of the correlation between the true similarity matrix and the average similarity matrix based on the subjects in each bin were calculated, and plotted in <xref ref-type="fig" rid="pcbi.1006299.g004">Fig 4A</xref>.</p>
<p>All SNRs in Figs <xref ref-type="fig" rid="pcbi.1006299.g003">3</xref> and <xref ref-type="fig" rid="pcbi.1006299.g004">4</xref> were calculated post hoc, using the standard deviation of the added signals in the bounding box region devided by the standard deviation of the noise in each voxel, and averaged across voxels and simulated subjects for each level of simulation.</p>
</sec>
</sec>
<sec id="sec016">
<title>Supporting information</title>
<supplementary-material id="pcbi.1006299.s001" mimetype="application/pdf" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1006299.s001" xlink:type="simple">
<label>S1 Material</label>
<caption>
<title>Supplementary materials.</title>
<p>Part 1: Details of the generative model of Bayesian RSA. Part 2: Model fitting procedure. Part 3: Model selection and decoding task-related signals. Part 4: Performance of all methods when all voxels have task-related signals. Part 5: Comparison of BRSA with different assumptions of the prior of pseudo-SNR. Part 6: The effect of the number of nuisance regressors in BRSA performance. Part 7: Cross-validation with less stringent criterion.</p>
<p>(PDF)</p>
</caption>
</supplementary-material>
</sec>
</body>
<back>
<ack>
<p>We are grateful for the suggestions and comments by Michael Shvartsman, Cameron Po-Hsuan Chen, Michael J. Anderson and Nathaniel Daw. Resting state fMRI data used in several experiments were obtained from the MGH-USC Human Connectome Project (HCP) database.</p>
</ack>
<ref-list>
<title>References</title>
<ref id="pcbi.1006299.ref001">
<label>1</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Ogawa</surname> <given-names>S</given-names></name>, <name name-style="western"><surname>Lee</surname> <given-names>TM</given-names></name>, <name name-style="western"><surname>Kay</surname> <given-names>AR</given-names></name>, <name name-style="western"><surname>Tank</surname> <given-names>DW</given-names></name>. <article-title>Brain magnetic resonance imaging with contrast dependent on blood oxygenation</article-title>. <source>Proceedings of the National Academy of Sciences</source>. <year>1990</year>;<volume>87</volume>(<issue>24</issue>):<fpage>9868</fpage>–<lpage>9872</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1073/pnas.87.24.9868" xlink:type="simple">10.1073/pnas.87.24.9868</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref002">
<label>2</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Boynton</surname> <given-names>GM</given-names></name>, <name name-style="western"><surname>Engel</surname> <given-names>SA</given-names></name>, <name name-style="western"><surname>Glover</surname> <given-names>GH</given-names></name>, <name name-style="western"><surname>Heeger</surname> <given-names>DJ</given-names></name>. <article-title>Linear systems analysis of functional magnetic resonance imaging in human V1</article-title>. <source>Journal of Neuroscience</source>. <year>1996</year>;<volume>16</volume>(<issue>13</issue>):<fpage>4207</fpage>–<lpage>4221</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1523/JNEUROSCI.16-13-04207.1996" xlink:type="simple">10.1523/JNEUROSCI.16-13-04207.1996</ext-link></comment> <object-id pub-id-type="pmid">8753882</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref003">
<label>3</label>
<mixed-citation publication-type="book" xlink:type="simple">
<name name-style="western"><surname>Jazzard</surname> <given-names>P</given-names></name>, <name name-style="western"><surname>Matthews</surname> <given-names>P</given-names></name>, <name name-style="western"><surname>Smith</surname> <given-names>S</given-names></name>. <source>Functional magnetic resonance imaging: An introduction to methods</source>. <publisher-name>Oxford Univ. Press</publisher-name>, <fpage>404</fpage> pp; <year>2003</year>.</mixed-citation>
</ref>
<ref id="pcbi.1006299.ref004">
<label>4</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Uğurbil</surname> <given-names>K</given-names></name>, <name name-style="western"><surname>Xu</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Auerbach</surname> <given-names>EJ</given-names></name>, <name name-style="western"><surname>Moeller</surname> <given-names>S</given-names></name>, <name name-style="western"><surname>Vu</surname> <given-names>AT</given-names></name>, <name name-style="western"><surname>Duarte-Carvajalino</surname> <given-names>JM</given-names></name>, <etal>et al</etal>. <article-title>Pushing spatial and temporal resolution for functional and diffusion MRI in the Human Connectome Project</article-title>. <source>Neuroimage</source>. <year>2013</year>;<volume>80</volume>:<fpage>80</fpage>–<lpage>104</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.neuroimage.2013.05.012" xlink:type="simple">10.1016/j.neuroimage.2013.05.012</ext-link></comment> <object-id pub-id-type="pmid">23702417</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref005">
<label>5</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Cabeza</surname> <given-names>R</given-names></name>, <name name-style="western"><surname>Nyberg</surname> <given-names>L</given-names></name>. <article-title>Imaging cognition II: An empirical review of 275 PET and fMRI studies</article-title>. <source>Journal of cognitive neuroscience</source>. <year>2000</year>;<volume>12</volume>(<issue>1</issue>):<fpage>1</fpage>–<lpage>47</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1162/08989290051137585" xlink:type="simple">10.1162/08989290051137585</ext-link></comment> <object-id pub-id-type="pmid">10769304</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref006">
<label>6</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Haxby</surname> <given-names>JV</given-names></name>. <article-title>Multivariate pattern analysis of fMRI: the early beginnings</article-title>. <source>Neuroimage</source>. <year>2012</year>;<volume>62</volume>(<issue>2</issue>):<fpage>852</fpage>–<lpage>855</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.neuroimage.2012.03.016" xlink:type="simple">10.1016/j.neuroimage.2012.03.016</ext-link></comment> <object-id pub-id-type="pmid">22425670</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref007">
<label>7</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Haxby</surname> <given-names>JV</given-names></name>, <name name-style="western"><surname>Connolly</surname> <given-names>AC</given-names></name>, <name name-style="western"><surname>Guntupalli</surname> <given-names>JS</given-names></name>. <article-title>Decoding neural representational spaces using multivariate pattern analysis</article-title>. <source>Annual review of neuroscience</source>. <year>2014</year>;<volume>37</volume>:<fpage>435</fpage>–<lpage>456</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1146/annurev-neuro-062012-170325" xlink:type="simple">10.1146/annurev-neuro-062012-170325</ext-link></comment> <object-id pub-id-type="pmid">25002277</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref008">
<label>8</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Kriegeskorte</surname> <given-names>N</given-names></name>, <name name-style="western"><surname>Mur</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Bandettini</surname> <given-names>PA</given-names></name>. <article-title>Representational similarity analysis-connecting the branches of systems neuroscience</article-title>. <source>Frontiers in systems neuroscience</source>. <year>2008</year>;<volume>2</volume>:<fpage>4</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.3389/neuro.06.004.2008" xlink:type="simple">10.3389/neuro.06.004.2008</ext-link></comment> <object-id pub-id-type="pmid">19104670</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref009">
<label>9</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Naselaris</surname> <given-names>T</given-names></name>, <name name-style="western"><surname>Kay</surname> <given-names>KN</given-names></name>, <name name-style="western"><surname>Nishimoto</surname> <given-names>S</given-names></name>, <name name-style="western"><surname>Gallant</surname> <given-names>JL</given-names></name>. <article-title>Encoding and decoding in fMRI</article-title>. <source>Neuroimage</source>. <year>2011</year>;<volume>56</volume>(<issue>2</issue>):<fpage>400</fpage>–<lpage>410</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.neuroimage.2010.07.073" xlink:type="simple">10.1016/j.neuroimage.2010.07.073</ext-link></comment> <object-id pub-id-type="pmid">20691790</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref010">
<label>10</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Diedrichsen</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Ridgway</surname> <given-names>GR</given-names></name>, <name name-style="western"><surname>Friston</surname> <given-names>KJ</given-names></name>, <name name-style="western"><surname>Wiestler</surname> <given-names>T</given-names></name>. <article-title>Comparing the similarity and spatial structure of neural representations: a pattern-component model</article-title>. <source>Neuroimage</source>. <year>2011</year>;<volume>55</volume>(<issue>4</issue>):<fpage>1665</fpage>–<lpage>1678</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.neuroimage.2011.01.044" xlink:type="simple">10.1016/j.neuroimage.2011.01.044</ext-link></comment> <object-id pub-id-type="pmid">21256225</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref011">
<label>11</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Diedrichsen</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Kriegeskorte</surname> <given-names>N</given-names></name>. <article-title>Representational models: A common framework for understanding encoding, pattern-component, and representational-similarity analysis</article-title>. <source>PLoS computational biology</source>. <year>2017</year>;<volume>13</volume>(<issue>4</issue>):<fpage>e1005508</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1371/journal.pcbi.1005508" xlink:type="simple">10.1371/journal.pcbi.1005508</ext-link></comment> <object-id pub-id-type="pmid">28437426</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref012">
<label>12</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Xue</surname> <given-names>G</given-names></name>, <name name-style="western"><surname>Dong</surname> <given-names>Q</given-names></name>, <name name-style="western"><surname>Chen</surname> <given-names>C</given-names></name>, <name name-style="western"><surname>Lu</surname> <given-names>Z</given-names></name>, <name name-style="western"><surname>Mumford</surname> <given-names>JA</given-names></name>, <name name-style="western"><surname>Poldrack</surname> <given-names>RA</given-names></name>. <article-title>Greater neural pattern similarity across repetitions is associated with better memory</article-title>. <source>Science</source>. <year>2010</year>;<volume>330</volume>(<issue>6000</issue>):<fpage>97</fpage>–<lpage>101</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1126/science.1193125" xlink:type="simple">10.1126/science.1193125</ext-link></comment> <object-id pub-id-type="pmid">20829453</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref013">
<label>13</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Ritchey</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Wing</surname> <given-names>EA</given-names></name>, <name name-style="western"><surname>LaBar</surname> <given-names>KS</given-names></name>, <name name-style="western"><surname>Cabeza</surname> <given-names>R</given-names></name>. <article-title>Neural similarity between encoding and retrieval is related to memory via hippocampal interactions</article-title>. <source>Cerebral Cortex</source>. <year>2012</year>; p. bhs258. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1093/cercor/bhs258" xlink:type="simple">10.1093/cercor/bhs258</ext-link></comment> <object-id pub-id-type="pmid">22967731</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref014">
<label>14</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Kriegeskorte</surname> <given-names>N</given-names></name>, <name name-style="western"><surname>Mur</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Ruff</surname> <given-names>DA</given-names></name>, <name name-style="western"><surname>Kiani</surname> <given-names>R</given-names></name>, <name name-style="western"><surname>Bodurka</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Esteky</surname> <given-names>H</given-names></name>, <etal>et al</etal>. <article-title>Matching categorical object representations in inferior temporal cortex of man and monkey</article-title>. <source>Neuron</source>. <year>2008</year>;<volume>60</volume>(<issue>6</issue>):<fpage>1126</fpage>–<lpage>1141</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.neuron.2008.10.043" xlink:type="simple">10.1016/j.neuron.2008.10.043</ext-link></comment> <object-id pub-id-type="pmid">19109916</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref015">
<label>15</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Connolly</surname> <given-names>AC</given-names></name>, <name name-style="western"><surname>Guntupalli</surname> <given-names>JS</given-names></name>, <name name-style="western"><surname>Gors</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Hanke</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Halchenko</surname> <given-names>YO</given-names></name>, <name name-style="western"><surname>Wu</surname> <given-names>YC</given-names></name>, <etal>et al</etal>. <article-title>The representation of biological classes in the human brain</article-title>. <source>The Journal of Neuroscience</source>. <year>2012</year>;<volume>32</volume>(<issue>8</issue>):<fpage>2608</fpage>–<lpage>2618</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1523/JNEUROSCI.5547-11.2012" xlink:type="simple">10.1523/JNEUROSCI.5547-11.2012</ext-link></comment> <object-id pub-id-type="pmid">22357845</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref016">
<label>16</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Iordan</surname> <given-names>MC</given-names></name>, <name name-style="western"><surname>Greene</surname> <given-names>MR</given-names></name>, <name name-style="western"><surname>Beck</surname> <given-names>DM</given-names></name>, <name name-style="western"><surname>Fei-Fei</surname> <given-names>L</given-names></name>. <article-title>Basic level category structure emerges gradually across human ventral visual cortex</article-title>. <source>Journal of cognitive neuroscience</source>. <year>2015</year>;. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1162/jocn_a_00790" xlink:type="simple">10.1162/jocn_a_00790</ext-link></comment> <object-id pub-id-type="pmid">25811711</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref017">
<label>17</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Henriksson</surname> <given-names>L</given-names></name>, <name name-style="western"><surname>Khaligh-Razavi</surname> <given-names>SM</given-names></name>, <name name-style="western"><surname>Kay</surname> <given-names>K</given-names></name>, <name name-style="western"><surname>Kriegeskorte</surname> <given-names>N</given-names></name>. <article-title>Visual representations are dominated by intrinsic fluctuations correlated between areas</article-title>. <source>NeuroImage</source>. <year>2015</year>;<volume>114</volume>:<fpage>275</fpage>–<lpage>286</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.neuroimage.2015.04.026" xlink:type="simple">10.1016/j.neuroimage.2015.04.026</ext-link></comment> <object-id pub-id-type="pmid">25896934</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref018">
<label>18</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Alink</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Walther</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Krugliak</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>van den Bosch</surname> <given-names>JJ</given-names></name>, <name name-style="western"><surname>Kriegeskorte</surname> <given-names>N</given-names></name>. <article-title>Mind the drift-improving sensitivity to fMRI pattern information by accounting for temporal pattern drift</article-title>. <source>bioRxiv</source>. <year>2015</year>; p. 032391.</mixed-citation>
</ref>
<ref id="pcbi.1006299.ref019">
<label>19</label>
<mixed-citation publication-type="other" xlink:type="simple">Diedrichsen J, Provost S, Zareamoghaddam H. On the distribution of cross-validated Mahalanobis distances. arXiv preprint arXiv:160701371. 2016;.</mixed-citation>
</ref>
<ref id="pcbi.1006299.ref020">
<label>20</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Friston</surname> <given-names>KJ</given-names></name>, <name name-style="western"><surname>Jezzard</surname> <given-names>P</given-names></name>, <name name-style="western"><surname>Turner</surname> <given-names>R</given-names></name>. <article-title>Analysis of functional MRI time-series</article-title>. <source>Human brain mapping</source>. <year>1994</year>;<volume>1</volume>(<issue>2</issue>):<fpage>153</fpage>–<lpage>171</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1002/hbm.460010207" xlink:type="simple">10.1002/hbm.460010207</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref021">
<label>21</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Cai</surname> <given-names>MB</given-names></name>, <name name-style="western"><surname>Schuck</surname> <given-names>NW</given-names></name>, <name name-style="western"><surname>Pillow</surname> <given-names>JW</given-names></name>, <name name-style="western"><surname>Niv</surname> <given-names>Y</given-names></name>. <article-title>A Bayesian method for reducing bias in neural representational similarity analysis</article-title>. In: <source>Advances in Neural Information Processing Systems</source>; <year>2016</year>. p. <fpage>4951</fpage>–<lpage>4959</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1006299.ref022">
<label>22</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Haxby</surname> <given-names>JV</given-names></name>, <name name-style="western"><surname>Guntupalli</surname> <given-names>JS</given-names></name>, <name name-style="western"><surname>Connolly</surname> <given-names>AC</given-names></name>, <name name-style="western"><surname>Halchenko</surname> <given-names>YO</given-names></name>, <name name-style="western"><surname>Conroy</surname> <given-names>BR</given-names></name>, <name name-style="western"><surname>Gobbini</surname> <given-names>MI</given-names></name>, <etal>et al</etal>. <article-title>A common, high-dimensional model of the representational space in human ventral temporal cortex</article-title>. <source>Neuron</source>. <year>2011</year>;<volume>72</volume>(<issue>2</issue>):<fpage>404</fpage>–<lpage>416</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.neuron.2011.08.026" xlink:type="simple">10.1016/j.neuron.2011.08.026</ext-link></comment> <object-id pub-id-type="pmid">22017997</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref023">
<label>23</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Chen</surname> <given-names>PHC</given-names></name>, <name name-style="western"><surname>Chen</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Yeshurun</surname> <given-names>Y</given-names></name>, <name name-style="western"><surname>Hasson</surname> <given-names>U</given-names></name>, <name name-style="western"><surname>Haxby</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Ramadge</surname> <given-names>PJ</given-names></name>. <article-title>A Reduced-Dimension fMRI Shared Response Model</article-title>. In: <source>Advances in Neural Information Processing Systems</source>; <year>2015</year>. p. <fpage>460</fpage>–<lpage>468</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1006299.ref024">
<label>24</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Schuck</surname> <given-names>NW</given-names></name>, <name name-style="western"><surname>Cai</surname> <given-names>MB</given-names></name>, <name name-style="western"><surname>Wilson</surname> <given-names>RC</given-names></name>, <name name-style="western"><surname>Niv</surname> <given-names>Y</given-names></name>. <article-title>Human orbitofrontal cortex represents a cognitive map of state space</article-title>. <source>Neuron</source>. <year>2016</year>;<volume>91</volume>:<fpage>1</fpage>–<lpage>11</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.neuron.2016.08.019" xlink:type="simple">10.1016/j.neuron.2016.08.019</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref025">
<label>25</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Kruskal</surname> <given-names>JB</given-names></name>. <article-title>Multidimensional scaling by optimizing goodness of fit to a nonmetric hypothesis</article-title>. <source>Psychometrika</source>. <year>1964</year>;<volume>29</volume>(<issue>1</issue>):<fpage>1</fpage>–<lpage>27</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1007/BF02289565" xlink:type="simple">10.1007/BF02289565</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref026">
<label>26</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Zarahn</surname> <given-names>E</given-names></name>, <name name-style="western"><surname>Aguirre</surname> <given-names>GK</given-names></name>, <name name-style="western"><surname>D’Esposito</surname> <given-names>M</given-names></name>. <article-title>Empirical analyses of BOLD fMRI statistics</article-title>. <source>NeuroImage</source>. <year>1997</year>;<volume>5</volume>(<issue>3</issue>):<fpage>179</fpage>–<lpage>197</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1006/nimg.1997.0263" xlink:type="simple">10.1006/nimg.1997.0263</ext-link></comment> <object-id pub-id-type="pmid">9345548</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref027">
<label>27</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Woolrich</surname> <given-names>MW</given-names></name>, <name name-style="western"><surname>Ripley</surname> <given-names>BD</given-names></name>, <name name-style="western"><surname>Brady</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Smith</surname> <given-names>SM</given-names></name>. <article-title>Temporal autocorrelation in univariate linear modeling of FMRI data</article-title>. <source>Neuroimage</source>. <year>2001</year>;<volume>14</volume>(<issue>6</issue>):<fpage>1370</fpage>–<lpage>1386</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1006/nimg.2001.0931" xlink:type="simple">10.1006/nimg.2001.0931</ext-link></comment> <object-id pub-id-type="pmid">11707093</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref028">
<label>28</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Van Essen</surname> <given-names>DC</given-names></name>, <name name-style="western"><surname>Smith</surname> <given-names>SM</given-names></name>, <name name-style="western"><surname>Barch</surname> <given-names>DM</given-names></name>, <name name-style="western"><surname>Behrens</surname> <given-names>TE</given-names></name>, <name name-style="western"><surname>Yacoub</surname> <given-names>E</given-names></name>, <name name-style="western"><surname>Ugurbil</surname> <given-names>K</given-names></name>, <etal>et al</etal>. <article-title>The WU-Minn human connectome project: an overview</article-title>. <source>Neuroimage</source>. <year>2013</year>;<volume>80</volume>:<fpage>62</fpage>–<lpage>79</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.neuroimage.2013.05.041" xlink:type="simple">10.1016/j.neuroimage.2013.05.041</ext-link></comment> <object-id pub-id-type="pmid">23684880</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref029">
<label>29</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Kay</surname> <given-names>KN</given-names></name>, <name name-style="western"><surname>Naselaris</surname> <given-names>T</given-names></name>, <name name-style="western"><surname>Prenger</surname> <given-names>RJ</given-names></name>, <name name-style="western"><surname>Gallant</surname> <given-names>JL</given-names></name>. <article-title>Identifying natural images from human brain activity</article-title>. <source>Nature</source>. <year>2008</year>;<volume>452</volume>(<issue>7185</issue>):<fpage>352</fpage>–<lpage>355</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1038/nature06713" xlink:type="simple">10.1038/nature06713</ext-link></comment> <object-id pub-id-type="pmid">18322462</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref030">
<label>30</label>
<mixed-citation publication-type="book" xlink:type="simple">
<name name-style="western"><surname>Robbins</surname> <given-names>H</given-names></name>. <source>An empirical Bayes approach to statistics</source>. <publisher-name>COLUMBIA UNIVERSITY</publisher-name> <publisher-loc>New York City United States</publisher-loc>; <year>1956</year>.</mixed-citation>
</ref>
<ref id="pcbi.1006299.ref031">
<label>31</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Kay</surname> <given-names>KN</given-names></name>, <name name-style="western"><surname>Rokem</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Winawer</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Dougherty</surname> <given-names>RF</given-names></name>, <name name-style="western"><surname>Wandell</surname> <given-names>BA</given-names></name>. <article-title>GLMdenoise: a fast, automated technique for denoising task-based fMRI data</article-title>. <source>Frontiers in neuroscience</source>. <year>2013</year>;<volume>7</volume>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.3389/fnins.2013.00247" xlink:type="simple">10.3389/fnins.2013.00247</ext-link></comment> <object-id pub-id-type="pmid">24381539</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref032">
<label>32</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Charest</surname> <given-names>I</given-names></name>, <name name-style="western"><surname>Kriegeskorte</surname> <given-names>N</given-names></name>, <name name-style="western"><surname>Kay</surname> <given-names>KN</given-names></name>. <article-title>GLMdenoise improves multivariate pattern analysis of fMRI data</article-title>. <source>NeuroImage</source>. <year>2018</year>;<volume>183</volume>:<fpage>606</fpage>–<lpage>616</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.neuroimage.2018.08.064" xlink:type="simple">10.1016/j.neuroimage.2018.08.064</ext-link></comment> <object-id pub-id-type="pmid">30170148</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref033">
<label>33</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Ledoit</surname> <given-names>O</given-names></name>, <name name-style="western"><surname>Wolf</surname> <given-names>M</given-names></name>. <article-title>A well-conditioned estimator for large-dimensional covariance matrices</article-title>. <source>Journal of multivariate analysis</source>. <year>2004</year>;<volume>88</volume>(<issue>2</issue>):<fpage>365</fpage>–<lpage>411</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/S0047-259X(03)00096-4" xlink:type="simple">10.1016/S0047-259X(03)00096-4</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref034">
<label>34</label>
<mixed-citation publication-type="book" xlink:type="simple">
<name name-style="western"><surname>Poldrack</surname> <given-names>RA</given-names></name>, <name name-style="western"><surname>Mumford</surname> <given-names>JA</given-names></name>, <name name-style="western"><surname>Nichols</surname> <given-names>TE</given-names></name>. <source>Handbook of functional MRI data analysis</source>. <publisher-name>Cambridge University Press</publisher-name>; <year>2011</year>.</mixed-citation>
</ref>
<ref id="pcbi.1006299.ref035">
<label>35</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Gavish</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Donoho</surname> <given-names>DL</given-names></name>. <article-title>The optimal hard threshold for singular values is <inline-formula id="pcbi.1006299.e104"><alternatives><graphic id="pcbi.1006299.e104g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006299.e104" xlink:type="simple"/><mml:math display="inline" id="M104"><mml:mrow><mml:mn mathvariant="bold">4</mml:mn> <mml:mo>/</mml:mo> <mml:msqrt><mml:mn mathvariant="bold">3</mml:mn></mml:msqrt></mml:mrow></mml:math></alternatives></inline-formula></article-title>. <source>IEEE Transactions on Information Theory</source>. <year>2014</year>;<volume>60</volume>(<issue>8</issue>):<fpage>5040</fpage>–<lpage>5053</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1006299.ref036">
<label>36</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Minka</surname> <given-names>TP</given-names></name>. <article-title>Automatic choice of dimensionality for PCA</article-title>. In: <source>Advances in neural information processing systems</source>; <year>2001</year>. p. <fpage>598</fpage>–<lpage>604</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1006299.ref037">
<label>37</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Glasser</surname> <given-names>MF</given-names></name>, <name name-style="western"><surname>Sotiropoulos</surname> <given-names>SN</given-names></name>, <name name-style="western"><surname>Wilson</surname> <given-names>JA</given-names></name>, <name name-style="western"><surname>Coalson</surname> <given-names>TS</given-names></name>, <name name-style="western"><surname>Fischl</surname> <given-names>B</given-names></name>, <name name-style="western"><surname>Andersson</surname> <given-names>JL</given-names></name>, <etal>et al</etal>. <article-title>The minimal preprocessing pipelines for the Human Connectome Project</article-title>. <source>Neuroimage</source>. <year>2013</year>;<volume>80</volume>:<fpage>105</fpage>–<lpage>124</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.neuroimage.2013.04.127" xlink:type="simple">10.1016/j.neuroimage.2013.04.127</ext-link></comment> <object-id pub-id-type="pmid">23668970</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref038">
<label>38</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Bonferroni</surname> <given-names>C</given-names></name>. <article-title>Teoria statistica delle classi e calcolo delle probabilita</article-title>. <source>Pubblicazioni del R Istituto Superiore di Scienze Economiche e Commericiali di Firenze</source>. <year>1936</year>;<volume>8</volume>:<fpage>3</fpage>–<lpage>62</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1006299.ref039">
<label>39</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Kailath</surname> <given-names>T</given-names></name>. <article-title>The divergence and Bhattacharyya distance measures in signal selection</article-title>. <source>IEEE transactions on communication technology</source>. <year>1967</year>;<volume>15</volume>(<issue>1</issue>):<fpage>52</fpage>–<lpage>60</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1109/TCOM.1967.1089532" xlink:type="simple">10.1109/TCOM.1967.1089532</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref040">
<label>40</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Lindquist</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Geuter</surname> <given-names>S</given-names></name>, <name name-style="western"><surname>Wager</surname> <given-names>T</given-names></name>, <name name-style="western"><surname>Caffo</surname> <given-names>B</given-names></name>. <article-title>Modular preprocessing pipelines can reintroduce artifacts into fMRI data</article-title>. <source>bioRxiv</source>. <year>2018</year>; p. 407676.</mixed-citation>
</ref>
<ref id="pcbi.1006299.ref041">
<label>41</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Nili</surname> <given-names>H</given-names></name>, <name name-style="western"><surname>Wingfield</surname> <given-names>C</given-names></name>, <name name-style="western"><surname>Walther</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Su</surname> <given-names>L</given-names></name>, <name name-style="western"><surname>Marslen-Wilson</surname> <given-names>W</given-names></name>, <name name-style="western"><surname>Kriegeskorte</surname> <given-names>N</given-names></name>. <article-title>A toolbox for representational similarity analysis</article-title>. <source>PLoS computational biology</source>. <year>2014</year>;<volume>10</volume>(<issue>4</issue>):<fpage>e1003553</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1371/journal.pcbi.1003553" xlink:type="simple">10.1371/journal.pcbi.1003553</ext-link></comment> <object-id pub-id-type="pmid">24743308</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref042">
<label>42</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Walther</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Nili</surname> <given-names>H</given-names></name>, <name name-style="western"><surname>Ejaz</surname> <given-names>N</given-names></name>, <name name-style="western"><surname>Alink</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Kriegeskorte</surname> <given-names>N</given-names></name>, <name name-style="western"><surname>Diedrichsen</surname> <given-names>J</given-names></name>. <article-title>Reliability of dissimilarity measures for multi-voxel pattern analysis</article-title>. <source>NeuroImage</source>. <year>2015</year>;. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.neuroimage.2015.12.012" xlink:type="simple">10.1016/j.neuroimage.2015.12.012</ext-link></comment> <object-id pub-id-type="pmid">26707889</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref043">
<label>43</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Nili</surname> <given-names>H</given-names></name>, <name name-style="western"><surname>Walther</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Alink</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Kriegeskorte</surname> <given-names>N</given-names></name>. <article-title>Inferring exemplar discriminability in brain representations</article-title>. <source>bioRxiv</source>. <year>2016</year>; p. 080580.</mixed-citation>
</ref>
<ref id="pcbi.1006299.ref044">
<label>44</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Ramírez</surname> <given-names>FM</given-names></name>, <name name-style="western"><surname>Cichy</surname> <given-names>RM</given-names></name>, <name name-style="western"><surname>Allefeld</surname> <given-names>C</given-names></name>, <name name-style="western"><surname>Haynes</surname> <given-names>JD</given-names></name>. <article-title>The neural code for face orientation in the human fusiform face area</article-title>. <source>Journal of Neuroscience</source>. <year>2014</year>;<volume>34</volume>(<issue>36</issue>):<fpage>12155</fpage>–<lpage>12167</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1523/JNEUROSCI.3156-13.2014" xlink:type="simple">10.1523/JNEUROSCI.3156-13.2014</ext-link></comment> <object-id pub-id-type="pmid">25186759</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref045">
<label>45</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Ramírez</surname> <given-names>FM</given-names></name>. <article-title>Representational confusion: the plausible consequence of demeaning your data</article-title>. <source>bioRxiv</source>. <year>2017</year>; p. 195271.</mixed-citation>
</ref>
<ref id="pcbi.1006299.ref046">
<label>46</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Ramírez</surname> <given-names>FM</given-names></name>. <article-title>Orientation Encoding and Viewpoint Invariance in Face Recognition: Inferring Neural Properties from Large-Scale Signals</article-title>. <source>The Neuroscientist</source>. <year>2018</year>;<volume>24</volume>(<issue>6</issue>):<fpage>582</fpage>–<lpage>608</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1177/1073858418769554" xlink:type="simple">10.1177/1073858418769554</ext-link></comment> <object-id pub-id-type="pmid">29855217</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref047">
<label>47</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Diedrichsen</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Yokoi</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Arbuckle</surname> <given-names>SA</given-names></name>. <article-title>Pattern component modeling: A flexible approach for understanding the representational structure of brain activity patterns</article-title>. <source>NeuroImage</source>. <year>2017</year>;. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.neuroimage.2017.08.051" xlink:type="simple">10.1016/j.neuroimage.2017.08.051</ext-link></comment> <object-id pub-id-type="pmid">28843540</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref048">
<label>48</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Handwerker</surname> <given-names>DA</given-names></name>, <name name-style="western"><surname>Ollinger</surname> <given-names>JM</given-names></name>, <name name-style="western"><surname>D’Esposito</surname> <given-names>M</given-names></name>. <article-title>Variation of BOLD hemodynamic responses across subjects and brain regions and their effects on statistical analyses</article-title>. <source>Neuroimage</source>. <year>2004</year>;<volume>21</volume>(<issue>4</issue>):<fpage>1639</fpage>–<lpage>1651</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.neuroimage.2003.11.029" xlink:type="simple">10.1016/j.neuroimage.2003.11.029</ext-link></comment> <object-id pub-id-type="pmid">15050587</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref049">
<label>49</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Aguirre</surname> <given-names>GK</given-names></name>, <name name-style="western"><surname>Zarahn</surname> <given-names>E</given-names></name>, <name name-style="western"><surname>D’esposito</surname> <given-names>M</given-names></name>. <article-title>The variability of human, BOLD hemodynamic responses</article-title>. <source>Neuroimage</source>. <year>1998</year>;<volume>8</volume>(<issue>4</issue>):<fpage>360</fpage>–<lpage>369</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1006/nimg.1998.0369" xlink:type="simple">10.1006/nimg.1998.0369</ext-link></comment> <object-id pub-id-type="pmid">9811554</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref050">
<label>50</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Squire</surname> <given-names>LR</given-names></name>, <name name-style="western"><surname>Ojemann</surname> <given-names>JG</given-names></name>, <name name-style="western"><surname>Miezin</surname> <given-names>FM</given-names></name>, <name name-style="western"><surname>Petersen</surname> <given-names>SE</given-names></name>, <name name-style="western"><surname>Videen</surname> <given-names>TO</given-names></name>, <name name-style="western"><surname>Raichle</surname> <given-names>ME</given-names></name>. <article-title>Activation of the hippocampus in normal humans: a functional anatomical study of memory</article-title>. <source>Proceedings of the National Academy of Sciences</source>. <year>1992</year>;<volume>89</volume>(<issue>5</issue>):<fpage>1837</fpage>–<lpage>1841</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1073/pnas.89.5.1837" xlink:type="simple">10.1073/pnas.89.5.1837</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref051">
<label>51</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Desimone</surname> <given-names>R</given-names></name>. <article-title>Neural mechanisms for visual memory and their role in attention</article-title>. <source>Proceedings of the National Academy of Sciences</source>. <year>1996</year>;<volume>93</volume>(<issue>24</issue>):<fpage>13494</fpage>–<lpage>13499</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1073/pnas.93.24.13494" xlink:type="simple">10.1073/pnas.93.24.13494</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref052">
<label>52</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Henson</surname> <given-names>R</given-names></name>, <name name-style="western"><surname>Shallice</surname> <given-names>T</given-names></name>, <name name-style="western"><surname>Dolan</surname> <given-names>R</given-names></name>. <article-title>Neuroimaging evidence for dissociable forms of repetition priming</article-title>. <source>Science</source>. <year>2000</year>;<volume>287</volume>(<issue>5456</issue>):<fpage>1269</fpage>–<lpage>1272</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1126/science.287.5456.1269" xlink:type="simple">10.1126/science.287.5456.1269</ext-link></comment> <object-id pub-id-type="pmid">10678834</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref053">
<label>53</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>O’Craven</surname> <given-names>KM</given-names></name>, <name name-style="western"><surname>Rosen</surname> <given-names>BR</given-names></name>, <name name-style="western"><surname>Kwong</surname> <given-names>KK</given-names></name>, <name name-style="western"><surname>Treisman</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Savoy</surname> <given-names>RL</given-names></name>. <article-title>Voluntary attention modulates fMRI activity in human MT–MST</article-title>. <source>Neuron</source>. <year>1997</year>;<volume>18</volume>(<issue>4</issue>):<fpage>591</fpage>–<lpage>598</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/S0896-6273(00)80300-1" xlink:type="simple">10.1016/S0896-6273(00)80300-1</ext-link></comment> <object-id pub-id-type="pmid">9136768</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref054">
<label>54</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Wojciulik</surname> <given-names>E</given-names></name>, <name name-style="western"><surname>Kanwisher</surname> <given-names>N</given-names></name>, <name name-style="western"><surname>Driver</surname> <given-names>J</given-names></name>. <article-title>Covert visual attention modulates face-specific activity in the human fusiform gyrus: fMRI study</article-title>. <source>Journal of Neurophysiology</source>. <year>1998</year>;<volume>79</volume>(<issue>3</issue>):<fpage>1574</fpage>–<lpage>1578</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1152/jn.1998.79.3.1574" xlink:type="simple">10.1152/jn.1998.79.3.1574</ext-link></comment> <object-id pub-id-type="pmid">9497433</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref055">
<label>55</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Pruim</surname> <given-names>RH</given-names></name>, <name name-style="western"><surname>Mennes</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>van Rooij</surname> <given-names>D</given-names></name>, <name name-style="western"><surname>Llera</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Buitelaar</surname> <given-names>JK</given-names></name>, <name name-style="western"><surname>Beckmann</surname> <given-names>CF</given-names></name>. <article-title>ICA-AROMA: A robust ICA-based strategy for removing motion artifacts from fMRI data</article-title>. <source>Neuroimage</source>. <year>2015</year>;<volume>112</volume>:<fpage>267</fpage>–<lpage>277</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.neuroimage.2015.02.064" xlink:type="simple">10.1016/j.neuroimage.2015.02.064</ext-link></comment> <object-id pub-id-type="pmid">25770991</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref056">
<label>56</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Cox</surname> <given-names>RW</given-names></name>. <article-title>AFNI: software for analysis and visualization of functional magnetic resonance neuroimages</article-title>. <source>Computers and Biomedical research</source>. <year>1996</year>;<volume>29</volume>(<issue>3</issue>):<fpage>162</fpage>–<lpage>173</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1006/cbmr.1996.0014" xlink:type="simple">10.1006/cbmr.1996.0014</ext-link></comment> <object-id pub-id-type="pmid">8812068</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref057">
<label>57</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Friston</surname> <given-names>KJ</given-names></name>, <name name-style="western"><surname>Holmes</surname> <given-names>AP</given-names></name>, <name name-style="western"><surname>Worsley</surname> <given-names>KJ</given-names></name>, <name name-style="western"><surname>Poline</surname> <given-names>JP</given-names></name>, <name name-style="western"><surname>Frith</surname> <given-names>CD</given-names></name>, <name name-style="western"><surname>Frackowiak</surname> <given-names>RS</given-names></name>. <article-title>Statistical parametric maps in functional imaging: a general linear approach</article-title>. <source>Human brain mapping</source>. <year>1994</year>;<volume>2</volume>(<issue>4</issue>):<fpage>189</fpage>–<lpage>210</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1002/hbm.460020402" xlink:type="simple">10.1002/hbm.460020402</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1006299.ref058">
<label>58</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Pedregosa</surname> <given-names>F</given-names></name>, <name name-style="western"><surname>Varoquaux</surname> <given-names>G</given-names></name>, <name name-style="western"><surname>Gramfort</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Michel</surname> <given-names>V</given-names></name>, <name name-style="western"><surname>Thirion</surname> <given-names>B</given-names></name>, <name name-style="western"><surname>Grisel</surname> <given-names>O</given-names></name>, <etal>et al</etal>. <article-title>Scikit-learn: Machine Learning in Python</article-title>. <source>Journal of Machine Learning Research</source>. <year>2011</year>;<volume>12</volume>:<fpage>2825</fpage>–<lpage>2830</lpage>.</mixed-citation>
</ref>
</ref-list>
</back>
</article>