<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="1.1d3" xml:lang="en">
<front>
<journal-meta>
<journal-id journal-id-type="nlm-ta">PLoS Comput Biol</journal-id>
<journal-id journal-id-type="publisher-id">plos</journal-id>
<journal-id journal-id-type="pmc">ploscomp</journal-id>
<journal-title-group>
<journal-title>PLOS Computational Biology</journal-title>
</journal-title-group>
<issn pub-type="ppub">1553-734X</issn>
<issn pub-type="epub">1553-7358</issn>
<publisher>
<publisher-name>Public Library of Science</publisher-name>
<publisher-loc>San Francisco, CA USA</publisher-loc>
</publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="publisher-id">PCOMPBIOL-D-18-01550</article-id>
<article-id pub-id-type="doi">10.1371/journal.pcbi.1007205</article-id>
<article-categories>
<subj-group subj-group-type="heading">
<subject>Research Article</subject>
</subj-group>
<subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Cell biology</subject><subj-group><subject>Signal transduction</subject><subj-group><subject>Cell signaling</subject><subj-group><subject>Calcium signaling</subject></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Physical sciences</subject><subj-group><subject>Mathematics</subject><subj-group><subject>Operator theory</subject><subj-group><subject>Kernel functions</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Biochemistry</subject><subj-group><subject>Neurochemistry</subject><subj-group><subject>Neurotransmitters</subject><subj-group><subject>Glutamate</subject></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Neuroscience</subject><subj-group><subject>Neurochemistry</subject><subj-group><subject>Neurotransmitters</subject><subj-group><subject>Glutamate</subject></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Research and analysis methods</subject><subj-group><subject>Mathematical and statistical techniques</subject><subj-group><subject>Cluster analysis</subject><subj-group><subject>Hierarchical clustering</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Physical sciences</subject><subj-group><subject>Mathematics</subject><subj-group><subject>Statistics</subject><subj-group><subject>Statistical noise</subject><subj-group><subject>Gaussian noise</subject></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Cell biology</subject><subj-group><subject>Cellular types</subject><subj-group><subject>Animal cells</subject><subj-group><subject>Neurons</subject><subj-group><subject>Nerve fibers</subject><subj-group><subject>Axons</subject></subj-group></subj-group></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Neuroscience</subject><subj-group><subject>Cellular neuroscience</subject><subj-group><subject>Neurons</subject><subj-group><subject>Nerve fibers</subject><subj-group><subject>Axons</subject></subj-group></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Research and analysis methods</subject><subj-group><subject>Imaging techniques</subject><subj-group><subject>Fluorescence imaging</subject></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Cell biology</subject><subj-group><subject>Cellular types</subject><subj-group><subject>Animal cells</subject><subj-group><subject>Neurons</subject></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Neuroscience</subject><subj-group><subject>Cellular neuroscience</subject><subj-group><subject>Neurons</subject></subj-group></subj-group></subj-group></subj-group></article-categories>
<title-group>
<article-title>Bayesian hypothesis testing and experimental design for two-photon imaging data</article-title>
<alt-title alt-title-type="running-head">Bayesian hypothesis testing and experimental design for two-photon imaging data</alt-title>
</title-group>
<contrib-group>
<contrib contrib-type="author" xlink:type="simple">
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-4284-8080</contrib-id>
<name name-style="western">
<surname>Rogerson</surname> <given-names>Luke E.</given-names></name>
<role content-type="http://credit.casrai.org/">Conceptualization</role>
<role content-type="http://credit.casrai.org/">Formal analysis</role>
<role content-type="http://credit.casrai.org/">Investigation</role>
<role content-type="http://credit.casrai.org/">Methodology</role>
<role content-type="http://credit.casrai.org/">Software</role>
<role content-type="http://credit.casrai.org/">Validation</role>
<role content-type="http://credit.casrai.org/">Visualization</role>
<role content-type="http://credit.casrai.org/">Writing – original draft</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff001"><sup>1</sup></xref>
<xref ref-type="aff" rid="aff002"><sup>2</sup></xref>
<xref ref-type="aff" rid="aff003"><sup>3</sup></xref>
<xref ref-type="aff" rid="aff004"><sup>4</sup></xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-3302-1495</contrib-id>
<name name-style="western">
<surname>Zhao</surname> <given-names>Zhijian</given-names></name>
<role content-type="http://credit.casrai.org/">Investigation</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff001"><sup>1</sup></xref>
<xref ref-type="aff" rid="aff002"><sup>2</sup></xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<name name-style="western">
<surname>Franke</surname> <given-names>Katrin</given-names></name>
<role content-type="http://credit.casrai.org/">Investigation</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff001"><sup>1</sup></xref>
<xref ref-type="aff" rid="aff003"><sup>3</sup></xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<name name-style="western">
<surname>Euler</surname> <given-names>Thomas</given-names></name>
<role content-type="http://credit.casrai.org/">Conceptualization</role>
<role content-type="http://credit.casrai.org/">Funding acquisition</role>
<role content-type="http://credit.casrai.org/">Methodology</role>
<role content-type="http://credit.casrai.org/">Project administration</role>
<role content-type="http://credit.casrai.org/">Resources</role>
<role content-type="http://credit.casrai.org/">Supervision</role>
<role content-type="http://credit.casrai.org/">Writing – original draft</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff001"><sup>1</sup></xref>
<xref ref-type="aff" rid="aff002"><sup>2</sup></xref>
<xref ref-type="aff" rid="aff003"><sup>3</sup></xref>
<xref ref-type="fn" rid="econtrib001"><sup>‡</sup></xref>
</contrib>
<contrib contrib-type="author" corresp="yes" xlink:type="simple">
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-0199-4727</contrib-id>
<name name-style="western">
<surname>Berens</surname> <given-names>Philipp</given-names></name>
<role content-type="http://credit.casrai.org/">Conceptualization</role>
<role content-type="http://credit.casrai.org/">Funding acquisition</role>
<role content-type="http://credit.casrai.org/">Methodology</role>
<role content-type="http://credit.casrai.org/">Project administration</role>
<role content-type="http://credit.casrai.org/">Resources</role>
<role content-type="http://credit.casrai.org/">Supervision</role>
<role content-type="http://credit.casrai.org/">Writing – original draft</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff001"><sup>1</sup></xref>
<xref ref-type="aff" rid="aff002"><sup>2</sup></xref>
<xref ref-type="aff" rid="aff003"><sup>3</sup></xref>
<xref ref-type="aff" rid="aff005"><sup>5</sup></xref>
<xref ref-type="corresp" rid="cor001">*</xref>
<xref ref-type="fn" rid="econtrib001"><sup>‡</sup></xref>
</contrib>
</contrib-group>
<aff id="aff001">
<label>1</label>
<addr-line>Institute for Ophthalmic Research, University of Tübingen, Tübingen, Germany</addr-line>
</aff>
<aff id="aff002">
<label>2</label>
<addr-line>Center for Integrative Neuroscience, University of Tübingen, Tübingen, Germany</addr-line>
</aff>
<aff id="aff003">
<label>3</label>
<addr-line>Bernstein Center for Computational Neuroscience, University of Tübingen, Tübingen, Germany</addr-line>
</aff>
<aff id="aff004">
<label>4</label>
<addr-line>Graduate Training Center for Neuroscience, University of Tübingen, Tübingen, Germany</addr-line>
</aff>
<aff id="aff005">
<label>5</label>
<addr-line>Institute for Bioinformatics and Medical Informatics, University of Tübingen, Tübingen, Germany</addr-line>
</aff>
<contrib-group>
<contrib contrib-type="editor" xlink:type="simple">
<name name-style="western">
<surname>Park</surname> <given-names>Il Memming</given-names></name>
<role>Editor</role>
<xref ref-type="aff" rid="edit1"/>
</contrib>
</contrib-group>
<aff id="edit1">
<addr-line>Stony Brook University, UNITED STATES</addr-line>
</aff>
<author-notes>
<fn fn-type="conflict" id="coi001">
<p>The authors have declared that no competing interests exist.</p>
</fn>
<fn fn-type="other" id="econtrib001">
<p>‡ These authors are joint last authors on this work.</p>
</fn>
<corresp id="cor001">* E-mail: <email xlink:type="simple">philipp.berens@uni-tuebingen.de</email></corresp>
</author-notes>
<pub-date pub-type="collection">
<month>8</month>
<year>2019</year>
</pub-date>
<pub-date pub-type="epub">
<day>2</day>
<month>8</month>
<year>2019</year>
</pub-date>
<volume>15</volume>
<issue>8</issue>
<elocation-id>e1007205</elocation-id>
<history>
<date date-type="received">
<day>9</day>
<month>9</month>
<year>2018</year>
</date>
<date date-type="accepted">
<day>20</day>
<month>6</month>
<year>2019</year>
</date>
</history>
<permissions>
<copyright-year>2019</copyright-year>
<copyright-holder>Rogerson et al</copyright-holder>
<license xlink:href="http://creativecommons.org/licenses/by/4.0/" xlink:type="simple">
<license-p>This is an open access article distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/" xlink:type="simple">Creative Commons Attribution License</ext-link>, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p>
</license>
</permissions>
<self-uri content-type="pdf" xlink:href="info:doi/10.1371/journal.pcbi.1007205"/>
<abstract>
<p>Variability, stochastic or otherwise, is a central feature of neural activity. Yet the means by which estimates of variation and uncertainty are derived from noisy observations of neural activity is often heuristic, with more weight given to numerical convenience than statistical rigour. For two-photon imaging data, composed of fundamentally probabilistic streams of photon detections, the problem is particularly acute. Here, we present a statistical pipeline for the inference and analysis of neural activity using Gaussian Process regression, applied to two-photon recordings of light-driven activity in <italic>ex vivo</italic> mouse retina. We demonstrate the flexibility and extensibility of these models, considering cases with non-stationary statistics, driven by complex parametric stimuli, in signal discrimination, hierarchical clustering and other inference tasks. Sparse approximation methods allow these models to be fitted rapidly, permitting them to actively guide the design of light stimulation in the midst of ongoing two-photon experiments.</p>
</abstract>
<abstract abstract-type="summary">
<title>Author summary</title>
<p>There are many sources of noise in recordings of neural activity, and the first challenge in neural data analysis is to separate this noise from experimentally relevant variation. This is particularly problematic for two-photon imaging data. Two-photon imaging uses fluorescent indicators to measure changes in the concentration of molecules involved in cell signalling, and adds a variety of numerical, biological and optical noise sources. We present a method for disentangling this signal and noise using Gaussian processes, a family of probabilistic models which provide a principled way of inferring mean activity and variability. In addition to signal recovery, we show that these models can test the evidence for whether and where two signals are different and that these tests can be used to look for groups in sets of signals. We explore how these models can be extended to predict how signals will change under different experimental conditions, and that these predictions can be used to select new conditions for further exploration.</p>
</abstract>
<funding-group>
<funding-statement>This research was supported by German Research Foundation (DFG; BE 5604/1-1 to PB; Cluster of Excellence “Machine Learning — New Perspectives for Science, EXC 2064 to PB, project number 390727645; SFB 1233 "Robust Vision" to PB and TE - project number 276693517), the Federal Ministry of Education and Research (BMBF; FKZ 01GQ1002 to TE and KF, FKZ 01GQ1601/Bernstein Award to PB), the National Eye Institute (NEI; 1R01EY023766-01A1 to TE) and the Max Planck Society (MPG; M.FE.A.KYBE0004 to KF). The funders had no role in study design, data collection and analysis, decision to publish or preparations of the manuscript.</funding-statement>
</funding-group>
<counts>
<fig-count count="8"/>
<table-count count="0"/>
<page-count count="27"/>
</counts>
<custom-meta-group>
<custom-meta>
<meta-name>PLOS Publication Stage</meta-name>
<meta-value>vor-update-to-uncorrected-proof</meta-value>
</custom-meta>
<custom-meta>
<meta-name>Publication Update</meta-name>
<meta-value>2019-08-14</meta-value>
</custom-meta>
<custom-meta id="data-availability">
<meta-name>Data Availability</meta-name>
<meta-value>The data and code are available from <ext-link ext-link-type="uri" xlink:href="https://github.com/berenslab/bayesian_2p_pipeline" xlink:type="simple">https://github.com/berenslab/bayesian_2p_pipeline</ext-link>.</meta-value>
</custom-meta>
</custom-meta-group>
</article-meta>
</front>
<body>
<sec id="sec001" sec-type="intro">
<title>Introduction</title>
<p>Over the last two decades, two-photon (2P) imaging has become one of the premier tools for studying coding in neural systems from the population level down to individual neural compartments [<xref ref-type="bibr" rid="pcbi.1007205.ref001">1</xref>]. The resulting data is highly variable due to the inherent variability of neurons and technical sources of noise in the imaging process [<xref ref-type="bibr" rid="pcbi.1007205.ref002">2</xref>, <xref ref-type="bibr" rid="pcbi.1007205.ref003">3</xref>]. Yet we typically assume that beneath the noisy signals which are observed there is a smooth latent function describing the activity of a neuron or a neural compartment. In a typical analysis pipeline for 2P data, we attempt to recover this function by grouping noisy observations from pixels into regions of interest (ROIs), which cover the soma or different compartments of a neuron, temporally interpolating them to a common frame rate and averaging across repetitions of the same stimulus (see also <xref ref-type="boxed-text" rid="pcbi.1007205.box001">Box 1</xref>). Each stage is intended to smooth the observations and get closer to the “true” underlying activity function of the neuron. To measure the uncertainty about this latent activity function, often the variance between repetitions of the same experimental condition is used, with little assessment of whether this reflects the actual uncertainty given measurement and neural variability.</p>
<boxed-text id="pcbi.1007205.box001" position="float">
<sec id="sec002">
<title>Box 1: Analysis pipelines for two-photon imaging data</title>
<p>Two-photon imaging data can typically be described by two spatial dimensions (<italic>x</italic>, <italic>y</italic>) and a time dimension (<italic>t</italic>), at which fluorescence of an activity indicator is measured. In addition, there is a second set of variables one needs to consider: those of the stimulus, which are described with a set of parameters (<italic>θ</italic>). Thus, a single measurement <italic>F</italic><sub><italic>x</italic>,<italic>y</italic>,<italic>t</italic>,<italic>θ</italic></sub> describes the fluorescence at point (<italic>x</italic>, <italic>y</italic>) and time <italic>t</italic>, given that stimulus <italic>θ</italic> was shown. The dimensionality of the parameter vector will vary between stimuli and experiments.</p>
<p>In an analysis pipeline, we want to perform inference about e.g. whether a stimulus parameter systematically influences the neural activity, i.e. whether <inline-formula id="pcbi.1007205.e001"><alternatives><graphic id="pcbi.1007205.e001g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007205.e001" xlink:type="simple"/><mml:math display="inline" id="M1"><mml:mrow><mml:msub><mml:mi>F</mml:mi> <mml:mrow><mml:mi>x</mml:mi> <mml:mo>,</mml:mo> <mml:mi>y</mml:mi> <mml:mo>,</mml:mo> <mml:mi>t</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>θ</mml:mi> <mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:msub> <mml:mo>=</mml:mo> <mml:msub><mml:mi>F</mml:mi> <mml:mrow><mml:mi>x</mml:mi> <mml:mo>,</mml:mo> <mml:mi>y</mml:mi> <mml:mo>,</mml:mo> <mml:mi>t</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>θ</mml:mi> <mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>. The first step of such a pipeline is often to transform the fluorescence data <italic>F</italic><sub><italic>x</italic>,<italic>y</italic>,<italic>t</italic>,<italic>θ</italic></sub> into time-series representations for a distinct neural structure such as the soma or an axon. This transformation is usually achieved by defining a set of regions of interest (ROI) in the spatial dimensions and for each of those, computing the average value of all measured values in each time point:
<disp-formula id="pcbi.1007205.e002"><alternatives><graphic id="pcbi.1007205.e002g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007205.e002" xlink:type="simple"/><mml:math display="block" id="M2"><mml:mrow><mml:msub><mml:mi>F</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mo>,</mml:mo> <mml:mi>t</mml:mi> <mml:mo>,</mml:mo> <mml:mi>θ</mml:mi></mml:mrow></mml:msub> <mml:mo>=</mml:mo> <mml:msub><mml:mrow><mml:mo>⟨</mml:mo> <mml:msub><mml:mi>F</mml:mi> <mml:mrow><mml:mi>x</mml:mi> <mml:mo>,</mml:mo> <mml:mi>y</mml:mi> <mml:mo>,</mml:mo> <mml:mi>t</mml:mi> <mml:mo>,</mml:mo> <mml:mi>θ</mml:mi></mml:mrow></mml:msub> <mml:mo>⟩</mml:mo></mml:mrow> <mml:mrow><mml:mi>x</mml:mi> <mml:mo>,</mml:mo> <mml:mi>y</mml:mi> <mml:mo>∈</mml:mo> <mml:mi>R</mml:mi> <mml:mi>O</mml:mi> <mml:msub><mml:mi>I</mml:mi> <mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives> <label>(1)</label></disp-formula>
Here, 〈〉 denote the average. Two-photon imaging provides only near-simultaneous measures of the structures in the imaging field, as the scanning laser which transverses the field is only positioned at one point within the field at any given time. At no time point are two structures truly simultaneously recorded. The activity of each structure at a common set of time points therefore needs to be inferred to enable the averaging procedure.</p>
<p>The classical pipeline solves the above issues as follows: ROIs are specified, the state of the ROI is inferred from the mean of its pixel (x,y) values in each scan frame, and interpolation (e.g. cubic spline) is used to infer the activity of the ROI at a common set of time points. Signal uncertainty is calculated by computing the variance of the interpolated signals between stimulus trials. The stimulus parameters are not explicitly modelled in this pipeline.</p>
<p>In our proposed pipeline, the mean value of the activity of each ROI is computed for each scan line where this ROI is scanned (corresponding to either the horizontal line in a linear scan, or one complete arc in the spiral scan), and a Gaussian Process is used to infer the activity of the ROIs over time and over the stimulus parameters. The variance of these signals is directly inferred as part of the Gaussian process model, decomposed into additive observation noise and uncertainty associated with the mean signal (referred to as “latent uncertainty” throughout, compare <xref ref-type="boxed-text" rid="pcbi.1007205.box002">Box 2</xref>).</p>
</sec>
</boxed-text>
<p>Here, we propose a different approach based on Gaussian Process (GP) regression [<xref ref-type="bibr" rid="pcbi.1007205.ref004">4</xref>] to infer signals from 2P recordings in a statistically principled manner, propagating the uncertainty all the way from the measurements to the desired inference. This regression procedure recovers an estimate of the true activity of the neuron, whether changes in calcium or glutamate concentration, from observations with experimental noise. This is facilitated by modelling explicitly the change in the signal over time and as a function of stimulus parameters. Gaussian processes are probabilistic models, which describe the functional relationship between a set of predictors and a set of observations (see <xref ref-type="boxed-text" rid="pcbi.1007205.box002">Box 2</xref> for a mathematical primer). In contrast to typical pre-processing pipelines, the statistical properties of the observed signal are considered explicitly as part of the model optimisation. Recently developed sparse GP approximations allow us to apply these models to comparatively large datasets with several thousand observations, as are common in 2P experiments [<xref ref-type="bibr" rid="pcbi.1007205.ref005">5</xref>].</p>
<boxed-text id="pcbi.1007205.box002" position="float">
<sec id="sec004">
<title>Box 2: Mathematics of Gaussian Process regression</title>
<p>Gaussian processes are distributions over functions, with a mean function and a covariance kernel (for further mathematical details, see [<xref ref-type="bibr" rid="pcbi.1007205.ref004">4</xref>]):
<disp-formula id="pcbi.1007205.e003"><alternatives><graphic id="pcbi.1007205.e003g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007205.e003" xlink:type="simple"/><mml:math display="block" id="M3"><mml:mi>y</mml:mi> <mml:mrow><mml:mo>=</mml:mo> <mml:mi>f</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>X</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>∼</mml:mo> <mml:mi>G</mml:mi> <mml:mi>P</mml:mi> <mml:mo>(</mml:mo> <mml:mi>m</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>X</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>X</mml:mi> <mml:mo>,</mml:mo> <mml:msup><mml:mi>X</mml:mi> <mml:mo>′</mml:mo></mml:msup> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>)</mml:mo></mml:mrow></mml:math></alternatives> <label>(2)</label></disp-formula>
<disp-formula id="pcbi.1007205.e004"><alternatives><graphic id="pcbi.1007205.e004g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007205.e004" xlink:type="simple"/><mml:math display="block" id="M4"><mml:mrow><mml:mi>m</mml:mi> <mml:mo>(</mml:mo> <mml:mi>X</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>=</mml:mo> <mml:mi>E</mml:mi> <mml:mo>[</mml:mo> <mml:mi>f</mml:mi> <mml:mo>(</mml:mo> <mml:mi>X</mml:mi> <mml:mo>)</mml:mo> <mml:mo>]</mml:mo></mml:mrow></mml:math></alternatives> <label>(3)</label></disp-formula>
<disp-formula id="pcbi.1007205.e005"><alternatives><graphic id="pcbi.1007205.e005g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007205.e005" xlink:type="simple"/><mml:math display="block" id="M5"><mml:mrow><mml:mi>k</mml:mi> <mml:mo>(</mml:mo> <mml:mi>X</mml:mi> <mml:mo>,</mml:mo> <mml:msup><mml:mi>X</mml:mi> <mml:mo>′</mml:mo></mml:msup> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>=</mml:mo> <mml:mi>E</mml:mi> <mml:mo>[</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>f</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>X</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>-</mml:mo> <mml:mi>E</mml:mi> <mml:mrow><mml:mo>[</mml:mo> <mml:mi>f</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>X</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>]</mml:mo></mml:mrow> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>f</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msup><mml:mi>X</mml:mi> <mml:mo>′</mml:mo></mml:msup> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>-</mml:mo> <mml:mi>E</mml:mi> <mml:mrow><mml:mo>[</mml:mo> <mml:mi>f</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msup><mml:mi>X</mml:mi> <mml:mo>′</mml:mo></mml:msup> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>]</mml:mo></mml:mrow> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>]</mml:mo></mml:mrow></mml:math></alternatives> <label>(4)</label></disp-formula></p>
<p>The covariance kernel models how the function varies as the predictors change. Many common covariance kernels including the Radial Basis Function and Exponential kernels are members of the class of Matérn covariance kernels. We use the RBF kernel throughout our pipeline. The kernel’s length-scale <italic>l</italic> hyperparameter models the rate at which the observations are expected to change as a function of the predictors.
<disp-formula id="pcbi.1007205.e006"><alternatives><graphic id="pcbi.1007205.e006g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007205.e006" xlink:type="simple"/><mml:math display="block" id="M6"><mml:mrow><mml:msub><mml:mi>k</mml:mi> <mml:mrow><mml:mi>R</mml:mi> <mml:mi>B</mml:mi> <mml:mi>F</mml:mi> <mml:mo>,</mml:mo> <mml:mi>ϕ</mml:mi></mml:mrow></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>X</mml:mi> <mml:mo>,</mml:mo> <mml:msup><mml:mi>X</mml:mi> <mml:mo>′</mml:mo></mml:msup> <mml:mo>)</mml:mo></mml:mrow></mml:mrow> <mml:mrow><mml:mo>=</mml:mo> <mml:msubsup><mml:mi>σ</mml:mi> <mml:mrow><mml:mi>s</mml:mi> <mml:mi>i</mml:mi> <mml:mi>g</mml:mi> <mml:mi>n</mml:mi> <mml:mi>a</mml:mi> <mml:mi>l</mml:mi></mml:mrow> <mml:mn>2</mml:mn></mml:msubsup> <mml:mtext>exp</mml:mtext> <mml:mrow><mml:mo>(</mml:mo> <mml:mo>-</mml:mo> <mml:mfrac><mml:mrow><mml:mrow><mml:mo>∥</mml:mo> <mml:mi>X</mml:mi></mml:mrow> <mml:mo>-</mml:mo> <mml:msup><mml:mi>X</mml:mi> <mml:mo>′</mml:mo></mml:msup> <mml:msup><mml:mrow><mml:mo>∥</mml:mo></mml:mrow> <mml:mn>2</mml:mn></mml:msup></mml:mrow> <mml:mrow><mml:mn>2</mml:mn> <mml:msup><mml:mi>l</mml:mi> <mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mfrac> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>+</mml:mo> <mml:mi>I</mml:mi> <mml:msubsup><mml:mi>σ</mml:mi> <mml:mrow><mml:mi>n</mml:mi> <mml:mi>o</mml:mi> <mml:mi>i</mml:mi> <mml:mi>s</mml:mi> <mml:mi>e</mml:mi></mml:mrow> <mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:math></alternatives> <label>(5)</label></disp-formula>
<disp-formula id="pcbi.1007205.e007"><alternatives><graphic id="pcbi.1007205.e007g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007205.e007" xlink:type="simple"/><mml:math display="block" id="M7"><mml:mi>ϕ</mml:mi> <mml:mrow><mml:mo>=</mml:mo> <mml:mo>{</mml:mo> <mml:mi>l</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>σ</mml:mi> <mml:mrow><mml:mi>s</mml:mi> <mml:mi>i</mml:mi> <mml:mi>g</mml:mi> <mml:mi>n</mml:mi> <mml:mi>a</mml:mi> <mml:mi>l</mml:mi></mml:mrow></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>σ</mml:mi> <mml:mrow><mml:mi>n</mml:mi> <mml:mi>o</mml:mi> <mml:mi>i</mml:mi> <mml:mi>s</mml:mi> <mml:mi>e</mml:mi></mml:mrow></mml:msub> <mml:mo>}</mml:mo></mml:mrow></mml:math></alternatives> <label>(6)</label></disp-formula>
Here <italic>I</italic> is the identity matrix. The signal variance <italic>σ</italic><sub><italic>signal</italic></sub> models the amplitude of the signal. The noise variance <italic>σ</italic><sub><italic>noise</italic></sub> reflects the uncertainty associated with the signal, and is modelled as additive Gaussian distributed noise. Jointly, the kernel and its hyperparameters form a prior distribution over the function we wish to infer. We used the log marginal likelihood
<disp-formula id="pcbi.1007205.e008"><alternatives><graphic id="pcbi.1007205.e008g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007205.e008" xlink:type="simple"/><mml:math display="block" id="M8"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>l</mml:mi> <mml:mi>o</mml:mi> <mml:mi>g</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>p</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>y</mml:mi> <mml:mo>|</mml:mo> <mml:mi>X</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:mo>-</mml:mo> <mml:mfrac><mml:mn>1</mml:mn> <mml:mn>2</mml:mn></mml:mfrac> <mml:msup><mml:mi>y</mml:mi> <mml:mi>T</mml:mi></mml:msup> <mml:msup><mml:mrow><mml:mo>[</mml:mo> <mml:mi>k</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>X</mml:mi> <mml:mo>,</mml:mo> <mml:msup><mml:mi>X</mml:mi> <mml:mo>′</mml:mo></mml:msup> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>]</mml:mo></mml:mrow> <mml:mrow><mml:mo>-</mml:mo> <mml:mn>1</mml:mn></mml:mrow></mml:msup> <mml:mi>y</mml:mi></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mo>-</mml:mo> <mml:mfrac><mml:mn>1</mml:mn> <mml:mn>2</mml:mn></mml:mfrac> <mml:mi>l</mml:mi> <mml:mi>o</mml:mi> <mml:mi>g</mml:mi> <mml:mrow><mml:mo>|</mml:mo> <mml:mrow><mml:mo>[</mml:mo> <mml:mi>k</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>X</mml:mi> <mml:mo>,</mml:mo> <mml:msup><mml:mi>X</mml:mi> <mml:mo>′</mml:mo></mml:msup> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>]</mml:mo></mml:mrow> <mml:mo>|</mml:mo></mml:mrow> <mml:mo>+</mml:mo> <mml:mo>-</mml:mo> <mml:mfrac><mml:mi>n</mml:mi> <mml:mn>2</mml:mn></mml:mfrac> <mml:mi>l</mml:mi> <mml:mi>o</mml:mi> <mml:mi>g</mml:mi> <mml:mn>2</mml:mn> <mml:mi>π</mml:mi></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(7)</label></disp-formula>
as an objective function to define the quality of the model with respect to the observations and to infer the hyperparameters <italic>ϕ</italic>. In the simplest case of <xref ref-type="fig" rid="pcbi.1007205.g002">Fig 2</xref>, where we model the activity of ROI <italic>i</italic> to local or full-field chirp stimuli described by the parameter vector <italic>θ</italic>, the predictor matrix <italic>X</italic> = (<italic>t</italic><sub>1</sub>, <italic>t</italic><sub>2</sub>, …, <italic>t</italic><sub><italic>T</italic></sub>) simply corresponds to the time points and the neural activity is modeled as
<disp-formula id="pcbi.1007205.e009"><alternatives><graphic id="pcbi.1007205.e009g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007205.e009" xlink:type="simple"/><mml:math display="block" id="M9"><mml:mrow><mml:msub><mml:mi>F</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mo>,</mml:mo> <mml:mi>θ</mml:mi></mml:mrow></mml:msub> <mml:mo>∼</mml:mo> <mml:mi>G</mml:mi> <mml:mi>P</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>m</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>X</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>,</mml:mo> <mml:msub><mml:mi>k</mml:mi> <mml:mrow><mml:mi>R</mml:mi> <mml:mi>B</mml:mi> <mml:mi>F</mml:mi> <mml:mo>,</mml:mo> <mml:mi>ϕ</mml:mi></mml:mrow></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>X</mml:mi> <mml:mo>,</mml:mo> <mml:msup><mml:mi>X</mml:mi> <mml:mo>′</mml:mo></mml:msup> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives> <label>(8)</label></disp-formula>
The inferred function, where the GP has been conditioned on the observations, inferred for a new set of points, is defined as
<disp-formula id="pcbi.1007205.e010"><alternatives><graphic id="pcbi.1007205.e010g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007205.e010" xlink:type="simple"/><mml:math display="block" id="M10"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msubsup><mml:mi>F</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mo>,</mml:mo> <mml:mi>θ</mml:mi></mml:mrow> <mml:mo>*</mml:mo></mml:msubsup> <mml:mrow><mml:mo>|</mml:mo></mml:mrow> <mml:msup><mml:mi>X</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>,</mml:mo> <mml:mi>X</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>F</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mo>,</mml:mo> <mml:mi>θ</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mo>∼</mml:mo> <mml:mi mathvariant="script">N</mml:mi> <mml:mo>(</mml:mo> <mml:msub><mml:mi>μ</mml:mi> <mml:mi>ϕ</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msup><mml:mi>X</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>,</mml:mo> <mml:mi>X</mml:mi> <mml:mo>)</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mo>Σ</mml:mo> <mml:mi>ϕ</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msup><mml:mi>X</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>,</mml:mo> <mml:mi>X</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(9)</label></disp-formula></p>
<p>The stimulus <italic>θ</italic> determines the predictor matrices <italic>X</italic> and <italic>X</italic>*, which can include more stimulus parameters than time (sinusoid, moving bar). The functions <italic>μ</italic><sub><italic>p</italic></sub><italic>hi</italic> and Σ<sub><italic>ϕ</italic></sub> are defined in <xref ref-type="sec" rid="sec016">Materials and methods</xref>. The hyperparameters <italic>σ</italic><sub><italic>signal</italic></sub> and <italic>σμ</italic><sub><italic>ϕ</italic></sub> can be used to compute uncertainty estimates of the neural activity. The uncertainty associated with the mean function, which we refer to as the “latent uncertainty”, is calculated using <xref ref-type="disp-formula" rid="pcbi.1007205.e010">Eq (9)</xref>, where the Gaussian noise component <inline-formula id="pcbi.1007205.e011"><alternatives><graphic id="pcbi.1007205.e011g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007205.e011" xlink:type="simple"/><mml:math display="inline" id="M11"><mml:msubsup><mml:mi>σ</mml:mi> <mml:mrow><mml:mi>n</mml:mi> <mml:mi>o</mml:mi> <mml:mi>i</mml:mi> <mml:mi>s</mml:mi> <mml:mi>e</mml:mi></mml:mrow> <mml:mn>2</mml:mn></mml:msubsup></mml:math></alternatives></inline-formula> is excluded in the kernel <italic>k</italic> (see <xref ref-type="sec" rid="sec016">Materials and methods</xref>).</p>
</sec>
</boxed-text>
<p>Using 2P recordings of calcium and glutamate dynamics in isolated mouse retina, we demonstrate how these models can be used to construct probabilistic representations of neural activity. We treat several use cases: First, we show that GP-based analysis of 2P recordings can be used to perform comparisons between the responses of a given cell under different conditions, allowing one to identify parts of the response with significant differences. Second, we exploit the properties of the GPs to perform a hierarchical clustering of cell responses and provides quantitative criteria for deciding how many clusters to keep. In addition, we use the framework to test which stimulus parameters influence neural activity in an ANOVA-like framework. Finally, we explore how the representation of uncertainty can be exploited for experimental design, informing the choice of parameters to optimally reduce the uncertainty about the neural response.</p>
</sec>
<sec id="sec003" sec-type="results">
<title>Results</title>
<p>We applied a Bayesian framework based on Gaussian Process (GP) regression to efficiently infer neural activity with uncertainty estimates from recordings of light stimulus-driven activity in the mouse retina. The retina decomposes a stream of images into parallel channels representing salient stimulus features. The central circuit of this network is a feedforward pathway relaying the initial signal from the photoreceptors through the intermediate bipolar cells to retinal ganglion cells (RGCs), and from there through the optic nerve to the rest of the visual system. Inhibitory interneurons called horizontal and amacrine cells play key roles in the adaptation and feature extraction (for review, see [<xref ref-type="bibr" rid="pcbi.1007205.ref006">6</xref>]). In the datasets analysed here, we measured three stages of the excitatory pathway: Firstly, the presynaptic calcium signal in the axon terminals of a bipolar cell using the synthetic indicator dyes Oregon-Green BAPTA-1 (OGB-1) and GCaMP6f (the latter data previously published in [<xref ref-type="bibr" rid="pcbi.1007205.ref007">7</xref>]). Secondly, the glutamate release from these terminals, as measured by the genetically-encoded biosensor iGluSnFR [<xref ref-type="bibr" rid="pcbi.1007205.ref008">8</xref>, <xref ref-type="bibr" rid="pcbi.1007205.ref009">9</xref>]. Finally, the calcium signal in RGC somata loaded with OGB-1 through bulk electroporation [<xref ref-type="bibr" rid="pcbi.1007205.ref010">10</xref>].</p>
<p>In our framework, a GP model (see <xref ref-type="boxed-text" rid="pcbi.1007205.box002">Box 2</xref> for mathematical primer) infers an estimate of the activity of a neuron from the observed fluorescence of each ROI in a scan field, which are typically cell somata or axon terminals. The estimated function models the “true” activation state of the neuron, i.e. the concentration of calcium or glutamate. In addition, we model the uncertainty about the estimated function including the observation noise, and the latent uncertainty about the activity function, once the observation noise is removed.</p>
<sec id="sec005">
<title>Modelling uncertainty using Gaussian processes</title>
<p>Our first objective was to infer the neural activity function and its associated uncertainty from our observations of the activity of single ROIs, located on individual synaptic axon terminals of a bipolar cell. In bipolar cells injected with the calcium indicator OGB-1, it is possible to image the anatomy of the cell by recording 3D stacks of x-y images at regular intervals along the vertical (z) axis (<xref ref-type="fig" rid="pcbi.1007205.g001">Fig 1a</xref>). High resolution scans allowed us to identify individual axon terminals (<xref ref-type="fig" rid="pcbi.1007205.g001">Fig 1b</xref>). Faster scans with lower spatial resolution are required to resolve neural activity, although the required reduction in resolution is substantially less for spiral configurations relative to classical linear configurations (<xref ref-type="fig" rid="pcbi.1007205.g001">Fig 1c and 1d</xref>). Although the scan patterns are highly regular, the spatial organisation of the neural structures results in irregular sampling over time (<xref ref-type="fig" rid="pcbi.1007205.g001">Fig 1e–1h</xref>).</p>
<fig id="pcbi.1007205.g001" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1007205.g001</object-id>
<label>Fig 1</label>
<caption>
<title>Two-photon imaging of retinal neurons.</title>
<p>Data: Retinal bipolar cell filled with OGB-1 via sharp electrode injection and recorded using linear and spiral scan configurations. <bold>a</bold>: Vertical profile. Image coloured according to fluorescence intensity (yellow: high, blue: low). <bold>b</bold>: Horizontal (x-y), high-resolution scan of axon terminal system (512 x 512 pixels), corresponding to the domain between the two white ticks in (a). <bold>c</bold>: Spiral scan of axon terminal system (16 spirals; 31.25 Hz), as above. <bold>d</bold>: Linear scan of axon terminal system (32 lines; 15.625 Hz), as above. <bold>e</bold>: Spiral scan trajectory with ROI mask superimposed. Black lines indicate scan trajectory. Colours correspond to discrete ROIs. <bold>f</bold>: As (e), but with a linear scan configuration. The same ROIs were used. <bold>g</bold>: Time points at which the scan trajectory intersects with the ROI mask in (e). 64 ms span corresponds to two spiral scan frames. <bold>h</bold>: As (g), but for a linear scan configuration. ROIs correspond to those in (f). 64 ms span corresponds to one linear scan frame.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1007205.g001" xlink:type="simple"/>
</fig>
<p>We recorded bipolar cell calcium and glutamate signals measured during the presentation of a spatially homogeneous light stimulus including a light step and variations in temporal frequency and contrast (<xref ref-type="fig" rid="pcbi.1007205.g002">Fig 2a</xref>, chirp stimulus), as used in previous studies [<xref ref-type="bibr" rid="pcbi.1007205.ref007">7</xref>, <xref ref-type="bibr" rid="pcbi.1007205.ref011">11</xref>]. We used the observed activity of a ROI (<xref ref-type="fig" rid="pcbi.1007205.g002">Fig 2b</xref>), and inferred a signal for each repeat using frame-averaging and cubic-spline interpolation (<xref ref-type="fig" rid="pcbi.1007205.g002">Fig 2c</xref>), corresponding to the classical way of inferring these functions (i.e. [<xref ref-type="bibr" rid="pcbi.1007205.ref007">7</xref>, <xref ref-type="bibr" rid="pcbi.1007205.ref011">11</xref>]).</p>
<fig id="pcbi.1007205.g002" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1007205.g002</object-id>
<label>Fig 2</label>
<caption>
<title>Inference of signals from two-photon data.</title>
<p>Data: ROI from a retinal bipolar cell filled with OGB-1 via sharp electrode injection (left), and a different ROI from a scan field with bipolar cell terminals in a retina expressing iGluSnFR (right); both recorded using spiral scan configurations. Model: RBF kernel, 300 inducing inputs, 25 iterations per fit, best of 6 fits per model. <bold>a</bold>: “Full-field chirp” light stimulus, consisting of a light step, a frequency-modulated sine wave and a contrast-modulated sine wave. <bold>b</bold>: Observed activity of a single ROI. Each point corresponds to the mean activity of the ROI in a single scan line. The time at which the point was recorded is defined relative to the start of each stimulus trial, such that each trial leads to at least one data point for every time the laser scans across a given ROI. Information regarding the trial from which the point was derived is not explicitly incorporated into the model. <bold>c</bold>: Estimate of underlying signal from frame averaging, cubic spline interpolation and averaging over trials. This corresponds to the typical approach used in previous papers [<xref ref-type="bibr" rid="pcbi.1007205.ref007">7</xref>]. <bold>d</bold>: Fitted sparse Gaussian process. Black line indicates the mean signal. Intervals indicate uncertainty of the signal with and without the observation noise (light and dark grey, respectively), to 3 standard deviations. <bold>e</bold>: Fitted sparse warped Gaussian process. Input warping uses the warping function shown in the following figure. Model has been projected back onto the original time dimension. <bold>f</bold>: Five posterior samples drawn from the fitted sparse warped Gaussian process models.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1007205.g002" xlink:type="simple"/>
</fig>
<p>We then fitted a GP with a radial basis function (RBF) kernel for the time dimension to the observed activity (<xref ref-type="fig" rid="pcbi.1007205.g002">Fig 2d</xref>). We monitored the computation time and calculated the likelihood of an out-of-sample test set to determine a suitable number of inducing inputs. Surprisingly, this indicated that there was already little improvement in the performance of the model when more than 250 data points were used (<xref ref-type="supplementary-material" rid="pcbi.1007205.s001">S1a and S1b Fig</xref>), and that relatively few iterations of the fitting algorithm were required (<xref ref-type="supplementary-material" rid="pcbi.1007205.s001">S1c Fig</xref>).</p>
<p>To account for temporal non-stationarities in the neural response, we then compared the GP model to an extended model with input warping (see <xref ref-type="sec" rid="sec016">Methods</xref>). One assumption of classical GP models is that the function space has a stationary autocorrelation function, i.e. that its correlational structure does not change with respect to a predictor, such as time. However, light induced neural activity like responses to the chirp, which have highly non-stationary correlational structure, are likely to show a commensurate non-stationarity in the response. We computed a warping function which transforms the time dimension such that the stimulus input has a stationary autocorrelation structure (<xref ref-type="fig" rid="pcbi.1007205.g003">Fig 3a</xref>). We then used this warping function to transform the input to the GP model of the response, under the assumption that the correlational structure of the response matched that of the stimulus input [<xref ref-type="bibr" rid="pcbi.1007205.ref012">12</xref>, <xref ref-type="bibr" rid="pcbi.1007205.ref013">13</xref>](<xref ref-type="fig" rid="pcbi.1007205.g003">Fig 3b–3d</xref>). By performing this extra processing step, we were able to fit a model which could vary in its autocorrelation.</p>
<fig id="pcbi.1007205.g003" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1007205.g003</object-id>
<label>Fig 3</label>
<caption>
<title>Application of a warping function to model input features.</title>
<p>Data: ROI from a retinal bipolar cell filled with OGB-1 via sharp electrode injection. Model: RBF kernel, 300 inducing inputs, 20 iterations per fit, best of 3 fits per model. <bold>a</bold>: “Full-field chirp” stimulus (top). Autocorrelation functions corresponding to Gaussian curves fit to the empirical autocorrelation function over a 500 ms window (middle). Length scale parameter of the Gaussian distribution fitted to the autocorrelation functions. <bold>b</bold>: Cumulative sum of the inverse lengthscale over time. If the signal were stationary, the lengthscale would be constant, corresponding to the dashed line. This cumulative sum maps time onto a warped time dimension. <bold>c</bold>: Full field chirp stimulus with observations of the activity of one ROI labelled with OGB-1. <bold>d</bold>: The same stimulus and observations after a warping operation has been applied. <bold>e</bold>: GP fitted to the original data. <bold>f</bold>: GP fitted to the warped data. The function has been projected back onto un-warped time. Note the increased uncertainty in regions where the stimulus is changing rapidly and the variations in the smoothness of the inferred signal over time.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1007205.g003" xlink:type="simple"/>
</fig>
<p>Our results show a clear difference between the predictions of the warped GP model and the simpler stationary one. In the simpler model, the selected parameters reflect a trade-off between models which fit closely to each of the different stimulus components (i.e. steps vs. chirps), resulting in an inferred mean signal which appears noisy during the light step and poorly tracks the faster chirp oscillations. As a consequence, the inferred uncertainty was relatively stationary over time (<xref ref-type="fig" rid="pcbi.1007205.g003">Fig 3e</xref>). By contrast, in the warped GP model, the inferred mean signal during the light step was smoother and tracked the faster oscillations much more closely (<xref ref-type="fig" rid="pcbi.1007205.g003">Fig 3f</xref>). More importantly, in contrast to the interpolated signal derived by a classical pipeline, the warped GP infers a high level of uncertainty during periods of rapid oscillation which are at, or close to, the sampling limit of the recording.</p>
<p>In practice, we found that the approach described above was more stable and faster than inferring the autocorrelation function directly from the observed activity. This appeared to be due to two factors: the irregular sampling distribution of the observed activity and the observation noise. Estimating the autocorrelation function separately for each ROI added a considerable computational burden to the pre-processing pipeline. In principle, the approach demonstrated can be applied to any stimulus with a known time-course if it is spatially homogeneous. Where this is not the case, the temporal statistics of the observed response may also be influenced by spatial integration and an alternative model, which explicitly accounted for this, would be appropriate.</p>
</sec>
<sec id="sec006">
<title>Using GP models for statistical inference</title>
<p>The key benefit of the GP framework is that it provides an explicit estimate of the uncertainty about the neural activity which can be used to perform well calibrated statistical inference, e.g. for inferring which periods of neural activity differed between two conditions. This is in contrast to classical approaches, where typical analysis follows multiple smoothing steps and often only the inter-trial variability is considered, providing a poorly calibrated estimate of uncertainty.</p>
<p>In our framework, we use a GP equality test to identify whether two signals are statistically different [<xref ref-type="bibr" rid="pcbi.1007205.ref014">14</xref>]. As an example, we consider the response of bipolar cells to the chirp stimulus as a function of the spatial extent of the light spot. This is known to modulate bipolar cell responses, with the difference being induced by lateral inhibition [<xref ref-type="bibr" rid="pcbi.1007205.ref007">7</xref>, <xref ref-type="bibr" rid="pcbi.1007205.ref015">15</xref>–<xref ref-type="bibr" rid="pcbi.1007205.ref017">17</xref>]. We compared the calcium and glutamate signals of bipolar cells presented with chirp stimuli whose light spots differed in size (100<italic>μm</italic> and full field). We fitted a GP model with time warping to each of the sets of observations (<xref ref-type="fig" rid="pcbi.1007205.g004">Fig 4a and 4b</xref>), performed maximum likelihood estimation to optimise the GP parameters with respect to the data, and then computed the difference between the estimated latent functions.</p>
<fig id="pcbi.1007205.g004" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1007205.g004</object-id>
<label>Fig 4</label>
<caption>
<title>Gaussian process equality testing.</title>
<p>Data: ROI from a retinal bipolar cell filled with OGB-1 by sharp electrode injection (left), and a different ROI from a scan field with bipolar cell terminals in a retina expressing iGluSnFR (right); both recorded using spiral scan configurations. Model: GP w. Time Warp: RBF kernel, 300 inducing inputs, 20 iterations per fit, best of 5 fits per model. Classical: pipeline incorporating frame averaging and interpolation. <bold>a</bold>: “Chirp” light stimulus. <bold>b</bold>: Fits of the GP with time warping and classical pipeline to chirp-driven responses, for calcium and glutamate data. Models fitted to observations of the responses to local (100 <italic>μ</italic>m; top) and full field (middle) chirp stimulus. Circles indicate relative spatial extent of the light stimulus. Difference between the models for the two stimulus conditions shown at the bottom. Intervals for the response data show 3 standard deviations above and below the mean function. This variability corresponds to the standard deviation with and without additive noise for the GPs, and the inter-trial standard deviation for the classical pipeline. Only the standard deviation without additive noise is shown for the difference of the GPs. Domains where zero-vector not included within this interval are highlighted with grey ticks, corresponding to regions where the difference between the two signals is greater than expected by chance. <bold>c</bold>: Frequency of discrete domains where zero-vector is not included in the credible intervals (also known as the Euler Characteristic; EC) as a function of the number of standard deviations above and below the respective mean functions. A high EC indicates a large degree of statistical separation between the two signals, and typically declines as the threshold increases. Bootstrap estimates of the null distribution of the EC are superimposed, with the mean of the null distributed shown in red. Intervals correspond to three standard deviations above and below the mean of the null distribution. The black box indicates the thresholds where the EC from the difference test exceeds the highest estimate from the null distribution by three standard deviations.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1007205.g004" xlink:type="simple"/>
</fig>
<p>We identified the periods of activity where the stimulus drives greater differences in the response than would be expected by chance (defined as the three standard deviations around the estimated difference function not including zero). We found the number of disconnected regions where the difference is greater than could be expected by chance, which is called the Euler characteristic (EC). It provides a measure of the strength of the difference between two signals (<xref ref-type="fig" rid="pcbi.1007205.g004">Fig 4c</xref>) and depends on the number of standard deviations chosen as a threshold. To estimate whether the EC was higher than expected by chance for a given threshold, we developed a bootstrap procedure for the GP models. We approximated a null distribution of the EC by shuffling the observed activity between the two conditions, and calculated an empirical p-value with respect to this null distribution of the EC.</p>
<p>If we assume a fixed threshold for calling two regions in the signal different (e.g. three s.d.), we did not find a significant difference between the two stimulus conditions (bootstrap: p ∼ 0.103, <italic>α</italic> = 0.01) for the calcium recordings, but for the glutamate recording (bootstrap: p ∼ 0, <italic>α</italic> = 0.01). Significant differences occurred during the light step and in both oscillatory sequences. The shuffle test can also be evaluated for the whole range of thresholds.</p>
<p>For comparison, we computed a similar test using the classical analysis pipeline, using inter-trial standard deviation as an estimate of the uncertainty associated with the mean signal. For the bootstrap procedure shuffled the interpolated data between the two stimulus conditions to approximate the null distribution. At the same threshold as above, for neither the calcium (bootstrap: p ∼ 0.062, <italic>α</italic> = 0.01) nor the glutamate (bootstrap: p ∼ 0.062, <italic>α</italic> = 0.01) recording was the EC found to be significantly elevated. It should be noted that the p-values estimated for the GP and classical pipeline are not directly comparable: the classical approach does not distinguish between observational and stimulus driven variability, rather identifying whether observed differences are greater than inter-trial variability.</p>
<p>The choice of a fixed threshold for inferring whether two signals are statistically distinct may result in overly conservative statistical estimates. While there were no thresholds for which the classical approach inferred an EC greater than expected from the null distribution, for the GP models of the calcium and glutamate signals there were a range of thresholds for which the EC was greater. These ranges differed between the two signals, which may relate to the effect of the physiological properties of these two signals or to the kinetics of their respective indicators on the dynamics of the observed signals. We recommend that the selection of a threshold be guided by the particular needs of the analysis task, not to keep to statistical conventions developed for other methods.</p>
</sec>
<sec id="sec007">
<title>Evaluating hierarchical clustering with GP models</title>
<p>We next show how GP equality tests can be used to provide a principled criterion for choosing the number of clusters in a hierarchical clustering of light responses. For example, in a single imaging plane, one may wish to know whether the observed responses originate form distinct functional groups, perhaps due to the presence of multiple cells or cell types within the recording plane, or multiple neurites of the same cell acting independently [<xref ref-type="bibr" rid="pcbi.1007205.ref018">18</xref>].</p>
<p>This pipeline was composed of two stages, firstly identifying putative clusters, then evaluating the evidence for different cluster configurations. In the first stage, a GP was estimated for each ROI in GCaMP6f labelled bipolar cell axon terminals in a PCP2 mouse line (data previously published in [<xref ref-type="bibr" rid="pcbi.1007205.ref007">7</xref>]). Then, we hierarchically clustered the mean signals from each GP to identify putative clusters among the set of responses, using the Ward algorithm and Euclidean distance (<xref ref-type="fig" rid="pcbi.1007205.g005">Fig 5a</xref>).</p>
<fig id="pcbi.1007205.g005" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1007205.g005</object-id>
<label>Fig 5</label>
<caption>
<title>Hierarchical clustering of retinal bipolar cell terminals.</title>
<p>Data: ROIs from a retinal bipolar cell filled with OGB-1 by sharp electrode injection recorded using a linear scan configuration. Model: RBF kernel (time), 300 inducing inputs, 20 iterations per fit, best of 3 fits per model. One model fitted for each ROI. <bold>a</bold>: Mean functions of GP models fitted to calcium activity in a single recording field. Dendrogram computed using the Ward’s hierarchical clustering algorithm (left). Nodes where the equality test were performed are labelled N. Colours on the dendrogram correspond to putative clusters. <bold>b</bold>: ROI masks overlaid on mean field activity, coloured with respect to the putative cluster. Each overlay is coloured according to the clustering at the corresponding nodes in (a). <bold>c</bold>: Euler Characteristic for each node with respect to the z-score threshold. <bold>d</bold>, <bold>e</bold>, <bold>f</bold>: GP Equality tests performed at each of the labelled nodes. GPs correspond to the models fitted to each putative cluster (top, middle) and the difference between the two models (bottom). Intervals correspond to 3 standard deviations above and below mean function. Domains where zero-vector not included within interval highlighted with grey ticks. <bold>g</bold>, <bold>h</bold>, <bold>i</bold>: Bootstrap estimates of the null distribution of the Euler Characteristic (EC). Mean of null distributed shown in red. Intervals correspond to three standard deviations above and below the mean of the null distribution. Estimated EC from (c) superimposed. The black box indicates the thresholds where the EC from the difference test exceeds the highest estimate from the null distribution.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1007205.g005" xlink:type="simple"/>
</fig>
<p>Each node in the hierarchy then corresponded to a hypothesis about whether a particular cluster should be partitioned into two sub-clusters (<xref ref-type="fig" rid="pcbi.1007205.g005">Fig 5b</xref>). In the second stage, we start at the top of the clustering. At each node, we fit two GPs to the data from all ROIs assigned to each of the two clusters independently.</p>
<p>We then tested the hypothesis that the two clusters were different using a GP equality test with the EC as the measure of dissimilarity (<xref ref-type="fig" rid="pcbi.1007205.g005">Fig 5c–5f</xref>). A null distribution for the Euler Characteristic was approximated by a further bootstrap test, where the pair of signals for which the null distribution of the EC was calculated were drawn at random from the pooled observations at each node. This process continued iteratively through the hierarchy, terminating when the Euler Characteristic for a split in two new clusters was not greater than 99.5% of the null distribution at that node.</p>
<p>Interestingly, the first node (<italic>N</italic><sub>0</sub>) separated ROIs belonging to two bipolar cells in the imaging field, with strong quantitative backup for the split (bootstrap: p ∼ 0 at three s.d., <italic>α</italic> = 0.01, <xref ref-type="fig" rid="pcbi.1007205.g005">Fig 5g</xref>). The split at the second node (<italic>N</italic><sub>1</sub>) was also accepted (bootstrap: p ∼ 0, <italic>α</italic> = 0.01 at three s.d., <xref ref-type="fig" rid="pcbi.1007205.g005">Fig 5h</xref>), which separates ROIs of the left bipolar cell into two groups, indicating potential sub-clusters within the terminals of a single bipolar cell. Subsequent separations were rejected (<italic>N</italic><sub>2</sub>, bootstrap: p ∼ 0.68, <italic>α</italic> = 0.01 at three s.d., <xref ref-type="fig" rid="pcbi.1007205.g005">Fig 5i</xref>). The difference observed within the terminal systems of these cells may reflect functional variation within the output of a single bipolar cell [<xref ref-type="bibr" rid="pcbi.1007205.ref019">19</xref>]. Were this difference to exist, it would likely be a consequence of differential inhibition from amacrine cells, and represent an additional layer of complexity in the functional parallelisation of retinal signalling. While our analysis is suggestive of this conclusion, verification is beyond the scope of this study.</p>
</sec>
<sec id="sec008">
<title>Incorporating stimulus effects into GP model inference</title>
<p>We next extended our GP framework to study the effect of multiple stimulus parameters and their interactions on the latent neural activity in an ANOVA-like framework [<xref ref-type="bibr" rid="pcbi.1007205.ref020">20</xref>]. GP-ANOVA models posses multiple kernels, each of which models the effect of a predictor or an interaction between predictors. In contrast to classical ANOVA, the interaction effects can have non-linear structure [<xref ref-type="bibr" rid="pcbi.1007205.ref020">20</xref>], and it is possible to compute not merely the strength of particular effects but also an inference of the response of a ROI over time as a stimulus feature varies.</p>
<p>To demonstrate the usefulness of this extension, we fitted a GP model to predict the response of a single ROI to a light stimulus where light intensity was modulated as a sine wave of varying frequency and contrast (<xref ref-type="fig" rid="pcbi.1007205.g006">Fig 6a</xref>). The input for this model was a predictor matrix where each column corresponded to one of the stimulus parameters, including two columns jointly encoding phase as a circular feature, and one each for frequency and contrast (see <xref ref-type="sec" rid="sec016">Methods</xref>).</p>
<fig id="pcbi.1007205.g006" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1007205.g006</object-id>
<label>Fig 6</label>
<caption>
<title>Extended GP model incorporating stimulus parameters.</title>
<p>Data: ROI from a scan field with bipolar cell terminals in a retina expressing iGluSnFR, recorded using a spiral scan configuration. Model: Product of RBF kernel (time) with composite RBF kernels (frequency and contrast), 500 inducing inputs, 50 iterations per fit, best of 5 fits per model. <bold>a</bold>: Observed activity of one ROI filled with OGB-1 (top); GP model selected by model selection procedure, conditioned on the observations of the ROI. Sine stimulus activity. Data corresponds to the first 9s of the stimulus. <bold>b</bold>: Negative log likelihood for each model tested during model selection. Each point corresponds to a single model, where the kernel consists of the effects adopted in the previous pass, with an additional effect being evaluated, which will be included if it has the highest negative log likelihood. Each “Pass” corresponds to an exhaustive evaluation of all possible effects to add to the current kernel. The best performing model in each pass is highlighted with a black circle. <bold>c</bold>: Locations in frequency-contrast parameter space selected for the stimulation. Colour map corresponds to the sum of the variance of the latent function for the fitted GP model evaluated under each parameter combination. Crosses correspond to peaks in the uncertainty where the stimulus should next be evaluated. Dashed line indicates the limits of the space from which the parameters were sampled. <bold>d</bold>: GP fitted to observed chirp responses for the same ROI (middle). Prediction of the activity by the model on the sine stimulus data (top).</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1007205.g006" xlink:type="simple"/>
</fig>
<p>For the experiments, we selected 150 stimulus parameters using blue noise sampling, such that parameters were uniformly selected from the parameter space and excluded if they were below certain thresholds for frequency (&lt; 1Hz) or contrast (&lt; 10%) or too close to an already existing stimulus parameter. Although the frequency and contrast parameters are fixed during each one second trial of the sine stimulus, the model can accommodate parameters which vary continuously over time, by encoding this change in the columns of the predictor matrix.</p>
<p>As in a classical ANOVA, there are many possible ways in which the effects of these stimulus parameters can be incorporated into the model. In this case, stimulus features were encoded in the kernel (see <xref ref-type="sec" rid="sec016">Methods</xref>), either as additive independent effects of phase, contrast or frequency, or through multiplicative interactions between the features. The cost of adding more kernels with a fixed amount of data is that the uncertainty associated with each parameter increases as the number of parameters to be learned grows. To compensate for this, we performed kernel selection through a two stage iterative process (<xref ref-type="fig" rid="pcbi.1007205.g006">Fig 6b</xref>). The first stage identified the kernel which, when included, most strongly improved model performance, as measured by the log marginal likelihood. Once there were two or more parameters, each new kernel had to contribute a greater improvement to the model performance than could be expected by chance, as established by a likelihood ratio test (see <xref ref-type="sec" rid="sec016">Methods</xref>). If a kernel was accepted it was retained in the model in the consecutive iterations (for an overview of the models evaluated in this pipeline, see <xref ref-type="supplementary-material" rid="pcbi.1007205.s003">S1</xref> and <xref ref-type="supplementary-material" rid="pcbi.1007205.s004">S2</xref> Tables).</p>
<p>We fitted a GP model to the glutamate signal of a single ROI in the IPL in response to the sine stimulus using this procedure. After three iterations the improvement in model performance was less than the required ratio. We tested one further iteration which also returned a negative result, and the process ceased. The kernels which were accepted included an interaction kernel between all three parameters and a frequency-contrast kernel (Λ = 11.25, <italic>p</italic> &lt; 0.001). A frequency kernel (Λ = 4.01946568, <italic>p</italic> = 0.045) was rejected in the third stage, and a phase kernel was rejected (Λ = 2.29, <italic>p</italic> = 0.130).</p>
<p>We then used the model to predict neural activity for unseen parameter combinations and quantified how uncertain our predictions about the activity in response to these were [<xref ref-type="bibr" rid="pcbi.1007205.ref021">21</xref>–<xref ref-type="bibr" rid="pcbi.1007205.ref023">23</xref>]. Intuitively, the model should have the least uncertainty about stimulus parameters which had been observed. Uncertainty then should increase as a function of the distance from the observed parameters. We quantified uncertainty by computing the expected response of the ROI and taking the sum of the latent variance (<xref ref-type="fig" rid="pcbi.1007205.g006">Fig 6c</xref>).</p>
<p>For the studied cell, calcium recordings to stimulation with the chirp stimulus were also available (<xref ref-type="fig" rid="pcbi.1007205.g006">Fig 6d</xref>), and we compared the model fitted directly to the chirp response data to predictions from the model fitted to the sine data. There were some qualitative similarities between the two models, such as the overall amplitude of the signal, and the decrease in signal amplitude as the frequency of the stimulus increased. The prediction that the signal amplitude would slightly increase with contrast was not reflected in the chirp data, where the relationship was more ambiguous. The quality of prediction of the activity at high frequencies was difficult to evaluate, as there is a high-level of uncertainty about the mean signal at those frequencies. One factor to consider with regards to this direct comparison is that the differences in the chirp responses may be due to temporal dependencies over time.</p>
</sec>
<sec id="sec009">
<title>Active Bayesian experimentation</title>
<p>A critical advantage of our framework is that we can use it for Bayesian experimental design. This is useful, as in 2P imaging experiments time is usually severely limited. For example, isolated mouse retinal tissue becomes unresponsive to light stimulation in a matter of hours, and single recording fields often bleach within half an hour of recording. To efficiently explore the space of possible stimulus features under severe time constraints is thus a critical problem, which GP models can be used to address [<xref ref-type="bibr" rid="pcbi.1007205.ref021">21</xref>, <xref ref-type="bibr" rid="pcbi.1007205.ref022">22</xref>].</p>
<p>To show how this works, we performed an experiment using GP models to guide parameter selection. In retinal tissue expressing iGluSnFR we selected a single ROI, likely representing a single bipolar cell axon terminal. We used two control stimuli to evaluate the parameter selection: a local chirp stimulus playing over three trials, to which we fitted a warped GP, and a sinusoidal stimulus with 90 parameters uniformly sampled from the parameter space (<xref ref-type="fig" rid="pcbi.1007205.g007">Fig 7a</xref>), to which we fitted a GP with the kernels derived in the previous likelihood ratio procedure. We performed three rounds of active parameter selection, starting with 30 uniformly sampled parameters in the first iteration, fitting the GP and using parameters selected by identifying 30 peaks in the uncertainty map in the subsequent two iterations. We then used the models from each iteration to predict how the ROI would respond during the oscillatory components of the chirp stimulus (<xref ref-type="fig" rid="pcbi.1007205.g007">Fig 7b</xref>).</p>
<fig id="pcbi.1007205.g007" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1007205.g007</object-id>
<label>Fig 7</label>
<caption>
<title>Active parameter selection with Gaussian processes.</title>
<p>Data: ROI from a scan field with bipolar cell terminals in a retina expressing iGluSnFR, recorded using a spiral scan configuration. Model: Product of RBF kernel (time) with composite RBF kernels (frequency and contrast), 500 inducing inputs, 50 iterations per fit, best of 4 fits per model. <bold>a</bold>: Control stimulus consisting of 90 parameter sets of frequency and contrast. Uncertainty in each region computed as the sum of the latent uncertainty for a GP estimated under all parameter configurations. The chirp response for this ROI is shown above. The completed GP model for the sine response is estimated over the full dataset, the model inference for the sinusoidal chirp components is shown. <bold>b</bold>: Active parameter selection using GP with corresponding inferences for chirp stimulus.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1007205.g007" xlink:type="simple"/>
</fig>
<p>Parameters selected using the active approach were more broadly distributed across the parameter space, although we noted that the peak finding algorithm was biased away from the edges. In the purely random design procedure, parameters often clustered and there were large empty regions, resulting in high uncertainty in these regions. Neither the random nor the active parameter procedure inferred a good prediction of the contrast-varying chirp component, which in the case of the active parameter inference was likely due to the bias away from the periphery of the parameter space, resulting in very few samples in the proximity of the 8Hz parametric edge. At lower frequencies the experimental design algorithm seemed better able to capture qualitative aspects of the chirp response, such as the decrease in response amplitude as the frequency increased, though again the lack of samples at the very highest frequencies resulted in a high level of uncertainty.</p>
</sec>
<sec id="sec010">
<title>Combining model components</title>
<p>We finally constructed a model which combined stimulus effect modelling and hierarchical clustering into a single framework. We fitted the model to calcium recordings of RGC activity in response to a bright bar moving in different directions on a dark background. RGCs show different response polarities and a large range of response kinetics to this stimulus [<xref ref-type="bibr" rid="pcbi.1007205.ref011">11</xref>] and some modulate the response amplitude as a function of stimulus direction. The model incorporated the stimulus features of time and direction as additive effects, alongside with a time-direction interaction effect (<xref ref-type="fig" rid="pcbi.1007205.g008">Fig 8a and 8b</xref>). The data were then sorted using hierarchical clustering (<xref ref-type="fig" rid="pcbi.1007205.g008">Fig 8c and 8d</xref>; <xref ref-type="supplementary-material" rid="pcbi.1007205.s002">S2 Fig</xref>) and for the purpose of demonstration the first three nodes of the hierarchy were tested using GP equality tests (<xref ref-type="fig" rid="pcbi.1007205.g008">Fig 8e–8h</xref>).</p>
<fig id="pcbi.1007205.g008" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1007205.g008</object-id>
<label>Fig 8</label>
<caption>
<title>GP model of retinal ganglion cell responses to a moving bar stimulus.</title>
<p>Data: ROIs from a field of RGC somata labelled with OGB-1 using electroporation, recorded using a spiral scan configuration. Model: Product of RBF kernel (time) with composite RBF kernel (direction), 300 inducing inputs, 25 iterations per fit, best of 3 fits per model. <bold>a</bold>: Observed activity of one ROI representing an RGC soma labelled with OGB-1 (top). GP model superimposed. Intervals correspond to the variance of the latent function, 3 standard deviations above and below the mean. Below are the moving bar directions for each trial. <bold>b</bold>: GP model fitted to data in (a) without (top) and with (bottom) interaction kernel. Both models include additive effects for direction and time. Coloured according to response amplitude (red: high, blue: low). <bold>c</bold>: Hierarchical clustering of fitted models. Colours on dendrogram correspond to colours on ROI mask. Posterior means for each ROI in each cluster are shown in <xref ref-type="supplementary-material" rid="pcbi.1007205.s002">S2 Fig</xref>. <bold>d</bold>: ROI mask with cluster colours for <italic>k</italic> = 4 corresponding to clustering in (c). A baseline s.d. was computed from the 500 ms of activity preceding the light step. ROIs where the amplitude of the step response was less than 2 s.d. greater or lower than the mean signal were excluded. <bold>e</bold>, <bold>f</bold>, <bold>g</bold>: GP Equality Tests for each node. Top and middle correspond to the two putative clusters, bottom is the mean difference between them. <bold>h</bold>: Euler Characteristic as a function of the number of standard deviations above and below the respective mean functions, for each node. <bold>i</bold>, <bold>j</bold>, <bold>k</bold>: Euler Characteristics (EC) from difference tests at the first three nodes, with bootstrap estimates of the null distribution of the EC superimposed. The mean of the null distributed shown in red. Intervals correspond to three standard deviations above and below the mean of the null distribution. The black bar indicates the thresholds where the EC from the difference test exceeds the highest estimate from the null distribution by three standard deviations.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1007205.g008" xlink:type="simple"/>
</fig>
<p>The algorithm first separated ON and OFF responses into separate clusters (<italic>N</italic><sub>0</sub>, bootstrap: p ∼ 0 at three s.d., <xref ref-type="fig" rid="pcbi.1007205.g008">Fig 8i</xref>). The ON cluster was then further divided into sustained and transient responses (<italic>N</italic><sub>1</sub>, bootstrap: p ∼ 0 at three s.d., <xref ref-type="fig" rid="pcbi.1007205.g008">Fig 8j</xref>). The sustained ON responses were finally separated into direction selective and non-direction selective clusters (<italic>N</italic><sub>2</sub>, bootstrap: p ∼ 0.01 at three s.d., <xref ref-type="fig" rid="pcbi.1007205.g008">Fig 8k</xref>). We did not test further splits for significance.</p>
</sec>
</sec>
<sec id="sec011" sec-type="conclusions">
<title>Discussion</title>
<p>Here we presented a data analysis pipeline for 2P imaging data based on Gaussian Processes. The advantage of this framework is that uncertainty about the underlying latent neural activity can be propagated through the analysis pipeline, so statistical inference can be performed in a principled way. We applied our pipeline to recordings of mouse retinal bipolar and ganglion cell activity driven by light stimuli, showing how: (1) to determine whether and when two response functions are statistically distinct; (2) to evaluate the strength of the evidence for a partition of data into functional clusters; (3) to determine the relevant stimulus effects to incorporate into a model of neural responses; and (4) to guide the choice of stimulus parameters for iterations of a closed loop adaptive experiment.</p>
<sec id="sec012">
<title>Estimation of uncertainty</title>
<p>Accurately characterising the variability of neural responses is essential for understanding neural coding. Noise manifests itself throughout sensory systems and presents a fundamental problem for information processing [<xref ref-type="bibr" rid="pcbi.1007205.ref002">2</xref>]. While imaging <italic>ex-vivo</italic> retinal tissue does not present some of the challenges as <italic>in vivo</italic> cortical recordings (where movement is a significant source of variability), two-photon imaging in <italic>ex-vivo</italic> tissue is still subject to many sources of variance, due to fluctuations in biosensor excitation and photon detection, among other factors. This issue may be particularly acute for two-photon imaging of retinal tissue, where it is necessary to keep the excitation energy low to avoid laser-evoked responses, which may result in lower overall fluorescent signals relative to in vivo recordings of non-light-sensitive tissue. Computational processing can introduce further variability, e.g. due to the discretisation of the measured signal. This is rarely acknowledged, perhaps due to the convenience of standard approaches. In principle, splines in combination with generalized additive models (GAMs, e.g. [<xref ref-type="bibr" rid="pcbi.1007205.ref024">24</xref>]) provide an alternative framework to perform uncertainty aware analysis of calcium imaging data. Exploring and contrasting this to the GP framework introduced here is beyond the scope of this paper.</p>
</sec>
<sec id="sec013">
<title>Computational limitations of the proposed models</title>
<p>Classical GP models can be computationally costly due to the need to compute the inverse of the kernel matrix involving all training data [<xref ref-type="bibr" rid="pcbi.1007205.ref004">4</xref>]. To make practical use of GPs for modelling large 2P recordings, we capitalized on recent advances in sparse approximations for GPs that work with a limited number of inducing points [<xref ref-type="bibr" rid="pcbi.1007205.ref005">5</xref>] and demonstrated their applicability for a real world task. In addition, we only performed point-estimates for hyperparameters instead of fully Bayesian inference and pre-determined kernels before statistical evaluation. This was important for two reasons: firstly, a processing pipeline should not be excessively computationally costly, so as to make them impractical for general use with larger datasets; and secondly, the application of these models in closed-loop imaging experiments was only possible if one complete iteration of the process (data acquisition; pre-processing; prediction; parameter selection) could be completed in a few minutes. In principle, our approach could be extended to a fully Bayesian framework with hyperpriors on the model parameters, although this introduces additional difficulties for sparse approximation and still entails a greater computational burden [<xref ref-type="bibr" rid="pcbi.1007205.ref025">25</xref>]. While our work solely addressed Gaussian distributed data, the models can be readily extended to point processes as well. There, sparse approximation techniques overcome the computational intractability of the model, and allow inference on relatively large datasets [<xref ref-type="bibr" rid="pcbi.1007205.ref026">26</xref>].</p>
</sec>
<sec id="sec014">
<title>Active experimental design of 2P experiments</title>
<p>Although we demonstrated the potential for using GP models during 2P experiments, there were several limitations to our approach. We were able to reduce the time per iteration of our active experiments to less than five minutes, addressing a key practical concern. However, it emerged during the experiment that the peak-finding algorithm was biased away from the periphery of the stimulus space, which made the chirp stimulus unsuitable as our “ground truth” for model evaluation.</p>
<p>The parameter batch size may also have been too small for each iteration. Batch size is a critical consideration in active Bayesian experimentation. Where the cost per iteration is low, single parameters can be selected for each iteration, for which the objective function can be relatively easily defined and evaluated. In one recent publication, Charles et al. [<xref ref-type="bibr" rid="pcbi.1007205.ref023">23</xref>] used GPs to model the effect of inter-trial variability in monkey V1 neurons, using sequential parameter selection to optimise a coloured light stimulus. For experiments where iterations are prohibitively expensive, new parameters can be selected in batches, although this requires interactions between parameters to be taken into account, which can be computationally expensive to evaluate. In such cases, approximate methods provide an attractive method for reducing computational overheads (e.g. [<xref ref-type="bibr" rid="pcbi.1007205.ref022">22</xref>]). Batch parameter selection algorithms which account for, or approximate, parameter interactions would likely overcome simple peak finding methods.</p>
</sec>
<sec id="sec015">
<title>Conclusion</title>
<p>Historical obstacles to the use of Bayesian methods such as the difficulty of their implementation and their computational cost have been reduced. Much research over the past decade has focused on the problem of minimising the computational complexity of the algorithms through sparse approximation methods and efficient parameter estimation (such as [<xref ref-type="bibr" rid="pcbi.1007205.ref005">5</xref>]). New libraries for popular coding languages—such as GPy [<xref ref-type="bibr" rid="pcbi.1007205.ref027">27</xref>], PyMC3 [<xref ref-type="bibr" rid="pcbi.1007205.ref028">28</xref>], and pySTAN [<xref ref-type="bibr" rid="pcbi.1007205.ref029">29</xref>] for Python 3—have lowered the barrier to entry. Likewise, we provide a collection of notebooks with this paper to allow straightforward application of our framework.</p>
<p>Taken together, our approach exploits the flexibility and extensibility of Gaussian process models to improve on classical approaches for two photon data analysis and addresses important analytical tasks in a way that preserves a representation of uncertainty propagated up from the underlying data. We feel that it will be particularly useful for disentangling the dynamics of neural circuits in the early visual system under complex, multivariate experimental conditions.</p>
</sec>
</sec>
<sec id="sec016" sec-type="materials|methods">
<title>Materials and methods</title>
<sec id="sec017">
<title>Ethics statement</title>
<p>All animal procedures were performed according to the laws governing animal experimentation issued by the German Government. The documentation for the animal and tissue preparation was submitted in accordance with Mitteilung nach §4 Abs. 3 Tierschutzgesetz, and approved by the Regierungspräsidium Tübingen on 09.11.2016. Viral injection documentation Tierversuch Nr. AK6/13 was appraised by the ethics committee and approved by Regierungspräsidium Tübingen, on 05.11.2013.</p>
</sec>
<sec id="sec018">
<title>Animals and tissue preparation</title>
<p>For single-cell-injection experiments, we used one adult mouse cross-bred between transgenic line B6.Cg-Tg(Pcp2-cre)3555Jdhu/J (Tg3555, JAX 010536) and the Cre-dependent red fluorescence reporter line B6;129S6-Gt(ROSA)26Sor<sup>tm9(CAG-tdTomato)Hze</sup>/J (Ai9<sup>tdTomato</sup>, JAX 007905). For glutamate-imaging, we used one adult C57BL/6J mouse. Owing to the exploratory nature of our study, we did not use blinding and did not perform a power analysis to predetermine sample size.</p>
<p>Animals were housed under a standard 12h day-night cycle. For recordings, animals were dark-adapted for ≤ 1h, then anaesthetised with isoflurane (Baxter) and killed by cervical dislocation. The eyes were removed and hemisected in carboxygenated (95% O<sub>2</sub>, 5% CO<sub>2</sub>) artificial cerebral spinal fluid (ACSF) solution containing (in mM): 125 NaCl, 2.5 KCl, 2 CaCl<sub>2</sub>, 1 MgCl<sub>2</sub>, 1.25 NaH<sub>2</sub>PO<sub>4</sub>, 26 NaHCO<sub>3</sub>, 20 glucose, and 0.5 L-glutamine (pH 7.4). Then, the tissue was moved to the recording chamber of the microscope, where it was continuously perfused with carboxygenated ACSF at ∼ 37°C. The ACSF contained ∼ 0.1<italic>μ</italic>M sulforhodamine-101 (SR101, Invitrogen) to reveal blood vessels and any damaged cells in the red fluorescence channel. All procedures were carried out under very dim red (&gt;650nm) light.</p>
</sec>
<sec id="sec019">
<title>Single cell injection</title>
<p>Sharp electrodes were pulled on a P-1000 micropipette puller (Sutter Instruments) with resistances between 70–100MΩ. Afterwards, the tip (∼ 500<italic>μ</italic>m) of each electrode was bent on a custom-made microforge. Single bipolar cell somata in the inner nuclear layer were filled with the fluorescent calcium indicator Oregon-Green BAPTA-1 (OGB-1) by using the pulse function (500ms) of the MultiClamp 700B software (Molecular Devices). OGB-1 (hexapotassium salt; Life Technologies) was prepared as 15mM in distilled water. Immediately after filling, the electrode was carefully retracted. Imaging started after about 30 minutes after the injection to allow cells to recover and the dye to diffuse within the cell. At the end of the recording, a stack of images was captured for the cellular morphology, which was then traced semi-automatically using the Simple Neurite Tracer plugin implemented in Fiji [<xref ref-type="bibr" rid="pcbi.1007205.ref030">30</xref>].</p>
</sec>
<sec id="sec020">
<title>Virus injection</title>
<p>For virus injections, we used adult wild-type mice (C57BL/6J). Animals were anesthetized with 10% ketamine (Bela-Pharm GmbH &amp; Co. KG) and 2% xylazine (Rompun, Bayer Vital GmbH) in 0.9% NaCl (Fresenius). A volume of 1<italic>μ</italic>l of the viral construct (AAV2.hSyn.iGluSnFR.WPRE.SV40, Penn Vector Core) was injected into the vitreous humour of both eyes via a Hamilton injection system (syringe: 7634-01, needles: 207434, point style 3, length 51mm, Hamilton Messtechnik GmbH) mounted on a micromanipulator (World Precision Instruments). Imaging experiments were performed 3 weeks after virus injection.</p>
</sec>
<sec id="sec021">
<title>Two-photon imaging</title>
<p>We used a MOM-type 2P microscope (designed by W. Denk, now MPI Martinsried; purchased from Sutter Instruments/Science Products). The design and procedures have been described previously [<xref ref-type="bibr" rid="pcbi.1007205.ref007">7</xref>, <xref ref-type="bibr" rid="pcbi.1007205.ref011">11</xref>, <xref ref-type="bibr" rid="pcbi.1007205.ref031">31</xref>]). In brief, the system was equipped with a mode-locked Ti:Sapphire laser (MaiTai-HP DeepSee, Newport Spectra-Physics), two fluorescence detection channels for OGB-1 or iGluSnFR (HQ 510/84, AHF/Chroma) and SR101/tdTomato (HQ 630/60, AHF), and a water immersion objective (W Plan-Apochromat 20x /1.0 DIC M27, Zeiss). The laser was tuned to 927nm for imaging OGB-1, iGluSnFR or SR101. For image acquisition, we used custom-made software (ScanM by M. Müller, MPI Martinsried, and T. Euler) running under IGOR Pro 6.3 for Windows (Wavemetrics), taking time lapsed 32 x 32 pixel image scans (at 15.625Hz) or 16-line “spiral” scans (at 31.25Hz). For documenting morphology, 512 x 512 pixel images were acquired with step size of 0.5<italic>μ</italic>m along the Z axis.</p>
</sec>
<sec id="sec022">
<title>Fast spiral scan imaging</title>
<p>To resolve transient changes in calcium concentration or glutamate release (i.e. with decay times of ∼100ms), scan rates of around 20Hz or more are wanted. Many scanning 2P microscopes use conventional (non-resonant) galvanometric scanners and are limited by the inertia of the scan mirrors, which introduce positional errors at high scan rates. This is especially critical for typical linear (image) scans, with their abrupt changes in direction when jumping between scan lines. For constant spatial resolution, faster scan rates are often realised by decreasing the scan area. However, it is possible to increase the spatio-temporal resolution by using non-linear “spiral scan” configurations. These overcome the key mechanical limitation of linear scans, that they incorporate sharp turns, rather than following smoother trajectories. Unlike linear scans, which are composed of single linear trajectories repeated along an axis at regular intervals, spiral scan configurations consist of radial trajectories moving away from a central point at a constant speed and rotation and permit rapid movement of the scan mirrors.</p>
<p>A regular radial grid can be constructed by generating a single spiral trajectory and successively rotating it around a central point. We used an Archimedean spiral is used to generate each trajectory (<italic>r</italic> = Θ<sup>1/<italic>a</italic></sup>), where the radial distance <italic>r</italic> from the central point is a function of the angle Θ and a tightness parameter <italic>a</italic> which determines the rate of rotation around the centre. With a grid composed of 16 such curves we can resolve, for instance, axon terminals of retinal bipolar cells at twice the spatial and twice the temporal resolution of linear recordings. One can see the advantages of such scan configurations by showing how frequently the scan trajectory intersects with ROIs in a single frame. The times at which labelled structures are observed by these trajectories are both more frequent and more irregularly distributed in time than a typical linear scan, providing a superior temporal resolution.</p>
</sec>
<sec id="sec023">
<title>Light stimulation</title>
<p>For light stimulation, a modified LightCrafter (DLPLCR4500, Texas instruments; modification by EKB Technology) was focused through the objective lens of the microscope. Instead of standard RGB light-emitting diodes (LEDs), it was fitted with a green (576nm) and a UV (390nm) LED for matching the spectral sensitivity of mouse M- and S-opsins [<xref ref-type="bibr" rid="pcbi.1007205.ref032">32</xref>]. To prevent the LEDs from interfering with the fluorescence detection, the light from the projector was band-pass-filtered (ET Dualband Exciter, 380-407/562-589, AHF) and the LEDs were synchronised with the microscope’s scan retrace. Stimulator intensity was calibrated to range from 0.5 * 10<sup>3</sup> (“black” background image) to 20 * 10<sup>3</sup> (“white” full field) photoisomerisations P*/s/cone [<xref ref-type="bibr" rid="pcbi.1007205.ref007">7</xref>]. The light stimulus was centred before every experiment, such that its centre corresponded to the centre of the recording field. In linear scans, the stimulus is displayed while the trajectory moves between consecutive lines; while for the spiral scans this occurs while the trajectory returns from the periphery to the centre.</p>
<p>Light stimuli were generated using the QDSpy light stimulation software, which is written in Python 3 [<xref ref-type="bibr" rid="pcbi.1007205.ref033">33</xref>]. The chirp stimulus ran for 4 repeats of 32s each, with the stimulus extent alternating between a 800<italic>μm</italic> and a 100<italic>μm</italic> light spot. The moving bar stimulus consisted of a 300<italic>μm</italic> rectangular bar moving at 1000<italic>μm</italic>/<italic>s</italic> for 4 seconds along 8 evenly space directions, repeated three times for each direction. The sine stimulus consisted of a 100<italic>μm</italic> light spot, and ran for 45 1s-trials, with contrast and frequency varying in each trial. The contrast and frequency parameters were chosen by blue-noise sampling 150 parameters from the parameter space, between 10% and 100% contrast and 1Hz to 8Hz frequency. Later closed-loop experiments used a sine stimulus with 90 parameter sets sampled uniformly from the parameter space, in addition to 3x30 parameters sets, of which the first were chosen from random uniform sampling and the latter two sets by active Bayesian inference.</p>
</sec>
<sec id="sec024">
<title>Data analysis</title>
<p>Initial data analysis was performed in IGOR Pro 6. Regions of Interest (ROIs) were defined manually using the SARFIA toolbox for IGOR Pro [<xref ref-type="bibr" rid="pcbi.1007205.ref034">34</xref>]. In the iGluSnFR recordings, a custom-script generated a correlation map [<xref ref-type="bibr" rid="pcbi.1007205.ref007">7</xref>], which defined structures for the ROI drawing. The observations were synchronised to the light stimuli using time markers which were generated by the stimulation software and acquired during imaging. Once the initial pre-processing was completed, the data was exported to HDF5 files, and all subsequent analysis was performed in Python 3.5.</p>
</sec>
<sec id="sec025">
<title>Gaussian process models</title>
<p>Gaussian process (GP) models were used to infer the relationship between time, stimulus parameters and the observed activity of each ROI. Thus, the predictor matrix <italic>X</italic> was a function of the stimulus parameters and time, short hand referred to as <italic>θ</italic>. An introduction to the mathematics of GP regression is provided in <xref ref-type="boxed-text" rid="pcbi.1007205.box002">Box 2</xref>. All GPs used the Radial Basis Function (RBF) kernel, with additive Gaussian noise.
<disp-formula id="pcbi.1007205.e012"><alternatives><graphic id="pcbi.1007205.e012g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007205.e012" xlink:type="simple"/><mml:math display="block" id="M12"><mml:mrow><mml:msub><mml:mi>k</mml:mi> <mml:mrow><mml:mi>R</mml:mi> <mml:mi>B</mml:mi> <mml:mi>F</mml:mi> <mml:mo>,</mml:mo> <mml:mi>ϕ</mml:mi></mml:mrow></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>X</mml:mi> <mml:mo>,</mml:mo> <mml:msup><mml:mi>X</mml:mi> <mml:mo>′</mml:mo></mml:msup> <mml:mo>)</mml:mo></mml:mrow></mml:mrow> <mml:mrow><mml:mo>=</mml:mo> <mml:msubsup><mml:mi>σ</mml:mi> <mml:mrow><mml:mi>s</mml:mi> <mml:mi>i</mml:mi> <mml:mi>g</mml:mi> <mml:mi>n</mml:mi> <mml:mi>a</mml:mi> <mml:mi>l</mml:mi></mml:mrow> <mml:mn>2</mml:mn></mml:msubsup> <mml:mtext>exp</mml:mtext> <mml:mrow><mml:mo>(</mml:mo> <mml:mo>-</mml:mo> <mml:mfrac><mml:mrow><mml:mrow><mml:mo>∥</mml:mo> <mml:mi>X</mml:mi></mml:mrow> <mml:mo>-</mml:mo> <mml:msup><mml:mi>X</mml:mi> <mml:mo>′</mml:mo></mml:msup> <mml:msup><mml:mrow><mml:mo>∥</mml:mo></mml:mrow> <mml:mn>2</mml:mn></mml:msup></mml:mrow> <mml:mrow><mml:mn>2</mml:mn> <mml:msup><mml:mi>l</mml:mi> <mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:mfrac> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>+</mml:mo> <mml:mi>I</mml:mi> <mml:msubsup><mml:mi>σ</mml:mi> <mml:mrow><mml:mi>n</mml:mi> <mml:mi>o</mml:mi> <mml:mi>i</mml:mi> <mml:mi>s</mml:mi> <mml:mi>e</mml:mi></mml:mrow> <mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:math></alternatives> <label>(10)</label></disp-formula>
<disp-formula id="pcbi.1007205.e013"><alternatives><graphic id="pcbi.1007205.e013g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007205.e013" xlink:type="simple"/><mml:math display="block" id="M13"><mml:mi>ϕ</mml:mi> <mml:mrow><mml:mo>=</mml:mo> <mml:mo>{</mml:mo> <mml:mi>l</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>σ</mml:mi> <mml:mrow><mml:mi>s</mml:mi> <mml:mi>i</mml:mi> <mml:mi>g</mml:mi> <mml:mi>n</mml:mi> <mml:mi>a</mml:mi> <mml:mi>l</mml:mi></mml:mrow></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>σ</mml:mi> <mml:mrow><mml:mi>n</mml:mi> <mml:mi>o</mml:mi> <mml:mi>i</mml:mi> <mml:mi>s</mml:mi> <mml:mi>e</mml:mi></mml:mrow></mml:msub> <mml:mo>}</mml:mo></mml:mrow></mml:math></alternatives> <label>(11)</label></disp-formula></p>
<p>The lengthscale <italic>l</italic>, signal variance <italic>σ</italic><sub><italic>signal</italic></sub> and noise variance <italic>σ</italic><sub><italic>noise</italic></sub> were learned as part of the model optimisation. Since the fluorescence measurements <italic>F</italic><sub><italic>i</italic>,<italic>θ</italic></sub> for ROI <italic>i</italic> were irregularly spaced in time, the mean <italic>μ</italic> and covariance Σ of the signal <italic>F</italic><sub><italic>i</italic></sub> were inferred for a new set of predictors <italic>X</italic>* where time is regularly spaced:
<disp-formula id="pcbi.1007205.e014"><alternatives><graphic id="pcbi.1007205.e014g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007205.e014" xlink:type="simple"/><mml:math display="block" id="M14"><mml:mrow><mml:msub><mml:mi>μ</mml:mi> <mml:mi>ϕ</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msup><mml:mi>X</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>|</mml:mo> <mml:mi>X</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:msub><mml:mi>k</mml:mi> <mml:mi>ϕ</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msup><mml:mi>X</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>,</mml:mo> <mml:mi>X</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>k</mml:mi> <mml:mi>ϕ</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>X</mml:mi> <mml:mo>,</mml:mo> <mml:mi>X</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>+</mml:mo> <mml:mi>I</mml:mi> <mml:msubsup><mml:mi>σ</mml:mi> <mml:mrow><mml:mi>n</mml:mi> <mml:mi>o</mml:mi> <mml:mi>i</mml:mi> <mml:mi>s</mml:mi> <mml:mi>e</mml:mi></mml:mrow> <mml:mn>2</mml:mn></mml:msubsup> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>-</mml:mo> <mml:mn>1</mml:mn></mml:mrow></mml:msup> <mml:msub><mml:mi>F</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mo>,</mml:mo> <mml:mi>θ</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives> <label>(12)</label></disp-formula>
<disp-formula id="pcbi.1007205.e015"><alternatives><graphic id="pcbi.1007205.e015g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007205.e015" xlink:type="simple"/><mml:math display="block" id="M15"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mo>Σ</mml:mo> <mml:mi>ϕ</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msup><mml:mi>X</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>|</mml:mo> <mml:mi>X</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:msub><mml:mi>k</mml:mi> <mml:mi>ϕ</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msup><mml:mi>X</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>,</mml:mo> <mml:msup><mml:mi>X</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>-</mml:mo></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi>k</mml:mi> <mml:mi>ϕ</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msup><mml:mi>X</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>,</mml:mo> <mml:mi>X</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>k</mml:mi> <mml:mi>ϕ</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>X</mml:mi> <mml:mo>,</mml:mo> <mml:mi>X</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>+</mml:mo> <mml:mi>I</mml:mi> <mml:msubsup><mml:mi>σ</mml:mi> <mml:mrow><mml:mi>n</mml:mi> <mml:mi>o</mml:mi> <mml:mi>i</mml:mi> <mml:mi>s</mml:mi> <mml:mi>e</mml:mi></mml:mrow> <mml:mn>2</mml:mn></mml:msubsup> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>-</mml:mo> <mml:mn>1</mml:mn></mml:mrow></mml:msup> <mml:msub><mml:mi>k</mml:mi> <mml:mi>ϕ</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>X</mml:mi> <mml:mo>,</mml:mo> <mml:msup><mml:mi>X</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(13)</label></disp-formula></p>
<p>The additive noise component <inline-formula id="pcbi.1007205.e016"><alternatives><graphic id="pcbi.1007205.e016g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007205.e016" xlink:type="simple"/><mml:math display="inline" id="M16"><mml:mrow><mml:mi>I</mml:mi> <mml:msubsup><mml:mi>σ</mml:mi> <mml:mrow><mml:mi>n</mml:mi> <mml:mi>o</mml:mi> <mml:mi>i</mml:mi> <mml:mi>s</mml:mi> <mml:mi>e</mml:mi></mml:mrow> <mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula> was removed for statistical inference, and we refer to the resultant noise-free GP as the “latent function”, in line with the terminology in the GPy documentation [<xref ref-type="bibr" rid="pcbi.1007205.ref027">27</xref>]. Confidence intervals were calculated as
<disp-formula id="pcbi.1007205.e017"><alternatives><graphic id="pcbi.1007205.e017g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007205.e017" xlink:type="simple"/><mml:math display="block" id="M17"><mml:mrow><mml:msub><mml:mi>μ</mml:mi> <mml:mi>ϕ</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msup><mml:mi>X</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>±</mml:mo> <mml:mn>3</mml:mn> <mml:mo>*</mml:mo> <mml:mi>d</mml:mi> <mml:mi>i</mml:mi> <mml:mi>a</mml:mi> <mml:mi>g</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mo>Σ</mml:mo> <mml:mi>ϕ</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msup><mml:mi>X</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives> <label>(14)</label></disp-formula></p>
<p>The Gaussian process models were developed in the GPy framework [<xref ref-type="bibr" rid="pcbi.1007205.ref027">27</xref>]. Feature encoding, input warping, equality tests, parameter selection and closed-loop parameter selection were computed using custom scripts, which we provide as supplementary content to this document and online at <ext-link ext-link-type="uri" xlink:href="https://github.com/berenslab/bayesian_2p_pipeline" xlink:type="simple">https://github.com/berenslab/bayesian_2p_pipeline</ext-link>. Hierarchical clustering was performed using scripts from the Scipy library, using Euclidean distance, the Ward algorithm and <monospace>maxclust</monospace> as the criteria [<xref ref-type="bibr" rid="pcbi.1007205.ref035">35</xref>]. The Ward algorithm was chosen as it tends to infer balanced clusters across the hierarchy. Adaptive parameter selection used a local peak finding algorithm from the Scikit-Image library.</p>
<p>Since our datasets included several thousand observations, it was necessary to use sparse approximation methods to fit the GP models. The sparse approximation algorithm provided in GPy follows [<xref ref-type="bibr" rid="pcbi.1007205.ref005">5</xref>], whereby the kernel is approximated using a subset of the data, termed the inducing inputs. The selection of the inducing inputs is learned as part of the model optimisation, selecting the inputs which minimise the KL-Divergence between the approximation and the target distribution. Details are provided in [<xref ref-type="bibr" rid="pcbi.1007205.ref005">5</xref>].</p>
</sec>
<sec id="sec026">
<title>Gaussian process equality tests</title>
<p>The Gaussian process equality test establishes whether two functions modelled by GPs are equal [<xref ref-type="bibr" rid="pcbi.1007205.ref014">14</xref>]. It operates by computing the difference between the two distributions and identifying whether the credible region encompasses the zero vector across the complete domain of the predictors. If the zero vector is outside of these intervals, we say the two functions are distinct with probability 1 − <italic>a</italic>. The probability is calculated using the mean <italic>μ</italic>* and covariance <italic>k</italic>* of the posterior of our two functions, excluding their respective noise components from the estimate of the covariance.
<disp-formula id="pcbi.1007205.e018"><alternatives><graphic id="pcbi.1007205.e018g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007205.e018" xlink:type="simple"/><mml:math display="block" id="M18"><mml:mrow><mml:msubsup><mml:mi>μ</mml:mi><mml:mi>ϕ</mml:mi><mml:mo>Δ</mml:mo></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi>X</mml:mi><mml:mo>*</mml:mo></mml:msup><mml:mo>|</mml:mo><mml:mi>X</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mi>μ</mml:mi><mml:mi>ϕ</mml:mi></mml:msub><mml:msup><mml:mrow/><mml:mi>T</mml:mi></mml:msup><mml:msubsup><mml:mo>Σ</mml:mo><mml:mi>ϕ</mml:mi><mml:mo>Δ</mml:mo></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi>X</mml:mi><mml:mo>*</mml:mo></mml:msup><mml:mo>|</mml:mo><mml:mi>X</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:msub><mml:mo>Σ</mml:mo><mml:mi>ϕ</mml:mi></mml:msub><mml:msubsup><mml:mi>μ</mml:mi><mml:mi>ϕ</mml:mi><mml:mo>Δ</mml:mo></mml:msubsup><mml:mo stretchy="false">(</mml:mo><mml:msup><mml:mi>X</mml:mi><mml:mo>*</mml:mo></mml:msup><mml:mo>|</mml:mo><mml:mi>X</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>≤</mml:mo><mml:msup><mml:mi>χ</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>1</mml:mn><mml:mo>−</mml:mo><mml:mi>a</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives> <label>(15)</label></disp-formula>
<disp-formula id="pcbi.1007205.e019"><alternatives><graphic id="pcbi.1007205.e019g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007205.e019" xlink:type="simple"/><mml:math display="block" id="M19"><mml:mrow><mml:msubsup><mml:mi>μ</mml:mi> <mml:mi>ϕ</mml:mi> <mml:mo>Δ</mml:mo></mml:msubsup> <mml:mrow><mml:mo>(</mml:mo> <mml:msup><mml:mi>X</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>|</mml:mo> <mml:mi>X</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:msubsup><mml:mi>μ</mml:mi> <mml:mi>ϕ</mml:mi> <mml:mn>1</mml:mn></mml:msubsup> <mml:mrow><mml:mo>(</mml:mo> <mml:msup><mml:mi>X</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>|</mml:mo> <mml:mi>X</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>-</mml:mo> <mml:msubsup><mml:mi>μ</mml:mi> <mml:mi>ϕ</mml:mi> <mml:mn>2</mml:mn></mml:msubsup> <mml:mrow><mml:mo>(</mml:mo> <mml:msup><mml:mi>X</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>|</mml:mo> <mml:mi>X</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives> <label>(16)</label></disp-formula>
<disp-formula id="pcbi.1007205.e020"><alternatives><graphic id="pcbi.1007205.e020g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007205.e020" xlink:type="simple"/><mml:math display="block" id="M20"><mml:mrow><mml:msubsup><mml:mo>Σ</mml:mo> <mml:mi>ϕ</mml:mi> <mml:mo>Δ</mml:mo></mml:msubsup> <mml:mrow><mml:mo>(</mml:mo> <mml:msup><mml:mi>X</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>|</mml:mo> <mml:mi>X</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:msubsup><mml:mo>Σ</mml:mo> <mml:mi>ϕ</mml:mi> <mml:mn>1</mml:mn></mml:msubsup> <mml:mrow><mml:mo>(</mml:mo> <mml:msup><mml:mi>X</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>|</mml:mo> <mml:mi>X</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>+</mml:mo> <mml:msubsup><mml:mo>Σ</mml:mo> <mml:mi>ϕ</mml:mi> <mml:mn>2</mml:mn></mml:msubsup> <mml:mrow><mml:mo>(</mml:mo> <mml:msup><mml:mi>X</mml:mi> <mml:mo>*</mml:mo></mml:msup> <mml:mo>|</mml:mo> <mml:mi>X</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives> <label>(17)</label></disp-formula></p>
</sec>
<sec id="sec027">
<title>Euler characteristic bootstrap</title>
<p>The total number of discrete, non-intersecting regions where two Gaussian processes differ more than could be expected by chance is termed the Euler characteristic (EC) [<xref ref-type="bibr" rid="pcbi.1007205.ref036">36</xref>]. The EC is a measure of the geometry of random fields which accounts for the smoothness of the underlying functions, and is well established in fMRI research, where it forms part of the broader literature on statistical mapping [<xref ref-type="bibr" rid="pcbi.1007205.ref037">37</xref>]. While the expected value of the EC can be analytically tractable under certain conditions, we wished to incorporate it into our pipeline in a manner which was not sensitive to the number of input dimensions and could handle non-stationary autocorrelation functions, and so inferred its null distribution through bootstrap resampling.</p>
<p>To evaluate whether the values of the EC, which were obtained from the GP equality tests, were statistically significant, we constructed an approximate null distribution by bootstrapping samples from pooled data and performing equality tests on these samples. The procedure was as follows: the observations from each of the signals being compared were pooled to form a larger set of observations; from this set, pairs of samples each 300 observations in size were drawn at random, without replacement; Gaussian processes were fitted to each of the samples in the pair; the difference between the two Gaussian process models was calculated; the Euler characteristic was calculated from this difference for varying thresholds. This was repeated 500 times to build an approximate null distribution.</p>
<p>We applied this bootstrap test in Figs <xref ref-type="fig" rid="pcbi.1007205.g004">4</xref>, <xref ref-type="fig" rid="pcbi.1007205.g005">5</xref> and <xref ref-type="fig" rid="pcbi.1007205.g008">8</xref>. For <xref ref-type="fig" rid="pcbi.1007205.g004">Fig 4</xref>, the observations were pooled from the responses to the stimulus; for Figs <xref ref-type="fig" rid="pcbi.1007205.g005">5</xref> and <xref ref-type="fig" rid="pcbi.1007205.g008">8</xref>, for each node the observations were pooled from the two putative clusters. For the comparisons to the classical pipeline, the null distribution was computed by shuffling the observations between stimulus conditions, with a total of 500 shuffled pairs used for the estimation. Approximate p-values were computed by calculating the proportion of the <italic>N</italic> shuffled sample pairs which had a greater EC value than that calculated from the GP equality test.</p>
</sec>
<sec id="sec028">
<title>Non-stationary autocorrelation</title>
<p>To address non-stationarity of the chirp response data, we computed the autocorrelation function for the chirp stimulus in 500 ms windows spaced at 1/16 s intervals (512 windows total). As we used RBF kernels for our regression, we fitted a Gaussian curve to each autocorrelation function and retained the inferred lengthscale <italic>l</italic><sub><italic>t</italic></sub> for each window. A further parameter <italic>A</italic> modulates the height of the function.
<disp-formula id="pcbi.1007205.e021"><alternatives><graphic id="pcbi.1007205.e021g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007205.e021" xlink:type="simple"/><mml:math display="block" id="M21"><mml:mrow><mml:mi>c</mml:mi> <mml:mi>o</mml:mi> <mml:mi>v</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>f</mml:mi> <mml:mrow><mml:mi>s</mml:mi> <mml:mi>t</mml:mi> <mml:mi>i</mml:mi> <mml:mi>m</mml:mi> <mml:mi>u</mml:mi> <mml:mi>l</mml:mi> <mml:mi>u</mml:mi> <mml:mi>s</mml:mi></mml:mrow></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>∼</mml:mo> <mml:mi>A</mml:mi> <mml:msup><mml:mi>e</mml:mi> <mml:mfrac><mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>-</mml:mo> <mml:mi>μ</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mn>2</mml:mn></mml:msup> <mml:mrow><mml:mn>2</mml:mn> <mml:msubsup><mml:mi>l</mml:mi> <mml:mrow><mml:mi>t</mml:mi></mml:mrow> <mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mfrac></mml:msup></mml:mrow></mml:math></alternatives> <label>(18)</label></disp-formula></p>
<p>If the signal were stationary, we would observe that the lengthscale parameter was constant with respect to time.</p>
<p>By using the cumulative sum of the inverse of the lengthscale as the predictor, we could derive a warping function which transformed the predictors such that the stimulus autocorrelation was stationary.</p>
<p>We assumed that the autocorrelation of the observed signal was approximately equal to that of the light stimulus input, and used the warping function to transform the observations. This transformation could be inverted to visualise the fitted GP with respect to the original time base.
<disp-formula id="pcbi.1007205.e022"><alternatives><graphic id="pcbi.1007205.e022g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007205.e022" xlink:type="simple"/><mml:math display="block" id="M22"><mml:mrow><mml:msub><mml:mi>f</mml:mi> <mml:mrow><mml:mi>w</mml:mi> <mml:mi>a</mml:mi> <mml:mi>r</mml:mi> <mml:mi>p</mml:mi> <mml:mi>e</mml:mi> <mml:mi>d</mml:mi></mml:mrow></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>x</mml:mi> <mml:mi>t</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>∼</mml:mo> <mml:mfrac><mml:mn>1</mml:mn> <mml:mrow><mml:mn>2</mml:mn> <mml:msubsup><mml:mi>l</mml:mi> <mml:mrow><mml:mi>t</mml:mi></mml:mrow> <mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mfrac></mml:mrow></mml:math></alternatives> <label>(19)</label></disp-formula></p>
</sec>
<sec id="sec029">
<title>Gaussian process ANOVA</title>
<p>GP models can also be used for functional Analysis of Variance [<xref ref-type="bibr" rid="pcbi.1007205.ref020">20</xref>]. These GP-ANOVA models disentangle the contribution and interaction of different predictors to the observed function. The GP models for the chirp stimulus data modelled the observed activity with time relative to the start of each stimulus trial as the predictor <italic>X</italic>. For the moving bar stimulus, a direction parameter was encoded as a 2D circular feature by converting the angle <italic>α</italic> in polar coordinates to an xy position in Cartesian coordinates (<italic>cos</italic>(2<italic>πα</italic>/360), <italic>sin</italic>(2<italic>πα</italic>/360)). Likewise, for the sine wave stimuli the phase of the oscillation was encoded as (<italic>cos</italic>(2<italic>πtf</italic>), <italic>sin</italic>(2<italic>πtf</italic>)), while frequency and contrast were encoded linearly.</p>
<p>In contrast to classical ANOVA, the effects and interactions can be non-linear. Flexible kernel composition makes such models comparatively simple to implement. Kernels can be combined in a number of ways [<xref ref-type="bibr" rid="pcbi.1007205.ref004">4</xref>], each expressing some belief about the effect of a parameter, most commonly by taking the sum or product of two kernels. Additive components represent effects of predictors which are independent of one another, while multiplicative kernels represent interactions between predictors. For example, for a kernel encoding two stimulus parameters <italic>x</italic><sub><italic>a</italic></sub> and <italic>x</italic><sub><italic>b</italic></sub>, with both additive and interactive effects and RBF kernels, the correlation function of the GP model would be:
<disp-formula id="pcbi.1007205.e023"><alternatives><graphic id="pcbi.1007205.e023g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007205.e023" xlink:type="simple"/><mml:math display="block" id="M23"><mml:mrow><mml:msub><mml:mi>k</mml:mi> <mml:mi>ϕ</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>X</mml:mi> <mml:mo>,</mml:mo> <mml:msup><mml:mi>X</mml:mi> <mml:mo>′</mml:mo></mml:msup> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:msub><mml:mi>k</mml:mi> <mml:mi>ϕ</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>x</mml:mi> <mml:mi>a</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msubsup><mml:mi>x</mml:mi> <mml:mrow><mml:mi>a</mml:mi></mml:mrow> <mml:mo>′</mml:mo></mml:msubsup> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>+</mml:mo> <mml:msub><mml:mi>k</mml:mi> <mml:mi>ϕ</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>x</mml:mi> <mml:mi>b</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msubsup><mml:mi>x</mml:mi> <mml:mrow><mml:mi>b</mml:mi></mml:mrow> <mml:mo>′</mml:mo></mml:msubsup> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>+</mml:mo> <mml:msub><mml:mi>k</mml:mi> <mml:mi>ϕ</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>X</mml:mi> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>b</mml:mi></mml:mrow></mml:msub> <mml:mo>,</mml:mo> <mml:msubsup><mml:mi>X</mml:mi> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>b</mml:mi></mml:mrow> <mml:mo>′</mml:mo></mml:msubsup> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives> <label>(20)</label></disp-formula></p>
<p>Here, <italic>X</italic><sub><italic>a</italic>,<italic>b</italic></sub> = (<italic>x</italic><sub><italic>a</italic></sub>, <italic>x</italic><sub><italic>b</italic></sub>). We estimated interaction effects of different stimulus parameters in our GP ANOVA models by including kernels which learned a single lengthscale parameter over multiple input dimensions. This inferred the joint effect of the parameters as a single function; where, since the parameters are z-scored, a change in the magnitude of one stimulus parameter would have the same effect as varying the other by an equal magnitude. This approach to GP ANOVA provides an efficient and principled way of choosing optimal hyperparameters to infer stimulus effects.</p>
<p>For the chirp stimulus, where there is one predictor, a single kernel encoding the autocorrelation of the signal over time was used. For the warped GPs, the warped time was used instead. For the moving bar and sine wave stimuli, additional kernels were included to model the effects of their respective parameters. The GP model for the moving bar responses included both additive effects for time and direction, and a time-direction interaction effect. Likelihood ratio tests were used to select kernels from the full set of additive and multiplicative stimulus effects:
<disp-formula id="pcbi.1007205.e024"><alternatives><graphic id="pcbi.1007205.e024g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007205.e024" xlink:type="simple"/><mml:math display="block" id="M24"><mml:mrow><mml:msup><mml:mi>χ</mml:mi> <mml:mn>2</mml:mn></mml:msup> <mml:mo>=</mml:mo> <mml:mo>-</mml:mo> <mml:mn>2</mml:mn> <mml:mi>l</mml:mi> <mml:mi>n</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mfrac><mml:msub><mml:mi>L</mml:mi> <mml:mn>0</mml:mn></mml:msub> <mml:msub><mml:mi>L</mml:mi> <mml:mn>1</mml:mn></mml:msub></mml:mfrac> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives> <label>(21)</label></disp-formula></p>
<p>Where <italic>L</italic><sub><italic>N</italic></sub> is the likelihood of the fitted model, and the addition of the proposed parameter is rejected if the improvement in the likelihood is greater than chance with probability 1 − <italic>a</italic>. These tests were applied iteratively until a kernel was rejected. For the closed loop experimentation, we retained the model from the previous selection procedure with the randomly parameterised sine stimulus.</p>
<p>The data used throughout this paper and corresponding code used to compute the models will be provided as supplementary material alongside this paper.</p>
</sec>
</sec>
<sec id="sec030">
<title>Supporting information</title>
<supplementary-material id="pcbi.1007205.s001" mimetype="image/png" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1007205.s001" xlink:type="simple">
<label>S1 Fig</label>
<caption>
<title>Model performance.</title>
<p>Model: RBF kernel, best of 5 fits per model. <bold>a</bold>: Mean time elapsed per iteration of the MLE. This scales approximately linearly with the number of points. <bold>b</bold>: Out of sample estimate of negative log likelihood after 30 iterations. Estimates as a function of the number of inducing points. <bold>c</bold>: Model performance of out of sample test points relative to the maximum number of iterations, evaluated for 300 inducing points.</p>
<p>(PNG)</p>
</caption>
</supplementary-material>
<supplementary-material id="pcbi.1007205.s002" mimetype="image/png" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1007205.s002" xlink:type="simple">
<label>S2 Fig</label>
<caption>
<title>Direction selectivity clusters.</title>
<p>Model: Product of RBF kernel (time) with RBF kernel (direction), 300 inducing inputs, 25 iterations per fit, best of 3 fits per model. Each heat map corresponds to the posterior mean of the fitted GP. Columns correspond to clusters.</p>
<p>(PNG)</p>
</caption>
</supplementary-material>
<supplementary-material id="pcbi.1007205.s003" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1007205.s003" xlink:type="simple">
<label>S1 Table</label>
<caption>
<title>Oscillatory kernels.</title>
<p>Each kernel incorporates either independent or interactive effects of the stimulus parameter into the prediction. Kernels were selected by a sequence of likelihood ratio tests, the results of which are shown in <xref ref-type="supplementary-material" rid="pcbi.1007205.s004">S2 Table</xref>.</p>
<p>(ODS)</p>
</caption>
</supplementary-material>
<supplementary-material id="pcbi.1007205.s004" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1007205.s004" xlink:type="simple">
<label>S2 Table</label>
<caption>
<title>Oscillatory models.</title>
<p>Results from the sequential likelihood ratio test from which the stimulus parameter model was constructed for the sinusoidal stimulus data.</p>
<p>(ODS)</p>
</caption>
</supplementary-material>
</sec>
</body>
<back>
<ack>
<p>We thank Rob Smith and Roland Taylor for discussion; André Maia Chagas and Tom Baden for helpful discussion and feedback. We additionally thank the authors of the GPy library, which provided a starting point for our model implementation.</p>
</ack>
<ref-list>
<title>References</title>
<ref id="pcbi.1007205.ref001">
<label>1</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Denk</surname> <given-names>W</given-names></name>, <name name-style="western"><surname>Strickler</surname> <given-names>JH</given-names></name>, <name name-style="western"><surname>Webb</surname> <given-names>WW</given-names></name>. <article-title>Two-photon laser scanning fluorescence microscopy</article-title>. <source>Science</source>. <year>1990</year>;<volume>248</volume>(<issue>4951</issue>):<fpage>73</fpage>–<lpage>76</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1007205.ref002">
<label>2</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Faisal</surname> <given-names>AA</given-names></name>, <name name-style="western"><surname>Selen</surname> <given-names>LPJ</given-names></name>, <name name-style="western"><surname>Wolpert</surname> <given-names>DM</given-names></name>. <article-title>Noise in the nervous system</article-title>. <source>Nature reviews neuroscience</source>. <year>2008</year>;<volume>9</volume>(<issue>4</issue>):<fpage>292</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1038/nrn2258" xlink:type="simple">10.1038/nrn2258</ext-link></comment> <object-id pub-id-type="pmid">18319728</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007205.ref003">
<label>3</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Wilt</surname> <given-names>BA</given-names></name>, <name name-style="western"><surname>Fitzgerald</surname> <given-names>JE</given-names></name>, <name name-style="western"><surname>Schnitzer</surname> <given-names>MJ</given-names></name>. <article-title>Photon shot noise limits on optical detection of neuronal spikes and estimation of spike timing</article-title>. <source>Biophysical journal</source>. <year>2013</year>;<volume>104</volume>(<issue>1</issue>):<fpage>51</fpage>–<lpage>62</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.bpj.2012.07.058" xlink:type="simple">10.1016/j.bpj.2012.07.058</ext-link></comment> <object-id pub-id-type="pmid">23332058</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007205.ref004">
<label>4</label>
<mixed-citation publication-type="book" xlink:type="simple">
<name name-style="western"><surname>Rasmussen</surname> <given-names>CE</given-names></name>, <name name-style="western"><surname>Williams</surname> <given-names>CKI</given-names></name>. <source>Gaussian processes for machine learning</source>. <publisher-loc>Cambridge, MA</publisher-loc>: <publisher-name>MIT Press</publisher-name>. <year>2006</year>.</mixed-citation>
</ref>
<ref id="pcbi.1007205.ref005">
<label>5</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Titsias</surname> <given-names>M</given-names></name>. <article-title>Variational Learning of Inducing Variables in Sparse Gaussian Processes</article-title>. <source>Proceedings of the International Conference on Artificial Intelligence and Statistics (AISTATS)</source>. <year>2009</year>;<volume>5</volume>:<fpage>567</fpage>–<lpage>74</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1007205.ref006">
<label>6</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Baden</surname> <given-names>T</given-names></name>, <name name-style="western"><surname>Schubert</surname> <given-names>T</given-names></name>, <name name-style="western"><surname>Berens</surname> <given-names>P</given-names></name>, <name name-style="western"><surname>Euler</surname> <given-names>T</given-names></name>. <article-title>The Functional Organization of Vertebrate Retinal Circuits for Vision</article-title>. <source>Oxford Research Encyclopedias</source>. <year>2018</year>.</mixed-citation>
</ref>
<ref id="pcbi.1007205.ref007">
<label>7</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Franke</surname> <given-names>K</given-names></name>, <name name-style="western"><surname>Berens</surname> <given-names>P</given-names></name>, <name name-style="western"><surname>Schubert</surname> <given-names>T</given-names></name>, <name name-style="western"><surname>Bethge</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Euler</surname> <given-names>T</given-names></name>, <name name-style="western"><surname>Baden</surname> <given-names>T</given-names></name>. <article-title>Inhibition decorrelates visual feature representations in the inner</article-title>. <source>Nature</source>. <year>2017</year>;<volume>542</volume>(<issue>7642</issue>):<fpage>439</fpage>–<lpage>44</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1038/nature21394" xlink:type="simple">10.1038/nature21394</ext-link></comment> <object-id pub-id-type="pmid">28178238</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007205.ref008">
<label>8</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Borghuis</surname> <given-names>BG</given-names></name>, <name name-style="western"><surname>Marvin</surname> <given-names>JS</given-names></name>, <name name-style="western"><surname>Looger</surname> <given-names>LL</given-names></name>, <name name-style="western"><surname>Demb</surname> <given-names>JB</given-names></name>. <article-title>Two-Photon Imaging of Nonlinear Glutamate Release Dynamics at Bipolar Cell Synapses in the Mouse Retina</article-title>. <source>Journal of Neuroscience</source>. <year>2013</year>;<volume>33</volume>(<issue>27</issue>):<fpage>10972</fpage>–<lpage>85</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1523/JNEUROSCI.1241-13.2013" xlink:type="simple">10.1523/JNEUROSCI.1241-13.2013</ext-link></comment> <object-id pub-id-type="pmid">23825403</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007205.ref009">
<label>9</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Marvin</surname> <given-names>JS</given-names></name>, <name name-style="western"><surname>Borghuis</surname> <given-names>BG</given-names></name>, <name name-style="western"><surname>Tian</surname> <given-names>L</given-names></name>, <name name-style="western"><surname>Cichon</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Harnett</surname> <given-names>MT</given-names></name>, <name name-style="western"><surname>Akerboom</surname> <given-names>J</given-names></name>, <etal>et al</etal>. <article-title>An optimized fluorescent probe for visualizing glutamate neurotransmission</article-title>. <source>Nature Methods</source>. <year>2013</year>;<volume>10</volume>(<issue>2</issue>):<fpage>162</fpage>–<lpage>170</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1038/nmeth.2333" xlink:type="simple">10.1038/nmeth.2333</ext-link></comment> <object-id pub-id-type="pmid">23314171</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007205.ref010">
<label>10</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Briggman</surname> <given-names>KL</given-names></name>, <name name-style="western"><surname>Euler</surname> <given-names>T</given-names></name>. <article-title>Bulk electroporation and population calcium imaging in the adult mammalian retina</article-title>. <source>Journal of Neurophysiology</source>. <year>2011</year>;<volume>105</volume>(<issue>5</issue>):<fpage>2601</fpage>–<lpage>9</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1152/jn.00722.2010" xlink:type="simple">10.1152/jn.00722.2010</ext-link></comment> <object-id pub-id-type="pmid">21346205</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007205.ref011">
<label>11</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Baden</surname> <given-names>T</given-names></name>, <name name-style="western"><surname>Berens</surname> <given-names>P</given-names></name>, <name name-style="western"><surname>Franke</surname> <given-names>K</given-names></name>, <name name-style="western"><surname>Román Rosón</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Bethge</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Euler</surname> <given-names>T</given-names></name>. <article-title>The functional diversity of retinal ganglion cells in the mouse</article-title>. <source>Nature</source>. <year>2016</year>;<volume>529</volume>(<issue>7586</issue>):<fpage>345</fpage>–<lpage>50</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1038/nature16468" xlink:type="simple">10.1038/nature16468</ext-link></comment> <object-id pub-id-type="pmid">26735013</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007205.ref012">
<label>12</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Snelson</surname> <given-names>E</given-names></name>, <name name-style="western"><surname>Rasmussen</surname> <given-names>CE</given-names></name>, <name name-style="western"><surname>Ghahramani</surname> <given-names>Z</given-names></name>. <article-title>Warped Gaussian processes</article-title>. <source>Advances in Neural Information Processing Systems (NIPS)</source>. <year>2004</year>;<volume>16</volume>:<fpage>337</fpage>–<lpage>44</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1007205.ref013">
<label>13</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Lázaro-Gredilla</surname> <given-names>M</given-names></name>. <article-title>Bayesian Warped Gaussian Processes</article-title>. <source>Advances in Neural Information Processing Systems (NIPS)</source>. <year>2012</year>;<volume>25</volume>:<fpage>1619</fpage>–<lpage>27</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1007205.ref014">
<label>14</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Benavoli</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Mangili</surname> <given-names>F</given-names></name>. <article-title>Gaussian Processes for Bayesian hypothesis tests on regression functions</article-title>. <source>Proceedings of the International Conference on Artificial Intelligence and Statistics (AISTATS)</source>. <year>2015</year>;<volume>38</volume>:<fpage>74</fpage>–<lpage>82</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1007205.ref015">
<label>15</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Roska</surname> <given-names>B</given-names></name>, <name name-style="western"><surname>Nemeth</surname> <given-names>E</given-names></name>, <name name-style="western"><surname>Orzo</surname> <given-names>L</given-names></name>, <name name-style="western"><surname>Werblin</surname> <given-names>FS</given-names></name>. <article-title>Three levels of lateral inhibition: A space-time study of the retina of the tiger salamander</article-title>. <source>Journal of Neuroscience</source>. <year>2000</year>;<volume>20</volume>(<issue>5</issue>):<fpage>1941</fpage>–<lpage>51</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1523/JNEUROSCI.20-05-01941.2000" xlink:type="simple">10.1523/JNEUROSCI.20-05-01941.2000</ext-link></comment> <object-id pub-id-type="pmid">10684895</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007205.ref016">
<label>16</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Ichinose</surname> <given-names>T</given-names></name>, <name name-style="western"><surname>Lukasiewicz</surname> <given-names>PD</given-names></name>. <article-title>Inner and outer retinal pathways both contribute to surround inhibition of salamander ganglion cells</article-title>. <source>Journal of Physiology</source>. <year>2005</year>;<volume>565</volume>(<issue>2</issue>):<fpage>517</fpage>–<lpage>35</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1113/jphysiol.2005.083436" xlink:type="simple">10.1113/jphysiol.2005.083436</ext-link></comment> <object-id pub-id-type="pmid">15760938</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007205.ref017">
<label>17</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Buldyrev</surname> <given-names>I</given-names></name>, <name name-style="western"><surname>Taylor</surname> <given-names>WR</given-names></name>. <article-title>Inhibitory mechanisms that generate centre and surround properties in ON and OFF brisk-sustained ganglion cells in the rabbit retina</article-title>. <source>Journal of Physiology</source>. <year>2013</year>;<volume>591</volume>(<issue>1</issue>):<fpage>303</fpage>–<lpage>25</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1113/jphysiol.2012.243113" xlink:type="simple">10.1113/jphysiol.2012.243113</ext-link></comment> <object-id pub-id-type="pmid">23045347</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007205.ref018">
<label>18</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Taylor</surname> <given-names>W</given-names></name>, <name name-style="western"><surname>Smith</surname> <given-names>R</given-names></name>. <article-title>Trigger features and excitation in the retina</article-title>. <source>Current opinion in neurobiology</source>. <year>2011</year>;<volume>21</volume>(<issue>5</issue>):<fpage>672</fpage>–<lpage>678</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.conb.2011.07.001" xlink:type="simple">10.1016/j.conb.2011.07.001</ext-link></comment> <object-id pub-id-type="pmid">21821411</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007205.ref019">
<label>19</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Hiroki</surname> <given-names>A</given-names></name> and <name name-style="western"><surname>Meister</surname> <given-names>M</given-names></name>. <article-title>Divergence of visual channels in the inner retina</article-title>. <source>Nature neuroscience</source>. <year>2012</year>;<volume>15</volume>(<issue>11</issue>):<fpage>1581</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1038/nn.3241" xlink:type="simple">10.1038/nn.3241</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1007205.ref020">
<label>20</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Kaufman</surname> <given-names>CG</given-names></name>, <name name-style="western"><surname>Sainy</surname> <given-names>SR</given-names></name>. <article-title>Bayesian functional ANOVA modelling using Gaussian process prior distributions</article-title>. <source>Bayesian Analysis</source>. <year>2010</year>;<volume>5</volume>(<issue>1</issue>):<fpage>123</fpage>–<lpage>150</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1214/10-BA505" xlink:type="simple">10.1214/10-BA505</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1007205.ref021">
<label>21</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Park</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Weller</surname> <given-names>JP</given-names></name>, <name name-style="western"><surname>Horwitz</surname> <given-names>GD</given-names></name>, <name name-style="western"><surname>Pillow</surname> <given-names>JW</given-names></name>, <name name-style="western"><surname>Park</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Weller</surname> <given-names>J</given-names></name>, <etal>et al</etal>. <article-title>Bayesian Active Learning of Neural Firing Rate Maps with Transformed Gaussian Process Priors</article-title>. <source>Neural Computation</source>. <year>2014</year>;<volume>26</volume>:<fpage>1519</fpage>–<lpage>1541</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1162/NECO_a_00615" xlink:type="simple">10.1162/NECO_a_00615</ext-link></comment> <object-id pub-id-type="pmid">24877730</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007205.ref022">
<label>22</label>
<mixed-citation publication-type="other" xlink:type="simple">González J, Dai Z, Hennig P, Lawrence N. Batch bayesian optimization via local penalization. Proceedings of the International Conference on Artificial Intelligence and Statistics (AISTATS). 2016:648–657.</mixed-citation>
</ref>
<ref id="pcbi.1007205.ref023">
<label>23</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Charles</surname> <given-names>AS</given-names></name>, <name name-style="western"><surname>Park</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Weller</surname> <given-names>JP</given-names></name>, <name name-style="western"><surname>Horwitz</surname> <given-names>GD</given-names></name>, <name name-style="western"><surname>Pillow</surname> <given-names>JW</given-names></name>. <article-title>Dethroning the Fano Factor: a flexible, model-based approach to partitioning neural variability</article-title>. <source>Neural computation</source>. <year>2018</year>;<volume>30</volume>(<issue>4</issue>):<fpage>1012</fpage>–<lpage>45</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1162/neco_a_01062" xlink:type="simple">10.1162/neco_a_01062</ext-link></comment> <object-id pub-id-type="pmid">29381442</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007205.ref024">
<label>24</label>
<mixed-citation publication-type="book" xlink:type="simple">
<name name-style="western"><surname>Wood</surname> <given-names>SN</given-names></name>. <source>Generalized additive models: an introduction with R</source>. <publisher-name>Chapman and Hall/CRC</publisher-name>. <year>2017</year>.</mixed-citation>
</ref>
<ref id="pcbi.1007205.ref025">
<label>25</label>
<mixed-citation publication-type="other" xlink:type="simple">Mcintire M, Ratner D, Ermon S. Sparse Gaussian Processes for Bayesian Optimization. Proceedings of the Conference on Uncertainty in Artificial Intelligence (UAI). 2016.</mixed-citation>
</ref>
<ref id="pcbi.1007205.ref026">
<label>26</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Cunningham</surname> <given-names>JP</given-names></name>, <name name-style="western"><surname>Byron</surname> <given-names>MY</given-names></name>, <name name-style="western"><surname>Shenoy</surname> <given-names>KV</given-names></name>, <name name-style="western"><surname>Sahani</surname> <given-names>M</given-names></name>. <article-title>Inferring neural firing rates from spike trains using Gaussian processes</article-title>. <source>Advances in Neural Information Processing Systems (NIPS)</source>. <year>2008</year>;<volume>20</volume>:<fpage>329</fpage>–<lpage>336</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1007205.ref027">
<label>27</label>
<mixed-citation publication-type="other" xlink:type="simple">GPy: A Gaussian process framework in python; since 2012. <ext-link ext-link-type="uri" xlink:href="http://github.com/SheffieldML/GPy" xlink:type="simple">http://github.com/SheffieldML/GPy</ext-link>.</mixed-citation>
</ref>
<ref id="pcbi.1007205.ref028">
<label>28</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Salvatier</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Wiecki</surname> <given-names>TV</given-names></name>, <name name-style="western"><surname>Fonnesbeck</surname> <given-names>C</given-names></name>. <article-title>Probabilistic programming in Python using PyMC3</article-title>. <source>PeerJ Computer Science</source>. <year>2016</year>;<volume>2</volume>:<fpage>e55</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.7717/peerj-cs.55" xlink:type="simple">10.7717/peerj-cs.55</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1007205.ref029">
<label>29</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Carpenter</surname> <given-names>B</given-names></name>, <name name-style="western"><surname>Gelman</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Hoffman</surname> <given-names>MD</given-names></name>, <name name-style="western"><surname>Lee</surname> <given-names>D</given-names></name>, <name name-style="western"><surname>Goodrich</surname> <given-names>B</given-names></name>, <name name-style="western"><surname>Betancourt</surname> <given-names>M</given-names></name>, <etal>et al</etal>. <article-title>Stan: A probabilistic programming language</article-title>. <source>Journal of Statistical Software</source>. <year>2017</year>;<volume>76</volume>(<issue>1</issue>). <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.18637/jss.v076.i01" xlink:type="simple">10.18637/jss.v076.i01</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1007205.ref030">
<label>30</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Schindelin</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Arganda-Carreras</surname> <given-names>I</given-names></name>, <name name-style="western"><surname>Frise</surname> <given-names>E</given-names></name>, <name name-style="western"><surname>Kaynig</surname> <given-names>V</given-names></name>, <name name-style="western"><surname>Longair</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Pietzsch</surname> <given-names>T</given-names></name>, <etal>et al</etal>. <article-title>Fiji: an open-source platform for biological-image analysis</article-title>. <source>Nature methods</source>. <year>2012</year>;<volume>9</volume>(<issue>7</issue>):<fpage>676</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1038/nmeth.2019" xlink:type="simple">10.1038/nmeth.2019</ext-link></comment> <object-id pub-id-type="pmid">22743772</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007205.ref031">
<label>31</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Euler</surname> <given-names>T</given-names></name>, <name name-style="western"><surname>Hausselt</surname> <given-names>SE</given-names></name>, <name name-style="western"><surname>Margolis</surname> <given-names>DJ</given-names></name>, <name name-style="western"><surname>Breuninger</surname> <given-names>T</given-names></name>, <name name-style="western"><surname>Castell</surname> <given-names>X</given-names></name>, <name name-style="western"><surname>Detwiler</surname> <given-names>PB</given-names></name>, <etal>et al</etal>. <article-title>Eyecup scope-optical recordings of light stimulus-evoked fluorescence signals in the retina</article-title>. <source>Pflügers Archiv European Journal of Physiology</source>. <year>2009</year>;<volume>457</volume>(<issue>6</issue>):<fpage>1393</fpage>–<lpage>1414</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1007/s00424-008-0603-5" xlink:type="simple">10.1007/s00424-008-0603-5</ext-link></comment> <object-id pub-id-type="pmid">19023590</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007205.ref032">
<label>32</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Szél</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Röhlich</surname> <given-names>P</given-names></name>, <name name-style="western"><surname>Gaffé</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Juliusson</surname> <given-names>B</given-names></name>, <name name-style="western"><surname>Aguirre</surname> <given-names>Gv</given-names></name>, <name name-style="western"><surname>Van-Veen</surname> <given-names>T</given-names></name>. <article-title>Unique topographic separation of two spectral classes of cones in the mouse retina</article-title>. <source>Journal of Comparative Neurology</source>. <year>1992</year>;<volume>325</volume>(<issue>3</issue>):<fpage>327</fpage>–<lpage>342</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1002/cne.903250302" xlink:type="simple">10.1002/cne.903250302</ext-link></comment> <object-id pub-id-type="pmid">1447405</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007205.ref033">
<label>33</label>
<mixed-citation publication-type="other" xlink:type="simple">QDSpy: Python 3 software for generating and presenting stimuli for visual neuroscience; 2018. <ext-link ext-link-type="uri" xlink:href="https://github.com/eulerlab/QDSpy" xlink:type="simple">https://github.com/eulerlab/QDSpy</ext-link>.</mixed-citation>
</ref>
<ref id="pcbi.1007205.ref034">
<label>34</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Dorostkar</surname> <given-names>MM</given-names></name>, <name name-style="western"><surname>Dreosti</surname> <given-names>E</given-names></name>, <name name-style="western"><surname>Odermatt</surname> <given-names>B</given-names></name>, <name name-style="western"><surname>Lagnado</surname> <given-names>L</given-names></name>. <article-title>Computational processing of optical measurements of neuronal and synaptic activity in networks</article-title>. <source>Journal of neuroscience methods</source>. <year>2010</year>;<volume>188</volume>(<issue>1</issue>):<fpage>141</fpage>–<lpage>150</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.jneumeth.2010.01.033" xlink:type="simple">10.1016/j.jneumeth.2010.01.033</ext-link></comment> <object-id pub-id-type="pmid">20152860</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007205.ref035">
<label>35</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Ward</surname> <suffix>Jr</suffix></name>, <name name-style="western"><surname>Joe</surname> <given-names>H</given-names></name>. <article-title>Hierarchical grouping to optimize an objective function</article-title>. <source>Journal of the American statistical association</source>. <year>1963</year>;<volume>58</volume>(<issue>301</issue>):<fpage>236</fpage>–<lpage>44</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1080/01621459.1963.10500845" xlink:type="simple">10.1080/01621459.1963.10500845</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1007205.ref036">
<label>36</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Taylor</surname> <given-names>JE</given-names></name>, and <name name-style="western"><surname>Adler</surname> <given-names>RJ</given-names></name>. <article-title>Euler characteristics for Gaussian fields on manifolds</article-title>. <source>The Annals of Probability</source>. <year>2003</year>;<volume>31</volume>(<issue>2</issue>):<fpage>533</fpage>–<lpage>563</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1214/aop/1048516527" xlink:type="simple">10.1214/aop/1048516527</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1007205.ref037">
<label>37</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Chumbley</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Worsley</surname> <given-names>K</given-names></name>, <name name-style="western"><surname>Flandin</surname> <given-names>G</given-names></name>, <name name-style="western"><surname>Friston</surname> <given-names>K</given-names></name>. <article-title>Topological FDR for neuroimaging</article-title>. <source>Neuroimage</source>. <year>2009</year>;<volume>49</volume>(<issue>4</issue>):<fpage>3057</fpage>–<lpage>3064</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.neuroimage.2009.10.090" xlink:type="simple">10.1016/j.neuroimage.2009.10.090</ext-link></comment> <object-id pub-id-type="pmid">19944173</object-id></mixed-citation>
</ref>
</ref-list>
</back>
</article>