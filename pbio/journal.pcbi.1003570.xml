<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article
  PUBLIC "-//NLM//DTD Journal Publishing DTD v3.0 20080202//EN" "http://dtd.nlm.nih.gov/publishing/3.0/journalpublishing3.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="3.0" xml:lang="en">
<front>
<journal-meta>
<journal-id journal-id-type="publisher-id">plos</journal-id>
<journal-id journal-id-type="nlm-ta">PLoS Comput Biol</journal-id>
<journal-id journal-id-type="pmc">ploscomp</journal-id><journal-title-group>
<journal-title>PLoS Computational Biology</journal-title></journal-title-group>
<issn pub-type="ppub">1553-734X</issn>
<issn pub-type="epub">1553-7358</issn>
<publisher>
<publisher-name>Public Library of Science</publisher-name>
<publisher-loc>San Francisco, USA</publisher-loc></publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="publisher-id">PCOMPBIOL-D-13-01925</article-id>
<article-id pub-id-type="doi">10.1371/journal.pcbi.1003570</article-id>
<article-categories><subj-group subj-group-type="heading"><subject>Research Article</subject></subj-group><subj-group subj-group-type="Discipline-v2"><subject>Biology and life sciences</subject><subj-group><subject>Evolutionary biology</subject><subj-group><subject>Population genetics</subject></subj-group></subj-group><subj-group><subject>Population biology</subject><subj-group><subject>Population dynamics</subject></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v2"><subject>Medicine and health sciences</subject><subj-group><subject>Epidemiology</subject></subj-group></subj-group><subj-group subj-group-type="Discipline-v2"><subject>Physical sciences</subject><subj-group><subject>Mathematics</subject><subj-group><subject>Statistics (mathematics)</subject><subj-group><subject>Statistical methods</subject></subj-group></subj-group></subj-group></subj-group></article-categories>
<title-group>
<article-title>Phylodynamic Inference for Structured Epidemiological Models</article-title>
<alt-title alt-title-type="running-head">Phylodynamic Inference</alt-title>
</title-group>
<contrib-group>
<contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Rasmussen</surname><given-names>David A.</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref><xref ref-type="corresp" rid="cor1"><sup>*</sup></xref></contrib>
<contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Volz</surname><given-names>Erik M.</given-names></name><xref ref-type="aff" rid="aff2"><sup>2</sup></xref></contrib>
<contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Koelle</surname><given-names>Katia</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref><xref ref-type="aff" rid="aff3"><sup>3</sup></xref></contrib>
</contrib-group>
<aff id="aff1"><label>1</label><addr-line>Biology Department, Duke University, Durham, North Carolina, United States of America</addr-line></aff>
<aff id="aff2"><label>2</label><addr-line>Department of Infectious Disease Epidemiology, Imperial College London, London, United Kingdom</addr-line></aff>
<aff id="aff3"><label>3</label><addr-line>Fogarty International Center, National Institutes of Health, Bethesda, Maryland, United States of America</addr-line></aff>
<contrib-group>
<contrib contrib-type="editor" xlink:type="simple"><name name-style="western"><surname>Kosakovsky Pond</surname><given-names>Sergei L.</given-names></name>
<role>Editor</role>
<xref ref-type="aff" rid="edit1"/></contrib>
</contrib-group>
<aff id="edit1"><addr-line>University of California San Diego, United States of America</addr-line></aff>
<author-notes>
<corresp id="cor1">* E-mail: <email xlink:type="simple">david.rasmussen@duke.edu</email></corresp>
<fn fn-type="conflict"><p>The authors have declared that no competing interests exist.</p></fn>
<fn fn-type="con"><p>Conceived and designed the experiments: DAR EMV KK. Performed the experiments: DAR. Analyzed the data: DAR. Contributed reagents/materials/analysis tools: DAR EMV. Wrote the paper: DAR EMV KK.</p></fn>
</author-notes>
<pub-date pub-type="collection"><month>4</month><year>2014</year></pub-date>
<pub-date pub-type="epub"><day>17</day><month>4</month><year>2014</year></pub-date>
<volume>10</volume>
<issue>4</issue>
<elocation-id>e1003570</elocation-id>
<history>
<date date-type="received"><day>1</day><month>11</month><year>2013</year></date>
<date date-type="accepted"><day>28</day><month>2</month><year>2014</year></date>
</history>
<permissions>
<copyright-year>2014</copyright-year>
<copyright-holder>Rasmussen et al</copyright-holder><license xlink:type="simple"><license-p>This is an open-access article distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/" xlink:type="simple">Creative Commons Attribution License</ext-link>, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p></license></permissions>
<abstract>
<p>Coalescent theory is routinely used to estimate past population dynamics and demographic parameters from genealogies. While early work in coalescent theory only considered simple demographic models, advances in theory have allowed for increasingly complex demographic scenarios to be considered. The success of this approach has lead to coalescent-based inference methods being applied to populations with rapidly changing population dynamics, including pathogens like RNA viruses. However, fitting epidemiological models to genealogies via coalescent models remains a challenging task, because pathogen populations often exhibit complex, nonlinear dynamics and are structured by multiple factors. Moreover, it often becomes necessary to consider stochastic variation in population dynamics when fitting such complex models to real data. Using recently developed structured coalescent models that accommodate complex population dynamics and population structure, we develop a statistical framework for fitting stochastic epidemiological models to genealogies. By combining particle filtering methods with Bayesian Markov chain Monte Carlo methods, we are able to fit a wide class of stochastic, nonlinear epidemiological models with different forms of population structure to genealogies. We demonstrate our framework using two structured epidemiological models: a model with disease progression between multiple stages of infection and a two-population model reflecting spatial structure. We apply the multi-stage model to HIV genealogies and show that the proposed method can be used to estimate the stage-specific transmission rates and prevalence of HIV. Finally, using the two-population model we explore how much information about population structure is contained in genealogies and what sample sizes are necessary to reliably infer parameters like migration rates.</p>
</abstract>
<abstract abstract-type="summary"><title>Author Summary</title>
<p>Mathematical models play an important role in our understanding of what processes drive the complex population dynamics of infectious pathogens. Yet developing statistical methods for fitting models to epidemiological data is difficult. Epidemiological data is often noisy, incomplete, aggregated across different scales and generally provides only a partial picture of the underlying disease dynamics. Using nontraditional sources of data, like molecular sequences of pathogens, can provide additional information about epidemiological dynamics. But current “phylodynamic” inference methods for fitting models to genealogies reconstructed from sequence data have a number of major limitations. We present a statistical framework that builds upon earlier work to address two of these limitations: population structure and stochasticity. By incorporating population structure, our framework can be applied in cases where the host population is divided into different subpopulations, such as by spatial isolation. Our framework also takes into consideration stochastic noise and can therefore capture the inherent variability of epidemiological dynamics. These advances allow for a much wider class of epidemiological models to be fit to genealogies in order to estimate key epidemiological parameters and to reconstruct past disease dynamics.</p>
</abstract>
<funding-group><funding-statement>DAR was funded by U.S. National Science Foundation Graduate Research Fellowship. EMV was supported by an NIAID K01 Career Development Award (AI91440). KK was supported by a NSF grant (NSF-EF-08-27416) and by a Complex Systems grant from the James S. McDonnell Foundation to KK. The funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.</funding-statement></funding-group><counts><page-count count="16"/></counts></article-meta>
</front>
<body><sec id="s1">
<title>Introduction</title>
<p>Genealogies can provide valuable information about the demographic history of a population because the demography of a population can dramatically shape the structure of a genealogy <xref ref-type="bibr" rid="pcbi.1003570-Nee1">[1]</xref>, <xref ref-type="bibr" rid="pcbi.1003570-Grenfell1">[2]</xref>. For example, fluctuations in population size will shift the distribution of branching events, or coalescent times, over a genealogy relative to what would be expected for a population with a constant size <xref ref-type="bibr" rid="pcbi.1003570-Donnelly1">[3]</xref>. Other aspects of a population's demographic history can also leave behind distinctive genealogical patterns. For example, the structuring of a population into different subpopulations can influence the topology of genealogies, which is often seen as clustering among individuals sampled from the same subpopulation <xref ref-type="bibr" rid="pcbi.1003570-Lewis1">[4]</xref>. These observations have led to great interest in statistical methods for inferring demographic trends and parameters from genealogies and given rise to the new field of phylodynamic inference <xref ref-type="bibr" rid="pcbi.1003570-Grenfell1">[2]</xref>, <xref ref-type="bibr" rid="pcbi.1003570-Kuhner1">[5]</xref>–<xref ref-type="bibr" rid="pcbi.1003570-Stadler1">[8]</xref>.</p>
<p>Most statistical methods for reconstructing the demographic history of a population from genealogies have been motivated by coalescent theory, which provides a probabilistic framework for relating the demographic history of a population to a genealogy of individuals sampled from that population <xref ref-type="bibr" rid="pcbi.1003570-Kingman1">[9]</xref>, <xref ref-type="bibr" rid="pcbi.1003570-Wakeley1">[10]</xref>. Critically, coalescent models provide a way to compute the probability of a given genealogy under a given demographic model. It is therefore possible to estimate parameters of a demographic model, such as population size, from a genealogy using likelihood-based inference methods. Extensions of this basic idea have been used to estimate changes in population size over time, for example by the Bayesian skyline methods available in the BEAST phylogenetic software package <xref ref-type="bibr" rid="pcbi.1003570-Strimmer1">[11]</xref>, <xref ref-type="bibr" rid="pcbi.1003570-Drummond1">[12]</xref>. Coalescent theory has also been extended to consider different forms of population structure, giving rise to structured coalescent models <xref ref-type="bibr" rid="pcbi.1003570-Notohara1">[13]</xref>, <xref ref-type="bibr" rid="pcbi.1003570-Takahata1">[14]</xref>. Statistical methods that allow fitting of structured coalescent models to genealogies have the ability to estimate parameters relating to population structure, including migration rates between populations <xref ref-type="bibr" rid="pcbi.1003570-Beerli1">[7]</xref>, <xref ref-type="bibr" rid="pcbi.1003570-Kuhner2">[15]</xref>.</p>
<p>Recent developments in phylodynamics have focused on developing models and statistical methods for more complex demographic scenarios, which have been largely motivated by the application of coalescent methods to pathogens like RNA viruses with rapidly changing population sizes. For example, coalescent models have been developed for populations where birth (i.e. transmission) rates vary over time <xref ref-type="bibr" rid="pcbi.1003570-Volz1">[16]</xref>, <xref ref-type="bibr" rid="pcbi.1003570-Frost1">[17]</xref>. Importantly, the framework of Volz <italic>et al.</italic> <xref ref-type="bibr" rid="pcbi.1003570-Volz1">[16]</xref> also considers the coalescent process in populations where transmission rates change over time in a nonlinear manner, as is often the case for epidemiological models like the well-known Susceptible-Infected-Recovered (SIR) model <xref ref-type="bibr" rid="pcbi.1003570-Anderson1">[18]</xref>. Coalescent models have also been developed for common epidemiological scenarios with population structure that alters the rate of coalescence in the population <xref ref-type="bibr" rid="pcbi.1003570-Koelle1">[19]</xref>, but these models are limited to populations at equilibrium. Finally, Volz <xref ref-type="bibr" rid="pcbi.1003570-Volz2">[20]</xref> presented a framework that brings together both complex population dynamics and population structure. This approach has great appeal as it generalizes coalescent models to allow both birth and migration rates to change over time as a function of the underlying population dynamics, which may be nonlinear and far from equilibrium.</p>
<p>Although recent advances with structured coalescent models have enabled the analysis of more complex epidemiological models, the statistical challenge remains of efficiently fitting stochastic population dynamic models to genealogies. These models can be extremely high-dimensional due to a large number of latent state variables for which we have no direct observations. In Rasmussen <italic>et al.</italic> <xref ref-type="bibr" rid="pcbi.1003570-Rasmussen1">[21]</xref>, a particle filtering approach was used to marginalize out these latent variables by forward simulating population dynamic trajectories from the epidemiological model and then averaging over these trajectories to a compute a marginal likelihood. For unstructured models, adapting particle filtering methods to coalescent-based inference is relatively straightforward as the likelihood of a genealogy is simply a function of the simulated population dynamic trajectories. However, for structured models the likelihood also depends on the internal states of lineages in the genealogy, which may change over time as lineages move between populations <xref ref-type="bibr" rid="pcbi.1003570-Volz2">[20]</xref>. The probable state of a lineage can only be calculated retrospectively conditional on the population's demographic history and the state of the lineage at the time of sampling. As we show below, these backward-time dependencies prevent the direct application of forward-time particle filtering methods to structured models.</p>
<p>We therefore present a new statistical approach for fitting stochastic population dynamics models to genealogies using the structured coalescent approach presented in Volz <xref ref-type="bibr" rid="pcbi.1003570-Volz2">[20]</xref> using a modified particle filtering algorithm. This modified algorithm allows for efficient particle filtering under structured coalescent models where the probability that a lineage is in a certain population may depend on both the past dynamics of the population as well as future sampling of lineages. Using this algorithm, we can fit stochastic, nonlinear epidemiological models with essentially any form of population structure to genealogies as long as the model is Markovian. Because population structure arises naturally in many epidemiological models, we define population structure in a very broad sense and consider any model where the population of infected hosts is structured into different nonequivalent states and therefore lineages in different infected hosts do not necessarily have an equal probability of coalescing. This includes models with spatial structure, multiple stages of infection and models of vector-borne and other multi-host pathogens.</p>
<p>The paper has the following structure. First, we present the forward-time epidemiological models that we use as examples throughout the paper. Next, we review the framework first developed in Volz <xref ref-type="bibr" rid="pcbi.1003570-Volz2">[20]</xref> for how coalescent models can be derived for a corresponding forward-time population dynamic model. We then describe how we can fit structured epidemiological models to genealogies given the corresponding structured coalescent model. The statistical method we describe combines MCMC methods with our particle filtering algorithm, and is a variation of the particle MCMC algorithm of Andrieu <italic>et al.</italic> <xref ref-type="bibr" rid="pcbi.1003570-Andrieu1">[22]</xref>. Using simulated genealogies, we show that this algorithm can accurately reconstruct population dynamics in structured populations and obtain reliable estimates of epidemiological parameters such as transmission rates. We then apply our approach to the HIV epidemic in Detroit, Michigan in order to estimate stage-specific transmission rates and infer how prevalence and incidence have changed over the course of the epidemic. Finally, we explore under what conditions parameters relating to population structure can be inferred from genealogies and how factors such as sample size affect uncertainty in our estimates.</p>
</sec><sec id="s2" sec-type="methods">
<title>Methods</title>
<sec id="s2a">
<title>Epidemiological models</title>
<p>In this paper, we use epidemiological models to demonstrate how mechanistic population dynamic models can be fit to genealogies. More specifically, we will consider the type of Susceptible-Infected-Recovered (SIR) models widely used to study the transmission dynamics of infectious diseases <xref ref-type="bibr" rid="pcbi.1003570-Anderson1">[18]</xref>, <xref ref-type="bibr" rid="pcbi.1003570-Keeling1">[23]</xref>. In SIR-type models, the host population is divided into different compartments depending on the host's state (e.g. susceptible or infected). For generality, we let <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e001" xlink:type="simple"/></inline-formula> be the vector that holds the number of hosts in each compartment at time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e002" xlink:type="simple"/></inline-formula>, for example <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e003" xlink:type="simple"/></inline-formula> for the standard SIR model. For stochastic models, the state variables in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e004" xlink:type="simple"/></inline-formula> are treated as random variables. We consider an epidemiological model to be structured if there is more than one class of infected host.</p>
<sec id="s2a1">
<title>Applications</title>
<p>We use two simple structured epidemiological models throughout the paper as illustrative examples. The first is a SIR model with three stages of infection, which illustrates how our approach can be applied to models where infected hosts progress through different stages of infection. In the <xref ref-type="sec" rid="s3">Results</xref> section, we apply this model to HIV data so we assume that these three stages correspond to the early, chronic and AIDS stages of HIV infection. The deterministic skeleton of the three-stage SIR model can be written as the following system of ordinary differential equations:<disp-formula id="pcbi.1003570.e005"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003570.e005" xlink:type="simple"/><label>(1)</label></disp-formula>Infections progress from one stage to the next according to the rates <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e006" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e007" xlink:type="simple"/></inline-formula>. We assume there is no recovery and that individuals with AIDS infection die at rate <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e008" xlink:type="simple"/></inline-formula> instead of the normal host mortality rate <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e009" xlink:type="simple"/></inline-formula>, where generally <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e010" xlink:type="simple"/></inline-formula>.</p>
<p>The force of infection <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e011" xlink:type="simple"/></inline-formula> is given by<disp-formula id="pcbi.1003570.e012"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003570.e012" xlink:type="simple"/><label>(2)</label></disp-formula>where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e013" xlink:type="simple"/></inline-formula> is the host population size (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e014" xlink:type="simple"/></inline-formula>). The exponential term in (2) allows incidence to scale nonlinearly with the prevalence of HIV in the population and has been frequently used in HIV models <xref ref-type="bibr" rid="pcbi.1003570-Williams1">[24]</xref>–<xref ref-type="bibr" rid="pcbi.1003570-Volz3">[26]</xref>. This nonlinear scaling may reflect heterogeneity in sexual contact rates or behavioral changes as awareness or diagnosis of the disease grows.</p>
<p>The second model we consider is a simple two-population SIR model where transmission can occur both within and between the two populations due to infectious individuals coming into contact with susceptible individuals in either population. While we do not explicitly define the factor that structures the population, population structure could be due to spatial structure or other factors like age that affect the probability of different hosts contacting one another. The deterministic skeleton of this model can be written as follows:<disp-formula id="pcbi.1003570.e015"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003570.e015" xlink:type="simple"/><label>(3)</label></disp-formula>The parameter <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e016" xlink:type="simple"/></inline-formula> is the host birth/death rate and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e017" xlink:type="simple"/></inline-formula> is the rate at which infected hosts recover. <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e018" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e019" xlink:type="simple"/></inline-formula> are the host population sizes, respectively. <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e020" xlink:type="simple"/></inline-formula> is the within-population transmission rate and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e021" xlink:type="simple"/></inline-formula> is the between-population transmission rate. We write the transmission rates as <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e022" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e023" xlink:type="simple"/></inline-formula> to allow the transmission rate to vary seasonally. Both <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e024" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e025" xlink:type="simple"/></inline-formula> are scaled relative to a base transmission rate <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e026" xlink:type="simple"/></inline-formula> such that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e027" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e028" xlink:type="simple"/></inline-formula>, so that the parameter <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e029" xlink:type="simple"/></inline-formula> controls the extent of mixing or coupling between the two populations, as in Keeling and Rohani <xref ref-type="bibr" rid="pcbi.1003570-Keeling2">[27]</xref>. Under this parameterization, the basic reproductive number <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e030" xlink:type="simple"/></inline-formula> and is therefore invariant to changes in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e031" xlink:type="simple"/></inline-formula> so that we can vary the degree of mixing between populations while not significantly altering the overall epidemiological dynamics.</p>
</sec></sec><sec id="s2b">
<title>Coalescent models</title>
<p>In this section, we consider formulating structured coalescent models for the type of structured epidemiological models just presented. As shown in Volz <xref ref-type="bibr" rid="pcbi.1003570-Volz2">[20]</xref>, thinking about population dynamic models as simple birth-death processes can be useful when deriving coalescent models that correspond to a given forward-time model. If we randomly sample individuals from a population and trace their ancestry back in time, then coalescent events in the genealogy will correspond to birth events in the population when both the parent and child lineages are ancestral to sampled individuals. While deaths may affect the overall population size, deaths can be ignored along lineages ancestral to sampled individuals because we know that a lineage could not have died out at an earlier time if it persisted to be sampled at some later time. For a structured population, we also must consider individuals transitioning between different subpopulations through migration events that occur independently of birth events, although for the type of models we will consider here a lineage can also transition between populations by being born into a different population than its parent.</p>
<p>The same birth-death-migration framework can be applied to pathogens if we assume that each infected host corresponds to a single individual in the pathogen population. In this case, births in the pathogen population occur at transmission events between hosts. Deaths in the population will correspond to recovery or mortality of infected hosts. If each infected host is represented by a single pathogen lineage, coalescent events in the genealogy will correspond to transmission events if both the infected host and the infector are sampled or give rise to descendent infections that are sampled. For structured epidemiological models, we also must consider a pathogen lineage transitioning among populations, or compartments in SIR-type models, independent of transmission events. For example, in the three-stage model, pathogen lineages can transition between different stages of infection. Here, we will refer to all transitions between states that occur independently of transmission as migration for generality. This allows many epidemiological models with some form of population structure to be thought of as a birth-death-migration process.</p>
<p>To formalize the birth process, we adopt the notation of Volz <xref ref-type="bibr" rid="pcbi.1003570-Volz2">[20]</xref> and let <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e032" xlink:type="simple"/></inline-formula> be a matrix that specifies the birth rate of new lineages in the population at time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e033" xlink:type="simple"/></inline-formula>, where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e034" xlink:type="simple"/></inline-formula>, meaning that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e035" xlink:type="simple"/></inline-formula> can be a function of the epidemiological parameters <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e036" xlink:type="simple"/></inline-formula> and the population state variables <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e037" xlink:type="simple"/></inline-formula>. Lineages may be in any one of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e038" xlink:type="simple"/></inline-formula> states. The rate at which lineages currently in state <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e039" xlink:type="simple"/></inline-formula> give birth to lineages in state <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e040" xlink:type="simple"/></inline-formula> is given by the element <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e041" xlink:type="simple"/></inline-formula>. The rate at which migration, or transitions between states independent of birth events, occurs is given by another matrix <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e042" xlink:type="simple"/></inline-formula>. The rate at which lineages currently in state <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e043" xlink:type="simple"/></inline-formula> migrate to state <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e044" xlink:type="simple"/></inline-formula> is given by the element <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e045" xlink:type="simple"/></inline-formula>. We treat birth and migration as distinct processes because, as we will see, they affect the coalescent process in different ways since coalescent events can only occur at birth events but migration events can affect the probability of a particular lineage coalescing with another lineage. The total number of lineages in each state is given by a vector <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e046" xlink:type="simple"/></inline-formula>, such that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e047" xlink:type="simple"/></inline-formula> gives the total number of individuals in the population in state <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e048" xlink:type="simple"/></inline-formula> at time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e049" xlink:type="simple"/></inline-formula>. From here in, we drop the time indices and just refer to the matrices <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e050" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e051" xlink:type="simple"/></inline-formula> or the vector <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e052" xlink:type="simple"/></inline-formula>, but emphasize that the rates in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e053" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e054" xlink:type="simple"/></inline-formula> and the population sizes in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e055" xlink:type="simple"/></inline-formula> can be time-dependent.</p>
<p>We illustrate the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e056" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e057" xlink:type="simple"/></inline-formula> matrix notation by decomposing the three-stage and two-population SIR models presented above into their component birth and migration processes. For the three-stage model, we have<disp-formula id="pcbi.1003570.e058"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003570.e058" xlink:type="simple"/><label>(4)</label></disp-formula><disp-formula id="pcbi.1003570.e059"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003570.e059" xlink:type="simple"/><label>(5)</label></disp-formula>In the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e060" xlink:type="simple"/></inline-formula> matrix, births occur through transmission of the pathogen from any of the three stages of infection to susceptible individuals. Because all new infections begin in the early stage, only the leftmost column of the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e061" xlink:type="simple"/></inline-formula> matrix has nonzero elements. The nonzero elements in the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e062" xlink:type="simple"/></inline-formula> matrix correspond to migration between stages through disease progression from early to chronic and from chronic to AIDS.</p>
<p>For the two-population model, we have<disp-formula id="pcbi.1003570.e063"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003570.e063" xlink:type="simple"/><label>(6)</label></disp-formula><disp-formula id="pcbi.1003570.e064"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003570.e064" xlink:type="simple"/><label>(7)</label></disp-formula>Because transmission events can move the pathogen within and between the two populations in either direction, all entries in the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e065" xlink:type="simple"/></inline-formula> matrix are nonzero. The <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e066" xlink:type="simple"/></inline-formula> matrix has all zero entries because there is no migration between populations independent of transmission.</p>
<p>Before moving on, we note that for an infectious pathogen our coalescent models make the implicit assumption that coalescent events in the genealogy correspond to transmission events between hosts. In essence then, we are ignoring the within-host coalescent process and assuming that all infected hosts are represented by a single lineage. This implies that lineages immediately coalesce once in the same infected host, which may not be true for certain pathogens where multiple lineages can persist within a host for long periods of time. Nevertheless, in general our assumption that each infected host is represented by a single pathogen lineage will be valid as long as super-infection is rare and there is a strong bottleneck in the pathogen population at transmission events so that it is unlikely that more than one lineage is transmitted between hosts.</p>
</sec><sec id="s2c">
<title>Coalescent likelihoods</title>
<p>To fit a structured coalescent model to a genealogy, we need to compute the likelihood of the coalescent model given the genealogy. To compute this likelihood, we can partition the genealogy into any number of discrete time intervals. We label the time partitioned genealogy <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e067" xlink:type="simple"/></inline-formula>, where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e068" xlink:type="simple"/></inline-formula> is the time of the first event in the genealogy and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e069" xlink:type="simple"/></inline-formula> is the final event time going forwards in time (usually the terminal-most sampling event). Time points are chosen to correspond to the times at which events in the genealogy occur such as coalescent and sampling events. We can then further subdivide the genealogy into smaller intervals that correspond to the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e070" xlink:type="simple"/></inline-formula> time steps used to simulate from the epidemiological model so that at any time point <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e071" xlink:type="simple"/></inline-formula> we have the state variables <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e072" xlink:type="simple"/></inline-formula> corresponding to that time. With the time partitioned genealogy <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e073" xlink:type="simple"/></inline-formula>, we can compute the likelihood over each interval in the genealogy, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e074" xlink:type="simple"/></inline-formula>, and then take the product over all intervals to compute the total likelihood of the model given <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e075" xlink:type="simple"/></inline-formula>.</p>
<p>Computing the likelihood over a time interval <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e076" xlink:type="simple"/></inline-formula> requires us to first compute the probabilities that the lineages present in the genealogy did or did not coalesce within that time interval. The probability of a coalescent event in turn depends on the expected rate of coalescence under the model. This expected rate can be computed for a coalescent model with any arbitrary population structure using the formalism summarized above for the rates of birth in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e077" xlink:type="simple"/></inline-formula>. As shown in Volz <xref ref-type="bibr" rid="pcbi.1003570-Volz2">[20]</xref>, the rate of coalescence <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e078" xlink:type="simple"/></inline-formula> for two lineages <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e079" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e080" xlink:type="simple"/></inline-formula> is<disp-formula id="pcbi.1003570.e081"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003570.e081" xlink:type="simple"/><label>(8)</label></disp-formula>where, for example, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e082" xlink:type="simple"/></inline-formula> is the probability that lineage <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e083" xlink:type="simple"/></inline-formula> is in state <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e084" xlink:type="simple"/></inline-formula>. How these lineage state probabilities are computed is explained below. We can make intuitive sense of the coalescent rate in (8) by noting that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e085" xlink:type="simple"/></inline-formula> is the total rate at which lineages in state <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e086" xlink:type="simple"/></inline-formula> give birth to lineages in state <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e087" xlink:type="simple"/></inline-formula> in the population and that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e088" xlink:type="simple"/></inline-formula> is the probability that lineages <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e089" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e090" xlink:type="simple"/></inline-formula> are the two lineages involved in a particular birth event. However, since we do not know the true states of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e091" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e092" xlink:type="simple"/></inline-formula> we must sum over all possible combinations of states for these two lineages.</p>
<p>The total rate of coalescence <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e093" xlink:type="simple"/></inline-formula> for all lineages <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e094" xlink:type="simple"/></inline-formula> present in the genealogy over an interval of time is then<disp-formula id="pcbi.1003570.e095"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003570.e095" xlink:type="simple"/><label>(9)</label></disp-formula></p>
<p>Given the rates of coalescence, we can then compute the likelihood over a time interval <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e096" xlink:type="simple"/></inline-formula> under the coalescent model. If the time interval does not end in a coalescent event, we have<disp-formula id="pcbi.1003570.e097"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003570.e097" xlink:type="simple"/><label>(10)</label></disp-formula>Alternatively, if the interval does end in a coalescent event between two lineages <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e098" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e099" xlink:type="simple"/></inline-formula>, we have<disp-formula id="pcbi.1003570.e100"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003570.e100" xlink:type="simple"/><label>(11)</label></disp-formula></p>
</sec><sec id="s2d">
<title>Lineage state probabilities</title>
<p>As alluded to above, computing the coalescent rates requires us to compute the probability of each lineage in the genealogy being in each possible state. At the time of sampling, we may know the state of a lineage from information gathered from the infected host from which the sample was obtained. Alternatively, if we do not know the state of the host at the time of sampling exactly, we can assign prior probabilities to the lineage being in each state under a multinomial distribution. Either way, given the initial state or state probabilities at the time of sampling, we need to be able to compute the probability of the lineage being in each state at any point in the past.</p>
<p>Going backwards in time, the lineages transition between states at the rates given in the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e101" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e102" xlink:type="simple"/></inline-formula> matrices, which in turn depends on the population states <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e103" xlink:type="simple"/></inline-formula> and the parameters <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e104" xlink:type="simple"/></inline-formula>. Given these transition rates, we have a continuous time Markov process on a discrete state space along each branch. We can therefore use master equations to track how the lineage state probabilities change going backwards through time. In other words, we can write down differential equations for how the probability mass assigned to each state flows between states as we move into the past. As shown in Volz <xref ref-type="bibr" rid="pcbi.1003570-Volz2">[20]</xref>, the general form that these master equations take for any lineage <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e105" xlink:type="simple"/></inline-formula> and state <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e106" xlink:type="simple"/></inline-formula> is<disp-formula id="pcbi.1003570.e107"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003570.e107" xlink:type="simple"/><label>(12)</label></disp-formula>where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e108" xlink:type="simple"/></inline-formula>; that is <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e109" xlink:type="simple"/></inline-formula> is the expected number of lineages in state <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e110" xlink:type="simple"/></inline-formula> in the genealogy at a given point in time. Further details on how the lineage state probabilities are computed and get updated at coalescent events are given in <xref ref-type="supplementary-material" rid="pcbi.1003570.s004">Text S1</xref>. For convenience, we introduce the notation <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e111" xlink:type="simple"/></inline-formula> to denote the lineage state probabilities for all lineages in the genealogy at time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e112" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e113" xlink:type="simple"/></inline-formula> to denote the complete mapping of lineage state probabilities onto the genealogy over the entire time partitioned genealogy <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e114" xlink:type="simple"/></inline-formula>.</p>
</sec><sec id="s2e">
<title>Statistical inference</title>
<p>The goal of phylodynamic inference for the type of models presented above will generally be to infer the parameters of interest from the genealogy along with the latent population state variables, such as the number of infected or susceptible hosts over time. In a Bayesian context then, we would like to infer the joint posterior density of the model parameters <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e115" xlink:type="simple"/></inline-formula> and the latent state variables <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e116" xlink:type="simple"/></inline-formula>. Up to a normalizing constant, this posterior density is given by<disp-formula id="pcbi.1003570.e117"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003570.e117" xlink:type="simple"/><label>(13)</label></disp-formula>From (13), we see that this joint density can be factored into three parts: the coalescent likelihood <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e118" xlink:type="simple"/></inline-formula> which we outlined how to compute above; the prior density on the population state variables <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e119" xlink:type="simple"/></inline-formula> as defined by the epidemiological process model; and the prior density on the parameters <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e120" xlink:type="simple"/></inline-formula>. Although we may be able to compute each component individually and thereby the posterior probability of a given set of parameters <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e121" xlink:type="simple"/></inline-formula> and population states <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e122" xlink:type="simple"/></inline-formula>, the posterior density is not analytically tractable in general and we must resort to sampling from the posterior using MCMC methods.</p>
<p>However, it may be difficult or impossible to sample from complex, high-dimensional densities such as <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e123" xlink:type="simple"/></inline-formula> using standard MCMC methods. We could, for example, use a Gibbs sampler to iteratively sample from the conditional posterior densities of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e124" xlink:type="simple"/></inline-formula> and any component of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e125" xlink:type="simple"/></inline-formula>, but this strategy can be extremely inefficient owing to strong correlations among the parameters and the state variables, leading to slow MCMC mixing <xref ref-type="bibr" rid="pcbi.1003570-Andrieu2">[28]</xref>. In Rasmussen <italic>et al.</italic> <xref ref-type="bibr" rid="pcbi.1003570-Rasmussen1">[21]</xref>, a particle MCMC approach known as the particle marginal Metropolis-Hastings (PMMH) algorithm was therefore used to sample from the joint posterior density of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e126" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e127" xlink:type="simple"/></inline-formula>. The main motivation behind using the PMMH algorithm is that we can jointly update <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e128" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e129" xlink:type="simple"/></inline-formula> together <xref ref-type="bibr" rid="pcbi.1003570-Andrieu1">[22]</xref>. Each MCMC iteration, we first propose new parameter values <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e130" xlink:type="simple"/></inline-formula> and then run a particle filtering algorithm to get a numerical approximation of the posterior density of the latent state variables <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e131" xlink:type="simple"/></inline-formula>, which we refer to as <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e132" xlink:type="simple"/></inline-formula>. Particle filtering, also known as sequential Monte Carlo, provides a computational means of approximating high dimensional densities by providing samples (i.e the particles) distributed according to the desired density, and are often used in the context of nonlinear and non-Gaussian state space models <xref ref-type="bibr" rid="pcbi.1003570-Doucet1">[29]</xref>–<xref ref-type="bibr" rid="pcbi.1003570-Doucet2">[31]</xref>. We review how particle filters can be used to fit epidemiological models to genealogies in <xref ref-type="supplementary-material" rid="pcbi.1003570.s004">Text S1</xref>.</p>
<p>After running the particle filtering step in the PMMH algorithm, we can then sample a particle from <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e133" xlink:type="simple"/></inline-formula> to get a proposal <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e134" xlink:type="simple"/></inline-formula> for the latent state variables that is adapted to the parameters in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e135" xlink:type="simple"/></inline-formula>. We can also use the particle filter to compute the marginal likelihood of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e136" xlink:type="simple"/></inline-formula> by marginalizing out the state variables. Because we jointly accept <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e137" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e138" xlink:type="simple"/></inline-formula> based on the marginal likelihood, we do not have to independently update <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e139" xlink:type="simple"/></inline-formula>, leading to a much more efficient MCMC sampler. Despite marginalizing out the latent state variables, the remarkable feature of the PMMH algorithm is it provides an exact (i.e. unbiased) approximation to the density of interest, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e140" xlink:type="simple"/></inline-formula>. The PMMH algorithm is summarized in pseudo-code below.</p>
<sec id="s2e1">
<title>Algorithm 1</title>
<p>The PMMH sampler targeting <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e141" xlink:type="simple"/></inline-formula></p>
<p>At each MCMC iteration, with current parameter values <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e142" xlink:type="simple"/></inline-formula>:</p>
<list list-type="order"><list-item>
<p>Sample <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e143" xlink:type="simple"/></inline-formula> from a proposal density <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e144" xlink:type="simple"/></inline-formula>.</p>
</list-item><list-item>
<p>Run particle filter to sample <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e145" xlink:type="simple"/></inline-formula> from <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e146" xlink:type="simple"/></inline-formula> and obtain the marginal likelihood estimate <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e147" xlink:type="simple"/></inline-formula>.</p>
</list-item><list-item>
<p>Accept <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e148" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e149" xlink:type="simple"/></inline-formula> with probability<disp-formula id="pcbi.1003570.e150"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003570.e150" xlink:type="simple"/><label>(14)</label></disp-formula></p>
</list-item></list>
<p>While the PMMH algorithm described above works for unstructured epidemiological models where all infected hosts are assumed to be in the same population, we encounter an additional problem for structured epidemiological models. In this case, the inference task at hand becomes more difficult because we need to take into account the unknown lineage states. This is done by conditioning on the lineage state probabilities <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e151" xlink:type="simple"/></inline-formula> when computing the coalescent likelihood. We can make this dependence on the lineage state probabilities clear by rewriting the likelihood as <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e152" xlink:type="simple"/></inline-formula>. We use the notation <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e153" xlink:type="simple"/></inline-formula> to indicate that while the lineage state probabilities are required to compute the coalescent likelihood, we are not treating the lineage states as random variables but rather as probabilities that are completely determined by the master equations shown in (12) given <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e154" xlink:type="simple"/></inline-formula> and a population state trajectory <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e155" xlink:type="simple"/></inline-formula>.</p>
<p>Recall that the probability of a lineage being in a certain state in the past depends conditionally on the state of the lineage at the time of sampling. This creates a backwards-time dependence structure that cannot easily be accommodated by the forwards in time particle filtering methods used in the PMMH approach. This is because the computational efficiency of the particle filter largely relies on the ability to resample—replacing particles with low weights with particles with high weights. In order to resample, we need to be able to compute the particle weights at any time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e156" xlink:type="simple"/></inline-formula>, which in turn requires the ability to compute the likelihood <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e157" xlink:type="simple"/></inline-formula> over any time interval. Computing this likelihood therefore entails being able to compute the lineage state probabilities <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e158" xlink:type="simple"/></inline-formula>, which will depend on the future states of the system <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e159" xlink:type="simple"/></inline-formula> for any structured model. The backward-time dependency of the lineage state probabilities therefore prohibits resampling and thus compromises the efficiency of the particle filter. We therefore use a modified particle filtering scheme that allows us to resample by computing expected lineage state probabilities before running the particle filter and then applying a correction step to counteract any bias introduced by using the expected rather than the true lineage state probabilities while filtering.</p>
<p>In more detail, the algorithm proceeds as follows. We initially simulate a deterministic trajectory from the epidemiological model for the state variables in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e160" xlink:type="simple"/></inline-formula>, which we refer to as <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e161" xlink:type="simple"/></inline-formula>. We can then compute the expected lineage state probabilities <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e162" xlink:type="simple"/></inline-formula> going backwards in time conditional on <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e163" xlink:type="simple"/></inline-formula>. We then run the particle filter forward in time to approximate the density <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e164" xlink:type="simple"/></inline-formula>. Although <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e165" xlink:type="simple"/></inline-formula> is not ultimately the target density we are interested in, it serves a useful intermediate purpose. Once we have sampled particles representing trajectories from <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e166" xlink:type="simple"/></inline-formula>, we can re-weight these particles and use an additional round of importance sampling to get particles representing samples from <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e167" xlink:type="simple"/></inline-formula>, our density of interest.</p>
<p>To do this, for each particle <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e168" xlink:type="simple"/></inline-formula> sampled using the particle filter we compute the true lineage state probabilities <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e169" xlink:type="simple"/></inline-formula> conditional on the actual population state trajectory of the particle <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e170" xlink:type="simple"/></inline-formula>. We can therefore compute the corrected weights <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e171" xlink:type="simple"/></inline-formula> using the true lineage state probabilities. We also store the expected weights <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e172" xlink:type="simple"/></inline-formula> computed using the expected lineage state probabilities. With both the expected weights <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e173" xlink:type="simple"/></inline-formula> and corrected weights <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e174" xlink:type="simple"/></inline-formula> we can assign final importance weights <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e175" xlink:type="simple"/></inline-formula> and resample particles again according to the final weights in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e176" xlink:type="simple"/></inline-formula>. This final round of importance sampling corrects for any bias we may have introduced by resampling particles using the expected lineage state probabilities while filtering and thereby gives us particles approximately distributed according to the target density <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e177" xlink:type="simple"/></inline-formula>.</p>
</sec><sec id="s2e2">
<title>Algorithm 2</title>
<p>The particle filter/importance sampler targeting <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e178" xlink:type="simple"/></inline-formula></p>
<list list-type="order"><list-item>
<p>Run deterministic simulation to obtain <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e179" xlink:type="simple"/></inline-formula> and compute the  expected lineage state probabilities <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e180" xlink:type="simple"/></inline-formula> conditional on <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e181" xlink:type="simple"/></inline-formula>.</p>
</list-item><list-item>
<p>Initialize the particle filter at time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e182" xlink:type="simple"/></inline-formula> with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e183" xlink:type="simple"/></inline-formula> particles.</p>
<list list-type="alpha-lower"><list-item>
<p>Set <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e184" xlink:type="simple"/></inline-formula> to initial values for all particles.</p>
</list-item><list-item>
<p>Assign normalized weights, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e185" xlink:type="simple"/></inline-formula></p>
</list-item></list>
</list-item><list-item>
<p>Run filter from <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e186" xlink:type="simple"/></inline-formula> to <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e187" xlink:type="simple"/></inline-formula>.</p>
<list list-type="alpha-lower"><list-item>
<p>Propagate particles forward by simulating from the process model <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e188" xlink:type="simple"/></inline-formula>.</p>
</list-item><list-item>
<p>Set <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e189" xlink:type="simple"/></inline-formula> for all particles.</p>
</list-item><list-item>
<p>Compute unnormalized weights conditional on <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e190" xlink:type="simple"/></inline-formula>,<disp-formula id="pcbi.1003570.e191"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003570.e191" xlink:type="simple"/><label>(15)</label></disp-formula></p>
</list-item><list-item>
<p>Normalize weights, so that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e192" xlink:type="simple"/></inline-formula>.</p>
</list-item><list-item>
<p>If resampling at <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e193" xlink:type="simple"/></inline-formula>, resample according to <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e194" xlink:type="simple"/></inline-formula>.</p>
</list-item></list>
</list-item><list-item>
<p>At time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e195" xlink:type="simple"/></inline-formula>, resample particles again according to <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e196" xlink:type="simple"/></inline-formula> to get particles distributed according to <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e197" xlink:type="simple"/></inline-formula>.</p>
</list-item><list-item>
<p>Compute corrected lineage state probabilities <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e198" xlink:type="simple"/></inline-formula> for each particle conditional on <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e199" xlink:type="simple"/></inline-formula>.</p>
</list-item><list-item>
<p>Compute corrected weights <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e200" xlink:type="simple"/></inline-formula>.</p>
</list-item><list-item>
<p>Compute final importance weights <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e201" xlink:type="simple"/></inline-formula> and normalize to get <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e202" xlink:type="simple"/></inline-formula>.</p>
</list-item><list-item>
<p>Sample <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e203" xlink:type="simple"/></inline-formula> from <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e204" xlink:type="simple"/></inline-formula> according <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e205" xlink:type="simple"/></inline-formula>.</p>
</list-item><list-item>
<p>Compute marginal likelihood estimate<disp-formula id="pcbi.1003570.e206"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003570.e206" xlink:type="simple"/><label>(16)</label></disp-formula></p>
</list-item></list>
<p>The particle filter/importance sampler therefore provides us with a proposal for the population state variables <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e207" xlink:type="simple"/></inline-formula> and an estimate of the marginal likelihood. We can therefore plug the particle filter/importance sampler into step 2 of Algorithm 1 to obtain a PMMH algorithm for sampling from the joint posterior density of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e208" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e209" xlink:type="simple"/></inline-formula> under structured epidemiological models. Moreover, because we marginalize over the population state variables <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e210" xlink:type="simple"/></inline-formula> using the particle filter and then marginalize over the lineage states by summing over all possible lineage states when computing the likelihood, we can efficiently sample from the posterior density using the PMMH algorithm without having to design proposal updates for the population states or lineage states.</p>
<p>Before moving on, we make a few notes about the potential limitations and efficiency of the particle filter/importance sampler. As a basic requirement of importance sampling, the support of the importance density <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e211" xlink:type="simple"/></inline-formula> must span the support of the target density <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e212" xlink:type="simple"/></inline-formula>), so that wherever <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e213" xlink:type="simple"/></inline-formula> so must <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e214" xlink:type="simple"/></inline-formula>. However, in order for the particle filter/importance sampler to be efficient, the density <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e215" xlink:type="simple"/></inline-formula> should also be similar to <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e216" xlink:type="simple"/></inline-formula>. Of course, this might not always be the case. If the stochastic particle trajectories can diverge largely from <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e217" xlink:type="simple"/></inline-formula> or the lineage state probabilities are highly correlated with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e218" xlink:type="simple"/></inline-formula> (such that small changes in the population states lead to large jumps in the lineage state probabilities), then these two densities may be quite different, causing the importance sampler to become very inefficient and requiring us to sample many particle trajectories in order to obtain a reasonable particle approximation to <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e219" xlink:type="simple"/></inline-formula>. In such cases, it may be unwise to resample particles according to their expected weights <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e220" xlink:type="simple"/></inline-formula> during the particle filtering stage because these weights will not be predictive of the corrected weights <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e221" xlink:type="simple"/></inline-formula>, meaning we may be discarding particles with high posterior probability under the desired density <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e222" xlink:type="simple"/></inline-formula>. In practice, this can easily be checked by making sure that there is a strong positive correlation between the expected and corrected weights. We found this to be true for all cases considered in this paper and found that resampling according to the expected weights during the filtering stage measurably improved the performance of the algorithm by reducing the variance in the marginal likelihood estimates, which tends to improve MCMC mixing overall.</p>
</sec></sec><sec id="s2f">
<title>Simulations</title>
<p>We simulated mock genealogies under each model to test the performance of the PMMH algorithm before applying the method to real data. Mock genealogies were obtained by first forward simulating from the population dynamic model while tracking all infected hosts in the population and the parent-offspring relationships at transmission events. From the forward simulations, we could then trace the lineages of infected individuals backwards through time to obtain the true genealogy for a fraction of sampled lineages. All population dynamic simulations were performed using the tau-leaping algorithm so that the epidemiological dynamics included demographic noise <xref ref-type="bibr" rid="pcbi.1003570-Gillespie1">[32]</xref>.</p>
<p>The three-stage model was parameterized to reflect the natural history of HIV because we planned to apply our method to real HIV genealogies (see <xref ref-type="table" rid="pcbi-1003570-t001">Table 1</xref>). We set the disease progression and AIDS death rate to values that give an average time between infection and death of about 10 years, consistent with observed patterns. The incidence scaling parameter <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e223" xlink:type="simple"/></inline-formula> was set to zero so that in the simulations there was a linear scaling between incidence and prevalence. The epidemic simulations were seeded with one early-stage infection at time zero and run for 37 years to reflect the timespan of the HIV epidemic in the U.S. To obtain mock genealogies from the complete infection trees, we sampled 200 individuals in the last six years of the epidemic to reflect the fact that most HIV sequences have been sampled in the recent past. For all parameters, we chose to use uniform priors over a wide range of biologically plausible values so that the choice of prior would have minimal influence on our estimates.</p>
<table-wrap id="pcbi-1003570-t001" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003570.t001</object-id><label>Table 1</label><caption>
<title>Fixed parameters in the epidemiological models.</title>
</caption><alternatives><graphic id="pcbi-1003570-t001-1" position="float" mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003570.t001" xlink:type="simple"/>
<table><colgroup span="1"><col align="left" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/></colgroup>
<thead>
<tr>
<td colspan="2" align="left" rowspan="1">Three-stage model</td>
<td colspan="2" align="left" rowspan="1">Two-population model</td>
</tr>
</thead>
<tbody>
<tr>
<td align="left" rowspan="1" colspan="1">Initial population size</td>
<td align="left" rowspan="1" colspan="1"><italic>N</italic> = 10,000</td>
<td align="left" rowspan="1" colspan="1">Initial population sizes</td>
<td align="left" rowspan="1" colspan="1"><italic>N</italic><sub>1</sub> = <italic>N</italic><sub>2</sub> = 2 million</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">Birth/death rate</td>
<td align="left" rowspan="1" colspan="1"><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e224" xlink:type="simple"/></inline-formula> yr<sup>−1</sup></td>
<td align="left" rowspan="1" colspan="1">Birth/death rate</td>
<td align="left" rowspan="1" colspan="1"><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e225" xlink:type="simple"/></inline-formula> yr<sup>−1</sup></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">Progression rate</td>
<td align="left" rowspan="1" colspan="1"><italic>γ<sub>E</sub></italic> = 1 yr<sup>−1</sup></td>
<td align="left" rowspan="1" colspan="1">Recovery rate</td>
<td align="left" rowspan="1" colspan="1"><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e226" xlink:type="simple"/></inline-formula> day<sup>−1</sup></td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">Progression rate</td>
<td align="left" rowspan="1" colspan="1"><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e227" xlink:type="simple"/></inline-formula> yr<sup>−1</sup></td>
<td align="left" rowspan="1" colspan="1">Seasonal amplitude</td>
<td align="left" rowspan="1" colspan="1"><italic>α</italic> = 0.08</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">AIDS death rate</td>
<td align="left" rowspan="1" colspan="1"><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e228" xlink:type="simple"/></inline-formula> yr<sup>−1</sup></td>
<td align="left" rowspan="1" colspan="1">Seasonal phase</td>
<td align="left" rowspan="1" colspan="1"><italic>δ</italic><sub>1</sub> = 0.0 yrs</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1"/>
<td align="left" rowspan="1" colspan="1"/>
<td align="left" rowspan="1" colspan="1"/>
<td align="left" rowspan="1" colspan="1"><italic>δ</italic><sub>2</sub> = 0.5 yrs</td>
</tr>
</tbody>
</table>
</alternatives></table-wrap>
<p>For the two-population model, we added seasonality to the model by seasonally forcing the base transmission rate <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e229" xlink:type="simple"/></inline-formula> using a sinusoidal forcing function, where<disp-formula id="pcbi.1003570.e230"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003570.e230" xlink:type="simple"/><label>(17)</label></disp-formula>The strength of seasonality <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e231" xlink:type="simple"/></inline-formula> was the same in both populations but we allowed <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e232" xlink:type="simple"/></inline-formula> to differ between the two populations to get asynchronous dynamics between populations. The values of all fixed parameters in the model are also shown in <xref ref-type="table" rid="pcbi-1003570-t001">Table 1</xref>. For the genealogies, 120 infected hosts were randomly sampled over time with sampling effort proportional to disease prevalence in each population. For the two-population model, we fixed the initial conditions for the number of susceptible and infected hosts in each population.</p>
<p>For the simulation experiments, we wished to compare estimates obtained by fitting stochastic models using the PMMH algorithm against estimates obtained by fitting deterministic models. To fit deterministic models, we used a Metropolis-Hastings sampler where, whenever new parameters are proposed, the likelihood of the genealogy under the new parameters is computed by conditioning on a deterministic trajectory of the state variables <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e233" xlink:type="simple"/></inline-formula> simulated from the model using these new parameters.</p>
</sec><sec id="s2g">
<title>HIV data</title>
<p>We applied our method to a set of HIV-1 partial <italic>pol</italic> sequences collected from men who have sex with men (MSM) in the metropolitan area of Detroit, Michigan. The dataset contained 437 HIV-1 subtype B sequences which were originally collected for drug resistance testing between 2004 and 2011. More information about this dataset can be found in Volz <italic>et al.</italic> <xref ref-type="bibr" rid="pcbi.1003570-Volz3">[26]</xref>. Data were anonymized by staff at the Michigan Department of Community Health before being provided to investigators. Because this research falls under the original mandate for HIV surveillance and was de-identified, it was classified as human subjects research but was exempt from further IRB review.</p>
<p>We reconstructed time-scaled genealogies from the HIV sequences in BEAST using a relaxed molecular clock <xref ref-type="bibr" rid="pcbi.1003570-Drummond2">[33]</xref>. All sequences identified as likely recombinants were removed from the alignment prior to the analysis. Tips in the genealogy corresponding to sampled infected individuals were assigned prior probabilities of being in each infection stage based on the time since infection estimated from CD4 cell counts and genetic diversity within the host <xref ref-type="bibr" rid="pcbi.1003570-Volz4">[34]</xref>.</p>
<p>From the HIV genealogies, we estimated the transmission rates <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e234" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e235" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e236" xlink:type="simple"/></inline-formula> as well as the incidence scaling parameter <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e237" xlink:type="simple"/></inline-formula>. All other parameters were fixed at the values given in <xref ref-type="table" rid="pcbi-1003570-t001">Table 1</xref>. Rather than estimate initial conditions, the time of the initial introduction of HIV into Detroit was estimated, at which point the epidemic was seeded with one early-stage infection in a completely susceptible population. All priors on the parameters were uniform. For the time of initial introduction the prior was truncated at 1973 as a lower bound and the root time of each tree as an upper bound. To ensure our phylodynamic estimates of HIV incidence were reasonable, we compared our estimates against incidence back-calculated from Michigan Department of Community Health surveillance data using the method of Yan <italic>et al.</italic> <xref ref-type="bibr" rid="pcbi.1003570-Yan1">[35]</xref>.</p>
</sec><sec id="s2h">
<title>Implementation</title>
<p>For all results shown in this paper, the PMMH algorithm was run for at least 100,000 iterations or until the MCMC fully converged. For the Metropolis-Hastings step, we chose a multivariate normal proposal density for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e238" xlink:type="simple"/></inline-formula>, which can take into account the correlations among different parameters by optimizing the covariance parameters that specify the density.</p>
<p>For the particle filter, we found that using a small number of particles (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e239" xlink:type="simple"/></inline-formula>) was sufficient. Running the particle filter with a small number of particles tends to increase the error, or variance, in the marginal likelihood estimates. However, this error will not affect inference as long as the marginal likelihood estimates are not systematically biased because the error in the estimates will get averaged out in the encompassing MCMC algorithm. Nevertheless, with too few particles we run the risk of the MCMC getting stuck at erroneously high values of the likelihood. Our choice of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e240" xlink:type="simple"/></inline-formula> was therefore a compromise between minimizing the error in the marginal likelihood estimates and the time taken to run the particle filter. Resampling within the particle filter was done by multinomial sampling with replacement. Resampling times were chosen to minimize the variance in the marginal likelihood estimates and were usually placed around coalescent events, as most of the variation in particle weights arises at coalescent times.</p>
<p>The PMMH algorithm was implemented in the software package PHYLter and Java source code is freely available at <ext-link ext-link-type="uri" xlink:href="http://code.google.com/p/phylter/" xlink:type="simple">http://code.google.com/p/phylter/</ext-link>. Running the PMMH algorithm for 100,000 iterations using the simulated HIV genealogies took approximately 10 hours (0.36 s per iteration) on a 3.4 GHz Intel i7 processor without any parallelization across cores. The most computationally intensive component of the algorithm is computing the lineage state probabilities, which involves numerically solving the master equations for each lineage in the genealogy and has a time complexity of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e241" xlink:type="simple"/></inline-formula>, where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e242" xlink:type="simple"/></inline-formula> is the number of possible lineage states. On the other hand, run times scale linearly with the number of particles and lineages in the genealogy. Thus, the efficiency of the algorithm is mainly limited by the number of states in the model.</p>
</sec></sec><sec id="s3">
<title>Results</title>
<sec id="s3a">
<title>Testing the algorithm</title>
<p>Before applying the PMMH algorithm to genealogies reconstructed from real data, we ran extensive simulations to ensure that we could accurately recover epidemiological parameters and population dynamics from mock genealogies. We simulated 100 stochastic realizations of an epidemic from the three-stage model, keeping track of the underlying infection tree so that we could obtain the true genealogy for a fraction of sampled lineages. From the simulated epidemic dynamics, we can see that demographic stochasticity generates considerable variation in when the epidemic begins and peaks (<xref ref-type="supplementary-material" rid="pcbi.1003570.s001">Figure S1</xref>). Even with this variability, we accurately inferred stage-specific prevalence and transmission rates from the mock genealogies using the PMMH algorithm (<xref ref-type="fig" rid="pcbi-1003570-g001">Figure 1</xref>). The 95% credible intervals generally contained the true prevalence for all three stages of infection (<xref ref-type="fig" rid="pcbi-1003570-g001">Figure 1A</xref>). We were also able to estimate the stage-specific transmission rates associated with each stage of infection (<xref ref-type="fig" rid="pcbi-1003570-g001">Figure 1B–D</xref>), even though there were strong correlations among the different transmission rates as seen in the pairwise joint posterior densities (<xref ref-type="fig" rid="pcbi-1003570-g001">Figure 1E–G</xref>). Overall, out of all 100 simulations, the 95% credible intervals contained all three transmission rates 94 times, while the posterior coverage was greater than 95% for each parameter individually. In contrast, when we fit deterministic models to the same set of genealogies, the credible intervals contained the true parameters only 79% of the time. The PMMH algorithm therefore appears to give reliable estimates of parameters and epidemiological dynamics and outperforms deterministic methods when stochasticity plays a role in the epidemic dynamics.</p>
<fig id="pcbi-1003570-g001" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003570.g001</object-id><label>Figure 1</label><caption>
<title>Prevalence and transmission rates estimated from a representative genealogy simulated under the three-stage SIR model.</title>
<p>(A) Stage-specific prevalence estimates with the 95% credible intervals shaded and the posterior medians shown as solid lines. Dashed lines show the true prevalence. (B–D) The marginal posterior densities of the stage-specific transmission rates. (E–G) The corresponding pairwise joint densities of the transmission rates, which were constructed from the MCMC samples using nonparametric kernel density estimation.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003570.g001" position="float" xlink:type="simple"/></fig></sec><sec id="s3b">
<title>HIV in Detroit</title>
<p>Given that we were able to reliably estimate transmission parameters and prevalence in our simulation study, we next applied the method to HIV genealogies reconstructed from sequences collected in Detroit, Michigan. A critical question in HIV epidemiology is to what extent transmission during the early stages of infection contributes to overall HIV incidence. Transmission during early infection may influence the effectiveness of interventions based on antiretroviral treatment in limiting the epidemic <xref ref-type="bibr" rid="pcbi.1003570-Cohen1">[36]</xref>, <xref ref-type="bibr" rid="pcbi.1003570-Kretzschmar1">[37]</xref>. If most new cases of HIV result from recently infected individuals, then prevention strategies that rely on treating diagnosed individuals, who are likely in later stages of infection, will directly prevent few transmissions. Thus, the transmission rate from early HIV infections (EHI) is a key parameter of great interest, although difficult to measure directly from traditional surveillance data. Phylogenetic studies of HIV have used the high degree of clustering and short branch times within these clusters to argue for a high EHI transmission rate <xref ref-type="bibr" rid="pcbi.1003570-Lewis1">[4]</xref>, <xref ref-type="bibr" rid="pcbi.1003570-Brown1">[38]</xref>. However, clustering alone cannot be taken as definitive evidence for high EHI transmission as similar patterns can arise simply from epidemic transmission dynamics <xref ref-type="bibr" rid="pcbi.1003570-Volz3">[26]</xref>. In this section, we demonstrate that our inference framework can be used to estimate the EHI transmission rate and the number of new HIV infections attributable to EHI from HIV genealogies using models that explicitly consider HIV's transmission dynamics, as well as the stochastic nature of the epidemic dynamics.</p>
<p>Time-scaled genealogies were reconstructed using BEAST from HIV-1 partial <italic>pol</italic> sequences isolated from men who have sex with men (MSM) in the metropolitan area of Detroit. A representative genealogy randomly sampled from the BEAST posterior is shown in <xref ref-type="supplementary-material" rid="pcbi.1003570.s002">Figure S2</xref>. We then fit our three-stage SIR model to 10 genealogies sampled from the BEAST posterior to take into account uncertainty in the genealogy. From these genealogies, we estimated the transmission rate for each stage, including the EHI transmission rate, along with the stage-specific dynamics of prevalence and the incidence (i.e number of new cases) attributable to each stage over the course of the epidemic.</p>
<p>Parameters estimated from the representative HIV genealogy are shown in <xref ref-type="fig" rid="pcbi-1003570-g002">Figure 2</xref> and estimates from all 10 genealogies are given in <xref ref-type="table" rid="pcbi-1003570-t002">Table 2</xref>. We estimated that transmission rates are higher during the early and AIDS stages than during the chronic stage, as expected from previous studies <xref ref-type="bibr" rid="pcbi.1003570-Pilcher1">[39]</xref>–<xref ref-type="bibr" rid="pcbi.1003570-Powers1">[41]</xref>. The transmission rate from EHI is about 20 times higher than during the chronic stage and about five times higher than during the AIDS stage (<xref ref-type="fig" rid="pcbi-1003570-g002">Figure 2A–C</xref>). We also found evidence for a nonlinear dependence of incidence on prevalence, quantified through the incidence scaling parameter <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e243" xlink:type="simple"/></inline-formula>. Although estimated values of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e244" xlink:type="simple"/></inline-formula> are small, the posterior density is clearly centered away from zero, indicating that incidence scales nonlinearly with prevalence (<xref ref-type="fig" rid="pcbi-1003570-g002">Figure 2D</xref>). Overall, parameter estimates were largely consistent across genealogies, although there was considerable variation in the time of initial introduction of HIV into Detroit estimated from different trees. This is likely attributable to the large amount of variation in the root times inferred for different trees, as we inferred earlier times of introduction from trees with earlier root times.</p>
<fig id="pcbi-1003570-g002" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003570.g002</object-id><label>Figure 2</label><caption>
<title>Posterior densities of parameters inferred from one HIV genealogy.</title>
<p>Solid red lines mark the median values and dashed lines indicate the 95% credible intervals. The estimated parameters are the early stage transmission rate <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e245" xlink:type="simple"/></inline-formula>, the chronic stage transmission rate <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e246" xlink:type="simple"/></inline-formula>, the AIDS stage transmission rate <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e247" xlink:type="simple"/></inline-formula>, the incidence scaler <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e248" xlink:type="simple"/></inline-formula> and the initial introduction time of HIV into Detroit.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003570.g002" position="float" xlink:type="simple"/></fig><table-wrap id="pcbi-1003570-t002" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003570.t002</object-id><label>Table 2</label><caption>
<title>HIV parameter estimates.</title>
</caption><alternatives><graphic id="pcbi-1003570-t002-2" position="float" mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003570.t002" xlink:type="simple"/>
<table><colgroup span="1"><col align="left" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/></colgroup>
<thead>
<tr>
<td align="left" rowspan="1" colspan="1">Tree</td>
<td align="left" rowspan="1" colspan="1"><italic>β<sub>E</sub></italic></td>
<td align="left" rowspan="1" colspan="1"><italic>β<sub>C</sub></italic></td>
<td align="left" rowspan="1" colspan="1"><italic>β<sub>A</sub></italic></td>
<td align="left" rowspan="1" colspan="1"><italic>α</italic>×10<sup>−4</sup></td>
<td align="left" rowspan="1" colspan="1">Initial Time</td>
</tr>
</thead>
<tbody>
<tr>
<td align="left" rowspan="1" colspan="1">1</td>
<td align="left" rowspan="1" colspan="1">1.59 (1.43–1.77)</td>
<td align="left" rowspan="1" colspan="1">0.077 (0.006–0.187)</td>
<td align="left" rowspan="1" colspan="1">0.328 (0.146–0.653)</td>
<td align="left" rowspan="1" colspan="1">1.52 (0.51–4.35)</td>
<td align="left" rowspan="1" colspan="1">1975 (1973–1977)</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">2</td>
<td align="left" rowspan="1" colspan="1">1.69 (1.51–1.9)</td>
<td align="left" rowspan="1" colspan="1">0.079 (0.007–0.184)</td>
<td align="left" rowspan="1" colspan="1">0.318 (0.126–0.59)</td>
<td align="left" rowspan="1" colspan="1">1.72 (0.62–4.02)</td>
<td align="left" rowspan="1" colspan="1">1976 (1973–1979)</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">3</td>
<td align="left" rowspan="1" colspan="1">1.69 (1.39–1.99)</td>
<td align="left" rowspan="1" colspan="1">0.184 (0.02–0.539)</td>
<td align="left" rowspan="1" colspan="1">0.593 (0.151–1.26)</td>
<td align="left" rowspan="1" colspan="1">5.78 (1.43–11.8)</td>
<td align="left" rowspan="1" colspan="1">1976 (1973–1978)</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">4</td>
<td align="left" rowspan="1" colspan="1">1.51 (1.32–1.73)</td>
<td align="left" rowspan="1" colspan="1">0.079 (0.007–0.191)</td>
<td align="left" rowspan="1" colspan="1">0.316 (0.114–0.648)</td>
<td align="left" rowspan="1" colspan="1">1.55 (0.48–4.44)</td>
<td align="left" rowspan="1" colspan="1">1974 (1973–1976)</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">5</td>
<td align="left" rowspan="1" colspan="1">1.6 (1.29–1.92)</td>
<td align="left" rowspan="1" colspan="1">0.146 (0.016–0.395)</td>
<td align="left" rowspan="1" colspan="1">0.786 (0.235–1.64)</td>
<td align="left" rowspan="1" colspan="1">5.99 (1.91–11.1)</td>
<td align="left" rowspan="1" colspan="1">1973 (1973–1974)</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">6</td>
<td align="left" rowspan="1" colspan="1">1.69 (1.43–1.99)</td>
<td align="left" rowspan="1" colspan="1">0.114 (0.008–0.28)</td>
<td align="left" rowspan="1" colspan="1">0.543 (0.193–1.0)</td>
<td align="left" rowspan="1" colspan="1">3.75 (1.23–8.0)</td>
<td align="left" rowspan="1" colspan="1">1974 (1973–1975)</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">7</td>
<td align="left" rowspan="1" colspan="1">1.67 (1.45–1.91)</td>
<td align="left" rowspan="1" colspan="1">0.1 (0.012–0.224)</td>
<td align="left" rowspan="1" colspan="1">0.431 (0.155–0.823)</td>
<td align="left" rowspan="1" colspan="1">2.93 (1.21–5.57)</td>
<td align="left" rowspan="1" colspan="1">1974 (1973–1977)</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">8</td>
<td align="left" rowspan="1" colspan="1">1.87 (1.62–2.14)</td>
<td align="left" rowspan="1" colspan="1">0.095 (0.006–0.239)</td>
<td align="left" rowspan="1" colspan="1">0.521 (0.214–0.964)</td>
<td align="left" rowspan="1" colspan="1">4.06 (1.22–8.3)</td>
<td align="left" rowspan="1" colspan="1">1979 (1974–1981)</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">9</td>
<td align="left" rowspan="1" colspan="1">1.9 (1.51–2.31)</td>
<td align="left" rowspan="1" colspan="1">0.295 (0.025–0.636)</td>
<td align="left" rowspan="1" colspan="1">0.823 (0.247–1.74)</td>
<td align="left" rowspan="1" colspan="1">10.2 (2.76–17.5)</td>
<td align="left" rowspan="1" colspan="1">1980 (1974–1982)</td>
</tr>
<tr>
<td align="left" rowspan="1" colspan="1">10</td>
<td align="left" rowspan="1" colspan="1">1.52 (1.32–1.73)</td>
<td align="left" rowspan="1" colspan="1">0.08 (0.009–0.248)</td>
<td align="left" rowspan="1" colspan="1">0.433 (0.184–1.29)</td>
<td align="left" rowspan="1" colspan="1">2.5 (0.73–10.5)</td>
<td align="left" rowspan="1" colspan="1">1974 (1973–1976)</td>
</tr>
</tbody>
</table>
</alternatives><table-wrap-foot><fn id="nt101"><label/><p>Median posterior and 95% credible intervals for parameters estimated from 10 HIV genealogies.</p></fn></table-wrap-foot></table-wrap>
<p>Stage-specific HIV prevalence inferred from the genealogies shows a predictable transition from most infections being in the early stage at the beginning of the epidemic to most infections being in the chronic or AIDS stages later in the epidemic (<xref ref-type="fig" rid="pcbi-1003570-g003">Figure 3A</xref>). This is expected given the longer duration of the chronic and AIDS stages. In general, our phylodynamic estimates of the epidemic dynamics closely track HIV incidence imputed from surveillance data from the beginning of the epidemic through the peak (<xref ref-type="fig" rid="pcbi-1003570-g003">Figure 3B</xref>). While our phylodynamic estimates do not capture the fluctuations in incidence that occur after 1990, there was nothing in our model that would allow us to reproduce this pattern, which likely results from complex changes in HIV treatment and behavioral changes <xref ref-type="bibr" rid="pcbi.1003570-Volz4">[34]</xref>. Although there was also considerable variability in the population dynamics inferred from different genealogies, this variation occurs primarily during the early stages of the epidemic (<xref ref-type="fig" rid="pcbi-1003570-g003">Figure 3C</xref>). Again, this appears to be associated with uncertainty in the root times of trees; dynamics inferred from trees with earlier root times show an earlier rise and peak in incidence. After the epidemic peaks, the incidence estimated from different trees seems to converge on similar values.</p>
<fig id="pcbi-1003570-g003" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003570.g003</object-id><label>Figure 3</label><caption>
<title>Population dynamics inferred from the Detroit HIV genealogies.</title>
<p>(A) Stage-specific prevalence estimates from one genealogy with shaded regions showing the 95% credible intervals and lines the median of the posterior densities. (B) Estimated total yearly incidence and the estimated incidence attributable to early stage infections. The dashed black line shows the incidence back-calculated from Michigan Department of Community Health surveillance data. (C) Total incidence estimated from 10 randomly sampled HIV genealogies.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003570.g003" position="float" xlink:type="simple"/></fig>
<p>Estimates of incidence attributable to each stage show that EHI contributed to most new infections at the beginning of epidemic when EHI prevalence was high (<xref ref-type="fig" rid="pcbi-1003570-g003">Figure 3B</xref>). After the epidemic peak, infections arising from EHI remains high proportional to EHI prevalence, consistent with the higher transmission rate we estimated for EHI. In the late 2000's, we estimated that between 40 to 50% of all new infections arise from EHI, indicating that early stage infections still play a major role in driving HIV transmission. These large estimates for number of new infections arising from EHI are consistent with the phylodynamic estimates of Volz <italic>et al.</italic> <xref ref-type="bibr" rid="pcbi.1003570-Volz4">[34]</xref>, who fit a more complex but deterministic epidemiological model to the same set of HIV sequences.</p>
</sec><sec id="s3c">
<title>Inferring population structure</title>
<p>While our results for the three-stage model suggest that the PMMH algorithm works effectively and can be used to estimate key epidemiological parameters like HIV transmission rates, we were also interested in how much information genealogies contain about the structure of populations in general. To explore this question, we used the two-population model presented in (3), for which we can tune the strength of population structure by altering the mixing rate <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e249" xlink:type="simple"/></inline-formula> between populations. Mock genealogies were simulated under three values of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e250" xlink:type="simple"/></inline-formula>: low (0.01), medium (0.05) and high (0.2). At <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e251" xlink:type="simple"/></inline-formula>, for example, about one in every one hundred transmission events occurs between populations. For all three values of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e252" xlink:type="simple"/></inline-formula>, we were able to accurately infer the epidemiological parameters of interest and the population dynamics from the simulated genealogies (<xref ref-type="fig" rid="pcbi-1003570-g004">Figure 4</xref> &amp; <xref ref-type="supplementary-material" rid="pcbi.1003570.s003">Figure S3</xref>). While we can easily estimate <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e253" xlink:type="simple"/></inline-formula> under all three demographic scenarios, the posterior densities become skewed towards increasingly high values of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e254" xlink:type="simple"/></inline-formula> as mixing increases between the populations (<xref ref-type="fig" rid="pcbi-1003570-g004">Figure 4A–C</xref>). This indicates that it may be very difficult to obtain precise estimates of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e255" xlink:type="simple"/></inline-formula> or other parameters pertaining to population structure when populations are only weakly structured.</p>
<fig id="pcbi-1003570-g004" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003570.g004</object-id><label>Figure 4</label><caption>
<title>Parameter and prevalence estimates for the two-population model.</title>
<p>Mixing rates between the two populations were varied from low (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e256" xlink:type="simple"/></inline-formula>), medium (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e257" xlink:type="simple"/></inline-formula>) to high (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e258" xlink:type="simple"/></inline-formula>). (A–C) Joint posterior densities for the transmission rate <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e259" xlink:type="simple"/></inline-formula> and the mixing parameter <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e260" xlink:type="simple"/></inline-formula>. (D–F) Prevalence estimates for the two populations with the 95% credible intervals shaded and the posterior medians shown as solid lines. Dashed lines show the true prevalence. Initial conditions for the number of susceptible and infected individuals in each population were fixed at their true values for these simulations.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003570.g004" position="float" xlink:type="simple"/></fig>
<p>We can visually explore how much information a genealogy contains about population structure and pathogen movement by comparing the true lineage states to the computed lineage state probabilities. In <xref ref-type="fig" rid="pcbi-1003570-g005">Figure 5A–C</xref>, the true state of each lineage over time is mapped onto the genealogies. For ease of viewing, we only display a representative subtree of each genealogy. As expected, under low mixing lineages change states very slowly leading to a high degree of clustering among lineages sampled from the same population, whereas under high mixing lineages move rapidly between states and there is little clustering. We can then compare the true lineage states with the state probabilities computed under the median posterior values of the estimated parameters (<xref ref-type="fig" rid="pcbi-1003570-g005">Figure 5D–F</xref>). When <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e261" xlink:type="simple"/></inline-formula> is low, the state of the lineages at the time of sampling is highly informative about the state of the lineage going into the past. However, when we increase <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e262" xlink:type="simple"/></inline-formula> to 0.05, the state of the sampled lineages is less informative about the past states and we can see that the lineage state probabilities fluctuate seasonally according to the asynchronous dynamics between populations. When <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e263" xlink:type="simple"/></inline-formula> is high, the lineages move between states so rapidly that there is high uncertainty in the lineage states over the entire tree. This loss of information regarding the lineage states is readily observed by considering how the entropy, or uncertainty, in the lineage states changes going backwards in time (<xref ref-type="fig" rid="pcbi-1003570-g005">Figure 5G–H</xref>).</p>
<fig id="pcbi-1003570-g005" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003570.g005</object-id><label>Figure 5</label><caption>
<title>Genealogies simulated under different mixing rates.</title>
<p>Mixing rates between the red and blue population were varied from low (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e264" xlink:type="simple"/></inline-formula>), medium (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e265" xlink:type="simple"/></inline-formula>) to high (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e266" xlink:type="simple"/></inline-formula>). (A–C) The true lineage states mapped onto the genealogy. (D–F) Lineage state probabilities given with respect to the probability that the lineage is in the red state. (G–I) Entropy in the lineage states, which shows how much uncertainty there is in the lineage states. For each lineage <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e267" xlink:type="simple"/></inline-formula>, the entropy <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e268" xlink:type="simple"/></inline-formula>.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003570.g005" position="float" xlink:type="simple"/></fig>
<p>Visualizing the flow of information along the lineages in the trees shows how uncertainty in parameters like <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e269" xlink:type="simple"/></inline-formula> depends on how rapidly information about the lineage states decays. When <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e270" xlink:type="simple"/></inline-formula> is low, lineages remain in the same state long enough that once a coalescent event is reached, information about the probable state of the lineages is still present. In this case, the probable states of the coalescing lineages provides additional information about the transmission event with respect to whether the transmission event occurred within or between populations. By combining information from coalescent events across the entire tree, we can then estimate the rates at which transmission occurs within and between populations. However, if all information about the past lineage states is lost before lineages coalesce, the observed coalescent events will no longer be informative about whether transmission occurred within or between populations and therefore parameters like <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e271" xlink:type="simple"/></inline-formula> will be difficult to precisely estimate.</p>
<p>The preceding observations about uncertainty in lineage states suggest that it may be possible to estimate <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e272" xlink:type="simple"/></inline-formula> more precisely if we increase the number of sampled lineages. Increasing the sampling fraction will also increase the coalescent rate among lineages, thereby increasing the probability of lineages coalescing before all information about their probable state is lost. To test this idea, we simulated genealogies under the same three values of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e273" xlink:type="simple"/></inline-formula> but varied the sample size. With a sample size of 100, the same as used above, we see that the likelihood is peaked around the true value of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e274" xlink:type="simple"/></inline-formula> when mixing is low but the likelihood profile is fairly flat when mixing is high (<xref ref-type="fig" rid="pcbi-1003570-g006">Figure 6A–C</xref>). Increasing the sample size to 500 resulted in more curved likelihood profiles but the likelihood remains relatively flat with high mixing (<xref ref-type="fig" rid="pcbi-1003570-g006">Figure 6D–F</xref>). Doubling the sample size again to 1,000, the likelihood profiles show significant curvature for all values of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e275" xlink:type="simple"/></inline-formula> (<xref ref-type="fig" rid="pcbi-1003570-g006">Figure 6G–I</xref>). This suggests that while the sample size does play a significant role in determining whether parameters like <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e276" xlink:type="simple"/></inline-formula> can be precisely estimated from genealogies, extremely large sample sizes may be required to estimate parameters pertaining to population structure when the population is only weakly structured.</p>
<fig id="pcbi-1003570-g006" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003570.g006</object-id><label>Figure 6</label><caption>
<title>Likelihood profiles for the strength of coupling <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e277" xlink:type="simple"/></inline-formula> obtained from genealogies simulated under different values of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e278" xlink:type="simple"/></inline-formula>.</title>
<p>Red lines correspond to the true value of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e279" xlink:type="simple"/></inline-formula>. The likelihoods were computed from genealogies with 100 samples in (A–C), 500 samples in (D–F) and 1000 samples in (G–I). These sample sizes correspond, respectively, to approximately 0.2%, 1.0% and 2% of all infected individuals being sampled.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003570.g006" position="float" xlink:type="simple"/></fig></sec></sec><sec id="s4">
<title>Discussion</title>
<p>The approach outlined in this paper allows for structured, stochastic epidemiological and other population dynamic models to be fit to genealogies in order to jointly infer past population dynamics and model parameters. We believe this to be an important step forward in the field of phylodynamics because many populations are structured in ways that could bias estimates of demographic parameters when using coalescent-based methods if population structure is not properly taken into account. Furthermore, unlike earlier methods for fitting structured coalescent models to genealogies (e.g. <xref ref-type="bibr" rid="pcbi.1003570-Beerli1">[7]</xref>, <xref ref-type="bibr" rid="pcbi.1003570-Kuhner2">[15]</xref>), our framework can accommodate non-equilibrium and nonlinear population dynamics and allows birth and migration rates to vary over time. We can also include stochasticity in our models when fitting them to data obtained from real populations, which may behave very differently than what would be expected under deterministic models. We can therefore fit the type of mechanistic population dynamic models typically used by epidemiologists and ecologists, which often include population structure, to genealogies.</p>
<p>As we have shown, fitting stochastic population dynamic models to genealogies through a structured coalescent model poses some challenges to statistical inference not normally dealt with in the statistical literature on fitting generic state space models to observational data. Under our structured coalescent models, the probability of a genealogy depends conditionally on both the population state variables as well as the states of individual lineages over time. However, going backwards in time, the probability that a lineage is in a certain state can strongly depend on the state that the lineage was sampled in at some future point in time. Particle filtering methods, which are widely used to fit state space models to other sources of data, can perform very poorly under these circumstances because the state of the system, in this case the lineage states, can depend strongly on the future states of the system. One strategy we initially tried was therefore to use a Gibbs sampling approach to iteratively sample from the conditional posterior densities of the population state and lineage state variables in independent steps to avoid the problem of having both forward and backward time dependencies in the model. Unfortunately, we found that such a Gibbs sampling strategy can be very inefficient and suffer from extremely poor MCMC mixing when there are strong correlations among the parameters and the lineage states. For example, in our two-population model, the mixing parameter <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e280" xlink:type="simple"/></inline-formula> controls how rapidly lineages move between states and is thus highly correlated with the lineage states. If we update <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e281" xlink:type="simple"/></inline-formula> conditional on our current lineage states, the proposed value of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e282" xlink:type="simple"/></inline-formula> will need to be very close to the current value in order for the proposal to have high enough probability to be accepted conditional on the current lineage states. We therefore explore a potentially very large parameter space taking only small steps at a time.</p>
<p>Given these issues, we decided to use a modified version of the PMMH algorithm originally proposed by Andrieu <italic>et al.</italic> <xref ref-type="bibr" rid="pcbi.1003570-Andrieu1">[22]</xref>. In this approach, we simply propose new parameter values each MCMC iteration and then run the particle filter to numerically integrate over the population state variables. To make the particle filtering algorithm as efficient as possible within each MCMC step, we allow for resampling by first weighting the particles according to the expected lineage state probabilities. Once we have run the particle filter forwards in time, we can then compute the true lineage state probabilities backwards in time and apply an additional round of importance sampling to correct for any bias introduced by using the expected lineage state probabilities. With the true lineage state probabilities of each particle, we can compute the coalescent likelihood of the genealogy while summing over all possible lineage states. We can therefore integrate over both the unobserved population state variables and the lineage state variables when computing the marginal likelihood of the parameter proposal. We thus have an efficient MCMC algorithm for sampling from the posterior density of the parameters without having to design independent proposals for the population states or the lineage states. The PMMH sampler therefore has a major practical advantage over other MCMC approaches that can be easily quantified. For the models considered in this paper, the PMMH algorithm typically converged in less than 100,000 iterations whereas for the Gibbs sampler we could run millions of MCMC iterations and still not converge. The efficiency of this approach will hopefully make it possible to also consider phylogenetic uncertainty in the future by sampling genealogies in addition to epidemiological parameters in the MCMC algorithm.</p>
<p>Whether or not the type of coalescent models considered here are appropriate for a particular pathogen is another important issue. The coalescent models assume that each infected host corresponds to a single pathogen lineage. If this were indeed always the case then coalescent events in the genealogy would always correspond to transmission events in the population. In reality, coalescent events will not occur instantaneously at transmission events but at some time before the actual transmission event because there will be a waiting time between when a lineage is transmitted and when it coalesces with another sampled lineage in the host. How closely the actual transmission event corresponds in time with the coalescent event will likely depend on the within-host dynamics of the pathogen <xref ref-type="bibr" rid="pcbi.1003570-Ypma1">[42]</xref>. For chronic viral infections like HIV where multiple lineages can persist within a given host for months or years, this may result in a large discrepancy in the timing of transmission and coalescent events. Nevertheless, a simulation study using a realistic distribution of within-host coalescent times for HIV found that the difference in timing between coalescent and transmission events was not sufficient to bias estimates of epidemiological parameters <xref ref-type="bibr" rid="pcbi.1003570-Volz4">[34]</xref>. This may be due to the fact that a large fraction of HIV transmissions are due to recently infected individuals, in which case the within-host coalescent event cannot have occurred very long before the actual transmission event. A more principled approach to pursue in the future may be to impute the actual times of transmission conditional on the time of the coalescent events using information about within-host population dynamics. For example, additional information about pathogen population sizes over the course of a typical infection could provide an informative prior on waiting times between transmission events and coalescent events within hosts.</p>
<p>Another possible violation of the coalescent model occurs if sampled individuals have descendants that are themselves sampled, which can occur when samples are collected serially over time. The coalescent model implicitly assumes that when a new lineage is sampled, that lineage is sampled from a different host than any other lineage already in the genealogy. However, if a lineage is sampled from a host that has other sampled descendant lineages in the genealogy, then this results in a coalescent event in the tree that does not correspond to a transmission event in the population. A similar problem would arise if we unwittingly sampled more than one lineage from a single infected host. However this is likely to occur only if sampling is dense relative to prevalence over time. For example, if sampling is dense at the beginning and the end of an epidemic, then with a high probability hosts sampled at the beginning of the epidemic will likely have sampled descendants at the end of the epidemic. We acknowledge that the coalescent models used in this paper cannot adequately handle these types of situations, although for the HIV analysis it is unlikely that this is a serious problem seeing as all sequences were sampled in the recent past when prevalence was high. In cases where this is likely to be a serious problem, it may be worth developing metapopulation coalescent models, such as those introduced by Dearlove and Wilson <xref ref-type="bibr" rid="pcbi.1003570-Dearlove1">[43]</xref>, that allow hosts to be infected by more than a single lineage.</p>
<p>As our application to HIV showed, the PMMH algorithm allowed us to infer key epidemiological parameters like stage-specific transmission rates directly from genealogies. However, in the case of HIV, individuals stay in the same stage of infection for long periods of time relative to the timescale of the epidemic. The stage of infection of sampled individuals is therefore highly informative about the state of the lineage going into the past. Our experience with HIV may therefore not be representative of our general ability to infer parameters pertaining to pathogen transmission or movement in structured populations. In fact, our simple two-population SIR model revealed certain conditions under which it may be inherently difficult to estimate parameters relating to population structure. When lineages move between states rapidly due to transmission or migration any particular lineage is likely to have changed states multiple times before a coalescent event is reached, leading to high uncertainty about the state of lineage over the majority of the genealogy. This is somewhat analogous to the problem of site saturation in phylogenetic inference, where multiple transitions at a particular site along branches can render that site phylogenetically uninformative <xref ref-type="bibr" rid="pcbi.1003570-Yang1">[44]</xref>. In the case of rapid transition rates among population states, observing the state of lineages at the time of sampling offers little or no information about the structure of the population because all information about the state of the lineage is quickly lost. Under these circumstances, it will be difficult to precisely estimate migration rates or other parameters relating to population structure from genealogies as we saw from the likelihood profiles of the mixing parameter in the two-population model, although it may be possible with many samples or a large sample fraction. This echoes earlier work on inference with structured coalescent models, where researchers have found it difficult to estimate migration rates from genealogies even without the complication of complex population dynamics <xref ref-type="bibr" rid="pcbi.1003570-Beerli1">[7]</xref>, <xref ref-type="bibr" rid="pcbi.1003570-Beerli2">[45]</xref>.</p>
<p>Although it may not always be possible to precisely estimate parameters relating to population structure from genealogies, we can imagine several cases in which the ability to fit mechanistic epidemiological models to genealogies that include population structure may be extremely useful. For example, our methods could be used to fit spatially structured models to genealogies of samples collected in different locations and could potentially complement recently developed phylogeographic methods that consider spatial structure but do not generally take into account local population dynamics at any particular location <xref ref-type="bibr" rid="pcbi.1003570-Lemey1">[46]</xref>, <xref ref-type="bibr" rid="pcbi.1003570-Pybus2">[47]</xref>. For instance, incorporating both spatial and temporal dynamics could be important when the structure of a population is not static but changes over time due to changes in migration rates, which themselves may vary due to non-stationary population dynamics across locations. Our approach can also be applied in cases where sampling effort is distributed unevenly among populations so that the assumption of random sampling in unstructured coalescent models has obviously been violated. In this case, structured coalescent models can be used to control for non-random sampling as long as sampling is random within the subpopulations defined in the coalescent model. Finally, our methods can be applied to multi-host or vectored pathogens where lineages can move among different host or vector species. As shown in Rasmussen <italic>et al.</italic> <xref ref-type="bibr" rid="pcbi.1003570-Rasmussen2">[48]</xref> for the case of dengue, including the dynamics of both the host and vector populations in coalescent models may be necessary in order for population dynamics inferred from genealogies of vector-borne pathogens to be accurate.</p>
<p>We end by noting that the methods presented here can be used to fit epidemiological models to genealogies as well as other sources of data simultaneously. For example, we previously showed how unstructured epidemiological models can be fit to a genealogy and a time series of case reports simultaneously and it would be straightforward to extend the methods presented here to include time series or other observational data <xref ref-type="bibr" rid="pcbi.1003570-Rasmussen1">[21]</xref>. This could be especially helpful when certain parameters or aspects of the dynamics are difficult to infer from one data source but for which an alternative data source could be highly informative. For example, case report data may be aggregated over different subpopulations obscuring some of the heterogeneity present in the population but could be revealed by also considering information present in a genealogy. Consolidating data sources in this way will likely play an important role in epidemiological modeling in the future, especially as molecular sequence data become increasingly available and phylodynamic methods become integrated into modern epidemiology.</p>
</sec><sec id="s5">
<title>Supporting Information</title>
<supplementary-material id="pcbi.1003570.s001" mimetype="image/tiff" xlink:href="info:doi/10.1371/journal.pcbi.1003570.s001" position="float" xlink:type="simple"><label>Figure S1</label><caption>
<p><bold>Simulated epidemic dynamics for 100 stochastic realizations of the three-stage SIR model.</bold> Total prevalence includes all three stages of infection.</p>
<p>(TIF)</p>
</caption></supplementary-material><supplementary-material id="pcbi.1003570.s002" mimetype="image/tiff" xlink:href="info:doi/10.1371/journal.pcbi.1003570.s002" position="float" xlink:type="simple"><label>Figure S2</label><caption>
<p><bold>Representative time-scaled HIV genealogy from Detroit, Michigan.</bold></p>
<p>(TIF)</p>
</caption></supplementary-material><supplementary-material id="pcbi.1003570.s003" mimetype="image/tiff" xlink:href="info:doi/10.1371/journal.pcbi.1003570.s003" position="float" xlink:type="simple"><label>Figure S3</label><caption>
<p><bold>Marginal posterior densities of the parameters in the two-population model with low mixing (</bold><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e283" xlink:type="simple"/></inline-formula><bold>) between populations.</bold> Blue lines show the true values. The estimated parameters are: (A) the transmission rate <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e284" xlink:type="simple"/></inline-formula>; (B) the mixing rate <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e285" xlink:type="simple"/></inline-formula>; (C) the amplitude of seasonal forcing <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e286" xlink:type="simple"/></inline-formula>; (D–E) the seasonal phases for the two populations <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e287" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003570.e288" xlink:type="simple"/></inline-formula>. Similar estimates of the seasonality parameters were obtained with medium and high mixing between populations.</p>
<p>(TIF)</p>
</caption></supplementary-material><supplementary-material id="pcbi.1003570.s004" mimetype="application/pdf" xlink:href="info:doi/10.1371/journal.pcbi.1003570.s004" position="float" xlink:type="simple"><label>Text S1</label><caption>
<p><bold>Summary of the particle filtering algorithm for genealogies and details on how lineage state probabilities are computed.</bold></p>
<p>(PDF)</p>
</caption></supplementary-material></sec></body>
<back><ref-list>
<title>References</title>
<ref id="pcbi.1003570-Nee1"><label>1</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Nee</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Holmes</surname><given-names>EC</given-names></name>, <name name-style="western"><surname>Rambaut</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Harvey</surname><given-names>PH</given-names></name> (<year>1995</year>) <article-title>Inferring population history from molecular phylogenies</article-title>. <source>Philos Trans R Soc Lond B Biol Sci</source> <volume>349</volume>: <fpage>25</fpage>–<lpage>31</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Grenfell1"><label>2</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Grenfell</surname><given-names>BT</given-names></name>, <name name-style="western"><surname>Pybus</surname><given-names>OG</given-names></name>, <name name-style="western"><surname>Gog</surname><given-names>JR</given-names></name>, <name name-style="western"><surname>Wood</surname><given-names>JLN</given-names></name>, <name name-style="western"><surname>Daly</surname><given-names>JM</given-names></name>, <etal>et al</etal>. (<year>2004</year>) <article-title>Unifying the epidemiological and evolutionary dynamics of pathogens</article-title>. <source>Science</source> <volume>303</volume>: <fpage>327</fpage>–<lpage>32</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Donnelly1"><label>3</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Donnelly</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Tavaré</surname><given-names>S</given-names></name> (<year>1995</year>) <article-title>Coalescents and genealogical structure under neutrality</article-title>. <source>Annu Rev Genet</source> <volume>29</volume>: <fpage>401</fpage>–<lpage>21</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Lewis1"><label>4</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Lewis</surname><given-names>F</given-names></name>, <name name-style="western"><surname>Hughes</surname><given-names>GJ</given-names></name>, <name name-style="western"><surname>Rambaut</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Pozniak</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Leigh Brown</surname><given-names>AJ</given-names></name> (<year>2008</year>) <article-title>Episodic sexual transmission of HIV revealed by molecular phylodynamics</article-title>. <source>PLoS Medicine</source> <volume>5</volume> <fpage>e50</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Kuhner1"><label>5</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Kuhner</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Yamato</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Felsenstein</surname><given-names>J</given-names></name> (<year>1998</year>) <article-title>Maximum likelihood estimation of population growth rates based on the coalescent</article-title>. <source>Genetics</source> <volume>149</volume>: <fpage>429</fpage>–<lpage>34</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Pybus1"><label>6</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Pybus</surname><given-names>O</given-names></name>, <name name-style="western"><surname>Rambaut</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Harvey</surname><given-names>P</given-names></name> (<year>2000</year>) <article-title>An integrated framework for the inference of viral population history from reconstructed genealogies</article-title>. <source>Genetics</source> <volume>155</volume>: <fpage>1429</fpage>–<lpage>37</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Beerli1"><label>7</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Beerli</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Felsenstein</surname><given-names>J</given-names></name> (<year>2001</year>) <article-title>Maximum likelihood estimation of a migration matrix and effective population sizes in n subpopulations by using a coalescent approach</article-title>. <source>Proc Natl Acad Sci USA</source> <volume>98</volume>: <fpage>4563</fpage>–<lpage>8</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Stadler1"><label>8</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Stadler</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Kouyos</surname><given-names>R</given-names></name>, <name name-style="western"><surname>von Wyl</surname><given-names>V</given-names></name>, <name name-style="western"><surname>Yerly</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Böni</surname><given-names>J</given-names></name>, <etal>et al</etal>. (<year>2012</year>) <article-title>Estimating the basic reproductive number from viral sequence data</article-title>. <source>Mol Biol Evol</source> <volume>29</volume>: <fpage>347</fpage>–<lpage>357</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Kingman1"><label>9</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Kingman</surname><given-names>J</given-names></name> (<year>1982</year>) <article-title>On the genealogy of large populations</article-title>. <source>Journal of Applied Probability</source> <volume>19</volume>: <fpage>27</fpage>–<lpage>43</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Wakeley1"><label>10</label>
<mixed-citation publication-type="book" xlink:type="simple">Wakeley J (2009) Coalescent Theory: An Introduction. Greenwood Village, Colo.: Roberts and Company Publishers.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Strimmer1"><label>11</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Strimmer</surname><given-names>K</given-names></name>, <name name-style="western"><surname>Pybus</surname><given-names>OG</given-names></name> (<year>2001</year>) <article-title>Exploring the demographic history of dna sequences using the generalized skyline plot</article-title>. <source>Mol Biol Evol</source> <volume>18</volume>: <fpage>2298</fpage>–<lpage>305</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Drummond1"><label>12</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Drummond</surname><given-names>AJ</given-names></name>, <name name-style="western"><surname>Rambaut</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Shapiro</surname><given-names>B</given-names></name>, <name name-style="western"><surname>Pybus</surname><given-names>OG</given-names></name> (<year>2005</year>) <article-title>Bayesian coalescent inference of past population dynamics from molecular sequences</article-title>. <source>Mol Biol Evol</source> <volume>22</volume>: <fpage>1185</fpage>–<lpage>92</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Notohara1"><label>13</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Notohara</surname><given-names>M</given-names></name> (<year>1990</year>) <article-title>The coalescent and the genealogical process in geographically structured population</article-title>. <source>J Math Biol</source> <volume>29</volume>: <fpage>59</fpage>–<lpage>75</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Takahata1"><label>14</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Takahata</surname><given-names>N</given-names></name>, <name name-style="western"><surname>Slatkin</surname><given-names>M</given-names></name> (<year>1990</year>) <article-title>Genealogy of neutral genes in two partially isolated populations</article-title>. <source>Theor Popul Biol</source> <volume>38</volume>: <fpage>331</fpage>–<lpage>50</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Kuhner2"><label>15</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Kuhner</surname><given-names>M</given-names></name> (<year>2006</year>) <article-title>LAMARC 2.0: Maximum likelihood and Bayesian estimation of population parameters</article-title>. <source>Bioinformatics</source> <volume>22</volume>: <fpage>768</fpage>–<lpage>70</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Volz1"><label>16</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Volz</surname><given-names>EM</given-names></name>, <name name-style="western"><surname>Kosakovsky Pond</surname><given-names>SL</given-names></name>, <name name-style="western"><surname>Ward</surname><given-names>MJ</given-names></name>, <name name-style="western"><surname>Leigh Brown</surname><given-names>AJ</given-names></name>, <name name-style="western"><surname>Frost</surname><given-names>SDW</given-names></name> (<year>2009</year>) <article-title>Phylodynamics of infectious disease epidemics</article-title>. <source>Genetics</source> <volume>183</volume>: <fpage>1421</fpage>–<lpage>30</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Frost1"><label>17</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Frost</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Volz</surname><given-names>E</given-names></name> (<year>2010</year>) <article-title>Viral phylodynamics and the search for an ‘effective number of infections’</article-title>. <source>Philos Trans R Soc Lond B Biol Sci</source> <volume>365</volume>: <fpage>1879</fpage>–<lpage>90</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Anderson1"><label>18</label>
<mixed-citation publication-type="book" xlink:type="simple">Anderson RM, May RM (1991) Infectious Diseases of Humans: Dynamics and Control. Oxford, U.K.: Oxford University Press.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Koelle1"><label>19</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Koelle</surname><given-names>K</given-names></name>, <name name-style="western"><surname>Rasmussen</surname><given-names>D</given-names></name> (<year>2012</year>) <article-title>Rates of coalescence for common epidemiological models at equilibrium</article-title>. <source>J R Soc Interface</source> <volume>9</volume>: <fpage>997</fpage>–<lpage>1007</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Volz2"><label>20</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Volz</surname><given-names>E</given-names></name> (<year>2012</year>) <article-title>Complex population dynamics and the coalescent under neutrality</article-title>. <source>Genetics</source> <volume>190</volume>: <fpage>187</fpage>–<lpage>201</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Rasmussen1"><label>21</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Rasmussen</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Ratmann</surname><given-names>O</given-names></name>, <name name-style="western"><surname>Koelle</surname><given-names>K</given-names></name> (<year>2011</year>) <article-title>Inference for nonlinear epidemiological models using genealogies and time series</article-title>. <source>PLoS Comput Biol</source> <volume>7</volume>: <fpage>e1002136</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Andrieu1"><label>22</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Andrieu</surname><given-names>C</given-names></name>, <name name-style="western"><surname>Doucet</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Holenstein</surname><given-names>R</given-names></name> (<year>2010</year>) <article-title>Particle Markov chain Monte Carlo methods</article-title>. <source>Journal of the Royal Statistical Society: Series B</source> <volume>72</volume>: <fpage>269</fpage>–<lpage>342</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Keeling1"><label>23</label>
<mixed-citation publication-type="book" xlink:type="simple">Keeling M, Rohani P (2008) Modeling infectious diseases in humans and animals. Princeton: Princeton University Press.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Williams1"><label>24</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Williams</surname><given-names>BG</given-names></name>, <name name-style="western"><surname>Lloyd-Smith</surname><given-names>JO</given-names></name>, <name name-style="western"><surname>Gouws</surname><given-names>E</given-names></name>, <name name-style="western"><surname>Hankins</surname><given-names>C</given-names></name>, <name name-style="western"><surname>Getz</surname><given-names>WM</given-names></name>, <etal>et al</etal>. (<year>2006</year>) <article-title>The potential impact of male circumcision on HIV in sub-Saharan Africa</article-title>. <source>PLoS Medicine</source> <volume>3</volume>: <fpage>e262</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Granich1"><label>25</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Granich</surname><given-names>RM</given-names></name>, <name name-style="western"><surname>Gilks</surname><given-names>CF</given-names></name>, <name name-style="western"><surname>Dye</surname><given-names>C</given-names></name>, <name name-style="western"><surname>De Cock</surname><given-names>KM</given-names></name>, <name name-style="western"><surname>Williams</surname><given-names>BG</given-names></name> (<year>2009</year>) <article-title>Universal voluntary HIV testing with immediate antiretroviral therapy as a strategy for elimination of HIV transmission: a mathematical model</article-title>. <source>The Lancet</source> <volume>373</volume>: <fpage>48</fpage>–<lpage>57</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Volz3"><label>26</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Volz</surname><given-names>EM</given-names></name>, <name name-style="western"><surname>Koopman</surname><given-names>JS</given-names></name>, <name name-style="western"><surname>Ward</surname><given-names>MJ</given-names></name>, <name name-style="western"><surname>Brown</surname><given-names>AL</given-names></name>, <name name-style="western"><surname>Frost</surname><given-names>SD</given-names></name> (<year>2012</year>) <article-title>Simple epidemiological dynamics explain phylogenetic clustering of HIV from patients with recent infection</article-title>. <source>PLoS Comput Biol</source> <volume>8</volume>: <fpage>e1002552</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Keeling2"><label>27</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Keeling</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Rohani</surname><given-names>P</given-names></name> (<year>2002</year>) <article-title>Estimating spatial coupling in epidemiological systems: a mechanistic approach</article-title>. <source>Ecology Letters</source> <volume>5</volume>: <fpage>20</fpage>–<lpage>29</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Andrieu2"><label>28</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Andrieu</surname><given-names>C</given-names></name>, <name name-style="western"><surname>Roberts</surname><given-names>GO</given-names></name> (<year>2009</year>) <article-title>The pseudo-marginal approach for efficient Monte Carlo computations</article-title>. <source>The Annals of Statistics</source> <volume>37</volume>: <fpage>697</fpage>–<lpage>725</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Doucet1">
<mixed-citation publication-type="book" xlink:type="simple">Doucet A, De Freitas N, Gordon N, et al. (2001) Sequential Monte Carlo methods in practice, volume 1. Springer New York.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Cappe1"><label>30</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Cappe</surname><given-names>O</given-names></name>, <name name-style="western"><surname>Godsill</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Moulines</surname><given-names>E</given-names></name> (<year>2007</year>) <article-title>An overview of existing methods and recent advances in sequential Monte Carlo</article-title>. <source>Proc Inst Electr Elect</source> <volume>95</volume>: <fpage>899</fpage>–<lpage>924</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Doucet2"><label>31</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Doucet</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Johansen</surname><given-names>A</given-names></name> (<year>2009</year>) <article-title>A tutorial on particle filtering and smoothing: Fifteen years later</article-title>. <source>Handbook of Nonlinear Filtering</source> <fpage>656</fpage>–<lpage>704</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Gillespie1"><label>32</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Gillespie</surname><given-names>DT</given-names></name> (<year>2007</year>) <article-title>Stochastic simulation of chemical kinetics</article-title>. <source>Annu Rev Phys Chem</source> <volume>58</volume>: <fpage>35</fpage>–<lpage>55</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Drummond2"><label>33</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Drummond</surname><given-names>AJ</given-names></name>, <name name-style="western"><surname>Rambaut</surname><given-names>A</given-names></name> (<year>2007</year>) <article-title>BEAST: Bayesian evolutionary analysis by sampling trees</article-title>. <source>BMC Evolutionary Biology</source> <volume>7</volume>: <fpage>214</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Volz4"><label>34</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Volz</surname><given-names>EM</given-names></name>, <name name-style="western"><surname>Ionides</surname><given-names>E</given-names></name>, <name name-style="western"><surname>Romero-Severson</surname><given-names>EO</given-names></name>, <name name-style="western"><surname>Brandt</surname><given-names>MG</given-names></name>, <name name-style="western"><surname>Mokotoff</surname><given-names>E</given-names></name>, <etal>et al</etal>. (<year>2013</year>) <article-title>HIV-1 Transmission during Early Infection in Men Who Have Sex with Men: A Phylodynamic Analysis</article-title>. <source>PLoS MedicineS Medicine</source> <volume>10</volume>: <fpage>e1001568</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Yan1"><label>35</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Yan</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Zhang</surname><given-names>F</given-names></name>, <name name-style="western"><surname>Wand</surname><given-names>H</given-names></name> (<year>2011</year>) <article-title>Using HIV diagnostic data to estimate HIV incidence: method and simulation</article-title>. <source>Statistical Communications in Infectious Diseases</source> <volume>3</volume>: <fpage>1</fpage>–<lpage>28</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Cohen1"><label>36</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Cohen</surname><given-names>MS</given-names></name>, <name name-style="western"><surname>Dye</surname><given-names>C</given-names></name>, <name name-style="western"><surname>Fraser</surname><given-names>C</given-names></name>, <name name-style="western"><surname>MillerWC, Powers</surname><given-names>KA</given-names></name>, <etal>et al</etal>. (<year>2012</year>) <article-title>HIV treatment as prevention: debate and commentary—will early infection compromise treatment-as-prevention strategies</article-title>? <source>PLoS medicine</source> <volume>9</volume>: <fpage>e1001232</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Kretzschmar1"><label>37</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Kretzschmar</surname><given-names>ME</given-names></name>, <name name-style="western"><surname>van der Loeff</surname><given-names>MFS</given-names></name>, <name name-style="western"><surname>Birrell</surname><given-names>PJ</given-names></name>, <name name-style="western"><surname>De Angelis</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Coutinho</surname><given-names>RA</given-names></name> (<year>2013</year>) <article-title>Prospects of elimination of HIV with test-and-treat strategy</article-title>. <source>Proceedings of the National Academy of Sciences</source> <volume>110</volume>: <fpage>15538</fpage>–<lpage>15543</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Brown1"><label>38</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Brown</surname><given-names>AJL</given-names></name>, <name name-style="western"><surname>Lycett</surname><given-names>SJ</given-names></name>, <name name-style="western"><surname>Weinert</surname><given-names>L</given-names></name>, <name name-style="western"><surname>Hughes</surname><given-names>GJ</given-names></name>, <name name-style="western"><surname>Fearnhill</surname><given-names>E</given-names></name>, <etal>et al</etal>. (<year>2011</year>) <article-title>Transmission network parameters estimated from HIV sequences for a nationwide epidemic</article-title>. <source>Journal of Infectious Diseases</source> <volume>204</volume>: <fpage>1463</fpage>–<lpage>1469</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Pilcher1"><label>39</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Pilcher</surname><given-names>CD</given-names></name>, <name name-style="western"><surname>Tien</surname><given-names>HC</given-names></name>, <name name-style="western"><surname>Eron</surname><given-names>JJ</given-names></name>, <name name-style="western"><surname>Vernazza</surname><given-names>PL</given-names></name>, <name name-style="western"><surname>Leu</surname><given-names>SY</given-names></name>, <etal>et al</etal>. (<year>2004</year>) <article-title>Brief but efficient: acute HIV infection and the sexual transmission of HIV</article-title>. <source>Journal of Infectious Diseases</source> <volume>189</volume>: <fpage>1785</fpage>–<lpage>1792</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Hollingsworth1"><label>40</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Hollingsworth</surname><given-names>TD</given-names></name>, <name name-style="western"><surname>Anderson</surname><given-names>RM</given-names></name>, <name name-style="western"><surname>Fraser</surname><given-names>C</given-names></name> (<year>2008</year>) <article-title>HIV-1 transmission, by stage of infection</article-title>. <source>Journal of Infectious Diseases</source> <volume>198</volume>: <fpage>687</fpage>–<lpage>693</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Powers1"><label>41</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Powers</surname><given-names>KA</given-names></name>, <name name-style="western"><surname>Ghani</surname><given-names>AC</given-names></name>, <name name-style="western"><surname>Miller</surname><given-names>WC</given-names></name>, <name name-style="western"><surname>Hoffman</surname><given-names>IF</given-names></name>, <name name-style="western"><surname>Pettifor</surname><given-names>AE</given-names></name>, <etal>et al</etal>. (<year>2011</year>) <article-title>The role of acute and early HIV infection in the spread of HIV and implications for transmission prevention strategies in Lilongwe, Malawi: a modelling study</article-title>. <source>The Lancet</source> <volume>378</volume>: <fpage>256</fpage>–<lpage>268</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Ypma1"><label>42</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Ypma</surname><given-names>RJ</given-names></name>, <name name-style="western"><surname>van Ballegooijen</surname><given-names>WM</given-names></name>, <name name-style="western"><surname>Wallinga</surname><given-names>J</given-names></name> (<year>2013</year>) <article-title>Relating phylogenetic trees to transmission trees of infectious disease outbreaks</article-title>. <source>Genetics</source> <volume>195</volume>: <fpage>1055</fpage>–<lpage>1062</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Dearlove1"><label>43</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Dearlove</surname><given-names>B</given-names></name>, <name name-style="western"><surname>Wilson</surname><given-names>DJ</given-names></name> (<year>2013</year>) <article-title>Coalescent inference for infectious disease: meta-analysis of hepatitis C</article-title>. <source>Philos Trans R Soc Lond B Biol Sci</source> <volume>368</volume>: <fpage>1614</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Yang1"><label>44</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Yang</surname><given-names>Z</given-names></name> (<year>1998</year>) <article-title>On the best evolutionary rate for phylogenetic analysis</article-title>. <source>Syst Biol</source> <volume>47</volume>: <fpage>125</fpage>–<lpage>33</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Beerli2"><label>45</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Beerli</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Felsenstein</surname><given-names>J</given-names></name> (<year>1999</year>) <article-title>Maximum-likelihood estimation of migration rates and effective population numbers in two populations using a coalescent approach</article-title>. <source>Genetics</source> <volume>152</volume>: <fpage>763</fpage>–<lpage>73</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Lemey1"><label>46</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Lemey</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Rambaut</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Drummond</surname><given-names>AJ</given-names></name>, <name name-style="western"><surname>Suchard</surname><given-names>MA</given-names></name> (<year>2009</year>) <article-title>Bayesian phylogeography finds its roots</article-title>. <source>PLoS Comput Biol</source> <volume>5</volume>: <fpage>e1000520</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Pybus2"><label>47</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Pybus</surname><given-names>OG</given-names></name>, <name name-style="western"><surname>Suchard</surname><given-names>MA</given-names></name>, <name name-style="western"><surname>Lemey</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Bernardin</surname><given-names>FJ</given-names></name>, <name name-style="western"><surname>Rambaut</surname><given-names>A</given-names></name>, <etal>et al</etal>. (<year>2012</year>) <article-title>Unifying the spatial epidemiology and molecular evolution of emerging epidemics</article-title>. <source>Proc Natl Acad Sci USA</source> <volume>109</volume>: <fpage>15066</fpage>–<lpage>71</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003570-Rasmussen2"><label>48</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Rasmussen</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Boni</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Koelle</surname><given-names>K</given-names></name> (<year>2014</year>) <article-title>Reconciling epidemiology with phylogeny: The case of dengue virus in southern Vietnam</article-title>. <source>Mol Biol Evol</source> <volume>31</volume>: <fpage>258</fpage>–<lpage>271</lpage>.</mixed-citation>
</ref>
</ref-list></back>
</article>