<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article
  PUBLIC "-//NLM//DTD Journal Publishing DTD v3.0 20080202//EN" "http://dtd.nlm.nih.gov/publishing/3.0/journalpublishing3.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="3.0" xml:lang="EN">
  <front>
    <journal-meta><journal-id journal-id-type="publisher-id">plos</journal-id><journal-id journal-id-type="nlm-ta">PLoS Comput Biol</journal-id><journal-id journal-id-type="pmc">ploscomp</journal-id><!--===== Grouping journal title elements =====--><journal-title-group><journal-title>PLoS Computational Biology</journal-title></journal-title-group><issn pub-type="ppub">1553-734X</issn><issn pub-type="epub">1553-7358</issn><publisher>
        <publisher-name>Public Library of Science</publisher-name>
        <publisher-loc>San Francisco, USA</publisher-loc>
      </publisher></journal-meta>
    <article-meta><article-id pub-id-type="publisher-id">PCOMPBIOL-D-10-00410</article-id><article-id pub-id-type="doi">10.1371/journal.pcbi.1002136</article-id><article-categories>
        <subj-group subj-group-type="heading">
          <subject>Research Article</subject>
        </subj-group>
        <subj-group subj-group-type="Discipline-v2">
          <subject>Biology</subject>
          <subj-group>
            <subject>Computational biology</subject>
          </subj-group>
          <subj-group>
            <subject>Evolutionary biology</subject>
          </subj-group>
          <subj-group>
            <subject>Population biology</subject>
          </subj-group>
        </subj-group>
        <subj-group subj-group-type="Discipline-v2">
          <subject>Mathematics</subject>
          <subj-group>
            <subject>Nonlinear dynamics</subject>
          </subj-group>
          <subj-group>
            <subject>Statistics</subject>
          </subj-group>
        </subj-group>
        <subj-group subj-group-type="Discipline">
          <subject>Computational Biology</subject>
          <subject>Evolutionary Biology</subject>
          <subject>Mathematics</subject>
        </subj-group>
      </article-categories><title-group><article-title>Inference for Nonlinear Epidemiological Models Using Genealogies and Time Series</article-title><alt-title alt-title-type="running-head">Phylodynamic Inference</alt-title></title-group><contrib-group>
        <contrib contrib-type="author" xlink:type="simple">
          <name name-style="western">
            <surname>Rasmussen</surname>
            <given-names>David A.</given-names>
          </name>
          <xref ref-type="aff" rid="aff1">
            <sup>1</sup>
          </xref>
          <xref ref-type="corresp" rid="cor1">
            <sup>*</sup>
          </xref>
        </contrib>
        <contrib contrib-type="author" xlink:type="simple">
          <name name-style="western">
            <surname>Ratmann</surname>
            <given-names>Oliver</given-names>
          </name>
          <xref ref-type="aff" rid="aff1">
            <sup>1</sup>
          </xref>
          <xref ref-type="aff" rid="aff2">
            <sup>2</sup>
          </xref>
        </contrib>
        <contrib contrib-type="author" xlink:type="simple">
          <name name-style="western">
            <surname>Koelle</surname>
            <given-names>Katia</given-names>
          </name>
          <xref ref-type="aff" rid="aff1">
            <sup>1</sup>
          </xref>
          <xref ref-type="aff" rid="aff3">
            <sup>3</sup>
          </xref>
          <xref ref-type="corresp" rid="cor1">
            <sup>*</sup>
          </xref>
        </contrib>
      </contrib-group><aff id="aff1"><label>1</label><addr-line>Department of Biology, Duke University, Durham, North Carolina, United States of America</addr-line>       </aff><aff id="aff2"><label>2</label><addr-line>Imperial College London, Department of Infectious Disease Epidemiology, London, United Kingdom</addr-line>       </aff><aff id="aff3"><label>3</label><addr-line>Fogarty International Center, National Institutes of Health, Bethesda, Maryland, United States of America</addr-line>       </aff><contrib-group>
        <contrib contrib-type="editor" xlink:type="simple">
          <name name-style="western">
            <surname>Lemey</surname>
            <given-names>Philippe</given-names>
          </name>
          <role>Editor</role>
          <xref ref-type="aff" rid="edit1"/>
        </contrib>
      </contrib-group><aff id="edit1">Rega Institute, Katholieke Universiteit Leuven, Belgium</aff><author-notes>
        <corresp id="cor1">* E-mail: <email xlink:type="simple">dar24@duke.edu</email> (DAR); <email xlink:type="simple">katia.koelle@duke.edu</email> (KK)</corresp>
        <fn fn-type="con">
          <p>Conceived and designed the experiments: DAR OR KK. Performed the experiments: DAR. Analyzed the data: DAR. Wrote the paper: DAR OR KK. </p>
        </fn>
      <fn fn-type="conflict">
        <p>The authors have declared that no competing interests exist.</p>
      </fn></author-notes><pub-date pub-type="collection">
        <month>8</month>
        <year>2011</year>
      </pub-date><pub-date pub-type="epub">
        <day>25</day>
        <month>8</month>
        <year>2011</year>
      </pub-date><volume>7</volume><issue>8</issue><elocation-id>e1002136</elocation-id><history>
        <date date-type="received">
          <day>16</day>
          <month>12</month>
          <year>2010</year>
        </date>
        <date date-type="accepted">
          <day>10</day>
          <month>6</month>
          <year>2011</year>
        </date>
      </history><!--===== Grouping copyright info into permissions =====--><permissions><copyright-year>2011</copyright-year><copyright-holder>Rasmussen et al</copyright-holder><license><license-p>This is an open-access article distributed under the terms of the Creative Commons Attribution License, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p></license></permissions><abstract>
        <p>Phylodynamics - the field aiming to quantitatively integrate the ecological and evolutionary dynamics of rapidly evolving populations like those of RNA viruses – increasingly relies upon coalescent approaches to infer past population dynamics from reconstructed genealogies. As sequence data have become more abundant, these approaches are beginning to be used on populations undergoing rapid and rather complex dynamics. In such cases, the simple demographic models that current phylodynamic methods employ can be limiting. First, these models are not ideal for yielding biological insight into the processes that drive the dynamics of the populations of interest. Second, these models differ in form from mechanistic and often stochastic population dynamic models that are currently widely used when fitting models to time series data. As such, their use does not allow for both genealogical data and time series data to be considered in tandem when conducting inference. Here, we present a flexible statistical framework for phylodynamic inference that goes beyond these current limitations. The framework we present employs a recently developed method known as particle MCMC to fit stochastic, nonlinear mechanistic models for complex population dynamics to gene genealogies and time series data in a Bayesian framework. We demonstrate our approach using a nonlinear Susceptible-Infected-Recovered (SIR) model for the transmission dynamics of an infectious disease and show through simulations that it provides accurate estimates of past disease dynamics and key epidemiological parameters from genealogies with or without accompanying time series data.</p>
      </abstract><abstract abstract-type="summary">
        <title>Author Summary</title>
        <p>Reliable information about the demographic history of populations is important to both population biologists and epidemiologists, but is often absent or unreliable. There has therefore been great interest in developing statistical methods for inferring past population dynamics from gene genealogies reconstructed from molecular sequences. These “phylodynamic” methods take advantage of the fact that changes in population size can dramatically affect the shape of genealogies, making it possible to infer past changes in population size from a genealogy. However, in order for past population dynamics to be inferred, a demographic model must be specified. Current methods use demographic models that are often too simple for populations undergoing complex dynamics and generally do not allow for the parameters influencing the population dynamics to be estimated. We show how current phylodynamic methods can be extended to allow a much wider class of models to be fit to genealogies and illustrate our approach using an epidemiological model for the transmission of an infectious disease.</p>
      </abstract><funding-group><funding-statement>This work was supported by a NSF graduate research fellowship to DAR (<ext-link ext-link-type="uri" xlink:href="http://www.nsf.gov" xlink:type="simple">www.nsf.gov</ext-link>), by Sir Henry Wellcome fellowship WR092311MF to OR (<ext-link ext-link-type="uri" xlink:href="http://www.wellcome.ac.uk" xlink:type="simple">www.wellcome.ac.uk</ext-link>), by grant NSF-EF-08-27416 to KK, and by the RAPIDD program of the Science &amp; Technology Directorate, Department of Homeland Security, and the Fogarty International Center, National Institutes of Health (<ext-link ext-link-type="uri" xlink:href="http://www.fic.nih.gov/about/dieps.htm#rapidd" xlink:type="simple">www.fic.nih.gov/about/dieps.htm#rapidd</ext-link>). The funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.</funding-statement></funding-group><counts>
        <page-count count="11"/>
      </counts></article-meta>
  </front>
  <body>
    <sec id="s1">
      <title>Introduction</title>
      <p>Epidemiologists increasingly rely on the ability to fit mechanistic models of disease transmission to data in order to estimate key parameters and elucidate the underlying processes driving disease dynamics. However, the nature of epidemiological data makes model fitting statistically challenging. Case report data such as time series of disease incidence are often incomplete or subject to severe biases like underreporting. Moreover, disease dynamics are generally only partially observed in that the exact times at which infection and recovery events occur are rarely, if ever, directly observed <xref ref-type="bibr" rid="pcbi.1002136-Cauchemez1">[1]</xref>, <xref ref-type="bibr" rid="pcbi.1002136-ONeill1">[2]</xref>, <xref ref-type="bibr" rid="pcbi.1002136-ONeill2">[3]</xref>. Researchers have therefore turned to the large amounts of molecular sequence data becoming available when case report data are insufficient. Gene genealogies can be reconstructed from sequence data and the times of coalescence events (i.e. branching events) can be used as a proxy for the timing of a subset of transmission events in the population. Using coalescent-based “phylodynamic” methods, it is then possible to infer the past dynamics of a disease from the lineages present in the genealogy, opening up the possibility of fitting models directly to genealogies.</p>
      <p>Several coalescent-based methods for inferring past population dynamics from genealogies have already been developed <xref ref-type="bibr" rid="pcbi.1002136-Drummond1">[4]</xref>, <xref ref-type="bibr" rid="pcbi.1002136-Kuhner1">[5]</xref>, <xref ref-type="bibr" rid="pcbi.1002136-Minin1">[6]</xref>, <xref ref-type="bibr" rid="pcbi.1002136-Strimmer1">[7]</xref>. These methods employ the basic result of coalescent theory that the rate of coalescence is inversely proportional to the effective population size, <italic>N<sub>e</sub></italic> <xref ref-type="bibr" rid="pcbi.1002136-Hudson1">[8]</xref>. Given the distribution of coalescence times over a genealogy, it is then possible to infer <italic>N<sub>e</sub></italic>, which for an infectious disease is generally interpreted as an estimate of the number of infected hosts <xref ref-type="bibr" rid="pcbi.1002136-Pybus1">[9]</xref>. Past population dynamics can also be inferred by specifying a demographic model and fitting it to a genealogy <xref ref-type="bibr" rid="pcbi.1002136-Griffiths1">[10]</xref>, <xref ref-type="bibr" rid="pcbi.1002136-Nee1">[11]</xref>. Most often, these demographic models are phenomenological and use simple parametric functions (e.g. constant size, exponential growth or logistic growth) or nonparametric functions that constrain population sizes to change smoothly or only at certain points in time <xref ref-type="bibr" rid="pcbi.1002136-Drummond1">[4]</xref>, <xref ref-type="bibr" rid="pcbi.1002136-Minin1">[6]</xref>, <xref ref-type="bibr" rid="pcbi.1002136-Strimmer1">[7]</xref>. Fitting simple parametric models like exponential growth to genealogies can provide insight into the epidemic dynamics of pathogens and provide estimates of epidemic growth rates and times of emergence <xref ref-type="bibr" rid="pcbi.1002136-Carrington1">[12]</xref>, <xref ref-type="bibr" rid="pcbi.1002136-Fraser1">[13]</xref>, <xref ref-type="bibr" rid="pcbi.1002136-Lemey1">[14]</xref>. Phylodynamic methods have also been applied to systems with far more complex endemic disease dynamics where the prevalence of the disease can fluctuate rapidly or undergo complex periodic oscillations. Remarkably, phylodynamic analyses of RNA viruses can sometimes recover features of their complex population dynamics due to a fast rate of sequence evolution and sampling of sequences over time <xref ref-type="bibr" rid="pcbi.1002136-Bennett1">[15]</xref>, <xref ref-type="bibr" rid="pcbi.1002136-Rambaut1">[16]</xref>, <xref ref-type="bibr" rid="pcbi.1002136-Siebenga1">[17]</xref>.</p>
      <p>While the vast majority of phylodynamic studies have inferred past dynamics by fitting phenomenological models to genealogies, a smaller body of work has investigated fitting mechanistic population dynamic models such as the well-known Susceptible-Infected-Recovered (SIR) class of models for the transmission dynamics of an infectious disease <xref ref-type="bibr" rid="pcbi.1002136-Pybus1">[9]</xref>, <xref ref-type="bibr" rid="pcbi.1002136-Volz1">[18]</xref>. Using mechanistic population dynamic models in place of phenomenological models may have major benefits. First, biologically important parameter values can be estimated along with past population dynamics, which can provide insights into the underlying processes driving historical population dynamics. For example, Pybus <italic>et al.</italic> <xref ref-type="bibr" rid="pcbi.1002136-Pybus1">[9]</xref> were able to estimate the basic reproductive number <italic>R<sub>0</sub></italic> from viral genealogies for subtypes of Hepatitis C virus. Second, using these types of models should also improve our ability to correctly infer complex population dynamics, as they are constrained by population size trajectories that are dynamically feasible, rather than only biologically sensible (e.g., by being temporally continuous).</p>
      <p>While the field of phylodynamics has made tremendous progress in recent years, methodological constraints limit the use of phylodynamic methods in epidemiological modeling more generally. First, only relatively simple epidemiological models where the number of infected hosts is a deterministic function of time can currently be fit using standard coalescent-based methods <xref ref-type="bibr" rid="pcbi.1002136-Drummond1">[4]</xref>, <xref ref-type="bibr" rid="pcbi.1002136-Volz1">[18]</xref>, <xref ref-type="bibr" rid="pcbi.1002136-Pybus2">[19]</xref>. However, epidemiological dynamics are inherently stochastic and both demographic and environmental stochasticity can play important roles in disease dynamics <xref ref-type="bibr" rid="pcbi.1002136-Coulson1">[20]</xref>, <xref ref-type="bibr" rid="pcbi.1002136-Earn1">[21]</xref>, <xref ref-type="bibr" rid="pcbi.1002136-Rohani1">[22]</xref>. Stochastic models are also essential for statistical inference since the variability, or over-dispersion, observed in real data can only be described statistically if stochasticity is included in the model <xref ref-type="bibr" rid="pcbi.1002136-Breto1">[23]</xref>. This is especially true when fitting models to long-term data where the effects of stochasticity can accrue over time and cause the observed disease dynamics to deviate widely from the expectations of a deterministic model.</p>
      <p>Current phylodynamic methods are also limited in that inference can only be conducted using genealogies. While phylodynamic methods will generally be used in the absence of historical data, other sources of data such as time series may be available alongside of sequence samples. This is especially the case for well-studied RNA viruses, where time series of case report data are collected as part of epidemiological surveillance programs. A number of statistical methods already exist for fitting mechanistic population dynamic models to time series data <xref ref-type="bibr" rid="pcbi.1002136-Cauchemez1">[1]</xref>, <xref ref-type="bibr" rid="pcbi.1002136-Finkenstadt1">[24]</xref>, <xref ref-type="bibr" rid="pcbi.1002136-Ionides1">[25]</xref>. Generalizing such methods to fit mechanistic population models to genealogies as well would allow for inferences to be drawn from both time series and genealogies. Such an approach would allow for direct comparison between estimates derived from genealogies with estimates derived from time series data. Moreover, inference could then be conducted using both genealogical and population incidence data, potentially leading to more robust results.</p>
      <p>The field of phylodynamics could therefore greatly benefit from having more flexible methods for genealogical-based inference. To this end, we have developed a general framework for phylodynamic inference that accommodates stochastic, mechanistic population dynamic models and can be integrated with other sources of data such as time series. In our framework, state-space models (SSMs) are used to model underlying biological processes mechanistically. While SSMs are already commonly fit to time series, we show how SSMs can also be fit to genealogies using coalescent methods. This allows for the model parameters and past population dynamics to be inferred from genealogies with or without accompanying time series data. Full Bayesian inference of all model parameters and past dynamics is performed using a method known as particle Markov Chain Monte Carlo (particle MCMC) <xref ref-type="bibr" rid="pcbi.1002136-Andrieu1">[26]</xref>, which uses particle filtering methods to fit SSMs to data without requiring an analytical likelihood function <xref ref-type="bibr" rid="pcbi.1002136-Breto1">[23]</xref>, <xref ref-type="bibr" rid="pcbi.1002136-Ionides1">[25]</xref>. This makes it possible to use a wide-class of SSMs for phylodynamic inference, including the stochastic, continuous-time dynamic models commonly used in epidemiology and population biology.</p>
      <p>We present our approach by first briefly reviewing the fundamentals of SSMs and the particle MCMC method. We then present a stochastic SIR model for the dynamics of an infectious disease that we use throughout the paper as our SSM. For conceptual clarity, we first show how particle MCMC can be used to fit a SSM to time series data without a genealogy since this is a familiar problem in statistical inference. We then go on to show how the SSM framework can be expanded to include genealogies and how particle MCMC can be used to infer model parameters and past population dynamics from genealogies with or without accompanying time series data. Finally, we test our particle MCMC approach on simulated time series and genealogies. We find that reliable estimates of model parameters and past population dynamics can be obtained from time series data, a genealogy, or both. Moreover, we find that estimates obtained from genealogies approach the accuracy of estimates obtained from time series data when a large number of samples are collected serially over time.</p>
    </sec>
    <sec id="s2" sec-type="methods">
      <title>Methods</title>
      <p>The general statistical framework we use to fit population dynamic models to either genealogies or time series data is based on state-space modeling. Structurally, state-space models (SSMs) consist of a process model and an observation model. The process model describes the underlying dynamics of the state variables <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e001" xlink:type="simple"/></inline-formula> as a Markov process with model parameters <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e002" xlink:type="simple"/></inline-formula> for all time points <italic>t</italic> in {1, …, <italic>T</italic>}:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e003" xlink:type="simple"/><label>(1)</label></disp-formula>Below, we use a SIR compartmental model <xref ref-type="bibr" rid="pcbi.1002136-Anderson1">[27]</xref> as the process model for the transmission dynamics of an infectious disease, with state variables being the number of susceptible (S), infected (I), and recovered (R) individuals. The exact state of the population at any given time (e.g., S<sub>t</sub>, I<sub>t</sub>, R<sub>t</sub>) is generally not observable. The state variables therefore remain unknown latent variables that must be inferred from available data. We therefore need an observation model to relate the observed data <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e004" xlink:type="simple"/></inline-formula> to the underlying process model:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e005" xlink:type="simple"/><label>(2)</label></disp-formula>For example, we will use an observation model that accounts for normally distributed observation noise in time series observations. While SSMs are typically used with time series data, here we use a more general approach where a coalescent model can be used in place of an observation model to relate a genealogy to the state variables in the process model.</p>
      <p>To fit state space models to genealogical and/or time series data <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e006" xlink:type="simple"/></inline-formula>, we use a Bayesian approach. Our primary goal is to find the posterior density of parameters <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e007" xlink:type="simple"/></inline-formula> and latent state variables <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e008" xlink:type="simple"/></inline-formula>:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e009" xlink:type="simple"/><label>(3)</label></disp-formula>From the posterior density, point estimates of model parameters as well as measures of uncertainty can be easily derived. However, for the models we consider here, the posterior density is analytically intractable. We therefore use an MCMC algorithm to sample from <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e010" xlink:type="simple"/></inline-formula> (for background on MCMC methods, see <xref ref-type="bibr" rid="pcbi.1002136-Gilks1">[28]</xref>). For illustrative purposes, we first present the following simple MCMC algorithm. Given current values of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e011" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e012" xlink:type="simple"/></inline-formula>, we:</p>
      <list list-type="simple">
        <list-item>
          <p><bold>Step 1:</bold> Propose new values for <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e013" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e014" xlink:type="simple"/></inline-formula> by sampling from the proposal density <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e015" xlink:type="simple"/></inline-formula></p>
        </list-item>
        <list-item>
          <p><bold>Step 2:</bold> Evaluate the posterior probability of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e016" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e017" xlink:type="simple"/></inline-formula> given <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e018" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e019" xlink:type="simple"/></inline-formula>, by computing <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e020" xlink:type="simple"/></inline-formula>.</p>
        </list-item>
        <list-item>
          <p><bold>Step 3:</bold> With probability<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e021" xlink:type="simple"/></disp-formula>set <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e022" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e023" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e024" xlink:type="simple"/></inline-formula>; otherwise set <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e025" xlink:type="simple"/></inline-formula> <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e026" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e027" xlink:type="simple"/></inline-formula></p>
        </list-item>
      </list>
      <p>In practice, there are two major problems with using this naive MCMC approach. First, choosing an efficient proposal density for nonlinear and high-dimensional models is challenging <xref ref-type="bibr" rid="pcbi.1002136-ONeill3">[29]</xref>. Second, it is often difficult or impossible to evaluate the likelihood needed in step 2 when the disease dynamics are only partially observed through temporally aggregated data and the exact infection times are unknown <xref ref-type="bibr" rid="pcbi.1002136-ONeill2">[3]</xref>, <xref ref-type="bibr" rid="pcbi.1002136-Becker1">[30]</xref>. In our case, there is no analytical expression to impute over all unobserved infection times for continuous time, stochastic population models. We therefore use an approach known as particle MCMC <xref ref-type="bibr" rid="pcbi.1002136-Andrieu1">[26]</xref>, which employs a particle filtering algorithm to numerically construct an efficient proposal density without requiring that the likelihood be computed analytically.</p>
      <p>The particle MCMC algorithm is essentially a particular version of the MCMC sampler presented above. While new values of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e028" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e029" xlink:type="simple"/></inline-formula> can be proposed together in Step 1, in particle MCMC new values for <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e030" xlink:type="simple"/></inline-formula> are first sampled from the proposal density <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e031" xlink:type="simple"/></inline-formula> and then <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e032" xlink:type="simple"/></inline-formula> is independently proposed by sampling sequentially from <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e033" xlink:type="simple"/></inline-formula>, so that the proposal density has the form<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e034" xlink:type="simple"/></disp-formula>where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e035" xlink:type="simple"/></inline-formula> is a Monte Carlo estimate of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e036" xlink:type="simple"/></inline-formula> that must be obtained with a particle filtering algorithm (see below). The proposed <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e037" xlink:type="simple"/></inline-formula> is therefore “adapted” to the data, which in our case, greatly improves MCMC efficiency <xref ref-type="bibr" rid="pcbi.1002136-Andrieu1">[26]</xref>. As shown by Andrieu <italic>et al.</italic> <xref ref-type="bibr" rid="pcbi.1002136-Andrieu1">[26]</xref>, the acceptance probability in Step 3 is exactly given by<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e038" xlink:type="simple"/><label>(4)</label></disp-formula>where the Monte Carlo estimate <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e039" xlink:type="simple"/></inline-formula> to the marginal likelihood is a byproduct of the particle filtering algorithm (see below). The full justification for using this acceptance probability is non-trivial, and we refer to <xref ref-type="bibr" rid="pcbi.1002136-Andrieu1">[26]</xref>. We can therefore approximate the joint posterior density of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e040" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e041" xlink:type="simple"/></inline-formula> using particle MCMC, which would otherwise be very difficult or impossible using standard MCMC methods. Pseudo code for the complete particle MCMC algorithm is given in <xref ref-type="supplementary-material" rid="pcbi.1002136.s001">Text S1</xref>.</p>
      <p>The particle filtering algorithm used in particle MCMC allows us to numerically approximate <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e042" xlink:type="simple"/></inline-formula> by simulating the unknown trajectories of the state variables from the process model (for reviews, see <xref ref-type="bibr" rid="pcbi.1002136-Cappe1">[31]</xref>, <xref ref-type="bibr" rid="pcbi.1002136-Doucet1">[32]</xref>). The key idea behind particle filtering is to update particles sequentially through time so that at any time <italic>t</italic>, the weighted particles provide an approximation to the density <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e043" xlink:type="simple"/></inline-formula>. This is done by propagating particles forward from time <italic>t-1</italic> to <italic>t</italic> at each observation point in a two-step process. First, the state of each particle is updated by sampling new values from an importance density <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e044" xlink:type="simple"/></inline-formula>, where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e045" xlink:type="simple"/></inline-formula> refers to the state of the <italic>j</italic>th particle at time <italic>t</italic>. Second, after the state of the particles has been updated, each particle is filtered according to the observation model and assigned a weight <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e046" xlink:type="simple"/></inline-formula>. In general, the unnormalized particle weights are calculated as<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e047" xlink:type="simple"/><label>(5)</label></disp-formula>In our case, there is no ideal importance density to sample from and particles are propagated by simulating directly from the process model <xref ref-type="bibr" rid="pcbi.1002136-Ionides1">[25]</xref>, <xref ref-type="bibr" rid="pcbi.1002136-Cappe1">[31]</xref>, <xref ref-type="bibr" rid="pcbi.1002136-Gordon1">[33]</xref>, so that equation 5 simplifies to:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e048" xlink:type="simple"/><label>(6)</label></disp-formula>In other words, the unnormalized weight assigned to a particle is simply the probability of observing the data <italic>z</italic><sub>t</sub> given the state of the particle as specified by the observation model. The unnormalized weights can then be summed to approximate the conditional marginal likelihood <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e049" xlink:type="simple"/></inline-formula>,<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e050" xlink:type="simple"/><label>(7)</label></disp-formula>By the law of total probability, an approximation to the marginal likelihood of the entire series of observations given <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e051" xlink:type="simple"/></inline-formula> is simply<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e052" xlink:type="simple"/><label>(8)</label></disp-formula>This numerical approximation to the marginal likelihood is exactly the term that is required to evaluate the acceptance probability in equation 4 needed to perform MCMC sampling.</p>
      <p>A common problem with particle filtering algorithms is that particle weights degenerate over time, meaning that most particles will carry little weight while a few will carry most of the weight <xref ref-type="bibr" rid="pcbi.1002136-Cappe1">[31]</xref>, <xref ref-type="bibr" rid="pcbi.1002136-Doucet1">[32]</xref>. If this occurs, the particle system will not provide a good approximation to the density <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e053" xlink:type="simple"/></inline-formula>. For long time series, this becomes a serious problem. The standard way of dealing with this issue is to resample particles from the population so that unpromising particles with low weights are not propagated forwards through time while promising particles are used to replenish the particle population <xref ref-type="bibr" rid="pcbi.1002136-Chopin1">[34]</xref>. We therefore calculate the normalized weights of each of the particles:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e054" xlink:type="simple"/><label>(9)</label></disp-formula>and then resample particles according to their weights by multinomial sampling with replacement so that the total number of particles remains constant. Resampling is performed after every time step, after which particle weights are reset to 1/<italic>N</italic>. This particular particle filtering algorithm is known as bootstrap filtering and has the nice property that particle weights are independent of the particle's past trajectory <xref ref-type="bibr" rid="pcbi.1002136-Doucet1">[32]</xref>, <xref ref-type="bibr" rid="pcbi.1002136-Gordon1">[33]</xref>. Note that without resampling, a proposal for <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e055" xlink:type="simple"/></inline-formula> in each step of the particle MCMC algorithm can be obtained simply by sampling a single particle trajectory <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e056" xlink:type="simple"/></inline-formula> from the particle filter approximation to <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e057" xlink:type="simple"/></inline-formula>. However, because particles are resampled at each time step in the particle filter, we have to track the ancestry of particles so that a single trajectory representing the path of a single particle through state space can be sampled. Pseudo code for the full particle filtering algorithm with resampling is given in <xref ref-type="supplementary-material" rid="pcbi.1002136.s001">Text S1</xref>.</p>
      <sec id="s2a">
        <title>Inference with time series data</title>
        <p>We first consider fitting a SSM to time series data <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e058" xlink:type="simple"/></inline-formula> using particle MCMC. As our process model, we use a Susceptible-Infected-Recovered (SIR) epidemiological model with noise arising from variability in the transmission rate due to environmental factors. Using the Euler-Maruyama method, we can simulate this model forward in time with equations:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e059" xlink:type="simple"/><label>(10a)</label></disp-formula><disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e060" xlink:type="simple"/><label>(10b)</label></disp-formula><disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e061" xlink:type="simple"/><label>(10c)</label></disp-formula>where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e062" xlink:type="simple"/></inline-formula> is the host birth/death rate, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e063" xlink:type="simple"/></inline-formula> is the rate of recovery, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e064" xlink:type="simple"/></inline-formula> is the seasonally varying transmission rate, and <italic>N</italic> is the constant population size of the host, which we assume is known. We let the transmission rate vary sinusoidally with strength of seasonality <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e065" xlink:type="simple"/></inline-formula>: <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e066" xlink:type="simple"/></inline-formula> where the mean transmission rate is given by: <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e067" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e068" xlink:type="simple"/></inline-formula> is the basic reproduction number. The noise term <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e069" xlink:type="simple"/></inline-formula> is given by <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e070" xlink:type="simple"/></inline-formula>, where <italic>W</italic> is a normal random variate with mean equal to zero and variance equal to one <xref ref-type="bibr" rid="pcbi.1002136-Keeling1">[35]</xref>. The constant <italic>F</italic> scales the magnitude of environmental noise. Along with equations 10a–c, we simulate a compartment, <italic>C</italic>, that tracks the cumulative number of infected individuals over time (i.e. the cumulative incidence):<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e071" xlink:type="simple"/><label>(10d)</label></disp-formula>From <italic>C</italic>, we can compute the number of new infections occurring between any two time points <italic>t</italic>-1 and <italic>t</italic>: <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e072" xlink:type="simple"/></inline-formula>. Assuming that only a fraction <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e073" xlink:type="simple"/></inline-formula> of these new cases are observed, and that observation error is normally distributed, the likelihood of observing <italic>y</italic> cases at time <italic>t</italic> is given by the observation model:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e074" xlink:type="simple"/><label>(11)</label></disp-formula>where the mean is given by <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e075" xlink:type="simple"/></inline-formula> and the observation variance is given by <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e076" xlink:type="simple"/></inline-formula>, which depends on a scaling parameter <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e077" xlink:type="simple"/></inline-formula>, as in Ionides <italic>et al.</italic> <xref ref-type="bibr" rid="pcbi.1002136-Ionides1">[25]</xref>.</p>
        <p>Adapting the particle MCMC algorithm described above to fit the SIR model to time series data is straightforward. In the particle filtering algorithm, particle trajectories are simulated from equations 10a–d with process noise, so that each particle has a simulated incidence value <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e078" xlink:type="simple"/></inline-formula>. Particle weights are assigned using the observation model given in equation 11, so that unnormalized particle weights are calculated as<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e079" xlink:type="simple"/><label>(12)</label></disp-formula>Particle MCMC can then be used to sample from the posterior density <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e080" xlink:type="simple"/></inline-formula>. Here, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e081" xlink:type="simple"/></inline-formula> contains all the parameters in the SIR model as well as the observation model parameters <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e082" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e083" xlink:type="simple"/></inline-formula>. We can infer the trajectory of any of the state variables but we limit ourselves to inferring <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e084" xlink:type="simple"/></inline-formula> so that <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e085" xlink:type="simple"/></inline-formula> stands in for the number of infected hosts from <italic>t</italic> = <italic>1</italic> to <italic>T</italic>. Likewise, the initial conditions for all the state variables could also be inferred but we do not estimate them here since they are known values in the mock data we use to test the algorithm. Technical details on the implementation of the particle MCMC algorithm used to fit the SIR model are given in <xref ref-type="supplementary-material" rid="pcbi.1002136.s002">Text S2</xref>.</p>
      </sec>
      <sec id="s2b">
        <title>Inference with a genealogy</title>
        <p>We now turn to using particle MCMC to infer model parameters and latent variables from a genealogy. For illustrative purposes, we will use the same epidemiological model as detailed above. To see how a genealogy can be used to reconstruct the past population dynamics of a disease, first imagine that every infected individual is included in an infection tree with branching times that correspond to transmission events and tip times that correspond to recovery events. In this hypothetical case, the past prevalence of the disease at any time would simply be the number of lineages present in the genealogy at that time and the likelihood of the genealogy under a given population dynamic model could easily be computed since the times at which infection and recovery events occur would be known. In reality, we cannot observe the complete genealogy but we can reconstruct a partial genealogy from sequences sampled randomly from infected individuals over time. Coalescent theory provides us with the necessary probabilistic relationship between an incomplete genealogy and the underlying population dynamics <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e086" xlink:type="simple"/></inline-formula> needed to fit a SSM to a genealogy of randomly sampled individuals. Specifically, the coalescent model will allow us to calculate the likelihood of observing a certain genealogy given the population dynamics <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e087" xlink:type="simple"/></inline-formula>, just as the observation model allowed us to calculate the likelihood of time series observations given <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e088" xlink:type="simple"/></inline-formula>.</p>
        <p>Under the standard neutral coalescent model, the times between coalescent events in a genealogy are exponentially distributed so the probability of observing a coalescent event after time <italic>t</italic> is<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e089" xlink:type="simple"/><label>(13)</label></disp-formula>where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e090" xlink:type="simple"/></inline-formula> is the rate of coalescence. For many population models, the rate of coalescence depends on the number of lineages present in the genealogy <italic>i</italic>, the effective population size <italic>N<sub>e</sub></italic>, and a factor <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e091" xlink:type="simple"/></inline-formula> that rescales generation time into calendar time, so that<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e092" xlink:type="simple"/></disp-formula>For an infectious disease, <italic>N<sub>e</sub></italic> depends on the number of infected hosts <italic>I</italic> and the variance in the number of secondary infections an infected individual causes. Genealogical time has generally been rescaled into calendar time by defining the generation time scaling factor <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e093" xlink:type="simple"/></inline-formula> as the duration of infection <xref ref-type="bibr" rid="pcbi.1002136-Drummond1">[4]</xref>, <xref ref-type="bibr" rid="pcbi.1002136-Pybus2">[19]</xref>. However, for an epidemiological model like the SIR model, the generation time of the disease is more appropriately defined as the average length of time it takes an infected individual to infect a susceptible host. Under our SIR model, the generation time is not constant over time since it depends on the rate at which infections occur, which is equal to <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e094" xlink:type="simple"/></inline-formula>. There is therefore no linear relationship that can be used to rescale genealogical time into calendar time. We therefore follow Volz <italic>et al.</italic> <xref ref-type="bibr" rid="pcbi.1002136-Volz1">[18]</xref>, and write the rate of coalescence under our SIR model as:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e095" xlink:type="simple"/><label>(14)</label></disp-formula>Equation 14 has the intuitive interpretation that the rate of coalescence is equal to the overall rate of transmission in the population multiplied by the probability of observing a transmission event in the sample fraction, which is given by the ratio of the two binomial coefficients in the leading term. In practice, we round <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e096" xlink:type="simple"/></inline-formula> to its nearest integer value when computing the rate of coalescence so that <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e097" xlink:type="simple"/></inline-formula> is always computable.</p>
        <p>The exponential probability density function given in equation 13 can be combined with the expression for the rate of coalescence for an SIR model given in equation 14 to calculate the likelihood of the waiting time between any two coalescence events as a function of the state variables in the SIR model. The total likelihood of a genealogy can therefore be obtained by dividing the genealogy into coalescent intervals and taking the product of the likelihoods over all coalescent intervals. However, to enable comparison with inference using time series, the genealogy must also be partitioned at intervals that correspond to the observation times {1∶<italic>T</italic>} in the time series. Each of these time intervals is further divided into subintervals of size <italic>dt</italic>, where <italic>dt</italic> is the time step used in the simulation of the process model, given by equations 10<italic>a</italic>–<italic>c</italic> above. We assume that these <italic>dt</italic> subintervals are sufficiently small so that the number of infected and susceptible individuals does not significantly change within a subinterval. This assumption makes the rate of coalescence constant within subintervals, allowing us to use the exponential density given in equation 13 to compute the likelihood of the genealogy over these short subintervals. In addition to these intervals and subintervals, we allow for the general case that sequence data are sampled serially over time (i.e., the genealogy is heterochronic), such that, altogether, there are four types of time points which divide the genealogy into temporal sections: ‘observation’ time points 1∶<italic>T</italic>, time points every <italic>dt</italic> between these time points, sequence sampling times, and times at which lineages coalesce. The main difference between using a genealogy instead of time series data is that the observed data <italic>z</italic><sub>t</sub> are now the vector of time subintervals <bold><italic>ω</italic></bold><sub>t</sub> between two observation time points <italic>t</italic>-1 and <italic>t</italic>, created by the <italic>dt</italic> time points, the sequence sampling times, and the coalescent times, rather than time series counts <italic>y</italic><sub>t</sub>.</p>
        <p>To compute the likelihood of the genealogy over a given time interval <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e098" xlink:type="simple"/></inline-formula>, we can first write it as a joint probability of observing each subinterval time:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e099" xlink:type="simple"/><label>(15)</label></disp-formula>Here <italic>j</italic> indexes the subinterval, and <italic>k</italic> is the number of subintervals in the observation time interval ending at time <italic>t</italic>. The likelihood of observing a subinterval time <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e100" xlink:type="simple"/></inline-formula> is simply given by equation 13 above if the subinterval ends in a coalescent event:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e101" xlink:type="simple"/><label>(16)</label></disp-formula>where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e102" xlink:type="simple"/></inline-formula> is the instantaneous rate of coalescence at time <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e103" xlink:type="simple"/></inline-formula>, which can be computed from the values of the state variables in <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e104" xlink:type="simple"/></inline-formula> using equation 14. If the subinterval does not start at a <italic>dt</italic> partition time, but instead at a coalescent event or a sampling event, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e105" xlink:type="simple"/></inline-formula> are the state variables at the closest <italic>dt</italic> partition time in the future.</p>
        <p>The probability of observing subinterval time <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e106" xlink:type="simple"/></inline-formula> if subinterval <italic>j</italic> does not end in a coalescent event is given by the probability that a coalescent event has not occurred within this time period is:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e107" xlink:type="simple"/><label>(17)</label></disp-formula>as first described by Rodrigo and Felsenstein <xref ref-type="bibr" rid="pcbi.1002136-Rodrigo1">[36]</xref>. In the context of particle MCMC, the likelihood of the genealogy over the observation interval given by equation 15 is used to weight each particle at observation time <italic>t</italic> as described above.</p>
      </sec>
      <sec id="s2c">
        <title>Inference with both time series and a genealogy</title>
        <p>Finally, we show how model parameters and past population dynamics can be inferred from both time series data and a genealogy together with particle MCMC. As before, we use the epidemiological model provided by equations 10. The joint likelihood of observing both the time series and the genealogy in the time interval between <italic>t-1</italic> and <italic>t</italic> is given by:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e108" xlink:type="simple"/><label>(18)</label></disp-formula>Assuming that the genealogy is independent of the time series data, this joint likelihood can be re-written as:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e109" xlink:type="simple"/><label>(19)</label></disp-formula>Independence can be assumed if the samples in the genealogy are drawn from the infected population independently of which infected hosts are counted in the time series data. This is generally not the case, as the samples present in the genealogy are usually taken from a subset of infected hosts who are counted in the time series data. However, in our case, the fraction of infections counted in the time series data and the fraction present in the genealogy are both chosen at random. Therefore, the joint likelihood of observing both sets of data at time <italic>t</italic>, given the model and parameters <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e110" xlink:type="simple"/></inline-formula>, is given by the product of equation 11 and equation 15. In the context of particle MCMC, the unnormalized weight assigned to each particle is then the joint likelihood given in equation 19.</p>
      </sec>
    </sec>
    <sec id="s3">
      <title>Results</title>
      <p>To illustrate the ability of the particle MCMC algorithm to estimate model parameters <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e111" xlink:type="simple"/></inline-formula> and the latent state variables <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e112" xlink:type="simple"/></inline-formula> from time series data, we simulated a mock dataset using the SIR process model. <xref ref-type="fig" rid="pcbi-1002136-g001">Figure 1A</xref> shows the simulated dynamics of the latent variable <italic>I</italic> over time. <xref ref-type="fig" rid="pcbi-1002136-g001">Figure 1B</xref> shows the mock incidence data <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e113" xlink:type="simple"/></inline-formula> that are drawn using simulated <italic>c</italic> values (i.e. the cumulative incidence) and the distribution given in equation 11 to add normally distributed observation noise. The posterior densities of the process and observation model parameters inferred from the mock time series are shown in <xref ref-type="fig" rid="pcbi-1002136-g002">Figure 2A–D</xref>. As shown, the algorithm provided accurate estimates of the SIR process model parameters, with the true parameter values generally falling well within the 95% Bayesian credible intervals (CI). For the parameters of the observation model, we were able to accurately estimate the reporting rate <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e114" xlink:type="simple"/></inline-formula> but found the observation variance <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e115" xlink:type="simple"/></inline-formula> more difficult to estimate (<xref ref-type="fig" rid="pcbi-1002136-g002">Figure 2E–F</xref>). The series of posterior densities for the latent variable <italic>I</italic> (i.e. the prevalence of the disease over time) show that the algorithm accurately estimated the dynamics of latent variables (<xref ref-type="fig" rid="pcbi-1002136-g003">Figure 3A</xref>). The wider CI for the prevalence during seasonal peaks in prevalence relative to the offseason reflects the fact that environmental noise scales with the rate of transmission in our model, which is larger when prevalence is high.</p>
      <fig id="pcbi-1002136-g001" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pcbi.1002136.g001</object-id>
        <label>Figure 1</label>
        <caption>
          <title>Simulated infection dynamics and time series used to test the particle MCMC algorithm.</title>
          <p>(<bold>A</bold>) Disease dynamics (<italic>I</italic>) obtained by simulating from the SIR process model (equations 10) over a 4-year period. (<bold>B</bold>) Corresponding time series of monthly incidence reports simulated from the observation model (equation 11). Parameters used in the simulation of the process model were: <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e116" xlink:type="simple"/></inline-formula> = 3/month, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e117" xlink:type="simple"/></inline-formula> = 10, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e118" xlink:type="simple"/></inline-formula> = 0.16, and <italic>F</italic> = 0.012. Other process model parameters that were assumed to be known were: <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e119" xlink:type="simple"/></inline-formula> = 0.0017/month, and <italic>N</italic> = 5 million. Parameters used in the simulation of the time series data were: <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e120" xlink:type="simple"/></inline-formula> = 0.43, and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e121" xlink:type="simple"/></inline-formula> = 15.</p>
        </caption>
        <graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002136.g001" xlink:type="simple"/>
      </fig>
      <fig id="pcbi-1002136-g002" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pcbi.1002136.g002</object-id>
        <label>Figure 2</label>
        <caption>
          <title>Posterior densities of estimated model parameters.</title>
          <p>Frequency histograms representing the marginal posterior densities of the SIR model parameters obtained using the particle MCMC algorithm. Vertical blue lines are placed at the true values of the parameters, solid red lines are the median value of the posterior densities and dashed red lines mark the 95% Bayesian credible intervals. From left to right, the parameters are the recovery rate <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e122" xlink:type="simple"/></inline-formula>, the basic reproduction number <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e123" xlink:type="simple"/></inline-formula>, the strength of seasonality <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e124" xlink:type="simple"/></inline-formula>, the parameter scaling the strength of environmental noise <italic>F</italic>, the reporting rate <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e125" xlink:type="simple"/></inline-formula>, and the observation variance <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e126" xlink:type="simple"/></inline-formula>. (<bold>A–F</bold>) Parameters inferred using time series data. (<bold>G–J</bold>) Parameters inferred using a genealogy. Parameters <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e127" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e128" xlink:type="simple"/></inline-formula> cannot be inferred using only a genealogy because they are parameters associated with the time series observation model. (<bold>K–P</bold>) Parameters inferred using both a genealogy and time series.</p>
        </caption>
        <graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002136.g002" xlink:type="simple"/>
      </fig>
      <fig id="pcbi-1002136-g003" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pcbi.1002136.g003</object-id>
        <label>Figure 3</label>
        <caption>
          <title>Posterior densities for disease prevalence over time.</title>
          <p>Series of posterior densities for disease prevalence <italic>I</italic> over time obtained using particle MCMC. Blue lines represent the exact simulated prevalence, black lines are the median of the posterior density and dashed red lines represent the 95% credible intervals. (<bold>A</bold>) Prevalence inferred from time series data. (<bold>B</bold>) Prevalence inferred from a genealogy. (<bold>C</bold>) Prevalence inferred from both a genealogy and time series.</p>
        </caption>
        <graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002136.g003" xlink:type="simple"/>
      </fig>
      <p>We also tested the ability of the particle MCMC algorithm to infer parameters and past dynamics directly from genealogies. We obtained mock genealogies from our population dynamic simulations by tracking the ancestry of infections in the population and recording times at which infection and recovery events occurred. A subset of infection lineages were then randomly sampled at random times and their ancestry traced backwards through time so that transmission events correspond to coalescence events among the sampled lineages. We first checked if the coalescent model could be used to provide accurate and unbiased estimates of epidemiological parameters from genealogies. To check for possible biases, we tested the algorithm using epidemic dynamics with parameter values that lead to an epidemic unfolding and ending within a 12-month period. The shorter length of these simulations allowed us to check the performance of the algorithm using genealogies obtained from simulating the epidemic dynamics 100 times. As can be seen from <xref ref-type="fig" rid="pcbi-1002136-g004">Figure 4A–B</xref>, the epidemiological parameters <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e129" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e130" xlink:type="simple"/></inline-formula> could be accurately estimated from the genealogies. However, we found it difficult to estimate the environmental noise term <italic>F</italic> from genealogies over such a short time period, so we fixed <italic>F</italic> at its true value. <xref ref-type="fig" rid="pcbi-1002136-g004">Figure 4C</xref> shows the distribution of the estimated median values of the posterior densities of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e131" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e132" xlink:type="simple"/></inline-formula> in parameter space for all 100 simulations. In spite of the strong negative correlation between these two parameters, the estimates cluster around the true parameter values, with the true values of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e133" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e134" xlink:type="simple"/></inline-formula> falling within the estimated 95% credible intervals 90 and 92 times out of the 100 simulations, respectively.</p>
      <fig id="pcbi-1002136-g004" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pcbi.1002136.g004</object-id>
        <label>Figure 4</label>
        <caption>
          <title>Posterior densities of parameters under epidemic conditions.</title>
          <p>Posterior densities of the parameters <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e135" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e136" xlink:type="simple"/></inline-formula> estimated from 100 independent genealogies obtained from simulated epidemic dynamics. (<bold>A–B</bold>) Frequency histograms representing the marginal posterior densities of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e137" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e138" xlink:type="simple"/></inline-formula> obtained from a single representative simulation. (<bold>C</bold>) The distribution of the median values of the posterior densities of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e139" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e140" xlink:type="simple"/></inline-formula> in parameter space for all 100 simulations (open red circles). The solid blue circle marks the true values of the parameters. Note that in our model formulation, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e141" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e142" xlink:type="simple"/></inline-formula> are independent parameters, with the transmission rate computed as <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e143" xlink:type="simple"/></inline-formula>.</p>
        </caption>
        <graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002136.g004" xlink:type="simple"/>
      </fig>
      <p>Since we were able to obtain accurate parameter estimates from genealogies under simple epidemic conditions, we next tested the ability of the particle MCMC algorithm to estimate parameters and latent state variables from genealogies under more complex population dynamics. To do this, we generated a mock genealogy containing 200 terminal nodes from the same population dynamic simulation shown in <xref ref-type="fig" rid="pcbi-1002136-g001">Figure 1</xref>. The mock genealogy is shown in <xref ref-type="fig" rid="pcbi-1002136-g005">Figure 5</xref>. The posterior densities of the process model parameters inferred from the mock genealogy show that our method could accurately recover the values of the epidemiological parameters (<xref ref-type="fig" rid="pcbi-1002136-g002">Figure 2G–J</xref>). The series of posterior densities for the latent variable <italic>I</italic> over time likewise show that our method can accurately estimate past disease dynamics from a genealogy (<xref ref-type="fig" rid="pcbi-1002136-g003">Figure 3B</xref>). This is highly encouraging, as it suggests that both model parameters and past population dynamics can be accurately estimated from a genealogy even in the absence of any time series data as long as the number of sequences sampled over time is sufficiently large.</p>
      <fig id="pcbi-1002136-g005" position="float">
        <object-id pub-id-type="doi">10.1371/journal.pcbi.1002136.g005</object-id>
        <label>Figure 5</label>
        <caption>
          <title>Simulated genealogy used to test the particle MCMC algorithm.</title>
          <p>Genealogy obtained from the simulated disease dynamics shown in <xref ref-type="fig" rid="pcbi-1002136-g001">Figure 1A</xref>. The genealogy contains 200 terminal nodes corresponding to sequence samples being collected sequentially over time with yearly sample sizes of approximately 50 sequences. Sampling events were chosen to occur at random times over the entire interval of the times series.</p>
        </caption>
        <graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002136.g005" xlink:type="simple"/>
      </fig>
      <p>Although the credible intervals for the process model parameters and past disease dynamics are wider when using the genealogy than when using the time series data, the width of the credible intervals likely depends heavily on the sampling effort. We therefore investigated a range of sample sizes to explore how different sample sizes affect the accuracy of and uncertainty associated with our estimates. Summary statistics for the posterior densities of the parameters and past prevalence of the disease are given in <xref ref-type="table" rid="pcbi-1002136-t001">Table 1</xref>. Even with small sample sizes, reasonable estimates were obtained and the loss of accuracy in estimating parameters was most likely due to the difficulty of estimating the environmental noise term <italic>F</italic>, which is strongly correlated with other parameters, when the sample size was small. If the sample size is initially small, including more samples dramatically improves the accuracy and reduces the level of uncertainty in parameter estimates. However, going from an intermediate number of samples (∼100–200) to a large number of samples (∼400) does not dramatically improve estimates, suggesting only a moderate amount of sequence data is required for accurate inferences to be drawn from genealogies. Similar results were obtained for estimates of the past prevalence of the disease. We quantified the effect of including more sequence data by computing the root mean squared deviation (RMSD) of the inferred median of the posterior densities of disease prevalence from the true prevalence values. Increasing the number of samples initially reduces the RMSD but including more samples provides no further advantage once a sufficient number of samples are included.</p>
      <table-wrap id="pcbi-1002136-t001" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1002136.t001</object-id><label>Table 1</label><caption>
          <title>Median posterior values and 95% credible intervals for the parameters and past disease dynamics inferred from genealogies with different numbers of samples.</title>
        </caption><!--===== Grouping alternate versions of objects =====--><alternatives><graphic id="pcbi-1002136-t001-1" mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002136.t001" xlink:type="simple"/><table>
          <colgroup span="1">
            <col align="left" span="1"/>
            <col align="center" span="1"/>
            <col align="center" span="1"/>
            <col align="center" span="1"/>
            <col align="center" span="1"/>
            <col align="center" span="1"/>
          </colgroup>
          <thead>
            <tr>
              <td align="left" colspan="1" rowspan="1">Sample Size</td>
              <td align="left" colspan="1" rowspan="1">
                <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e144" xlink:type="simple"/></inline-formula>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e145" xlink:type="simple"/></inline-formula>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e146" xlink:type="simple"/></inline-formula>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1002136.e147" xlink:type="simple"/></inline-formula>
              </td>
              <td align="left" colspan="1" rowspan="1">
                <italic>Prevalence RMSD</italic>
                <xref ref-type="table-fn" rid="nt101">*</xref>
              </td>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td align="left" colspan="1" rowspan="1">40</td>
              <td align="left" colspan="1" rowspan="1">2.36 [1.06, 4.18]</td>
              <td align="left" colspan="1" rowspan="1">3.66 [1.21, 10.12]</td>
              <td align="left" colspan="1" rowspan="1">0.25 [0.09, 0.51]</td>
              <td align="left" colspan="1" rowspan="1">0.56 [0.03, 1.78]</td>
              <td align="left" colspan="1" rowspan="1">244.77</td>
            </tr>
            <tr>
              <td align="left" colspan="1" rowspan="1">100</td>
              <td align="left" colspan="1" rowspan="1">2.94 [2.28, 3.95]</td>
              <td align="left" colspan="1" rowspan="1">8.74 [3.97, 10.71]</td>
              <td align="left" colspan="1" rowspan="1">0.19 [0.10, 0.32]</td>
              <td align="left" colspan="1" rowspan="1">0.14 [0.02, 0.51]</td>
              <td align="left" colspan="1" rowspan="1">93.23</td>
            </tr>
            <tr>
              <td align="left" colspan="1" rowspan="1">200</td>
              <td align="left" colspan="1" rowspan="1">3.05 [2.68, 3.39]</td>
              <td align="left" colspan="1" rowspan="1">10.02 [9.37, 10.41]</td>
              <td align="left" colspan="1" rowspan="1">0.15 [0.11, 0.21]</td>
              <td align="left" colspan="1" rowspan="1">0.016 [0.001, 0.092]</td>
              <td align="left" colspan="1" rowspan="1">39.55</td>
            </tr>
            <tr>
              <td align="left" colspan="1" rowspan="1">400</td>
              <td align="left" colspan="1" rowspan="1">3.00 [2.71, 3.29]</td>
              <td align="left" colspan="1" rowspan="1">10.03 [8.42, 10.43]</td>
              <td align="left" colspan="1" rowspan="1">0.16 [0.12, 0.20]</td>
              <td align="left" colspan="1" rowspan="1">0.026 [0.001, 0.141]</td>
              <td align="left" colspan="1" rowspan="1">73.89</td>
            </tr>
            <tr>
              <td align="left" colspan="1" rowspan="1">
                <bold>True Value</bold>
              </td>
              <td align="left" colspan="1" rowspan="1">3.00</td>
              <td align="left" colspan="1" rowspan="1">10.00</td>
              <td align="left" colspan="1" rowspan="1">0.16</td>
              <td align="left" colspan="1" rowspan="1">0.012</td>
              <td align="left" colspan="1" rowspan="1"/>
            </tr>
          </tbody>
        </table></alternatives><table-wrap-foot>
          <fn id="nt101">
            <label/>
            <p>*Root Mean Squared Deviation (RMSD) for the prevalence was calculated using the deviation of the median of the posterior density from the true value summed over all time points.</p>
          </fn>
        </table-wrap-foot></table-wrap>
      <p>Finally, we combined the simulated time series and genealogy to illustrate the ability of particle MCMC to be used with both sources of data. In <xref ref-type="fig" rid="pcbi-1002136-g002">Figure 2K–P</xref>, we show the posterior densities of the parameters when inferred from both the time series and a genealogy. In <xref ref-type="fig" rid="pcbi-1002136-g003">Figure 3C</xref>, we show the series of posterior densities for the latent variable <italic>I</italic> over time inferred from both the time series data and the genealogy. As shown, including the genealogy along with the time series data considerably reduces the uncertainty in both the estimates of the process model parameters and the past prevalence of the disease.</p>
    </sec>
    <sec id="s4">
      <title>Discussion</title>
      <p>The framework we have developed extends phylodynamic inference in two major ways. First, stochastic state-space models that consider the biological processes driving population dynamics can be used instead of simple parametric or nonparametric demographic models when inferring past population dynamics. This also allows for key epidemiological parameters to be estimated directly from genealogies. Second, our approach allows for other sources of data such as time series to be considered along with a genealogy when inferring parameters and past population dynamics. Using a particle MCMC algorithm to fit a stochastic SIR model to simulated genealogies and time series data, we found that key epidemiological parameters as well as the past prevalence of the disease could be accurately estimated from genealogies with or without accompanying time series data.</p>
      <p>While particle MCMC is computationally expensive because of the need to simulate particle trajectories each MCMC step, we believe it represents a good choice for the purposes of phylodynamic inference. First, particle MCMC allows for efficient MCMC sampling of model parameters and latent variables from their posterior densities even with high-dimensional, nonlinear SSMs. Secondly, particle MCMC is flexible in terms of the form of the SSMs that can be used. Because the particle filtering algorithm used in particle MCMC can be used to approximate the likelihood of the model through simulations, there is no need for an analytical likelihood function. Taken together, this allows for almost any infectious disease model to be used as long as particle trajectories can be simulated from the process model and an observation or coalescent model can be specified <xref ref-type="bibr" rid="pcbi.1002136-Breto1">[23]</xref>, <xref ref-type="bibr" rid="pcbi.1002136-Cappe1">[31]</xref>, <xref ref-type="bibr" rid="pcbi.1002136-Doucet1">[32]</xref>. For example, several researchers including us here have used particle filtering methods to fit stochastic, continuous-time dynamic models to time series, even though observations occur only at discrete time points <xref ref-type="bibr" rid="pcbi.1002136-Ionides1">[25]</xref>, <xref ref-type="bibr" rid="pcbi.1002136-He1">[37]</xref>, <xref ref-type="bibr" rid="pcbi.1002136-King1">[38]</xref>. Finally, particle MCMC allows for flexibility in terms of the types and structure of the data. As we have shown, fitting dynamic models to different sources of data is straightforward since only the particle weighting scheme needs to be modified. We therefore believe that the computational cost of particle MCMC is outweighed by its flexibility and ease of implementation for most practical purposes in phylodynamics. Still, the efficiency of other statistical methodologies such as approximate Bayesian computation (ABC, see <xref ref-type="bibr" rid="pcbi.1002136-Beaumont1">[39]</xref>) should be compared against particle MCMC in the future to see if the computational overhead of conducting phylodyamic inference with complex models can be reduced.</p>
      <p>The particle MCMC approach described here is also able to incorporate different forms of stochasticity, which is essential for fitting the variation, or over-dispersion, present in real disease data. For simplicity, we only included environmental noise in the transmission process – random variation in the rate at which transmission events occur due to external factors like climatic fluctuations. However, other forms of stochasticity could also be included such as demographic stochasticity – random variation in the timing of demographic events such as the birth and death of individuals. We did not consider demographic stochasticity because it involves event-driven simulation approaches that are much more computationally expensive than the Euler-Maruyama algorithm we used. However, for small populations where demographic stochasticity can play an important dynamical role, other simulation methods could be employed within the particle filtering algorithm. For example, Breto <italic>et al.</italic> <xref ref-type="bibr" rid="pcbi.1002136-Breto1">[23]</xref> recently introduced a simulation method that can include both environmental and demographic stochasticity. While what form of stochasticity is appropriate will be system-dependent, the need for statistical methods that include stochasticity when fitting models to disease data has been demonstrated repeatedly <xref ref-type="bibr" rid="pcbi.1002136-Rohani1">[22]</xref>, <xref ref-type="bibr" rid="pcbi.1002136-Breto1">[23]</xref>, <xref ref-type="bibr" rid="pcbi.1002136-He1">[37]</xref>. The particle MCMC approach therefore offers an advantage over other methods for phylodynamic inference that can only be used to fit deterministic models.</p>
      <p>The ability to accurately infer past population dynamics or model parameters from genealogies ultimately depends on how sequences are sampled. Since we were primarily concerned with statistical methodology, we did not extensively explore different sampling strategies and simply considered the case where sequences are sampled randomly over time. However, we did find that only a moderate number of sequences are necessary to obtain reliable parameter estimates. Even when the sampling rate was as low as 10 samples per year, reliable estimates were obtained. Likewise, extremely large sample sizes did not significantly improve estimates, suggesting phylodynamic inference can be conducted without extensive sampling over time. Furthermore, even fewer samples may be necessary if sequences are sampled strategically. For example, in a simulation study, Stack <italic>et al.</italic> <xref ref-type="bibr" rid="pcbi.1002136-Stack1">[40]</xref> found that accurate estimates of past population dynamics could be obtained using a variety of sampling protocols and that especially reliable estimates could be obtained if sequences are sampled towards the end of an epidemic rather than at the beginning of an epidemic. Our phylodynamic inference framework should therefore be able to give reliable estimates even if the sampling effort is not uniformly high over time.</p>
      <p>We were also interested in when including the information contained within a genealogy alongside of time series date could improve estimation. At the most basic level, considering a genealogy where the coalescence times are known without error provides additional information in that the timing of coalescence events provides information about when transmission events occurred that is not present in temporally aggregated case report data. One could even imagine that knowing the complete genealogy of infections in the population would be preferable to having perfect case report data, since the exact times of infection will still not be known. In practice, we found that considering the genealogy alongside of time series data only significantly improved our estimates if there was observation error in the time series data. For example, the parameters estimated from the time series data with and without the genealogy in <xref ref-type="fig" rid="pcbi-1002136-g002">Figure 2</xref> were done with a moderate level of observation error in the mock time series data. However, from our own experience, including the genealogy when there were low levels of observation error in the mock time series data did not significantly improve our estimates (results not shown). We therefore suspect that it will be helpful to include genealogical data only when the observed time series data are relatively uninformative about the true disease dynamics, such as when there is large degree of error in the case report data or when case report data are missing. Genealogies may also aid inference if aspects of the population dynamics such as periodicity or other long-term trends in disease dynamics are obscured by changes in reporting practices.</p>
      <p>While we have shown that it is possible to fit complex population dynamic models to simulated genealogies, several challenges remain before this approach can be routinely applied to real data sets. First, while we conditioned our inference on knowing the true genealogy without error, the genealogy will have to be inferred from sequence data in any application of our method. Our uncertainty as to the true topology of the genealogy and the inferred coalescence times will then have to be considered. Fortunately, existing phylogenetic software packages like BEAST allow us to sample from the posterior distribution of trees so as to effectively integrate out phylogenetic uncertainty <xref ref-type="bibr" rid="pcbi.1002136-Drummond2">[41]</xref>. Furthermore, programs like BEAST also use an MCMC framework making it possible to estimate population dynamic parameters, the genealogy and the associated molecular evolutionary parameters together in a single MCMC framework by alternately sampling from the appropriate posterior densities.</p>
      <p>Another challenge lies in formulating appropriate models for relating population dynamics to the reconstructed genealogy. The coalescent model we used may not be appropriate for all infectious diseases, just as the simple SIR model we used will not be adequate to describe the population dynamics of all diseases. For one, our coalescent model assumes neutrality with no phenotypic variation in the pathogen population, but real populations will be structured into multiple competing strains with varying antigenicity, pathogenicity and replication rates. Beyond selection, the natural history of a disease and heterogeneities due to population subdivision or contact structure can also have profound effects on genealogies <xref ref-type="bibr" rid="pcbi.1002136-ODea1">[42]</xref>, <xref ref-type="bibr" rid="pcbi.1002136-Wakeley1">[43]</xref>. Likewise, sequence samples will often not be sampled randomly as assumed under standard coalescent models, leading to potential ascertainment biases if nonrandom sampling is not incorporated into coalescent models. However, the framework for phylodynamic inference presented here is extremely flexible and can be modified to accommodate more realistic population dynamic and coalescent models to account for these complications. For example, it should be possible to derive coalescent expressions for models with individual heterogeneity in infectivity and for SEIR models where infected individuals enter an exposed class before becoming infectious. Finally, when there are discrepancies between the disease dynamics inferred from genealogies and those observed in case report data, the ability to test different population dynamic and coalescent models in a coherent statistical framework will allow us to consider alternative hypotheses for what caused these discrepancies. This in turn should help improve our understanding of the complex ecological and evolutionary processes driving population dynamics — the central goal of phylodynamics <xref ref-type="bibr" rid="pcbi.1002136-Grenfell1">[44]</xref>, <xref ref-type="bibr" rid="pcbi.1002136-Holmes1">[45]</xref>.</p>
    </sec>
    <sec id="s5">
      <title>Supporting Information</title>
      <supplementary-material id="pcbi.1002136.s001" mimetype="application/msword" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002136.s001" xlink:type="simple">
        <label>Text S1</label>
        <caption>
          <p>Pseudo-code for particle MCMC.</p>
          <p>(DOC)</p>
        </caption>
      </supplementary-material>
      <supplementary-material id="pcbi.1002136.s002" mimetype="application/msword" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1002136.s002" xlink:type="simple">
        <label>Text S2</label>
        <caption>
          <p>A description of the specific particle MCMC implementation used for the SIR epidemiological model.</p>
          <p>(DOC)</p>
        </caption>
      </supplementary-material>
    </sec>
  </body>
  <back>
    <ack>
      <p>We thank Allen Rodrigo for helpful advice and discussions and Andrea Richter for sharing her particle filtering code.</p>
    </ack>
    <ref-list>
      <title>References</title>
      <ref id="pcbi.1002136-Cauchemez1">
        <label>1</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Cauchemez</surname><given-names>S</given-names></name><name name-style="western"><surname>Ferguson</surname><given-names>NM</given-names></name></person-group>             <year>2008</year>             <article-title>Likelihood-based estimation of continuous-time epidemic models from time-series data: application to measles transmission in London.</article-title>             <source>J R Soc Interface</source>             <volume>5</volume>             <fpage>885</fpage>             <lpage>897</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-ONeill1">
        <label>2</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>O'Neill</surname><given-names>PD</given-names></name></person-group>             <year>2010</year>             <article-title>Introduction and snapshot review: Relating infectious disease transmission models to data.</article-title>             <source>Stat Med</source>             <volume>29</volume>             <fpage>2069</fpage>             <lpage>2077</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-ONeill2">
        <label>3</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>O'Neill</surname><given-names>PD</given-names></name><name name-style="western"><surname>Roberts</surname><given-names>GO</given-names></name></person-group>             <year>1999</year>             <article-title>Bayesian inference for partially observed stochastic epidemics.</article-title>             <source>J Roy Stat Soc A Sta</source>             <volume>162</volume>             <fpage>121</fpage>             <lpage>129</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-Drummond1">
        <label>4</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Drummond</surname><given-names>AJ</given-names></name><name name-style="western"><surname>Rambaut</surname><given-names>A</given-names></name><name name-style="western"><surname>Shapiro</surname><given-names>B</given-names></name><name name-style="western"><surname>Pybus</surname><given-names>OG</given-names></name></person-group>             <year>2005</year>             <article-title>Bayesian coalescent inference of past population dynamics from molecular sequences.</article-title>             <source>Mol Biol Evol</source>             <volume>22</volume>             <fpage>1185</fpage>             <lpage>1192</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-Kuhner1">
        <label>5</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Kuhner</surname><given-names>MK</given-names></name><name name-style="western"><surname>Yamato</surname><given-names>J</given-names></name><name name-style="western"><surname>Felsenstein</surname><given-names>J</given-names></name></person-group>             <year>1998</year>             <article-title>Maximum likelihood estimation of population growth rates based on the coalescent.</article-title>             <source>Genetics</source>             <volume>149</volume>             <fpage>429</fpage>             <lpage>434</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-Minin1">
        <label>6</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Minin</surname><given-names>VN</given-names></name><name name-style="western"><surname>Bloomquist</surname><given-names>EW</given-names></name><name name-style="western"><surname>Suchard</surname><given-names>MA</given-names></name></person-group>             <year>2008</year>             <article-title>Smooth skyride through a rough skyline: Bayesian coalescent-based inference of population dynamics.</article-title>             <source>Mol Biol Evol</source>             <volume>25</volume>             <fpage>1459</fpage>             <lpage>1471</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-Strimmer1">
        <label>7</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Strimmer</surname><given-names>K</given-names></name><name name-style="western"><surname>Pybus</surname><given-names>OG</given-names></name></person-group>             <year>2001</year>             <article-title>Exploring the demographic history of DNA sequences using the generalized skyline plot.</article-title>             <source>Mol Biol Evol</source>             <volume>18</volume>             <fpage>2298</fpage>             <lpage>2305</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-Hudson1">
        <label>8</label>
        <element-citation publication-type="other" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Hudson</surname><given-names>RR</given-names></name></person-group>             <year>1991</year>             <article-title>Gene genealogies and the coalescent process.</article-title>             <person-group person-group-type="editor"><name name-style="western"><surname>Futuyma</surname><given-names>DJ</given-names></name><name name-style="western"><surname>Antonovics</surname><given-names>J</given-names></name></person-group>             <source>Oxford Surveys in Evolutionary Biology: Oxford University Press</source>             <fpage>1</fpage>             <lpage>44</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-Pybus1">
        <label>9</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Pybus</surname><given-names>OG</given-names></name><name name-style="western"><surname>Charleston</surname><given-names>MA</given-names></name><name name-style="western"><surname>Gupta</surname><given-names>S</given-names></name><name name-style="western"><surname>Rambaut</surname><given-names>A</given-names></name><name name-style="western"><surname>Holmes</surname><given-names>EC</given-names></name><etal/></person-group>             <year>2001</year>             <article-title>The epidemic behavior of the hepatitis C virus.</article-title>             <source>Science</source>             <volume>292</volume>             <fpage>2323</fpage>             <lpage>2325</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-Griffiths1">
        <label>10</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Griffiths</surname><given-names>RC</given-names></name><name name-style="western"><surname>Tavare</surname><given-names>S</given-names></name></person-group>             <year>1994</year>             <article-title>Sampling theory for neutral alleles in a varying environment.</article-title>             <source>Philos T Roy Soc B</source>             <volume>344</volume>             <fpage>403</fpage>             <lpage>410</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-Nee1">
        <label>11</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Nee</surname><given-names>S</given-names></name><name name-style="western"><surname>Holmes</surname><given-names>EC</given-names></name><name name-style="western"><surname>Rambaut</surname><given-names>A</given-names></name><name name-style="western"><surname>Harvey</surname><given-names>PH</given-names></name></person-group>             <year>1995</year>             <article-title>Inferring Population History from Molecular Phylogenies.</article-title>             <source>Philos T Roy Soc B</source>             <volume>349</volume>             <fpage>25</fpage>             <lpage>31</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-Carrington1">
        <label>12</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Carrington</surname><given-names>CVF</given-names></name><name name-style="western"><surname>Foster</surname><given-names>JE</given-names></name><name name-style="western"><surname>Pybus</surname><given-names>OG</given-names></name><name name-style="western"><surname>Bennett</surname><given-names>SN</given-names></name><name name-style="western"><surname>Holmes</surname><given-names>EC</given-names></name></person-group>             <year>2005</year>             <article-title>Invasion and maintenance of Dengue virus type 2 and type 4 in the Americas.</article-title>             <source>J Virol</source>             <volume>79</volume>             <fpage>14680</fpage>             <lpage>14687</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-Fraser1">
        <label>13</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Fraser</surname><given-names>C</given-names></name><name name-style="western"><surname>Donnelly</surname><given-names>CA</given-names></name><name name-style="western"><surname>Cauchemez</surname><given-names>S</given-names></name><name name-style="western"><surname>Hanage</surname><given-names>WP</given-names></name><name name-style="western"><surname>Van Kerkhove</surname><given-names>MD</given-names></name><etal/></person-group>             <year>2009</year>             <article-title>Pandemic Potential of a Strain of Influenza A (H1N1): Early Findings.</article-title>             <source>Science</source>             <volume>324</volume>             <fpage>1557</fpage>             <lpage>1561</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-Lemey1">
        <label>14</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Lemey</surname><given-names>P</given-names></name><name name-style="western"><surname>Pybus</surname><given-names>OG</given-names></name><name name-style="western"><surname>Rambaut</surname><given-names>A</given-names></name><name name-style="western"><surname>Drummond</surname><given-names>AJ</given-names></name><name name-style="western"><surname>Robertson</surname><given-names>DL</given-names></name><etal/></person-group>             <year>2004</year>             <article-title>The molecular population genetics of HIV-1 group O.</article-title>             <source>Genetics</source>             <volume>167</volume>             <fpage>1059</fpage>             <lpage>1068</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-Bennett1">
        <label>15</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Bennett</surname><given-names>SN</given-names></name><name name-style="western"><surname>Drummond</surname><given-names>AJ</given-names></name><name name-style="western"><surname>Kapan</surname><given-names>DD</given-names></name><name name-style="western"><surname>Suchard</surname><given-names>MA</given-names></name><name name-style="western"><surname>Munoz-Jordan</surname><given-names>JL</given-names></name><etal/></person-group>             <year>2010</year>             <article-title>Epidemic Dynamics Revealed in Dengue Evolution.</article-title>             <source>Mol Biol Evol</source>             <volume>27</volume>             <fpage>811</fpage>             <lpage>818</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-Rambaut1">
        <label>16</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Rambaut</surname><given-names>A</given-names></name><name name-style="western"><surname>Pybus</surname><given-names>OG</given-names></name><name name-style="western"><surname>Nelson</surname><given-names>MI</given-names></name><name name-style="western"><surname>Viboud</surname><given-names>C</given-names></name><name name-style="western"><surname>Taubenberger</surname><given-names>JK</given-names></name><etal/></person-group>             <year>2008</year>             <article-title>The genomic and epidemiological dynamics of human influenza A virus.</article-title>             <source>Nature</source>             <volume>453</volume>             <fpage>615-U612</fpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-Siebenga1">
        <label>17</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Siebenga</surname><given-names>JJ</given-names></name><name name-style="western"><surname>Lemey</surname><given-names>P</given-names></name><name name-style="western"><surname>Pond</surname><given-names>SLK</given-names></name><name name-style="western"><surname>Rambaut</surname><given-names>A</given-names></name><name name-style="western"><surname>Vennema</surname><given-names>H</given-names></name><etal/></person-group>             <year>2010</year>             <article-title>Phylodynamic Reconstruction Reveals Norovirus GII. 4 Epidemic Expansions and their Molecular Determinants.</article-title>             <source>Plos Pathog</source>             <volume>6</volume>             <fpage>e1000884</fpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-Volz1">
        <label>18</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Volz</surname><given-names>EM</given-names></name><name name-style="western"><surname>Pond</surname><given-names>SLK</given-names></name><name name-style="western"><surname>Ward</surname><given-names>MJ</given-names></name><name name-style="western"><surname>Brown</surname><given-names>AJL</given-names></name><name name-style="western"><surname>Frost</surname><given-names>SDW</given-names></name></person-group>             <year>2009</year>             <article-title>Phylodynamics of Infectious Disease Epidemics.</article-title>             <source>Genetics</source>             <volume>183</volume>             <fpage>1421</fpage>             <lpage>1430</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-Pybus2">
        <label>19</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Pybus</surname><given-names>OG</given-names></name><name name-style="western"><surname>Rambaut</surname><given-names>A</given-names></name><name name-style="western"><surname>Harvey</surname><given-names>PH</given-names></name></person-group>             <year>2000</year>             <article-title>An integrated framework for the inference of viral population history from reconstructed genealogies.</article-title>             <source>Genetics</source>             <volume>155</volume>             <fpage>1429</fpage>             <lpage>1437</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-Coulson1">
        <label>20</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Coulson</surname><given-names>T</given-names></name><name name-style="western"><surname>Rohani</surname><given-names>P</given-names></name><name name-style="western"><surname>Pascual</surname><given-names>M</given-names></name></person-group>             <year>2004</year>             <article-title>Skeletons, noise and population growth: the end of an old debate?</article-title>             <source>Trends Ecol Evol</source>             <volume>19</volume>             <fpage>359</fpage>             <lpage>364</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-Earn1">
        <label>21</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Earn</surname><given-names>DJD</given-names></name><name name-style="western"><surname>Rohani</surname><given-names>P</given-names></name><name name-style="western"><surname>Bolker</surname><given-names>BM</given-names></name><name name-style="western"><surname>Grenfell</surname><given-names>BT</given-names></name></person-group>             <year>2000</year>             <article-title>A simple model for complex dynamical transitions in epidemics.</article-title>             <source>Science</source>             <volume>287</volume>             <fpage>667</fpage>             <lpage>670</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-Rohani1">
        <label>22</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Rohani</surname><given-names>P</given-names></name><name name-style="western"><surname>Keeling</surname><given-names>MJ</given-names></name><name name-style="western"><surname>Grenfell</surname><given-names>BT</given-names></name></person-group>             <year>2002</year>             <article-title>The interplay between determinism and stochasticity in childhood diseases.</article-title>             <source>Am Nat</source>             <volume>159</volume>             <fpage>469</fpage>             <lpage>481</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-Breto1">
        <label>23</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Breto</surname><given-names>C</given-names></name><name name-style="western"><surname>He</surname><given-names>DH</given-names></name><name name-style="western"><surname>Ionides</surname><given-names>EL</given-names></name><name name-style="western"><surname>King</surname><given-names>AA</given-names></name></person-group>             <year>2009</year>             <article-title>Time Series Analysis Via Mechanistic Models.</article-title>             <source>Ann Appl Stat</source>             <volume>3</volume>             <fpage>319</fpage>             <lpage>348</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-Finkenstadt1">
        <label>24</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Finkenstadt</surname><given-names>B</given-names></name><name name-style="western"><surname>Grenfell</surname><given-names>B</given-names></name></person-group>             <year>2000</year>             <article-title>Time series modeling of childhood disease: a dynamical systems approach.</article-title>             <source>Appl Stat-J Roy St C</source>             <volume>49</volume>             <fpage>187</fpage>             <lpage>205</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-Ionides1">
        <label>25</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Ionides</surname><given-names>EL</given-names></name><name name-style="western"><surname>Breto</surname><given-names>C</given-names></name><name name-style="western"><surname>King</surname><given-names>AA</given-names></name></person-group>             <year>2006</year>             <article-title>Inference for nonlinear dynamical systems.</article-title>             <source>Proc Natl Acad Sci USA</source>             <volume>103</volume>             <fpage>18438</fpage>             <lpage>18443</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-Andrieu1">
        <label>26</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Andrieu</surname><given-names>C</given-names></name><name name-style="western"><surname>Doucet</surname><given-names>A</given-names></name><name name-style="western"><surname>Holenstein</surname><given-names>R</given-names></name></person-group>             <year>2010</year>             <article-title>Particle Markov chain Monte Carlo methods.</article-title>             <source>J Roy Stat Soc B</source>             <volume>72</volume>             <fpage>269</fpage>             <lpage>342</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-Anderson1">
        <label>27</label>
        <element-citation publication-type="other" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Anderson</surname><given-names>RM</given-names></name><name name-style="western"><surname>May</surname><given-names>RM</given-names></name></person-group>             <year>1991</year>             <source>Infectious diseases of humans : dynamics and control</source>             <publisher-loc>Oxford ; New York</publisher-loc>             <publisher-name>Oxford University Press</publisher-name>             <fpage>viii</fpage>             <page-range>757</page-range>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-Gilks1">
        <label>28</label>
        <element-citation publication-type="other" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Gilks</surname><given-names>WR</given-names></name><name name-style="western"><surname>Richardson</surname><given-names>S</given-names></name><name name-style="western"><surname>Spiegelhalter</surname><given-names>DJ</given-names></name></person-group>             <year>1998</year>             <source>Markov chain Monte Carlo in practice</source>             <publisher-loc>Boca Raton, Fla.</publisher-loc>             <publisher-name>Chapman &amp; Hall</publisher-name>             <fpage>xvii</fpage>             <page-range>486</page-range>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-ONeill3">
        <label>29</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>O'Neill</surname><given-names>PD</given-names></name></person-group>             <year>2002</year>             <article-title>A tutorial introduction to Bayesian inference for stochastic epidemic models using Markov chain Monte Carlo methods.</article-title>             <source>Math Biosci</source>             <volume>180</volume>             <fpage>103</fpage>             <lpage>114</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-Becker1">
        <label>30</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Becker</surname><given-names>NG</given-names></name><name name-style="western"><surname>Britton</surname><given-names>T</given-names></name></person-group>             <year>1999</year>             <article-title>Statistical studies of infectious disease incidence.</article-title>             <source>J Roy Stat Soc B</source>             <volume>61</volume>             <fpage>287</fpage>             <lpage>307</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-Cappe1">
        <label>31</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Cappe</surname><given-names>O</given-names></name><name name-style="western"><surname>Godsill</surname><given-names>SJ</given-names></name><name name-style="western"><surname>Moulines</surname><given-names>E</given-names></name></person-group>             <year>2007</year>             <article-title>An overview of existing methods and recent advances in sequential Monte Carlo.</article-title>             <source>Proc Inst Electr Elect</source>             <volume>95</volume>             <fpage>899</fpage>             <lpage>924</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-Doucet1">
        <label>32</label>
        <element-citation publication-type="other" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Doucet</surname><given-names>A</given-names></name><name name-style="western"><surname>De Freitas</surname><given-names>N</given-names></name><name name-style="western"><surname>Gordon</surname><given-names>N</given-names></name></person-group>             <year>2001</year>             <source>Sequential Monte Carlo methods in practice</source>             <publisher-loc>New York</publisher-loc>             <publisher-name>Springer</publisher-name>             <fpage>xxvii</fpage>             <page-range>581</page-range>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-Gordon1">
        <label>33</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Gordon</surname><given-names>NJ</given-names></name><name name-style="western"><surname>Salmond</surname><given-names>DJ</given-names></name><name name-style="western"><surname>Smith</surname><given-names>AFM</given-names></name></person-group>             <year>1993</year>             <article-title>Novel-Approach to Nonlinear Non-Gaussian Bayesian State Estimation.</article-title>             <source>IEE Proc-F</source>             <volume>140</volume>             <fpage>107</fpage>             <lpage>113</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-Chopin1">
        <label>34</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Chopin</surname><given-names>N</given-names></name></person-group>             <year>2004</year>             <article-title>Central limit theorem for sequential Monte Carlo methods and its application to Bayesian inference.</article-title>             <source>Ann Stat</source>             <volume>32</volume>             <fpage>2385</fpage>             <lpage>2411</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-Keeling1">
        <label>35</label>
        <element-citation publication-type="other" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Keeling</surname><given-names>MJ</given-names></name><name name-style="western"><surname>Rohani</surname><given-names>P</given-names></name></person-group>             <year>2008</year>             <source>Modeling infectious diseases in humans and animals</source>             <publisher-loc>Princeton</publisher-loc>             <publisher-name>Princeton University Press</publisher-name>             <fpage>xi</fpage>             <page-range>366</page-range>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-Rodrigo1">
        <label>36</label>
        <element-citation publication-type="other" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Rodrigo</surname><given-names>AG</given-names></name><name name-style="western"><surname>Felsenstein</surname><given-names>J</given-names></name></person-group>             <year>1999</year>             <article-title>Coalescent approaches to HIV population genetics.</article-title>             <person-group person-group-type="editor"><name name-style="western"><surname>Crandall</surname><given-names>KA</given-names></name></person-group>             <source>The evolution of HIV</source>             <publisher-loc>Baltimore</publisher-loc>             <publisher-name>John Hopkins University Press</publisher-name>             <fpage>233</fpage>             <lpage>269</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-He1">
        <label>37</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>He</surname><given-names>DH</given-names></name><name name-style="western"><surname>Ionides</surname><given-names>EL</given-names></name><name name-style="western"><surname>King</surname><given-names>AA</given-names></name></person-group>             <year>2010</year>             <article-title>Plug-and-play inference for disease dynamics: measles in large and small populations as a case study.</article-title>             <source>J R Soc Interface</source>             <volume>7</volume>             <fpage>271</fpage>             <lpage>283</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-King1">
        <label>38</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>King</surname><given-names>AA</given-names></name><name name-style="western"><surname>Ionides</surname><given-names>EL</given-names></name><name name-style="western"><surname>Pascual</surname><given-names>M</given-names></name><name name-style="western"><surname>Bouma</surname><given-names>MJ</given-names></name></person-group>             <year>2008</year>             <article-title>Inapparent infections and cholera dynamics.</article-title>             <source>Nature</source>             <volume>454</volume>             <fpage>877-U829</fpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-Beaumont1">
        <label>39</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Beaumont</surname><given-names>MA</given-names></name></person-group>             <year>2010</year>             <article-title>Approximate Bayesian Computation in Evolution and Ecology.</article-title>             <source>Annu Rev Ecol Evol S</source>             <volume>41</volume>             <fpage>379</fpage>             <lpage>406</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-Stack1">
        <label>40</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Stack</surname><given-names>JC</given-names></name><name name-style="western"><surname>Welch</surname><given-names>JD</given-names></name><name name-style="western"><surname>Ferrari</surname><given-names>MJ</given-names></name><name name-style="western"><surname>Shapiro</surname><given-names>BU</given-names></name><name name-style="western"><surname>Grenfell</surname><given-names>BT</given-names></name></person-group>             <year>2010</year>             <article-title>Protocols for sampling viral sequences to study epidemic dynamics.</article-title>             <source>J R Soc Interface</source>             <volume>7</volume>             <fpage>1119</fpage>             <lpage>1127</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-Drummond2">
        <label>41</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Drummond</surname><given-names>AJ</given-names></name><name name-style="western"><surname>Rambaut</surname><given-names>A</given-names></name></person-group>             <year>2007</year>             <article-title>BEAST: Bayesian evolutionary analysis by sampling trees.</article-title>             <source>BMC Evol Biol</source>             <volume>7</volume>             <fpage>-</fpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-ODea1">
        <label>42</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>O'Dea</surname><given-names>EB</given-names></name><name name-style="western"><surname>Wilke</surname><given-names>CO</given-names></name></person-group>             <year>2011</year>             <article-title>Contact heterogeneity and phylodynamics: How contact networks shape parasite evolutionary trees.</article-title>             <source>Interdisciplinary Perspectives on Infectious Diseases</source>             <volume>2011</volume>             <fpage>1</fpage>             <lpage>9</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-Wakeley1">
        <label>43</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Wakeley</surname><given-names>J</given-names></name></person-group>             <year>2001</year>             <article-title>The coalescent in an island model of population subdivision with variation among demes.</article-title>             <source>Theor Popul Biol</source>             <volume>59</volume>             <fpage>133</fpage>             <lpage>144</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-Grenfell1">
        <label>44</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Grenfell</surname><given-names>BT</given-names></name><name name-style="western"><surname>Pybus</surname><given-names>OG</given-names></name><name name-style="western"><surname>Gog</surname><given-names>JR</given-names></name><name name-style="western"><surname>Wood</surname><given-names>JLN</given-names></name><name name-style="western"><surname>Daly</surname><given-names>JM</given-names></name><etal/></person-group>             <year>2004</year>             <article-title>Unifying the epidemiological and evolutionary dynamics of pathogens.</article-title>             <source>Science</source>             <volume>303</volume>             <fpage>327</fpage>             <lpage>332</lpage>          </element-citation>
      </ref>
      <ref id="pcbi.1002136-Holmes1">
        <label>45</label>
        <element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Holmes</surname><given-names>EC</given-names></name><name name-style="western"><surname>Grenfell</surname><given-names>BT</given-names></name></person-group>             <year>2009</year>             <article-title>Discovering the Phylodynamics of RNA Viruses.</article-title>             <source>Plos Comput Biol</source>             <volume>5</volume>             <fpage>e1000505</fpage>          </element-citation>
      </ref>
    </ref-list>
    
  </back>
</article>