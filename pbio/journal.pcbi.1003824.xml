<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article
  PUBLIC "-//NLM//DTD Journal Publishing DTD v3.0 20080202//EN" "http://dtd.nlm.nih.gov/publishing/3.0/journalpublishing3.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="3.0" xml:lang="en">
<front>
<journal-meta>
<journal-id journal-id-type="publisher-id">plos</journal-id>
<journal-id journal-id-type="nlm-ta">PLoS Comput Biol</journal-id>
<journal-id journal-id-type="pmc">ploscomp</journal-id><journal-title-group>
<journal-title>PLoS Computational Biology</journal-title></journal-title-group>
<issn pub-type="ppub">1553-734X</issn>
<issn pub-type="epub">1553-7358</issn>
<publisher>
<publisher-name>Public Library of Science</publisher-name>
<publisher-loc>San Francisco, USA</publisher-loc></publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="publisher-id">PCOMPBIOL-D-14-00500</article-id>
<article-id pub-id-type="doi">10.1371/journal.pcbi.1003824</article-id>
<article-categories><subj-group subj-group-type="heading"><subject>Research Article</subject></subj-group><subj-group subj-group-type="Discipline-v2"><subject>Biology and life sciences</subject><subj-group><subject>Computational biology</subject></subj-group><subj-group><subject>Developmental biology</subject></subj-group><subj-group><subject>Neuroscience</subject></subj-group></subj-group></article-categories>
<title-group>
<article-title>Identifying Cell Types from Spatially Referenced Single-Cell Expression Datasets</article-title>
<alt-title alt-title-type="running-head">Single Cell Clustering</alt-title>
</title-group>
<contrib-group>
<contrib contrib-type="author" equal-contrib="yes" xlink:type="simple"><name name-style="western"><surname>Pettit</surname><given-names>Jean-Baptiste</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref></contrib>
<contrib contrib-type="author" equal-contrib="yes" xlink:type="simple"><name name-style="western"><surname>Tomer</surname><given-names>Raju</given-names></name><xref ref-type="aff" rid="aff2"><sup>2</sup></xref></contrib>
<contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Achim</surname><given-names>Kaia</given-names></name><xref ref-type="aff" rid="aff2"><sup>2</sup></xref></contrib>
<contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Richardson</surname><given-names>Sylvia</given-names></name><xref ref-type="aff" rid="aff3"><sup>3</sup></xref></contrib>
<contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Azizi</surname><given-names>Lamiae</given-names></name><xref ref-type="aff" rid="aff3"><sup>3</sup></xref><xref ref-type="corresp" rid="cor1"><sup>*</sup></xref></contrib>
<contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Marioni</surname><given-names>John</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref><xref ref-type="corresp" rid="cor1"><sup>*</sup></xref></contrib>
</contrib-group>
<aff id="aff1"><label>1</label><addr-line>European Bioinformatics Institute-European Molecular Biology Laboratory (EMBL-EBI), Cambridge, United Kingdom</addr-line></aff>
<aff id="aff2"><label>2</label><addr-line>Developmental Biology Unit, European Molecular Biology Laboratory (EMBL), Heidelberg, Germany</addr-line></aff>
<aff id="aff3"><label>3</label><addr-line>MRC Biostatistics Unit (MRC BSU), Cambridge Institute of Public Health, Cambridge, United Kingdom</addr-line></aff>
<contrib-group>
<contrib contrib-type="editor" xlink:type="simple"><name name-style="western"><surname>Morris</surname><given-names>Quaid</given-names></name>
<role>Editor</role>
<xref ref-type="aff" rid="edit1"/></contrib>
</contrib-group>
<aff id="edit1"><addr-line>University of Toronto, Canada</addr-line></aff>
<author-notes>
<corresp id="cor1">* E-mail: <email xlink:type="simple">lamiae.azizi@mrc-bsu.cam.ac.uk</email> (LA); <email xlink:type="simple">marioni@ebi.ac.uk</email> (JM)</corresp>
<fn fn-type="conflict"><p>The authors have declared that no competing interests exist.</p></fn>
<fn fn-type="con"><p>Conceived and designed the experiments: JBP RT KA SR LA JM. Performed the experiments: RT. Analyzed the data: JBP KA LA JM. Contributed reagents/materials/analysis tools: RT. Contributed to the writing of the manuscript: JBP RT KA SR LA JM.</p></fn>
</author-notes>
<pub-date pub-type="collection"><month>9</month><year>2014</year></pub-date>
<pub-date pub-type="epub"><day>25</day><month>9</month><year>2014</year></pub-date>
<volume>10</volume>
<issue>9</issue>
<elocation-id>e1003824</elocation-id>
<history>
<date date-type="received"><day>24</day><month>3</month><year>2014</year></date>
<date date-type="accepted"><day>26</day><month>7</month><year>2014</year></date>
</history>
<permissions>
<copyright-year>2014</copyright-year>
<copyright-holder>Pettit et al</copyright-holder><license xlink:type="simple"><license-p>This is an open-access article distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/" xlink:type="simple">Creative Commons Attribution License</ext-link>, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p></license></permissions>
<abstract>
<p>Complex tissues, such as the brain, are composed of multiple different cell types, each of which have distinct and important roles, for example in neural function. Moreover, it has recently been appreciated that the cells that make up these sub-cell types themselves harbour significant cell-to-cell heterogeneity, in particular at the level of gene expression. The ability to study this heterogeneity has been revolutionised by advances in experimental technology, such as Wholemount in Situ Hybridizations (WiSH) and single-cell RNA-sequencing. Consequently, it is now possible to study gene expression levels in thousands of cells from the same tissue type. After generating such data one of the key goals is to cluster the cells into groups that correspond to both known and putatively novel cell types. Whilst many clustering algorithms exist, they are typically unable to incorporate information about the spatial dependence between cells within the tissue under study. When such information exists it provides important insights that should be directly included in the clustering scheme. To this end we have developed a clustering method that uses a Hidden Markov Random Field (HMRF) model to exploit both quantitative measures of expression and spatial information. To accurately reflect the underlying biology, we extend current HMRF approaches by allowing the degree of spatial coherency to differ between clusters. We demonstrate the utility of our method using simulated data before applying it to cluster single cell gene expression data generated by applying WiSH to study expression patterns in the brain of the marine annelid <italic>Platynereis dumereilii</italic>. Our approach allows known cell types to be identified as well as revealing new, previously unexplored cell types within the brain of this important model system.</p>
</abstract>
<abstract abstract-type="summary"><title>Author Summary</title>
<p>Tissues within complex multi-cellular organisms have historically been defined in terms of their anatomy and function. More recently, experimental approaches have shown that different tissues express distinct batteries of genes, thus providing an additional metric for characterising them. These experiments have been performed at the whole tissue level, with gene expression measurements being "averaged" over millions of cells within a tissue. However, it is becoming apparent that even within putatively homogeneous tissues there exists significant variation in gene expression levels between cells, suggesting that additional cell subtypes, defined by distinct expression profiles, might be obscured by "bulk" experimental approaches. Herein, we develop a computational approach, based upon Markov Random Field models, for clustering cells into cell types by exploiting their gene expression profiles and location within the tissue under study. We demonstrate the efficacy of our approach using simulations, before applying it to identify known and putatively novel cell types within the brain of the ragworm, <italic>Platynereis dumerilii</italic>, an important model for understanding how the Bilaterian brain evolved.</p>
</abstract>
<funding-group><funding-statement>Core funding from the EMBL (<ext-link ext-link-type="uri" xlink:href="http://www.embl.de" xlink:type="simple">www.embl.de</ext-link>) to JBP, RT, KA and JM. MRC core funding to SR. NIHR Cambridge Biomedical Research Center (<ext-link ext-link-type="uri" xlink:href="http://www.cambridge-brc.org.uk/" xlink:type="simple">http://www.cambridge-brc.org.uk/</ext-link>) to LA. Additionally, the funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.</funding-statement></funding-group><counts><page-count count="11"/></counts><custom-meta-group><custom-meta id="data-availability" xlink:type="simple"><meta-name>Data Availability</meta-name><meta-value>The authors confirm that all data underlying the findings are fully available without restriction. All data are available at the project Github page: <ext-link ext-link-type="uri" xlink:href="https://github.com/jbogp/MRF_Platynereis_2014" xlink:type="simple">https://github.com/jbogp/MRF_Platynereis_2014</ext-link></meta-value></custom-meta></custom-meta-group></article-meta>
</front>
<body><sec id="s1">
<title>Introduction</title>
<p>Complex organisms are heterogeneous at several levels. For example, one can divide the body into functional organs: the skin, the brain, the liver and so on. This anatomical and functional classification implies that distinct organs are composed of different cell types. Interestingly, these functional building blocks are also not composed of homogeneous cell types. Indeed, they are composed of several tissues that together make up a complex organ. For example, the skin of mammals can be described as the superposition of the Epidermis, Dermis and Hypodermis <xref ref-type="bibr" rid="pcbi.1003824-Montagna1">[1]</xref>. However, even with this more precise description, each of these tissues will be heterogeneous. For instance in the Dermis, the cells making up the sweat glands will not be the same as the cells in the hair follicles. Additionally, this heterogeneity does not stop at this sub-sub classification: heterogeneity is still present and, with fine enough measurements methods, this remains true to the single cell level <xref ref-type="bibr" rid="pcbi.1003824-Elowitz1">[2]</xref>.</p>
<p>When reducing the scale of study, the classification of cells into distinct groups ceases to be anatomical. Instead, molecular biology has allowed scientists to define molecular characteristics that distinguish individual cells. The most widely used characteristic is mRNA expression, and gene expression signatures are now commonly used to define cell types <xref ref-type="bibr" rid="pcbi.1003824-Tomer1">[3]</xref>, <xref ref-type="bibr" rid="pcbi.1003824-Perou1">[4]</xref>. Conceptually, if a set of cells have similar expression profiles, this information can be used to gather these cells into a specific cell type; we focus on this, molecular, definition of a cell type in the remainder of this manuscript.</p>
<p>To do this, gene expression measurements at the single cell level within the tissues under study are necessary. Recent technological developments have facilitated this shift from tissue to single cell resolution: in-situ hybridization <xref ref-type="bibr" rid="pcbi.1003824-Tautz1">[5]</xref> in a few organisms including <italic>P. dumerilii</italic> and single cell RNA sequencing assays <xref ref-type="bibr" rid="pcbi.1003824-Tang1">[6]</xref> are amongst a number of methods that allow gene expression to be measured at the single cell level <xref ref-type="bibr" rid="pcbi.1003824-Shapiro1">[7]</xref>. Given this, one key challenge is to develop computational methods that use the expression data to cluster single cells into robust groups, which can then be examined to determine their likely functional roles.</p>
<p>Many popular clustering methods (e.g., hierarchical clustering, k-means and independent mixture models) exist and can be applied to address this problem <xref ref-type="bibr" rid="pcbi.1003824-Eisen1">[8]</xref>–<xref ref-type="bibr" rid="pcbi.1003824-Tamayo1">[10]</xref>. However, these methods fail to take into account the spatial location of each cell within the tissue under study — when such information is available <xref ref-type="bibr" rid="pcbi.1003824-Tomer1">[3]</xref>, <xref ref-type="bibr" rid="pcbi.1003824-Lein1">[11]</xref>, <xref ref-type="bibr" rid="pcbi.1003824-Eberwine1">[12]</xref>, it is extremely useful and should be incorporated into the downstream analysis. Specifically, we can hypothesise that cells that are close together are more likely to belong to the same cell type. In other words, if a cell has a "slightly" more "similar" expression profile to a typical cell in cell type <italic>b</italic> than in cell type <italic>a</italic> but all the surrounding cells have been classified as belonging to cell type <italic>a</italic> it seems sensible to assign this cell to cell type <italic>a</italic>. However, it is also important to note that cell migration, which takes place during the development of complex tissues, can lead to isolated cells with very different expression profiles than their neighbours, which also needs to be accounted for.</p>
<p>To address these problems and, in particular, to utilise both the spatial and the quantitative information, we extended a graph theoretical approach developed for image segmentation to reconstruct noisy or blurred images <xref ref-type="bibr" rid="pcbi.1003824-Dang1">[13]</xref>, a method that finds its roots in the field of statistical mechanics as the Ising model <xref ref-type="bibr" rid="pcbi.1003824-Ising1">[14]</xref> and its generalization, the Potts model <xref ref-type="bibr" rid="pcbi.1003824-Wu1">[15]</xref>. The core concept of this method (<xref ref-type="fig" rid="pcbi-1003824-g001">Figure 1</xref>) is to estimate the parameters of a Markov Random Field based model using mean-field approximations to estimate intractable values as described in <xref ref-type="bibr" rid="pcbi.1003824-Celeux1">[16]</xref>. We use an Expectation-Maximization (EM) procedure to maximize the parameters as described in <xref ref-type="bibr" rid="pcbi.1003824-Dang1">[13]</xref>, <xref ref-type="bibr" rid="pcbi.1003824-Celeux1">[16]</xref>. To the best of our knowledge, such methods have not previously been applied to 3-Dimensional gene expression data. Additionally, from a theoretical perspective, we extended current models by allowing the degree of spatial cohesion per cluster to differ, thus allowing for the possibility that some cell types are more spatially coherent than others. After validating our approach using simulated data, we demonstrated its utility by applying it to data generated using methods described in Tomer et al. <xref ref-type="bibr" rid="pcbi.1003824-Tomer1">[3]</xref> who were interested in studying the ancestral bilaterian brain.</p>
<fig id="pcbi-1003824-g001" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003824.g001</object-id><label>Figure 1</label><caption>
<title>Schematic representation of the influence of spatial coherence when clustering noisy data.</title>
<p>Panel A shows an example of noisy data for the expression of two genes as well as the resulting binarised table of expression for four cells in the assay. Panel B shows the reference represented by 3 spatially coherent cell types inside an empty area. Panel C shows the influence of the spatial smoothness/coherency parameter on the clustering results.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003824.g001" position="float" xlink:type="simple"/></fig></sec><sec id="s2">
<title>Results</title>
<sec id="s2a">
<title>Motivating data: Single cell in-situ hybridization in <italic>Platynereis dumerilii</italic></title>
<p>Tomer et al. <xref ref-type="bibr" rid="pcbi.1003824-Tomer1">[3]</xref> used Wholemount in Situ Hybridisation (WiSH) to study the spatial expression pattern of a subset of genes, at single cell resolution, in the brain of the marine annelid <italic>Platynereis dumerilii</italic> 48 hours post fertilization (hpf). <italic>P. dumerilii</italic>, is an interesting biological model, sometimes considered a "living fossil" as it is a slow-evolving protostome that has been shown to possess ancestral cell types, and thus may provide a better comparison with vertebrates than fast evolving species like <italic>Drosophila</italic> and nematodes where derived features can obscure evolutionary signal <xref ref-type="bibr" rid="pcbi.1003824-Fischer1">[17]</xref>, <xref ref-type="bibr" rid="pcbi.1003824-Arendt1">[18]</xref>.</p>
<p>Wholemount in-Situ hybridization (WiSH) is an experimental technique where the practitioner uses labelled probes designed to be specific to a given mRNA to determine in which cells of the tissue under study that message is expressed. For a small organism like <italic>Platynereis</italic>, the staining can be applied to the whole animal and a 3-Dimensional representation of the expression pattern of a gene can be deduced using confocal microscopy to study the patterns of gene expression slice by slice. In practice, following the staining, imaging and alignment, the brain volume was partitioned into 32,203 3<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e001" xlink:type="simple"/></inline-formula> voxels. The 3<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e002" xlink:type="simple"/></inline-formula> volume was chosen to be slightly smaller than the average cell in <italic>Platynereis</italic>'s brain but it is possible to consider this grid as a simple cellular model where each voxel roughly corresponds to a cell in the brain. Within each voxel, the light emission (assumed to be correlated to the gene's expression level) was measured (<xref ref-type="fig" rid="pcbi-1003824-g002">Figure 2</xref>). Theoretically, this luminescence data is quantitative but, on such a small scale, light contamination between voxels means that the quantitative measurements have to be interpreted with caution (<xref ref-type="fig" rid="pcbi-1003824-g003">Figure 3</xref>). Additionally, the light efficiency of probes can differ leading to a high experiment-to-experiment variability. Consequently, we binarized the dataset by setting the value of expression within a voxel to 1 or 0, depending upon whether the gene was or was not expressed, respectively (see <xref ref-type="sec" rid="s3">Discussion</xref>).</p>
<fig id="pcbi-1003824-g002" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003824.g002</object-id><label>Figure 2</label><caption>
<title>Wholemount in-situ hybridization expression data for 86 genes in the full brain of Platynereis.</title>
<p>The whole larvae is hybridized with two dyed probes targetting specific mRNAs, one corresponding to a reference gene and the other a gene of interest. Using confocal microscopy, the whole larvae is visualized slice by slice and the dyed regions are reported with laser light reflecting back to the detector. Every image is then divided into <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e003" xlink:type="simple"/></inline-formula>1 cell large squares which allows the reconstruction of the 3D map of expression for the two genes in the full brain. The process was repeated 86 times for key genes in Platynereis development <xref ref-type="bibr" rid="pcbi.1003824-Tomer1">[3]</xref>.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003824.g002" position="float" xlink:type="simple"/></fig><fig id="pcbi-1003824-g003" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003824.g003</object-id><label>Figure 3</label><caption>
<title>Light contamination in in-situ hybridization luminescence data.</title>
<p>Panel A shows the raw fluorescent microscopy capture of the gene Ascl's expression for one layer in the brain of Platynereis. Panel B shows the light intensity measured along the red line in panel A. Panel C shows the expected light intensity profile without light contamination. Because of the small scale of study, voxels surrounded by other voxels expressing a particular gene will have a higher intensity values because of nearby light contamination. Panel D shows errors introduced by the voxel cell model. Path <italic>a</italic> shows how regions with highly expressed genes can introduce errors through light contamination. Path <italic>b</italic> shows how some voxels may appear artificially void of expression because of the uneven distribution of transcripts inside the cytoplasm especially for large cells.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003824.g003" position="float" xlink:type="simple"/></fig>
<p>By repeating this process with different probes, expression patterns for 86 genes of interest were mapped. Importantly, due to the stereotypic nature of early <italic>Platynereis</italic> development <xref ref-type="bibr" rid="pcbi.1003824-Fischer1">[17]</xref>, the expression patterns can be overlaid, meaning that for each 3<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e004" xlink:type="simple"/></inline-formula> voxel it is possible to determine which subset of the 86 genes is expressed. We can represent this information in a <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e005" xlink:type="simple"/></inline-formula> matrix of binary gene expression, where the location of each voxel, roughly representing a cell within the brain, is referenced in a 3D coordinate system. Given this coordinate system, we can create a neighbouring graph representation, where each node in the equivalent undirected graph corresponds to a voxel in the in-situ data. The edges of the graph were computed following a simple neighbouring system taking only the 6 closest neighbours, one in each direction of the 3D space.</p>
</sec><sec id="s2b">
<title>Clustering method</title>
<p>Markov random fields (MRF) are statistical models that provide a way of modeling entities composed of multiple discrete sites such as images where each site is a pixel or, in our case, a biological tissue where each site is a single voxel roughly corresponding to a cell, in a context-dependent manner <xref ref-type="bibr" rid="pcbi.1003824-Li1">[19]</xref>. MRF based methods find their roots in the field of statistical mechanics as the Ising model <xref ref-type="bibr" rid="pcbi.1003824-Ising1">[14]</xref> and its generalization, the Potts model <xref ref-type="bibr" rid="pcbi.1003824-Wu1">[15]</xref>. Since then, they have been and are still mainly used in the field of image analysis, and the literature about them is ever growing <xref ref-type="bibr" rid="pcbi.1003824-Rozanov1">[20]</xref>–<xref ref-type="bibr" rid="pcbi.1003824-Bishop1">[22]</xref>. More specifically, MRF methods are found in a wide range of applications such as image restoration and segmentation <xref ref-type="bibr" rid="pcbi.1003824-Zhang1">[23]</xref>, surface reconstruction <xref ref-type="bibr" rid="pcbi.1003824-Paulsen1">[24]</xref>, edge detection <xref ref-type="bibr" rid="pcbi.1003824-Zerubia1">[25]</xref>, texture analysis <xref ref-type="bibr" rid="pcbi.1003824-Clausi1">[26]</xref>, optical flow <xref ref-type="bibr" rid="pcbi.1003824-Heitz1">[27]</xref>, active contours <xref ref-type="bibr" rid="pcbi.1003824-MartnFernndez1">[28]</xref>, deformable templates <xref ref-type="bibr" rid="pcbi.1003824-Mignotte1">[29]</xref>, data fusion <xref ref-type="bibr" rid="pcbi.1003824-Wright1">[30]</xref> and perceptual grouping <xref ref-type="bibr" rid="pcbi.1003824-Fields1">[31]</xref>. MRFs have also been used in a variety of biological applications from analysing medical imaging data <xref ref-type="bibr" rid="pcbi.1003824-Zhang1">[23]</xref>, <xref ref-type="bibr" rid="pcbi.1003824-Held1">[32]</xref>, <xref ref-type="bibr" rid="pcbi.1003824-Descombes1">[33]</xref> to analysing networks of genomic data <xref ref-type="bibr" rid="pcbi.1003824-Wei1">[34]</xref>. Additionally, the Cellular Potts Model <xref ref-type="bibr" rid="pcbi.1003824-VossBohme1">[35]</xref> has been used to model tissue development at a sub-cellular resolution.</p>
<p>Mathematically, MRF models are built around two complementary sub-models. The field represents the sites and their spatial structure. The Hammersley-Clifford (1971) theorem states that the probability distribution of the Markov field can be represented as a Gibbs measure, which incorporates an energy function into which the spatial coherency parameters of the model are incorporated. Some critical choices in terms of the modeling framework are the structure of the neighbourhood system and the energy function. The emission model is used to describe the underlying data (gene expression measurements in our case) and it is necessary to make some assumptions about its form depending upon the underlying data.</p>
<p>In our study the goal is to allocate the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e006" xlink:type="simple"/></inline-formula> voxels described above into <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e007" xlink:type="simple"/></inline-formula> clusters, where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e008" xlink:type="simple"/></inline-formula> is unknown, using the binarised matrix of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e009" xlink:type="simple"/></inline-formula> gene expression measurements, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e010" xlink:type="simple"/></inline-formula>. To incorporate spatial information into our clustering scheme, we assume that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e011" xlink:type="simple"/></inline-formula>, the (latent) vector of length <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e012" xlink:type="simple"/></inline-formula> that describes the allocation of voxels to clusters, satisfies a first-order Markov Random Field (MRF), where the probability that a voxel is allocated to a given state depends only upon the states of its immediate neighbours. Additionally, within cluster <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e013" xlink:type="simple"/></inline-formula> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e014" xlink:type="simple"/></inline-formula>, we assume that the expression of gene <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e015" xlink:type="simple"/></inline-formula> follows a Bernoulli distribution with parameter <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e016" xlink:type="simple"/></inline-formula>; we denote the full set of Bernoulli parameters using the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e017" xlink:type="simple"/></inline-formula> matrix <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e018" xlink:type="simple"/></inline-formula>. In a typical MRF, the degree of spatial cohesion is determined by a single parameter <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e019" xlink:type="simple"/></inline-formula>, which is assumed to be constant for all clusters <xref ref-type="bibr" rid="pcbi.1003824-Subudhi1">[36]</xref>, <xref ref-type="bibr" rid="pcbi.1003824-Zhang2">[37]</xref>. However, in the context of tissue organisation, it is reasonable to expect that the degree of spatial cohesion will differ between clusters; consequently, we estimate a separate value of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e020" xlink:type="simple"/></inline-formula> for each of the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e021" xlink:type="simple"/></inline-formula> clusters (<xref ref-type="sec" rid="s4">Methods</xref>). To estimate the parameters we use a fully-factorized variational expectation maximization (EM) approach in conjunction with mean-field approximations to infer intractable values <xref ref-type="bibr" rid="pcbi.1003824-Celeux1">[16]</xref>. To choose the optimal number of clusters, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e022" xlink:type="simple"/></inline-formula>, we use the Bayesian Information Criterion (BIC).</p>
</sec><sec id="s2c">
<title>Model validation and comparison with alternative approaches</title>
<p>Simulating data with a spatial component is a non-trivial problem. Existing methods rely on MCMC approaches as described in <xref ref-type="bibr" rid="pcbi.1003824-Chalmond1">[38]</xref>. However, in our case with a relatively large number of nodes in the graph (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e023" xlink:type="simple"/></inline-formula>), this is computationally expensive. To overcome this problem, we exploited the fact that the <italic>Platynereis</italic> dataset already possesses a spatial structure, and use this as a synthetic example on which to base our simulations. As outlined in <xref ref-type="fig" rid="pcbi-1003824-g004">Figure 4</xref>, we start by clustering the gene expression data using different values of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e024" xlink:type="simple"/></inline-formula> and store the corresponding parameter estimates. Subsequently, the estimated Bernoulli parameters, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e025" xlink:type="simple"/></inline-formula>, were used to simulate binarised gene expression data from <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e026" xlink:type="simple"/></inline-formula> clusters where, for each voxel contained within cluster <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e027" xlink:type="simple"/></inline-formula>, the expression of gene <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e028" xlink:type="simple"/></inline-formula> is simulated from a Bernoulli distribution with parameter <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e029" xlink:type="simple"/></inline-formula> (<xref ref-type="fig" rid="pcbi-1003824-g004">Figure 4</xref>).</p>
<fig id="pcbi-1003824-g004" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003824.g004</object-id><label>Figure 4</label><caption>
<title>Simulation scheme used to generate gene expression data with a spatial component and known parameters.</title>
<p>The values of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e030" xlink:type="simple"/></inline-formula> are used to generate a dataset of clusters with the same gene expression profile as the reference. Each simulated voxel is then assigned to its corresponding spatial localization so that the simulated data keeps the spatial component of the biological data.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003824.g004" position="float" xlink:type="simple"/></fig>
<p>Next, each simulated voxel was assigned to the same spatial location as the corresponding voxel in the biological dataset. As a result, the simulated and the biological datasets have the same neighbouring graph. We can then cluster these simulated datasets using the method outlined above and determine how accurately we can estimate the parameters (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e031" xlink:type="simple"/></inline-formula>) and choose the correct number of clusters, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e032" xlink:type="simple"/></inline-formula>.</p>
<p>The most important criterion for assessing the efficacy of our approach is the similarity between the inferred and true clusters. This also implicitly assesses the accuracy of the estimation of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e033" xlink:type="simple"/></inline-formula>: if the inferred and true clusters are identical, the estimates of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e034" xlink:type="simple"/></inline-formula> must be equal to the true values. In practice, we used the Jaccard coefficient to compare the inferred and the true clusters (<xref ref-type="sec" rid="s4">Methods</xref>), where a Jaccard coefficient of 1 implies perfect agreement. To benchmark our approach's performance, we also assessed the ability of two other models to cluster the simulated data: hierarchical clustering (hClust), a very widely used approach in genomics and elsewhere, and an independent mixture model, which allows the relative improvement in performance added by the spatial component to be studied.</p>
<p>Additionally, the likelihood function that needs to be maximised possesses many stationary points of different natures. Thus, convergence to the global maximum with the Expectation-maximisation algorithm (see <xref ref-type="sec" rid="s4">Methods</xref> section), depends strongly on the parameter initialisation. To overcome this problem, different initialisation strategies have been proposed and investigated (see for instance <xref ref-type="bibr" rid="pcbi.1003824-Biernacki1">[39]</xref>–<xref ref-type="bibr" rid="pcbi.1003824-McLachlan1">[41]</xref>). Herein, we compare a random initialisation scheme with an initialisation based upon the solution obtained by applying hClust.</p>
<p>The results of these experiments are shown in <xref ref-type="fig" rid="pcbi-1003824-g005">Figure 5</xref> for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e035" xlink:type="simple"/></inline-formula>. Our method, when used with a random initialization scheme (<xref ref-type="sec" rid="s4">Methods</xref>), has an average Jaccard coefficient of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e036" xlink:type="simple"/></inline-formula>, and clearly demonstrates better performance than the other methods. The second best performing method is the independent mixture model with a random initialization, which has an average Jaccard coefficient of 0.7. Since the independent mixture approach is equivalent to the MRF with all the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e037" xlink:type="simple"/></inline-formula> parameters set equal to 0 (i.e., without a spatial component) this suggests that accounting for the spatial aspect yields improved results. Given this, it is perhaps unsurprising that hClust also performs relatively poorly. Additionally, we note that initializing the MRF with the hClust output yields results that are superior to those generated by hClust but that are still poorer than either the randomly initialized independent mixture model or the MRF approach. This is likely explained by noting that, depending upon the initialization, the EM algorithm might converge to a local maximum. Consequently, for the rest of this study we use the random initialization strategy to initialize the EM algorithm.</p>
<fig id="pcbi-1003824-g005" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003824.g005</object-id><label>Figure 5</label><caption>
<title>Jaccard coefficient between “true” and resulting clusters on the simulated data with different methods and initializations.</title>
<p>Panel A compares the performance of the MRF method with a randomly initialization with an independent mixture model also with a random initialization, the MRF method initialized with the hClust classification and hClust alone on data simulated with a spatial component. Panel B shows the Jaccard coefficient for the MRF method and independent mixture model both with a random initialization; in this case both methods are applied to simulated data that lacks a spatial component.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003824.g005" position="float" xlink:type="simple"/></fig>
<p>As well as directly comparing the clusters, we can also determine how accurately the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e038" xlink:type="simple"/></inline-formula> parameters are estimated. To this end, in <xref ref-type="fig" rid="pcbi-1003824-g006">Figure 6</xref> we compare the true and inferred mean values of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e039" xlink:type="simple"/></inline-formula> for different values of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e040" xlink:type="simple"/></inline-formula>. The values of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e041" xlink:type="simple"/></inline-formula> increase with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e042" xlink:type="simple"/></inline-formula>, which is to be expected since more clusters implies the existence of more transition areas, thus making an increase of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e043" xlink:type="simple"/></inline-formula> necessary to maintain the optimal spatial coherency of the model. <xref ref-type="fig" rid="pcbi-1003824-g006">Figure 6</xref> also shows a slight but consistent underestimation of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e044" xlink:type="simple"/></inline-formula>. This can be explained by noting that the simulation scheme used may reduce the spatial coherency within clusters. Specifically, as illustrated in <xref ref-type="fig" rid="pcbi-1003824-g007">Figure 7</xref>, clusters may not display homogeneous expression of a given gene: instead, depending upon the value of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e045" xlink:type="simple"/></inline-formula>, a gene will be expressed only in a fraction of voxels. In reality, the voxels in which such genes are expressed may have a coherent spatial structure within the cluster that is lost in the simulation, thus explaining the consistently smaller values for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e046" xlink:type="simple"/></inline-formula> that are estimated. To confirm this, we performed a second simulation using the parameter values estimated from the first simulation as a reference. In this context we did not expect any further loss of spatial coherency, which was indeed confirmed as shown by the blue curve in <xref ref-type="fig" rid="pcbi-1003824-g006">Figure 6</xref>.</p>
<fig id="pcbi-1003824-g006" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003824.g006</object-id><label>Figure 6</label><caption>
<title>Validating the estimation of beta.</title>
<p>This figure shows the evolution for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e047" xlink:type="simple"/></inline-formula> of the mean value of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e048" xlink:type="simple"/></inline-formula> across all the clusters. The red dots represent the biological data clustering (i.e the reference in our simulations scheme). The green dots represent the results obtained after clustering simulated data, which shows an underestimation of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e049" xlink:type="simple"/></inline-formula>. To confirm that this underestimation come from the simulation scheme and not the clustering method, we used the simulated data as the reference to generate a "second generation" of simulated data, suppressing the simulation scheme bias (see <xref ref-type="fig" rid="pcbi-1003824-g007">Figure 7</xref>). The results of this re-simulation are shown by the blue dots, which exhibit no underestimation of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e050" xlink:type="simple"/></inline-formula>. Finally the brown dots represent the mean value of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e051" xlink:type="simple"/></inline-formula> on the same simulated data but spatially randomized, as expected the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e052" xlink:type="simple"/></inline-formula> are now estimated to <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e053" xlink:type="simple"/></inline-formula>.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003824.g006" position="float" xlink:type="simple"/></fig><fig id="pcbi-1003824-g007" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003824.g007</object-id><label>Figure 7</label><caption>
<title>Decrease in spatial coherency due to the simulation scheme.</title>
<p>For an example cluster <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e054" xlink:type="simple"/></inline-formula>, gene <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e055" xlink:type="simple"/></inline-formula> may only be expressed in half of the voxels. This will yield <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e056" xlink:type="simple"/></inline-formula>. However, in the biological data, the voxels expressing gene <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e057" xlink:type="simple"/></inline-formula> may be spatially coherent (i.e., located close to one another), leading to a reduced area of expression discontinuity (the green line). By contrast, in the simulated data the expression of such a gene will lose its spatial coherency, leading to an increased area of expression discontinuity. The number of voxels having a neighbour with some differences in the gene expression pattern is directly linked to the value of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e058" xlink:type="simple"/></inline-formula> through the energy function (<xref ref-type="sec" rid="s4">Methods</xref>). This explains the underestimation of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e059" xlink:type="simple"/></inline-formula> observed in <xref ref-type="fig" rid="pcbi-1003824-g006">Figure 6</xref>.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003824.g007" position="float" xlink:type="simple"/></fig>
<p>To validate further our estimation of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e060" xlink:type="simple"/></inline-formula>, we randomized the coordinates of the voxels to lose any spatial component before re-clustering the data. As expected, we observed that the estimates of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e061" xlink:type="simple"/></inline-formula> were very close to <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e062" xlink:type="simple"/></inline-formula> for all clusters (<xref ref-type="fig" rid="pcbi-1003824-g006">Figure 6</xref>), as well as there being very similar Jaccard coefficient values (relative to the true values) for the independent mixture and the MRF model. Both of these observations provide confidence in our assertion that the spatial component plays an important role in the fit.</p>
<p>Finally, we assessed the ability of the model to choose the correct number of clusters, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e063" xlink:type="simple"/></inline-formula>. To do this, we noted the "true" number of clusters underlying the simulated data and compared this with the chosen value, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e064" xlink:type="simple"/></inline-formula>. The results for two representative choices of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e065" xlink:type="simple"/></inline-formula> are shown in <xref ref-type="fig" rid="pcbi-1003824-g008">Figure 8</xref> and demonstrate that our clustering approach, in conjunction with the BIC, is able to accurately determine the optimal number of clusters.</p>
<fig id="pcbi-1003824-g008" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003824.g008</object-id><label>Figure 8</label><caption>
<title>Estimating the BIC from the simulated data.</title>
<p>The BIC is plotted on the y-axis for different values of K on the x-axis. The red and the grey points correspond to the BIC estimated when the underlying data have 17 and 7 clusters, respectively. The minimum BIC value is 18 and 7, respectively, suggesting that the MRF approach in conjunction with the BIC well estimates the optimal number of clusters.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003824.g008" position="float" xlink:type="simple"/></fig></sec><sec id="s2d">
<title>Biological interpretation</title>
<p>After validating our method using simulated data, we next studied the biological meaning of each of the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e066" xlink:type="simple"/></inline-formula> clusters generated by applying the HMRF model to the real data. To do this, we combined each cluster's spatial location with its corresponding expression parameter <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e067" xlink:type="simple"/></inline-formula>. The latter parameter allows a stereotypical expression "fingerprint" to be associated with every cluster.</p>
<p>In practice, not all of the 86 genes will provide insight into the biological function of a given cluster. For instance, in the case of a ubiquitously expressed gene, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e068" xlink:type="simple"/></inline-formula>, the value of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e069" xlink:type="simple"/></inline-formula> will be high for all clusters. To overcome this problem, we developed a score, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e070" xlink:type="simple"/></inline-formula>, for each gene, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e071" xlink:type="simple"/></inline-formula> and each cluster <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e072" xlink:type="simple"/></inline-formula>, where:</p>
<p><disp-formula id="pcbi.1003824.e073"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003824.e073" xlink:type="simple"/></disp-formula></p>
<p>For each gene, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e074" xlink:type="simple"/></inline-formula>, and cluster, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e075" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e076" xlink:type="simple"/></inline-formula> is large if gene <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e077" xlink:type="simple"/></inline-formula> is specific to cluster <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e078" xlink:type="simple"/></inline-formula>. Consequently, the top scoring 3 or 4 genes for each cluster will represent a specific stereotypical expression pattern that will help us infer or confirm the identity of the functional tissue represented by each cluster.</p>
<p>To provide confidence in our approach, we first considered well characterised regions within the <italic>Platynereis</italic> brain. Arguably the best-studied regions of the brain in <italic>Platynereis</italic> are the eyes: the brain has 4 eyes, two larval and two adult, and their locations and expression fingerprints are well known. As shown in <xref ref-type="fig" rid="pcbi-1003824-g009">Figure 9A</xref>, our approach generates two spatially coherent clusters that correspond to each of these regions. Importantly, the genes that best characterise these clusters are biologically meaningful: <italic>rOpsin</italic> and <italic>rOpsin3</italic>, both members of the well-described opsin family of photosensitive molecules <xref ref-type="bibr" rid="pcbi.1003824-Terakita1">[42]</xref>, <xref ref-type="bibr" rid="pcbi.1003824-Randel1">[43]</xref>, best distinguish the adult eye and larval eyes respectively, consistent with the in-situ data images shown in <xref ref-type="fig" rid="pcbi-1003824-g010">Figure 10</xref>. As well as the eyes, a second region of the <italic>Platynereis</italic> brain, the mushroom bodies (which corresponds to the pallium, layers of neurons that cover the upper surface of the cerebrum in vertebrates <xref ref-type="bibr" rid="pcbi.1003824-Tomer1">[3]</xref>), are also clearly identified by our approach (<xref ref-type="fig" rid="pcbi-1003824-g009">Figure 9B</xref>).</p>
<fig id="pcbi-1003824-g009" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003824.g009</object-id><label>Figure 9</label><caption>
<title>Eyes and mushroom bodies in the brain of Platynereis as clustered by the HMRF method.</title>
<p>Panel A: Adult and larval eyes in separate clusters with their top 3 most representative genes. Panel B: Mushroom bodies and their most representative genes. This visualization has been captured using the software bioWeb3D <xref ref-type="bibr" rid="pcbi.1003824-Pettit1">[53]</xref>.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003824.g009" position="float" xlink:type="simple"/></fig><fig id="pcbi-1003824-g010" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003824.g010</object-id><label>Figure 10</label><caption>
<title>In-situ hybridization image for rOpsin and rOpsin3 in the full brain at 48hpf (Apical view).</title>
<p>Z-projection of the expression of rOpsin (red) in both the adult eyes and the larval eyes, rOpsin3 (green) specifically in the larval eyes and co-expression areas in some areas of the larval eyes in the full brain of <italic>Platynereis</italic> at 48hpf. This image been obtained directly from the data obtained in <xref ref-type="bibr" rid="pcbi.1003824-Tomer1">[3]</xref></p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003824.g010" position="float" xlink:type="simple"/></fig>
<p>As well as identifying clusters corresponding to known cell types, we also identified clusters that might correspond to less well studied subtypes with specific biological functions. In <xref ref-type="fig" rid="pcbi-1003824-g011">Figure 11</xref>, the green cluster defines a region on the basal side of the larvae that can be associated both by its localization and by its most representative genes (<italic>MyoD</italic> <xref ref-type="bibr" rid="pcbi.1003824-Weintraub1">[44]</xref>, <xref ref-type="bibr" rid="pcbi.1003824-Michelson1">[45]</xref> and <italic>LDB3</italic> <xref ref-type="bibr" rid="pcbi.1003824-Krcmery1">[46]</xref>, <xref ref-type="bibr" rid="pcbi.1003824-Marziliano1">[47]</xref>) with the starting point of the developing muscles of the adult animal. Indeed, <italic>MyoD</italic> has been shown to play a key role in the differentiation of muscles during development in vertebrates and invertebrates <xref ref-type="bibr" rid="pcbi.1003824-Weintraub1">[44]</xref>, <xref ref-type="bibr" rid="pcbi.1003824-Michelson1">[45]</xref> and <italic>LDB3</italic> codes for the protein LDB3, which interacts with the myozenin gene family that has been implicated in muscle development in vertebrates <xref ref-type="bibr" rid="pcbi.1003824-Marziliano1">[47]</xref>.</p>
<fig id="pcbi-1003824-g011" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003824.g011</object-id><label>Figure 11</label><caption>
<title>A putative tissue of developing neurons between the eyes and the larvae's developing muscles.</title>
<p>The yellow and red clusters are the eyes as seen on <xref ref-type="fig" rid="pcbi-1003824-g009">figure 9</xref>. The green cluster represents the developing muscles on the basal side of the larvae, as the location and the most specific genes strongly suggest. The pink cluster is a putative tissue that makes an interesting link between the eyes and the muscles. The most representative gene of this tissue is Phox2, a homeodomain protein required for the generation of visceral motor-neurons in <italic>Drosophila</italic> <xref ref-type="bibr" rid="pcbi.1003824-Briscoe1">[49]</xref></p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003824.g011" position="float" xlink:type="simple"/></fig>
<p>Given the location of the eyes and the developing muscles, the location of the pink cluster in <xref ref-type="fig" rid="pcbi-1003824-g011">Figure 11</xref> is interesting. This cluster surrounds the larval eyes, the adult eyes and reaches the hypothetically developing muscles described above. Looking at the most representative genes for this pink cluster, it is interesting to note the presence of <italic>Phox2</italic>, a homeodomain protein that has been shown to be necessary for the generation of visceral motor-neurons (neurons of the central nervous system that project their axons to directly or indirectly control muscles) as described generally in <xref ref-type="bibr" rid="pcbi.1003824-Brunet1">[48]</xref> and in <italic>Drosophila</italic> <xref ref-type="bibr" rid="pcbi.1003824-Briscoe1">[49]</xref>. The second most representative gene, <italic>COE</italic>, has also been shown to play a role in <italic>Platynereis</italic> and <italic>Drosophila</italic> neural tissue development <xref ref-type="bibr" rid="pcbi.1003824-Demilly1">[50]</xref>. In this context, although we lack biological validation, we can hypothesise that the cells within this particular cluster could be developing neurons that link the eyes to the muscles of <italic>Platynereis</italic>. Although this hypothesis remains purely speculative and would need validation in the laboratory, we believe this example is an interesting proof-of-concept that our clustering method can prove useful for hypothesis generation. Indeed, the analysis of the parameter values and the spatial localization attached to the clusters has allowed us to place with a reasonable level of confidence a functional hypothesis about a tissue that was not clearly defined either spatially or functionally. It is also interesting to note that hClust does not separate either putative region when clustering the same data with the same number of clusters.</p>
<p>When we used an independent mixture model approach (i.e., with no spatial component) to cluster the data the results were more comparable to those obtained when using the HMRF strategy. However, as can be observed when comparing <xref ref-type="fig" rid="pcbi-1003824-g012">Figures 12</xref> and <xref ref-type="fig" rid="pcbi-1003824-g011">11</xref>, the clusters generated via the independent EM approach are considerably noisier and, as expected, less spatially coherent than those generated by the HMRF model. Further, for the developing muscle region, this noise is linked to biological imprecisions. When compared to in situ data generated by Fischer <italic>et al</italic>. <xref ref-type="bibr" rid="pcbi.1003824-Fischer1">[17]</xref>, who used a phalloidin in situ stain to investigate the location of the muscles at this developmental stage, it can be observed that the muscles are restricted to regions located away from the axes of symmetry, more consistent with the HMRF clustering output. Similarly, the independent mixture model method associates to the hypothesized region of developing neurons around the eyes, some ventral areas that seem unlikely to belong to the same sub tissue. Consequently, it seems likely that the HMRF not only performs better than the independent mixture model on simulated data but also better reflects the underlying biology.</p>
<fig id="pcbi-1003824-g012" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003824.g012</object-id><label>Figure 12</label><caption>
<title>Clusters obtained with the independent mixture model.</title>
<p>The Adult eyes are well isolated (red). The larval eyes (yellow) as well. The muscles and the region of potential developing neurons are picked up as well. However if all the regions are recognizable, they are extremely poorly defined spatially with a lot of noise and little spatial coherency. This noise leads to biologically incoherent regions to be clustered with known cell types, particularly for the potential pool of developing neurones as well as the developing muscles.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003824.g012" position="float" xlink:type="simple"/></fig></sec></sec><sec id="s3">
<title>Discussion</title>
<sec id="s3a">
<title>Data binarization</title>
<p>As shown in <xref ref-type="fig" rid="pcbi-1003824-g003">Figure 3</xref>, we overcame problems linked to light contamination by binarizing the "quantitative" luminiscence information. To do this, it is necessary to specify a threshold above which a gene is considered expressed. Ideally the same threshold would be applied to all genes — however, when we examined the density plots of light intensities for each gene we observed significant differences that rendered such an approach impossible. Specifically, for some genes, the density of intensities clearly separated the voxels into two groups, corresponding to those where the gene is expressed and unexpressed, respectively (<xref ref-type="fig" rid="pcbi-1003824-g013">Figure 13</xref> (left)). For the remaining genes, however, the density plot was diffuse, with no clear separation of the voxels into expressed and unexpressed clusters (<xref ref-type="fig" rid="pcbi-1003824-g013">Figure 13</xref> (right)). Consequently, we binarized each gene manually by choosing an optimal threshold based upon inspection of the raw fluorescent microscopy images. This is possible since the number of genes under study is relatively small. However, as the number of genes for which data is available increases (as will be the case, for example, with single-cell RNA-sequencing studies), an automated method, perhaps based upon mixtures of Gaussians in the context of the WiSH data, will be required.</p>
<fig id="pcbi-1003824-g013" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003824.g013</object-id><label>Figure 13</label><caption>
<title>Densities of log luminescence values for two genes (rOpsin, PRDM8) over the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e079" xlink:type="simple"/></inline-formula> voxels.</title>
<p>For <italic>rOpsin</italic>, the density exhibits two clear peaks making the choice of a binarizing threshold easy. By contrast, for <italic>PRDM8</italic> there is no such clear threshold, making an automated binarization method hard to implement.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003824.g013" position="float" xlink:type="simple"/></fig>
<p>Importantly, if the noise level in single cell expression datasets decreases to the extent where we can safely consider the results as quantitative, our method can easily be transformed to take this feature into account. The general outline of the model will stay exactly the same, the change will occur in the emission distribution. Instead of representing a Bernoulli parameter for each gene and each cluster, each <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e080" xlink:type="simple"/></inline-formula> could instead represent the parameter of a Poisson distribution.</p>
</sec><sec id="s3b">
<title>Validity of the model's independence hypothesis</title>
<p>In our model we assume that, conditional upon the allocation of a voxels to a cluster, the gene expression levels can be described by independent Bernoulli distributions. This is a reasonable assumption in the context of the 86 genes chosen by Tomer et al. <xref ref-type="bibr" rid="pcbi.1003824-Tomer1">[3]</xref>, since they were selected to have largely orthogonal expression profiles. In other words, they were chosen since they were known to correspond to distinct and potentially interesting regions of the <italic>Platynereis</italic> brain. However, in many other settings a larger number of genes, many with correlated expression profiles (i.e., genes in the same regulatory network) will be profiled and this assumption will be invalid. Consequently, extending the model to allow for dependence structure in the emission distributions will be a critical challenge. Additionally, as the number of genes increases, our approach for choosing the most specific genes will become less practical. Instead, entropy based approaches, such as the Kullback-Leibler divergence, might be more suitable.</p>
</sec><sec id="s3c">
<title>Summary</title>
<p>In summary, we have illustrated, using both simulations and real data, that accounting for spatial information significantly improves our ability to cluster voxels roughly representing brain cells into coherent and biologically relevant sets. While our approach converges very quickly (on the order of minutes) for the motivating dataset described herein, as the volume of data increases (i.e., by assaying the expression levels of thousands of genes in each cell using single-cell RNA-sequencing) it will be important to carefully investigate how easily our model scales. Nevertheless, we anticipate that our method will play an important part in facilitating interpretation of single-cell resolution data, which will be an increasingly important challenge over the next few years.</p>
</sec></sec><sec id="s4" sec-type="methods">
<title>Methods</title>
<p>In this section we describe the Hidden Markov Random Field based approach that we developed to cluster the in-situ hybridization data into <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e081" xlink:type="simple"/></inline-formula> clusters (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e082" xlink:type="simple"/></inline-formula>). Subsequently, we will describe our approach for choosing <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e083" xlink:type="simple"/></inline-formula>.</p>
<p>Let <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e084" xlink:type="simple"/></inline-formula> be the gene expression measurement for each voxel <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e085" xlink:type="simple"/></inline-formula> where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e086" xlink:type="simple"/></inline-formula> is the number of considered genes. Originally, 169 gene expression patterns where generated, but due to experimental constraints — confocal laser microscopy artefacts and high background noise in some samples — we filtered out 83 of those genes to create a gold standard dataset with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e087" xlink:type="simple"/></inline-formula> manually validated genes. Our goal is to assign each voxel, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e088" xlink:type="simple"/></inline-formula>, to one of the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e089" xlink:type="simple"/></inline-formula> possible clusters. We define a set of discrete random variables <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e090" xlink:type="simple"/></inline-formula> that represents the cluster each voxel is assigned to. Each <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e091" xlink:type="simple"/></inline-formula> takes a value in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e092" xlink:type="simple"/></inline-formula> denoting the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e093" xlink:type="simple"/></inline-formula> possible clusters. The aim of the method is to restore the unknown clustering structure with regard to gene expression similarity as well as spatial dependencies between voxels. To do this, we assume that the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e094" xlink:type="simple"/></inline-formula> are dependent variables and we encode the spatial relationship using a neighbourhood system defined through a graph <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e095" xlink:type="simple"/></inline-formula>.</p>
<p>In this work, we use a first order neighbourhood system, i.e, the 6 closest sites. The set of voxels is then represented as a graph <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e096" xlink:type="simple"/></inline-formula> with edges projecting from each voxel to its closest neighbours. The dependencies between neighbouring voxels are modelled by assuming that the joint distribution of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e097" xlink:type="simple"/></inline-formula> is a discrete <bold>MRF</bold>:</p>
<p><disp-formula id="pcbi.1003824.e098"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003824.e098" xlink:type="simple"/></disp-formula>where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e099" xlink:type="simple"/></inline-formula> is a normalising constant summed over all the possible configurations <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e100" xlink:type="simple"/></inline-formula> that soon becomes intractable as the number of sites increases. <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e101" xlink:type="simple"/></inline-formula> is a set of parameters, and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e102" xlink:type="simple"/></inline-formula> is the energy of the field. This energy can be written as a sum over all the possible cliques of the graph <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e103" xlink:type="simple"/></inline-formula>. We restrict this summation to the pairwise interactions and the function <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e104" xlink:type="simple"/></inline-formula> is assumed to be of the following form:</p>
<p><disp-formula id="pcbi.1003824.e105"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003824.e105" xlink:type="simple"/><label>(1)</label></disp-formula>where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e106" xlink:type="simple"/></inline-formula> represents the pair-wise potentials, i.e the dependency between <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e107" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e108" xlink:type="simple"/></inline-formula> for two neighbouring voxels <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e109" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e110" xlink:type="simple"/></inline-formula>. The Potts model <xref ref-type="bibr" rid="pcbi.1003824-Wu1">[15]</xref> traditionally used for image segmentation, is the most appropriate discrete random field of the form of (1) for clustering as it tends to allocate neighbours to the same cluster, thus increasing the spatial coherency. The Potts model is defined by the Energy function <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e111" xlink:type="simple"/></inline-formula>:</p>
<p><disp-formula id="pcbi.1003824.e112"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003824.e112" xlink:type="simple"/></disp-formula>with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e113" xlink:type="simple"/></inline-formula> the interaction parameter between two neighbours. Note that the greater the value of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e114" xlink:type="simple"/></inline-formula>, the more weight is given to the interaction graph (i.e., there is more spatial cohesion). Although this feature is appealing for clustering, the standard Potts model penalizes the interaction strength in different clusters with the same penalty. In practice, given the nature and the biological context of our data, it may be more appropriate to allow cell types that are more spatially coherent to have a higher value of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e115" xlink:type="simple"/></inline-formula> (i.e stronger interaction) than other cell types, in other words to use adaptive smoothness related to the type of cells in the cluster. To this end, we propose a variant of the Potts model, which we define as:</p>
<p><disp-formula id="pcbi.1003824.e116"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003824.e116" xlink:type="simple"/></disp-formula></p>
<p>This extended version allows each cluster <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e117" xlink:type="simple"/></inline-formula> to have its own parameter for interaction strength. For the model to be fully defined, we need to specify, besides the prior described above for the labels <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e118" xlink:type="simple"/></inline-formula>, the emission model. To this end, a Bernoulli distribution is used as the sampling distribution:</p>
<p><disp-formula id="pcbi.1003824.e119"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003824.e119" xlink:type="simple"/></disp-formula></p>
<p>The <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e120" xlink:type="simple"/></inline-formula> genes selected can be considered as independent because they are all key genes in the development of the brain of <italic>P. dumerilii</italic>. Consequently, we can assume conditional independence of the observed variables <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e121" xlink:type="simple"/></inline-formula> given the clustering <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e122" xlink:type="simple"/></inline-formula>. This leads to:</p>
<p><disp-formula id="pcbi.1003824.e123"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003824.e123" xlink:type="simple"/></disp-formula></p>
<p>The log likelihood of the complete model is thus given by:</p>
<p><disp-formula id="pcbi.1003824.e124"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003824.e124" xlink:type="simple"/></disp-formula></p>
<p>We denote the parameters of the model as <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e125" xlink:type="simple"/></inline-formula>.</p>
<p>As mentioned before, our aim is to assign each voxel <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e126" xlink:type="simple"/></inline-formula> to one of the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e127" xlink:type="simple"/></inline-formula> possible clusters. To do so, we chose to consider the Maximum Posterior Marginal (MPM) that maximizes <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e128" xlink:type="simple"/></inline-formula>, where the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e129" xlink:type="simple"/></inline-formula> are unknown and need to be estimated. We solved this problem using the EM algorithm <xref ref-type="bibr" rid="pcbi.1003824-Dempster1">[51]</xref>. For HMRFs, contrary to independent mixture models, the exact EM can not be applied directly due to the dependence structure and some approximations are required <xref ref-type="bibr" rid="pcbi.1003824-Dang1">[13]</xref>. We chose to use approximations based on the Mean field principle <xref ref-type="bibr" rid="pcbi.1003824-Celeux1">[16]</xref>. We used this to approximate the posterior probabilities <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e130" xlink:type="simple"/></inline-formula> that voxel <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e131" xlink:type="simple"/></inline-formula> belongs to cluster <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e132" xlink:type="simple"/></inline-formula> at iteration <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e133" xlink:type="simple"/></inline-formula>. We also used a mean-field approximation to approximate the value of the intractable normalizing constant <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e134" xlink:type="simple"/></inline-formula> (details are given in the Appendix). Once the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e135" xlink:type="simple"/></inline-formula>'s are computed, we assign each voxel to the cluster <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e136" xlink:type="simple"/></inline-formula> for which this posterior probability is the highest.</p>
<p>After the E step, maximizing <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e137" xlink:type="simple"/></inline-formula> is relatively straightforward. For <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e138" xlink:type="simple"/></inline-formula>, once the the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e139" xlink:type="simple"/></inline-formula> have been computed during the E-step, we use those probabilities to assign each voxel to its cluster at iteration <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e140" xlink:type="simple"/></inline-formula>. Once the new partition is created, the maximization of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e141" xlink:type="simple"/></inline-formula> can be computed for cluster <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e142" xlink:type="simple"/></inline-formula> and gene <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e143" xlink:type="simple"/></inline-formula> with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e144" xlink:type="simple"/></inline-formula> the number of voxels expressing gene <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e145" xlink:type="simple"/></inline-formula> in cluster <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e146" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e147" xlink:type="simple"/></inline-formula> the total number of voxels in cluster <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e148" xlink:type="simple"/></inline-formula>.</p>
<p><disp-formula id="pcbi.1003824.e149"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003824.e149" xlink:type="simple"/></disp-formula></p>
<p>To maximize <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e150" xlink:type="simple"/></inline-formula>, we iteratively applied a gradient ascent algorithm, the positive version of the gradient descent algorithm <xref ref-type="bibr" rid="pcbi.1003824-Bishop1">[22]</xref> to the function <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e151" xlink:type="simple"/></inline-formula> for each <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e152" xlink:type="simple"/></inline-formula></p>
<p>A detailed description of the algorithm is described in <xref ref-type="supplementary-material" rid="pcbi.1003824.s001">Text S1</xref>.</p>
<sec id="s4a">
<title>Choosing K</title>
<p>To select the optimal number of clusters we used the BIC <xref ref-type="bibr" rid="pcbi.1003824-Michelson1">[45]</xref>, which finds the optimal number of clusters, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e153" xlink:type="simple"/></inline-formula>, by selecting the value of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e154" xlink:type="simple"/></inline-formula> that minimises its value. However, due to the symmetry of the brain we used a slightly different approach. As shown in <xref ref-type="fig" rid="pcbi-1003824-g014">Figure 14</xref> (blue dots), the BIC does not reach a clear minimum when applied to all voxels in the brain but instead reaches a plateau after a given number of clusters. This is most likely due to the highly, but not perfectly symmetrical nature of the brain: with a small <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e155" xlink:type="simple"/></inline-formula>, the same "tissue" on both the left and the right hand side of the brain will belong to the same cluster. However, because the two sides of the brain are not perfectly symmetrical, as <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e156" xlink:type="simple"/></inline-formula> increases the left and right part of the same "tissue" will be clustered separately. As a result, the likelihood continues to increase sufficiently to explain the flattened BIC curve. Moreover, this hypothesis seems to be confirmed by the fact that when computing the BIC on the right and left side of the brain separately, the curve has in both cases a clear minimum as shown in <xref ref-type="fig" rid="pcbi-1003824-g014">Figure 14</xref> (red and green dots). Given this, we opted to choose <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e157" xlink:type="simple"/></inline-formula> as the point where the BIC curve reaches a plateau.</p>
<fig id="pcbi-1003824-g014" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003824.g014</object-id><label>Figure 14</label><caption>
<title>BIC results on biological data.</title>
<p>Results are shown for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003824.e158" xlink:type="simple"/></inline-formula> (x axis) with the full brain, and the two left and right half separately. The y axis shows the BIC value in % of the highest BIC value for each dataset.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003824.g014" position="float" xlink:type="simple"/></fig></sec><sec id="s4b">
<title>Data and code availability</title>
<p>The data are available as a binarized datset of single cell gene expression data for the 86 genes in the brain of <italic>Platynereis dumerilii</italic>. An implementation of the EM algorithm in the C programming language is also available on the Github page of the project <xref ref-type="bibr" rid="pcbi.1003824-Project1">[52]</xref>.</p>
</sec></sec><sec id="s5">
<title>Supporting Information</title>
<supplementary-material id="pcbi.1003824.s001" mimetype="application/pdf" xlink:href="info:doi/10.1371/journal.pcbi.1003824.s001" position="float" xlink:type="simple"><label>Text S1</label><caption>
<p><bold>Mean field approximations and EM procedure.</bold> We provide more information about the mean field approximation used to estimate both the conditional probabilities of a voxel belonging to a particular cluster given the parameter values as well as the intractable normalizing constant. We also present pseudo-code to outline the EM Mean-field algorithm used in our HMRF implementation.</p>
<p>(PDF)</p>
</caption></supplementary-material></sec></body>
<back>
<ack>
<p>We acknowledge Stijn van Dongen and Detlev Arendt for helpful comments on the manuscript and all members of the Marioni laboratory for helpful suggestions.</p>
</ack>
<ref-list>
<title>References</title>
<ref id="pcbi.1003824-Montagna1"><label>1</label>
<mixed-citation publication-type="other" xlink:type="simple">Montagna W, Parakkal P (1974) Structure and function of skin. Elsevier.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Elowitz1"><label>2</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Elowitz</surname><given-names>MB</given-names></name>, <name name-style="western"><surname>Levine</surname><given-names>AJ</given-names></name>, <name name-style="western"><surname>Siggia</surname><given-names>ED</given-names></name>, <name name-style="western"><surname>Swain</surname><given-names>PS</given-names></name> (<year>2002</year>) <article-title>Stochastic gene expression in a single cell</article-title>. <source>Science</source> <volume>297</volume>: <fpage>1183</fpage>–<lpage>1186</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Tomer1"><label>3</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Tomer</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Denes</surname><given-names>AS</given-names></name>, <name name-style="western"><surname>Tessmar-Raible</surname><given-names>K</given-names></name>, <name name-style="western"><surname>Arendt</surname><given-names>D</given-names></name> (<year>2010</year>) <article-title>Profiling by image registration reveals common origin of annelid mushroom bodies and vertebrate pallium</article-title>. <source>Cell</source> <volume>142</volume>: <fpage>800</fpage>–<lpage>809</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Perou1"><label>4</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Perou</surname><given-names>CM</given-names></name>, <name name-style="western"><surname>Jeffrey</surname><given-names>SS</given-names></name>, <name name-style="western"><surname>Van De Rijn</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Rees</surname><given-names>CA</given-names></name>, <name name-style="western"><surname>Eisen</surname><given-names>MB</given-names></name>, <etal>et al</etal>. (<year>1999</year>) <article-title>Distinctive gene expression patterns in human mammary epithelial cells and breast cancers</article-title>. <source>Proceedings of the National Academy of Sciences USA</source> <volume>96</volume>: <fpage>9212</fpage>–<lpage>9217</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Tautz1"><label>5</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Tautz</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Pfeifle</surname><given-names>C</given-names></name> (<year>1989</year>) <article-title>A non-radioactive in situ hybridization method for the localization of specific RNAs in drosophila embryos reveals translational control of the segmentation gene hunchback</article-title>. <source>Chromosoma</source> <volume>98</volume>: <fpage>81</fpage>–<lpage>85</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Tang1"><label>6</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Tang</surname><given-names>F</given-names></name>, <name name-style="western"><surname>Barbacioru</surname><given-names>C</given-names></name>, <name name-style="western"><surname>Wang</surname><given-names>Y</given-names></name>, <name name-style="western"><surname>Nordman</surname><given-names>E</given-names></name>, <name name-style="western"><surname>Lee</surname><given-names>C</given-names></name>, <etal>et al</etal>. (<year>2009</year>) <article-title>mRNA-Seq wholetranscriptome analysis of a single cell</article-title>. <source>Nature Methods</source> <volume>6</volume>: <fpage>377</fpage>–<lpage>382</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Shapiro1"><label>7</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Shapiro</surname><given-names>E</given-names></name>, <name name-style="western"><surname>Biezuner</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Linnarsson</surname><given-names>S</given-names></name> (<year>2013</year>) <article-title>Single-cell sequencing-based technologies will revolutionize whole-organism science</article-title>. <source>Nature Reviews Genetics</source> <volume>14</volume>: <fpage>618</fpage>–<lpage>630</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Eisen1"><label>8</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Eisen</surname><given-names>MB</given-names></name>, <name name-style="western"><surname>Spellman</surname><given-names>PT</given-names></name>, <name name-style="western"><surname>Brown</surname><given-names>PO</given-names></name>, <name name-style="western"><surname>Botstein</surname><given-names>D</given-names></name> (<year>1998</year>) <article-title>Cluster analysis and display of genome-wide expression patterns</article-title>. <source>Proceedings of the National Academy of Sciences USA</source> <volume>95</volume>: <fpage>14863</fpage>–<lpage>14868</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Tavazoie1"><label>9</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Tavazoie</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Hughes</surname><given-names>JD</given-names></name>, <name name-style="western"><surname>Campbell</surname><given-names>MJ</given-names></name>, <name name-style="western"><surname>Cho</surname><given-names>RJ</given-names></name>, <name name-style="western"><surname>Church</surname><given-names>GM</given-names></name> (<year>1999</year>) <article-title>Systematic determination of genetic network architecture</article-title>. <source>Nature Genetics</source> <volume>22</volume>: <fpage>281</fpage>–<lpage>285</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Tamayo1"><label>10</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Tamayo</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Slonim</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Mesirov</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Zhu</surname><given-names>Q</given-names></name>, <name name-style="western"><surname>Kitareewan</surname><given-names>S</given-names></name>, <etal>et al</etal>. (<year>1999</year>) <article-title>Interpreting patterns of gene expression with self-organizing maps: methods and application to hematopoietic differentiation</article-title>. <source>Proceedings of the National Academy of Sciences USA</source> <volume>96</volume>: <fpage>2907</fpage>–<lpage>2912</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Lein1"><label>11</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Lein</surname><given-names>ES</given-names></name>, <name name-style="western"><surname>Hawrylycz</surname><given-names>MJ</given-names></name>, <name name-style="western"><surname>Ao</surname><given-names>N</given-names></name>, <name name-style="western"><surname>Ayres</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Bensinger</surname><given-names>A</given-names></name>, <etal>et al</etal>. (<year>2007</year>) <article-title>Genome-wide atlas of gene expression in the adult mouse brain</article-title>. <source>Nature</source> <volume>445</volume>: <fpage>168</fpage>–<lpage>176</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Eberwine1"><label>12</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Eberwine</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Sul</surname><given-names>JY</given-names></name>, <name name-style="western"><surname>Bartfai</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Kim</surname><given-names>J</given-names></name> (<year>2014</year>) <article-title>The promise of single-cell sequencing</article-title>. <source>Nature Methods</source> <volume>11</volume>: <fpage>25</fpage>–<lpage>27</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Dang1"><label>13</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Dang</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Govaert</surname><given-names>G</given-names></name> (<year>1998</year>) <article-title>Spatial fuzzy clustering using EM and markov random fields</article-title>. <source>International Journal of System Research and Information Science</source> <volume>8</volume>: <fpage>183</fpage>–<lpage>202</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Ising1"><label>14</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Ising</surname><given-names>E</given-names></name> (<year>1925</year>) <article-title>Beitrag zur Theorie des Ferromagnetismus</article-title>. <source>Zeitschrift für Physik A Hadrons and Nuclei</source> <volume>31</volume>: <fpage>253</fpage>–<lpage>258</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Wu1"><label>15</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Wu</surname><given-names>FY</given-names></name> (<year>1982</year>) <article-title>The Potts model</article-title>. <source>Reviews of modern physics</source> <volume>54</volume>: <fpage>235</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Celeux1"><label>16</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Celeux</surname><given-names>G</given-names></name>, <name name-style="western"><surname>Forbes</surname><given-names>F</given-names></name>, <name name-style="western"><surname>Peyrard</surname><given-names>N</given-names></name> (<year>2003</year>) <article-title>EM procedures using mean field-like approximations for Markov model-based image segmentation</article-title>. <source>Pattern recognition</source> <volume>36</volume>: <fpage>131</fpage>–<lpage>144</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Fischer1"><label>17</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Fischer</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Henrich</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Arendt</surname><given-names>D</given-names></name> (<year>2010</year>) <article-title>The normal development of Platynereis dumerilii (Nereididae, Annelida)</article-title>. <source>Frontiers in zoology</source> <volume>7</volume>: <fpage>31</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Arendt1"><label>18</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Arendt</surname><given-names>D</given-names></name> (<year>2005</year>) <article-title>Platynereis dumerilii: a living fossil elucidating the evolution of genomes and of the CNS</article-title>. <source>Theory in Biosciences</source> <volume>124</volume>: <fpage>185</fpage>–<lpage>197</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Li1"><label>19</label>
<mixed-citation publication-type="other" xlink:type="simple">Li SZ, Singh S (2009) Markov random field modeling in image analysis, volume 3. Springer.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Rozanov1"><label>20</label>
<mixed-citation publication-type="other" xlink:type="simple">Rozanov YA (1982) Markov random fields. Springer.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Li2"><label>21</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Li</surname><given-names>H</given-names></name>, <name name-style="western"><surname>Kallergi</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Clarke</surname><given-names>L</given-names></name>, <name name-style="western"><surname>Jain</surname><given-names>V</given-names></name>, <name name-style="western"><surname>Clark</surname><given-names>R</given-names></name> (<year>1995</year>) <article-title>Markov random field for tumor detection in digital mammography</article-title>. <source>IEEE Transactions on Medical Imaging</source> <volume>14</volume>: <fpage>565</fpage>–<lpage>576</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Bishop1"><label>22</label>
<mixed-citation publication-type="other" xlink:type="simple">Bishop CM, et al. (2006) Pattern recognition and machine learning, volume 1. New York: Springer.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Zhang1"><label>23</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Zhang</surname><given-names>Y</given-names></name>, <name name-style="western"><surname>Brady</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Smith</surname><given-names>S</given-names></name> (<year>2001</year>) <article-title>Segmentation of brain MR images through a hidden Markov random field model and the expectation-maximization algorithm</article-title>. <source>IEEE Transactions on Medical Imaging</source> <volume>20</volume>: <fpage>45</fpage>–<lpage>57</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Paulsen1"><label>24</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Paulsen</surname><given-names>RR</given-names></name>, <name name-style="western"><surname>Baerentzen</surname><given-names>JA</given-names></name>, <name name-style="western"><surname>Larsen</surname><given-names>R</given-names></name> (<year>2010</year>) <article-title>Markov random field surface reconstruction</article-title>. <source>IEEE Transactions on Visualization and Computer Graphics</source> <volume>16</volume>: <fpage>636</fpage>–<lpage>646</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Zerubia1"><label>25</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Zerubia</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Chellappa</surname><given-names>R</given-names></name> (<year>1993</year>) <article-title>Mean field annealing using compound Gauss-Markov random fields for edge detection and image estimation</article-title>. <source>IEEE Transactions on Neural Networks</source> <volume>4</volume>: <fpage>703</fpage>–<lpage>709</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Clausi1"><label>26</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Clausi</surname><given-names>DA</given-names></name>, <name name-style="western"><surname>Yue</surname><given-names>B</given-names></name> (<year>2004</year>) <article-title>Comparing cooccurrence probabilities and Markov random fields for texture analysis of SAR sea ice imagery</article-title>. <source>IEEE Transactions on Geoscience and Remote Sensing</source> <volume>42</volume>: <fpage>215</fpage>–<lpage>228</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Heitz1"><label>27</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Heitz</surname><given-names>F</given-names></name>, <name name-style="western"><surname>Bouthemy</surname><given-names>P</given-names></name> (<year>1993</year>) <article-title>Multimodal estimation of discontinuous optical flow using Markov random fields</article-title>. <source>IEEE Transactions on Pattern Analysis and Machine Intelligence</source> <volume>15</volume>: <fpage>1217</fpage>–<lpage>1232</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-MartnFernndez1"><label>28</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Martın-Fernández</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Alberola Lopez</surname><given-names>C</given-names></name> (<year>2005</year>) <article-title>An approach for contour detection of human kidneys from ultrasound images using Markov random fields and active contours</article-title>. <source>Medical Image Analysis</source> <volume>9</volume>: <fpage>1</fpage>–<lpage>23</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Mignotte1"><label>29</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Mignotte</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Meunier</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Tardif</surname><given-names>JC</given-names></name> (<year>2001</year>) <article-title>Endocardial boundary e timation and tracking in echocardiographic images using deformable template and markov random fields</article-title>. <source>Pattern Analysis &amp; Applications</source> <volume>4</volume>: <fpage>256</fpage>–<lpage>271</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Wright1"><label>30</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Wright</surname><given-names>W</given-names></name> (<year>1989</year>) <article-title>A Markov random field approach to data fusion and colour segmentation</article-title>. <source>Image and vision computing</source> <volume>7</volume>: <fpage>144</fpage>–<lpage>150</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Fields1"><label>31</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Fields</surname><given-names>SUMR</given-names></name> (<year>1997</year>) <article-title>Perceptual grouping of contour segments using markov random fields</article-title>. <source>Pattern Recognition and Image Analysis</source> <volume>7</volume>: <fpage>11</fpage>–<lpage>17</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Held1"><label>32</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Held</surname><given-names>K</given-names></name>, <name name-style="western"><surname>Kops</surname><given-names>ER</given-names></name>, <name name-style="western"><surname>Krause</surname><given-names>BJ</given-names></name>, <name name-style="western"><surname>Wells</surname><given-names>W</given-names></name>, <name name-style="western"><surname>Kikinis</surname><given-names>R</given-names></name>, <etal>et al</etal>. (<year>1997</year>) <article-title>Markov random field segmentation of brain MR images</article-title>. <source>IEEE Transactions on Medical Imaging</source> <volume>16</volume>: <fpage>878</fpage>–<lpage>886</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Descombes1"><label>33</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Descombes</surname><given-names>X</given-names></name>, <name name-style="western"><surname>Kruggel</surname><given-names>F</given-names></name>, <name name-style="western"><surname>von Cramon</surname><given-names>DY</given-names></name> (<year>1998</year>) <article-title>Spatio-temporal fMRI analysis using Markov random fields</article-title>. <source>IEEE Transactions on Medical Imaging</source> <volume>17</volume>: <fpage>1028</fpage>–<lpage>1039</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Wei1"><label>34</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Wei</surname><given-names>Z</given-names></name>, <name name-style="western"><surname>Li</surname><given-names>H</given-names></name> (<year>2007</year>) <article-title>A Markov random field model for network-based analysis of genomic data</article-title>. <source>Bioinformatics</source> <volume>23</volume>: <fpage>1537</fpage>–<lpage>1544</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-VossBohme1"><label>35</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Voss-Bohme</surname><given-names>A</given-names></name> (<year>2012</year>) <article-title>Multi-Scale Modeling in Morphogenesis: A Critical Analaysis of the Cellular Potts Model</article-title>. <source>PLoS One</source> <volume>7</volume>: <fpage>e42852</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Subudhi1"><label>36</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Subudhi</surname><given-names>BN</given-names></name>, <name name-style="western"><surname>Bovolo</surname><given-names>F</given-names></name>, <name name-style="western"><surname>Ghosh</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Bruzzone</surname><given-names>L</given-names></name> (<year>2014</year>) <article-title>Spatio-contextual fuzzy clustering with markov random field model for change detection in remotely sensed images</article-title>. <source>Optics &amp; Laser Technology</source> <volume>57</volume>: <fpage>284</fpage>–<lpage>292</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Zhang2"><label>37</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Zhang</surname><given-names>H</given-names></name>, <name name-style="western"><surname>Shi</surname><given-names>W</given-names></name>, <name name-style="western"><surname>Wang</surname><given-names>Y</given-names></name>, <name name-style="western"><surname>Hao</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Miao</surname><given-names>Z</given-names></name> (<year>2014</year>) <article-title>Spatial-attraction-based Markov random field approach for classification of high spatial resolution multispectral imagery</article-title>. <source>IEEE Geoscience and Remote Sensing Letters</source> <volume>11</volume>: <fpage>489</fpage>–<lpage>493</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Chalmond1"><label>38</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Chalmond</surname><given-names>B</given-names></name> (<year>1989</year>) <article-title>An iterative Gibbsian technique for reconstruction of m-ary images</article-title>. <source>Pattern recognition</source> <volume>22</volume>: <fpage>747</fpage>–<lpage>761</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Biernacki1"><label>39</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Biernacki</surname><given-names>C</given-names></name>, <name name-style="western"><surname>Celeux</surname><given-names>G</given-names></name>, <name name-style="western"><surname>Govaert</surname><given-names>G</given-names></name> (<year>2003</year>) <article-title>Choosing starting values for the EM algorithm for getting the highest likelihood in multivariate gaussian mixture models</article-title>. <source>Computational Statistics &amp; Data Analysis</source> <volume>41</volume>: <fpage>561</fpage>–<lpage>575</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Karlis1"><label>40</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Karlis</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Xekalaki</surname><given-names>E</given-names></name> (<year>2003</year>) <article-title>Choosing initial values for the EM algorithm for finite mixtures</article-title>. <source>Computational Statistics &amp; Data Analysis</source> <volume>41</volume>: <fpage>577</fpage>–<lpage>590</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-McLachlan1"><label>41</label>
<mixed-citation publication-type="other" xlink:type="simple">McLachlan G, Peel D (2004) Finite mixture models. John Wiley &amp; Sons.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Terakita1"><label>42</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Terakita</surname><given-names>A</given-names></name> (<year>2005</year>) <article-title>The opsins</article-title>. <source>Genome Biology</source> <volume>6</volume>: <fpage>213</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Randel1"><label>43</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Randel</surname><given-names>N</given-names></name>, <name name-style="western"><surname>Bezares-Calderón</surname><given-names>LA</given-names></name>, <name name-style="western"><surname>Gühmann</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Shahidi</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Jékely</surname><given-names>G</given-names></name> (<year>2013</year>) <article-title>Expression dynamics and protein localization of rhabdomeric opsins in platynereis larvae</article-title>. <source>Integrative and comparative biology</source> <volume>53</volume>: <fpage>7</fpage>–<lpage>16</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Weintraub1"><label>44</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Weintraub</surname><given-names>H</given-names></name>, <name name-style="western"><surname>Davis</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Tapscott</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Thayer</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Krause</surname><given-names>M</given-names></name>, <etal>et al</etal>. (<year>1991</year>) <article-title>The myoD gene family: nodal point during specification of the muscle cell lineage</article-title>. <source>Science</source> <volume>251</volume>: <fpage>761</fpage>–<lpage>766</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Michelson1"><label>45</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Michelson</surname><given-names>AM</given-names></name>, <name name-style="western"><surname>Abmayr</surname><given-names>SM</given-names></name>, <name name-style="western"><surname>Bate</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Arias</surname><given-names>AM</given-names></name>, <name name-style="western"><surname>Maniatis</surname><given-names>T</given-names></name> (<year>1990</year>) <article-title>Expression of a MyoD family member prefigures muscle pattern in Drosophila embryos</article-title>. <source>Genes &amp; Development</source> <volume>4</volume>: <fpage>2086</fpage>–<lpage>2097</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Krcmery1"><label>46</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Krcmery</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Camarata</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Kulisz</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Simon</surname><given-names>HG</given-names></name> (<year>2010</year>) <article-title>Nucleocytoplasmic functions of the PDZ-LIM protein family: new insights into organ development</article-title>. <source>Bioessays</source> <volume>32</volume>: <fpage>100</fpage>–<lpage>108</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Marziliano1"><label>47</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Marziliano</surname><given-names>N</given-names></name>, <name name-style="western"><surname>Mannarino</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Nespoli</surname><given-names>L</given-names></name>, <name name-style="western"><surname>Diegoli</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Pasotti</surname><given-names>M</given-names></name>, <etal>et al</etal>. (<year>2007</year>) <article-title>Barth syndrome associated with compound hemizygosity and heterozygosity of the TAZ and LDB3 genes</article-title>. <source>American Journal of Medical Genetics Part A</source> <volume>143</volume>: <fpage>907</fpage>–<lpage>915</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Brunet1"><label>48</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Brunet</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Pattyn</surname><given-names>A</given-names></name> (<year>2002</year>) <article-title>Phox2 genes-from patterning to connectivity</article-title>. <source>Current Opinion in Genetics &amp; Development</source> <volume>12</volume>: <fpage>435</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Briscoe1"><label>49</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Briscoe</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Sussel</surname><given-names>L</given-names></name>, <name name-style="western"><surname>Serup</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Hartigan-O'Connor</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Jessell</surname><given-names>T</given-names></name>, <etal>et al</etal>. (<year>1999</year>) <article-title>Homeobox gene Nkx2. 2 and specification of neuronal identity by graded Sonic hedgehog signalling</article-title>. <source>Nature</source> <volume>398</volume>: <fpage>622</fpage>–<lpage>627</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Demilly1"><label>50</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Demilly</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Simionato</surname><given-names>E</given-names></name>, <name name-style="western"><surname>Ohayon</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Kerner</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Garcès</surname><given-names>A</given-names></name>, <etal>et al</etal>. (<year>2011</year>) <article-title>Coe genes are expressed in differentiating neurons in the central nervous system of protostomes</article-title>. <source>PLoS One</source> <volume>6</volume>: <fpage>e21213</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Dempster1"><label>51</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Dempster</surname><given-names>AP</given-names></name>, <name name-style="western"><surname>Laird</surname><given-names>NM</given-names></name>, <name name-style="western"><surname>Rubin</surname><given-names>DB</given-names></name>, <etal>et al</etal>. (<year>1977</year>) <article-title>Maximum likelihood from incomplete data via the EM algorithm</article-title>. <source>Journal of the Royal Statistical Society</source> <volume>39</volume>: <fpage>1</fpage>–<lpage>38</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Project1"><label>52</label>
<mixed-citation publication-type="other" xlink:type="simple">Project source on github. URL <ext-link ext-link-type="uri" xlink:href="https://github.com/jbogp/MRF_Platynereis_2014" xlink:type="simple">https://github.com/jbogp/MRF_Platynereis_2014</ext-link>.</mixed-citation>
</ref>
<ref id="pcbi.1003824-Pettit1"><label>53</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Pettit</surname><given-names>JB</given-names></name>, <name name-style="western"><surname>Marioni</surname><given-names>JC</given-names></name> (<year>2013</year>) <article-title>bioWeb3D: an online webGL 3D data visualisation tool</article-title>. <source>BMC Bioinformatics</source> <volume>14</volume>: <fpage>185</fpage>.</mixed-citation>
</ref>
</ref-list></back>
</article>