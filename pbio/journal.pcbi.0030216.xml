<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article
  PUBLIC "-//NLM//DTD Journal Publishing DTD v3.0 20080202//EN" "http://dtd.nlm.nih.gov/publishing/3.0/journalpublishing3.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="3.0" xml:lang="EN"><front><journal-meta><journal-id journal-id-type="publisher-id">plos</journal-id><journal-id journal-id-type="publisher">pcbi</journal-id><journal-id journal-id-type="allenpress-id">plcb</journal-id><journal-id journal-id-type="nlm-ta">PLoS Comput Biol</journal-id><journal-id journal-id-type="pmc">ploscomp</journal-id><!--===== Grouping journal title elements =====--><journal-title-group><journal-title>PLoS Computational Biology</journal-title></journal-title-group><issn pub-type="ppub">1553-734X</issn><issn pub-type="epub">1553-7358</issn><publisher><publisher-name>Public Library of Science</publisher-name><publisher-loc>San Francisco, USA</publisher-loc></publisher></journal-meta><article-meta><article-id pub-id-type="doi">10.1371/journal.pcbi.0030216</article-id><article-id pub-id-type="publisher-id">07-PLCB-RA-0296R2</article-id><article-id pub-id-type="sici">plcb-03-11-15</article-id><article-categories><subj-group subj-group-type="heading"><subject>Research Article</subject></subj-group><subj-group subj-group-type="Discipline"><subject>Computational Biology</subject><subject>Computational Biology</subject><subject>Computational Biology</subject><subject>Evolutionary Biology</subject><subject>Evolutionary Biology</subject></subj-group><subj-group subj-group-type="System Taxonomy"><subject>Drosophila</subject></subj-group></article-categories><title-group><article-title>MORPH: Probabilistic Alignment Combined with Hidden Markov Models of <italic>cis</italic>-Regulatory Modules</article-title><alt-title alt-title-type="running-head">Probabilistic Alignment of CRMs</alt-title></title-group><contrib-group><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Sinha</surname><given-names>Saurabh</given-names></name><xref ref-type="corresp" rid="cor1">
            <sup>
            <sup>*</sup>
          </sup>
          </xref><xref ref-type="aff" rid="aff1"/></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>He</surname><given-names>Xin</given-names></name><xref ref-type="aff" rid="aff1"/></contrib></contrib-group><aff id="aff1">
        <label>1</label>
        <addr-line>Department of Computer Science, University of Illinois at Urbana-Champaign, Urbana, Illinois, United States of America</addr-line>
      </aff><contrib-group><contrib contrib-type="editor" xlink:type="simple"><name name-style="western"><surname>Pilpel</surname><given-names>Yitzhak</given-names></name><role>Editor</role><xref ref-type="aff" rid="edit1"/></contrib></contrib-group><aff id="edit1">Weizmann Institute of Science, Israel</aff><author-notes><corresp id="cor1">* To whom correspondence should be addressed. E-mail: <email xlink:type="simple">sinhas@cs.uiuc.edu</email></corresp><fn fn-type="con" id="ack1"><p> SS conceived and designed the experiments, performed the experiments, and contributed reagents/materials/analysis tools. SS and XH analyzed the data and wrote the paper.</p></fn><fn fn-type="conflict" id="ack3"><p> The authors have declared that no competing interests exist.</p></fn></author-notes><pub-date pub-type="ppub"><month>11</month><year>2007</year></pub-date><pub-date pub-type="epub"><day>9</day><month>11</month><year>2007</year></pub-date><pub-date pub-type="epreprint"><day>24</day><month>9</month><year>2007</year></pub-date><volume>3</volume><issue>11</issue><elocation-id>e216</elocation-id><history><date date-type="received"><day>30</day><month>5</month><year>2007</year></date><date date-type="accepted"><day>21</day><month>9</month><year>2007</year></date></history><!--===== Grouping copyright info into permissions =====--><permissions><copyright-year>2007</copyright-year><copyright-holder> Sinha and He</copyright-holder><license><license-p>This is an open-access article distributed under the terms of the Creative Commons Attribution License, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p></license></permissions><abstract><p>The discovery and analysis of <italic>cis-</italic>regulatory modules (CRMs) in metazoan genomes is crucial for understanding the transcriptional control of development and many other biological processes. Cross-species sequence comparison holds much promise for improving computational prediction of CRMs, for elucidating their binding site composition, and for understanding how they evolve. Current methods for analyzing orthologous CRMs from multiple species rely upon sequence alignments produced by off-the-shelf alignment algorithms, which do not exploit the presence of binding sites in the sequences. We present here a unified probabilistic framework, called MORPH, that integrates the alignment task with binding site predictions, allowing more robust CRM analysis in two species. The framework sums over all possible alignments of two sequences, thus accounting for alignment ambiguities in a natural way. We perform extensive tests on orthologous CRMs from two moderately diverged species <named-content content-type="genus-species" xlink:type="simple">Drosophila melanogaster</named-content> and <named-content content-type="genus-species" xlink:type="simple">D. mojavensis</named-content>, to demonstrate the advantages of the new approach. We show that it can overcome certain computational artifacts of traditional alignment tools and provide a different, likely more accurate, picture of <italic>cis-</italic>regulatory evolution than that obtained from existing methods. The burgeoning field of <italic>cis-</italic>regulatory evolution, which is amply supported by the availability of many related genomes, is currently thwarted by the lack of accurate alignments of regulatory regions. Our work will fill in this void and enable more reliable analysis of CRM evolution.</p></abstract><abstract abstract-type="summary"><title>Author Summary</title><sec id="st1"><title/><p>Interspecies comparison of regulatory sequences is a major focus in the bioinformatics community today. There is extensive ongoing effort toward measuring the extent and patterns of binding site turnover in <italic>cis-</italic>regulatory modules. A major roadblock in such an analysis has been the fact that traditional alignment methods are not very accurate for regulatory sequences. This is partly because the alignment is performed independently from the binding site predictions and turnover analysis. This article describes a new computational method to compare and align two orthologous regulatory sequences. It uses a unified probabilistic framework to perform alignment and binding site prediction simultaneously, rather than one after the other. Predictions of binding sites and their evolutionary relationships are obtained after summing over all possible alignments, making them robust to alignment ambiguities. The method can also be used to predict new <italic>cis-</italic>regulatory modules. The article presents extensive applications of the method on synthetic as well as real data. These include the analysis of over 200 <italic>cis-</italic>regulatory modules in <named-content content-type="genus-species" xlink:type="simple">D. melanogaster</named-content> and their orthologs in <named-content content-type="genus-species" xlink:type="simple">D. mojavensis</named-content>. This analysis reveals a significantly greater degree of conservation of binding sites between these two species than will be inferred from existing alignment tools.</p></sec></abstract><funding-group><funding-statement> The authors received no specific funding for this study. XH was supported by a National Science Foundation Frontiers in Integrative Biological Research grant (BeeSpace).</funding-statement></funding-group><counts><page-count count="15"/></counts><!--===== Restructure custom-meta-wrap to custom-meta-group =====--><custom-meta-group><custom-meta><meta-name>citation</meta-name><meta-value>Sinha S, He X (2007) MORPH: Probabilistic alignment combined with hidden Markov models of <italic>cis-</italic>regulatory modules. PLoS Comput Biol 3(11): e216. doi:<ext-link ext-link-type="doi" xlink:href="http://dx.doi.org/10.1371/journal.pcbi.0030216" xlink:type="simple">10.1371/journal.pcbi.0030216</ext-link></meta-value></custom-meta></custom-meta-group></article-meta></front><body><sec id="s1"><title>Introduction</title><p>Two-sequence alignment has been an indispensable tool in the bioinformatician's repertoire for nearly two decades now [<xref ref-type="bibr" rid="pcbi-0030216-b001">1</xref>,<xref ref-type="bibr" rid="pcbi-0030216-b002">2</xref>]. With scientific interest swinging toward the noncoding part of the genome, there has been a recent upsurge in adapting alignment algorithms beyond the usual tasks of identifying gene or protein orthologs. In the absence of the relatively rigid organization of coding sequences, noncoding sequences are often hard to align over moderate evolutionary divergences. Even in cases in which sequence homology is established on the scale of, say, a few hundred base pairs, the actual alignment of these orthologous noncoding sequences is ambiguous. This in turn impedes comparative analysis of <italic>cis-</italic>regulatory sequences, which relies on an accurate knowledge of base-level orthology. The natural response to this challenge has been the proposal of probabilistic alignment methods that can, for example, provide a confidence value on any two bases being aligned (orthologous) without committing to any single “best” alignment. We shall see below some of the successful manifestations of this idea.</p><p>A somewhat orthogonal line of research with respect to noncoding sequence analysis has been the search for <italic>cis-</italic>regulatory modules or CRMs (sometimes called enhancers) by scanning for statistically significant clusters of transcription factor binding sites, which in turn are detected by sequence similarity to a priori known “motifs.” Discovery of CRMs has played a key role in understanding gene regulation in metazoa, especially the fruitfly [<xref ref-type="bibr" rid="pcbi-0030216-b003">3</xref>] and the sea urchin [<xref ref-type="bibr" rid="pcbi-0030216-b004">4</xref>]. Although the earliest genome-wide computational scans for CRMs were based on counting high-quality matches to the motifs [<xref ref-type="bibr" rid="pcbi-0030216-b005">5</xref>,<xref ref-type="bibr" rid="pcbi-0030216-b006">6</xref>], it was not long before probabilistic approaches permeated this area, and efficient implementations of Hidden Markov models (HMMs) led to CRM discovery with high sensitivity [<xref ref-type="bibr" rid="pcbi-0030216-b007">7</xref>,<xref ref-type="bibr" rid="pcbi-0030216-b008">8</xref>]. The application of HMMs to CRMs allows us to consider all possible ways of “parsing” a CRM as a collection of binding sites interspersed with random bases, while weighting each parse by a probabilistic score. It was shown previously [<xref ref-type="bibr" rid="pcbi-0030216-b009">9</xref>] how the HMM framework can be integrated with multispecies comparison, in an algorithm called “Stubb,” in order to improve CRM discovery. This is achieved by using sequence alignment as a first step, and modeling aligned binding sites by a stochastic model of binding site evolution. One limitation of this algorithm is that it assumes that the correct alignment can be computed (e.g., by using the alignment program LAGAN [<xref ref-type="bibr" rid="pcbi-0030216-b010">10</xref>]) in its first step.</p><p>Here, we combine the two seemingly separate ideas mentioned above—probabilistic alignment of two sequences and probabilistic analysis of CRMs—into an integrated probabilistic framework. The new framework provides a robust way to compare CRMs across moderate evolutionary distances at which sequence-level regulatory changes are prominent and tractable. We implement efficient procedures for learning the parameters of the model, based on the expectation-maximization (E-M) technique. Two programs with related but somewhat distinct functionalities are made available: (1) the “MorphMS” program predicts CRMs located within a pair of orthologous sequences, whereas (2) the Morphalign program constructs an alignment of two given sequences and uses a novel display format to point out the ambiguities in the alignment as well as the locations of putative binding sites. Both programs require as input a set of transcription factor binding motifs that the user is interested in. All parameters of the model, except for the length of CRMs to be predicted by MorphMS, can be automatically learned from the data. The alignments produced by the Morphalign program are viewable in the highly portable HTML format, and both MorphMS and Morphalign are available for download as source code (see Supplementary Materials at our site <ext-link ext-link-type="uri" xlink:href="http://veda.cs.uiuc.edu/Morphalign/supplement/" xlink:type="simple">http://veda.cs.uiuc.edu/Morphalign/supplement/</ext-link> (<ext-link ext-link-type="uri" xlink:href="http://rd.plos.org/pcbi_0030216_0001" xlink:type="simple">http://rd.plos.org. pcbi_0030216_0001</ext-link>).</p><p>We first use synthetic data to demonstrate that the new probabilistic model, henceforth called the MORPH framework, can lead to highly significant improvement in (1) alignment accuracy on <italic>cis-</italic>regulatory sequences, as compared to a state-of-the-art alignment program, and (2) binding site prediction accuracy, as compared to an HMM-based program (Stubb [<xref ref-type="bibr" rid="pcbi-0030216-b009">9</xref>]) that works with a fixed alignment. We next apply the framework to a comprehensive collection of CRMs in two species of fruitfly—<named-content content-type="genus-species" xlink:type="simple">D. melanogaster</named-content> and <named-content content-type="genus-species" xlink:type="simple">D. mojavensis</named-content>—and present our alignments and binding site predictions through a Web interface. We demonstrate a remarkable improvement in CRM prediction accuracy, for this dataset, over that from the HMM-based Stubb program. We find that probabilistically summing over all possible alignments and using binding sites during alignment provide a very different picture of orthologous CRM relationships than existing approaches. We show that this greatly affects the conclusions one draws about binding site loss and gain between species. We expect the MORPH framework to strongly impact future studies on <italic>cis-</italic>regulatory evolution and binding site turnover.</p><sec id="s1a"><title>Previous Work</title><p>Sequence alignment is an intensely researched topic with several major achievements, and we refer the reader to [<xref ref-type="bibr" rid="pcbi-0030216-b011">11</xref>] for a review of this field. The highly popular, scoring function–based alignment method of Needleman and Wunsch [<xref ref-type="bibr" rid="pcbi-0030216-b001">1</xref>] has a natural extension to probabilistic methods, as shown by Holmes and Durbin [<xref ref-type="bibr" rid="pcbi-0030216-b012">12</xref>]. They modeled alignment generation as a first-order Markov process involving three states called “Match,” “Insert,” and “Delete,” with the Match state generating aligned pairs of bases and the latter two states emitting gap-aligned bases. This type of model, called pair-HMM, has been used in a number of studies, with differences in the model details. For example, the ProbCons algorithm of Do et al. [<xref ref-type="bibr" rid="pcbi-0030216-b013">13</xref>] uses the same Match, Insert, and Delete states as in [<xref ref-type="bibr" rid="pcbi-0030216-b012">12</xref>,<xref ref-type="bibr" rid="pcbi-0030216-b014">14</xref>], but does not allow any direct transitions between Insert and Delete states.</p><p>Another class of probabilistic methods, called statistical alignment, uses an evolutionarily motivated stochastic process of indels (insertions and deletions) to construct the maximum-likelihood alignment. Earlier work in this class, including TKF91 model [<xref ref-type="bibr" rid="pcbi-0030216-b015">15</xref>] and its equivalent HMM formulation [<xref ref-type="bibr" rid="pcbi-0030216-b016">16</xref>], is based on a simple indel process, where at each position, a single nucleotide is randomly inserted or deleted following a Poisson process. Later work improves the model by allowing insertions or deletions of multiple nucleotides as a single event, and a pair-HMM approximation of this complicated stochastic process has been used in [<xref ref-type="bibr" rid="pcbi-0030216-b017">17</xref>,<xref ref-type="bibr" rid="pcbi-0030216-b018">18</xref>]. The main advantage of the pair-HMM and/or statistical alignment methods is that the parameters—the transition probabilities, indel length distribution parameter (often assumed to be geometric), and sometimes the nucleotide emission probabilities—can all be estimated automatically from the input sequences, using maximum likelihood method, without external training. We borrow the pair-HMM framework in the alignment model of MORPH.</p><p>Our previously published probabilistic method called Stubb [<xref ref-type="bibr" rid="pcbi-0030216-b009">9</xref>] comes closest to how the MORPH framework deals with <italic>cis-</italic>regulatory sequences from two species. As mentioned above, Stubb first finds the optimal scoring alignment using a standard alignment program such as LAGAN [<xref ref-type="bibr" rid="pcbi-0030216-b010">10</xref>], and fixes this alignment. It then uses a probabilistic model that generates orthologous CRMs by transitioning among “motif” and “background” states, and sampling binding sites or “background” nucleotides (respectively) from appropriate emission probability distributions. When generating aligned positions, the orthology of binding sites is modeled using a simple stochastic model parameterized by the known sequence specificity (motif) of the binding sites. The MORPH framework uses exactly the same model for generating orthologous CRMs, except that the alignment is not fixed in the first step, and is modeled probabilistically as explained in the previous paragraphs.</p><p>One of the first attempts to couple alignment with binding site predictions was made in the program CONREAL [<xref ref-type="bibr" rid="pcbi-0030216-b019">19</xref>]. This program predicts binding sites from a given set of position weight matrices (PWMs), and uses pairs of conserved binding sites to serve as anchors in a traditional sequence alignment algorithm. Recently, a method called EEL [<xref ref-type="bibr" rid="pcbi-0030216-b020">20</xref>] has been proposed to predict <italic>cis-</italic>regulatory sequences while constructing sequence alignment at the same time, an objective that overlaps with ours. It first scans the given pair of orthologous sequences to find all putative binding sites, and then applies the Smith-Waterman dynamic programming algorithm to the sequences of binding sites. That is, the binding sites are the basic units (symbols) to be aligned, not nucleotides. The alignment parameters, in particular the penalty for changed spacing between two adjacent pairs of aligned binding sites, are estimated from external data. Our probabilistic framework MORPH offers several important advantages over such a method: (1) the uncertainty in assigning binding sites is handled by using a probabilistic model for CRM, so no cutoff is needed for determining binding sites; (2) the parameters in the model are automatically estimated; and (3) the ambiguity in alignment as well as binding site annotation can be precisely quantified using probabilities (see below). Additionally, MORPH simultaneously considers both background sequences and binding sites for alignment, unlike EEL, which ignores the non-site sequences.</p></sec></sec><sec id="s2"><title>Results/Discussion</title><sec id="s2a"><title>Model</title><p>We begin by describing the probabilistic process (the “MORPH” model) that generates two orthologous sequences (CRMs), given a set of transcription factor binding motifs in the form of their PWMs [<xref ref-type="bibr" rid="pcbi-0030216-b021">21</xref>]. A PWM specifies the probability distribution of nucleotides at each position of the binding site and is typically determined from multiple alignments of experimentally characterized binding sites. Motif databases such as TRANSFAC [<xref ref-type="bibr" rid="pcbi-0030216-b022">22</xref>], JASPAR [<xref ref-type="bibr" rid="pcbi-0030216-b023">23</xref>], and FlyReg [<xref ref-type="bibr" rid="pcbi-0030216-b024">24</xref>] also provide such PWMs.</p><p>Here, we provide an informal description of the MORPH model, and leave the detailed description for Materials and Methods. At the outer level of the model, we use a first-order Markov process with three states: Match, Delete, and Insert. The Match state corresponds to aligned positions and emits two equal-length strings (one for each species). The Delete and Insert states correspond to unaligned positions in either species and emit a string that will be appended to the first or second species' sequence, respectively. Thus, this outer level of the model generates alignments with blocks of aligned positions separated by unaligned strings in either or both species.</p><p>The string emitted in any of the three states of the above process is chosen by another probabilistic process, which models the interspersed arrangement of binding sites and non-binding “background” sequence in the CRMs. This process first chooses a particular motif and samples a string from the probability distribution prescribed by that motif (PWM). In the Match state, the sampled string is “evolved” using an evolutionary model to obtain two related strings that are then emitted. The motif choices available include all input PWMs as well as a single-column “background” PWM that models random sequence.</p><p>The model parameters include all transition probabilities among the Match, Insert, and Delete states, as well as the transition probabilities into each motif state. These parameters are trained using an E-M strategy employing dynamic programming for efficient calculations. For the two evolutionarily related strings emitted from a Match state, there is a model parameter representing evolutionary divergence of the species. This is either user-specified (e.g., by using the PAML package [<xref ref-type="bibr" rid="pcbi-0030216-b025">25</xref>] to estimate neutral substitution probabilities), or it can be automatically learned from the data.</p><p>A note regarding the semantics of the alignment generating process is in order. In previous work on probabilistic alignment, such as Holmes and Durbin [<xref ref-type="bibr" rid="pcbi-0030216-b012">12</xref>], all transitions (among the three states Match, Insert, and Delete) are allowed, except for Insert → Delete. The pairwise alignment is viewed here as comprising (1) blocks of successive aligned positions and (2) unaligned sequences in both species separating them. For the unaligned sequences between any two blocks, there is no notion of the order in which they were generated in the two species. Hence, we may arbitrarily assume that the entire interblock sequence in the first species was generated first, followed by the entire interblock sequence in the second species. This is represented by a Delete → Insert state transition. The same semantics of unaligned sequences are adopted in the MORPH framework.</p></sec><sec id="s2b"><title>Experiments with Synthetic Data</title><p>We first performed extensive experiments with synthetic datasets, where “orthologous CRMs” were generated artificially. Testing on synthetic data has become a common practice in evaluation of bioinformatics algorithms today, offering the following advantages: (1) the correct answers are known in synthetic data, (2) the datasets are created with complete control over different aspects of the signal strength, and (3) large numbers of datasets can be obtained. Therefore, synthetic datasets allow us to evaluate and compare various algorithms, and gain insights into how such comparisons depend on different aspects of the data. Here, we obtained synthetic “orthologous CRMs” by sampling from the MORPH probabilistic model. A set of seven PWMs, corresponding to transcription factors involved in early development in <italic>Drosophila</italic>, were included in the model, and their motif transition probabilities were set to <italic>p<sub>i</sub></italic> = 0.01. The parameters μ<sub>I</sub> and μ<sub>D</sub>, which determine the length distribution of unaligned sequences (Materials and Methods), were set to be equal and to range between 0.2 and 0.8, in increments of 0.1. The parameter μ, which is related to the length distribution of aligned blocks, was varied between 0.05 and 0.20, in increments of 0.05. For each combination of μ<sub>I</sub> (μ<sub>D</sub>) and μ, called an “experiment set,” we obtained ten pairs of sequences.</p><sec id="s2b1"><title>Improvement in alignment accuracy.</title><p>In the first analysis, we evaluated the accuracy of computed alignments by comparing them with the true alignments. For each of the ten sequence pairs in an experiment set, we counted what percentage of the truly aligned positions are aligned by the computed alignment, thus obtaining an “alignment sensitivity” that ranges between 0% (worst) to 100% (best). An “alignment specificity” was similarly computed. These two scores were computed for the popular alignment tool LAGAN, as well as for the Morphalign program, with PWMs and the <italic>φ</italic> (evolutionary divergence) parameter being known and all other parameters learned from the data. The Morphalign program computes a global alignment of two sequences using the MORPH framework. In this exercise, we configured it to report the maximum likelihood (Viterbi) alignment (see “Morphalign” in Materials and Methods). The alignment parameters (μ<sub>I</sub>, μ<sub>D</sub>, and μ) and motif transition probabilities (<italic>p<sub>i</sub></italic>) are automatically learned by Morphalign for each sequence pair. <xref ref-type="fig" rid="pcbi-0030216-g001">Figure 1</xref> compares the alignment sensitivity and specificity of these two alignment methods for all sequence pairs in experiment sets having μ<sub>I</sub> = μ<sub>D</sub> = 0.2, and different values of μ. We see a clear and consistent improvement in alignment accuracy (both sensitivity and specificity) when using Morphalign (and PWM knowledge), compared to LAGAN, with the improvement being more pronounced as the aligned blocks get shorter (larger μ). The same trend is seen for other values of μ<sub>I</sub> ( = μ<sub>D</sub>) (unpublished data). This test therefore shows us how we may get more accurate alignments of orthologous regulatory sequences if we know the relevant binding site motifs and exploit them within the MORPH framework. We also repeated these tests on synthetic datasets generated by a simple evolutionary model that is different from the MORPH probabilistic model. We find again, as shown in the Supplementary Materials at ((<ext-link ext-link-type="uri" xlink:href="http://rd.plos.org/pcbi_0030216_0001" xlink:type="simple">http://rd.plos.org. pcbi_0030216_0001</ext-link>), that the Morphalign program provides significantly greater sensitivity and specificity of alignments than LAGAN run with default parameters. Details of the new simulation program, which is based on the Dawg program [<xref ref-type="bibr" rid="pcbi-0030216-b026">26</xref>], are also are provided in the Supplementary Materials at (<ext-link ext-link-type="uri" xlink:href="http://rd.plos.org/pcbi_0030216_0001" xlink:type="simple">http://rd.plos.org. pcbi_0030216_0001</ext-link>).</p><fig id="pcbi-0030216-g001" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.0030216.g001</object-id><label>Figure 1</label><caption><title>Alignment Sensitivity (A) and Specificity (B) of LAGAN and Morphalign</title><p>(A) Sensitivity and (B) specificity of LAGAN and Morphalign on experiment sets with simulation parameters μ<sub>I</sub> = μ<sub>D</sub> = 0.2 are shown. Diagonal lines represent equal scores.</p></caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.0030216.g001" xlink:type="simple"/></fig></sec><sec id="s2b2"><title>Improvement in binding site prediction.</title><p>In the second analysis, we investigated whether use of the probabilistic model of alignment improves binding site prediction over that from using a fixed alignment, as in Stubb [<xref ref-type="bibr" rid="pcbi-0030216-b009">9</xref>]. Given the true locations of the binding sites, and the predicted locations from an algorithm, it is straightforward to compute the nucleotide-level sensitivity and specificity of predictions. (This computation was done based on sites in only one of the “species”.) As in the previous section, these scores were computed for each of the ten sequence pairs in an experiment set. We compared the performance of Morphalign with that of Stubb (in the two-species mode)—both algorithms were given all known PWMs and thus are run with the same prior knowledge; whereas Stubb uses a preprocessing alignment step (based on LAGAN), Morphalign considers all possible alignments probabilistically. Each algorithm was made to predict locations of binding sites using the same confidence value (“marginal probability” threshold; see “Synthetic Data Experiments” in Materials and Methods). <xref ref-type="fig" rid="pcbi-0030216-g002">Figure 2</xref> shows the sensitivity (2A) and specificity (2B) with both methods for all sequence pairs in experiment sets having μ<sub>I</sub> = μ<sub>D</sub> = 0.2 and different values of μ. We find a clear and consistent improvement in binding site prediction using Morphalign, in terms of both sensitivity and specificity. Morphalign's specificity is always significantly better, and so is its sensitivity. These results remain practically unchanged for other values of μ<sub>I</sub> ( = μ<sub>D</sub>) (unpublished data). This analysis provides a compelling demonstration of the advantage of using the Morphalign program for binding site prediction from orthologous CRMs.</p><fig id="pcbi-0030216-g002" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.0030216.g002</object-id><label>Figure 2</label><caption><title>Binding Site Prediction Sensitivity (A) and Specificity (B) with Stubb and Morphalign</title><p>(A) Sensitivity and (B) specificity with Stubb and Morphalign on experiment sets with simulation parameters μ<sub>I</sub> = μ<sub>D</sub> = 0.2 are shown.</p></caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.0030216.g002" xlink:type="simple"/></fig></sec></sec><sec id="s2c"><title>Comparative Analysis of <named-content content-type="genus-species" xlink:type="simple">D. melanogaster</named-content> and <named-content content-type="genus-species" xlink:type="simple">D. mojavensis</named-content> CRMs</title><p>The recent sequencing of 12 <italic>Drosophila</italic> genomes (<ext-link ext-link-type="uri" xlink:href="http://rana.lbl.gov/drosophila/" xlink:type="simple">http://rana.lbl.gov/drosophila/</ext-link>) and the recent publication of the largest database of experimentally validated CRMs (REDfly [<xref ref-type="bibr" rid="pcbi-0030216-b027">27</xref>]) has opened up the opportunity for us to examine orthologous regulatory sequences for their binding site content and mutual similarity. We chose to apply the MORPH framework on <named-content content-type="genus-species" xlink:type="simple">D. melanogaster</named-content> and <named-content content-type="genus-species" xlink:type="simple">D. mojavensis</named-content>, the latter being one of the most-diverged species (from the former) among the newly sequenced <italic>Drosophila</italic> genomes. These two species are expected to exhibit common modes of <italic>cis-</italic>regulation, using highly conserved transcription factors and DNA binding affinities (“motifs”). At the same time, they are diverged enough (∼40 Myr) to demonstrate substantial evolutionary flux at the binding site level. (See, for example, the works of Moses et al. [<xref ref-type="bibr" rid="pcbi-0030216-b028">28</xref>] and Emberly et al. [<xref ref-type="bibr" rid="pcbi-0030216-b029">29</xref>], both of which studied species with less divergence.) At the nucleotide level, the orthologous sequences we analyzed had a median percent identity of 52 (using LAGAN with default parameters). High incidence of short tandem repeats, including tandem repeats of binding sites, has been recorded in <italic>Drosophila</italic> CRMs [<xref ref-type="bibr" rid="pcbi-0030216-b030">30</xref>], and is likely to create alignment ambiguities between the two species compared. For all these reasons, application of our MORPH framework to orthologous CRMs in <named-content content-type="genus-species" xlink:type="simple">D. melanogaster</named-content> and <named-content content-type="genus-species" xlink:type="simple">D. mojavensis</named-content> holds the promise of bringing out interesting evolutionary analyses of <italic>cis-</italic>regulation.</p><sec id="s2c1"><title>Computational prediction of a large class of CRMs.</title><p>We collected a set of 208 experimentally verified <named-content content-type="genus-species" xlink:type="simple">D. melanogaster</named-content> CRMs from the REDfly database, spanning a broad spectrum of biological processes. For each CRM, we included 1-Kbp flanking sequence on either side, and extracted the ortholog of this entire sequence from <named-content content-type="genus-species" xlink:type="simple">D. mojavensis</named-content>. (These sequences had a mean length of 2,702 bp in <named-content content-type="genus-species" xlink:type="simple">D. melanogaster</named-content>, with a standard deviation of 535.) We also collected a set of 53 PWMs from FlyReg [<xref ref-type="bibr" rid="pcbi-0030216-b024">24</xref>]. Our goal was (1) to align these orthologous CRMs and predict binding sites, orthologous or otherwise, using the MORPH framework, and (2) to investigate whether the MORPH framework is able to predict CRMs by using a fairly broad collection of known motifs.</p><p>It is expected that any given CRM is regulated by a small subset of the 53 motifs, but such information is not available for most of the CRMs. Therefore, we decided to use all 53 motifs in our initial analysis. As such, false positives are inevitable during binding site prediction, and more specific information about transcription factors (such as genetic information on transcription factor–gene regulatory interactions) is necessary to deal with these. A researcher interested in analyzing a specific class of CRMs, e.g., those involved in anterior–posterior patterning of the embryo (e.g., Schroeder et al. [<xref ref-type="bibr" rid="pcbi-0030216-b003">3</xref>]), will use motifs corresponding to transcription factors known to regulate that class, and can expect to see significantly better predictions of binding sites. We come back to this issue in “Alignment and Regulatory Evolution in Two Specific Pathways” in <xref ref-type="sec" rid="s2">Results/Discussion</xref>.</p><p>Our first exercise was to apply the MorphMS program on each CRM sequence. This program (see “Algorithm and Implementation” in Materials and Methods) slides a window of length 500 bp (in shifts of 250 bp) on the input sequence, and, for each position of this sliding window, reports two log-likelihood ratio (LLR) scores. The LLR1 score compares the likelihood (of the sequence data) under the MORPH model to the likelihood under a null model in which only the background PWM is used. The LLR2 score uses a null model in which the Match state is not allowed, which means that the two orthologous sequences are assumed to be generated independently. To examine whether the LLR1 and LLR2 scores are able to discriminate CRMs, we considered all 208 CRMs as the “positive” class of sequences, and collected equally many length-matched sequences (and their orthologs) from randomly selected noncoding regions of the genome, forming the “negative” class. We then asked how well the positive class can be discriminated from the negative class, based on these scores. In order to test the advantage offered by the MORPH framework, we also used the LLR1 score computed by the Stubb program. We chose to compare MORPH performance with Stubb because (1) Stubb's probabilistic framework is very similar to MORPH, except that Stubb relies on a “hard” alignment, and (2) Stubb has been shown to improve CRM prediction using two fruitfly genomes over its single-species version [<xref ref-type="bibr" rid="pcbi-0030216-b031">31</xref>]. We also included in our comparisons the simple strategy of using the percentage identity (PID) between orthologous pairs of sequences as a classifier between the positive and negative classes. Each strategy (PID, Stubb, MorphMS LLR1, or MorphMS LLR2) was used to score all sequences, and the number of “errors” (i.e., negative-class sequences) included in the top <italic>K</italic> scoring sequences was plotted as a function of <italic>K</italic> (<xref ref-type="fig" rid="pcbi-0030216-g003">Figure 3</xref>A). Thus, the <italic>y</italic>-axis in <xref ref-type="fig" rid="pcbi-0030216-g003">Figure 3</xref>A is proportional to the false-positive error rate. The error rate expected by chance (50%) is shown as a reference. We find that the MorphMS LLR2 score provides significantly better discrimination than all other scores. For example, in the top 50 predictions by LLR2 score, there are only seven negative sequences and 43 positives. (The second-best strategy in this range is PID, which reports 15 negative sequences, more than double the error rate of LLR2.) This remarkable ability of the MorphMS LLR2 score to discriminate regulatory sequences is even more significant when we consider that our dataset includes CRMs from a wide spectrum of biological processes, and not just the blastoderm-stage embryonic segmentation pathway that has been the focus of previous computational studies [<xref ref-type="bibr" rid="pcbi-0030216-b005">5</xref>,<xref ref-type="bibr" rid="pcbi-0030216-b008">8</xref>,<xref ref-type="bibr" rid="pcbi-0030216-b032">32</xref>,<xref ref-type="bibr" rid="pcbi-0030216-b033">33</xref>]. This exercise also reveals that conservation information (LLR2) is substantially more effective than information on binding site clustering alone (LLR1 and Stubb) in our test scenario. In fact, even the simple strategy of computing PID gives better discrimination than LLR1 and Stubb. We believe that these two methods (LLR1 and Stubb) are not able to better distinguish CRMs from random sequences because they used an extremely broad collection of motifs, and should provide much improved results with small, pathway-specific sets of motifs. The LLR2 score, on the other hand, is guided by the increased conservation levels and not just the motif clustering, and hence performs significantly better. The improvement it brings over the PID score shows that it helps to measure conservation at the binding site level than at the raw nucleotide level.</p><fig id="pcbi-0030216-g003" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.0030216.g003</object-id><label>Figure 3</label><caption><title>CRM Prediction Accuracy on a Dataset with 208 “Positive” Sequences (CRMs) and 208 “Negative” Sequences (Random Noncoding Genomic Fragments)</title><p>The <italic>y</italic>-axis shows the number of negatives included in a given number (<italic>x</italic>-axis) of top scoring sequences. Green line (diagonal) represents error rate expected by chance.</p><p>(A) Predictions were made based on percentage identity (PID, purple line), Stubb score (blue), Morph LLR1 score (red), and Morph LLR2 score (black).</p><p>(B) Predictions were based on the total number of binding sites predicted by Stubb (blue) and Morph (black).</p></caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.0030216.g003" xlink:type="simple"/></fig><p>Next, we investigated the accuracy of binding site predictions. Our synthetic data results have shown how MORPH can predict binding sites with added sensitivity and specificity, in comparison to Stubb. In the current dataset, MorphMS predicted many more sites than Stubb (unpublished data). However, it was not possible to directly assess which of the methods is more accurate, since far too few binding sites have been experimentally identified in these 208 CRMs. Nevertheless, we can get a high-level insight into performance by framing the evaluation in a classification setting, as follows. The idea is that the “better method” will predict more sites in CRMs compared to random genomic segments, to the extent that this differential prediction of binding sites may allow us to classify CRMs from random sequences. Hence, we considered the total number of binding sites predicted by each method in each sequence, and tested which method is better at discriminating the positive class (CRMs) from the negative class (random genomic sequences) based on these total site counts. We note that this is only an indirect way to assess binding site prediction accuracy, and does not allow us to evaluate individual site predictions. <xref ref-type="fig" rid="pcbi-0030216-g003">Figure 3</xref>B shows the false-positive rate (as in the previous paragraph) when using total site counts as the discriminating feature. First, both MorphMS and Stubb show significant departure from the random expectation. Moreover, MorphMS is consistently better than Stubb in terms of the error rate, presenting indirect evidence that its binding site predictions are more accurate. If we believe this evidence, it would seem that proper treatment of alignment ambiguities reveals many more binding sites than Stubb's hard alignment approach, a conclusion that will be further corroborated in the next section.</p></sec></sec><sec id="s2d"><title>Alignment and Regulatory Evolution in Two Specific Pathways</title><p>The above analysis was performed on CRMs spanning many different pathways, using a very broad collection of motifs, to get a relatively unbiased view of MORPH performance. We next show results from two specific developmental pathways. We collected two sets of CRMs from REDfly: “BLASTODERM.A-P,” a set of 54 CRMs regulating anterior–posterior segmentation at the blastoderm stage, and “MESODERM,” a set of 46 CRMs involved in mesoderm specification. For each set, we also collected a set of motifs (PWMs) for transcription factors believed to be involved in that pathway—a collection of ten and 18 motifs for the BLASTODERM.A-P and MESODERM sets, respectively. (See Supplementary Materials at <ext-link ext-link-type="uri" xlink:href="http://rd.plos.org/pcbi_0030216_0001" xlink:type="simple">http://rd.plos.org. pcbi_0030216_0001</ext-link> for lists of these CRMs and motifs.) For each dataset, the Morphalign program (Materials and Methods) was used to align and predict binding sites in the <named-content content-type="genus-species" xlink:type="simple">D. melanogaster</named-content> and <named-content content-type="genus-species" xlink:type="simple">D. mojavensis</named-content> orthologs of each CRM. (The alignments were displayed using the maximum expected accuracy alignment as backbone; see “Morphalign” in Materials and Methods.) We analyzed the results of this exercise with respect to insights it provides about evolution of CRMs, and how such insights differ from traditional methods of evolutionary sequence comparison. The complete set of alignments for both sets is available online (see Supplementary Materials at <ext-link ext-link-type="uri" xlink:href="http://rd.plos.org/pcbi_0030216_0001" xlink:type="simple">http://rd.plos.org. pcbi_0030216_0001</ext-link>), and will be a valuable resource for biologists studying the evolution of these important sets of CRMs, or of CRMs in general.</p><sec id="s2d1"><title>Morphalign highlights ambiguities in alignment.</title><p>A distinct difference of Morphalign alignments from traditional (non-probabilistic) alignment programs is that ambiguities in the alignment are explicitly pointed out. To quantify this aspect, we asked what fraction of the positions in one species (<named-content content-type="genus-species" xlink:type="simple">D. melanogaster</named-content>) were aligned with marginal probability above a threshold of 0.1 to two or more positions in the second species (<named-content content-type="genus-species" xlink:type="simple">D. mojavensis</named-content>). This measure, which we call the alignment ambiguity fraction, is shown in <xref ref-type="fig" rid="pcbi-0030216-g004">Figure 4</xref>A. We find the majority of the BLASTODERM.A-P CRMs to have between 10% and 20% ambiguous positions by this measure. One obvious source of alignment ambiguities is the presence of short tandem repeats in the CRMs, whose high frequency has been reported in [<xref ref-type="bibr" rid="pcbi-0030216-b030">30</xref>]. We computed the separations between positions that are aligned to the same position in the other species, and found the median separation to be very small (6 bp for BLASTODERM.A-P and 4 bp for MESODERM), i.e., most ambiguities are “local.” We also computed statistical significance of overlaps between ambiguously aligned positions (the two or more positions in <named-content content-type="genus-species" xlink:type="simple">D. mojavensis</named-content> aligned to the same position in <named-content content-type="genus-species" xlink:type="simple">D. melanogaster</named-content>) and tandem repeat positions of the CRMs (predicted using TRF, the Tandem Repeat Finder program [<xref ref-type="bibr" rid="pcbi-0030216-b034">34</xref>]), using a hypergeometric test (<italic>p</italic> &lt; 0.01). Of the 43 CRMs in BLASTODERM.A-P that had over 10% alignment ambiguity, 14 CRMs had a significant overlap of ambiguously aligned and tandem repeat positions. Similar results were found in the MESODERM set. This provides statistical evidence that short tandem repeats play a large role in creating alignment ambiguities in CRMs.</p><fig id="pcbi-0030216-g004" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.0030216.g004</object-id><label>Figure 4</label><caption><title>Morphalign Alignments: Differences from Alternative Alignment Methods</title><p>(A) For each CRM in the BLASTODERM.A-P set, the fraction of the <named-content content-type="genus-species" xlink:type="simple">D. melanogaster</named-content> sequence that was ambiguously aligned (to two or more positions in <named-content content-type="genus-species" xlink:type="simple">D. mojavensis</named-content>) was computed. The figure shows the histogram of these alignment ambiguity fractions for the set.</p><p>(B) Median of alignment agreement scores between output of Morphalign and output of LAGAN (run separately with a range of gap opening penalties) for CRMs in the BLASTODERM.A-P (blue) and the MESODERM (red) sets.</p><p>(C) Histogram of alignment agreement scores between Morphalign and its no-motifs version, for the BLASTODERM.A-P set of CRMs.</p></caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.0030216.g004" xlink:type="simple"/></fig><p>Although the above observation points to short repeats as a source of alignment ambiguity, we also found ambiguously aligned positions separated by relatively large distances within the CRM. (That is, position <italic>a</italic> in one species aligned to two different positions <italic>b</italic> and <italic>c</italic> in the second species, with <italic>b</italic> and <italic>c</italic> being separated by a large distance.) For this, we looked at contiguous stretches of ten or more ambiguously aligned positions (in one species), and measured the distance between their two aligned regions in the other species. Twenty percent of such cases had separation more than 10 bp (i.e., subsequence <italic>a</italic> aligned to subsequences <italic>b</italic> and <italic>c</italic> that are separated by more than 10 bp). This suggests that these alignment ambiguities are the result of mechanisms other than tandem repeats, or that insertions have happened since the tandem repeat was created that have significantly separated the alternative alignable regions.</p></sec><sec id="s2d2"><title>Morphalign alignments are different from conventionally obtained alignments.</title><p>LAGAN [<xref ref-type="bibr" rid="pcbi-0030216-b010">10</xref>] is a popular tool for pairwise sequence alignment, and was therefore a natural choice with which to compare the Morphalign alignments. We first note that LAGAN alignments crucially depend on the user-specified “gap penalty” parameters, whereas Morphalign has no such parameters and automatically learns the “best” parameter values to use. We therefore compared the alignments from Morphalign to those from running LAGAN with different values of the gap opening penalty. The “Agreement score” used to compare two alignments is defined as the number of positions of the first species that are identically aligned in both alignments. As seen in <xref ref-type="fig" rid="pcbi-0030216-g004">Figure 4</xref>B, the LAGAN alignments are very different from Morphalign alignments (median agreement score less than 65% for both datasets, across the board). This demonstrates that using a probabilistic framework for pairwise alignment, along with binding site predictions, gives a very different picture of sequence similarities from that obtained using a traditional alignment tool such as LAGAN, regardless of the gap parameters.</p><p>We also compared the Morphalign alignments to those obtained by running the same program without any motifs, i.e., a probabilistic alignment program that does not predict binding sites in the process of alignment. This differs from LAGAN in its probabilistic nature and the fact that alignment parameters are learned automatically from the data. <xref ref-type="fig" rid="pcbi-0030216-g004">Figure 4</xref>C shows the histogram of agreement scores between these two alignment methods for CRMs of the BLASTODERM.A-P set. (Similar results were obtained for the MESODERM dataset; unpublished data.) Majority of the CRMs show high alignment agreement (46/54 above 70%), whereas three (hairy stripe 7, hairy stripe 6, and slp1 A) show less than 50% agreement. The latter are of particular interest to us, since these are where using binding site predictions made the greatest difference to the alignments. We scrutinized the hairy stripe 6 CRM to find the source of poor agreement (42%) between Morphalign and its “no-motifs” version. <xref ref-type="fig" rid="pcbi-0030216-g005">Figure 5</xref> shows several interesting differences between the alignments. <xref ref-type="fig" rid="pcbi-0030216-g005">Figure 5</xref>A shows two binding sites of Kruppel (red and green boxes) that are present in <named-content content-type="genus-species" xlink:type="simple">D. melanogaster</named-content> and not in <named-content content-type="genus-species" xlink:type="simple">D. mojavensis</named-content>, and are unaligned in the Morphalign alignment (top), but have been aligned with several gaps in the no-motifs version. <xref ref-type="fig" rid="pcbi-0030216-g005">Figure 5</xref>B shows a highly conserved binding site for Kruppel (red box) being aligned by the former method, but unaligned or erroneously aligned by the latter method. <xref ref-type="fig" rid="pcbi-0030216-g005">Figure 5</xref>C shows a strong match to the DStat motif (red box) in <named-content content-type="genus-species" xlink:type="simple">D. melanogaster</named-content> being aligned to a weaker match in <named-content content-type="genus-species" xlink:type="simple">D. mojavensis</named-content>, as per the Morphalign program. These seemingly orthologous DStat sites are not aligned by the no-motifs version of the program. Thus, manual inspection suggests that Morphalign, using motif information, is able to identify (potentially) orthologous binding sites even when its no-motifs version cannot.</p><fig id="pcbi-0030216-g005" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.0030216.g005</object-id><label>Figure 5</label><caption><title>Examples of Difference in Alignments Produced by Morphalign and Its No-Motifs Version, for the hairy stripe 6 enhancer</title><p>Each panel shows one example, with the Morphalign alignment at the top of that panel and the motif-agnostic alignment at the bottom. <named-content content-type="genus-species" xlink:type="simple">D. melanogaster</named-content> is shown as the top sequence in an alignment. Vertically aligned positions are shown in blue if they are identical, in black otherwise. Red lines indicate aligned positions, with their thickness proportional to confidence (marginal probability) of that positional alignment. Only positional alignments with confidence greater than 0.1 are marked by red lines. (Note that one position may align with multiple positions in the other alignment.) Morphalign additionally shows predicted binding site locations with blue bars (whose height represents confidence level), and the motif names in green characters.</p><p>(A) The red boxes show a predicted Kruppel site that is entirely unaligned by Morphalign, but is poorly and ambiguously aligned by the motif-agnostic alignment. The green box shows a similar situation.</p><p>(B) A very well-aligned block with conserved Kruppel sites is found by Morphalign, but the sites are clearly separated in the motif-agnostic alignment.</p><p>(C) A DStat site is aligned between the two species (by Morphalign). The no-motifs alignment conspicuously separates these potentially orthologous sites.</p></caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.0030216.g005" xlink:type="simple"/></fig></sec><sec id="s2d3"><title>Morphalign presents a different picture of binding site loss and gain.</title><p>A question that many researchers are interested in is the evolutionary dynamics of binding sites in CRMs: to what extent are binding sites conserved between species, and how do their evolutionary rates compare to various “neutral” rates? An indispensable component of such studies is the alignment of orthologous CRMs, to find conserved and non-conserved binding sites. Typically, this step is done using traditional alignment programs such as LAGAN, which is acknowledged to be a weak link in the analysis, and is sometimes supplemented with a manually performed realignment step. Morphalign, with its integrated view of binding site prediction and evolutionary events (indels and substitutions), is therefore likely to help produce a different and perhaps more accurate picture of binding site evolution. Here, we present evidence that the picture presented by Morphalign alignments is indeed very different from what LAGAN alignments suggest.</p><p>We used a well-characterized PWM of the Bicoid transcription factor, predicted all binding sites above a threshold in the <named-content content-type="genus-species" xlink:type="simple">D. melanogaster</named-content> BLASTODERM.A-P set, and asked how many of these sites were (1) aligned to a <named-content content-type="genus-species" xlink:type="simple">D. mojavensis</named-content> site also above the PWM match threshold (see “<named-content content-type="genus-species" xlink:type="simple">D. melanogaster</named-content> and <named-content content-type="genus-species" xlink:type="simple">D. mojavensis</named-content> Comparisons” in Materials and Methods), (2) aligned to a site below threshold, and (3) unaligned. We examined these numbers using Morphalign alignment, as well as with LAGAN alignments that used a wide range of gap penalties. There is an expected tradeoff between sensitivity and specificity here: LAGAN alignments with a high gap penalty will tend to produce more aligned regions, and hence align more binding sites (of <named-content content-type="genus-species" xlink:type="simple">D. melanogaster</named-content>), but at the cost of aligning sites that are not “truly” orthologous. One way to control for this is to compare alignments that overall align similar fractions of the CRMs (or numbers of binding sites), and then check what fraction of the aligned binding sites are conserved (i.e., match PWM above threshold) in the second species. If we assume that most alignable binding sites are functional in both species (i.e., infrequency of lineage-specific selection), the better alignment should have more of its aligned binding sites conserved. Indeed, <xref ref-type="fig" rid="pcbi-0030216-g006">Figure 6</xref>A shows that all but one of the LAGAN runs (blue diamonds) differ substantially from Morphalign in terms of the fraction of <named-content content-type="genus-species" xlink:type="simple">D. melanogaster</named-content> sites aligned. Only the LAGAN run with the lowest gap penalty (green diamond) agreed with Morphalign (red circle) with respect to this measurement. However, as <xref ref-type="fig" rid="pcbi-0030216-g006">Figure 6</xref>B shows, this run of LAGAN (green diamond) was significantly different from Morphalign (red circle) in terms of the fraction of aligned sites that were above threshold in both species. Both programs align a total of approximately 160 sites (<xref ref-type="fig" rid="pcbi-0030216-g006">Figure 6</xref>A), but Morphalign aligned 87 of these sites with potential sites in <named-content content-type="genus-species" xlink:type="simple">D. mojavensis</named-content>, whereas LAGAN (with lowest gap penalty) had only 55 of the 160 aligned sites conserved in the second species, suggesting a much higher rate of binding site loss or gain. Another way to look at these results is simply to count what fraction of the sites aligned by a program were conserved: although Morphalign finds this fraction to be 53%, the LAGAN runs across the spectrum of gap penalties projected a value of 28%–34% (data inferred from <xref ref-type="fig" rid="pcbi-0030216-g006">Figure 6</xref>A and <xref ref-type="fig" rid="pcbi-0030216-g006">6</xref>B). Thus we find, as expected, that Morphalign has a stronger tendency to align conserved binding sites in the two species, as compared to traditional, motif-agnostic alignment tools like LAGAN. Studies on <italic>cis-</italic>regulatory evolution, which often focus on the aligned binding sites in multiple species, will therefore report very different findings when using Morphalign and LAGAN, respectively. Similar results were obtained with well-characterized PWMs for other transcription factors such as Kruppel, Hunchback, Caudal, Tailless, and DStat (unpublished data).</p><fig id="pcbi-0030216-g006" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.0030216.g006</object-id><label>Figure 6</label><caption><title>A Total of 383 Binding Sites for the Bicoid Transcription Factor Were Predicted Computationally (Using a Threshold) in <named-content content-type="genus-species" xlink:type="simple">D. melanogaster</named-content> CRMs of the BLASTODERM.A-P Dataset</title><p>(A) The number of sites that were aligned, versus the number of unaligned sites, using different alignments: Diamonds = LAGAN with varying gap penalties; red circle = Morphalign. (Green diamond represents LAGAN with lowest gap penalty.)</p><p>(B) Of the sites aligned by a method, how many were conserved (i.e., PWM match score above threshold) in <named-content content-type="genus-species" xlink:type="simple">D. mojavensis</named-content>. Color code is as in (A).</p></caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.0030216.g006" xlink:type="simple"/></fig><p>Having shown that Morphalign gives a different picture of binding site evolution, we investigated whether this is justified. We therefore analyzed some specific examples and found that the difference is in part due to the ability of Morphalign to overcome some alignment errors. <xref ref-type="fig" rid="pcbi-0030216-g007">Figure 7</xref> (top left) shows the output of Morphalign on a portion of the eve stripe 2 enhancer [<xref ref-type="bibr" rid="pcbi-0030216-b027">27</xref>], with a pair of predicted Kruppel sites aligned to each other. (Kruppel is a known regulator of this CRM.) In contrast, in the LAGAN alignment, the rightmost two positions of the site are not aligned to each other, with the implication that approaches that look for orthologous binding sites in a fixed alignment will fail to find this orthologous pair. These two sites are not completely aligned by LAGAN with any tested setting of the gap penalty (unpublished data). The same scenario is observed for the eve stripe 1 enhancers, with a pair of bicoid sites (<xref ref-type="fig" rid="pcbi-0030216-g007">Figure 7</xref>, top right). (Bicoid is a known regulator of this CRM.) Note that in both examples, the alternative alignment found by the motif-agnostic method (LAGAN) is better than or as good as the Morphalign method in terms of number of matches, suggesting that this is going to be a common case of alignment “error,” especially when analyzing binding site evolution.</p><fig id="pcbi-0030216-g007" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.0030216.g007</object-id><label>Figure 7</label><caption><title>Snapshots from Alignments of Three CRMs: eve stripe 2 (Top Left), eve stripe1 (Top Right), and stumps_hbr_early (Bottom)</title><p>In the top two panels, the alignment above was produced by Morphalign, and the alignment below it was produced by LAGAN (with gap opening penalty of 300).</p></caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.0030216.g007" xlink:type="simple"/></fig><p>The next snapshot (<xref ref-type="fig" rid="pcbi-0030216-g007">Figure 7</xref>, bottom), from the “stumps_hbr_early” CRM in the MESODERM set, shows another merit of the Morphalign output: a binding site (for the Dorsal transcription factor) that is present in one species and absent in the other, yet is only partly aligned between the species. Here, the MORPH framework has apparently considered (1) alignments in which the entire site is unaligned and (2) alignments in which the site is not predicted, but its first two positions align between the two species. The final alignment output by the Morphalign program is an “average” over both types of alignments. This leads to the interesting scenario of a binding site overlapping an aligned-block boundary. Looking for binding sites entirely in aligned blocks or entirely outside, as is done by the Stubb program for example, would not reveal this site.</p></sec></sec><sec id="s2e"><title>Conclusions and Future Work</title><p>We have presented a novel probabilistic framework for two-species CRM prediction and analysis, combining the established probabilistic (HMM-based) approaches to two distinct problems: sequence alignment and CRM analysis. Our implementation of this framework is available as source code, and will particularly help researchers studying <italic>cis-</italic>regulatory evolution. We have used synthetic data to showcase the potential advantages of the new framework, in improving alignment as well as binding site prediction accuracy. We have demonstrated that CRM prediction is greatly improved with the new method over existing methods that use two-species data. We present the results of using our new motif-aware alignment tool on two well-established regulatory networks in <italic>Drosophila</italic>. These are publicly available via a Web interface. We have used these alignments to demonstrate that the new framework highlights ambiguities in the alignments, and produces alignments that are significantly different from those using a traditional alignment program like LAGAN, or even a motif-agnostic version of the same probabilistic framework. Finally, we have demonstrated that our proposed method paints a very different picture of binding site evolution, namely, one with significantly less loss or gain of functionality among aligned binding sites than projected by motif-agnostic methods. We have showcased specific examples of why this difference arises, and found the common source to be local misalignments by the traditional methods, which are not aware of the locations of potential binding sites. It is easy to appreciate that such traditional methods will always make arbitrary decisions when there are two alternative alignments with the same score, and if a pair of orthologous binding sites falls at the positions of alignment ambiguity, they may be misaligned. When we use motif information, our decision is no longer arbitrary (e.g., the example of <xref ref-type="fig" rid="pcbi-0030216-g007">Figure 7</xref>, top right panel), especially in light of the common opinion that a good binding site tends to be conserved evolutionarily.</p><p>The Insert and Delete states of the MORPH model are somewhat misleading in their names. These states emit not only the evolutionary insertions and deletions that happened between the species, but also the orthologous regions that are so diverged that they are better left unaligned. It may be beneficial to model these two types of sequences (indels and orthologous but highly diverged) separately, since they may have distinct statistical properties. This is an interesting direction for future work.</p><p>It is worth discussing here the two LLR scores (LLR1 and LLR2) reported by the MorphMS program. The LLR2 score contrasts the MORPH model with a null model in which the sequences are assumed unrelated, and thus implements a “homology testing” approach. This is akin to methods designed for identifying conserved noncoding sequences, such as phastCons [<xref ref-type="bibr" rid="pcbi-0030216-b035">35</xref>] and Regulatory Potential scores [<xref ref-type="bibr" rid="pcbi-0030216-b036">36</xref>], the difference being that MORPH explicitly accounts for binding site occurrences in computing its LLR2 score. Admittedly, in the tests discussed in “Computational Prediction of a Large Class of CRMs” in <xref ref-type="sec" rid="s2">Results/Discussion</xref>, in which a large collection of 53 motifs was used for CRM prediction, the distinction between LLR2 and these other scores may be somewhat blurred; the distinction will be more pronounced in the tests of “Alignment and Regulatory Evolution in Two Specific Pathways” in <xref ref-type="sec" rid="s2">Results/Discussion</xref> where smaller, pathway-specific sets of motifs were used. On a related note, we would like to point out that a possible way to use the MorphMS scores would be to use the LLR2 score to identify the highly conserved regions of the genome, and then use the LLR1 score on these to identify putative CRMs that have a significant clustering of binding sites in them.</p><p>An obvious line of future research is to combine pairwise alignments into a multiple alignment of three or more species. We may adopt ideas of consistency-based clustering [<xref ref-type="bibr" rid="pcbi-0030216-b013">13</xref>] in merging the marginal alignment probabilities from separate pairwise alignments. Motif-based multiple alignments of CRMs from the several <italic>Drosophila</italic> genomes will prove to be an invaluable resource for studies on binding site turnover, such as the recent work of Moses et al. [<xref ref-type="bibr" rid="pcbi-0030216-b028">28</xref>]. This, in turn, will be crucial to our understanding of how regulatory sequences evolve, and in computational prediction of additional regulatory sequences using comparative genomics.</p></sec></sec><sec id="s3"><title>Materials and Methods</title><sec id="s3a"><title>Model.</title><p>We first describe the probabilistic process (MORPH model) for generation of two orthologous CRMs using given PWM motifs.</p><p><italic>Alignment states.</italic> The main states of the model are Start, Stop, Match, Delete, and Insert. Of these, the first two, i.e., Start and Stop states, have no emissions, the Match state emits two strings of the same length, the Delete state emits a string to be appended only to S<sub>1</sub>, and the Insert state emits a string to be appended only to S<sub>2</sub>. For clarity of exposition, we illustrate the HMM as in <xref ref-type="fig" rid="pcbi-0030216-g008">Figure 8</xref>A, with four additional non-emission states “Pre-Start,” “Pre-Match,” “Pre-Delete,” and “Pre-Insert.” All allowed transitions and their probabilities are shown in <xref ref-type="fig" rid="pcbi-0030216-g008">Figure 8</xref>A. Semantics of the nine states are explained in <xref ref-type="table" rid="pcbi-0030216-t001">Table 1</xref>. We note that the alignment is generated by alternating between the Match state and the Delete/Insert states. That is, the generated alignment will have blocks of aligned positions, separated by unaligned strings in either or both species. The model does not make any further discrimination of how the unaligned string between two successive aligned blocks were formed. The interblock unaligned string in the first species is generated, followed by that in the second species. Hence, there is a transition from the Delete to the Insert state (via Pre-Insert), but the reverse transition is not allowed.</p><fig id="pcbi-0030216-g008" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.0030216.g008</object-id><label>Figure 8</label><caption><title>Hidden Markov Model Structure of the MORPH Model</title><p>(A): Transition probabilities among various states. Circular states have emissions, and octagonal states do not.</p><p>(B) Motif emissions from Match, Insert, and Delete states. For each, one of <italic>K</italic> motif states, or the background motif state is visited. In case of the Match state, two aligned sites are emitted, whereas for the Insert and Delete states, only one unaligned site is emitted.</p></caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.0030216.g008" xlink:type="simple"/></fig><table-wrap content-type="1col" id="pcbi-0030216-t001" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.0030216.t001</object-id><label>Table 1</label><caption><p>Semantics of the States of the HMM</p></caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.0030216.t001" xlink:type="simple"/><!-- <table frame="hsides" rules="none"><colgroup><col id="tb1col1" align="left" charoff="0" char=""/><col id="tb1col2" align="left" charoff="0" char=""/></colgroup><thead><tr><td align="left"><hr/>State</td><td><hr/>Semantics</td></tr></thead><tbody><tr><td>Pre-Start</td><td>This is the initial state of the process.</td></tr><tr><td>Stop</td><td>This is the terminal state of the process.</td></tr><tr><td>Start</td><td>Once in this state, the process must emit at least one non-empty sequence.</td></tr><tr><td>Match</td><td>In this state, two strings of equal length are emitted. This models aligned positions in the pairwise alignment.</td></tr><tr><td>Pre-Match</td><td>Once in this state, the process must either enter the match state or terminate.</td></tr><tr><td>Delete</td><td>In this state, one string is emitted, which is appended to S<sub>1</sub>. This models positions that are gap positions of S<sub>2</sub>.</td></tr><tr><td>Pre-Delete</td><td>Once in this state, the process must generate at least one unaligned string, either from the Delete state or Insert state or both.</td></tr><tr><td>Insert</td><td>In this state, one string is emitted, which is appended to S<sub>2</sub>. This models positions that are gap positions of S<sub>1</sub>.</td></tr><tr><td>Pre-Insert</td><td>This state can only be entered if the process has just visited the Delete state. The process has the option of generating more unaligned sequence (from the Insert state), but may also skip the Insert state.</td></tr></tbody></table> --><!-- --></table-wrap><p>The edges in <xref ref-type="fig" rid="pcbi-0030216-g008">Figure 8</xref>A show the probabilities associated with the respective state transitions. Thus, the Match state has a μ probability of exiting to Pre-Delete and generating unaligned sequence in at least one species. The Delete state has μ<sub>D</sub> probability of continuing generation of unaligned sequence in <italic>S</italic><sub>1</sub>, whereas the Insert state has μ<sub>I</sub> probability of staying put. From the Start state, there is a μ<sub>S</sub> probability that unaligned sequences will be generated before the first aligned block is formed. τ<sub>2</sub> is the termination probability from the Pre-Match state. We can now form the transition probability matrix for the main five states of the HMM, <bold>S</bold>tart, S<bold>T</bold>op, <bold>M</bold>atch, <bold>D</bold>elete, and <bold>I</bold>nsert, as shown in <xref ref-type="table" rid="pcbi-0030216-t002">Table 2</xref>. τ<sub>1</sub>, τ<sub>2</sub>, μ<sub>S</sub>, μ<sub>D</sub>, μ<sub>I</sub>, and μ are parameters of the model that will be trained from the data, as described later.</p><table-wrap content-type="1col" id="pcbi-0030216-t002" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.0030216.t002</object-id><label>Table 2</label><caption><p>Transition Probabilities for Alignment States in the MORPH Model</p></caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.0030216.t002" xlink:type="simple"/><!-- <table frame="hsides" rules="none"><colgroup><col id="tb2col1" align="left" charoff="0" char=""/><col id="tb2col2" align="left" charoff="0" char=""/><col id="tb2col3" align="left" charoff="0" char=""/><col id="tb2col4" align="left" charoff="0" char=""/><col id="tb2col5" align="left" charoff="0" char=""/><col id="tb2col6" align="left" charoff="0" char=""/></colgroup><thead><tr><td align="left"><hr/>State</td><td><hr/>S</td><td><hr/>T</td><td><hr/>M</td><td><hr/>D</td><td><hr/>I</td></tr></thead><tbody><tr><td>S</td><td>0</td><td>&tau;<sub>1</sub></td><td>(1 &minus; &tau;<sub>1</sub>)(1 &minus; &mu;<sub>S</sub>)</td><td>(1 &minus; &tau;<sub>1</sub>)&mu;<sub>S</sub>&mu;<sub>D</sub></td><td>(1 &minus; &tau;<sub>1</sub>)&mu;<sub>S</sub>(1 &minus; &mu;<sub>D</sub>)</td></tr><tr><td>T</td><td>0</td><td>1</td><td>0</td><td>0</td><td>0</td></tr><tr><td>M</td><td>0</td><td>(1 &minus; &mu;)&tau;<sub>2</sub></td><td>(1 &minus; &mu;)(1 &minus; &tau;<sub>2</sub>)</td><td>&mu;&mu;<sub>D</sub></td><td>&mu;(1 &minus; &mu;<sub>D</sub>)</td></tr><tr><td>D</td><td>0</td><td>(1 &minus; &mu;<sub>D</sub>)(1 &minus; &mu;<sub>I</sub>)&tau;<sub>2</sub></td><td>(1 &minus; &mu;<sub>D</sub>) (1 &minus; &mu;<sub>I</sub>)(1 &minus; &tau;<sub>2</sub>)</td><td>&mu;<sub>D</sub></td><td>(1 &minus; &mu;<sub>D</sub>)&mu;<sub>I</sub></td></tr><tr><td>I</td><td>0</td><td>(1 &minus; &mu;<sub>I</sub>)&tau;<sub>2</sub></td><td>(1 &minus; &mu;<sub>I</sub>)(1 &minus; &tau;<sub>2</sub>)</td><td>0</td><td>&mu;<sub>I</sub></td></tr></tbody></table> --><!-- <table-wrap-foot><fn id="nt201"><p>The five main states are as follows: D, Delete; I, Insert; M, Match; S, Start; and T, Stop.</p></fn></table-wrap-foot> --></table-wrap><p><italic>Motif states and emission probabilities.</italic> Once in a Match, Delete, or Insert state, the process transitions to one of several available “motif” states in order to decide which string to emit (<xref ref-type="fig" rid="pcbi-0030216-g008">Figure 8</xref>B). The available states include one state for each of the <italic>K</italic> input PWMs <italic>W</italic><sub>i</sub>, as well as a “background state” <italic>W</italic><sub>b</sub> corresponding to nonbinding sites of unit length. All states are named by the motifs they represent: {<italic>W</italic><sub>1</sub>, <italic>W</italic><sub>2,</sub> …, <italic>W</italic><sub>K</sub>, <italic>W</italic><sub>b</sub>}, and are called the motif states. Each state has a fixed probability <italic>p</italic><sub>i</sub> of being chosen, called its motif transition probability. Each state has its own emission probability distribution, determined by the PWM <italic>W</italic><sub>i</sub> that the state represents. (The Background state represents a single-column PWM capturing background nucleotide frequencies.) For motif states in Delete or Insert states, the emission probability distribution is directly prescribed by the respective PWM: the probability that state <italic>W</italic> emits a string <italic>s</italic> of length <italic>l</italic> (where <italic>l</italic> must be the length of PWM <italic>W</italic>) is <inline-formula id="pcbi-0030216-ex001"><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.0030216.ex001" xlink:type="simple"/></inline-formula>
					. Motif states in the Match state emit two equal-length strings related by a stochastic model of binding site evolution. (This is true also of the Background motif state, if visited while in the Match state.) The probability that state <italic>W</italic> emits strings <italic>s</italic> and <italic>t</italic>, each of length <italic>l</italic> (where <italic>l</italic> must be the length of PWM <italic>W</italic>) is given by:
					<disp-formula id="pcbi-0030216-e001"><graphic mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.0030216.e001" xlink:type="simple"/><!-- <mml:math display='block'><mml:mrow><mml:mi>Pr</mml:mi><mml:mo stretchy='false'>(</mml:mo><mml:mi>s</mml:mi><mml:mo>,</mml:mo><mml:mi>t</mml:mi><mml:mo stretchy='false'>)</mml:mo><mml:mo>&equals;</mml:mo><mml:mstyle displaystyle='true'><mml:munderover><mml:mo>&prod;</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>&equals;</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mi>l</mml:mi></mml:munderover><mml:mrow><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo stretchy='false'>(</mml:mo><mml:mi>&phi;</mml:mi><mml:msub><mml:mi>W</mml:mi><mml:mrow><mml:mi>i</mml:mi><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msub><mml:mo>&plus;</mml:mo><mml:mo stretchy='false'>(</mml:mo><mml:mn>1</mml:mn><mml:mo>&minus;</mml:mo><mml:mi>&phi;</mml:mi><mml:mo stretchy='false'>)</mml:mo><mml:mi>&delta;</mml:mi><mml:mmultiscripts><mml:mo stretchy='false'></mml:mo><mml:msub><mml:mi>s</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:msub><mml:mi>t</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy='false'>)</mml:mo></mml:mmultiscripts></mml:mrow></mml:mstyle></mml:mrow></mml:math> --></disp-formula>where δ<italic><sub>jk</sub></italic> is the Kronecker delta and <italic>φ</italic> is the neutral substitution probability between the two species. This model was used in our earlier work [<xref ref-type="bibr" rid="pcbi-0030216-b009">9</xref>,<xref ref-type="bibr" rid="pcbi-0030216-b037">37</xref>] and is a special case of the Felsenstein 81 model [<xref ref-type="bibr" rid="pcbi-0030216-b038">38</xref>] with equilibrium frequencies given by the PWM <italic>W</italic>.
				</p><p>The motif transition probabilities {<italic>p<sub>1</sub></italic>, <italic>p<sub>2</sub></italic>,…, <italic>p<sub>K</sub></italic>, <italic>p<sub>b</sub></italic>} are parameters of the model, with the constraint <inline-formula id="pcbi-0030216-ex002"><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.0030216.ex002" xlink:type="simple"/></inline-formula>
					, and are inferred from the data. The evolutionary parameter <italic>φ</italic> in Equation 1 is related to the expected conservation level in aligned sites. For an aligned position whose emission probabilities in each species are given by the probability distribution <italic>f</italic><sub>α</sub>, we expect (from Equation 1) <inline-formula id="pcbi-0030216-ex003"><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.0030216.ex003" xlink:type="simple"/></inline-formula>
					 mismatches per position. Although Equation 1, as used in previous publications, interprets <italic>φ</italic> as a neutral substitution probability, here it is the effective neutral substitution probability, conditional on the fact that the site survived during evolution and was therefore aligned. We prefer to interpret <italic>φ</italic> simply as a parameter that controls what fraction of aligned positions are expected to be conserved.
				</p></sec><sec id="s3b"><title>Algorithm and implementation.</title><p>We employ rigorous maximum likelihood estimation of the model parameters τ<sub>1</sub>, τ<sub>2</sub>, μ<sub>S</sub>, μ<sub>D</sub>, μ<sub>I</sub>, μ, and all <italic>p</italic><sub>i</sub>'s. That is, the algorithm attempts to learn the values of these parameters, collectively referred to as Θ, so as to maximize the probability of generating the sequence data <italic>S</italic> given Θ. (The algorithm used finds local maxima of the likelihood; see below.) Let <italic>T</italic> be a particular “path” in the generative process, i.e., a sequence of states that were visited in the generation of <italic>S. T</italic> is “hidden” information, hence the likelihood has to be computed by summing over all possible <italic>T</italic>. In other words, we have to find Θ that maximizes <inline-formula id="pcbi-0030216-ex004"><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.0030216.ex004" xlink:type="simple"/></inline-formula>
					. (The PWMs {<italic>W</italic><sub>1</sub>, <italic>W</italic><sub>2</sub>,…, <italic>W</italic><sub>K</sub>, <italic>W</italic><sub>b</sub>} are known parameters of the model, and are left out of this expression for clarity.) We use an E-M approach to maximize Pr(<italic>S</italic>|Θ). This is an iterative update algorithm that is guaranteed to improve the likelihood Pr(<italic>S</italic>|Θ) in every iteration, until convergence to a local optimum. In our case, the E-M strategy is implemented by adapting the popular Baum-Welch algorithm for HMMs [<xref ref-type="bibr" rid="pcbi-0030216-b014">14</xref>,<xref ref-type="bibr" rid="pcbi-0030216-b039">39</xref>]. Adapting the original Baum-Welch algorithm to our probabilistic model involves considerable reformulation, and these calculations are omitted here for clarity. Our algorithm belongs to the general algorithmic paradigm of “dynamic programming,” akin to Needleman-Wunsch alignment, and has quadratic time complexity. In particular, its running time is O(<italic>L</italic><sup>2</sup><italic>Kl</italic><sub>max</sub>), where <italic>L</italic> is the length of the sequence(s), <italic>K</italic> is the number of input PWMs, and <italic>l</italic><sub>max</sub> is the length of the longest PWM.
				</p><p>Our implementation of the MORPH probabilistic framework allows some additional features that the user may find useful.</p><p><italic>Background.</italic> The user may specify separate background sequences for the two species, for the purpose of training the background motif <italic>W</italic><sub>b</sub>.This is motivated by the common observation that orthologous genes may have very different nucleotide composition in their respective regulatory regions. If this option is exercised, the evolutionary model specified by Equation 1 (for background positions) is no longer time reversible. The joint probability of seeing base <italic>s</italic> in species 1 and base <italic>t</italic> in species 2 is now given by <inline-formula id="pcbi-0030216-ex005"><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.0030216.ex005" xlink:type="simple"/></inline-formula>
					, where <italic>W</italic><sup>(1)</sup> and <italic>W</italic><sup>(2)</sup> are the background PWMs in the two species. Also, the user may specify the “Markov order” of the background, in order to capture neighboring nucleotide dependencies in typical sequences. For example, a first-order Markov background captures dinucleotide frequencies.
				</p><p><italic>Special Match state.</italic> The user has the option of specifying that the Match state only emit non-background sites, i.e., when in the Match state, the motif transition probability for <italic>W</italic><sub>b</sub> is zero. For other PWMs, motif transition probabilities (<inline-formula id="pcbi-0030216-ex006"><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.0030216.ex006" xlink:type="simple"/></inline-formula>
					) in the Match state are scaled versions of their respective values for the Insert and Delete states. That is, <inline-formula id="pcbi-0030216-ex007"><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.0030216.ex007" xlink:type="simple"/></inline-formula>
					. This option may be useful when analyzing highly diverged species in which one expects only binding sites to be conserved and alignable.
				</p><p><italic>Speedup.</italic> The E-M parameter estimation algorithm has quadratic time complexity because it considers the possibility of every position <italic>i</italic> in the first sequence being aligned with every position <italic>j</italic> in the second sequence. The user may opt to have the algorithm consider only those pairs of positions that are not too “far removed,” e.g., |<italic>i</italic> − <italic>j</italic>| &lt; 100. This option leads to a significant speedup of the algorithm, with a negligible effect on accuracy. This is similar to the idea of band alignment [<xref ref-type="bibr" rid="pcbi-0030216-b040">40</xref>].</p><p><italic>Estimation of the divergence parameter.</italic> By default, the evolutionary parameter <italic>φ</italic>, controlling the expected conservation level at aligned sites (see “Motif States and Emission Probabilities” in Materials and Methods), is user-specified. (The user may have an estimated value of the neutral substitution probability based on existing packages such as PAML [<xref ref-type="bibr" rid="pcbi-0030216-b025">25</xref>].) We provide the option of having this parameter heuristically estimated, by starting with the default value, calculating the conservation level of aligned positions given the data, and adjusting the <italic>φ</italic> parameter based on these calculated conservation levels.</p><p>The current implementation aligns a typical CRM of approximate length 1,000 in a few minutes, running on a single processor workstation.</p></sec><sec id="s3c"><title>MorphMS.</title><p>The MorphMS program is designed for CRM prediction from two-species data. Given two orthologous sequences, it scans one of the sequences with a fixed-length window (in fixed-length shifts), and for each such window, computes the boundaries of its orthologous window in the other sequence by using a standard alignment tool. Thus, a “hard” alignment is used in this first step of detecting “orthologous window pairs,” after which the alignment information is discarded. For each window pair, MorphMS uses the MORPH model to compute the maximum likelihood parameters Θ<italic><sub>m</sub></italic>. It then computes two LLRs, by comparing this maximum likelihood Pr(<italic>S</italic>|Θ<italic><sub>m</sub></italic>) to the likelihood under two suitable null models.</p><p>In the first score, called LLR1, the null model is the maximum likelihood model under the constraint that all motif transition probabilities <italic>p</italic><sub>i</sub>, except that for the background, are zero. That is, the first null model is the maximum likelihood model in the absence of motifs. The score LLR1 therefore captures whether we can better explain the data by allowing it to contain binding sites for the given transcription factors.</p><p>In the second score, called LLR2, the null model includes all motif transition probabilities as learnable parameters, but requires that the Match state is not visited, i.e., the entire data is generated by a single visit to the Delete state, followed by a single visit to the Insert state. The LLR2 score measures how much of an improvement (to the likelihood) comes from allowing the data to contain aligned sites. For example, a window pair that was erroneously marked as orthologous, and in reality consists of two completely unrelated sequences each containing binding site clusters, will not receive a high LLR2 score.</p><p>In summary, the LLR1 score accounts for binding sites, whereas LLR2 accounts for alignment. The MorphMS program reports the LLR1 and LLR2 scores for every window pair, and leaves the analysis of these scores to the user. Each of these scores, being an LLR, is comparable across window pairs, implying that the user may choose the top scoring window pairs as CRM predictions.</p></sec><sec id="s3d"><title>Morphalign.</title><p>Morphalign is a pairwise alignment program for orthologous CRMs that uses known PWM motifs and the MORPH probabilistic framework. It is very similar to the MorphMS program, except that it processes the entire input sequence instead of sliding a window, and produces a graphical output at the end. It uses potential binding sites to impose a higher-order structure on the sequences and performs alignment on this higher-order structure. All possible parses of each sequence into their higher-order structure are considered and weighted probabilistically, as described in “Alignment and Regulatory Evolution in Two Specific Pathways” in <xref ref-type="sec" rid="s2">Results/Discussion</xref>. Moreover, in contradistinction to usual alignment methods, Morphalign highlights the ambiguous parts of the alignment and quantifies them, thus providing a more complete picture of alignment of two moderately diverged sequences.</p><p>The Morphalign program comes with a graphical visualization tool that produces an HTML file (with embedded JavaScript code) that may be viewed through any browser, making the visualization highly portable. The most likely alignment (Viterbi solution of the HMM in the MORPH framework) or the maximum expected accuracy alignment (explained below) forms the backbone of the display, and is displayed in the usual alignment format with gaps and nucleotides. For any pair of positions (in the two sequences), their marginal alignment probability is shown (if above some threshold) by a colored line whose thickness is proportional to the probability. This allows nonaligned positions (in the backbone alignment) to be flagged as being potentially orthologous. The alignment display is annotated by presence of potential binding sites. The marginal probability of a binding site for any particular transcription factor at any particular position is shown by colored (blue) bars at the appropriate position, as shown in <xref ref-type="fig" rid="pcbi-0030216-g005">Figure 5</xref>.</p><p>The user has two options regarding how to display the backbone of the alignment (i.e., which position is shown vertically aligned with which position). The Viterbi option uses the maximum likelihood path through the HMM and the Match states that this path goes through, to decide this backbone. Another option, which we have found useful in practice, is to vertically line up all those pairs of positions whose marginal alignment probabilities have the largest sum. This is called the maximum expected accuracy alignment [<xref ref-type="bibr" rid="pcbi-0030216-b012">12</xref>].</p></sec><sec id="s3e"><title>Data and experiments.</title><p><italic>Synthetic data experiments.</italic> The MORPH probabilistic process was sampled from, with parameter values τ<sub>1</sub> = 0.005, τ<sub>2</sub> = 0.005, and <italic>φ</italic> = 0.5. This resulted in sequences of median length 487 bp. PWMs corresponding to <italic>Drosophila</italic> transcription factors Bicoid, Hunchback, Knirps, Kruppel, Tailless, and Caudal and the TorRE binding factor were used in the sequence generation process. (PWM lengths varied between 9 and 15.) LAGAN was run with its default parameters, as was done in the evaluations performed by Pollard et al. [<xref ref-type="bibr" rid="pcbi-0030216-b041">41</xref>]. Morphalign and Stubb were run with the correct value of the evolutionary parameter <italic>φ</italic> = 0.5. Each of these two programs outputs, for every position in a sequence, a “marginal probability” that an occurrence of a binding site begins at that position. We used a threshold of 0.1 on this marginal probability to predict binding sites.</p><p><italic>D. melanogaster and D. mojavensis comparisons.</italic> We started with a complete list of 284 nonredundant (and nonoverlapping) CRMs from the REDfly database [<xref ref-type="bibr" rid="pcbi-0030216-b027">27</xref>], and retained only those 208 cases for which the CRMs (with their 1-Kbp flank on either side) had clear orthologs in <named-content content-type="genus-species" xlink:type="simple">D. mojavensis</named-content>. We used a set of 53 PWMs based on the FlyReg database [<xref ref-type="bibr" rid="pcbi-0030216-b024">24</xref>] and the online resource maintained by Pollard (<ext-link ext-link-type="uri" xlink:href="http://rana.lbl.gov/~dan/matrices.html" xlink:type="simple">http://rana.lbl.gov/~dan/matrices.html</ext-link>). These were all motifs that were based on at least five verified binding sites from the FlyReg database.</p><p>Short tandem repeats in CRMs were predicted by running the Tandem Repeat Finder (TRF) program of Benson [<xref ref-type="bibr" rid="pcbi-0030216-b034">34</xref>] with parameters: match = 2, mismatch = 3, indel = 5, match probability = 0.8, indel probability = 0.1, minimum score = 25, and maximum period = 10. This finds approximate tandem repeats (with mismatches and indels) of periodicity up to 10.</p><p>All runs of Morphalign on the real datasets were done so as to output the maximum expected accuracy alignments (see ”Morphalign” in Materials and Methods), rather than the maximum likelihood (Viterbi) alignment.</p><p>Binding sites for the Bicoid transcription factor (“Morphalign Presents a Different Picture of Binding Site Loss and Gain” in <xref ref-type="sec" rid="s2">Results/Discussion</xref>) were obtained as follows: the match score of any string to the PWM was computed as usual by comparing the probability of sampling the string from the PWM to the probability of sampling it from background, i.e., the LLR score of the string. (The background used was constructed from the nucleotide frequencies of the CRM in which the string is located.) The maximum possible LLR score for any string was computed, and all strings with an LLR score at least 50% of this maximum were considered as binding sites for Bicoid.</p></sec></sec></body><back><ack><p>We are thankful to Eric Siggia for several useful discussions when this project was being designed.</p></ack><glossary><title>Abbreviations</title><def-list><def-item><term>CRM</term><def><p><italic>cis</italic>-regulatory module</p></def></def-item><def-item><term>E-M</term><def><p>Expectation-Maximization</p></def></def-item><def-item><term>HMM</term><def><p>Hidden Markov model</p></def></def-item><def-item><term>LLR</term><def><p>log-likelihood ratio</p></def></def-item><def-item><term>PID</term><def><p>percentage identity</p></def></def-item><def-item><term>PWM</term><def><p>position weight matrix</p></def></def-item></def-list></glossary><ref-list><title>References</title><ref id="pcbi-0030216-b001"><label>1</label><element-citation publication-type="journal" xlink:type="simple">
					<person-group person-group-type="author"><name name-style="western"><surname>Needleman</surname><given-names>SB</given-names></name><name name-style="western"><surname>Wunsch</surname><given-names>CD</given-names></name></person-group>
					<year>1970</year>
					<article-title>A general method applicable to the search for similarities in the amino acid sequence of two proteins.</article-title>
					<source>J Mol Biol</source>
					<volume>48</volume>
					<fpage>443</fpage>
					<lpage>453</lpage>
				</element-citation></ref><ref id="pcbi-0030216-b002"><label>2</label><element-citation publication-type="journal" xlink:type="simple">
					<person-group person-group-type="author"><name name-style="western"><surname>Altschul</surname><given-names>SF</given-names></name><name name-style="western"><surname>Gish</surname><given-names>W</given-names></name><name name-style="western"><surname>Miller</surname><given-names>W</given-names></name><name name-style="western"><surname>Myers</surname><given-names>EW</given-names></name><name name-style="western"><surname>Lipman</surname><given-names>DJ</given-names></name></person-group>
					<year>1990</year>
					<article-title>Basic local alignment search tool.</article-title>
					<source>J Mol Biol</source>
					<volume>215</volume>
					<fpage>403</fpage>
					<lpage>410</lpage>
				</element-citation></ref><ref id="pcbi-0030216-b003"><label>3</label><element-citation publication-type="journal" xlink:type="simple">
					<person-group person-group-type="author"><name name-style="western"><surname>Schroeder</surname><given-names>MD</given-names></name><name name-style="western"><surname>Pearce</surname><given-names>M</given-names></name><name name-style="western"><surname>Fak</surname><given-names>J</given-names></name><name name-style="western"><surname>Fan</surname><given-names>H</given-names></name><name name-style="western"><surname>Unnerstall</surname><given-names>U</given-names></name><etal/></person-group>
					<year>2004</year>
					<article-title>Transcriptional control in the segmentation gene network of Drosophila.</article-title>
					<source>PLoS Biol</source>
					<volume>2</volume>
					<elocation-id>e271</elocation-id>
					<comment>doi:<ext-link ext-link-type="doi" xlink:href="http://dx.doi.org/10.1371/journal.pbio.0020271" xlink:type="simple">10.1371/journal.pbio.0020271</ext-link></comment>
				</element-citation></ref><ref id="pcbi-0030216-b004"><label>4</label><element-citation publication-type="journal" xlink:type="simple">
					<person-group person-group-type="author"><name name-style="western"><surname>Davidson</surname><given-names>EH</given-names></name><name name-style="western"><surname>Rast</surname><given-names>JP</given-names></name><name name-style="western"><surname>Oliveri</surname><given-names>P</given-names></name><name name-style="western"><surname>Ransick</surname><given-names>A</given-names></name><name name-style="western"><surname>Calestani</surname><given-names>C</given-names></name><etal/></person-group>
					<year>2002</year>
					<article-title>A genomic regulatory network for development.</article-title>
					<source>Science</source>
					<volume>295</volume>
					<fpage>1669</fpage>
					<lpage>1678</lpage>
				</element-citation></ref><ref id="pcbi-0030216-b005"><label>5</label><element-citation publication-type="journal" xlink:type="simple">
					<person-group person-group-type="author"><name name-style="western"><surname>Berman</surname><given-names>BP</given-names></name><name name-style="western"><surname>Nibu</surname><given-names>Y</given-names></name><name name-style="western"><surname>Pfeiffer</surname><given-names>BD</given-names></name><name name-style="western"><surname>Tomancak</surname><given-names>P</given-names></name><name name-style="western"><surname>Celniker</surname><given-names>SE</given-names></name><etal/></person-group>
					<year>2002</year>
					<article-title>Exploiting transcription factor binding site clustering to identify cis-regulatory modules involved in pattern formation in the Drosophila genome.</article-title>
					<source>Proc Natl Acad Sci U S A</source>
					<volume>99</volume>
					<fpage>757</fpage>
					<lpage>762</lpage>
				</element-citation></ref><ref id="pcbi-0030216-b006"><label>6</label><element-citation publication-type="journal" xlink:type="simple">
					<person-group person-group-type="author"><name name-style="western"><surname>Halfon</surname><given-names>MS</given-names></name><name name-style="western"><surname>Grad</surname><given-names>Y</given-names></name><name name-style="western"><surname>Church</surname><given-names>GM</given-names></name><name name-style="western"><surname>Michelson</surname><given-names>AM</given-names></name></person-group>
					<year>2002</year>
					<article-title>Computation-based discovery of related transcriptional regulatory modules and motifs using an experimentally validated combinatorial model.</article-title>
					<source>Genome Res</source>
					<volume>12</volume>
					<fpage>1019</fpage>
					<lpage>1028</lpage>
				</element-citation></ref><ref id="pcbi-0030216-b007"><label>7</label><element-citation publication-type="journal" xlink:type="simple">
					<person-group person-group-type="author"><name name-style="western"><surname>Frith</surname><given-names>MC</given-names></name><name name-style="western"><surname>Hansen</surname><given-names>U</given-names></name><name name-style="western"><surname>Weng</surname><given-names>Z</given-names></name></person-group>
					<year>2001</year>
					<article-title>Detection of cis-element clusters in higher eukaryotic DNA.</article-title>
					<source>Bioinformatics</source>
					<volume>17</volume>
					<fpage>878</fpage>
					<lpage>889</lpage>
				</element-citation></ref><ref id="pcbi-0030216-b008"><label>8</label><element-citation publication-type="journal" xlink:type="simple">
					<person-group person-group-type="author"><name name-style="western"><surname>Rajewsky</surname><given-names>N</given-names></name><name name-style="western"><surname>Vergassola</surname><given-names>M</given-names></name><name name-style="western"><surname>Gaul</surname><given-names>U</given-names></name><name name-style="western"><surname>Siggia</surname><given-names>ED</given-names></name></person-group>
					<year>2002</year>
					<article-title>Computational detection of genomic cis-regulatory modules applied to body patterning in the early Drosophila embryo.</article-title>
					<source>BMC Bioinformatics</source>
					<volume>3</volume>
					<fpage>30</fpage>
				</element-citation></ref><ref id="pcbi-0030216-b009"><label>9</label><element-citation publication-type="journal" xlink:type="simple">
					<person-group person-group-type="author"><name name-style="western"><surname>Sinha</surname><given-names>S</given-names></name><name name-style="western"><surname>van Nimwegen</surname><given-names>E</given-names></name><name name-style="western"><surname>Siggia</surname><given-names>ED</given-names></name></person-group>
					<year>2003</year>
					<article-title>A probabilistic method to detect regulatory modules.</article-title>
					<source>Bioinformatics</source>
					<volume>19</volume>
					<issue>Supplement 1</issue>
					<fpage>i292</fpage>
					<lpage>301</lpage>
				</element-citation></ref><ref id="pcbi-0030216-b010"><label>10</label><element-citation publication-type="journal" xlink:type="simple">
					<person-group person-group-type="author"><name name-style="western"><surname>Brudno</surname><given-names>M</given-names></name><name name-style="western"><surname>Do</surname><given-names>CB</given-names></name><name name-style="western"><surname>Cooper</surname><given-names>GM</given-names></name><name name-style="western"><surname>Kim</surname><given-names>MF</given-names></name><name name-style="western"><surname>Davydov</surname><given-names>E</given-names></name><etal/></person-group>
					<year>2003</year>
					<article-title>LAGAN and Multi-LAGAN: efficient tools for large-scale multiple alignment of genomic DNA.</article-title>
					<source>Genome Res</source>
					<volume>13</volume>
					<fpage>721</fpage>
					<lpage>731</lpage>
				</element-citation></ref><ref id="pcbi-0030216-b011"><label>11</label><element-citation publication-type="journal" xlink:type="simple">
					<person-group person-group-type="author"><name name-style="western"><surname>Batzoglou</surname><given-names>S</given-names></name></person-group>
					<year>2005</year>
					<article-title>The many faces of sequence alignment.</article-title>
					<source>Brief Bioinform</source>
					<volume>6</volume>
					<fpage>6</fpage>
					<lpage>22</lpage>
				</element-citation></ref><ref id="pcbi-0030216-b012"><label>12</label><element-citation publication-type="journal" xlink:type="simple">
					<person-group person-group-type="author"><name name-style="western"><surname>Holmes</surname><given-names>I</given-names></name><name name-style="western"><surname>Durbin</surname><given-names>R</given-names></name></person-group>
					<year>1998</year>
					<article-title>Dynamic programming alignment accuracy.</article-title>
					<source>J Comp Biol</source>
					<volume>5</volume>
					<fpage>493</fpage>
					<lpage>504</lpage>
				</element-citation></ref><ref id="pcbi-0030216-b013"><label>13</label><element-citation publication-type="journal" xlink:type="simple">
					<person-group person-group-type="author"><name name-style="western"><surname>Do</surname><given-names>CB</given-names></name><name name-style="western"><surname>Mahabhashyam</surname><given-names>MS</given-names></name><name name-style="western"><surname>Brudno</surname><given-names>M</given-names></name><name name-style="western"><surname>Batzoglou</surname><given-names>S</given-names></name></person-group>
					<year>2005</year>
					<article-title>ProbCons: probabilistic consistency-based multiple sequence alignment.</article-title>
					<source>Genome Res</source>
					<volume>15</volume>
					<fpage>330</fpage>
					<lpage>340</lpage>
				</element-citation></ref><ref id="pcbi-0030216-b014"><label>14</label><element-citation publication-type="other" xlink:type="simple">
					<person-group person-group-type="author"><name name-style="western"><surname>Durbin</surname><given-names>R</given-names></name><name name-style="western"><surname>Eddy</surname><given-names>S</given-names></name><name name-style="western"><surname>Krogh</surname><given-names>A</given-names></name><name name-style="western"><surname>Mitchison</surname><given-names>G</given-names></name></person-group>
					<year>1998</year>
					<source>Biological sequence analysis: probabilistic models of proteins and nucleic acids</source>
					<publisher-loc>Cambridge (United Kingdom)</publisher-loc>
					<publisher-name>Cambridge University Press</publisher-name>
					<!--===== Restructure page-count as size[@units="page"] =====--><size units="page">356</size>
				</element-citation></ref><ref id="pcbi-0030216-b015"><label>15</label><element-citation publication-type="journal" xlink:type="simple">
					<person-group person-group-type="author"><name name-style="western"><surname>Thorne</surname><given-names>JL</given-names></name><name name-style="western"><surname>Kishino</surname><given-names>H</given-names></name><name name-style="western"><surname>Felsenstein</surname><given-names>J</given-names></name></person-group>
					<year>1991</year>
					<article-title>An evolutionary model for maximum likelihood alignment of DNA sequence.</article-title>
					<source>J Mol Evol</source>
					<volume>33</volume>
					<fpage>114</fpage>
					<lpage>124</lpage>
				</element-citation></ref><ref id="pcbi-0030216-b016"><label>16</label><element-citation publication-type="journal" xlink:type="simple">
					<person-group person-group-type="author"><name name-style="western"><surname>Holmes</surname><given-names>I</given-names></name><name name-style="western"><surname>Bruno</surname><given-names>WJ</given-names></name></person-group>
					<year>2001</year>
					<article-title>Evolutionary HMMs: a Bayesian approach to multiple alignment.</article-title>
					<source>Bioinformatics</source>
					<volume>17</volume>
					<fpage>803</fpage>
					<lpage>820</lpage>
				</element-citation></ref><ref id="pcbi-0030216-b017"><label>17</label><element-citation publication-type="journal" xlink:type="simple">
					<person-group person-group-type="author"><name name-style="western"><surname>Knudsen</surname><given-names>B</given-names></name><name name-style="western"><surname>Miyamoto</surname><given-names>MM</given-names></name></person-group>
					<year>2003</year>
					<article-title>Sequence alignments and pair hidden Markov models using evolutionary history.</article-title>
					<source>J Mol Biol</source>
					<volume>333</volume>
					<fpage>453</fpage>
					<lpage>460</lpage>
				</element-citation></ref><ref id="pcbi-0030216-b018"><label>18</label><element-citation publication-type="journal" xlink:type="simple">
					<person-group person-group-type="author"><name name-style="western"><surname>Wang</surname><given-names>J</given-names></name><name name-style="western"><surname>Keightley</surname><given-names>PD</given-names></name><name name-style="western"><surname>Johnson</surname><given-names>T</given-names></name></person-group>
					<year>2006</year>
					<article-title>MCALIGN2: faster, accurate global pairwise alignment of non-coding DNA sequences based on explicit models of indel evolution.</article-title>
					<source>BMC Bioinformatics</source>
					<volume>7</volume>
					<fpage>292</fpage>
				</element-citation></ref><ref id="pcbi-0030216-b019"><label>19</label><element-citation publication-type="journal" xlink:type="simple">
					<person-group person-group-type="author"><name name-style="western"><surname>Berezikov</surname><given-names>E</given-names></name><name name-style="western"><surname>Guryev</surname><given-names>V</given-names></name><name name-style="western"><surname>Plasterk</surname><given-names>RHA</given-names></name><name name-style="western"><surname>Cuppen</surname><given-names>E</given-names></name></person-group>
					<year>2004</year>
					<article-title>CONREAL: conserved regulatory elements anchored alignment algorithm for identification of transcription factor binding sites by phylogenetic footprinting.</article-title>
					<source>Genome Res</source>
					<volume>14</volume>
					<fpage>170</fpage>
					<lpage>178</lpage>
				</element-citation></ref><ref id="pcbi-0030216-b020"><label>20</label><element-citation publication-type="journal" xlink:type="simple">
					<person-group person-group-type="author"><name name-style="western"><surname>Hallikas</surname><given-names>O</given-names></name><name name-style="western"><surname>Palin</surname><given-names>K</given-names></name><name name-style="western"><surname>Sinjushina</surname><given-names>N</given-names></name><name name-style="western"><surname>Rautiainen</surname><given-names>R</given-names></name><name name-style="western"><surname>Partanen</surname><given-names>J</given-names></name><etal/></person-group>
					<year>2006</year>
					<article-title>Genome-wide prediction of mammalian enhancers based on analysis of transcription-factor binding affinity.</article-title>
					<source>Cell</source>
					<volume>124</volume>
					<fpage>47</fpage>
					<lpage>59</lpage>
				</element-citation></ref><ref id="pcbi-0030216-b021"><label>21</label><element-citation publication-type="journal" xlink:type="simple">
					<person-group person-group-type="author"><name name-style="western"><surname>Stormo</surname><given-names>GD</given-names></name></person-group>
					<year>2000</year>
					<article-title>DNA binding sites: representation and discovery.</article-title>
					<source>Bioinformatics</source>
					<volume>16</volume>
					<fpage>16</fpage>
					<lpage>23</lpage>
				</element-citation></ref><ref id="pcbi-0030216-b022"><label>22</label><element-citation publication-type="journal" xlink:type="simple">
					<person-group person-group-type="author"><name name-style="western"><surname>Wingender</surname><given-names>E</given-names></name><name name-style="western"><surname>Chen</surname><given-names>X</given-names></name><name name-style="western"><surname>Fricke</surname><given-names>E</given-names></name><name name-style="western"><surname>Geffers</surname><given-names>R</given-names></name><name name-style="western"><surname>Hehl</surname><given-names>R</given-names></name><etal/></person-group>
					<year>2001</year>
					<article-title>The TRANSFAC system on gene expression regulation.</article-title>
					<source>Nucleic Acids Res</source>
					<volume>29</volume>
					<fpage>281</fpage>
					<lpage>283</lpage>
				</element-citation></ref><ref id="pcbi-0030216-b023"><label>23</label><element-citation publication-type="journal" xlink:type="simple">
					<person-group person-group-type="author"><name name-style="western"><surname>Vlieghe</surname><given-names>D</given-names></name><name name-style="western"><surname>Sandelin</surname><given-names>A</given-names></name><name name-style="western"><surname>Bleser</surname><given-names>PJD</given-names></name><name name-style="western"><surname>Vleminckx</surname><given-names>K</given-names></name><name name-style="western"><surname>Wasserman</surname><given-names>WW</given-names></name><etal/></person-group>
					<year>2006</year>
					<article-title>A new generation of JASPAR, the open-access repository for transcription factor binding site profiles.</article-title>
					<source>Nucleic Acids Res</source>
					<volume>34</volume>
					<issue>Database issue</issue>
					<fpage>D95</fpage>
					<lpage>D97</lpage>
				</element-citation></ref><ref id="pcbi-0030216-b024"><label>24</label><element-citation publication-type="journal" xlink:type="simple">
					<person-group person-group-type="author"><name name-style="western"><surname>Bergman</surname><given-names>CM</given-names></name><name name-style="western"><surname>Carlson</surname><given-names>JW</given-names></name><name name-style="western"><surname>Celniker</surname><given-names>SE</given-names></name></person-group>
					<year>2005</year>
					<article-title>Drosophila DNase I footprint database: a systematic genome annotation of transcription factor binding sites in the fruitfly, Drosophila melanogaster.</article-title>
					<source>Bioinformatics</source>
					<volume>21</volume>
					<fpage>1747</fpage>
					<lpage>1749</lpage>
				</element-citation></ref><ref id="pcbi-0030216-b025"><label>25</label><element-citation publication-type="journal" xlink:type="simple">
					<person-group person-group-type="author"><name name-style="western"><surname>Yang</surname><given-names>Z</given-names></name></person-group>
					<year>2007</year>
					<article-title>PAML 4: phylogenetic analysis by maximum likelihood.</article-title>
					<source>Mol Biol Evol</source>
					<volume>24</volume>
					<fpage>1586</fpage>
					<lpage>1591</lpage>
				</element-citation></ref><ref id="pcbi-0030216-b026"><label>26</label><element-citation publication-type="journal" xlink:type="simple">
					<person-group person-group-type="author"><name name-style="western"><surname>Cartwright</surname><given-names>RA</given-names></name></person-group>
					<year>2005</year>
					<article-title>DNA assembly with gaps (Dawg): simulating sequence evolution.</article-title>
					<source>Bioinformatics</source>
					<volume>21</volume>
					<issue>Supplement 3</issue>
					<fpage>iii31</fpage>
					<lpage>38</lpage>
				</element-citation></ref><ref id="pcbi-0030216-b027"><label>27</label><element-citation publication-type="journal" xlink:type="simple">
					<person-group person-group-type="author"><name name-style="western"><surname>Gallo</surname><given-names>SM</given-names></name><name name-style="western"><surname>Li</surname><given-names>L</given-names></name><name name-style="western"><surname>Hu</surname><given-names>Z</given-names></name><name name-style="western"><surname>Halfon</surname><given-names>MS</given-names></name></person-group>
					<year>2006</year>
					<article-title>REDfly: a Regulatory Element Database for Drosophila.</article-title>
					<source>Bioinformatics</source>
					<volume>22</volume>
					<fpage>381</fpage>
					<lpage>383</lpage>
				</element-citation></ref><ref id="pcbi-0030216-b028"><label>28</label><element-citation publication-type="journal" xlink:type="simple">
					<person-group person-group-type="author"><name name-style="western"><surname>Moses</surname><given-names>AM</given-names></name><name name-style="western"><surname>Pollard</surname><given-names>DA</given-names></name><name name-style="western"><surname>Nix</surname><given-names>DA</given-names></name><name name-style="western"><surname>Iyer</surname><given-names>VN</given-names></name><name name-style="western"><surname>Li</surname><given-names>XY</given-names></name><etal/></person-group>
					<year>2006</year>
					<article-title>Large-scale turnover of functional transcription factor binding sites in Drosophila.</article-title>
					<source>PLoS Comput Biol</source>
					<volume>2</volume>
					<elocation-id>e130</elocation-id>
					<comment>doi:<ext-link ext-link-type="doi" xlink:href="http://dx.doi.org/10.1371/journal.pcbi.0020130" xlink:type="simple">10.1371/journal.pcbi.0020130</ext-link></comment>
				</element-citation></ref><ref id="pcbi-0030216-b029"><label>29</label><element-citation publication-type="journal" xlink:type="simple">
					<person-group person-group-type="author"><name name-style="western"><surname>Emberly</surname><given-names>E</given-names></name><name name-style="western"><surname>Rajewsky</surname><given-names>N</given-names></name><name name-style="western"><surname>Siggia</surname><given-names>ED</given-names></name></person-group>
					<year>2003</year>
					<article-title>Conservation of regulatory elements between two species of Drosophila.</article-title>
					<source>BMC Bioinformatics</source>
					<volume>4</volume>
					<fpage>57</fpage>
				</element-citation></ref><ref id="pcbi-0030216-b030"><label>30</label><element-citation publication-type="journal" xlink:type="simple">
					<person-group person-group-type="author"><name name-style="western"><surname>Sinha</surname><given-names>S</given-names></name><name name-style="western"><surname>Siggia</surname><given-names>ED</given-names></name></person-group>
					<year>2005</year>
					<article-title>Sequence turnover and tandem repeats in cis-regulatory modules in Drosophila.</article-title>
					<source>Mol Biol Evol</source>
					<volume>22</volume>
					<fpage>874</fpage>
					<lpage>885</lpage>
				</element-citation></ref><ref id="pcbi-0030216-b031"><label>31</label><element-citation publication-type="journal" xlink:type="simple">
					<person-group person-group-type="author"><name name-style="western"><surname>Sinha</surname><given-names>S</given-names></name><name name-style="western"><surname>Schroeder</surname><given-names>MD</given-names></name><name name-style="western"><surname>Unnerstall</surname><given-names>U</given-names></name><name name-style="western"><surname>Gaul</surname><given-names>U</given-names></name><name name-style="western"><surname>Siggia</surname><given-names>ED</given-names></name></person-group>
					<year>2004</year>
					<article-title>Cross-species comparison significantly improves genome-wide prediction of cis-regulatory modules in Drosophila.</article-title>
					<source>BMC Bioinformatics</source>
					<volume>5</volume>
					<fpage>129</fpage>
				</element-citation></ref><ref id="pcbi-0030216-b032"><label>32</label><element-citation publication-type="journal" xlink:type="simple">
					<person-group person-group-type="author"><name name-style="western"><surname>Grad</surname><given-names>YH</given-names></name><name name-style="western"><surname>Roth</surname><given-names>FP</given-names></name><name name-style="western"><surname>Halfon</surname><given-names>MS</given-names></name><name name-style="western"><surname>Church</surname><given-names>GM</given-names></name></person-group>
					<year>2004</year>
					<article-title>Prediction of similarly acting cis-regulatory modules by subsequence profiling and comparative genomics in Drosophila melanogaster and D. pseudoobscura.</article-title>
					<source>Bioinformatics</source>
					<volume>20</volume>
					<fpage>2738</fpage>
					<lpage>2750</lpage>
				</element-citation></ref><ref id="pcbi-0030216-b033"><label>33</label><element-citation publication-type="journal" xlink:type="simple">
					<person-group person-group-type="author"><name name-style="western"><surname>Zhou</surname><given-names>Q</given-names></name><name name-style="western"><surname>Wong</surname><given-names>WH</given-names></name></person-group>
					<year>2004</year>
					<article-title>CisModule: de novo discovery of cis-regulatory modules by hierarchical mixture modeling.</article-title>
					<source>Proc Natl Acad Sci U S A</source>
					<volume>101</volume>
					<fpage>12114</fpage>
					<lpage>12119</lpage>
				</element-citation></ref><ref id="pcbi-0030216-b034"><label>34</label><element-citation publication-type="journal" xlink:type="simple">
					<person-group person-group-type="author"><name name-style="western"><surname>Benson</surname><given-names>G</given-names></name></person-group>
					<year>1999</year>
					<article-title>Tandem repeats finder: a program to analyze DNA sequences.</article-title>
					<source>Nucleic Acids Res</source>
					<volume>15</volume>
					<fpage>573</fpage>
					<lpage>580</lpage>
				</element-citation></ref><ref id="pcbi-0030216-b035"><label>35</label><element-citation publication-type="journal" xlink:type="simple">
					<person-group person-group-type="author"><name name-style="western"><surname>Siepel</surname><given-names>A</given-names></name><name name-style="western"><surname>Haussler</surname><given-names>D</given-names></name></person-group>
					<year>2004</year>
					<article-title>Combining phylogenetic and hidden Markov models in biosequence analysis.</article-title>
					<source>J Comput Biol</source>
					<volume>11</volume>
					<fpage>413</fpage>
					<lpage>428</lpage>
				</element-citation></ref><ref id="pcbi-0030216-b036"><label>36</label><element-citation publication-type="journal" xlink:type="simple">
					<person-group person-group-type="author"><name name-style="western"><surname>Elnitski</surname><given-names>L</given-names></name><name name-style="western"><surname>Hardison</surname><given-names>RC</given-names></name><name name-style="western"><surname>Li</surname><given-names>J</given-names></name><name name-style="western"><surname>Yang</surname><given-names>S</given-names></name><name name-style="western"><surname>Kolbe</surname><given-names>D</given-names></name><etal/></person-group>
					<year>2003</year>
					<article-title>Distinguishing regulatory DNA from neutral sites.</article-title>
					<source>Genome Res</source>
					<volume>13</volume>
					<fpage>64</fpage>
					<lpage>72</lpage>
				</element-citation></ref><ref id="pcbi-0030216-b037"><label>37</label><element-citation publication-type="journal" xlink:type="simple">
					<person-group person-group-type="author"><name name-style="western"><surname>Sinha</surname><given-names>S</given-names></name><name name-style="western"><surname>Blanchette</surname><given-names>M</given-names></name><name name-style="western"><surname>Tompa</surname><given-names>M</given-names></name></person-group>
					<year>2004</year>
					<article-title>PhyME: a probabilistic algorithm for finding motifs in sets of orthologous sequences.</article-title>
					<source>BMC Bioinformatics</source>
					<volume>5</volume>
					<fpage>170</fpage>
				</element-citation></ref><ref id="pcbi-0030216-b038"><label>38</label><element-citation publication-type="journal" xlink:type="simple">
					<person-group person-group-type="author"><name name-style="western"><surname>Felsenstein</surname><given-names>J</given-names></name></person-group>
					<year>1981</year>
					<article-title>Evolutionary trees from DNA sequences: a maximum likelihood approach.</article-title>
					<source>J Mol Evol</source>
					<volume>17</volume>
					<fpage>368</fpage>
					<lpage>376</lpage>
				</element-citation></ref><ref id="pcbi-0030216-b039"><label>39</label><element-citation publication-type="journal" xlink:type="simple">
					<person-group person-group-type="author"><name name-style="western"><surname>Baum</surname><given-names>LE</given-names></name><name name-style="western"><surname>Petrie</surname><given-names>T</given-names></name><name name-style="western"><surname>Soules</surname><given-names>G</given-names></name><name name-style="western"><surname>Weiss</surname><given-names>N</given-names></name></person-group>
					<year>1970</year>
					<article-title>A maximization technique occurring in the statistical analysis of probabilistic functions of Markov chains.</article-title>
					<source>Ann Math Statist</source>
					<volume>41</volume>
					<fpage>164</fpage>
					<lpage>171</lpage>
				</element-citation></ref><ref id="pcbi-0030216-b040"><label>40</label><element-citation publication-type="journal" xlink:type="simple">
					<person-group person-group-type="author"><name name-style="western"><surname>Chao</surname><given-names>KM</given-names></name><name name-style="western"><surname>Pearson</surname><given-names>WR</given-names></name><name name-style="western"><surname>Miller</surname><given-names>W</given-names></name></person-group>
					<year>1992</year>
					<article-title>Aligning two sequences within a specified diagonal band.</article-title>
					<source>Comput Appl Biosci</source>
					<volume>8</volume>
					<fpage>481</fpage>
					<lpage>487</lpage>
				</element-citation></ref><ref id="pcbi-0030216-b041"><label>41</label><element-citation publication-type="journal" xlink:type="simple">
					<person-group person-group-type="author"><name name-style="western"><surname>Pollard</surname><given-names>DA</given-names></name><name name-style="western"><surname>Moses</surname><given-names>AM</given-names></name><name name-style="western"><surname>Iyer</surname><given-names>VN</given-names></name><name name-style="western"><surname>Eisen</surname><given-names>MB</given-names></name></person-group>
					<year>2006</year>
					<article-title>Detecting the limits of regulatory element conservation and divergence estimation using pairwise and multiple alignments.</article-title>
					<source>BMC Bioinformatics</source>
					<volume>7</volume>
					<fpage>376</fpage>
				</element-citation></ref></ref-list></back></article>