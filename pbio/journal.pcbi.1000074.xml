<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article
  PUBLIC "-//NLM//DTD Journal Publishing DTD v3.0 20080202//EN" "http://dtd.nlm.nih.gov/publishing/3.0/journalpublishing3.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="3.0" xml:lang="EN"><front><journal-meta><journal-id journal-id-type="publisher-id">plos</journal-id><journal-id journal-id-type="nlm-ta">PLoS Comput Biol</journal-id><journal-id journal-id-type="pmc">ploscomp</journal-id><!--===== Grouping journal title elements =====--><journal-title-group><journal-title>PLoS Computational Biology</journal-title></journal-title-group><issn pub-type="ppub">1553-734X</issn><issn pub-type="epub">1553-7358</issn><publisher><publisher-name>Public Library of Science</publisher-name><publisher-loc>San Francisco, USA</publisher-loc></publisher></journal-meta><article-meta><article-id pub-id-type="publisher-id">07-PLCB-RA-0372R3</article-id><article-id pub-id-type="doi">10.1371/journal.pcbi.1000074</article-id><article-categories><subj-group subj-group-type="heading"><subject>Research Article</subject></subj-group><subj-group subj-group-type="Discipline"><subject>Computational Biology/Metagenomics</subject><subject>Evolutionary Biology/Bioinformatics</subject><subject>Infectious Diseases/HIV Infection and AIDS</subject><subject>Mathematics/Statistics</subject></subj-group></article-categories><title-group><article-title>Viral Population Estimation Using Pyrosequencing</article-title><alt-title alt-title-type="running-head">Viral Population Estimation Using Pyrosequencing</alt-title></title-group><contrib-group><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Eriksson</surname><given-names>Nicholas</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref><xref ref-type="corresp" rid="cor1"><sup>*</sup></xref></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Pachter</surname><given-names>Lior</given-names></name><xref ref-type="aff" rid="aff2"><sup>2</sup></xref></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Mitsuya</surname><given-names>Yumi</given-names></name><xref ref-type="aff" rid="aff3"><sup>3</sup></xref></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Rhee</surname><given-names>Soo-Yon</given-names></name><xref ref-type="aff" rid="aff3"><sup>3</sup></xref></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Wang</surname><given-names>Chunlin</given-names></name><xref ref-type="aff" rid="aff3"><sup>3</sup></xref></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Gharizadeh</surname><given-names>Baback</given-names></name><xref ref-type="aff" rid="aff4"><sup>4</sup></xref></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Ronaghi</surname><given-names>Mostafa</given-names></name><xref ref-type="aff" rid="aff4"><sup>4</sup></xref></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Shafer</surname><given-names>Robert W.</given-names></name><xref ref-type="aff" rid="aff3"><sup>3</sup></xref></contrib><contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Beerenwinkel</surname><given-names>Niko</given-names></name><xref ref-type="aff" rid="aff5"><sup>5</sup></xref><xref ref-type="corresp" rid="cor1"><sup>*</sup></xref></contrib></contrib-group><aff id="aff1"><label>1</label><addr-line>Department of Statistics, University of Chicago, Chicago, Illinois, United States of America</addr-line>       </aff><aff id="aff2"><label>2</label><addr-line>Department of Mathematics, University of California, Berkeley, California, United States of America</addr-line>       </aff><aff id="aff3"><label>3</label><addr-line>Division of Infectious Diseases, Stanford University Medical Center, Stanford, California, United States of America</addr-line>       </aff><aff id="aff4"><label>4</label><addr-line>Genome Technology Center, Stanford University, Palo Alto, California, United States of America</addr-line>       </aff><aff id="aff5"><label>5</label><addr-line>Department of Biosystems Science and Engineering, ETH Zurich, Basel, Switzerland</addr-line>       </aff><contrib-group><contrib contrib-type="editor" xlink:type="simple"><name name-style="western"><surname>Tesler</surname><given-names>Glenn</given-names></name><role>Editor</role><xref ref-type="aff" rid="edit1"/></contrib></contrib-group><aff id="edit1">University of California San Diego, United States of America</aff><author-notes><corresp id="cor1">* E-mail: <email xlink:type="simple">eriksson@galton.uchicago.edu</email> (NE); <email xlink:type="simple">niko.beerenwinkel@bsse.ethz.ch</email> (NB)</corresp><fn fn-type="con"><p>Performed the experiments: YM SR CW BG MR RS. Analyzed the data: NE LP NB. Wrote the paper: NE LP NB.</p></fn><fn fn-type="conflict"><p>The authors have declared that no competing interests exist.</p></fn></author-notes><pub-date pub-type="collection"><month>5</month><year>2008</year></pub-date><pub-date pub-type="epub"><day>9</day><month>5</month><year>2008</year></pub-date><volume>4</volume><issue>5</issue><elocation-id>e1000074</elocation-id><history><date date-type="received"><day>2</day><month>7</month><year>2007</year></date><date date-type="accepted"><day>27</day><month>3</month><year>2008</year></date></history><!--===== Grouping copyright info into permissions =====--><permissions><copyright-year>2008</copyright-year><copyright-holder>Eriksson et al</copyright-holder><license><license-p>This is an open-access article distributed under the terms of the Creative Commons Attribution License, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p></license></permissions><abstract><p>The diversity of virus populations within single infected hosts presents a major difficulty for the natural immune response as well as for vaccine design and antiviral drug therapy. Recently developed pyrophosphate-based sequencing technologies (pyrosequencing) can be used for quantifying this diversity by ultra-deep sequencing of virus samples. We present computational methods for the analysis of such sequence data and apply these techniques to pyrosequencing data obtained from HIV populations within patients harboring drug-resistant virus strains. Our main result is the estimation of the population structure of the sample from the pyrosequencing reads. This inference is based on a statistical approach to error correction, followed by a combinatorial algorithm for constructing a minimal set of haplotypes that explain the data. Using this set of explaining haplotypes, we apply a statistical model to infer the frequencies of the haplotypes in the population via an expectation–maximization (EM) algorithm. We demonstrate that pyrosequencing reads allow for effective population reconstruction by extensive simulations and by comparison to 165 sequences obtained directly from clonal sequencing of four independent, diverse HIV populations. Thus, pyrosequencing can be used for cost-effective estimation of the structure of virus populations, promising new insights into viral evolutionary dynamics and disease control strategies.</p></abstract><abstract abstract-type="summary"><title>Author Summary</title><p>The genetic diversity of viral populations is important for biomedical problems such as disease progression, vaccine design, and drug resistance, yet it is not generally well understood. In this paper, we use pyrosequencing, a novel DNA sequencing technique, to reconstruct viral populations. Pyrosequencing produces DNA sequences, called reads, in numbers much greater than standard DNA sequencing techniques. However, these reads are substantially shorter and more error-prone than those obtained from standard sequencing techniques. Therefore, pyrosequencing data requires new methods of analysis. Here, we develop mathematical and statistical tools for reconstructing viral populations using pyrosequencing. To this end, we show how to correct errors in the reads and assemble them into the different viral strains present in the population. We apply these methods to HIV-1 populations from drug-resistant patients and show that our techniques produce results quite close to accepted techniques at a lower cost and potentially higher resolution.</p></abstract><funding-group><funding-statement>N. Eriksson and L. Pachter were partially supported by the NSF (grants DMS-0603448 and CCF-0347992, respectively). N. Beerenwinkel was funded by a grant from the Bill and Melinda Gates Foundation through the Grand Challenges in Global Health Initiative. The NSF has played no role in any part of this work.</funding-statement></funding-group><counts><page-count count="13"/></counts></article-meta></front><body><sec id="s1"><title>Introduction</title><p>Pyrosequencing is a novel experimental technique for determining the sequence of DNA bases in a genome <xref ref-type="bibr" rid="pcbi.1000074-FakhraiRad1">[1]</xref>,<xref ref-type="bibr" rid="pcbi.1000074-Margulies1">[2]</xref>. The method is faster, less laborious, and cheaper than existing technologies, but pyrosequencing reads are also significantly shorter and more error-prone (about 100–250 base pairs and 5–10 errors/kb) than those obtained from Sanger sequencing (about 1000 base pairs and 0.01 errors/kb) <xref ref-type="bibr" rid="pcbi.1000074-Malet1">[3]</xref>–<xref ref-type="bibr" rid="pcbi.1000074-Wang1">[5]</xref>.</p><p>In this paper we address computational issues that arise in applying this technology to the sequencing of an RNA virus sample. Within-host RNA virus populations consist of different haplotypes (or strains) that are evolutionarily related. The population can exhibit a high degree of genetic diversity and is often referred to as a quasispecies, a concept that originally described a mutation-selection balance <xref ref-type="bibr" rid="pcbi.1000074-Eigen1">[6]</xref>,<xref ref-type="bibr" rid="pcbi.1000074-Domingo1">[7]</xref>. Viral genetic diversity is a key factor in disease progression <xref ref-type="bibr" rid="pcbi.1000074-Nowak1">[8]</xref>,<xref ref-type="bibr" rid="pcbi.1000074-Shankarappa1">[9]</xref>, vaccine design <xref ref-type="bibr" rid="pcbi.1000074-Gaschen1">[10]</xref>,<xref ref-type="bibr" rid="pcbi.1000074-Douek1">[11]</xref>, and antiretroviral drug therapy <xref ref-type="bibr" rid="pcbi.1000074-Beerenwinkel1">[12]</xref>,<xref ref-type="bibr" rid="pcbi.1000074-Rhee1">[13]</xref>. Ultra-deep sequencing of mixed virus samples is a promising approach to quantifying this diversity and to resolving the viral population structure <xref ref-type="bibr" rid="pcbi.1000074-OMeara1">[14]</xref>–<xref ref-type="bibr" rid="pcbi.1000074-Tsibris1">[16]</xref>.</p><p>Pyrosequencing of a virus population produces many reads, each of which originates from exactly one—but unknown—haplotype in the population. Thus, the central problem is to reconstruct from the read data the set of possible haplotypes that is consistent with the observed reads and to infer the structure of the population, i.e., the relative frequency of each haplotype.</p><p>Here we present a computational four-step procedure for making inference about the virus population based on a set of pyrosequencing reads (<xref ref-type="fig" rid="pcbi-1000074-g001">Figure 1</xref>). First, the reads are aligned to a reference genome. Second, sequencing errors are corrected locally in windows along the multiple alignment using clustering techniques. Next, we assemble haplotypes that are consistent with the observed reads. We formulate this problem as a search for a set of covering paths in a directed acyclic graph and show how the search problem can be solved very efficiently. Finally, we introduce a statistical model that mimics the sequencing process and we employ the maximum likelihood (ML) principle for estimating the frequency of each haplotype in the population.</p><fig id="pcbi-1000074-g001" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1000074.g001</object-id><label>Figure 1</label><caption><title>Overview of viral population estimation using pyrosequencing.</title><p>Sequence reads are first aligned to a reference strain, then corrected for errors, and assembled into haplotype candidates. Finally, the relative frequencies of the reconstructed haplotypes are estimated in a ML fashion. These estimates constitute the inferred virus population.</p></caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000074.g001" xlink:type="simple"/></fig><p>The alignment step of the proposed procedure is straightforward for the data analyzed here and has been discussed elsewhere <xref ref-type="bibr" rid="pcbi.1000074-Wang1">[5]</xref>. Due to the presence of a reference genome, only pair-wise alignment is necessary between each read and the reference genome. We will therefore focus on the core methods of error correction, haplotype reconstruction, and haplotype frequency estimation. Two independent approaches are pursued for validating the proposed method. First, we present extensive simulation results of all the steps in the method. Second, we validate the procedure by reconstructing four independent HIV populations from pyrosequencing reads and comparing these populations to the results of clonal Sanger sequencing from the same samples.</p><p>These datasets consist of approximately 5000 to 8000 reads of average length 105 bp sequenced from a 1 kb region of the <italic>pol</italic> gene from clinical samples of HIV-1 populations. Pyrosequencing (with the Roche GS20 platform <xref ref-type="bibr" rid="pcbi.1000074-Roche1">[17]</xref>) can produce up to 200,000 usable reads in a single run. Part of our contribution is an analysis of the interaction between the number of reads, the sequencing error rate and the theoretical resolution of haplotype reconstruction. The methods developed in this paper scale to these huge datasets under reasonable assumptions. However, we concentrate mainly on a sample size (about 10,000 reads) that produces finer resolution than what is typically obtained using limiting dilution clonal sequencing. Since many samples can be run simultaneously and independently, this raises the possibility of obtaining data from about 20 populations with one pyrosequencing run.</p><p>Estimating the viral population structure from a set of reads is, in general, an extremely hard computational problem because of the huge number of possible haplotypes. The decoupling of error correction, haplotype reconstruction, and haplotype frequency estimation breaks this problem into three smaller and more manageable tasks, each of which is also of interest in its own right. The presented methods are not restricted to RNA virus populations, but apply whenever a reference genome is available for aligning the reads, the read coverage is sufficient, and the genetic distance between haplotypes is large enough. Clonal data indicates that the typical variation in the HIV <italic>pol</italic> gene is about 3 to 5% in a single patient <xref ref-type="bibr" rid="pcbi.1000074-Bacheler1">[18]</xref>. We find that as populations grow more diverse, they become easier to reconstruct. Even at 3% diversity, we find that much of the population can be reconstructed using our methods.</p><p>The <italic>pol</italic> gene has been sequenced extensively and (essentially) only one specific insertion seems to occur, namely the 69 insertion complex, which occurs under NRTI pressure <xref ref-type="bibr" rid="pcbi.1000074-Johnson1">[19]</xref>. None of our samples were treated with NRTIs, and the Sanger clones did not display this (nor any other) indel. Therefore we assume throughout that there are no true indels in the population. However, the algorithms developed in this paper generalize in a straightforward manner for the case of true indels.</p><p>The problem of estimating the population structure from sequence reads is similar to assembly of a highly repetitive genome <xref ref-type="bibr" rid="pcbi.1000074-Pevzner1">[20]</xref>. However, rather than reconstructing one genome, we seek to reconstruct a population of very similar genomes. As such, the problem is also related to environmental sequencing projects, which try to assess the genomes of all species in a community <xref ref-type="bibr" rid="pcbi.1000074-Tyson1">[21]</xref>. While the associated computational biology problems are related to those that appear in other metagenomics projects <xref ref-type="bibr" rid="pcbi.1000074-Chen1">[22]</xref>, novel approaches are required to deal with the short and error-prone pyrosequencing reads and the complex structure of viral populations. The problem is also similar to the haplotype reconstruction problem <xref ref-type="bibr" rid="pcbi.1000074-The1">[23]</xref>, with the main difference being that the number of haplotypes is unknown in advance, and to estimating the diversity of alternative splicing <xref ref-type="bibr" rid="pcbi.1000074-Jenkins1">[24]</xref>.</p><p>More generally, the problem of estimating diversity in a population from genome sequence samples has been studied extensively for microbial populations. For example, the spectrum of contig lengths has been used to estimate diversity from shotgun sequencing data <xref ref-type="bibr" rid="pcbi.1000074-Breitbart1">[25]</xref>. Using pyrosequencing reads, microbial diversity has been assessed by counting BLAST hits in sequence databases <xref ref-type="bibr" rid="pcbi.1000074-Sogin1">[26]</xref>. Our methods differ from previous work in that we show how to analyze highly directed, ultra-deep sequencing data using a rigorous mathematical and statistical framework.</p></sec><sec id="s2"><title>Results</title><p>We have developed a computational and statistical procedure for inferring the structure of a diverse virus population from pyrosequencing reads. Our approach comprises four consecutive steps (<xref ref-type="fig" rid="pcbi-1000074-g001">Figure 1</xref>), starting with the alignment of reads to a reference sequence and followed by error correction, haplotype reconstruction, and haplotype frequency estimation.</p><sec id="s2a"><title>Error correction</title><p>Given the high error rate of pyrosequencing, error correction is a necessary starting point for inferring the virus population. The errors in pyrosequencing reads typically take the form of one-base indels along with substitutions and ambiguous bases and occur most often in homopolymeric regions. The reads come with quality scores for each base quantifying the probability that the base is correct.</p><p>Error rates with the Roche GS20 system have been estimated as approximately 5 to 10 errors per kb <xref ref-type="bibr" rid="pcbi.1000074-Huse1">[4]</xref>,<xref ref-type="bibr" rid="pcbi.1000074-Wang1">[5]</xref>. However, a small number of reads accounts for most of the errors. Thus after discarding approximately 10% of the reads (those with ambiguous bases or atypical length), the error can be reduced to 1 to 3 errors per kb <xref ref-type="bibr" rid="pcbi.1000074-Huse1">[4]</xref>. These remaining errors are about half insertions and a quarter each deletions and substitutions.</p><p>Due to our assumption that there are no haplotypes with insertions in the population, the insertions in the reads can all be simply corrected through alignment with the reference genome. We do not deal with the problem of alignment here; it is straightforward because our assumption of the existence of a reference genome implies that only pair-wise alignment is necessary. In the remainder of the paper, we assume that a correct alignment is given, leaving about 1 error per kb to correct (or 3 errors per kb if the low-quality reads are not aggressively pruned).</p><p>Our approach for error correction resembles the method of <xref ref-type="bibr" rid="pcbi.1000074-Kececioglu1">[27]</xref> for distinguishing repeats in whole genome shotgun assemblies combined with <xref ref-type="bibr" rid="pcbi.1000074-Tammi1">[28]</xref>. We consider all the reads in a window over the multiple alignment and cluster these reads using a statistical testing procedure to detect if a group of reads should be further split (<xref ref-type="fig" rid="pcbi-1000074-g002">Figure 2</xref>). The reads in each cluster are then corrected to the consensus sequence of the cluster.</p><fig id="pcbi-1000074-g002" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1000074.g002</object-id><label>Figure 2</label><caption><title>Error correction.</title><p>Fixed-width windows (shown as the dashed box) over the aligned reads are considered. Two different types of reads are depicted (light versus dark lines), indicating their origin from two different haplotypes. Genetic differences (indicated by circles and squares) provide the basis for clustering reads into groups representing the respective haplotypes. After clustering, errors (marked as crosses) can be corrected.</p></caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000074.g002" xlink:type="simple"/></fig><p>The statistical testing procedure consists of two steps. First, every column in the window is tested for over-representation of a mutation using a binomial test. Second, every pair of columns is tested to see if a pair of mutations happens together more often than would be expected by chance. See <xref ref-type="sec" rid="s4">Methods</xref> for details on the tests.</p><p>Any significant over-representation of a mutation or a pair in a window is regarded as evidence for the reads originating from more than one haplotype. The testing procedure produces an estimate for the number of haplotypes in the window as follows. First, all single mutations are tested for significance; each significant mutation gives evidence for another haplotype in the window. Next, all pairs of mutations are tested; any significant pairs is evidence for another haplotype. However, this process can over-count the number of haplotypes in the window in certain cases if two mutations are significant both by themselves and as a pair. In this case, we correct for the over-count (see <xref ref-type="sec" rid="s4">Methods</xref>).</p><p>We then separate the reads into <italic>k</italic> groups using <italic>k</italic>-means clustering. The algorithm is initialized with both random clusters and clusters found by a divisive clustering method based on the statistical tests. We use the Hamming distance between sequences to calculate cluster membership; the consensus sequences define the cluster centers. The consensus sequence is computed from weighted counts based on the quality scores. Thus, the inferred cluster centers are the reconstructed haplotypes. Combining testing and clustering we proceed as follows:</p></sec><sec id="s2b"><title>Algorithm 1. (Local error correction)</title><p>Input: A window of aligned reads</p><p>Output: The <italic>k</italic> haplotypes in the window and the error corrected reads</p><p>Procedure:</p><list list-type="order"><list-item><p>Find all candidate mutations and pairs of mutations and test for overrepresentation.</p></list-item><list-item><p>Count the number of non-redundant mutations and pairs that are significant. This is the number <italic>k</italic> of haplotypes in the window.</p></list-item><list-item><p>Cluster the reads in the window into <italic>k</italic> clusters and correct each read to its cluster center.</p></list-item><list-item><p>Output corrected reads.</p></list-item></list><p>Applying a parsimony principle the algorithm finds the smallest number <italic>k</italic> of haplotypes that explain the observed reads in each window. The genomic region to be analyzed is divided into consecutive windows and Algorithm 1 is run in each of them. We use three collections of successive windows that are shifted relative to each other such that each base in the region is covered exactly three times. The final correction of each base is the consensus of the three runs.</p><p>The error correction procedure can lead to uncorrected errors or miscorrections via false positives and negatives (leading to over/underestimation of the number of haplotypes in a window) or misclustering. See <xref ref-type="sec" rid="s4">Methods</xref> for implementation details and a discussion of setting the parameters so as to minimize these mistakes.</p><p>False positives arise when an error is seen as a significant variant; they will be consequences of setting the error rate too low or the significance level too high, or if errors are highly correlated. Misclustering can happen if errors occur frequently enough on a single read to make that read appear closer to an incorrect haplotype. This likelihood is increased as the window size grows and more reads overlap the window only partially.</p><p>An analysis of the false negative rate gives an idea of the theoretical resolution of pyrosequencing. False negatives arise when a true variant tests as non-significant and thus is erased. If the input data were error-free, this would be the only source of mistaken corrections and would happen by eliminating rare variants. Given an error rate of 2.5 errors per kb, the calculation in the <xref ref-type="sec" rid="s4">Methods</xref> Section shows that variants present in under 1% of the population would be erased on a dataset of 10,000 reads. Below we will show that this number of reads is about enough to expect to resolve haplotypes present in 1% of the population.</p></sec><sec id="s2c"><title>Haplotype reconstruction</title><p>Our approach to haplotype reconstruction rests on two basic beliefs. First, the haplotypes in the populations should not exhibit characteristics that are not present in the set of reads. This means that every haplotype in the population should be realizable as an overlapping series of reads. Second, the population should explain as many reads as possible with as few haplotypes as possible.</p><p>We assume a set <bold>R</bold> of aligned and error-corrected reads obtained from sequencing a population. If all haplotypes have the same length <italic>n</italic>, then each aligned read consists of a start position in the genome and a string representing the genomic sequence. We say that two reads overlap if there are positions in the genome to which they are both aligned. They agree on their overlap if they agree at all of these positions. We call a haplotype <italic>completely consistent</italic> with the set of reads <bold>R</bold> if the haplotype can be constructed from a subset of overlapping reads of <bold>R</bold> that agree on their overlaps. Let <bold>C<sub>R</sub></bold> be the set of all haplotypes that are completely consistent with <bold>R</bold>. In the following, we provide methods for constructing and sampling from <bold>C<sub>R</sub></bold> and we present an efficient algorithm for computing a lower bound on the number of haplotypes necessary to explain the reads. Both techniques rely on the concept of a read graph.</p></sec><sec id="s2d"><title>Definition (Read graph)</title><p>The <italic>read graph</italic> <bold>G<sub>R</sub></bold> associated with a set of reads <bold>R</bold> is the acyclic directed graph with vertices {<bold>R</bold><sub>irred</sub>, <italic>s</italic>, <italic>t</italic>} consisting of a source <italic>s</italic>, a sink <italic>t</italic>, and one vertex for every irredundant read <italic>r</italic> ∈ <bold>R</bold>. Here, a read is <italic>redundant</italic> if there is another read that overlaps it completely such that the two reads agree on their overlap. The edge set of <bold>G<sub>R</sub></bold> is defined by including an edge from an irredundant read <italic>r</italic><sub>1</sub> to an irredundant read <italic>r</italic><sub>2</sub>, if</p><list list-type="order"><list-item><p><italic>r</italic><sub>1</sub> starts before <italic>r</italic><sub>2</sub> in the genome,</p></list-item><list-item><p><italic>r</italic><sub>1</sub> and <italic>r</italic><sub>2</sub> agree on their (non-empty) overlap, and</p></list-item><list-item><p>there would not be a path in <bold>G<sub>R</sub></bold> from <italic>r</italic><sub>1</sub> to <italic>r</italic><sub>1</sub> without this edge.</p></list-item></list><p>Finally, edges are added from the source <italic>s</italic> to all reads beginning at position 1, and from all reads ending at position <italic>n</italic> to the sink <italic>t</italic>.</p><p>A path in the read graph from the source to the sink corresponds to a haplotype that is completely consistent with <bold>R</bold>. Thus, finding <bold>C<sub>R</sub></bold>, the set of completely consistent haplotypes, amounts to efficiently enumerating paths in the read graph.</p><p>For example, in <xref ref-type="fig" rid="pcbi-1000074-g003">Figure 3</xref>, a simplified genome of length <italic>n</italic> = 8 over the binary alphabet {0,1} is considered, and an alignment of 20 reads, each of length 3, is shown in <xref ref-type="fig" rid="pcbi-1000074-g003">Figure 3A</xref>. These data give rise to the read graph depicted in <xref ref-type="fig" rid="pcbi-1000074-g003">Figure 3B</xref>. For instance, the haplotype 00110000 is completely consistent with the reads and corresponds to the top path in the graph. For more complex read graphs, see <xref ref-type="fig" rid="pcbi-1000074-g004">Figure 4</xref>.</p><fig id="pcbi-1000074-g003" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1000074.g003</object-id><label>Figure 3</label><caption><title>Read graph.</title><p>A simplified genome of length <italic>n</italic> = 8 over the binary alphabet {0,1} is considered. Twenty reads of length 3 each are aligned to an assumed reference sequence (A). The induced read graph has 20+2 vertices and 28 edges (B).</p></caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000074.g003" xlink:type="simple"/></fig><fig id="pcbi-1000074-g004" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1000074.g004</object-id><label>Figure 4</label><caption><title>Read graphs for increasing diversity levels.</title><p>Displayed are three read graphs of 1000 reads each derived from populations of 5 haplotypes at 3% (A), 5% (B), and 7% diversity (C). The bottom five lines in the graph correspond to reads which match the five haplotypes uniquely; the top line in subfigures (A) and (B) contains reads which match several haplotypes. In each subfigure, the reads are colored according to a single chain decomposition.</p></caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000074.g004" xlink:type="simple"/></fig><p>We say that a set of haplotypes <bold>H</bold> is an <italic>explaining</italic> set for <bold>R</bold> if every read <italic>r</italic> ∈ <bold>R</bold> can be obtained as a substring of some haplotype in <bold>H</bold>. We seek a small set of explaining haplotypes and focus on the set <bold>C<sub>R</sub></bold>, which consists exactly of those haplotypes that emerge from the data. The following proposition provides a criterion for <bold>C<sub>R</sub></bold> to be an explaining set in terms of the read graph.</p></sec><sec id="s2e"><title>Proposition</title><p>The set of haplotypes completely consistent with a set of reads is an explaining set for these reads if, and only if, every vertex of the read graph lies on a directed path from the source to the sink.</p><p>The Lander–Waterman model of sequencing is based on the assumptions that reads are random (uniformly distributed on a genome) and independent <xref ref-type="bibr" rid="pcbi.1000074-Lander1">[29]</xref>. In this model, the probability that all bases of a genome of length <italic>n</italic> are sequenced follows the Poisson distribution <italic>p</italic> = (1−<italic>e</italic><sup>−<italic>c</italic></sup>)<italic><sup>n</sup></italic>, where <italic>c</italic> is the coverage (the total number of bases sequenced per position). For a sequencing experiment from a mixed population with different abundances of haplotypes (or subspecies), a similar approach can be applied <xref ref-type="bibr" rid="pcbi.1000074-Chen1">[22]</xref>. For the probability of complete coverage of all haplotypes occurring with a frequency of at least ρ, we have <italic>p</italic>≥(1−<italic>e</italic><sup>−<italic>c</italic>,ρ</sup>)<italic><sup>n</sup></italic>. Since <italic>c</italic> = <italic>NL</italic>/<italic>n</italic>, where <italic>N</italic> is the number of reads and <italic>L</italic> is the read length, sequencing<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000074.e001" xlink:type="simple"/><label>(1)</label></disp-formula>reads will ensure that the completely consistent haplotypes assembled from the reads are an explaining set for these haplotypes. For example, in order to cover all haplotypes of 5% or higher frequency of length 1000 bases with reads of length 100 with 99% probability, at least 2302 reads need to be sequenced; to reach haplotypes at 1% frequency with 99% probability, 11,508 reads are needed. Notice that the number of reads needed scales linearly with the inverse of the smallest frequency desired. We note that the actual number of required reads can be much smaller in genomic regions of low diversity.</p><p>If the condition of the proposition is violated, we can remove the violating set of reads to obtain a new set satisfying the condition. This amounts to discarding reads that either contain mistakes in the error correction or come from haplotypes that are at a too low frequency in the population to be fully sequenced. Thus the resolution is inherently a function of the number of reads.</p><p>We are now left with finding a minimal explaining set of completely consistent haplotypes. Restricting to this subset of haplotypes reduces the computational demand of the problem significantly. The proposition implies that an explaining set of completely consistent haplotypes is precisely a set of paths in the read graph from the source to the sink, such that all vertices of the read graph are covered by at least one path. We call such a set of paths a <italic>cover</italic> of the read graph. The following result shows that a minimal cover can be computed efficiently (see <xref ref-type="sec" rid="s4">Methods</xref> for a proof).</p></sec><sec id="s2f"><title>Dilworth's Theorem <xref ref-type="bibr" rid="pcbi.1000074-Dilworth1">[30]</xref></title><list list-type="order"><list-item><p>Every minimal cover of the read graph has the same cardinality, namely the size of the largest set <bold>Q</bold> of vertices such that there are no paths between elements of <bold>Q</bold>.</p></list-item><list-item><p>A minimal cover of the read graph can be computed by solving a maximum matching problem in an associated bipartite graph. This matching problem can be solved in time at worst cubic in the number of irredundant reads.</p></list-item></list><p>The minimal path cover obtained from the maximum matching algorithm is in general not unique. First, it provides a minimal chain decomposition of the graph. A <italic>chain</italic> in a directed acyclic graph is a set of vertices that all lie on at least one common path from the source to the sink. A chain can generally be extended to a number of different paths. Second, the minimal chain decomposition itself is in general not unique. However, the cardinality of the minimal cover is well-defined. It is an important invariant of the set of reads, indicating the smallest number of haplotypes that can explain the data. Notice that the size of the minimal read graph cover can be greater than the maximum number of haplotypes in a given window of the error correction step. The cardinality of the minimal cover is a global invariant of the set of reads.</p></sec><sec id="s2g"><title>Algorithm 2. (Minimal set of explaining haplotypes)</title><p>Input: A set <bold>R</bold> of aligned, error corrected reads satisfying the conditions of the proposition</p><p>Output: A minimal set of explaining haplotypes for <bold>R</bold></p><p>Procedure:</p><list list-type="order"><list-item><p>Construct the read graph <bold>G<sub>R</sub></bold> associated with <bold>R</bold>.</p></list-item><list-item><p>Compute a minimal chain decomposition of the read graph.</p></list-item><list-item><p>Extend the chains in the graph to paths from the source to the sink in <bold>G<sub>R</sub></bold>.</p></list-item><list-item><p>Output the set of haplotypes corresponding to the paths found in step 3.</p></list-item></list><p>The algorithm can easily be modified to produce a non-minimal set by constructing multiple chain decompositions and by choosing multiple ways to extend a chain to a path. We note that the set of all paths in the graph is generally much too large to be useful. For example, the HIV datasets give rise to up to 10<sup>9</sup> paths and in simulations we often found over 10<sup>12</sup> different paths in the graph. Generating paths from minimal explaining sets is a reasonable way of sampling paths, as we will see below when discussing simulation results (see also <xref ref-type="fig" rid="pcbi-1000074-g004">Figure 4</xref> and <xref ref-type="supplementary-material" rid="pcbi.1000074.s001">Figure S1</xref>).</p><p>Finally, if the conditions of the proposition are not satisfied, i.e., if the coverage is too low and the set of completely consistent haplotypes does not contain an explaining set, then that condition can be relaxed. This corresponds to modifying the read graph by adding edges between all non-overlapping reads. Algorithm 2 will then again find a minimal set of explaining haplotypes.</p></sec><sec id="s2h"><title>Haplotype frequency estimation</title><p>A virus population is a probability distribution on a set of haplotypes. We want to estimate this distribution from a set of observed reads. Let <bold>H</bold> be a set of candidate haplotypes. In principle, we would like <bold>H</bold> to be the set of all possible haplotypes, but in practice we must restrict <bold>H</bold> to a smaller set of explaining haplotypes as derived from Algorithm 2 in order to make the estimation process feasible. Let <bold>R</bold> be the set of all possible reads that are consistent with the candidate haplotypes in <bold>H</bold>. The read data is given as a vector <italic>u</italic> ∈ <bold>N<sup>R</sup></bold>, where <italic>u<sub>r</sub></italic> is the number of times that read <italic>r</italic> has been observed.</p><p>Our inference is based on a statistical model for the generation of sequence reads from a virus population. Similar models have been used for haplotype frequency estimation <xref ref-type="bibr" rid="pcbi.1000074-Excoffier1">[31]</xref>–<xref ref-type="bibr" rid="pcbi.1000074-Halperin1">[33]</xref>. We assume that reads are sampled as follows (<xref ref-type="fig" rid="pcbi-1000074-g005">Figure 5</xref>). First, a haplotype <italic>h</italic> is drawn at random from the unknown probability distribution <italic>p</italic> = (<italic>p<sub>h</sub></italic>)<italic><sub>h</sub></italic><sub>∈<bold>H</bold></sub>. Second, a read <italic>r</italic> is drawn with uniform probability from the set of all reads with which the haplotype is consistent. Estimating the structure of the population is the problem of estimating <italic>p</italic> from <italic>u</italic> under this generative model.</p><fig id="pcbi-1000074-g005" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1000074.g005</object-id><label>Figure 5</label><caption><title>Schematic representation of the sampling process.</title><p>The virus population is represented by five genomes (top) of two different haplotypes (light versus dark lines). The probability distribution is <italic>p</italic> = (3/5, 2/5). The generative probabilistic model assumes that haplotypes are drawn from the population according to <italic>p</italic> and reads are sampled uniformly from the haplotypes (bottom).</p></caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000074.g005" xlink:type="simple"/></fig><p>Let <italic>H</italic> be the hidden random variable with values in <bold>H</bold> that describes the haplotype and <italic>R</italic> the observed random variable over <bold>R</bold> for the read. Then the probability of observing read <italic>r</italic> under this model is<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000074.e002" xlink:type="simple"/></disp-formula>where the conditional probability is defined as Pr(<italic>R</italic> = <italic>r</italic>∥<italic>H</italic> = <italic>h</italic>) = 1/<italic>K</italic>, if <italic>h</italic> is consistent with <italic>r</italic>, and 0 otherwise. Here <italic>K</italic> is the number of reads <italic>r</italic> ∈ <bold>R</bold> that <italic>h</italic> is consistent with. Since we assume that all haplotypes have the same length, <italic>K</italic> is independent of both <italic>r</italic> and <italic>h</italic>.</p><p>We estimate <italic>p</italic> by maximizing the log-likelihood function<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000074.e003" xlink:type="simple"/></disp-formula>This is achieved by employing an EM algorithm (see <xref ref-type="sec" rid="s4">Methods</xref> for details). Each iteration of the EM algorithm runs in time <italic>O</italic>(|<bold>R</bold>||<bold>H</bold>|). For example, for 5000 reads and 200 candidate haplotypes, the EM algorithm typically converges within minutes on a standard PC. Software implementing the algorithms for error correction, haplotype reconstruction, and frequency estimation is available upon request from the authors.</p></sec><sec id="s2i"><title>Simulation results</title><p>We have simulated HIV populations of different diversities and then generated reads from these populations by simulating the pyrosequencing procedure with various error rates and coverage depths. The first 1 kb of the HIV <italic>pol</italic> gene was the starting point for all simulations. We separately analyze the performance first of error correction, then of haplotype reconstruction, then of haplotype frequency estimation, and finally of the combination of these three steps.</p><p>The simulations show that Algorithm 1 reduces the error rate by a factor of 30. This performance is largely independent of the number of haplotypes in the population (<xref ref-type="supplementary-material" rid="pcbi.1000074.s003">Figure S3</xref>). The program ReadSim <xref ref-type="bibr" rid="pcbi.1000074-Schmid1">[34]</xref> was used to simulate the error process of pyrosequencing. The error rate after alignment is about 1 to 3 errors per kb, so we are left with about 0.1 errors per kb after error correction. As the population grows and becomes more diverse, the alignment becomes more difficult resulting in a smaller error reduction (<xref ref-type="supplementary-material" rid="pcbi.1000074.s003">Figure S3</xref>).</p><p>In order to assess the ability of Algorithm 2 to reconstruct 10 haplotypes from 10,000 error-free reads (yielding about 1500 irredundant reads) we generate increasing numbers of candidate haplotypes. This is achieved by repeatedly finding a minimal set of explaining haplotypes until either we reach the desired number of haplotypes or we are unable to find more haplotypes that are part of a minimal explaining set.</p><p><xref ref-type="fig" rid="pcbi-1000074-g006">Figure 6</xref> visualizes the enrichment of recovered true haplotypes with increasing number of candidate haplotypes for different levels of population diversity. While in low-diversity populations exact haplotype reconstruction can be very challenging (<xref ref-type="fig" rid="pcbi-1000074-g006">Figure 6A</xref>), the algorithm will always find haplotypes that are close to the true ones. For example, at 5% diversity 10 out of 50 candidate haplotypes will match the original 10 haplotypes at an average Hamming distance of just 1.6 amino acid differences (<xref ref-type="fig" rid="pcbi-1000074-g006">Figure 6B</xref>). With larger populations, the performance is similar although more candidate haplotypes need to be generated (<xref ref-type="supplementary-material" rid="pcbi.1000074.s002">Figure S2</xref>). Given that the read graphs considered in this test had about 3·10<sup>10</sup> total paths, the strategy of repeatedly finding minimal sets of explaining haplotypes is very efficient for haplotype reconstruction.</p><fig id="pcbi-1000074-g006" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1000074.g006</object-id><label>Figure 6</label><caption><title>Haplotype reconstruction.</title><p>Up to 300 candidate haplotypes were generated using Algorithm 1 from 10,000 error free reads drawn from populations of size 10 at varying diversity levels. Displayed are two measures of the efficiency of haplotype reconstruction: the percent of the original haplotypes with exact matches among the reconstructed haplotypes (A), and the average Hamming distance (in amino acids) between an original haplotype and its closest match among the reconstructed haplotypes (B).</p></caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000074.g006" xlink:type="simple"/></fig><p><xref ref-type="fig" rid="pcbi-1000074-g004">Figure 4</xref> shows how the haplotype reconstruction problem gets harder at lower diversity. In each graph, the bottom five lines correspond to reads matching one of the original five haplotypes uniquely. The sixth line on top (if present) corresponds to reads that could come from several haplotypes. At 3% diversity (<xref ref-type="fig" rid="pcbi-1000074-g004">Figure 4A</xref>), only one of the haplotypes is reconstructed well. At 5% diversity (<xref ref-type="fig" rid="pcbi-1000074-g004">Figure 4B</xref>), the decomposition is almost correct except for a few small “crossovers”. At 7% diversity (<xref ref-type="fig" rid="pcbi-1000074-g004">Figure 4C</xref>), the chain decomposition exactly reconstructs the five haplotypes. By using multiple decompositions we can reconstruct many of the haplotypes correctly (<xref ref-type="supplementary-material" rid="pcbi.1000074.s001">Figure S1</xref>) even in low diversities.</p><p>The performance of the EM algorithm for haplotype frequency estimation described above is measured as the Kullback–Leibler (KL) divergence between the original population <italic>p</italic> and its estimate <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000074.e004" xlink:type="simple"/></inline-formula>. We consider populations with 10 different haplotypes, each with frequency 0.1, at 5% diversity. Haplotype frequencies are estimated from between 500 and 6000 error-free reads (<xref ref-type="fig" rid="pcbi-1000074-g007">Figure 7</xref>). The performance of the EM algorithm is compared to that of a simple heuristic method, which assigns frequencies to the haplotypes in proportion to the number of reads they explain (see <xref ref-type="sec" rid="s4">Methods</xref>). For both methods, the KL divergence <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000074.e005" xlink:type="simple"/></inline-formula> decreases roughly exponentially with the number of reads. However, the EM algorithm significantly outperforms the heuristic for all sizes of the read set and this improvement in prediction accuracy increases with the number of reads.</p><fig id="pcbi-1000074-g007" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1000074.g007</object-id><label>Figure 7</label><caption><title>Haplotype frequency estimation.</title><p>Haplotype frequencies were inferred using both the EM algorithm (circles) and a simple heuristic algorithm (triangles); the resulting distance from the correct frequencies is measured using KL divergence. Error bars give the interquartile range over 50 trials. The populations consisted of 10 haplotypes at equal frequency and 5% diversity. The input to the algorithms was a set of reads simulated from the population and the original 10 haplotypes.</p></caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000074.g007" xlink:type="simple"/></fig><p>In order to test the combined performance of the haplotype reconstruction and frequency estimation, our basic measure of performance is the proportion of the original population that is reconstructed within 10 amino acid differences. This measure, which we call φ<sub>10</sub>, is defined as follows (see also <xref ref-type="sec" rid="s4">Methods</xref>). For each inferred haplotype, we determine the closest original haplotype and sum up the frequencies of all inferred haplotypes that differ from their assigned original haplotypes by at most ten sites. This performance measure indicates how much of the population has been reconstructed reasonably well. It is less sensitive to how well haplotypes and haplotype distributions match (see <xref ref-type="fig" rid="pcbi-1000074-g006">Figures 6</xref> and <xref ref-type="fig" rid="pcbi-1000074-g007">7</xref> for those performance measures).</p><p>For the first simulation of combined performance, we consider error-free reads from populations consisting of between 5 and 100 haplotypes, each with equal frequency, at diversities between 3 and 8%. We simulated 10,000 error-free reads of average length 100 from these populations and ran haplotype reconstruction and frequency estimation. <xref ref-type="fig" rid="pcbi-1000074-g008">Figure 8</xref> shows that performance increases as diversity increases and drops slightly as the number of haplotypes increases. As we saw above, we would expect to be able to reconstruct populations with size approximately 100 using 10,000 reads under the Lander–Waterman model.</p><fig id="pcbi-1000074-g008" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1000074.g008</object-id><label>Figure 8</label><caption><title>Combined population reconstruction procedure.</title><p>The proportion of the population reconstructed within 10 amino acid differences (ϕ<sub>10</sub>, “proportion close”) is shown. Here 10,000 error-free reads were sampled from populations with diversity between 3 and 8% and with between 5 and 100 haplotypes of equal frequency. Haplotypes were reconstructed and then frequencies were estimated.</p></caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000074.g008" xlink:type="simple"/></fig><p>For the second combined test, we tested all three steps: error correction, haplotype reconstruction, and frequency estimation. In order to model the miscorrection of errors, we ran ReadSim <xref ref-type="bibr" rid="pcbi.1000074-Schmid1">[34]</xref> to simulate the actual error process of pyrosequencing and then ran error correction. New, error-free reads were simulated and errors were added through sampling from the distribution of the uncorrected errors in order to reach error rates of exactly 0.1 and 0.2 errors per kb. <xref ref-type="fig" rid="pcbi-1000074-g009">Figure 9</xref> summarizes the results of this analysis for 10 haplotypes at varying diversities. The combined procedure performs very well on error-free reads that are diverse enough. As errors are introduced, performance decreases; however the method still recovers much of the original population. For example, at 0.1 errors per kb, which is the error rate expected with current pyrosequencing technology and our error correction method (see above), as few as 3500 reads are required for approximately recovering 55% of a population of 5% diversity.</p><fig id="pcbi-1000074-g009" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1000074.g009</object-id><label>Figure 9</label><caption><title>Population reconstruction with errors.</title><p>Proportion of population reconstructed within 10 amino acid differences (ϕ<sub>10</sub>, “Proportion close”) using haplotype reconstruction and frequency estimation. The original populations had 10 haplotypes of equal frequency at varying levels of diversity. Error was randomly introduced in the simulated reads to mimic various levels of error correction.</p></caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000074.g009" xlink:type="simple"/></fig><p><xref ref-type="fig" rid="pcbi-1000074-g009">Figure 9</xref> also indicates, for the datasets with error rate 0.2, a small performance loss as the number of reads increases. This phenomenon appears to be related to the fact that more reads give rise to more paths in the graph, thereby increasing the chances that completely consistent haplotypes that contain errors are assigned positive probabilities. In fact, the size of a minimal path cover increases approximately linearly with the number of reads and this increase does not appear to depend much on population diversity (<xref ref-type="supplementary-material" rid="pcbi.1000074.s004">Figure S4</xref>).</p></sec><sec id="s2j"><title>Analysis of HIV samples</title><p>Our second evaluation of population reconstruction is based on ultra-deep sequencing of drug-resistant HIV populations from four infected patients <xref ref-type="bibr" rid="pcbi.1000074-Wang1">[5]</xref>. The four virus populations were analyzed independently using pyrosequencing and clonal Sanger sequencing. <xref ref-type="table" rid="pcbi-1000074-t001">Table 1</xref> shows the resulting statistics on the datasets. The pyrosequencing based approach mirrors very closely the clonal sequencing. To compare the populations inferred from pyrosequencing to the clonal sequences, we use the measure φ<sub>1</sub>, which indicates the percent of the inferred population that matches a clonal sequence within one amino acid difference. This is used instead of φ<sub>10</sub> used before in order to provide a more sensitive performance measure. In all samples, at least 51.8% of the inferred populations were within one amino acid difference of a clonal haplotype. Based on the present data, we cannot decide whether the additional inferred haplotypes went undetected by the Sanger sequencing, or if they are false positives of the reconstruction method.</p><table-wrap id="pcbi-1000074-t001" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1000074.t001</object-id><label>Table 1</label><caption><title>Population reconstruction from four HIV samples.</title></caption><!--===== Grouping alternate versions of objects =====--><alternatives><graphic id="pcbi-1000074-t001-1" mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000074.t001" xlink:type="simple"/><table><colgroup span="1"><col align="left" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/></colgroup><thead><tr><td align="left" colspan="1" rowspan="1"/><td align="left" colspan="4" rowspan="1">Pyrosequencing</td><td align="left" colspan="3" rowspan="1">Haplotype reconstruction</td><td align="left" colspan="3" rowspan="1">Comparison to clonal seq.</td></tr><tr><td align="left" colspan="1" rowspan="1">Sample</td><td align="left" colspan="1" rowspan="1">Reads</td><td align="left" colspan="1" rowspan="1">Irred.</td><td align="left" colspan="1" rowspan="1">ρ<sub>99</sub></td><td align="left" colspan="1" rowspan="1">Gaps/kb</td><td align="left" colspan="1" rowspan="1">Err/kb</td><td align="left" colspan="1" rowspan="1">Min. cov.</td><td align="left" colspan="1" rowspan="1">Diversity</td><td align="left" colspan="1" rowspan="1">Clones</td><td align="left" colspan="1" rowspan="1">Avg. dist.</td><td align="left" colspan="1" rowspan="1">φ<sub>1</sub></td></tr></thead><tbody><tr><td align="left" colspan="1" rowspan="1">V11909</td><td align="left" colspan="1" rowspan="1">5177</td><td align="left" colspan="1" rowspan="1">641</td><td align="left" colspan="1" rowspan="1">2.2</td><td align="left" colspan="1" rowspan="1">3.3</td><td align="left" colspan="1" rowspan="1">1.10</td><td align="left" colspan="1" rowspan="1">22</td><td align="left" colspan="1" rowspan="1">15.8</td><td align="left" colspan="1" rowspan="1">65</td><td align="left" colspan="1" rowspan="1">1.81</td><td align="left" colspan="1" rowspan="1">51.8</td></tr><tr><td align="left" colspan="1" rowspan="1">V54660</td><td align="left" colspan="1" rowspan="1">7777</td><td align="left" colspan="1" rowspan="1">228</td><td align="left" colspan="1" rowspan="1">1.5</td><td align="left" colspan="1" rowspan="1">2.3</td><td align="left" colspan="1" rowspan="1">1.67</td><td align="left" colspan="1" rowspan="1">4</td><td align="left" colspan="1" rowspan="1">1.0</td><td align="left" colspan="1" rowspan="1">32</td><td align="left" colspan="1" rowspan="1">0.34</td><td align="left" colspan="1" rowspan="1">99.6</td></tr><tr><td align="left" colspan="1" rowspan="1">V3852</td><td align="left" colspan="1" rowspan="1">4854</td><td align="left" colspan="1" rowspan="1">227</td><td align="left" colspan="1" rowspan="1">2.4</td><td align="left" colspan="1" rowspan="1">3.4</td><td align="left" colspan="1" rowspan="1">1.33</td><td align="left" colspan="1" rowspan="1">7</td><td align="left" colspan="1" rowspan="1">1.4</td><td align="left" colspan="1" rowspan="1">42</td><td align="left" colspan="1" rowspan="1">0.29</td><td align="left" colspan="1" rowspan="1">100.0</td></tr><tr><td align="left" colspan="1" rowspan="1">V2173</td><td align="left" colspan="1" rowspan="1">6304</td><td align="left" colspan="1" rowspan="1">354</td><td align="left" colspan="1" rowspan="1">1.8</td><td align="left" colspan="1" rowspan="1">2.3</td><td align="left" colspan="1" rowspan="1">1.31</td><td align="left" colspan="1" rowspan="1">4</td><td align="left" colspan="1" rowspan="1">2.3</td><td align="left" colspan="1" rowspan="1">26</td><td align="left" colspan="1" rowspan="1">0.81</td><td align="left" colspan="1" rowspan="1">86.6</td></tr></tbody></table></alternatives><table-wrap-foot><fn id="nt101"><p>The first four columns describe the pyrosequencing data: the number of reads, the number of irredundant reads, the expected frequency (in percent) of the least frequent haplotype we can expect to cover with 99% confidence, and the number of gaps per kb in the aligned data. The next three columns describe the reconstruction algorithm: the number of non gap characters changed in error correction, the size of a minimal explaining set of haplotypes, and the diversity, measured as the expected number of amino acid differences among the estimated population. After error correction, reads were translated into amino acids. The last three columns describe the validation using (translated) clonal sequences: the number of clones sequenced, the average distance between the estimated population, and the closest Sanger haplotype, and φ<sub>1</sub>, the percentage of the estimated population that was close (up to 1 amino acid difference) to a clone.</p></fn></table-wrap-foot></table-wrap><p>We found many additional haplotypes in our analysis of the most complex sample, V11909. <xref ref-type="table" rid="pcbi-1000074-t002">Table 2</xref> shows a comparison between the inferred population for V11909 and the clonal haplotypes. The populations were analyzed at 15 positions in the protease associated with drug resistance, taken from the HIV Drug Resistance Database <xref ref-type="bibr" rid="pcbi.1000074-Rhee2">[35]</xref>. All but four of the 65 clonal haplotypes (6.1%) are matched in the inferred population, and the frequencies in the inferred population are a reasonable match to the frequencies of the mutation patterns in the clonal haplotypes. Using the Lander–Waterman model, we find that the pyrosequencing reads obtained from the HIV samples are enough to reconstruct with 99% probability all haplotypes that occur at a frequency of at least 2.2% (<xref ref-type="table" rid="pcbi-1000074-t001">Tab. 1</xref>). By comparison, the Sanger sequencing approach yielded 65 clonal sequences, 37 of which were mixtures of two or more clones.</p><table-wrap id="pcbi-1000074-t002" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1000074.t002</object-id><label>Table 2</label><caption><title>Clonal Sanger sequencing versus pyrosequencing.</title></caption><!--===== Grouping alternate versions of objects =====--><alternatives><graphic id="pcbi-1000074-t002-2" mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000074.t002" xlink:type="simple"/><table><colgroup span="1"><col align="left" span="1"/><col align="center" span="1"/><col align="center" span="1"/></colgroup><thead><tr><td align="left" colspan="3" rowspan="1">Frequency</td></tr><tr><td align="left" colspan="1" rowspan="1">Sanger</td><td align="left" colspan="1" rowspan="1">Pyro</td><td align="left" colspan="1" rowspan="1">Mutations</td></tr></thead><tbody><tr><td align="left" colspan="1" rowspan="1">52.3</td><td align="left" colspan="1" rowspan="1">19.3</td><td align="left" colspan="1" rowspan="1">M46I, I54V, G73I, I84V, L90M</td></tr><tr><td align="left" colspan="1" rowspan="1">12.3</td><td align="left" colspan="1" rowspan="1">19.0</td><td align="left" colspan="1" rowspan="1">M46I, I54V, G73S, I84V, L90M</td></tr><tr><td align="left" colspan="1" rowspan="1">9.2</td><td align="left" colspan="1" rowspan="1">9.4</td><td align="left" colspan="1" rowspan="1">M46I</td></tr><tr><td align="left" colspan="1" rowspan="1">6.2</td><td align="left" colspan="1" rowspan="1">5.6</td><td align="left" colspan="1" rowspan="1"/></tr><tr><td align="left" colspan="1" rowspan="1">4.6</td><td align="left" colspan="1" rowspan="1">7.1</td><td align="left" colspan="1" rowspan="1">M46I, I54V, G73S, L90M</td></tr><tr><td align="left" colspan="1" rowspan="1">4.6</td><td align="left" colspan="1" rowspan="1">1.9</td><td align="left" colspan="1" rowspan="1">M46I, I54V, G73I, L90M</td></tr><tr><td align="left" colspan="1" rowspan="1">3.1</td><td align="left" colspan="1" rowspan="1">5.8</td><td align="left" colspan="1" rowspan="1">M46I, G73I, I84V, L90M</td></tr><tr><td align="left" colspan="1" rowspan="1">3.1</td><td align="left" colspan="1" rowspan="1">0.0</td><td align="left" colspan="1" rowspan="1">L33F, M46I, I54V, G73S, I84V, L90M</td></tr><tr><td align="left" colspan="1" rowspan="1">1.5</td><td align="left" colspan="1" rowspan="1">1.9</td><td align="left" colspan="1" rowspan="1">M46I, L90M</td></tr><tr><td align="left" colspan="1" rowspan="1">1.5</td><td align="left" colspan="1" rowspan="1">0.0</td><td align="left" colspan="1" rowspan="1">L33F, M46I, I54V, G73I, I84V, L90M</td></tr><tr><td align="left" colspan="1" rowspan="1">1.5</td><td align="left" colspan="1" rowspan="1">0.0</td><td align="left" colspan="1" rowspan="1">M46I, I54V, G73N, I84V, L90M</td></tr><tr><td align="left" colspan="1" rowspan="1">0.0</td><td align="left" colspan="1" rowspan="1">4.9</td><td align="left" colspan="1" rowspan="1">M46I, G73I</td></tr><tr><td align="left" colspan="1" rowspan="1">0.0</td><td align="left" colspan="1" rowspan="1">4.7</td><td align="left" colspan="1" rowspan="1">M46I, I84V</td></tr><tr><td align="left" colspan="1" rowspan="1">0.0</td><td align="left" colspan="1" rowspan="1">4.0</td><td align="left" colspan="1" rowspan="1">M46I, G73S, I84V, L90M</td></tr><tr><td align="left" colspan="1" rowspan="1">0.0</td><td align="left" colspan="1" rowspan="1">3.1</td><td align="left" colspan="1" rowspan="1">M46I, I54V, G73S, V82I, I84V, L90M</td></tr><tr><td align="left" colspan="1" rowspan="1">0.0</td><td align="left" colspan="1" rowspan="1">2.9</td><td align="left" colspan="1" rowspan="1">M46I, I54V, G73I, I84V</td></tr><tr><td align="left" colspan="1" rowspan="1">0.0</td><td align="left" colspan="1" rowspan="1">2.9</td><td align="left" colspan="1" rowspan="1">M46I, I50V, I54V, G73I, I84V, L90M</td></tr><tr><td align="left" colspan="1" rowspan="1">0.0</td><td align="left" colspan="1" rowspan="1">2.0</td><td align="left" colspan="1" rowspan="1">I84V</td></tr><tr><td align="left" colspan="1" rowspan="1">0.0</td><td align="left" colspan="1" rowspan="1">1.4</td><td align="left" colspan="1" rowspan="1">I54V, G73I, I84V, L90M</td></tr><tr><td align="left" colspan="1" rowspan="1">0.0</td><td align="left" colspan="1" rowspan="1">1.2</td><td align="left" colspan="1" rowspan="1">M46I, I50V, I54V, G73S, L90M</td></tr><tr><td align="left" colspan="1" rowspan="1">0.0</td><td align="left" colspan="1" rowspan="1">1.1</td><td align="left" colspan="1" rowspan="1">M46I, I54V</td></tr><tr><td align="left" colspan="1" rowspan="1">0.0</td><td align="left" colspan="1" rowspan="1">1.0</td><td align="left" colspan="1" rowspan="1">M46I, I50V, I84V, L90M</td></tr><tr><td align="left" colspan="1" rowspan="1">0.0</td><td align="left" colspan="1" rowspan="1">0.5</td><td align="left" colspan="1" rowspan="1">M46I, I54V, G73I</td></tr><tr><td align="left" colspan="1" rowspan="1">0.0</td><td align="left" colspan="1" rowspan="1">0.3</td><td align="left" colspan="1" rowspan="1">G73S, I84V, L90M</td></tr></tbody></table></alternatives><table-wrap-foot><fn id="nt102"><p>Displayed are the patterns of resistance mutation for the 65 Sanger sequences and the estimated population for sample V11909. Mutation patterns were restricted to 15 positions in the protease (amino acids 23, 24, 30, 32, 33, 46, 48, 50, 53, 54, 73, 82, 84, 88, and 90) associated with PI resistance.</p></fn></table-wrap-foot></table-wrap></sec></sec><sec id="s3"><title>Discussion</title><p>Pyrosequencing constitutes a promising approach to estimating the genetic diversity of a community. However, sequencing errors and short read lengths impose considerable challenges on inferring the population structure from a set of pyrosequencing reads. We have approached this task by identifying and solving consecutively three computational problems: error correction, assembly of candidate haplotypes, and estimation of haplotype frequencies. Our methods focus on the situation where a reference genome is available for the alignment of reads. This is the case, for example, for many important pathogens, such as bacterial and viral populations.</p><p>The procedure consists of three steps. First, error correction is performed locally. We take windows of fixed width over the aligned reads and cluster reads within the windows in order to resolve the local haplotype structure. This approach is based on previous methods <xref ref-type="bibr" rid="pcbi.1000074-Kececioglu1">[27]</xref>,<xref ref-type="bibr" rid="pcbi.1000074-Tammi1">[28]</xref> that are specifically tailored to pyrosequencing reads. Next, haplotypes are reconstructed using a new application of a classic combinatorial algorithm. This step is the main theoretical advance in this paper. Finally, haplotype frequencies are inferred as the ML estimates of a statistical model that mimics the pyrosequencing process. We have developed an EM algorithm for solving this ML problem.</p><p>Haplotype reconstruction is based on two assumptions: consistency and parsimony. We require that each haplotype be constructible from a sequence of overlapping reads and that the set of explaining haplotypes be as small as possible. The Lander–Waterman model of sequencing implies lower bounds on the number of reads necessary to meet the first requirement. The fundamental object for haplotype reconstruction is the read graph. A minimal set of explaining haplotypes corresponds to a minimal path cover in the read graph, and this path cover can be found efficiently using combinatorial optimization. Moreover, the cardinality of the minimal path cover is an important invariant of the haplotype reconstruction problem related to the genetic diversity of the population.</p><p>We believe that these methods are also applicable to many metagenomic projects. In such projects, estimation of the diversity of a population is a fundamental question. The size of a minimal cover of a fragment assembly graph provides an intuitive and computable measure of this diversity.</p><p>We have validated our methods by extensive simulations of the pyrosequencing process, as well as by comparing haplotypes inferred from pyrosequencing data to sequences obtained from direct clonal sequencing of the same samples. Our results show that pyrosequencing is an effective technology for quantitatively assessing the diversity of a population of RNA viruses, such as HIV.</p><p>Resistance to most antiretroviral drugs is caused by specific mutational patterns comprising several mutations, rather than one single mutation. Thus, an important question that can be addressed efficiently by pyrosequencing is which of the resistance mutations actually occur on the same haplotype in the population. Since our methods avoid costly clonal sequencing of the HIV populations for determining the co-occurrence of HIV resistance mutations <xref ref-type="bibr" rid="pcbi.1000074-Gonzales1">[36]</xref>, pyrosequencing may become an attractive alternative to the traditional clonal Sanger sequencing.</p><p>The sample size of approximately 10,000 reads we have considered provides us with the opportunity of detecting variants present in only 1% of the population. Pyrosequencing can produce 200,000 reads and thus twenty populations could be sequenced to a good resolution using a process less labor intensive than a limiting dilution clonal sequencing to a similar resolution of a single population.</p><p>The simulations suggest that the method works best with populations that are suitably diverse. Intuitively, the information linking two reads together on the same haplotype decays rapidly in sections of the genome where there are few identifying features of that haplotype (as in a region of low diversity). In particular, repeats of sufficient length in the reference genome can completely destroy linkage information. However, at some point the benefits of increased diversity will be partially reduced by the increased difficulty of the alignment problem. With more diverse populations or true indels, alignment to single reference genome will become less accurate.</p><p>The HIV <italic>pol</italic> gene analyzed here is on the low end of the diversity spectrum. The <italic>env</italic> gene with its higher variability may be a better target for some applications. We expect the proposed methods to improve early detection of emerging drug resistant variants <xref ref-type="bibr" rid="pcbi.1000074-Doukhan1">[37]</xref>,<xref ref-type="bibr" rid="pcbi.1000074-Metzner1">[38]</xref>, and to support the genetic and epidemiological study of acute infections, in particular the detection of dual infections <xref ref-type="bibr" rid="pcbi.1000074-Gottlieb1">[39]</xref>.</p><p>Since our computational procedure produces an estimate of the entire virus population, it allows the study of fundamental questions about the evolution of viral populations in general <xref ref-type="bibr" rid="pcbi.1000074-Rambaut1">[40]</xref>. For example, mathematical models of virus evolution can be tested directly within the accuracy of estimated viral haplotype frequencies <xref ref-type="bibr" rid="pcbi.1000074-Rouzine1">[41]</xref>. Predicting viral evolution is considered an important step in HIV vaccine development <xref ref-type="bibr" rid="pcbi.1000074-Gaschen1">[10]</xref>.</p><p>In addition to the promising biological applications, there are many interesting theoretical questions about reconstructing populations from pyrosequencing data. The errors in pyrosequencing reads tend to be highly correlated, as they occur predominately in homopolymeric regions. While this can make correction more difficult (a fact which can be counteracted by the use of quality scores), we believe that it can make haplotype reconstruction more accurate than if the errors were uniform. If errors are isolated to a few sites in the genome, fewer additional explaining haplotypes are needed than if the errors were distributed throughout. The exact relationship between the error process of pyrosequencing, error correction, and haplotype reconstruction is worthy of further study.</p><p>As pyrosequencing datasets can contain 200,000 reads, it is worthwhile to investigate how our methods scale to such large datasets. Haplotype reconstruction is the only step that is not immediately practical on such a large number of reads, since it is at worst cubic in the number of irredundant reads. However, problems of this size are approachable with our methods as follows.</p><p>The theoretical resolution of the algorithms depends on two factors: first, the ability to differentiate between errors and rare variants; and second, whether there are enough reads so that we can assemble all haplotypes. We have seen that the number of reads necessary for assembly scales with the inverse of the desired resolution: if <italic>N</italic> reads cover all haplotypes of frequency at least ρ, then <italic>kN</italic> reads are needed to cover all haplotypes of frequency at least ρ<italic>k</italic>. However, the resolution of error correction is at most the overall error rate as the number of reads grows; see <xref ref-type="table" rid="pcbi-1000074-t003">Table 3</xref>.</p><table-wrap id="pcbi-1000074-t003" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1000074.t003</object-id><label>Table 3</label><caption><title>Resolution of viral haplotype estimation.</title></caption><!--===== Grouping alternate versions of objects =====--><alternatives><graphic id="pcbi-1000074-t003-3" mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000074.t003" xlink:type="simple"/><table><colgroup span="1"><col align="left" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/></colgroup><thead><tr><td align="left" colspan="1" rowspan="1">Number of reads</td><td align="left" colspan="1" rowspan="1">1,000</td><td align="left" colspan="1" rowspan="1">5,000</td><td align="left" colspan="1" rowspan="1">10,000</td><td align="left" colspan="1" rowspan="1">50,000</td><td align="left" colspan="1" rowspan="1">100,000</td><td align="left" colspan="1" rowspan="1">200,000</td></tr></thead><tbody><tr><td align="left" colspan="1" rowspan="1"><bold>Error resolution (%)</bold></td><td align="left" colspan="1" rowspan="1">3.00</td><td align="left" colspan="1" rowspan="1">1.20</td><td align="left" colspan="1" rowspan="1">0.90</td><td align="left" colspan="1" rowspan="1"><underline>0.50</underline></td><td align="left" colspan="1" rowspan="1"><underline>0.42</underline></td><td align="left" colspan="1" rowspan="1"><underline>0.37</underline></td></tr><tr><td align="left" colspan="1" rowspan="1"><bold>Reconstruction resolution (%)</bold></td><td align="left" colspan="1" rowspan="1"><underline>11.50</underline></td><td align="left" colspan="1" rowspan="1"><underline>2.30</underline></td><td align="left" colspan="1" rowspan="1"><underline>1.20</underline></td><td align="left" colspan="1" rowspan="1">0.23</td><td align="left" colspan="1" rowspan="1">0.12</td><td align="left" colspan="1" rowspan="1">0.06</td></tr></tbody></table></alternatives><table-wrap-foot><fn id="nt103"><p>Displayed are the resolution of error correction (binomial test only) and of haplotype reconstruction as a function of the number of reads. The resolution of the error correction is defined as the smallest frequency of a mutation that will be visible over the background error rates; it is calculated with error rate ε = 0.0025 and significance level α = 0.001. The resolution of the haplotype reconstruction (derived from the Lander–Waterman model) is the smallest haplotype frequency expected to be entirely covered by reads. For small read sizes, haplotype reconstruction is the limiting factor (underlined in the table) but for over approximately 35,000 reads, error correction is the limiting factor.</p></fn></table-wrap-foot></table-wrap><p>The limited resolution of error correction combined with the elimination of redundant reads makes haplotype reconstruction feasible for large datasets. For example, error correction on 200,000 reads with ε = 0.0025 and α = 0.001 will erase all variants with frequency below 0.365 (<xref ref-type="table" rid="pcbi-1000074-t003">Table 3</xref>; <xref ref-type="sec" rid="s4">Methods</xref>). In order to have enough information to reconstruct these variants under the Lander–Waterman model, we would expect to need only about 30,000 reads. Furthermore, in regions of low diversity, many of the reads will be redundant and are thus discarded before building the graph. For example, with 30,000 error-free reads simulated from 275≈1/0.00365 haplotypes at 5% diversity, typically about 13,000 reads are irredundant. This number of irredundant reads is near the limits of our current implementation.</p><p>Current and future improvements to pyrosequencing technology will lead to longer reads (250 bp), more reads, and lower errors. However, in order for huge numbers of reads to be of great help in the ultra-deep sequencing of a population, the error rates must also decrease. The performance of our methods as read length varies is an important question, given the availability of sequencing technologies with different read lengths (e.g., Solexa sequencing with 30 to 50 bp reads) and the desire to assemble haplotypes of greater size (e.g., the entire 10 kb HIV genome).</p><p>Notice that haplotype reconstruction seems to be quite good locally (<xref ref-type="fig" rid="pcbi-1000074-g004">Figure 4</xref> and <xref ref-type="supplementary-material" rid="pcbi.1000074.s001">Figure S1</xref>) in that many reconstructed haplotypes contain large contiguous regions where they agree with a real haplotype. However, the measures of performance considered in this paper all deal with the entire haplotype and ignore partial results of this type. This would seem to imply that longer reads will improve the reconstruction performance on a fixed length genome; new performance measures will have to be developed to analyze these problems.</p></sec><sec id="s4"><title>Methods</title><sec id="s4a"><title>Statistical tests for error correction</title><p>We use two statistical tests for locally detecting distinct haplotypes. The first test analyzes each column of the multiple alignment window. We write <italic>d</italic> for the number of reads that overlap this window. We ask if the observed number of mutations (deviations from the consensus base) exceeds our expectation under the null hypothesis of one haplotype and a uniform sequencing error ε. The probability of observing <italic>x</italic> or more mutations is given by the binomial distribution<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000074.e006" xlink:type="simple"/></disp-formula>There are two parameters to set here: the error rate ε and the p-value α that is required for significance.</p><p>Next, we test pairs of mutations in two different alignment columns <italic>u</italic> and <italic>v</italic> using Fisher's exact test. The test statistic is the number <italic>C</italic> of co-occurrences, which under the null hypothesis of one haplotype follows the hypergeometric distribution<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000074.e007" xlink:type="simple"/></disp-formula>where <italic>n<sub>u</sub></italic> and <italic>n<sub>v</sub></italic> are the number of times the specific mutations have been observed in columns <italic>u</italic> and <italic>v</italic>, respectively <xref ref-type="bibr" rid="pcbi.1000074-Tammi1">[28]</xref>. Considering pairs provides more power if co-occurrences are observed on reads, but can not detect single mutation differences. We set the p-value for this test to be he same as for the binomial test.</p><p>The procedure tests all columns in the window using the binomial test and then all pairs of columns using Fisher's exact test. This can lead to over-counting of the number of haplotypes as follows. Suppose that in columns 1 and 2 the consensus base is A, but that there is a mutation C in some of the reads in each column. If both mutations are significant by themselves, this is evidence of three haplotypes in the window. If they are also significant together, this would be evidence of four haplotypes. However, there could be only two true haplotypes at these two positions: AA and CC. To correct for this, we subtract two from the count whenever two significant mutations are significant together and always occur on exactly the same set of reads.</p><p>We do not explicitly address the multiple comparisons problem associated with this testing procedure here and regard the significance levels of the tests as parameters of Algorithm 1. We account for the quality scores associated with each base by using (rounded) weighted counts in the test statistics. Gaps are treated as unknown bases and represented by a special character with quality score zero. We found that an error rate of 0.0025, a p-value of 0.001, and a window size of 24 provided the best error correction. These parameters can be tuned as follows. First, the window size should be chosen to best help the clustering. A large window provides more power since there are more identifying mutations, but also can be more difficult to cluster since many reads will only partially overlap the window.</p><p>Next, the p-value for the tests and the error rate should be adjusted to prevent false positives and negatives. The number of mutations required in a column before the mutation is considered significant can be calculated from the binomial distribution above. For example, with 10,000 reads of length 100 in a genome of length 1000, there will be approximately <italic>d</italic> = 1000 reads overlapping a small window. Setting ε = 0.0025 and α = 0.001, a mutation would have to occur nine times in a column to be significant according to the binomial distribution above. Thus, roughly speaking, the error correction would discard any mutations occurring in less than 9/1000≈1% of the population. Notice that this is quite similar to the estimate under the Lander–Waterman model (Equation 1), where 11,508 reads are needed to cover all haplotypes at 1% frequency.</p><p>Notice that the power of the error correction grows very slowly (<xref ref-type="table" rid="pcbi-1000074-t003">Table 3</xref>). On a dataset with 200,000 reads, then error correction would eliminate any variants present in less than 0.365% of the population. However, only 30,000 reads are needed to achieve this resolution with haplotype reconstruction.</p></sec><sec id="s4b"><title>Proof of Dilworth's Theorem</title><p>Suppose the read graph <bold>G<sub>R</sub></bold> has <italic>V</italic> vertices and <italic>E</italic> edges. Since</p><p><bold>G<sub>R</sub></bold> is acyclic, it defines a partial order on the set of irredundant reads, <bold>R</bold><sub>irred</sub>. Part (1) is then a direct application of Dilworth's theorem <xref ref-type="bibr" rid="pcbi.1000074-Dilworth1">[30]</xref> to this partially ordered set. The associated bipartite graph has vertex set {<bold>A</bold>, <bold>B</bold>}, where both <bold>A</bold> and <bold>B</bold> are equal to <bold>R</bold><sub>irred</sub>. There is an edge between <italic>r</italic> ∈ <bold>A</bold> and <italic>s</italic> ∈ <bold>B</bold>, if there is a path from <italic>r</italic> to <italic>s</italic> in <bold>G<sub>R</sub></bold>. Then a maximal matching in the bipartite graph is equivalent to a minimal chain decomposition of <bold>G<sub>R</sub></bold> <xref ref-type="bibr" rid="pcbi.1000074-Ford1">[42]</xref>.</p><p>For the time complexity, notice that building the read graph <bold>G<sub>R</sub></bold> is of complexity <italic>O</italic>(<italic>V</italic><sup>2</sup>). Building the associated bipartite graph is equivalent to finding the transitive closure of the read graph and thus is <italic>O</italic>(<italic>VE</italic>). The efficient matching algorithm for the solution of the matching problem is due to Hopcroft and Karp <xref ref-type="bibr" rid="pcbi.1000074-Hopcroft1">[43]</xref>. For a general bipartite graph with <italic>V</italic>′ vertices and <italic>E</italic>′ edges, the Hopcroft-Karp algorithm is of time complexity <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000074.e008" xlink:type="simple"/></inline-formula>. Since in our construction, <italic>V</italic>′ = 2<italic>V</italic> and <italic>E</italic>′ = <italic>O</italic>(<italic>V</italic><sup>2</sup>), the matching algorithm takes time <italic>O</italic>(<italic>V</italic><sup>5/2</sup>). Depending on the structure of the graph, either the transitive closure or matching problems can dominate, but both are of complexity <italic>O</italic>(<italic>V</italic><sup>3</sup>).</p></sec><sec id="s4c"><title>EM algorithm for haplotype frequency estimation</title><p>We use an EM algorithm <xref ref-type="bibr" rid="pcbi.1000074-Dempster1">[44]</xref> to estimate the maximum likelihood haplotype frequencies. We iteratively estimate the missing data <italic>u<sub>rh</sub></italic>, i.e., the number of times read <italic>r</italic> originated from haplotype <italic>h</italic>, and solve the easier optimization problem of maximizing the log-likelihood of the hidden model<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000074.e009" xlink:type="simple"/></disp-formula>In the E step, the expected values of the missing data are computed as<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000074.e010" xlink:type="simple"/></disp-formula>In the M step, maximization of ℓ<sub>hid</sub> yields<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000074.e011" xlink:type="simple"/></disp-formula></p></sec><sec id="s4d"><title>Simulations</title><p>Our starting point is the first 1 kb of the wild type sequence of the HIV <italic>pol</italic> gene, encoding the 99 amino acids of the protease and the beginning of the reverse transcriptase. Random mutations are introduced into this strain in order to generate genetic diversity. We generated various populations in this way with diversities between 20 and 80 base pairs (2 to 8%). All haplotypes were set to have the same frequency in the population.</p><p>We report the expected value of the Hamming distance between two haplotypes drawn from a population as our basic measure of the diversity of a population. This statistic, which we call simply “diversity” can be thought of as a version of the Simpson measure <xref ref-type="bibr" rid="pcbi.1000074-Simpson1">[45]</xref> that takes into account the genetic structure.</p><p>We use ReadSim <xref ref-type="bibr" rid="pcbi.1000074-Schmid1">[34]</xref> (available from <ext-link ext-link-type="uri" xlink:href="http://www-ab.informatik.uni-tuebingen.de/software/readsim/" xlink:type="simple">http://www-ab.informatik.uni-tuebingen.de/software/readsim/</ext-link>) to simulate the error process of pyrosequencing. We generate reads by running ReadSim with the options “–meanlog 0.15 –sigmalog 0.08 –filter” (aside from these options, we use the default parameters). This process results in about 7 insertions and 3 deletions per kb. Since pyrosequencing produces light coverage on the tails of the input genomes, we simulate by padding the region of concern with 100 nucleotides on each end and discard reads from the tails. The error correction (Algorithm 1) is run with window size of 24, p-value of 0.001, and error rate ε = 0.0025. We recorded the frequencies of errors at each position in the genome during simulations of populations of size 10 at 5% diversity. Sampling from these frequencies allowed us to create reads with precise error rates for <xref ref-type="fig" rid="pcbi-1000074-g009">Figure 9</xref>.</p><p>For the simulations of haplotype reconstruction, we generate pyrosequencing reads using the model described above and illustrated in <xref ref-type="fig" rid="pcbi-1000074-g005">Figure 5</xref> complemented by uniform sequencing errors at rate 0, 0.1, and 0.2 per kb. We build the read graph and apply Algorithm 2 repeatedly until 200 candidate haplotypes are found. The EM algorithm was run with 10 random starting points. To speed up the EM algorithm, we round all frequencies <italic>p<sub>h</sub></italic> &lt; 10<sup>−6</sup> to zero.</p><p>We also test a simple alternative to the EM algorithm as follows. For each haplotype <italic>h</italic> ∈ <bold>H</bold>, let <italic>c<sub>h</sub></italic> count how many reads haplotype <italic>h</italic> is consistent with and set <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000074.e012" xlink:type="simple"/></inline-formula>. This estimatewill be correct under the given model if each read is consistent with exactly one haplotype. For evaluating the performance of the various steps of our reconstruction method, we use several basic measures of performance. To measure the distance between two sets of haplotypes (one original and one inferred), we calculate how many of the original haplotypes are found among the inferred haplotypes as well as the average of the distances between each inferred haplotype and its closest original haplotype (<xref ref-type="fig" rid="pcbi-1000074-g006">Figure 6</xref>). Distance is measured as Hamming distance on the amino acid level. To compare two populations with different frequencies but the same haplotypes, we use the Kullback–Leibler (KL) divergence <italic>D</italic><sub>KL</sub> (<italic>p</italic>∥<italic>q</italic>) = Σ<italic><sub>h</sub></italic><sub>∈<bold>H</bold></sub> <italic>p<sub>h</sub></italic> log(<italic>p<sub>h</sub></italic>/<italic>q<sub>h</sub></italic>), where <italic>p</italic> and <italic>q</italic> are the two discrete (haplotype) distributions with the same support <bold>H</bold> (<xref ref-type="fig" rid="pcbi-1000074-g007">Figure 7</xref>). To measure the performance of the entire process, we measure how much of the inferred population is close to the original population. Specifically, we calculate the percentage of the inferred population that is within a specified distance from one of the original haplotypes (<xref ref-type="fig" rid="pcbi-1000074-g009">Figure 9</xref>). We refer to this statistic as <italic>φ<sub>n</sub></italic>, where <italic>n</italic> is the number of amino acid differences we allow.</p></sec><sec id="s4e"><title>HIV sequence data</title><p>Virus populations derived from four treatment-experienced patients between 2000 and 2005 were sequenced using both pyrosequencing and limiting dilution Sanger sequencing. The plasma HIV-1 RNA levels in the four plasma samples were each greater than 100,000 copies/ml as determined using the VERSANT HIV-1 RNA assay <xref ref-type="bibr" rid="pcbi.1000074-Collins1">[46]</xref>. Each sequence encompassed all 99 HIV-1 protease codons and the first 241 reverse transcriptase codons. The same genomic region of the same four samples was analyzed using limiting dilution and direct Sanger sequencing of the clones. Sample preparation and pyrosequencing and Sanger sequencing techniques are explained in detail in <xref ref-type="bibr" rid="pcbi.1000074-Wang1">[5]</xref>.</p><p>Briefly, ultra-deep pyrosequencing was performed on four RT-PCR products from RNA extracted from cryopreserved plasma samples. The median number of cDNA copies prior to sequencing was 100 with an interquartile range of 75 to 180. The resulting datasets consisted of between 4854 and 7777 reads of average length 105 bp. Reads were error corrected (Algorithm 1) and translated to amino acids. For haplotype reconstruction, Algorithm 2 was run repeatedly until all or at most 10,000 candidate haplotypes were found. The samples were translated into amino acids after the error correction step; thus, the haplotype reconstruction and frequency estimation algorithms are done on the amino acid level.</p><p>For the sample with the greatest diversity (V11909), the unamplified cDNA product was serially diluted prior to PCR amplification. Bidirectional sequencing was performed directly on 37 amplicons derived from the 1/30 cDNA dilutions and 31 amplicons derived from the 1/100 cDNA dilutions. Three sequences were discarded because of incomplete coverage. For the other three samples, we used the Sanger method to sequence a total of 32, 42, and 26 plasmid subclones per sample. Some of the sequences obtained from limiting dilutions contained mixtures of several clones. In this case, in order to measure the Hamming distance between an inferred haplotype and a clonal haplotype with ambiguous bases, we used the minimum distance over all possible translations of the ambiguous haplotype.</p></sec></sec><sec id="s5"><title>Supporting Information</title><supplementary-material id="pcbi.1000074.s001" mimetype="application/postscript" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000074.s001" xlink:type="simple"><label>Figure S1</label><caption><p><bold>Chain decompositions.</bold></p><p>Displayed are two different chain decompositions of the read graph for 1000 reads from a population of 5 haplotypes at 3% diversity. The bottom five lines correspond to reads matching a haplotype uniquely; the top to reads matching several haplotypes. One decomposition gets one haplotype entirely correct (top, black); the other gets two different haplotypes essentially correct (bottom, green and yellow). In this way, taking multiple chain decompositions allows us to reconstruct all haplotypes.</p><p>(0.84 MB EPS)</p></caption></supplementary-material><supplementary-material id="pcbi.1000074.s002" mimetype="application/postscript" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000074.s002" xlink:type="simple"><label>Figure S2</label><caption><p><bold>Haplotype reconstruction.</bold></p><p>Up to 1000 candidate haplotypes were generated using Algorithm 2 from 10,000 error free reads drawn from populations of size 10, 20, and 50 (subfigures (A), (B), and (C), respectively) at varying diversity levels. Displayed is a measure of the efficiency of haplotype reconstruction: the average Hamming distance (in amino acids) between an original haplotype and its closest match among the reconstructed haplotypes.</p><p>(0.01 MB EPS)</p></caption></supplementary-material><supplementary-material id="pcbi.1000074.s003" mimetype="application/postscript" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000074.s003" xlink:type="simple"><label>Figure S3</label><caption><p><bold>Error correction.</bold></p><p>Shown is the resulting error after error correction on populations with 4% diversity. Populations with up to 50 haplotypes of equal frequency were created. The program ReadSim was used to simulate pyrosequencing with an error rate of 3 to 6 errors per kb (after alignment). Error correction successfully reduced the error rate by a factor of approximately 30.</p><p>(0.02 MB EPS)</p></caption></supplementary-material><supplementary-material id="pcbi.1000074.s004" mimetype="application/postscript" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000074.s004" xlink:type="simple"><label>Figure S4</label><caption><p><bold>Size of the read graph cover.</bold></p><p>Displayed is the computed lower bound on the population size from simulations with varying error rates and numbers of reads. Population diversity ranged from 3 to 7%. The lower bound is computed as the minimal size of a cover of the read graph. Error bars give interquartile ranges over 100 trials at different diversity levels. This estimated lower bound is quite accurate for error free reads; it seems to increase linearly with the number of reads if errors are introduced.</p><p>(0.02 MB EPS)</p></caption></supplementary-material></sec></body><back><ref-list><title>References</title><ref id="pcbi.1000074-FakhraiRad1"><label>1</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Fakhrai-Rad</surname><given-names>H</given-names></name><name name-style="western"><surname>Pourmand</surname><given-names>N</given-names></name><name name-style="western"><surname>Ronaghi</surname><given-names>M</given-names></name></person-group>             <year>2002</year>             <article-title>Pyrosequencing: An accurate detection platform for single nucleotide polymorphisms.</article-title>             <source>Hum Mutat</source>             <volume>19</volume>             <fpage>479</fpage>             <lpage>485</lpage>          </element-citation></ref><ref id="pcbi.1000074-Margulies1"><label>2</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Margulies</surname><given-names>M</given-names></name><name name-style="western"><surname>Egholm</surname><given-names>M</given-names></name><name name-style="western"><surname>Altman</surname><given-names>WE</given-names></name><name name-style="western"><surname>Attiya</surname><given-names>S</given-names></name><name name-style="western"><surname>Bader</surname><given-names>JS</given-names></name><etal/></person-group>             <year>2005</year>             <article-title>Genome sequencing in microfabricated high-density picolitre reactors.</article-title>             <source>Nature</source>             <volume>437</volume>             <fpage>376</fpage>             <lpage>380</lpage>          </element-citation></ref><ref id="pcbi.1000074-Malet1"><label>3</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Malet</surname><given-names>I</given-names></name><name name-style="western"><surname>Belnard</surname><given-names>M</given-names></name><name name-style="western"><surname>Agut</surname><given-names>H</given-names></name><name name-style="western"><surname>Cahour</surname><given-names>A</given-names></name></person-group>             <year>2003</year>             <article-title>From RNA to quasispecies: A DNA polymerase with proofreading activity is highly recommended for accurate assessment of viral diversity.</article-title>             <source>J Virol Methods</source>             <volume>109</volume>             <fpage>161</fpage>             <lpage>170</lpage>          </element-citation></ref><ref id="pcbi.1000074-Huse1"><label>4</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Huse</surname><given-names>S</given-names></name><name name-style="western"><surname>Huber</surname><given-names>J</given-names></name><name name-style="western"><surname>Morrison</surname><given-names>H</given-names></name><name name-style="western"><surname>Sogin</surname><given-names>M</given-names></name><name name-style="western"><surname>Welch</surname><given-names>D</given-names></name></person-group>             <year>2007</year>             <article-title>Accuracy and quality of massively parallel DNA pyrosequencing.</article-title>             <source>Genome Biol</source>             <volume>8</volume>             <fpage>R143</fpage>          </element-citation></ref><ref id="pcbi.1000074-Wang1"><label>5</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Wang</surname><given-names>C</given-names></name><name name-style="western"><surname>Mitsuya</surname><given-names>Y</given-names></name><name name-style="western"><surname>Gharizadeh</surname><given-names>B</given-names></name><name name-style="western"><surname>Ronaghi</surname><given-names>M</given-names></name><name name-style="western"><surname>Shafer</surname><given-names>RW</given-names></name></person-group>             <year>2007</year>             <article-title>Characterization of mutation spectra with ultra-deep pyrosequencing: application to HIV-1 drug resistance.</article-title>             <source>Genome Res</source>             <volume>17</volume>             <fpage>1195</fpage>             <lpage>1201</lpage>          </element-citation></ref><ref id="pcbi.1000074-Eigen1"><label>6</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Eigen</surname><given-names>M</given-names></name><name name-style="western"><surname>McCaskill</surname><given-names>J</given-names></name><name name-style="western"><surname>Schuster</surname><given-names>P</given-names></name></person-group>             <year>1989</year>             <article-title>The molecular quasi-species.</article-title>             <source>Adv Chem Phys</source>             <volume>75</volume>             <fpage>149</fpage>             <lpage>263</lpage>          </element-citation></ref><ref id="pcbi.1000074-Domingo1"><label>7</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Domingo</surname><given-names>E</given-names></name><name name-style="western"><surname>Holland</surname><given-names>JJ</given-names></name></person-group>             <year>1997</year>             <article-title>RNA virus mutations and fitness for survival.</article-title>             <source>Annu Rev Microbiol</source>             <volume>51</volume>             <fpage>151</fpage>             <lpage>178</lpage>          </element-citation></ref><ref id="pcbi.1000074-Nowak1"><label>8</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Nowak</surname><given-names>MA</given-names></name><name name-style="western"><surname>Anderson</surname><given-names>RM</given-names></name><name name-style="western"><surname>McLean</surname><given-names>AR</given-names></name><name name-style="western"><surname>Wolfs</surname><given-names>TF</given-names></name><name name-style="western"><surname>Goudsmit</surname><given-names>J</given-names></name><etal/></person-group>             <year>1991</year>             <article-title>Antigenic diversity thresholds and the development of AIDS.</article-title>             <source>Science</source>             <volume>254</volume>             <fpage>963</fpage>             <lpage>969</lpage>          </element-citation></ref><ref id="pcbi.1000074-Shankarappa1"><label>9</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Shankarappa</surname><given-names>R</given-names></name><name name-style="western"><surname>Margolick</surname><given-names>JB</given-names></name><name name-style="western"><surname>Gange</surname><given-names>SJ</given-names></name><name name-style="western"><surname>Rodrigo</surname><given-names>AG</given-names></name><name name-style="western"><surname>Upchurch</surname><given-names>D</given-names></name><etal/></person-group>             <year>1999</year>             <article-title>Consistent viral evolutionary changes associated with the progression of human immunodeficiency virus type 1 infection.</article-title>             <source>J Virol</source>             <volume>73</volume>             <fpage>10489</fpage>             <lpage>10502</lpage>          </element-citation></ref><ref id="pcbi.1000074-Gaschen1"><label>10</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Gaschen</surname><given-names>B</given-names></name><name name-style="western"><surname>Taylor</surname><given-names>J</given-names></name><name name-style="western"><surname>Yusim</surname><given-names>K</given-names></name><name name-style="western"><surname>Foley</surname><given-names>B</given-names></name><name name-style="western"><surname>Gao</surname><given-names>F</given-names></name><etal/></person-group>             <year>2002</year>             <article-title>Diversity considerations in HIV-1 vaccine selection.</article-title>             <source>Science</source>             <volume>296</volume>             <fpage>2354</fpage>             <lpage>2360</lpage>          </element-citation></ref><ref id="pcbi.1000074-Douek1"><label>11</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Douek</surname><given-names>DC</given-names></name><name name-style="western"><surname>Kwong</surname><given-names>PD</given-names></name><name name-style="western"><surname>Nabel</surname><given-names>GJ</given-names></name></person-group>             <year>2006</year>             <article-title>The rational design of an AIDS vaccine.</article-title>             <source>Cell</source>             <volume>124</volume>             <fpage>677</fpage>             <lpage>681</lpage>          </element-citation></ref><ref id="pcbi.1000074-Beerenwinkel1"><label>12</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Beerenwinkel</surname><given-names>N</given-names></name><name name-style="western"><surname>Sing</surname><given-names>T</given-names></name><name name-style="western"><surname>Lengauer</surname><given-names>T</given-names></name><name name-style="western"><surname>Rahnenfuehrer</surname><given-names>J</given-names></name><name name-style="western"><surname>Roomp</surname><given-names>K</given-names></name><etal/></person-group>             <year>2005</year>             <article-title>Computational methods for the design of effective therapies against drug resistant HIV strains.</article-title>             <source>Bioinformatics</source>             <volume>21</volume>             <fpage>3943</fpage>             <lpage>3950</lpage>          </element-citation></ref><ref id="pcbi.1000074-Rhee1"><label>13</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Rhee</surname><given-names>S-Y</given-names></name><name name-style="western"><surname>Liu</surname><given-names>TF</given-names></name><name name-style="western"><surname>Holmes</surname><given-names>SP</given-names></name><name name-style="western"><surname>Shafer</surname><given-names>RW</given-names></name></person-group>             <year>2007</year>             <article-title>HIV-1 Subtype B Protease and Reverse Transcriptase Amino Acid Covariation.</article-title>             <source>PLoS Comput Biol</source>             <volume>3</volume>             <fpage>e87</fpage>             <comment>doi:10.1371/journal.pcbi.0030087</comment>          </element-citation></ref><ref id="pcbi.1000074-OMeara1"><label>14</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>O'Meara</surname><given-names>D</given-names></name><name name-style="western"><surname>Wilbe</surname><given-names>K</given-names></name><name name-style="western"><surname>Leitner</surname><given-names>T</given-names></name><name name-style="western"><surname>Hejdeman</surname><given-names>B</given-names></name><name name-style="western"><surname>Albert</surname><given-names>J</given-names></name><etal/></person-group>             <year>2001</year>             <article-title>Monitoring resistance to human immunodeficiency virus type 1 protease inhibitors by pyrosequencing.</article-title>             <source>J Clin Microbiol</source>             <volume>39</volume>             <fpage>464</fpage>             <lpage>473</lpage>          </element-citation></ref><ref id="pcbi.1000074-Simons1"><label>15</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Simons</surname><given-names>JF</given-names></name><name name-style="western"><surname>Egholm</surname><given-names>M</given-names></name><name name-style="western"><surname>Lanza</surname><given-names>J</given-names></name><name name-style="western"><surname>Desany</surname><given-names>B</given-names></name><name name-style="western"><surname>Turenchalk</surname><given-names>G</given-names></name><etal/></person-group>             <year>2005</year>             <article-title>Ultra-deep sequencing of HIV from drug resistant patients.</article-title>             <source>Antivir Ther</source>             <volume>10</volume>             <fpage>S157</fpage>          </element-citation></ref><ref id="pcbi.1000074-Tsibris1"><label>16</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Tsibris</surname><given-names>AMN</given-names></name><name name-style="western"><surname>Russ</surname><given-names>C</given-names></name><name name-style="western"><surname>Lee</surname><given-names>W</given-names></name><name name-style="western"><surname>Paredes</surname><given-names>R</given-names></name><name name-style="western"><surname>Arnaout</surname><given-names>R</given-names></name><etal/></person-group>             <year>2006</year>             <article-title>Detection and quantification of minority HIV-1 env V3 loop sequences by ultra-deep sequencing: Preliminary results.</article-title>             <source>Antivir Ther</source>             <volume>11</volume>             <fpage>S74</fpage>          </element-citation></ref><ref id="pcbi.1000074-Roche1"><label>17</label><element-citation publication-type="other" xlink:type="simple">             <collab xlink:type="simple">Roche Applied Sciences</collab>             <year>2006</year>             <source>GS20 Data Processing Software Manual</source>             <publisher-loc>Penzberg (Germany)</publisher-loc>             <publisher-name>Roche Diagnostics GmbH</publisher-name>          </element-citation></ref><ref id="pcbi.1000074-Bacheler1"><label>18</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Bacheler</surname><given-names>L</given-names></name><name name-style="western"><surname>Jeffrey</surname><given-names>S</given-names></name><name name-style="western"><surname>Hanna</surname><given-names>G</given-names></name><name name-style="western"><surname>D'Aquila</surname><given-names>R</given-names></name><name name-style="western"><surname>Wallace</surname><given-names>L</given-names></name><etal/></person-group>             <year>2001</year>             <article-title>Genotypic correlates of phenotypic resistance to efavirenz in virus isolates from patients failing nonnucleoside reverse transcriptase inhibitor therapy.</article-title>             <source>J Virol</source>             <volume>75</volume>             <fpage>4999</fpage>             <lpage>5008</lpage>          </element-citation></ref><ref id="pcbi.1000074-Johnson1"><label>19</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Johnson</surname><given-names>VA</given-names></name><name name-style="western"><surname>Brun-Vezinet</surname><given-names>F</given-names></name><name name-style="western"><surname>Clotet</surname><given-names>B</given-names></name><name name-style="western"><surname>Kuritzkes</surname><given-names>DR</given-names></name><name name-style="western"><surname>Pillay</surname><given-names>D</given-names></name><etal/></person-group>             <year>2006</year>             <article-title>Update of the drug resistance mutations in HIV-1: Fall 2006.</article-title>             <source>Top HIV Med</source>             <volume>14</volume>             <fpage>125</fpage>             <lpage>130</lpage>          </element-citation></ref><ref id="pcbi.1000074-Pevzner1"><label>20</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Pevzner</surname><given-names>PA</given-names></name><name name-style="western"><surname>Tang</surname><given-names>H</given-names></name><name name-style="western"><surname>Waterman</surname><given-names>MS</given-names></name></person-group>             <year>2001</year>             <article-title>An Eulerian path approach to DNA fragment assembly.</article-title>             <source>Proc Natl Acad Sci U S A</source>             <volume>98</volume>             <fpage>9748</fpage>             <lpage>9753</lpage>          </element-citation></ref><ref id="pcbi.1000074-Tyson1"><label>21</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Tyson</surname><given-names>GW</given-names></name><name name-style="western"><surname>Banfield</surname><given-names>JF</given-names></name></person-group>             <year>2005</year>             <article-title>Cultivating the uncultivated: a community genomics perspective.</article-title>             <source>Trends Microbiol</source>             <volume>13</volume>             <fpage>411</fpage>             <lpage>415</lpage>          </element-citation></ref><ref id="pcbi.1000074-Chen1"><label>22</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Chen</surname><given-names>K</given-names></name><name name-style="western"><surname>Pachter</surname><given-names>L</given-names></name></person-group>             <year>2005</year>             <article-title>Bioinformatics for Whole-Genome Shotgun Sequencing of Microbial Communities.</article-title>             <source>PLoS Comput Biol</source>             <volume>1</volume>             <fpage>e24</fpage>             <comment>doi:10.1371/journal.pcbi.0010024</comment>          </element-citation></ref><ref id="pcbi.1000074-The1"><label>23</label><element-citation publication-type="journal" xlink:type="simple">             <collab xlink:type="simple">The International HapMap C</collab>             <year>2005</year>             <article-title>A haplotype map of the human genome.</article-title>             <source>Nature</source>             <volume>437</volume>             <fpage>1299</fpage>             <lpage>1320</lpage>          </element-citation></ref><ref id="pcbi.1000074-Jenkins1"><label>24</label><element-citation publication-type="other" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Jenkins</surname><given-names>P</given-names></name><name name-style="western"><surname>Lyngsø</surname><given-names>RB</given-names></name><name name-style="western"><surname>Hein</surname><given-names>J</given-names></name></person-group>             <year>2006</year>             <article-title>How Many Transcripts Does It Take to Reconstruct the Splice Graph?</article-title>             <person-group person-group-type="editor"><name name-style="western"><surname>Bucher</surname><given-names>P</given-names></name><name name-style="western"><surname>Moret</surname><given-names>BME</given-names></name></person-group>             <source>Lect Notes Comput Sci</source>             <publisher-name>Springer</publisher-name>             <fpage>103</fpage>             <lpage>114</lpage>          </element-citation></ref><ref id="pcbi.1000074-Breitbart1"><label>25</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Breitbart</surname><given-names>M</given-names></name><name name-style="western"><surname>Salamon</surname><given-names>P</given-names></name><name name-style="western"><surname>Andresen</surname><given-names>B</given-names></name><name name-style="western"><surname>Mahaffy</surname><given-names>JM</given-names></name><name name-style="western"><surname>Segall</surname><given-names>AM</given-names></name><etal/></person-group>             <year>2002</year>             <article-title>Genomic analysis of uncultured marine viral communities.</article-title>             <source>Proc Natl Acad Sci U S A</source>             <volume>99</volume>             <fpage>14250</fpage>             <lpage>14255</lpage>          </element-citation></ref><ref id="pcbi.1000074-Sogin1"><label>26</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Sogin</surname><given-names>ML</given-names></name><name name-style="western"><surname>Morrison</surname><given-names>HG</given-names></name><name name-style="western"><surname>Huber</surname><given-names>JA</given-names></name><name name-style="western"><surname>Welch</surname><given-names>DM</given-names></name><name name-style="western"><surname>Huse</surname><given-names>SM</given-names></name><etal/></person-group>             <year>2006</year>             <article-title>Microbial diversity in the deep sea and the underexplored “rare biosphere”.</article-title>             <source>Proc Natl Acad Sci U S A</source>             <volume>103</volume>             <fpage>12115</fpage>             <lpage>12120</lpage>          </element-citation></ref><ref id="pcbi.1000074-Kececioglu1"><label>27</label><element-citation publication-type="other" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Kececioglu</surname><given-names>J</given-names></name><name name-style="western"><surname>Ju</surname><given-names>J</given-names></name></person-group>             <year>2001</year>             <source>Separating repeats in DNA sequence assembly</source>             <publisher-loc>New York</publisher-loc>             <publisher-name>ACM Press</publisher-name>             <fpage>176</fpage>             <lpage>183</lpage>          </element-citation></ref><ref id="pcbi.1000074-Tammi1"><label>28</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Tammi</surname><given-names>MT</given-names></name><name name-style="western"><surname>Arner</surname><given-names>E</given-names></name><name name-style="western"><surname>Britton</surname><given-names>T</given-names></name><name name-style="western"><surname>Andersson</surname><given-names>B</given-names></name></person-group>             <year>2002</year>             <article-title>Separation of nearly identical repeats in shotgun assemblies using defined nucleotide positions, DNPs.</article-title>             <source>Bioinformatics</source>             <volume>18</volume>             <fpage>379</fpage>             <lpage>388</lpage>          </element-citation></ref><ref id="pcbi.1000074-Lander1"><label>29</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Lander</surname><given-names>ES</given-names></name><name name-style="western"><surname>Waterman</surname><given-names>MS</given-names></name></person-group>             <year>1988</year>             <article-title>Genomic mapping by fingerprinting random clones: A mathematical analysis.</article-title>             <source>Genomics</source>             <volume>2</volume>             <fpage>231</fpage>             <lpage>239</lpage>          </element-citation></ref><ref id="pcbi.1000074-Dilworth1"><label>30</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Dilworth</surname><given-names>RP</given-names></name></person-group>             <year>1950</year>             <article-title>A decomposition theorem for partially ordered sets.</article-title>             <source>Ann Math (2)</source>             <volume>51</volume>             <fpage>161</fpage>             <lpage>166</lpage>          </element-citation></ref><ref id="pcbi.1000074-Excoffier1"><label>31</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Excoffier</surname><given-names>L</given-names></name><name name-style="western"><surname>Slatkin</surname><given-names>M</given-names></name></person-group>             <year>1995</year>             <article-title>Maximum-likelihood estimation of molecular haplotype frequencies in a diploid population.</article-title>             <source>Mol Biol Evol</source>             <volume>12</volume>             <fpage>921</fpage>             <lpage>927</lpage>          </element-citation></ref><ref id="pcbi.1000074-Stephens1"><label>32</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Stephens</surname><given-names>M</given-names></name><name name-style="western"><surname>Smith</surname><given-names>NJ</given-names></name><name name-style="western"><surname>Donnelly</surname><given-names>P</given-names></name></person-group>             <year>2001</year>             <article-title>A new statistical method for haplotype reconstruction from population data.</article-title>             <source>Am J Hum Genet</source>             <volume>68</volume>             <fpage>978</fpage>             <lpage>989</lpage>          </element-citation></ref><ref id="pcbi.1000074-Halperin1"><label>33</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Halperin</surname><given-names>E</given-names></name><name name-style="western"><surname>Hazan</surname><given-names>E</given-names></name></person-group>             <year>2006</year>             <article-title>HAPLOFREQ—Estimating haplotype frequencies efficiently.</article-title>             <source>J Comput Biol</source>             <volume>13</volume>             <fpage>481</fpage>             <lpage>500</lpage>          </element-citation></ref><ref id="pcbi.1000074-Schmid1"><label>34</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Schmid</surname><given-names>R</given-names></name><name name-style="western"><surname>Schuster</surname><given-names>SC</given-names></name><name name-style="western"><surname>Steel</surname><given-names>MA</given-names></name><name name-style="western"><surname>Huson</surname><given-names>DH</given-names></name></person-group>             <year>2006</year>             <article-title>ReadSim—A simulator for Sanger and 454 sequencing.</article-title>          </element-citation></ref><ref id="pcbi.1000074-Rhee2"><label>35</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Rhee</surname><given-names>S-Y</given-names></name><name name-style="western"><surname>Gonzales</surname><given-names>MJ</given-names></name><name name-style="western"><surname>Kantor</surname><given-names>R</given-names></name><name name-style="western"><surname>Betts</surname><given-names>BJ</given-names></name><name name-style="western"><surname>Ravela</surname><given-names>J</given-names></name><etal/></person-group>             <year>2003</year>             <article-title>Human immunodeficiency virus reverse transcriptase and protease sequence database.</article-title>             <source>Nucleic Acids Res</source>             <volume>31</volume>             <fpage>298</fpage>             <lpage>303</lpage>          </element-citation></ref><ref id="pcbi.1000074-Gonzales1"><label>36</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Gonzales</surname><given-names>MJ</given-names></name><name name-style="western"><surname>Johnson</surname><given-names>E</given-names></name><name name-style="western"><surname>Dupnik</surname><given-names>KM</given-names></name><name name-style="western"><surname>Imamichi</surname><given-names>T</given-names></name><name name-style="western"><surname>Shafer</surname><given-names>RW</given-names></name></person-group>             <year>2003</year>             <article-title>Colinearity of reverse transcriptase inhibitor resistance mutations detected by population-based sequencing.</article-title>             <source>J Acquir Immune Defic Syndr</source>             <volume>34</volume>             <fpage>398</fpage>             <lpage>402</lpage>          </element-citation></ref><ref id="pcbi.1000074-Doukhan1"><label>37</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Doukhan</surname><given-names>L</given-names></name><name name-style="western"><surname>Delwart</surname><given-names>E</given-names></name></person-group>             <year>2001</year>             <article-title>Population genetic analysis of the protease locus of human immunodeficiency virus type 1 quasispecies undergoing drug selection, using a denaturing gradient-heteroduplex tracking assay.</article-title>             <source>J Virol</source>             <volume>75</volume>             <fpage>6729</fpage>             <lpage>6736</lpage>          </element-citation></ref><ref id="pcbi.1000074-Metzner1"><label>38</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Metzner</surname><given-names>KJ</given-names></name><name name-style="western"><surname>Rauch</surname><given-names>P</given-names></name><name name-style="western"><surname>Walter</surname><given-names>H</given-names></name><name name-style="western"><surname>Boesecke</surname><given-names>C</given-names></name><name name-style="western"><surname>Zöllner</surname><given-names>B</given-names></name><etal/></person-group>             <year>2005</year>             <article-title>Detection of minor populations of drug-resistant HIV-1 in acute seroconverters.</article-title>             <source>AIDS</source>             <volume>19</volume>             <fpage>1819</fpage>             <lpage>1825</lpage>          </element-citation></ref><ref id="pcbi.1000074-Gottlieb1"><label>39</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Gottlieb</surname><given-names>GS</given-names></name><name name-style="western"><surname>Nickle</surname><given-names>DC</given-names></name><name name-style="western"><surname>Jensen</surname><given-names>MA</given-names></name><name name-style="western"><surname>Wong</surname><given-names>KG</given-names></name><name name-style="western"><surname>Grobler</surname><given-names>J</given-names></name><etal/></person-group>             <year>2004</year>             <article-title>Dual HIV-1 infection associated with rapid disease progression.</article-title>             <source>Lancet</source>             <volume>363</volume>             <fpage>619</fpage>             <lpage>622</lpage>          </element-citation></ref><ref id="pcbi.1000074-Rambaut1"><label>40</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Rambaut</surname><given-names>A</given-names></name><name name-style="western"><surname>Posada</surname><given-names>D</given-names></name><name name-style="western"><surname>Crandall</surname><given-names>KA</given-names></name><name name-style="western"><surname>Holmes</surname><given-names>EC</given-names></name></person-group>             <year>2004</year>             <article-title>The causes and consequences of HIV evolution.</article-title>             <source>Nat Rev Genet</source>             <volume>5</volume>             <fpage>52</fpage>             <lpage>61</lpage>          </element-citation></ref><ref id="pcbi.1000074-Rouzine1"><label>41</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Rouzine</surname><given-names>IM</given-names></name><name name-style="western"><surname>Rodrigo</surname><given-names>A</given-names></name><name name-style="western"><surname>Coffin</surname><given-names>JM</given-names></name></person-group>             <year>2001</year>             <article-title>Transition between stochastic evolution and deterministic evolution in the presence of selection: General theory and application to virology.</article-title>             <source>Microbiol Mol Biol Rev</source>             <volume>65</volume>             <fpage>151</fpage>             <lpage>185</lpage>          </element-citation></ref><ref id="pcbi.1000074-Ford1"><label>42</label><element-citation publication-type="other" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Ford</surname><given-names>LR</given-names></name><name name-style="western"><surname>Fulkerson</surname><given-names>DR</given-names></name></person-group>             <year>1962</year>             <source>Flows in networks</source>             <publisher-loc>Princeton</publisher-loc>             <publisher-name>Princeton University Press</publisher-name>          </element-citation></ref><ref id="pcbi.1000074-Hopcroft1"><label>43</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Hopcroft</surname><given-names>JE</given-names></name><name name-style="western"><surname>Karp</surname><given-names>RM</given-names></name></person-group>             <year>1973</year>             <article-title>An <italic>n</italic><sup>5/2</sup> algorithm for maximum matchings in bipartite graphs.</article-title>             <source>SIAM J Comput</source>             <volume>2</volume>             <fpage>225</fpage>             <lpage>231</lpage>          </element-citation></ref><ref id="pcbi.1000074-Dempster1"><label>44</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Dempster</surname><given-names>A</given-names></name><name name-style="western"><surname>Laird</surname><given-names>N</given-names></name><name name-style="western"><surname>Rubin</surname><given-names>D</given-names></name></person-group>             <year>1977</year>             <article-title>Maximum likelihood from incomplete data via the EM algorithm (with discussions).</article-title>             <source>J R Statist Soc B</source>             <volume>39</volume>             <fpage>1</fpage>             <lpage>38</lpage>          </element-citation></ref><ref id="pcbi.1000074-Simpson1"><label>45</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Simpson</surname><given-names>EH</given-names></name></person-group>             <year>1949</year>             <article-title>Measurement of diversity.</article-title>             <source>Nature</source>             <volume>163</volume>             <fpage>688</fpage>          </element-citation></ref><ref id="pcbi.1000074-Collins1"><label>46</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author"><name name-style="western"><surname>Collins</surname><given-names>ML</given-names></name><name name-style="western"><surname>Irvine</surname><given-names>B</given-names></name><name name-style="western"><surname>Tyner</surname><given-names>D</given-names></name><name name-style="western"><surname>Fine</surname><given-names>E</given-names></name><name name-style="western"><surname>Zayati</surname><given-names>C</given-names></name><etal/></person-group>             <year>1997</year>             <article-title>A branched DNA signal amplification assay for quantification of nucleic acid targets below 100 molecules/ml.</article-title>             <source>Nucleic Acids Res</source>             <volume>25</volume>             <fpage>2979</fpage>             <lpage>2984</lpage>          </element-citation></ref></ref-list></back></article>