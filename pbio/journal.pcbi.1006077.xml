<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE article PUBLIC "-//NLM//DTD JATS (Z39.96) Journal Publishing DTD v1.1d3 20150301//EN" "http://jats.nlm.nih.gov/publishing/1.1d3/JATS-journalpublishing1.dtd">
<article article-type="research-article" dtd-version="1.1d3" xml:lang="en" xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink">
<front>
<journal-meta>
<journal-id journal-id-type="nlm-ta">PLoS Comput Biol</journal-id>
<journal-id journal-id-type="publisher-id">plos</journal-id>
<journal-id journal-id-type="pmc">ploscomp</journal-id>
<journal-title-group>
<journal-title>PLOS Computational Biology</journal-title>
</journal-title-group>
<issn pub-type="ppub">1553-734X</issn>
<issn pub-type="epub">1553-7358</issn>
<publisher>
<publisher-name>Public Library of Science</publisher-name>
<publisher-loc>San Francisco, CA USA</publisher-loc>
</publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="doi">10.1371/journal.pcbi.1006077</article-id>
<article-id pub-id-type="publisher-id">PCOMPBIOL-D-17-00229</article-id>
<article-categories>
<subj-group subj-group-type="heading">
<subject>Research Article</subject>
</subj-group>
<subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Developmental biology</subject><subj-group><subject>Embryology</subject><subj-group><subject>Embryos</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Research and analysis methods</subject><subj-group><subject>Imaging techniques</subject><subj-group><subject>Image analysis</subject></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Physical sciences</subject><subj-group><subject>Materials science</subject><subj-group><subject>Materials by attribute</subject><subj-group><subject>Pigments</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Research and analysis methods</subject><subj-group><subject>Imaging techniques</subject></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Genetics</subject><subj-group><subject>Gene expression</subject></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Physical sciences</subject><subj-group><subject>Mathematics</subject><subj-group><subject>Applied mathematics</subject><subj-group><subject>Algorithms</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Research and analysis methods</subject><subj-group><subject>Simulation and modeling</subject><subj-group><subject>Algorithms</subject></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Research and analysis methods</subject><subj-group><subject>Experimental organism systems</subject><subj-group><subject>Model organisms</subject><subj-group><subject>Xenopus</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Research and analysis methods</subject><subj-group><subject>Model organisms</subject><subj-group><subject>Xenopus</subject></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Research and analysis methods</subject><subj-group><subject>Experimental organism systems</subject><subj-group><subject>Animal models</subject><subj-group><subject>Xenopus</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Organisms</subject><subj-group><subject>Eukaryota</subject><subj-group><subject>Animals</subject><subj-group><subject>Vertebrates</subject><subj-group><subject>Amphibians</subject><subj-group><subject>Frogs</subject><subj-group><subject>Xenopus</subject></subj-group></subj-group></subj-group></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Developmental biology</subject><subj-group><subject>Morphogenesis</subject><subj-group><subject>Morphogenic segmentation</subject></subj-group></subj-group></subj-group></subj-group></article-categories>
<title-group>
<article-title>New methods for computational decomposition of whole-mount <italic>in situ</italic> images enable effective curation of a large, highly redundant collection of <italic>Xenopus</italic> images</article-title>
<alt-title alt-title-type="running-head">Computational methods for in situ image analysis in Xenopus</alt-title>
</title-group>
<contrib-group>
<contrib contrib-type="author" xlink:type="simple">
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-4323-6465</contrib-id>
<name name-style="western">
<surname>Patrushev</surname>
<given-names>Ilya</given-names>
</name>
<role content-type="http://credit.casrai.org/">Conceptualization</role>
<role content-type="http://credit.casrai.org/">Formal analysis</role>
<role content-type="http://credit.casrai.org/">Methodology</role>
<role content-type="http://credit.casrai.org/">Software</role>
<role content-type="http://credit.casrai.org/">Validation</role>
<role content-type="http://credit.casrai.org/">Visualization</role>
<role content-type="http://credit.casrai.org/">Writing – original draft</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff001"><sup>1</sup></xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0001-5495-4588</contrib-id>
<name name-style="western">
<surname>James-Zorn</surname>
<given-names>Christina</given-names>
</name>
<role content-type="http://credit.casrai.org/">Data curation</role>
<role content-type="http://credit.casrai.org/">Resources</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff002"><sup>2</sup></xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-0505-6607</contrib-id>
<name name-style="western">
<surname>Ciau-Uitz</surname>
<given-names>Aldo</given-names>
</name>
<role content-type="http://credit.casrai.org/">Data curation</role>
<role content-type="http://credit.casrai.org/">Resources</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff003"><sup>3</sup></xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-1568-8165</contrib-id>
<name name-style="western">
<surname>Patient</surname>
<given-names>Roger</given-names>
</name>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff003"><sup>3</sup></xref>
</contrib>
<contrib contrib-type="author" corresp="yes" xlink:type="simple">
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0001-9762-1951</contrib-id>
<name name-style="western">
<surname>Gilchrist</surname>
<given-names>Michael J.</given-names>
</name>
<role content-type="http://credit.casrai.org/">Conceptualization</role>
<role content-type="http://credit.casrai.org/">Methodology</role>
<role content-type="http://credit.casrai.org/">Resources</role>
<role content-type="http://credit.casrai.org/">Supervision</role>
<role content-type="http://credit.casrai.org/">Visualization</role>
<role content-type="http://credit.casrai.org/">Writing – original draft</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff001"><sup>1</sup></xref>
<xref ref-type="corresp" rid="cor001">*</xref>
</contrib>
</contrib-group>
<aff id="aff001"><label>1</label> <addr-line>The Francis Crick Institute, London, United Kingdom</addr-line></aff>
<aff id="aff002"><label>2</label> <addr-line>Cincinnati Children’s Hospital, Division of Developmental Biology, Cincinnati, Ohio</addr-line></aff>
<aff id="aff003"><label>3</label> <addr-line>MRC Molecular Haematology Unit, The Weatherall Institute of Molecular Medicine, University of Oxford, John Radcliffe Hospital, Headington, Oxford</addr-line></aff>
<contrib-group>
<contrib contrib-type="editor" xlink:type="simple">
<name name-style="western">
<surname>Tomancak</surname>
<given-names>Pavel</given-names>
</name>
<role>Editor</role>
<xref ref-type="aff" rid="edit1"/>
</contrib>
</contrib-group>
<aff id="edit1"><addr-line>Max Planck Institute of Molecular Cell Biology and Genetics, GERMANY</addr-line></aff>
<author-notes>
<fn fn-type="conflict" id="coi001">
<p>The authors have declared that no competing interests exist.</p>
</fn>
<corresp id="cor001">* E-mail: <email xlink:type="simple">drmikegilchrist@gmail.com</email></corresp>
</author-notes>
<pub-date pub-type="epub">
<day>29</day>
<month>8</month>
<year>2018</year>
</pub-date>
<pub-date pub-type="collection">
<month>8</month>
<year>2018</year>
</pub-date>
<volume>14</volume>
<issue>8</issue>
<elocation-id>e1006077</elocation-id>
<history>
<date date-type="received">
<day>10</day>
<month>2</month>
<year>2017</year>
</date>
<date date-type="accepted">
<day>7</day>
<month>3</month>
<year>2018</year>
</date>
</history>
<permissions>
<copyright-year>2018</copyright-year>
<copyright-holder>Patrushev et al</copyright-holder>
<license xlink:href="http://creativecommons.org/licenses/by/4.0/" xlink:type="simple">
<license-p>This is an open access article distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/" xlink:type="simple">Creative Commons Attribution License</ext-link>, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p>
</license>
</permissions>
<self-uri content-type="pdf" xlink:href="info:doi/10.1371/journal.pcbi.1006077"/>
<abstract>
<p>The precise anatomical location of gene expression is an essential component of the study of gene function. For most model organisms this task is usually undertaken via visual inspection of gene expression images by interested researchers. Computational analysis of gene expression has been developed in several model organisms, notably in <italic>Drosophila</italic> which exhibits a uniform shape and outline in the early stages of development. Here we address the challenge of computational analysis of gene expression in <italic>Xenopus</italic>, where the range of developmental stages of interest encompasses a wide range of embryo size and shape. Embryos may have different orientation across images, and, in addition, embryos have a pigmented epidermis that can mask or confuse underlying gene expression. Here we report the development of a set of computational tools capable of processing large image sets with variable characteristics. These tools efficiently separate the <italic>Xenopus</italic> embryo from the background, separately identify both histochemically stained and naturally pigmented regions within the embryo, and can sort images from the same gene and developmental stage according to similarity of gene expression patterns without information about relative orientation. We tested these methods on a large, but highly redundant, collection of 33,289 <italic>in situ</italic> hybridization images, allowing us to select representative images of expression patterns at different embryo orientations. This has allowed us to put a much smaller subset of these images into the public domain in an effective manner. The ‘isimage’ module and the scripts developed are implemented in Python and freely available on <ext-link ext-link-type="uri" xlink:href="https://pypi.python.org/pypi/isimage/" xlink:type="simple">https://pypi.python.org/pypi/isimage/</ext-link>.</p>
</abstract>
<abstract abstract-type="summary">
<title>Author summary</title>
<p>An important component of research into the function of genes in the developing organism is an understanding of both when and where the gene is expressed. Well established molecular techniques can be used to colour the embryo in regions where the gene of interest appears, and researchers will photograph such treated embryos at different stages of development to build up the story of the gene’s use. Small numbers of these <italic>expression pattern</italic> images may easily be examined by eye, but getting usable information from large collections of such images would take an enormous investment in time by trained scientists. Computational analysis is much to be preferred, but the task is complex and difficult to generalise. The frog <italic>Xenopus</italic> is an important model for studying vertebrate development, but up till now has had no purely computational methods available for analysing gene expression. Here we present a suite of computational tools based on a range of mathematical methods, capable of recognising the outline of the embryo against a variety of backgrounds, and within the embryo separately recognising areas of both gene expression and natural pigmentation. These tools work over a wide range of embryo shapes and imaging conditions, and, in our opinion, represent a major step towards full automation of anatomical gene expression annotation in vertebrate embryology.</p>
</abstract>
<funding-group>
<award-group id="award001">
<funding-source>
<institution>The Francis Crick Institute</institution>
</funding-source>
<principal-award-recipient>
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-4323-6465</contrib-id>
<name name-style="western">
<surname>Patrushev</surname>
<given-names>Ilya</given-names>
</name>
</principal-award-recipient>
</award-group>
<award-group id="award002">
<funding-source>
<institution>The Francis Crick Institute</institution>
</funding-source>
<principal-award-recipient>
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0001-9762-1951</contrib-id>
<name name-style="western">
<surname>Gilchrist</surname>
<given-names>Michael J.</given-names>
</name>
</principal-award-recipient>
</award-group>
<award-group id="award003">
<funding-source>
<institution>Medical Research Council (GB)</institution>
</funding-source>
<principal-award-recipient>
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-0505-6607</contrib-id>
<name name-style="western">
<surname>Ciau-Uitz</surname>
<given-names>Aldo</given-names>
</name>
</principal-award-recipient>
</award-group>
<award-group id="award004">
<funding-source>
<institution-wrap>
<institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/501100000265</institution-id>
<institution>Medical Research Council</institution>
</institution-wrap>
</funding-source>
<principal-award-recipient>
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-1568-8165</contrib-id>
<name name-style="western">
<surname>Patient</surname>
<given-names>Roger</given-names>
</name>
</principal-award-recipient>
</award-group>
<award-group id="award005">
<funding-source>
<institution>NIH Child Health and Human Development</institution>
</funding-source>
<award-id>P41 HD064556</award-id>
<principal-award-recipient>
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0001-5495-4588</contrib-id>
<name name-style="western">
<surname>James-Zorn</surname>
<given-names>Christina</given-names>
</name>
</principal-award-recipient>
</award-group>
<funding-statement>MJG and IP are supported by the Francis Crick Institute, which receives its core funding from Cancer Research UK (FC001082), the UK Medical Research Council (FC001082), and the Wellcome Trust (FC001082). AC-U and RP are funded by the UK Medical Research Council. CJZ is supported by NIH Child Health and Human Development grant P41 HD064556. The funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.</funding-statement>
</funding-group>
<counts>
<fig-count count="5"/>
<table-count count="2"/>
<page-count count="25"/>
</counts>
<custom-meta-group>
<custom-meta>
<meta-name>PLOS Publication Stage</meta-name>
<meta-value>vor-update-to-uncorrected-proof</meta-value>
</custom-meta>
<custom-meta>
<meta-name>Publication Update</meta-name>
<meta-value>2018-09-27</meta-value>
</custom-meta>
<custom-meta id="data-availability">
<meta-name>Data Availability</meta-name>
<meta-value>Image files are available from Xenbase database: Go to URL: <ext-link ext-link-type="uri" xlink:href="http://www.xenbase.org/geneExpression/geneExpressionSearch.do?method=display" xlink:type="simple">http://www.xenbase.org/geneExpression/geneExpressionSearch.do?method=display</ext-link> Enter Ciau-Uitz in Experimenter field. Hit search The code for the paper is available from Python code repository <ext-link ext-link-type="uri" xlink:href="https://pypi.python.org/pypi/isimage" xlink:type="simple">https://pypi.python.org/pypi/isimage</ext-link> and from GitHub: <ext-link ext-link-type="uri" xlink:href="https://github.com/ilyapatrushev/isimage" xlink:type="simple">https://github.com/ilyapatrushev/isimage</ext-link>.</meta-value>
</custom-meta>
</custom-meta-group>
</article-meta>
</front>
<body>
<sec id="sec001" sec-type="intro">
<title>Introduction</title>
<p>A significant challenge for current bioinformatics is the computational analysis of large data sets. Recent developments in sequencing technologies have allowed, for example, the investigation of the time course of gene expression in early development of <italic>Xenopus tropicalis</italic> at high time resolution [<xref ref-type="bibr" rid="pcbi.1006077.ref001">1</xref>,<xref ref-type="bibr" rid="pcbi.1006077.ref002">2</xref>]. For a robust understanding of gene expression, the precise anatomical or cellular location of expression is as important as the timing of expression, yet this presents significant challenges for computational analysis. The most advanced work has been done in <italic>Drosophila</italic>, with the analysis of the time evolution of the spatial pattern of gene expression revealing genes with co-localised expression[<xref ref-type="bibr" rid="pcbi.1006077.ref003">3</xref>,<xref ref-type="bibr" rid="pcbi.1006077.ref004">4</xref>,<xref ref-type="bibr" rid="pcbi.1006077.ref005">5</xref>,<xref ref-type="bibr" rid="pcbi.1006077.ref006">6</xref>].</p>
<p>The spatial distribution of RNA within an embryo or tissue is typically obtained by <italic>in situ</italic> hybridisation (WISH) of a probe sequence to the endogenous RNA under study or by protein immunofluoresence, followed by photographic imaging of the required stages and views or sections. Preparation of reagents and optimisation of conditions for a specific protein/gene target may take time, but once done it is straightforward to generate images covering (for example) many different developmental stages.</p>
<p>For studies on the localisation of small numbers of genes, analysis by inspection of the resultant images is likely to be feasible and may provide sufficient descriptive data to answer the biological question at hand. In larger scale screens the number of generated images can grow rapidly to tens of thousands [<xref ref-type="bibr" rid="pcbi.1006077.ref003">3</xref>] or more [<xref ref-type="bibr" rid="pcbi.1006077.ref007">7</xref>], and at this level will either require computational analysis or significant commitment by members of the respective model organism community to manually annotate the images; for example with zebrafish [<xref ref-type="bibr" rid="pcbi.1006077.ref008">8</xref>], <italic>Drosophila</italic> [<xref ref-type="bibr" rid="pcbi.1006077.ref006">6</xref>] or <italic>Xenopus</italic> [<xref ref-type="bibr" rid="pcbi.1006077.ref009">9</xref>,<xref ref-type="bibr" rid="pcbi.1006077.ref010">10</xref>]. However, although manual annotation is generally of high quality, it is slow and the required effort is not easily replicated.</p>
<p>Computational analysis is clearly preferred for large numbers of images, although this is not a straightforward task, and may require significant investment of time and expertise to develop a suitable system. The goals of computational analysis are easily stated: to recognize the relevant physical anatomy of the organism in the image, locate the regions which show gene expression, and either label these regions with suitable anatomical terms or transfer them to a model coordinate system within which the expression patterns may be analysed and/or compared. These goals are usually achieved by two distinct processes described as <italic>segmentation</italic> (recognising compartmentalisation in the image) and <italic>registration</italic> (fitting the embryo shape in the image to a model), as well as recognising which parts of the segmented image correspond to gene expression.</p>
<p>Image analysis in <italic>Xenopus</italic> has several specific challenges: the embryos are not normally fully transparent; embryos may display distinct pigmented regions; in embryos that are cleared to make them transparent the outline of the embryo may merge into the image background; and experimental data frequently cover a wide range of development stages and concomitant variety of embryo shapes and sizes. In addition, the earlier development stages are quasi-spherical, and, unlike fly embryos, may present some difficulty in determining the axial orientation within the image. To date there are no published methods for computational image analysis developed for <italic>Xenopus</italic>.</p>
<p>Here we report a first suite of tools developed for computational analysis of <italic>Xenopus in situ</italic> images. These tools are capable of cleanly separating the embryo from the image background over a wide range of developmental stages without requiring the background to be either uniform or any specific colour; <italic>in situ</italic> hybridisation stain and natural pigment are detected independently and can be marked up accordingly; and analysed images at the early quasi-spherical stages can be compared with each other to identify groups of images photographed at the same axial orientation. Application of this solution of the segmentation problem and partial solution of the registration problem has enabled us to analyse a large and highly redundant image collection, selecting a usefully condensed and representative set for public dissemination. Although it remains to provide the ability to register the images in a model coordinate system, we have laid some useful ground work for future progress. The reduced image set may also now be considered for manual image registration, expression pattern extraction and annotation in existing <italic>Xenopus</italic> community tools such as Xenbase (<ext-link ext-link-type="uri" xlink:href="http://www.xenbase.org/" xlink:type="simple">http://www.xenbase.org</ext-link>, RRID:SCR_003280) [<xref ref-type="bibr" rid="pcbi.1006077.ref011">11</xref>,<xref ref-type="bibr" rid="pcbi.1006077.ref012">12</xref>] and XenMARK (<ext-link ext-link-type="uri" xlink:href="https://genomics.crick.ac.uk/apps/XenMARK" xlink:type="simple">https://genomics.crick.ac.uk/apps/XenMARK</ext-link>, RRID:SCR_014924) [<xref ref-type="bibr" rid="pcbi.1006077.ref009">9</xref>].</p>
<p>Two of us (MG and IP) were motivated to undertake this research by the desire to complement our high resolution time series data in <italic>Xenopus tropicalis</italic> [<xref ref-type="bibr" rid="pcbi.1006077.ref001">1</xref>,<xref ref-type="bibr" rid="pcbi.1006077.ref002">2</xref>] with expression localisation data mined from public image collections, and to promote and enable further work on computational image analysis within the community. Earlier work [<xref ref-type="bibr" rid="pcbi.1006077.ref009">9</xref>] had suggested a way forward through crowd sourcing of manual annotation, but the generation, and donation to the community, by others of us (AC-U and RP) of a large collection of 33,289 informative <italic>in situ</italic> images, suggested that we consider computational approaches. This large set of images contained multiple images at given developmental stages for each gene, and we reasoned that a systematic reduction of this (around 10-fold) technical redundancy would yield a more useful and tractable set of images for use by other researchers via submission to Xenbase, the <italic>Xenopus</italic> the model organism database. Computational tools devised to achieve this would necessarily form a sound basis for further progress in image analysis in <italic>Xenopus</italic>. We do not at this stage provide a solution to the problem of registering embryo outlines with a model representation.</p>
</sec>
<sec id="sec002" sec-type="results">
<title>Results</title>
<p>In this section we present the functional outline and application of each part of our method. More details of the basis of each algorithm are provided in the Methods section below.</p>
<p>In summary, we developed two primary algorithms: (i) embryo-masking through image segmentation to separate the part of the image containing the embryo from the image background without prior constraints on the background colour or texture; and (ii) colour-separation within the embryo outline, to identify the approximate hues of <italic>in situ</italic> stain, and pigmented and un-pigmented embryo in each image, and mark up the image accordingly. In addition, we developed algorithms to automatically classify large sets of images by background characteristics, and to perform image-clustering on spherical stage images under transformations of scale, rotation, and shear and hence identify groups of images for the same gene and stage but photographed at different orientations. This last was a key tool in applying our methods to the large, redundant image collection described above, and may also provide a way forward to a solution of the general registration problem for <italic>Xenopus</italic> embryos.</p>
<p>To develop the methods we have drawn on two sources of <italic>Xenopus</italic> in situ images: firstly, locally hosted images from the XenMARK project[<xref ref-type="bibr" rid="pcbi.1006077.ref009">9</xref>] covering a wide range of imaging conditions, and second, a collection of 33,289 images provided by two of us (AC-U and RP) which is described in more detail below. Randomly selected images from both these collections were used for validation.</p>
<p>A brief overview of the primary algorithms is given here, with more technical detail presented in Methods §2 and §3.</p>
<sec id="sec003">
<title>Segmentation for embryo masking</title>
<p>This algorithm locates the outline of the embryo within the image. We made two assumptions (i) that the distribution of colour and texture within the embryo is distinct from the distribution of colour and texture in the background, and (ii) that at least part of the embryo is more or less centrally located within the image. These are generally reasonable for the great majority of images we have seen during the development of this work. As a useful side-effect we can also detect images where we believe the embryo touches or is intersected by the edges of the image frame.</p>
<p>Images are first processed to remove potential illumination artefacts and then downscaled. The degree of downscaling depends on the image, but is usually between 4- and 32-fold. Colour content and context are analysed for each downscaled pixel, and modelled as a mixture of either two (un-cleared images) or three (cleared images) Gaussian distributions. Pixels are assigned to the most likely distribution, and the image is mapped accordingly. The spatial distribution of each set of assigned pixels over the image is then considered: if a component is spread more uniformly across the image than other more compactly and centrally distributed component(s), then that component is considered to represent background. Isolated foreground regions that are small or close in colour to the background are re-assigned to the surrounding value. Embryo outlines are thus defined as the border between the background and other regions. Then the embryo outline is smoothed and moved inwards by the width of the low resolution pixels used at this stage. A detailed technical description of these processes can be found in Methods §2, and also see Figs <xref ref-type="fig" rid="pcbi.1006077.g001">1</xref> and <xref ref-type="fig" rid="pcbi.1006077.g002">2</xref> for illustration and examples. The embryo outline and its bounding box, with sides parallel to the image edges, are recorded with the image data, and a flag is set if the embryo outline touches the edges of the image.</p>
<fig id="pcbi.1006077.g001" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1006077.g001</object-id>
<label>Fig 1</label>
<caption>
<title>Overview of image analysis pipeline.</title>
<p>(Upper panel) schematic representations of the stages of image analysis. Text boxes contain brief descriptions, see text for more detail, roman numerals correspond to steps in the workflow. Arrows show where data is extracted from the image for analysis. (A) Orthogonal projection of whitened 18 dimensional data extracted from the image. Colouring is made on result of clustering, with crosses and ellipses represent centres and covariances of the identified clusters. (B) Example representation of pixel colour density in the 3D colour space, showing identification of vectors corresponding to <italic>in situ</italic> stain, pigmented and un-pigmented embryo, used to identify regions of the embryo expressing the gene in question. (C) Example histogram of stain distribution. Data modelled as mixture of two Gaussians. The threshold is the smallest of mu + 2*sigma of the two components; it is represented as a solid green line. Dashed red lines represent range of values [.25, .67] the threshold is allowed to take.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1006077.g001" xlink:type="simple"/>
</fig>
<fig id="pcbi.1006077.g002" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1006077.g002</object-id>
<label>Fig 2</label>
<caption>
<title>Graphical depiction of image analysis workflow for selected images with different shape embryos and a range of different background colours and textures.</title>
<p>Images show that embryo detection and stain colour analysis is effective independently of a wide range of variation in image background and embryo characteristics. All images were analysed without changing initial parameters. Note image (d) where even the human eye struggles to distinguish the upper border of the embryo from the background.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1006077.g002" xlink:type="simple"/>
</fig>
</sec>
<sec id="sec004">
<title>In situ staining pattern extraction</title>
<p>This algorithm determines the most likely hues within the previously detected outline of the embryo for stain and pigmentation. Analysis of the colour distribution inside the embryo outline is used to find statistically independent colour components of each image. These components are compared to the (detected) background colour (as bleed-through is possible), and likely stain and pigment colours: stain is assumed to be relatively blue-green and pigment relatively red-brown (see <xref ref-type="sec" rid="sec014">Methods</xref> §3). Heat maps of the determined stain and pigment colours are extracted from the data using adaptive thresholding, and overlaid on the image (<xref ref-type="fig" rid="pcbi.1006077.g001">Fig 1</xref> and <xref ref-type="fig" rid="pcbi.1006077.g002">Fig 2</xref>). A score representing the degree of stain is associated with each image, and can be used to rank image for selection amongst sets of known duplicates (see <xref ref-type="sec" rid="sec014">Methods</xref> §6). This was useful in our analysis of the large, highly redundant, image collection (see below).</p>
</sec>
<sec id="sec005">
<title>Workflow outline</title>
<p>The overall image analysis workflow consists of 8 steps, these are summarised as follows (see also the visualisations in Figs <xref ref-type="fig" rid="pcbi.1006077.g001">1</xref> and <xref ref-type="fig" rid="pcbi.1006077.g002">2</xref>):</p>
<list list-type="roman-lower">
<list-item><p>Pixel data in LAB colour space is extracted from image and transformed into lower resolution pixels.</p></list-item>
<list-item><p>Low resolution pixels are classified on their colour and local roughness of the image and grouped into two, or three for cleared images, broad distributions corresponding to discrete areas of the image.</p></list-item>
<list-item><p>Demarcated areas of image are assessed to determine the most likely to correspond to a roughly centrally positioned embryo or part embryo. The boundary is set at low resolution around the embryo.</p></list-item>
<list-item><p>If the boundary touches the image border, the image is classified as a partial embryo.</p></list-item>
<list-item><p>The boundary is smoothed to remove artefacts, and moved inward the width of one low resolution pixel to exclude background pixels close to the embryo.</p></list-item>
<list-item><p>Pixel data is extracted from within the bounded embryo region of the image at native resolution, and analysed for distribution of hue and intensity in CMY colour space.</p></list-item>
<list-item><p>Generalised prior knowledge (stain more blue/green than pigment, pigment towards red and darker than un-pigmented embryo) is used to identify likely vectors in colour space for <italic>in situ</italic> stain and pigment).</p></list-item>
<list-item><p>The embryo is marked up according to areas of strong and moderate stain and pigment. Annotated version of image produced in register with original image.</p></list-item>
</list>
</sec>
<sec id="sec006">
<title>Validation</title>
<p>To validate the performance of our algorithms we used visual inspection of significant numbers of images selected by random sampling from our available collections. We would have preferred a purely computational method, but to our knowledge there are no suitable data sets of manually marked up in situ images of <italic>Xenopus</italic> embryos available. The closest available images were the manually marked up images from the XenMARK project[<xref ref-type="bibr" rid="pcbi.1006077.ref009">9</xref>], where the stained regions had been ‘registered’ by eye with, and transferred to, the embryo model diagrams. Even had we solved the registration problem for these embryos to enable a computational comparison with these data, we note that the subjective judgement applied during the XenMARK annotation process, as to the presence and limits of stained regions, would be much the same as using an expert annotator to compare side-by-side images of stained embryo and extracted stained regions. We further note that at this stage we were validating the correct identification of <italic>in situ</italic> stained regions within the images, irrespective of our understanding of their anatomical location.</p>
<p>We therefore validated our algorithms in two ways: quick visual inspection of two thousand images after steps (iii) &amp; (iv) (see Outline Workflow above) to check correct identification of the embryo, as opposed to the background, within the image; and more intensive inspection of two hundred images after final mark up at step (viii) by WISH experts for correct interpretation of the <italic>in situ</italic> stain within the embryo.</p>
<p>The quick tests assessed three characteristics of the segmentation process: whether the image background component was correctly identified, whether the selected connected region corresponded generally to the embryo, and whether intersections of the frame edge with the embryo were correctly identified. For these tests we randomly sampled 1000 images from our local hosting of the XenMARK database, as well as 1000 images from the Ciau-Uitz/Patient collection. The errors observed were sufficently distinctive as to be effectively non-subjective, and tests results were scored true or false, with false positive and false negative results distinguished for the embryo/image boundary collision test. Most of the tests were passed at well over 99%, with the exception being for embryo/image edge collisions where false positive results were around 5%, depending on which collection images were from. These data are presented in more detail, along with expected error rates and corresponding 95% confidence intervals, in <xref ref-type="table" rid="pcbi.1006077.t001">Table 1</xref>.</p>
<table-wrap id="pcbi.1006077.t001" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1006077.t001</object-id>
<label>Table 1</label> <caption><title>Validation of image classification and embryo detection algorithms: Identification of non-subjective errors through visual inspection of 2000 randomly selected images.</title> <p>Image classification: was the image correctly classified as cleared or un-cleared? Background segmentation: was the background component identified correctly? Embryo region selection: did the connected region selected correspond to the embryo? Incomplete embryo detection: were embryos touching the image edge correctly identified as such?</p></caption>
<alternatives>
<graphic id="pcbi.1006077.t001g" mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1006077.t001" xlink:type="simple"/>
<table>
<colgroup>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
</colgroup>
<thead>
<tr>
<th align="left">Test</th>
<th align="center">N</th>
<th align="left">Errors</th>
<th align="center">Expected error rate</th>
<th align="center">Error rate CI<sub>95</sub></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center" colspan="5">Images from XenMARK</td>
</tr>
<tr>
<td align="left">Background segmentation</td>
<td align="center">1000</td>
<td align="center">3</td>
<td align="center">0.004</td>
<td align="center">[0.001, 0.009]</td>
</tr>
<tr>
<td align="left">Embryo region selection</td>
<td align="center">997</td>
<td align="center">2</td>
<td align="center">0.003</td>
<td align="center">[0.0006, 0.007]</td>
</tr>
<tr>
<td align="left">Incomplete embryo detection <sup>a</sup></td>
<td align="center">995</td>
<td align="center">59 / 3</td>
<td align="center">0.06 / 0.004</td>
<td align="center">[0.05, 0.08] / [0.001, 0.009]</td>
</tr>
<tr>
<td align="center" colspan="5">Images from Ciau-Uitz/Patient collection</td>
</tr>
<tr>
<td align="left">Image classification</td>
<td align="center">1000</td>
<td align="center">0</td>
<td align="center">&lt; 0.001</td>
<td align="center">[3.x10<sup>-5</sup>, 0.004]</td>
</tr>
<tr>
<td align="left">Background segmentation</td>
<td align="center">1000</td>
<td align="center">1</td>
<td align="center">0.002</td>
<td align="center">[0.0002, 0.006]</td>
</tr>
<tr>
<td align="left">Embryo region selection</td>
<td align="center">999</td>
<td align="center">1</td>
<td align="center">0.002</td>
<td align="center">[0.0002, 0.006]</td>
</tr>
<tr>
<td align="left">Incomplete embryo detection <sup>a</sup></td>
<td align="center">998</td>
<td align="center">24 / 0</td>
<td align="center">0.025 / 0.001</td>
<td align="center">[0.02, 0.04] / [2.x10<sup>-5</sup>, 0.004]</td>
</tr>
</tbody>
</table>
</alternatives>
</table-wrap>
<p>The more intense inspection by two WISH experts looked at the precision of identification of the embryo outline and the extent of both the stained and pigmented regions within the embryo. The 200 tested images were randomly sampled from both the local XenMARK images and the Ciau-Uitz/Patient collection in proportion to the numbers of images in each collection. Each expert assessed the same set of images, but were instructed not to compare notes during this process. The experts were presented side-by-side with the original and marked up images and asked to give a subjective assessment of <italic>good</italic>, <italic>intermediate</italic> or <italic>bad</italic> for each of the three criteria: embryo outline, stained region and pigmented region. For subsequent analysis these assessments were converted to scores of 1.0, 0.5 and 0.0 respectively. These data are presented in <xref ref-type="table" rid="pcbi.1006077.t002">Table 2</xref>.</p>
<table-wrap id="pcbi.1006077.t002" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1006077.t002</object-id>
<label>Table 2</label> <caption><title>Validation of the algorithm output.</title> <p>Two WISH experts marked each of 200 processed images as <italic>good</italic>, <italic>intermediate</italic> or <italic>bad</italic> (1.0, 0.5 or 0.0) on three potentially subjective qualities: whether the embryo outline had been captured correctly, whether the stained regions were delineated correctly, and whether the pigmented regions were delineated correctly. For each quality we correlated the experts’ scores over all 200 images.</p></caption>
<alternatives>
<graphic id="pcbi.1006077.t002g" mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1006077.t002" xlink:type="simple"/>
<table>
<colgroup>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
</colgroup>
<thead>
<tr>
<th align="left" rowspan="2"/>
<th align="center" rowspan="2"><break/>Correlation</th>
<th align="center" colspan="2">average score</th>
<th align="center" colspan="2">good</th>
<th align="center" colspan="2">good + intermediate</th>
</tr>
<tr>
<th align="center">Expert 1</th>
<th align="center">Expert 2</th>
<th align="center">Expert 1</th>
<th align="center">Expert 2</th>
<th align="center">Expert 1</th>
<th align="center">Expert 2</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Outline</td>
<td align="center">0.71</td>
<td align="center">0. 8375</td>
<td align="center">0. 805</td>
<td align="center">79.5%</td>
<td align="center">71%</td>
<td align="center">88%</td>
<td align="center">90%</td>
</tr>
<tr>
<td align="left">Expression pattern</td>
<td align="center">0.53</td>
<td align="center">0. 8275</td>
<td align="center">0. 6325</td>
<td align="center">70.5%</td>
<td align="center">36.5%</td>
<td align="center">95%</td>
<td align="center">90%</td>
</tr>
<tr>
<td align="left">Pigment</td>
<td align="center">0.62</td>
<td align="center">0. 765</td>
<td align="center">0. 535</td>
<td align="center">68.5%</td>
<td align="center">50.0%</td>
<td align="center">84.5%</td>
<td align="center">57%</td>
</tr>
</tbody>
</table>
</alternatives>
</table-wrap>
<p>Overall the results were encouraging, with both experts rating the algorithm for outline detection and expression domain extent (stained region) as close to or better than 90% in the good or intermediate categories. However it is quite notable that the correlation between the experts’ individual converted numerical scores was only a little over 0.5 for stained regions and 0.6 for pigmented regions. The underlying cause of this apparent discrepancy is likely in the different interpretation of the terms <italic>good</italic> and <italic>intermediate</italic> between the two experts, with Expert 1 being consistently more generous at the intermediate/good boundary then Expert 2. These results underscore the general problem in converting the variable intensity of the stained region into a computationally tractable expression pattern. We address this problem in part by providing a two-tone scale for mark up <italic>in situ</italic> stained regions. The pigmented region generally scored worse than the other criteria, although this is obviously of lower concern. We suspect, but have not shown in detail, that the dissimilarities in scores by the experts were attributed to their different assessment of the impact of artefacts caused by imaging conditions on the extracted pigment patterns. One of the more obvious artefacts affecting annotated stain pattern occurred in images where the embryo was illuminated from one side. In these cases the algorithm tended to interpret darker areas caused by shadow as more intensely stained.</p>
</sec>
<sec id="sec007">
<title>Application of the image analysis algorithms to a large image collection</title>
<p>To test the effectiveness of the algorithms, and to give us the opportunity to produce coherent sets of time dependent gene expression images, we applied them to a highly redundant image collection comprised 33,289 individual <italic>in situ</italic> images of <italic>Xenopus laevis</italic> embryos. These represented expression of 548 genes over the classical Nieuwkoop &amp; Faber developmental stages [<xref ref-type="bibr" rid="pcbi.1006077.ref013">13</xref>], mostly between NF stage 6 (32-cell stage) and NF stage 50 (late tadpole stage), with an approximate 10-fold redundancy at each genes and development stage. We refer to this image set in the text as the Ciau-Uitz/Patient collection after its originators (AC-U and RP). This collection has been described previously [<xref ref-type="bibr" rid="pcbi.1006077.ref014">14</xref>], as have the methods by which they were produced[<xref ref-type="bibr" rid="pcbi.1006077.ref015">15</xref>]. The images from this collection used to illustrate our method have not been previously published.</p>
<p>The collection had been pre-screened by one of the originators (AC-U) to retain only images of stages with clearly detectable gene expression, and in total the collection contains 2781 gene/stage groups. Embryos had been imaged either directly after histological staining, or after additional treatment with a clearing agent. In general, both types of preparation were available for each gene and stage. Un-cleared embryos had been imaged against an orange/red background, and cleared embryos against a grey background. All images were whole-mount, and although the majority of the images included the whole embryo, almost a third of the images contained close-ups of specific regions of the embryo. Images generally had associated meta-data, notably the gene name or probe/sequence ID and the developmental stage, all embedded in the name of the image file. Nearly all the Stage 22 and later images were lateral views; early stages included mixture of views. See <xref ref-type="fig" rid="pcbi.1006077.g003">Fig 3</xref> for a visual depiction of the problem and its resolution.</p>
<fig id="pcbi.1006077.g003" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1006077.g003</object-id>
<label>Fig 3</label>
<caption>
<title>Rational selection of representative images to reduce redundancy.</title>
<p>Unsorted images from a large collection for a given gene/development stage are first classified into cleared (grey background) and un-cleared (orange/red background) images. Embryo boundaries were detected within the image and embryo pixel colours analysed to yield predicted <italic>in situ</italic> stain, pigmentation or unmarked embryo. Embryos with predicted outline touching the image border were excluded (unless the outline in all images in the group touched the border). Images were sorted within groups by stain content for selection, and cropped for display where needed. (A) Lateral view images, NF stage 20+. (B) Quasi-spherical development stages (up to NF stage 20): images are clustered according to expression pattern similarity under rotational and other transformations (see also <xref ref-type="fig" rid="pcbi.1006077.g004">Fig 4</xref>), and the most stained image is selected from each well-separated group.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1006077.g003" xlink:type="simple"/>
</fig>
<p>Our aim was to reduce redundancy in this collection by extracting single representative whole-embryo images for each gene in the collection at each developmental stage, and for the cleared and uncleared embryos. In addition, for the earlier quasi-spherical embryonic stages, we also wished to select images to represent the different anatomical views of the embryo and expression patterns.</p>
<p>To achieve these ends we needed two additional algorithms: the first of these simply classifies the images into cleared and un-cleared on the basis of their statistical distributions of pixel colours, whilst the second uses image similarity clustering to identify different views of the spherical stage embryos using the previously detected <italic>in situ</italic> stain patterns. These algorithms are described in outline here, and more detail is given in Methods §4 and §5.</p>
</sec>
<sec id="sec008">
<title>Images classification to separate cleared and uncleared images</title>
<p>This algorithm classified the Ciau-Uitz/Patient images into two groups, those with un-cleared and those with cleared embryos. These had been consistently photographed against an orange/red background or a grey background respectively. This knowledge was used to sort the images on the basis of the statistical properties of the distribution of pixel colour in LAB space within each image, using a Gaussian mixture approach. See <xref ref-type="sec" rid="sec014">Methods</xref> §4 for details.</p>
<p>We found 18,254 un-cleared images, 15,034 cleared images, and 1 image was rejected as un-classified. Classification was important (a) to allow selection of both cleared and un-cleared images for each gene/stage where both were present, and (b) to allow a mixture of either two (un-cleared) or three (cleared) Gaussian distributions for the embryo/background analysis.</p>
</sec>
<sec id="sec009">
<title>Images clustering on expression pattern</title>
<p>The algorithm assesses similarity between expression patterns, and clusters images into groups, ideally representing different orientations of spherical embryos when photographed from different angles. Image comparison is performed after discovery of the embryo boundary and mark up of stain regions: within a group of same (spherical) stage images, each image is compared to all others by finding the combination of relative shift, rotation, scaling and shearing that maximises the overlap of stained regions. The minimum discrepancy achieved between two images is used as a <italic>dissimilarity</italic> metric, and pair-wise dissimilarities are used to perform clustering, of which the sub-groups represent the diversity of views of the expression pattern (Methods §5 and <xref ref-type="fig" rid="pcbi.1006077.g004">Fig 4</xref>). This algorithm represents a possible first step towards resolution of the image registration problem, although we take it no further in the current work.</p>
<fig id="pcbi.1006077.g004" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1006077.g004</object-id>
<label>Fig 4</label>
<caption>
<title>Simplified example of spherical stage image similarity clustering.</title>
<p>Early development stages are routinely photographed from different directions to maximise information about the expression pattern. Reference and comparison images for the same gene and stage are compared under multiple transformations (scale, rotation, shear) to identify the set of transformations that minimises their dissimilarity. Here we see that a 91.5<sup>o</sup> rotation and a 1.01 scaling suggest the most likely transformation between these two images. All images from the same gene and stage are compared with each other to identify images from (probably) the same view-point. See also <xref ref-type="fig" rid="pcbi.1006077.g003">Fig 3B</xref>.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1006077.g004" xlink:type="simple"/>
</fig>
</sec>
<sec id="sec010">
<title>Validation of classification and clustering</title>
<p>We tested the image classification method using the quick visual inspection described above. We used the same set of 1000 images randomly selected from the Ciau-Uitz/Patient collection, and compared the predicted classification (cleared/un-cleared) with our observations. The image classification tool made no errors. These data are presented in <xref ref-type="table" rid="pcbi.1006077.t001">Table 1</xref>.</p>
<p>In addition to this, we also assessed the expression pattern clustering performed with spherical stage embryos from the Ciau-Uitz/Patient collection. We had earlier noted that 79 image groups had embryo orientation information embedded in the image file names; this had not been used to support the computational clustering. We therefore compared the partitioning of the images by clustering to the partitioning provided by the image name annotation (see <xref ref-type="sec" rid="sec014">Methods</xref> §8), finding the sensitivity and the specificity of expression pattern clustering to annotated orientation to be 60.5% and 74% respectively. This lower sensitivity is primarily caused by non-informative expression patterns (i.e. uniform staining or absence of it) in some embryos, compounded by some imprecision between the described and likely actual viewing angles. On the other hand, the specificity value is explained by imperfect clustering of intrinsically variable expression domains and stain intensities.</p>
</sec>
<sec id="sec011">
<title>Image selection pipeline</title>
<p>The distinctive step for this analysis is to take any group of similar images and rank them according to the extent of in situ stain detected, from which a representative image can be easily selected (Methods §6 and <xref ref-type="fig" rid="pcbi.1006077.g003">Fig 3A</xref>).</p>
<p>The image selection pipeline runs as follows: (a) images are first classified as un-cleared or cleared to determine whether the initial image analysis needs to use two or three Gaussian components; (b) images are then analysed using the primary algorithms (described above) for embryo outline and <italic>in situ</italic> stain, recording whether the embryo touched the image frame or not, the position of the embryo outline and its bounding box, and the location and overall amount of <italic>in situ</italic> stain; (c) images are sorted into groups according to gene and developmental stage information; (d) images of spherical stages embryos are further grouped by anatomical viewpoint by clustering on the <italic>in situ</italic> stain patterns; (e) images within each final group are then ranked by in situ stain content to enable selection of one representative image, in our case the one with most stain, and selecting whole embryo images ahead of partial ones; and finally (f) images where the embryo was rather small are cropped to +15% of the embryo outline bounding box for display purposes. These functions are all provided within the command line Python program ‘select_images’, included in the ‘isimage’ module described below.</p>
<p>Application of the ‘select_images’ program (based on an earlier but fully functional version of the ‘isimage’ module) to the Ciau-Uitz/Patient collection resulted in the selection of 4,852 images, suitable for immediate web display, from the original 33,289 images. This smaller set was submitted to Xenbase, and is displayed on the appropriate gene pages. This effective consolidation of the original collection would have been extremely difficult to achieve by any other method.</p>
<p>To illustrate the power of this analysis to organise this large pool of data, showing the evolution of gene expression patterns during development, we include the selected images for the developmentally important genes <italic>prdm1</italic>, <italic>ank1</italic> and <italic>hoxb3</italic> (<xref ref-type="fig" rid="pcbi.1006077.g005">Fig 5</xref>). This illustrates well the importance of separating the spherical stage images by orientation, giving a clear picture of the intricate gene expression patterns developing through gastrulation and the setting up of neural patterning. To view the non-redundant version of the Ciau-Uitz/Patient image collection go to the Expression Search page in Xenbase, enter Patient Lab in the Experimenter field and click on the Search button.</p>
<fig id="pcbi.1006077.g005" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1006077.g005</object-id>
<label>Fig 5</label>
<caption>
<title>Developmental progression of expression for selected genes <italic>prdm1</italic>, <italic>ank1</italic>, and <italic>hoxb3</italic> during <italic>Xenopus</italic> embryo development.</title>
<p>This is the result of applying our suite of image analysis tools to (in this case) the 334 original images for these three genes, and reducing them to a representative set of 65 images, including multiple views of expression patterns from the early spherical stages (pre-Stage 22).</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1006077.g005" xlink:type="simple"/>
</fig>
</sec>
<sec id="sec012">
<title>Algorithm summary and code availability</title>
<p>The two main algorithms, for embryo outline detection and stain/pigment decomposition, are the backbone of our image analysis suite and form the primary image analysis workflow described above. The image clustering algorithm was developed as a useful tool for grouping expression patters for early stage embryos, but is also a potential step towards image registration. These algorithms are implemented as parts of a Python module 'isimage’, including the program ‘analyse_image’ which provides access to the algorithms from the command line and allows expression pattern extraction to be performed on a per image basis. Code for these algorithms is made freely available on <ext-link ext-link-type="uri" xlink:href="https://pypi.python.org/pypi/isimage/" xlink:type="simple">https://pypi.python.org/pypi/isimage/</ext-link>.</p>
</sec>
</sec>
<sec id="sec013" sec-type="conclusions">
<title>Discussion</title>
<p>We have presented a general framework for analysis of whole mount <italic>in situ</italic> hybridisation images in <italic>Xenopus</italic> which is based on two specific advances. The first advance is to base segmentation around a novel method for building a statistical model of the image based on analysing colour and colour gradient in separate scales. The second advance is in the separation of <italic>in situ</italic> stain and pigment colouration using a hint based method taking in the prior (per image) determination of likely background colour in the segmentation step.</p>
<p>For the first advance, we have introduced an approach for unsupervised building of the explicit statistical model of the image background. It is based on capturing both colour and colour gradient in two scales and then using Gaussian mixture analysis to find the best separation of segments having different properties. The spatial distribution of segments is then analysed, and the background model is selected. Finally, the resulting boundary is smoothed employing re-normalised probabilities under the background model as the external force in the curvature minimizing PDE.</p>
<p>The novelty of this segmentation algorithm is in the way it utilises colour, spatial and edge information. This is in contrast to existing general purpose image analysis algorithms [<xref ref-type="bibr" rid="pcbi.1006077.ref016">16</xref>,<xref ref-type="bibr" rid="pcbi.1006077.ref017">17</xref>], which augment colours with spatial information, using edges as external constraint. Here we have jointly modelled the colour and the colour gradient, thus incorporating edge information into the GMM, whilst spatial distribution of pixels is used downstream to the GMM to classify the Gaussian mixture components. This approach was motivated by the known difficulties encountered by edge detectors in whole mount <italic>in situ</italic> images: (i) finding the correct transition between background and unstained regions at the edges of cleared and half-transparent parts of un-cleared embryos, and thus missing the correct outline[<xref ref-type="bibr" rid="pcbi.1006077.ref018">18</xref>]; and (ii) when the embryo is imaged against a feature rich background (for instance, and commonly, crushed ice), and the given approach detects spurious segments in the background[<xref ref-type="bibr" rid="pcbi.1006077.ref019">19</xref>,<xref ref-type="bibr" rid="pcbi.1006077.ref020">20</xref>].</p>
<p>Joint modelling of the colour and texture cues brings our algorithm closer to the texture classification method published by Permuter and colleagues[<xref ref-type="bibr" rid="pcbi.1006077.ref021">21</xref>,<xref ref-type="bibr" rid="pcbi.1006077.ref022">22</xref>]. This is, however, not completely suitable for <italic>in situ</italic> images because wavelets (employed in their approach) capture the texture at all scales [<xref ref-type="bibr" rid="pcbi.1006077.ref023">23</xref>], whereas in segmentation of <italic>in situ</italic> images variation smaller than a certain scale is unlikely to be significant. Thus the colour and the gradient data modelled by the GMM in our approach were captured in two consecutive layers of the Gaussian pyramid, ensuring that only significantly large texture elements are captured. Such an approach allowed us to put an upper limit on the number of Gaussian mixture components: in un-cleared images the model consisted of 2 components representing the embryo(s) and the background, and in cleared images no more than 3 components were considered, representing staining, the unstained embryo body and the background.</p>
<p>For the second advance, we have suggested a hint based method for pigment/stain separation and subtraction of the background colour, corresponding to bleed-through, from the embryo region of the image prior to analysis. The algorithm estimates the number of independent colours in a masked embryo image based on information theoretic considerations. Then, by employing FastICA algorithm and colour hints provided (primarily that stain is relatively blue-green and pigment relatively red-brown), it estimates and classifies stain and pigment colours. These hints would be configurable for application to other systems.</p>
<p>Our image analysis framework allows the determination of an object’s outline (i.e. the embryo’s outline) in an image, with minimal assumptions about background and object properties. It also allows the extraction of stain patterns from the image whilst excluding natural pigmentation from consideration. The quality of the analysis was independently checked by two WISH experts, who found it performed well. In addition, application of these tools allowed us to reduce redundancy in a set of 33,289 <italic>Xenopus</italic> embryo WISH images, resulting in 4,852 high quality representative images, making this collection amenable to display in a public resource. Analysis of the image collection, including pattern clustering where needed, took around 12 hours on 40 compute cores. The framework is published as a Python module ‘isimage’, and includes the image selection pipeline and a command line utility to extract the expression pattern from the image.</p>
<p>The significance of our approach to the initial segmentation of the image is well illustrated by its ability to find the embryo boundary in a wide range of image background colours and textures, not to mention variation in the shape, position and orientation of the embryo (seen clearly in <xref ref-type="fig" rid="pcbi.1006077.g002">Fig 2</xref>). This makes it potentially an ideal tool for retro-analysis of existing image collections, and stands in contrast to some of the earlier successes in the field which relied on controlling aspects of the image appearance such as background colour or texture compared to the embryo[<xref ref-type="bibr" rid="pcbi.1006077.ref003">3</xref>,<xref ref-type="bibr" rid="pcbi.1006077.ref005">5</xref>], effectively tuning the performance of their algorithms towards the images sets for which they were developed. We believe that our approach has great promise for the development of a more widely applicable tool set.</p>
<p>Our choice of manual validation at different steps in the image analysis pipeline was driven by a number of considerations, not the least of which was the availability of WISH experts to assess performance. In addition, we had some concerns about the potential for unconscious bias in the construction of a gold-standard reference set of manually annotated images, especially in the delineation of <italic>in situ</italic> stain regions. It is clear that notional boundaries of stained regions are often poorly defined as strong staining shades gradually into weaker and unstained regions, and that subjective judgments of these are inevitably made even by experienced annotators. This might be self-fulfilling if these image sets were constructed by ourselves, or lock the algorithm onto a particular operator bias, producing results with which other experts might not agree. The potential for different interpretation we saw clearly within our own experts and their judgment of how well the stain and pigment recognition algorithm worked. In the absence of a suitable gold standard we felt it was more effective to understand the actual performance of our algorithms, improving them iteratively by studying their behavior, and ultimately allowing other experts to assess their effectiveness. Nevertheless, we suspect there may be room for improvement, and are keen to put these codes into the public domain where others may build on our ideas.</p>
<p>A computational approach to validation was used in a recent paper describing image analysis in <italic>Drosophila</italic> [<xref ref-type="bibr" rid="pcbi.1006077.ref024">24</xref>]. They randomly sampled 200 <italic>in-situ</italic> images and tested the performance of their segmentation and registration algorithms against manually segmented and registered embryos. This may have been important, given the inclusion of the more complex registration step, and given that both segmentation and registration are (presumably) less prone to subjective variation in manual operations than <italic>in situ</italic> staining.</p>
<p>The primary weakness of the method is in the colour identification of pigmented regions of the embryo, and a tendency to be affected by brightly illuminated or shadowed sections of the embryo, which may say as much about the limitations of digital imaging under extremes of contrast. In this sense, our project has some clear pointers for optimising image generation where it is likely to be associated with subsequent computational analysis: notably avoiding bright and non-uniform illumination, and shadows. The difficulty in correctly identifying the extent of pigmented regions is less of a problem, as we are primarily interested in mapping the <italic>in situ</italic> stain; but we do believe that mapping the pigmented areas independently ensures that stain identification is more robust. In future work we will turn to the problem of registration, where we hope to be able to use models of known regional expression in combination with a refinement of our image comparison methods based on transformations of position, scale, rotation and shear to identify the likely anatomical viewpoint.</p>
</sec>
<sec id="sec014" sec-type="materials|methods">
<title>Methods</title>
<sec id="sec015">
<title>1. Toolset for <italic>in situ</italic> image analysis</title>
<p>The algorithms developed were implemented as a set of functions and classes in the programming language Python. The code is based on numpy, scipy, sklearn, OpenCV libraries and organised in Python module ‘isimage’ in a way that allows use of either the individual algorithms or the image selection pipeline as a whole. The code can be freely downloaded from <ext-link ext-link-type="uri" xlink:href="https://pypi.python.org/pypi/isimage/" xlink:type="simple">https://pypi.python.org/pypi/isimage/</ext-link>.</p>
</sec>
<sec id="sec016">
<title>2. Unsupervised image segmentation</title>
<p>For each image in the LAB colour space, a Gaussian pyramid [<xref ref-type="bibr" rid="pcbi.1006077.ref025">25</xref>] is constructed <inline-formula id="pcbi.1006077.e001"><alternatives><graphic id="pcbi.1006077.e001g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006077.e001" xlink:type="simple"/><mml:math display="inline" id="M1"><mml:msubsup><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>}</mml:mo></mml:mrow><mml:mrow><mml:mi>k</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msubsup></mml:math></alternatives></inline-formula>; where <italic>n</italic> is the number of layers in the pyramid and <italic>I</italic><sub><italic>k</italic></sub>:<italic>R</italic><sup>2</sup>→<italic>R</italic><sup>3</sup> is the <italic>k</italic>-th layer of the pyramid. Search for an object is performed simultaneously in two adjacent layers of the Gaussian pyramid. The largest dimension of the biggest layer used is less than 200 pixels. From each of the two layers, colour and edge information are extracted. The edge information is represented as partial derivatives <inline-formula id="pcbi.1006077.e002"><alternatives><graphic id="pcbi.1006077.e002g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006077.e002" xlink:type="simple"/><mml:math display="inline" id="M2"><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:mi>x</mml:mi></mml:mrow></mml:mfrac><mml:msub><mml:mrow><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:math></alternatives></inline-formula> and <inline-formula id="pcbi.1006077.e003"><alternatives><graphic id="pcbi.1006077.e003g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006077.e003" xlink:type="simple"/><mml:math display="inline" id="M3"><mml:mfrac><mml:mrow><mml:mo>∂</mml:mo></mml:mrow><mml:mrow><mml:mo>∂</mml:mo><mml:mi>y</mml:mi></mml:mrow></mml:mfrac><mml:msub><mml:mrow><mml:mi>I</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:math></alternatives></inline-formula> computed with the Scharr operator [<xref ref-type="bibr" rid="pcbi.1006077.ref026">26</xref>]. The data extracted from the low-resolution layer are interpolated to match the high-resolution layer dimensions, with the same Gaussian kernel used for the pyramid creation. The information from both layers is combined resulting in 18 parameters for each pixel.</p>
<p>The data is then ‘whitened’ and only informative principal components are used in the subsequent analysis. Principal components whose singular values, divided by the sum of all singular values, exceeded 10<sup>−6</sup> are considered informative.</p>
<p>To learn the borderline between the background and the foreground, the data is modelled as a mixture of Gaussian distributions. Since in un-cleared images the embryo is very distinct from the background, those images are modelled as the mixture of up to two Gaussians representing an embryo and the background. On the other hand, in cleared images the difference in colour and texture between unstained parts of embryo and the background can be subtle, compared to their difference from stained regions. In these cases, the two-component mixture will often draw the line between stained and unstained areas of the embryo thus counting unstained regions as the background. To handle this, cleared images are modelled as having up to 3 components, with an assumption that background is captured in one component and the embryo is captured in two other components. The actual number of components is determined with Bayesian information criterion[<xref ref-type="bibr" rid="pcbi.1006077.ref027">27</xref>]. The GM model was fitted using a random sampling of the image, but excluding data within three pixels of the image edges. GM fitting and component classification is repeated three times, then the most likely foreground/background decomposition is brought forward for further analysis.</p>
<p>Once the model is fitted and pixels were assigned to one of the components, there is a need to classify the components themselves as representing either the object or the background.</p>
<disp-formula id="pcbi.1006077.e004">
<alternatives>
<graphic id="pcbi.1006077.e004g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006077.e004" xlink:type="simple"/>
<mml:math display="block" id="M4">
<mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>{</mml:mo><mml:mo>(</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:mi>h</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow><mml:mo>)</mml:mo><mml:mo>;</mml:mo><mml:mspace width="0.25em"/><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>}</mml:mo></mml:mrow>
</mml:math>
</alternatives>
</disp-formula>
<p>Here <italic>X</italic><sub><italic>i</italic></sub> is the set of pixels of the image <italic>I</italic>, which is classified as belonging to a component <italic>C</italic><sub><italic>i</italic></sub>. <italic>w</italic> and <italic>h</italic> are the width and the height of the image respectively.</p>
<p>To choose the most likely classification of the components, a Bayesian model selection approach is used:
<disp-formula id="pcbi.1006077.e005">
<alternatives>
<graphic id="pcbi.1006077.e005g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006077.e005" xlink:type="simple"/>
<mml:math display="block" id="M5">
<mml:mi>P</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mo>)</mml:mo><mml:mo>∝</mml:mo><mml:mi>P</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mo>)</mml:mo><mml:mi>P</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mo>)</mml:mo>
</mml:math>
</alternatives>
</disp-formula>
<disp-formula id="pcbi.1006077.e006">
<alternatives>
<graphic id="pcbi.1006077.e006g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006077.e006" xlink:type="simple"/>
<mml:math display="block" id="M6">
<mml:mi>P</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mi>P</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo><mml:mi>P</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>≠</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo>
</mml:math>
</alternatives>
</disp-formula></p>
<p>Here <italic>M</italic> is a random variable representing a model and <italic>M</italic><sub><italic>j</italic></sub> is the model in which the j<sup>th</sup> component is believed to be the background. The prior distribution of the models was uniform.</p>
<p>Based on the assumption that the embryo resides in the middle of the picture, background pixels are modelled to be distributed uniformly across the image.</p>
<disp-formula id="pcbi.1006077.e007">
<alternatives>
<graphic id="pcbi.1006077.e007g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006077.e007" xlink:type="simple"/>
<mml:math display="block" id="M7">
<mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>∼</mml:mo><mml:mi>U</mml:mi><mml:mi>n</mml:mi><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>m</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi>w</mml:mi></mml:mrow><mml:mo>]</mml:mo><mml:mo>×</mml:mo><mml:mo>[</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mi>h</mml:mi></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>)</mml:mo>
</mml:math>
</alternatives>
</disp-formula>
<disp-formula id="pcbi.1006077.e008">
<alternatives>
<graphic id="pcbi.1006077.e008g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006077.e008" xlink:type="simple"/>
<mml:math display="block" id="M8">
<mml:mi>P</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>w</mml:mi><mml:mi>h</mml:mi></mml:mrow></mml:mfrac>
</mml:math>
</alternatives>
</disp-formula>
<p>And object pixels are modelled to be distributed normally around the centre of the image.</p>
<disp-formula id="pcbi.1006077.e009">
<alternatives>
<graphic id="pcbi.1006077.e009g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006077.e009" xlink:type="simple"/>
<mml:math display="block" id="M9">
<mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>≠</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>|</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>∼</mml:mo><mml:mi>N</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:mn mathvariant="bold">0</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">Σ</mml:mi></mml:mrow><mml:mo>)</mml:mo>
</mml:math>
</alternatives>
</disp-formula>
<disp-formula id="pcbi.1006077.e010">
<alternatives>
<graphic id="pcbi.1006077.e010g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006077.e010" xlink:type="simple"/>
<mml:math display="block" id="M10">
<mml:mi>P</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>≠</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">Ψ</mml:mi><mml:mo>,</mml:mo><mml:mi>ν</mml:mi></mml:mrow><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:mo stretchy="false">∫</mml:mo><mml:mrow><mml:mi>N</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>≠</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mrow><mml:mn mathvariant="bold">0</mml:mn><mml:mo>,</mml:mo><mml:mi mathvariant="bold-italic">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:msup><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">Σ</mml:mi></mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">Ψ</mml:mi><mml:mo>,</mml:mo><mml:mi>ν</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mi>d</mml:mi><mml:mi mathvariant="bold-italic">Σ</mml:mi><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">Ψ</mml:mi></mml:mrow><mml:mo>|</mml:mo></mml:mrow><mml:mrow><mml:mfrac><mml:mrow><mml:mi>ν</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:msup><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">Γ</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mi>ν</mml:mi><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msup><mml:msup><mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:mi mathvariant="bold-italic">Ψ</mml:mi><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>≠</mml:mo><mml:mi>j</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi><mml:mo>≠</mml:mo><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msubsup></mml:mrow><mml:mo>|</mml:mo></mml:mrow><mml:mrow><mml:mfrac><mml:mrow><mml:mi>ν</mml:mi><mml:mo>+</mml:mo><mml:msub><mml:mrow><mml:mi>n</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow></mml:msup><mml:msub><mml:mrow><mml:mi mathvariant="bold-italic">Γ</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mi>ν</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mfrac></mml:mrow></mml:mrow>
</mml:math>
</alternatives>
</disp-formula>
<p>Here <italic>N</italic>(<bold>0</bold>,<bold><italic>Σ</italic></bold>) is a two-dimensional normal distribution with zero mean and <bold><italic>Σ</italic></bold> covariance matrix. <italic>W</italic><sup>−1</sup>(<bold><italic>Ψ</italic></bold>,<italic>ν</italic>) denotes the inverse Wishart distribution, the conjugate prior to multivariate normal with known mean. The parameters of the prior distributions <bold><italic>Ψ</italic></bold> and <italic>ν</italic> were chosen to be <italic>ν</italic> = 1 and <inline-formula id="pcbi.1006077.e011"><alternatives><graphic id="pcbi.1006077.e011g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006077.e011" xlink:type="simple"/><mml:math display="inline" id="M11"><mml:mi mathvariant="bold-italic">Ψ</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mtable><mml:mtr><mml:mtd><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mtd><mml:mtd><mml:mn>0</mml:mn></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mn>0</mml:mn></mml:mtd><mml:mtd><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mfrac><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:mfrac></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mtd></mml:mtr></mml:mtable><mml:mo>]</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>. <bold><italic>Γ</italic></bold><sub>2</sub> is the multivariate gamma function. <italic>n</italic><sub><italic>j</italic></sub> is the number of pixels which belong to the foreground under the j<sup>th</sup> model.</p>
<p>If none of the models is substantially better, the component whose pixels are present the most often at the image edge is classified as the background.</p>
<p>The assumption is that the image contains only one embryo, but the foreground found above, along with the embryo outline, will have some noise in the form of a number of disconnected islands. In order to remove the noise in the foreground, a connectivity graph is created by connecting adjacent pixels belonging to the foreground. Disconnected sub-graphs of the connectivity graphs are extracted by a spectral graph theory approach[<xref ref-type="bibr" rid="pcbi.1006077.ref028">28</xref>]. The graph is recursively cut at points where the sorted elements of the eigenvector associated with zero valued eigenvalue of the Laplacian matrix of the graph exhibit the biggest jump exceeding the threshold 10<sup>−4</sup>.</p>
<p>The sub-graphs are compared based on their size and the difference of the average colour from the average colour of the background. The island having the maximum product of the square root of its size and the difference from the background is selected as the embryo outline.</p>
<disp-formula id="pcbi.1006077.e012">
<alternatives>
<graphic id="pcbi.1006077.e012g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006077.e012" xlink:type="simple"/>
<mml:math display="block" id="M12">
<mml:mi>E</mml:mi><mml:mi>m</mml:mi><mml:mi>b</mml:mi><mml:mi>r</mml:mi><mml:mi>y</mml:mi><mml:mi>o</mml:mi><mml:mspace width="0.25em"/><mml:mi>o</mml:mi><mml:mi>u</mml:mi><mml:mi>t</mml:mi><mml:mi>l</mml:mi><mml:mi>i</mml:mi><mml:mi>n</mml:mi><mml:mi>e</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mrow><mml:munder><mml:mrow><mml:mi mathvariant="normal">max</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>∈</mml:mo><mml:mi>S</mml:mi></mml:mrow></mml:munder></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msqrt><mml:mo>|</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>|</mml:mo></mml:msqrt><mml:mo>‖</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>b</mml:mi><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>‖</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow>
</mml:math>
</alternatives>
</disp-formula>
<p>Where <italic>S</italic><sub><italic>i</italic></sub> is a disconnected sub-graph of the connectivity graph <italic>S</italic>; <inline-formula id="pcbi.1006077.e013"><alternatives><graphic id="pcbi.1006077.e013g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006077.e013" xlink:type="simple"/><mml:math display="inline" id="M13"><mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:math></alternatives></inline-formula> is the average colour of pixels in sub-graph <italic>S</italic><sub><italic>i</italic></sub>; <italic>M</italic><sub><italic>bg</italic></sub> is the average colour of the background.</p>
<p>The steps of splitting the foreground into disconnected components and selecting the most outstanding island are repeated twice, with the first round taking the entire foreground into account and the second round ignoring the parts of the image that are 3 pixels away from the image edges. The outline is considered touching the image edge if the selected foreground component touches the image edge in both cases. The embryos in the image are assumed to have no holes, thus all holes inside the closed contour around the selected foreground element are filled. In case the photographed embryo extends beyond the image, it is sometimes necessary to close the embryo contour along the image edge before filling the holes. To close the embryo contour along the image edge a randomly selected quarter of pixels in the 2-pixel band around the image edge is marked as foreground and then islands containing a single pixel are reverted to the background. The process is repeated until the size of the biggest foreground element increases by less than 5% during the last iteration, but no more than 100 times.</p>
<p>The resulting outline is smoothed by minimizing local curvature of the outline contour using the geodesic active contour framework proposed in [<xref ref-type="bibr" rid="pcbi.1006077.ref029">29</xref>]. The framework assigns to a curve an energy functional, which depends on the contents of an image. To minimize the functional [<xref ref-type="bibr" rid="pcbi.1006077.ref029">29</xref>] proposes a contour evolution partial differential equation (PDE), the stationary state of which minimizes the functional. The PDE contains three members on the right hand side; first corresponding to curvature force, which minimizes local curvature; second is balloon force, which tends to expand or contract the contour; third is the image attraction force, which makes the contour reflect the contents of an image. The stationary state of the equation is found using the level set approach as suggested in [<xref ref-type="bibr" rid="pcbi.1006077.ref029">29</xref>], with zero balloon force everywhere and 8 iterations for curvature force. Since the unsmoothed contour is the collection of points where the probability of belonging to the background under GMM equals the probability of belonging to the foreground, it is natural to use the probabilities as a base for the image attraction force; the log-likelihoods of pixels are first divided by the minimum log-likelihoods for the background and foreground respectively and then summed.</p>
<disp-formula id="pcbi.1006077.e014">
<alternatives>
<graphic id="pcbi.1006077.e014g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006077.e014" xlink:type="simple"/>
<mml:math display="block" id="M14">
<mml:mi>g</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi></mml:mrow><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>g</mml:mi><mml:mi>P</mml:mi><mml:mspace width="0.25em"/><mml:mo>(</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>b</mml:mi><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:mi>G</mml:mi><mml:mi>M</mml:mi><mml:mi>M</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mrow><mml:mrow><mml:munder><mml:mrow><mml:mi mathvariant="normal">min</mml:mi></mml:mrow><mml:mrow><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi></mml:mrow></mml:munder></mml:mrow><mml:mspace width="0.25em"/><mml:mrow><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>g</mml:mi><mml:mi>P</mml:mi><mml:mspace width="0.25em"/><mml:mo>(</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>∈</mml:mo><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>b</mml:mi><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:mi>G</mml:mi><mml:mi>M</mml:mi><mml:mi>M</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mfrac><mml:mo>+</mml:mo><mml:mfrac><mml:mrow><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>g</mml:mi><mml:mi>P</mml:mi><mml:mspace width="0.25em"/><mml:mo>(</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>∉</mml:mo><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>b</mml:mi><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:mi>G</mml:mi><mml:mi>M</mml:mi><mml:mi>M</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mrow><mml:mrow><mml:munder><mml:mrow><mml:mi mathvariant="normal">min</mml:mi></mml:mrow><mml:mrow><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi></mml:mrow></mml:munder></mml:mrow><mml:mspace width="0.25em"/><mml:mrow><mml:mi>l</mml:mi><mml:mi>o</mml:mi><mml:mi>g</mml:mi><mml:mi>P</mml:mi><mml:mspace width="0.25em"/><mml:mo>(</mml:mo><mml:mrow><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi></mml:mrow><mml:mo stretchy="false">)</mml:mo><mml:mo>∉</mml:mo><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>b</mml:mi><mml:mi>g</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:mi>G</mml:mi><mml:mi>M</mml:mi><mml:mi>M</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mfrac>
</mml:math>
</alternatives>
</disp-formula>
<p>Images with the outline touching the image edge are considered to be presenting incomplete embryo, and a flag is set in the image data to record this. Next, the outline is scaled up to match the original image dimensions. The resulting contour is then contracted by the number of pixels corresponding to half the scaling factor between the original image and the smallest layer in the Gaussian pyramid that is used for the embryo search, to make the final embryo outline. A bounding box is recorded in the image data, which is the rectangle with sides parallel to the images edges that just contains the embryo outline.</p>
</sec>
<sec id="sec017">
<title>3. Stain distribution extraction</title>
<p>In the ‘select_images’ program there is a pre-processing step before stain distribution extraction, since differences in embryo illumination can affect the estimation of the stain intensity. Where appropriate, the background colour is assumed to be the same for all compared images (either cleared or un-cleared images) in a specific gene/stage group where the images are from the same collection. Thus any differences in background colour amongst those images are assumed to be caused by imaging conditions. The differences in average luminosity in all images to be compared are compensated. Then the images are processed independently.</p>
<p>An image is converted into CMY colour space. The model behind the analysis assumes that an image is “painted” with a small number of paints, with each pixel colour being a linear mixture of different amount of each paint:
<disp-formula id="pcbi.1006077.e015">
<alternatives>
<graphic id="pcbi.1006077.e015g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006077.e015" xlink:type="simple"/>
<mml:math display="block" id="M15">
<mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi>A</mml:mi><mml:msub><mml:mrow><mml:mi>s</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub>
</mml:math>
</alternatives>
</disp-formula></p>
<p>Where <italic>x</italic><sub><italic>i</italic></sub> is a CMY colour of <italic>i</italic><sup>th</sup> pixel, <italic>A</italic> = [<italic>a</italic><sub><italic>s</italic></sub>,⋯] is a matrix containing CMY values of each of the paints normalised to unit length as its columns, <italic>s</italic><sub><italic>i</italic></sub> is a vector representing amounts of each paints in the pixel.</p>
<p>One approach to find a solution to the equation is independent component analysis; here we use FastICA algorithm to find the independent components [<xref ref-type="bibr" rid="pcbi.1006077.ref030">30</xref>]. The algorithm solves the equation:
<disp-formula id="pcbi.1006077.e016">
<alternatives>
<graphic id="pcbi.1006077.e016g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006077.e016" xlink:type="simple"/>
<mml:math display="block" id="M16">
<mml:mi>K</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:mi>X</mml:mi><mml:mo>−</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mo>)</mml:mo><mml:mo>=</mml:mo><mml:mi>M</mml:mi><mml:mi>S</mml:mi>
</mml:math>
</alternatives>
</disp-formula></p>
<p>Where <italic>M</italic> is a symmetric <italic>n</italic>×<italic>n</italic> “mixing” matrix; <italic>K</italic> is a <italic>n</italic>×<italic>m</italic> whitening matrix; <italic>m</italic> is the dimensionality of the data; <italic>n</italic>≤<italic>m</italic> is a number of independent components; <italic>S</italic> is latent “source” variables.</p>
<p>Despite the speed and underlying assumptions of the FastICA algorithm aligned well with the needs of this project, the algorithm has some drawbacks. As seen from the above equation, the FastICA algorithm finds a solution up to a multiplicative constant; it rather finds independent axes in data since the signs or magnitudes of the independent components cannot be determined. Furthermore, since FastICA finds the solutions for mean-centred rather than for zero-centred data an independent axis would correspond to a spectrum of colours rather than to the single colour of the respective paint.</p>
<p>To get around these issues, prior knowledge of the expected colours of the paints is used. From the equation above, the maximum possible number of components cannot exceed the dimensionality of the data, three colour channels in our case. Thus no more than three colour components are expected: stain, pigment, and background where <italic>C</italic> = [<italic>c</italic><sub><italic>s</italic></sub>,<italic>c</italic><sub><italic>p</italic></sub>,<italic>c</italic><sub><italic>b</italic></sub>]. The background colour is estimated by averaging the colour of pixels outside the embryo outline, whilst stain and pigment colours, blue and brown respectively, were the same for all images in Ciau-Uitz/Patient collection; all expected colours are normalised to unit length.</p>
<p>Not all of the three components will always be present in an embryo image, thus there is a need to estimate the actual number of independent components. The FastICA algorithm finds the solution by choosing such entries in <italic>M</italic> that minimize the normality of the distribution of “source” variables. From that, it appears natural to estimate the number of components by maximizing the average information content per component as measured by Kullback-Leibler divergence of the empirical distribution of a “source” component from the fit Gaussian distribution.</p>
<p>If the number of components does not match the number of expected colours, some of the expected colours are assumed not present in the image and are removed from the set. At this stage the stain colour is assumed to always be present, thus if the estimated number of components is one the expected stain colour is the only one left in the set. If the estimated number of independent components is two whilst the number of expected colours is three, there is a need to identify which colour is missing. Since it is preferable to detect faint stain, whilst faint pigment can safely be ignored, the assumption at this step is that stain colour is always present and the missing colour is either background colour or pigment colour.</p>
<p>The ambiguity is resolved by maximising the linear combination of the absolute values of the determinant of the correlation matrix between the distribution of the colours in the image and the distribution of independent “sources”, and the cosine between the normals to the planes formed by the vectors left in the set and two first principal components (principal plane) of the pixel colours.</p>
<disp-formula id="pcbi.1006077.e017">
<alternatives>
<graphic id="pcbi.1006077.e017g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006077.e017" xlink:type="simple"/>
<mml:math display="block" id="M17">
<mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mrow><mml:munder><mml:mrow><mml:mi mathvariant="normal">argmax</mml:mi></mml:mrow><mml:mrow><mml:mi>C</mml:mi><mml:mo>∈</mml:mo><mml:mo>{</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>b</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>]</mml:mo><mml:mo>,</mml:mo><mml:mo>[</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>p</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:munder></mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mrow><mml:mi>d</mml:mi><mml:mi>e</mml:mi><mml:mi>t</mml:mi><mml:mo>[</mml:mo><mml:mrow><mml:mi>c</mml:mi><mml:mi>o</mml:mi><mml:mi>r</mml:mi><mml:mi>r</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:mi>T</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mi>e</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:mover accent="true"><mml:mrow><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mi>e</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mo>)</mml:mo><mml:mo>,</mml:mo><mml:msup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mo>+</mml:mo></mml:mrow></mml:msup><mml:msub><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mrow><mml:mi>e</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>]</mml:mo></mml:mrow><mml:mo stretchy="false">|</mml:mo><mml:mo>+</mml:mo><mml:mn>10</mml:mn><mml:mo stretchy="false">|</mml:mo><mml:mover accent="true"><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>×</mml:mo><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mo>∙</mml:mo><mml:mover accent="true"><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mn>0</mml:mn></mml:mrow></mml:msub><mml:mo>×</mml:mo><mml:msub><mml:mrow><mml:mi>T</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mo stretchy="false">|</mml:mo></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow>
</mml:math>
</alternatives>
</disp-formula>
<p>Where <italic>C</italic> is a matrix containing in its columns n expected colours including stain colour. <italic>X</italic><sub><italic>e</italic></sub> is colour values of pixels inside the embryo outline. <italic>T</italic> = <italic>M</italic><sup>−1</sup><italic>K</italic> is matrix of independent components. <inline-formula id="pcbi.1006077.e018"><alternatives><graphic id="pcbi.1006077.e018g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006077.e018" xlink:type="simple"/><mml:math display="inline" id="M18"><mml:mover accent="true"><mml:mrow><mml:mi>u</mml:mi><mml:mo>×</mml:mo><mml:mi>v</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> means cross-product of <italic>u</italic> and <italic>v</italic> normalized to unit length.</p>
<p>If the resulting set of expected colours includes the pigment colour, the stain and pigment colours are adjusted. The adjustment is done by rotating vectors representing the colours in the CMY colour space around their mean by an angle ranging from -15 to +15 degrees in order to make the plane formed by the vectors as parallel as possible to the principal plane of the pixel colours.</p>
<p>Using both independent axes and expected colours, it is possible to estimate the components of <italic>A</italic>. The estimation is done in two steps: first, the proposed components of <italic>A</italic> are computed from the data and independent axes; second, the proposed components are compared to expected colours; the set of proposed components closest to the expected colours are accepted.</p>
<p>The computation of the proposed components is based on the assumption that the components of <italic>A</italic> should be as far as possible from the average colour. Thus, after picking an independent axis and choosing a direction from the mean, the proposed component then equals the normalised to unit length point on the independent axis where the projection of image pixels close to the axis in colour space is maximal. To increase robustness of the method to the colour imprecisions, only pixels sufficiently distant from white colour are used.</p>
<disp-formula id="pcbi.1006077.e019">
<alternatives>
<graphic id="pcbi.1006077.e019g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006077.e019" xlink:type="simple"/>
<mml:math display="block" id="M19">
<mml:msubsup><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mrow><mml:mrow><mml:munder><mml:mrow><mml:mi mathvariant="normal">argmax</mml:mi></mml:mrow><mml:mrow><mml:mi>x</mml:mi><mml:mo>∈</mml:mo><mml:mi>X</mml:mi><mml:mo>;</mml:mo><mml:mo>‖</mml:mo><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>‖</mml:mo><mml:mo>≥</mml:mo><mml:msub><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mi mathvariant="italic">min</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:munder></mml:mrow><mml:mrow><mml:mo>{</mml:mo><mml:mrow><mml:mo>‖</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>−</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>∥</mml:mo><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mover accent="true"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow></mml:msub></mml:mrow><mml:mo>‖</mml:mo><mml:mo>∙</mml:mo><mml:msup><mml:mrow><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mo>‖</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi>x</mml:mi><mml:mo>−</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi>X</mml:mi></mml:mrow><mml:mo>¯</mml:mo></mml:mover></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>⊥</mml:mo><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mover accent="true"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow></mml:msub></mml:mrow><mml:mo>‖</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mn>2</mml:mn><mml:mo>∙</mml:mo><mml:msup><mml:mrow><mml:msub><mml:mrow><mml:mi>d</mml:mi></mml:mrow><mml:mrow><mml:mi>m</mml:mi><mml:mi>a</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:mfrac></mml:mrow></mml:msup></mml:mrow><mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mo>∥</mml:mo><mml:msub><mml:mrow><mml:mi>z</mml:mi></mml:mrow><mml:mrow><mml:mi>l</mml:mi></mml:mrow></mml:msub><mml:mover accent="true"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mo>*</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:mrow></mml:msub>
</mml:math>
</alternatives>
</disp-formula>
<p>Where <italic>x</italic> is the colour of a j<sup>th</sup> pixel inside embryo outline, ‖<italic>x</italic>‖&gt;<italic>l</italic><sub><italic>min</italic></sub>, it is set to 0.15; <inline-formula id="pcbi.1006077.e020"><alternatives><graphic id="pcbi.1006077.e020g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006077.e020" xlink:type="simple"/><mml:math display="inline" id="M20"><mml:mover accent="true"><mml:mrow><mml:msubsup><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>*</mml:mi></mml:mrow></mml:msubsup></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> is the k<sup>th</sup> column of <italic>M</italic>* = <italic>K</italic><sup>+</sup><italic>M</italic> normalised to unit length; <italic>z</italic><sub><italic>l</italic></sub>∈{1,−1} is a direction with respect to <inline-formula id="pcbi.1006077.e021"><alternatives><graphic id="pcbi.1006077.e021g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006077.e021" xlink:type="simple"/><mml:math display="inline" id="M21"><mml:msubsup><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mi>k</mml:mi></mml:mrow><mml:mrow><mml:mi>*</mml:mi></mml:mrow></mml:msubsup></mml:math></alternatives></inline-formula>. Subscript notation <italic>x</italic><sub>∥<italic>v</italic></sub> means the parallel and <italic>x</italic><sub>⊥<italic>v</italic></sub> the orthogonal component of <italic>x</italic> with respect to <italic>v</italic> such that <italic>x</italic> = <italic>x</italic><sub>∥<italic>v</italic></sub>+<italic>x</italic><sub>⊥<italic>v</italic></sub>; <italic>d</italic><sub><italic>max</italic></sub> controls the effective distance of the pixel colours from the independent axis, and is set to 0.05.</p>
<p>The best set of proposed components is found by minimizing the weighted average distance between proposed components and the expected colours multiplied by the specificity of the match.</p>
<disp-formula id="pcbi.1006077.e022">
<alternatives>
<graphic id="pcbi.1006077.e022g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006077.e022" xlink:type="simple"/>
<mml:math display="block" id="M22">
<mml:mrow><mml:mrow><mml:mover accent="true"><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mo>=</mml:mo><mml:munder><mml:mrow><mml:mi mathvariant="normal">argmin</mml:mi></mml:mrow><mml:mrow><mml:msup><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:munder></mml:mrow><mml:mrow><mml:mrow><mml:mstyle displaystyle="true"><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:munderover></mml:mstyle><mml:mrow><mml:msub><mml:mrow><mml:mi>w</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mfrac><mml:mrow><mml:msup><mml:mrow><mml:mo>‖</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msubsup><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo>‖</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mrow><mml:mrow><mml:msub><mml:mo stretchy="false">∑</mml:mo><mml:mrow><mml:mi>j</mml:mi><mml:mo>≠</mml:mo><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mrow><mml:mo>‖</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>c</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>−</mml:mo><mml:msubsup><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>j</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:mrow><mml:mo>‖</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mfrac></mml:mrow></mml:mrow></mml:mrow></mml:mrow>
</mml:math>
</alternatives>
</disp-formula>
<p>Where <italic>A</italic>′ is the proposed components matrix; <italic>n</italic> is the estimated number of independent components; <inline-formula id="pcbi.1006077.e023"><alternatives><graphic id="pcbi.1006077.e023g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006077.e023" xlink:type="simple"/><mml:math display="inline" id="M23"><mml:msubsup><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mo>′</mml:mo></mml:mrow></mml:msubsup></mml:math></alternatives></inline-formula> is the i-th column of <italic>A</italic>′; <italic>c</italic><sub><italic>i</italic></sub> is the i-th column of <italic>C</italic><sub><italic>e</italic></sub>; <italic>w</italic><sub><italic>i</italic></sub> is a weight associated with each expected colour, the weights reflected a prior confidence in that colour: <italic>w</italic><sub><italic>s</italic></sub> = 0.5,<italic>w</italic><sub><italic>p</italic></sub> = 0.05,<italic>w</italic><sub><italic>b</italic></sub> = 1. Since the background colour is computed from the image it has the highest confidence. There is less confidence in prior knowledge of the stain colour since it can vary due to imaging conditions, and choice of stain reagents. The argument behind the much smaller confidence level for pigment colour is two-fold; firstly, the colour can vary due to biological differences or imaging conditions. Secondly, the model used here assumes linear colour mixing whereas the imaging condition can produce saturation effects and hence non-linear colour mixing in lighter or darker parts of images, the number of independent components can be overestimated with the superfluous components being far from any of expected. The low weight for the pigment allows that false component to be associated with the pigment in case saturation occurs in the lighter part of the spectrum. In case the pigment component is associated with saturated stain, the estimation of <italic>A</italic> is done assuming no pigment component is present.</p>
<p>The estimated stain colour <inline-formula id="pcbi.1006077.e024"><alternatives><graphic id="pcbi.1006077.e024g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006077.e024" xlink:type="simple"/><mml:math display="inline" id="M24"><mml:mover accent="true"><mml:mrow><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> is considered confidently estimated if the relative positive contribution of expected stain colour in <inline-formula id="pcbi.1006077.e025"><alternatives><graphic id="pcbi.1006077.e025g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006077.e025" xlink:type="simple"/><mml:math display="inline" id="M25"><mml:mover accent="true"><mml:mrow><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>^</mml:mo></mml:mover></mml:math></alternatives></inline-formula> is over 5%.</p>
<disp-formula id="pcbi.1006077.e026">
<alternatives>
<graphic id="pcbi.1006077.e026g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006077.e026" xlink:type="simple"/>
<mml:math display="block" id="M26">
<mml:mfrac><mml:mrow><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">x</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mrow><mml:msubsup><mml:mo stretchy="false">∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mi>n</mml:mi></mml:mrow></mml:msubsup><mml:mrow><mml:mi mathvariant="normal">m</mml:mi><mml:mi mathvariant="normal">a</mml:mi><mml:mi mathvariant="normal">x</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:mn>0</mml:mn><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:msub><mml:mrow><mml:mi>q</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow></mml:mfrac><mml:mo>&gt;</mml:mo><mml:mn>0.05</mml:mn><mml:mo>;</mml:mo><mml:mi>w</mml:mi><mml:mi>h</mml:mi><mml:mi>e</mml:mi><mml:mi>r</mml:mi><mml:mi>e</mml:mi><mml:mspace width="0.25em"/><mml:mi>q</mml:mi><mml:mo>=</mml:mo><mml:msubsup><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>e</mml:mi></mml:mrow><mml:mrow><mml:mo>+</mml:mo></mml:mrow></mml:msubsup><mml:mover accent="true"><mml:mrow><mml:msub><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mi>s</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>^</mml:mo></mml:mover>
</mml:math>
</alternatives>
</disp-formula>
<p>The spatial stain distribution is found by solving the equation <inline-formula id="pcbi.1006077.e027"><alternatives><graphic id="pcbi.1006077.e027g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006077.e027" xlink:type="simple"/><mml:math display="inline" id="M27"><mml:mi>X</mml:mi><mml:mo>=</mml:mo><mml:mover accent="true"><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mo>^</mml:mo></mml:mover><mml:mi>S</mml:mi></mml:math></alternatives></inline-formula> for all image pixels and taking the first “source” components.</p>
<p>‘Adaptive thresholding’ is applied to the stain distribution to make sure that only significant staining is taken into account. This is done by modelling the stain distribution inside the embryo outline as a mixture of two Gaussian distributions, one of which would represent ‘noise’ and the other would be considered the ‘signal’. The noise is filtered out by selecting a threshold so that 95% of noise is under the threshold. The threshold is range limited by the interval [0.25, 0.67] because values of staining/pigmentation below 0.25 level would be too close to white to be significant; on the other hand staining/pigmentation above 0.67 would be significant anyway, even if doesn’t form a pattern.</p>
<disp-formula id="pcbi.1006077.e028">
<alternatives>
<graphic id="pcbi.1006077.e028g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006077.e028" xlink:type="simple"/>
<mml:math display="block" id="M28">
<mml:mi>S</mml:mi><mml:mo>∼</mml:mo><mml:mrow><mml:mstyle displaystyle="true"><mml:munderover><mml:mo>∑</mml:mo><mml:mrow><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:munderover></mml:mstyle><mml:mrow><mml:msub><mml:mrow><mml:mi>π</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mi>N</mml:mi><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow>
</mml:math>
</alternatives>
</disp-formula>
<disp-formula id="pcbi.1006077.e029">
<alternatives>
<graphic id="pcbi.1006077.e029g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006077.e029" xlink:type="simple"/>
<mml:math display="block" id="M29">
<mml:mi>t</mml:mi><mml:mo>=</mml:mo><mml:mrow><mml:mrow><mml:mi mathvariant="normal">min</mml:mi></mml:mrow><mml:mspace width="0.25em"/><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>0.67</mml:mn><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mrow><mml:mrow><mml:mi mathvariant="normal">max</mml:mi></mml:mrow><mml:mspace width="0.25em"/><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mn>0.25</mml:mn><mml:mo>,</mml:mo><mml:mspace width="0.25em"/><mml:mrow><mml:mrow><mml:munder><mml:mrow><mml:mi mathvariant="normal">min</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:munder></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>μ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>+</mml:mo><mml:mn>2</mml:mn><mml:msub><mml:mrow><mml:mi>σ</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mrow><mml:mo>)</mml:mo></mml:mrow></mml:mrow>
</mml:math>
</alternatives>
</disp-formula>
<p>Where <italic>S</italic> is the random variable representing staining; t is the threshold.</p>
<p>If the background colour has non-zero projection on the stain colour it results in the “background” noise. To remove the noise from the spatial stain pattern without creating sharp artefacts, a smooth mask is created from the embryo outline as follows. Mean and standard deviation of stain amount in the area outside the embryo outline are computed. The mean amount of stain inside morphological gradient of the embryo outline is computed and recorded. The embryo outline is eroded for one round. These two operations are repeated several times, or until the mean of the stain in the gradient band exceeds the mean plus two standard deviations of the stain in the background. Then a smooth mask is created with a sigmoid profile with the inflexion point located at the distance from the embryo outline where the mean amount of stain in the corresponding gradient band is at the minimum, or if a minimum is not reached, at half way to the maximum of the mean amount of stain.</p>
</sec>
<sec id="sec018">
<title>4. Classifying images as cleared or un-cleared</title>
<p>In the Ciau-Uitz/Patient collection of 33,289 images, un-cleared images had orange/red backgrounds and cleared images had grey backgrounds. They were sorted into groups according to the colour distribution of pixels within each image. Initially, images were converted into LAB colour space, and pixel values accessed via standard library functions.</p>
<p>To capture the colour distribution of pixels in an image, means <italic>M</italic><sub><italic>i</italic></sub> and covariance matrices <italic>C</italic><sub><italic>i</italic></sub> were computed for each image. Components of the mean vector and lower triangular parts of the Cholesky decomposition of the covariance matrices were combined to produce a data point representing colour distribution in a particular image.</p>
<disp-formula id="pcbi.1006077.e030">
<alternatives>
<graphic id="pcbi.1006077.e030g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006077.e030" xlink:type="simple"/>
<mml:math display="block" id="M30">
<mml:msub><mml:mrow><mml:mi>M</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi mathvariant="normal">〈</mml:mi><mml:mrow><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mn>3</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mi mathvariant="normal">〉</mml:mi>
</mml:math>
</alternatives>
</disp-formula>
<disp-formula id="pcbi.1006077.e031">
<alternatives>
<graphic id="pcbi.1006077.e031g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006077.e031" xlink:type="simple"/>
<mml:math display="block" id="M31">
<mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:msubsup><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msubsup><mml:mo>=</mml:mo><mml:msub><mml:mrow><mml:mi>C</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub>
</mml:math>
</alternatives>
</disp-formula>
<disp-formula id="pcbi.1006077.e032">
<alternatives>
<graphic id="pcbi.1006077.e032g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006077.e032" xlink:type="simple"/>
<mml:math display="block" id="M32">
<mml:msub><mml:mrow><mml:mi>L</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mrow><mml:mo>[</mml:mo><mml:mtable><mml:mtr><mml:mtd><mml:msub><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mn>11</mml:mn></mml:mrow></mml:msub></mml:mtd><mml:mtd><mml:mn>0</mml:mn></mml:mtd><mml:mtd><mml:mn>0</mml:mn></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msub><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mn>21</mml:mn></mml:mrow></mml:msub></mml:mtd><mml:mtd><mml:msub><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mn>22</mml:mn></mml:mrow></mml:msub></mml:mtd><mml:mtd><mml:mn>0</mml:mn></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:msub><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mn>31</mml:mn></mml:mrow></mml:msub></mml:mtd><mml:mtd><mml:msub><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mn>32</mml:mn></mml:mrow></mml:msub></mml:mtd><mml:mtd><mml:msub><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mn>33</mml:mn></mml:mrow></mml:msub></mml:mtd></mml:mtr></mml:mtable><mml:mo>]</mml:mo></mml:mrow>
</mml:math>
</alternatives>
</disp-formula>
<disp-formula id="pcbi.1006077.e033">
<alternatives>
<graphic id="pcbi.1006077.e033g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006077.e033" xlink:type="simple"/>
<mml:math display="block" id="M33">
<mml:msub><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mrow><mml:mi>i</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mi mathvariant="normal">〈</mml:mi><mml:mrow><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mn>1</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>m</mml:mi></mml:mrow><mml:mrow><mml:mn>3</mml:mn><mml:mo>,</mml:mo></mml:mrow></mml:msub><mml:msub><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mn>11</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mn>21</mml:mn></mml:mrow></mml:msub><mml:mo>,</mml:mo><mml:mo>…</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mrow><mml:mi>l</mml:mi></mml:mrow><mml:mrow><mml:mn>33</mml:mn></mml:mrow></mml:msub></mml:mrow><mml:mi mathvariant="normal">〉</mml:mi>
</mml:math>
</alternatives>
</disp-formula>
<p>To learn the best separation between cleared and un-cleared images, the distribution of the data was modelled as a 2–component Gaussian mixture [<xref ref-type="bibr" rid="pcbi.1006077.ref031">31</xref>]. The model was fit using the expectation maximization algorithm. As a result images were assigned to one of the two components, hence separating cleared and un-cleared images.</p>
</sec>
<sec id="sec019">
<title>5. Clustering similar views</title>
<p>Embryo images, in a particular gene/stage groups with recorded stage earlier than 22, are clustered on their expression patterns, with cleared and un-cleared images clustered separately.</p>
<p>To find the distance between images, the spatial stain distribution of each image is aligned with those of all other images in the group. Images of stain distribution are normalized by the standard deviation of the pixel intensities and down-sampled so none of their sides exceeds 100 pixels. Alignment is done by minimizing a function with the squared Euclidian distance between spatial stain distributions of the images as the external energy with respect to linear-affine transformation of one of the images[<xref ref-type="bibr" rid="pcbi.1006077.ref032">32</xref>]. The distance is penalized for scaling. Minimization is done with BFGS algorithm.</p>
<disp-formula id="pcbi.1006077.e034">
<alternatives>
<graphic id="pcbi.1006077.e034g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006077.e034" xlink:type="simple"/>
<mml:math display="block" id="M34">
<mml:mi>I</mml:mi><mml:mo>[</mml:mo><mml:mrow><mml:mi>A</mml:mi><mml:mo>,</mml:mo><mml:mi>b</mml:mi></mml:mrow><mml:mo>]</mml:mo><mml:mo>=</mml:mo><mml:mrow><mml:mo stretchy="false">∬</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mo>‖</mml:mo><mml:mrow><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>T</mml:mi></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:mrow><mml:mi>A</mml:mi><mml:mi>x</mml:mi><mml:mo>+</mml:mo><mml:mi>b</mml:mi></mml:mrow><mml:mo>)</mml:mo><mml:mo>−</mml:mo><mml:msub><mml:mrow><mml:mi>S</mml:mi></mml:mrow><mml:mrow><mml:mi>R</mml:mi></mml:mrow></mml:msub><mml:mo>(</mml:mo><mml:mrow><mml:mi>x</mml:mi></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>‖</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mo>+</mml:mo><mml:mi>α</mml:mi><mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mi mathvariant="normal">l</mml:mi><mml:mi mathvariant="normal">n</mml:mi><mml:mo stretchy="false">(</mml:mo><mml:mrow><mml:msup><mml:mrow><mml:mo>|</mml:mo><mml:mrow><mml:mi>A</mml:mi></mml:mrow><mml:mo>|</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup></mml:mrow><mml:mo stretchy="false">)</mml:mo></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mrow><mml:mn>2</mml:mn></mml:mrow></mml:msup><mml:mi>d</mml:mi><mml:mi>x</mml:mi></mml:mrow></mml:mrow>
</mml:math>
</alternatives>
</disp-formula>
<p>Where <italic>S</italic><sub><italic>i</italic></sub>(⋅) is the spatial stain distribution in an image; <italic>α</italic> is the regularization constant.</p>
<p>For each pair of images in the group, one of the images is taken as a reference and minimization is done from eight initial positions of the template image: 4 rotations by 90 degrees of original image and the same of a flipped image. Then the process is repeated with the other image taken as a reference. The minimum of the 16 minimal distance values is taken as the distance between the expression patterns.</p>
<p>All the pairwise distances taken with the minus sign formed a similarity matrix. The clustering is done by adaptive affinity propagation algorithm [<xref ref-type="bibr" rid="pcbi.1006077.ref033">33</xref>] with the number of clusters not exceeding four.</p>
</sec>
<sec id="sec020">
<title>6. Ranking images on staining</title>
<p>In general, images are ranked on the 85<sup>th</sup> percentile of the stain distribution and the image of the highest rank in the gene/stage group is selected. In case of clustered images of early embryos, the total similarity of an image in the cluster is added to 85<sup>th</sup> percentile of the stain distribution to account for how well the image represents the cluster.</p>
</sec>
<sec id="sec021">
<title>7. Computation of expected error rates and CI<sub>95</sub></title>
<p>Expected error rates and corresponding 95% confidence intervals were calculated under the Bernoulli model with uninformative Beta(1, 1) prior.</p>
</sec>
<sec id="sec022">
<title>8. Comparison of expression pattern clustering to embryo orientation annotation</title>
<p>Partition of the images by the clustering was compared to the partition by embryo orientation using Wallace pairwise agreement coefficient [<xref ref-type="bibr" rid="pcbi.1006077.ref034">34</xref>,<xref ref-type="bibr" rid="pcbi.1006077.ref035">35</xref>]. The Wallace coefficient from partition A to partition B is a ratio <inline-formula id="pcbi.1006077.e035"><alternatives><graphic id="pcbi.1006077.e035g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006077.e035" xlink:type="simple"/><mml:math display="inline" id="M35"><mml:msub><mml:mrow><mml:mi>W</mml:mi></mml:mrow><mml:mrow><mml:mi>A</mml:mi><mml:mo>→</mml:mo><mml:mi>B</mml:mi></mml:mrow></mml:msub><mml:mo>=</mml:mo><mml:mfrac><mml:mrow><mml:mi>a</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>a</mml:mi><mml:mo>+</mml:mo><mml:mi>b</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mfrac></mml:math></alternatives></inline-formula>; where <italic>a</italic> and <italic>b</italic> are entries of a mismatch matrix <inline-formula id="pcbi.1006077.e036"><alternatives><graphic id="pcbi.1006077.e036g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006077.e036" xlink:type="simple"/><mml:math display="inline" id="M36"><mml:mrow><mml:mo>[</mml:mo><mml:mtable><mml:mtr><mml:mtd><mml:mi>a</mml:mi></mml:mtd><mml:mtd><mml:mi>b</mml:mi></mml:mtd></mml:mtr><mml:mtr><mml:mtd><mml:mi>c</mml:mi></mml:mtd><mml:mtd><mml:mi>d</mml:mi></mml:mtd></mml:mtr></mml:mtable><mml:mo>]</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>, which in row 1 has the numbers of pairs in the same cluster and in row 2 the numbers in the different clusters of A, and in columns the same for the partition of B. In our case, the Wallace coefficient has the meaning of sensitivity of the clustering to embryo orientation, i.e. the proportion of pairs of images put in the same cluster that have the same embryo orientation. We augmented the clustering sensitivity by a clustering specificity coefficient <inline-formula id="pcbi.1006077.e037"><alternatives><graphic id="pcbi.1006077.e037g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006077.e037" xlink:type="simple"/><mml:math display="inline" id="M37"><mml:mfrac><mml:mrow><mml:mi>d</mml:mi></mml:mrow><mml:mrow><mml:mo>(</mml:mo><mml:mi>c</mml:mi><mml:mo>+</mml:mo><mml:mi>d</mml:mi><mml:mo>)</mml:mo></mml:mrow></mml:mfrac></mml:math></alternatives></inline-formula>.</p>
</sec>
<sec id="sec023">
<title>9. Parameter fitting</title>
<p>All algorithm parameters were tuned using manual procedure similar to cross validation, with a training image set that reflected image collection variability. The procedure consisted of recursively applying the following two steps until optimal parameter values were found. First, parameters were adjusted to allow the algorithm to perform best on a small subset of the training set containing images the algorithm performed worst at. Then the algorithm with parameter value found at the previous step was applied to the whole training set to assess the generality of the value.</p>
</sec>
</sec>
</body>
<back>
<ack>
<p>We would like to thank WISH expert colleagues from our laboratory, Drs Brook Cooper and Elena DeDomenico, for independent validation of the algorithm performance. We thank Nancy Papalopulu for permission to use one of her <italic>in situ</italic> images (<xref ref-type="fig" rid="pcbi.1006077.g002">Fig 2</xref>, image a), previously submitted to the XenMARK project. Image c in <xref ref-type="fig" rid="pcbi.1006077.g002">Fig 2</xref> was reprinted from Mechanisms of Development (77) “Gene expression screening in Xenopus identifies molecular pathways, predicts gene function and provides a global view of embryonic patterning” by Volker Gawantka, Nicolas Pollet, Hajo Delius, Martin Vingron, Ralf Pfister, Rebecca Nitsch, Claudia Blumenstock and Christof Niehrs [<xref ref-type="bibr" rid="pcbi.1006077.ref036">36</xref>], pages 95–141, Copyright 1998, with permission from Elsevier.</p>
</ack>
<ref-list>
<title>References</title>
<ref id="pcbi.1006077.ref001"><label>1</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Collart</surname> <given-names>C</given-names></name>, <name name-style="western"><surname>Owens</surname> <given-names>ND</given-names></name>, <name name-style="western"><surname>Bhaw-Rosun</surname> <given-names>L</given-names></name>, <name name-style="western"><surname>Cooper</surname> <given-names>B</given-names></name>, <name name-style="western"><surname>De Domenico</surname> <given-names>E</given-names></name>, <name name-style="western"><surname>Patrushev</surname> <given-names>I</given-names></name>, <etal>et al</etal>. <article-title>High-resolution analysis of gene activity during the Xenopus mid-blastula transition</article-title>. <source>Development (Cambridge, England)</source>. <year>2014</year> <month>may</month>; <volume>141</volume>(<issue>9</issue>): p. <fpage>1927</fpage>–<lpage>1939</lpage>.</mixed-citation></ref>
<ref id="pcbi.1006077.ref002"><label>2</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Owens</surname> <given-names>ND</given-names></name>, <name name-style="western"><surname>Blitz</surname> <given-names>IL</given-names></name>, <name name-style="western"><surname>Lane</surname> <given-names>MA</given-names></name>, <name name-style="western"><surname>Patrushev</surname> <given-names>I</given-names></name>, <name name-style="western"><surname>Overton</surname> <given-names>JD</given-names></name>, <name name-style="western"><surname>Gilchrist</surname> <given-names>MJ</given-names></name>, <etal>et al</etal>. <article-title>Measuring absolute RNA copy numbers at high temporal resolution reveals transcriptome kinetics in development</article-title>. <source>Cell reports</source>. <year>2016</year>; <volume>14</volume>(<issue>3</issue>): p. <fpage>632</fpage>–<lpage>647</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.celrep.2015.12.050" xlink:type="simple">10.1016/j.celrep.2015.12.050</ext-link></comment> <object-id pub-id-type="pmid">26774488</object-id></mixed-citation></ref>
<ref id="pcbi.1006077.ref003"><label>3</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Frise</surname> <given-names>E</given-names></name>, <name name-style="western"><surname>Hammonds</surname> <given-names>AS</given-names></name>, <name name-style="western"><surname>Celniker</surname> <given-names>SE</given-names></name>. <article-title>Systematic image-driven analysis of the spatial Drosophila embryonic expression landscape</article-title>. <source>Molecular Systems Biology</source>. <year>2010</year> <month>jan</month>; <volume>6</volume>: p. <fpage>345</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1038/msb.2009.102" xlink:type="simple">10.1038/msb.2009.102</ext-link></comment> <object-id pub-id-type="pmid">20087342</object-id></mixed-citation></ref>
<ref id="pcbi.1006077.ref004"><label>4</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Peng</surname> <given-names>H</given-names></name>, <name name-style="western"><surname>Long</surname> <given-names>F</given-names></name>, <name name-style="western"><surname>Zhou</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Leung</surname> <given-names>G</given-names></name>, <name name-style="western"><surname>Eisen</surname> <given-names>MB</given-names></name>, <name name-style="western"><surname>Myers</surname> <given-names>EW</given-names></name>. <article-title>Automatic image analysis for gene expression patterns of fly embryos</article-title>. <source>BMC cell biology</source>. <year>2007</year>; <volume>8</volume>(<issue>Suppl 1</issue>): p. <fpage>7</fpage>.</mixed-citation></ref>
<ref id="pcbi.1006077.ref005"><label>5</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Puniyani</surname> <given-names>K</given-names></name>, <name name-style="western"><surname>Faloutsos</surname> <given-names>C</given-names></name>, <name name-style="western"><surname>Xing</surname> <given-names>EP</given-names></name>. <article-title>SPEX2: automated concise extraction of spatial gene expression patterns from Fly embryo ISH images</article-title>. <source>Bioinformatics</source>. <year>2010</year>; <volume>26</volume>(<issue>12</issue>): p. <fpage>47</fpage>.</mixed-citation></ref>
<ref id="pcbi.1006077.ref006"><label>6</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Tomancak</surname> <given-names>P</given-names></name>, <name name-style="western"><surname>Berman</surname> <given-names>BP</given-names></name>, <name name-style="western"><surname>Beaton</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Weiszmann</surname> <given-names>R</given-names></name>, <name name-style="western"><surname>Kwan</surname> <given-names>E</given-names></name>, <name name-style="western"><surname>Hartenstein</surname> <given-names>V</given-names></name>, <etal>et al</etal>. <article-title>Global analysis of patterns of gene expression during Drosophila embryogenesis</article-title>. <source>Genome Biology</source>. <year>2007</year>; <volume>8</volume>(<issue>7</issue>): p. <fpage>145</fpage>.</mixed-citation></ref>
<ref id="pcbi.1006077.ref007"><label>7</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Pruteanu-Malinici</surname> <given-names>I</given-names></name>, <name name-style="western"><surname>Majoros</surname> <given-names>WH</given-names></name>, <name name-style="western"><surname>Ohler</surname> <given-names>U</given-names></name>. <article-title>Automated annotation of gene expression image sequences via non-parametric factor analysis and conditional random fields</article-title>. <source>Bioinformatics (Oxford, England)</source>. <year>2013</year> <month>jul</month>; <volume>29</volume>(<issue>13</issue>): p. <fpage>27</fpage>.</mixed-citation></ref>
<ref id="pcbi.1006077.ref008"><label>8</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Sprague</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Clements</surname> <given-names>D</given-names></name>, <name name-style="western"><surname>Conlin</surname> <given-names>T</given-names></name>, <name name-style="western"><surname>Edwards</surname> <given-names>P</given-names></name>, <name name-style="western"><surname>Frazer</surname> <given-names>K</given-names></name>, <name name-style="western"><surname>Schaper</surname> <given-names>K</given-names></name>, <etal>et al</etal>. <article-title>The Zebrafish Information Network (ZFIN): the zebrafish model organism database</article-title>. <source>Nucleic Acids Research</source>. <year>2003</year> <month>jan</month>; <volume>31</volume>(<issue>1</issue>): p. <fpage>241</fpage>–<lpage>243</lpage>. <object-id pub-id-type="pmid">12519991</object-id></mixed-citation></ref>
<ref id="pcbi.1006077.ref009"><label>9</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Gilchrist</surname> <given-names>MJ</given-names></name>, <name name-style="western"><surname>Christensen</surname> <given-names>MB</given-names></name>, <name name-style="western"><surname>Bronchain</surname> <given-names>O</given-names></name>, <name name-style="western"><surname>Brunet</surname> <given-names>F</given-names></name>, <name name-style="western"><surname>Chesneau</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Fenger</surname> <given-names>U</given-names></name>, <etal>et al</etal>. <article-title>Database of queryable gene expression patterns for Xenopus</article-title>. <source>Developmental dynamics: an official publication of the American Association of Anatomists</source>. <year>2009</year> <month>jun</month>; <volume>238</volume>(<issue>6</issue>): p. <fpage>1379</fpage>–<lpage>1388</lpage>.</mixed-citation></ref>
<ref id="pcbi.1006077.ref010"><label>10</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Segerdell</surname> <given-names>E</given-names></name>, <name name-style="western"><surname>Ponferrada</surname> <given-names>VG</given-names></name>, <name name-style="western"><surname>James-Zorn</surname> <given-names>C</given-names></name>, <name name-style="western"><surname>Burns</surname> <given-names>KA</given-names></name>, <name name-style="western"><surname>Fortriede</surname> <given-names>JD</given-names></name>, <name name-style="western"><surname>Dahdul</surname> <given-names>WM</given-names></name>, <etal>et al</etal>. <article-title>Enhanced XAO: the ontology of Xenopus anatomy and development underpins more accurate annotation of gene expression and queries on Xenbase</article-title>. <source>Journal of Biomedical Semantics</source>. <year>2013</year> <month>oct</month>; <volume>4</volume>(<issue>1</issue>): p. <fpage>31</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1186/2041-1480-4-31" xlink:type="simple">10.1186/2041-1480-4-31</ext-link></comment> <object-id pub-id-type="pmid">24139024</object-id></mixed-citation></ref>
<ref id="pcbi.1006077.ref011"><label>11</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Karimi</surname> <given-names>K</given-names></name>, <name name-style="western"><surname>Fortriede</surname> <given-names>JD</given-names></name>, <name name-style="western"><surname>Lotay</surname> <given-names>VS</given-names></name>, <name name-style="western"><surname>Burns</surname> <given-names>KA</given-names></name>, <name name-style="western"><surname>Wang</surname> <given-names>DZ</given-names></name>, <name name-style="western"><surname>Fisher</surname> <given-names>ME</given-names></name>, <etal>et al</etal>. <article-title>Xenbase: a genomic, epigenomic and transcriptomic model organism database</article-title>. <source>Nucleic Acids Res</source>. <year>2018</year> <month>January</month>; <volume>46</volume>(<issue>D1</issue>): p. <fpage>D861</fpage>–<lpage>D868</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1093/nar/gkx936" xlink:type="simple">10.1093/nar/gkx936</ext-link></comment> <object-id pub-id-type="pmid">29059324</object-id></mixed-citation></ref>
<ref id="pcbi.1006077.ref012"><label>12</label><mixed-citation publication-type="book" xlink:type="simple"><name name-style="western"><surname>James-Zorn</surname> <given-names>C</given-names></name>, <name name-style="western"><surname>Ponferrada</surname> <given-names>V</given-names></name>, <name name-style="western"><surname>Fisher</surname> <given-names>ME</given-names></name>, <name name-style="western"><surname>Burns</surname> <given-names>K</given-names></name>, <name name-style="western"><surname>Fortriede</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Segerdell</surname> <given-names>E</given-names></name>, <etal>et al</etal>. <chapter-title>Navigating Xenbase: An Integrated Xenopus Genomics and Gene Expression Database</chapter-title>. In <name name-style="western"><surname>Kollmar</surname></name>, editor. <source>Eukaryotic Genomic Databases. Methods in Molecular Biology</source>, vol <volume>1757</volume>. <publisher-loc>New York, NY</publisher-loc>: <publisher-name>Humana Press</publisher-name>; <year>2018</year>. p. <fpage>251</fpage>–<lpage>305</lpage>.</mixed-citation></ref>
<ref id="pcbi.1006077.ref013"><label>13</label><mixed-citation publication-type="other" xlink:type="simple">Nieuwkoop PD, Faber J. Normal Table of Xenopus laevis (Daudin)(Garland, New York). View in Article. 1994.</mixed-citation></ref>
<ref id="pcbi.1006077.ref014"><label>14</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Ciau-Uitz</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Pinheiro</surname> <given-names>P</given-names></name>, <name name-style="western"><surname>Kirmizitas</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Zuo</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Patient</surname> <given-names>R</given-names></name>. <article-title>VEGFA-dependent and -independent pathways synergise to drive Scl expression and initiate programming of the blood stem cell lineage in Xenopus</article-title>. <source>Development (Cambridge, England)</source>. <year>2013</year> <month>jun</month>; <volume>140</volume>(<issue>12</issue>): p. <fpage>2632</fpage>–<lpage>2642</lpage>.</mixed-citation></ref>
<ref id="pcbi.1006077.ref015"><label>15</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Walmsley</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Ciau-Uitz</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Patient</surname> <given-names>R</given-names></name>. <article-title>Tracking and programming early hematopoietic cells in Xenopus embryos</article-title>. <source>Methods in Molecular Medicine</source>. <year>2005</year>; <volume>105</volume>: p. <fpage>123</fpage>–<lpage>136</lpage>. <object-id pub-id-type="pmid">15492392</object-id></mixed-citation></ref>
<ref id="pcbi.1006077.ref016"><label>16</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Yang</surname> <given-names>X</given-names></name>, <name name-style="western"><surname>Krishnan</surname> <given-names>SM</given-names></name>. <article-title>Image segmentation using finite mixtures and spatial information</article-title>. <source>Image and Vision Computing</source>. <year>2004</year> <month>aug</month>; <volume>22</volume>(<issue>9</issue>): p. <fpage>735</fpage>–<lpage>745</lpage>.</mixed-citation></ref>
<ref id="pcbi.1006077.ref017"><label>17</label><mixed-citation publication-type="other" xlink:type="simple">Rotem O, Greenspan H, Goldberger J. Combining region and edge cues for image segmentation in a probabilistic gaussian mixture framework. In Computer Vision and Pattern Recognition, 2007. CVPR'07. IEEE Conference on; 2007: IEEE. p. 1–8.</mixed-citation></ref>
<ref id="pcbi.1006077.ref018"><label>18</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Ding</surname> <given-names>L</given-names></name>, <name name-style="western"><surname>Goshtasby</surname> <given-names>A</given-names></name>. <article-title>On the Canny edge detector</article-title>. <source>Pattern Recognition</source>. <year>2001</year>; <volume>34</volume>(<issue>3</issue>): p. <fpage>721</fpage>–<lpage>725</lpage>.</mixed-citation></ref>
<ref id="pcbi.1006077.ref019"><label>19</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Martin</surname> <given-names>DR</given-names></name>, <name name-style="western"><surname>Fowlkes</surname> <given-names>CC</given-names></name>, <name name-style="western"><surname>Malik</surname> <given-names>J</given-names></name>. <article-title>Learning to detect natural image boundaries using local brightness, color, and texture cues</article-title>. <source>IEEE transactions on pattern analysis and machine intelligence</source>. <year>2004</year>; <volume>26</volume>(<issue>5</issue>): p. <fpage>530</fpage>–<lpage>549</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1109/TPAMI.2004.1273918" xlink:type="simple">10.1109/TPAMI.2004.1273918</ext-link></comment> <object-id pub-id-type="pmid">15460277</object-id></mixed-citation></ref>
<ref id="pcbi.1006077.ref020"><label>20</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Zhang</surname> <given-names>H</given-names></name>, <name name-style="western"><surname>Fritts</surname> <given-names>JE</given-names></name>, <name name-style="western"><surname>Goldman</surname> <given-names>SA</given-names></name>. <article-title>Image segmentation evaluation: A survey of unsupervised methods</article-title>. <source>computer vision and image understanding</source>. <year>2008</year>; <volume>110</volume>(<issue>2</issue>): p. <fpage>260</fpage>–<lpage>280</lpage>.</mixed-citation></ref>
<ref id="pcbi.1006077.ref021"><label>21</label><mixed-citation publication-type="other" xlink:type="simple">Permuter H, Francos J, others. Gaussian mixture models of texture and colour for image database retrieval. In Acoustics, Speech, and Signal Processing, 2003. ConferenceProceedings.(ICASSP'03). 2003 IEEE International Conference on; 2003: IEEE. p. 569.</mixed-citation></ref>
<ref id="pcbi.1006077.ref022"><label>22</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Permuter</surname> <given-names>H</given-names></name>, <name name-style="western"><surname>Francos</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Jermyn</surname> <given-names>I</given-names></name>. <article-title>A study of Gaussian mixture models of color and texture features for image classification and segmentation</article-title>. <source>Pattern Recognition</source>. <year>2006</year>; <volume>39</volume>(<issue>4</issue>): p. <fpage>695</fpage>–<lpage>706</lpage>.</mixed-citation></ref>
<ref id="pcbi.1006077.ref023"><label>23</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Unser</surname> <given-names>M</given-names></name>. <article-title>Texture classification and segmentation using wavelet frames</article-title>. <source>IEEE Transactions on image processing</source>. <year>1995</year>; <volume>4</volume>(<issue>11</issue>): p. <fpage>1549</fpage>–<lpage>1560</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1109/83.469936" xlink:type="simple">10.1109/83.469936</ext-link></comment> <object-id pub-id-type="pmid">18291987</object-id></mixed-citation></ref>
<ref id="pcbi.1006077.ref024"><label>24</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Mace</surname> <given-names>DL</given-names></name>, <name name-style="western"><surname>Varnado</surname> <given-names>N</given-names></name>, <name name-style="western"><surname>Zhang</surname> <given-names>W</given-names></name>, <name name-style="western"><surname>Frise</surname> <given-names>E</given-names></name>, <name name-style="western"><surname>Ohler</surname> <given-names>U</given-names></name>. <article-title>Extraction and comparison of gene expression patterns from 2D RNA in situ hybridization images</article-title>. <source>Bioinformatics</source>. <year>2010</year> <month>mar</month>; <volume>26</volume>(<issue>6</issue>): p. <fpage>761</fpage>–<lpage>769</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1093/bioinformatics/btp658" xlink:type="simple">10.1093/bioinformatics/btp658</ext-link></comment> <object-id pub-id-type="pmid">19942587</object-id></mixed-citation></ref>
<ref id="pcbi.1006077.ref025"><label>25</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Burt</surname> <given-names>PJ</given-names></name>, <name name-style="western"><surname>Adelson</surname> <given-names>EH</given-names></name>. <article-title>The Laplacian Pyramid as a Compact Image Code</article-title>. <source>IEEE Transactions on Communications</source>. <year>1983</year> <month>apr</month>; <volume>31</volume>(<issue>4</issue>): p. <fpage>532</fpage>–<lpage>540</lpage>.</mixed-citation></ref>
<ref id="pcbi.1006077.ref026"><label>26</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Jahne</surname> <given-names>B</given-names></name>, <name name-style="western"><surname>Scharr</surname> <given-names>H</given-names></name>, <name name-style="western"><surname>Korkel</surname> <given-names>S</given-names></name>. <article-title>Principles of filter design</article-title>. <source>Handbook of computer vision and applications</source>. <year>1999</year>; <volume>2</volume>: p. <fpage>125</fpage>–<lpage>151</lpage>.</mixed-citation></ref>
<ref id="pcbi.1006077.ref027"><label>27</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Schwarz</surname> <given-names>G</given-names></name>, <article-title>others. Estimating the dimension of a model</article-title>. <source>The annals of statistics</source>. <year>1978</year>; <volume>6</volume>(<issue>2</issue>): p. <fpage>461</fpage>–<lpage>464</lpage>.</mixed-citation></ref>
<ref id="pcbi.1006077.ref028"><label>28</label><mixed-citation publication-type="other" xlink:type="simple">CH, He X, Zha H. A spectral method to separate disconnected and nearly-disconnected web graph components. In ConferenceProceedings of the seventh ACM SIGKDD international conference on Knowledge discovery and data mining; 2001: ACM. p. 275–280.</mixed-citation></ref>
<ref id="pcbi.1006077.ref029"><label>29</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Marquez-Neila</surname> <given-names>P</given-names></name>, <name name-style="western"><surname>Baumela</surname> <given-names>L</given-names></name>, <name name-style="western"><surname>Alvarez</surname> <given-names>L</given-names></name>. <article-title>A morphological approach to curvature-based evolution of curves and surfaces</article-title>. <source>Pattern Analysis and Machine Intelligence, IEEE Transactions on</source>. <year>2014</year>; <volume>36</volume>(<issue>1</issue>): p. <fpage>2</fpage>–<lpage>17</lpage>.</mixed-citation></ref>
<ref id="pcbi.1006077.ref030"><label>30</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Hyvarinen</surname> <given-names>A</given-names></name>. <article-title>Fast and robust fixed-point algorithms for independent component analysis</article-title>. <source>Neural Networks, IEEE Transactions on</source>. <year>1999</year>; <volume>10</volume>(<issue>3</issue>): p. <fpage>626</fpage>–<lpage>634</lpage>.</mixed-citation></ref>
<ref id="pcbi.1006077.ref031"><label>31</label><mixed-citation publication-type="other" xlink:type="simple">McLachlan G, Peel D. Finite Mixture Models Shewhart WA, Wilks SS, editors.; 2000.</mixed-citation></ref>
<ref id="pcbi.1006077.ref032"><label>32</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Droske</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Rumpf</surname> <given-names>M</given-names></name>. <article-title>A variational approach to nonrigid morphological image registration</article-title>. <source>SIAM Journal on Applied Mathematics</source>. <year>2004</year>; <volume>64</volume>(<issue>2</issue>): p. <fpage>668</fpage>–<lpage>687</lpage>.</mixed-citation></ref>
<ref id="pcbi.1006077.ref033"><label>33</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Wang</surname> <given-names>K</given-names></name>, <name name-style="western"><surname>Zhang</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Li</surname> <given-names>D</given-names></name>, <name name-style="western"><surname>Zhang</surname> <given-names>X</given-names></name>, <name name-style="western"><surname>Guo</surname> <given-names>T</given-names></name>. <article-title>Adaptive Affinity Propagation Clustering</article-title>. <source>Acta Automatica Sinica</source>. <year>2007</year>; <volume>33</volume>(<issue>12</issue>): p. <fpage>1242</fpage>–<lpage>1246</lpage>.</mixed-citation></ref>
<ref id="pcbi.1006077.ref034"><label>34</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Carrico</surname> <given-names>JA</given-names></name>, <name name-style="western"><surname>Silva-Costa</surname> <given-names>C</given-names></name>, <name name-style="western"><surname>Melo-Cristino</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Pinto</surname> <given-names>FR</given-names></name>, <name name-style="western"><surname>Lencastre</surname> <given-names>Hd</given-names></name>, <name name-style="western"><surname>Almeida</surname> <given-names>JS</given-names></name>, <etal>et al</etal>. <article-title>Illustration of a Common Framework for Relating Multiple Typing Methods by Application to Macrolide-Resistant Streptococcus pyogenes</article-title>. <source>Journal of Clinical Microbiology</source>. <year>2006</year> <month>jul</month>; <volume>44</volume>(<issue>7</issue>): p. <fpage>2524</fpage>–<lpage>2532</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1128/JCM.02536-05" xlink:type="simple">10.1128/JCM.02536-05</ext-link></comment> <object-id pub-id-type="pmid">16825375</object-id></mixed-citation></ref>
<ref id="pcbi.1006077.ref035"><label>35</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Wallace</surname> <given-names>DL</given-names></name>. <article-title>A Method for Comparing Two Hierarchical Clusterings: Comment</article-title>. <source>Journal of the American Statistical Association</source>. <year>1983</year> <month>sep</month>; <volume>78</volume>(<issue>383</issue>): p. <fpage>569</fpage>–<lpage>576</lpage>.</mixed-citation></ref>
<ref id="pcbi.1006077.ref036"><label>36</label><mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Gawantka</surname> <given-names>V</given-names></name>, <name name-style="western"><surname>Pollet</surname> <given-names>N</given-names></name>, <name name-style="western"><surname>Delius</surname> <given-names>H</given-names></name>, <name name-style="western"><surname>Vingron</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Pfister</surname> <given-names>R</given-names></name>, <name name-style="western"><surname>Nitsch</surname> <given-names>R</given-names></name>, <etal>et al</etal>. <article-title>Gene expression screening in Xenopus identifies molecular pathways, predicts gene function and provides a global view of embryonic patterning</article-title>. <source>Mech Dev</source>. <year>1998</year> <month>Oct</month>; <volume>77</volume>(<issue>2</issue>): p. <fpage>95</fpage>–<lpage>141</lpage>. <object-id pub-id-type="pmid">9831640</object-id></mixed-citation></ref>
</ref-list>
</back>
</article>