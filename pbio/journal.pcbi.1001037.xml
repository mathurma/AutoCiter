<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article
  PUBLIC "-//NLM//DTD Journal Publishing DTD v3.0 20080202//EN" "http://dtd.nlm.nih.gov/publishing/3.0/journalpublishing3.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="3.0" xml:lang="EN">
<front>
<journal-meta><journal-id journal-id-type="publisher-id">plos</journal-id><journal-id journal-id-type="nlm-ta">PLoS Comput Biol</journal-id><journal-id journal-id-type="pmc">ploscomp</journal-id><!--===== Grouping journal title elements =====--><journal-title-group><journal-title>PLoS Computational Biology</journal-title></journal-title-group><issn pub-type="ppub">1553-734X</issn><issn pub-type="epub">1553-7358</issn><publisher>
<publisher-name>Public Library of Science</publisher-name>
<publisher-loc>San Francisco, USA</publisher-loc></publisher></journal-meta>
<article-meta><article-id pub-id-type="publisher-id">10-PLCB-RA-2056R2</article-id><article-id pub-id-type="doi">10.1371/journal.pcbi.1001037</article-id><article-categories><subj-group subj-group-type="heading"><subject>Research Article</subject></subj-group><subj-group subj-group-type="Discipline"><subject>Computational Biology/Comparative Sequence Analysis</subject><subject>Computational Biology/Evolutionary Modeling</subject><subject>Computational Biology/Genomics</subject><subject>Computational Biology/Sequence Motif Analysis</subject><subject>Computational Biology/Transcriptional Regulation</subject><subject>Evolutionary Biology/Bioinformatics</subject></subj-group></article-categories><title-group><article-title>Modeling the Evolution of Regulatory Elements by Simultaneous Detection and Alignment with Phylogenetic Pair HMMs</article-title><alt-title alt-title-type="running-head">Phylogenetic Pair HMMs</alt-title></title-group><contrib-group>
<contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Majoros</surname><given-names>William H.</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref><xref ref-type="corresp" rid="cor1"><sup>*</sup></xref></contrib>
<contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Ohler</surname><given-names>Uwe</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref><xref ref-type="aff" rid="aff2"><sup>2</sup></xref><xref ref-type="corresp" rid="cor1"><sup>*</sup></xref></contrib>
</contrib-group><aff id="aff1"><label>1</label><addr-line>Institute for Genome Sciences &amp; Policy, Duke University, Durham, North Carolina, United States of America</addr-line>       </aff><aff id="aff2"><label>2</label><addr-line>Department of Biostatistics &amp; Bioinformatics, Duke University, Durham, North Carolina, United States of America</addr-line>       </aff><contrib-group>
<contrib contrib-type="editor" xlink:type="simple"><name name-style="western"><surname>Wasserman</surname><given-names>Wyeth W.</given-names></name>
<role>Editor</role>
<xref ref-type="aff" rid="edit1"/></contrib>
</contrib-group><aff id="edit1">University of British Columbia, Canada</aff><author-notes>
<corresp id="cor1">* E-mail: <email xlink:type="simple">bmajoros@duke.edu</email> (WHM); <email xlink:type="simple">uwe.ohler@duke.edu</email> (UO)</corresp>
<fn fn-type="con"><p>Conceived and designed the experiments: WHM UO. Performed the experiments: WHM. Analyzed the data: WHM UO. Wrote the paper: WHM UO.</p></fn>
<fn fn-type="conflict"><p>The authors have declared that no competing interests exist.</p></fn></author-notes><pub-date pub-type="collection"><month>12</month><year>2010</year></pub-date><pub-date pub-type="epub"><day>16</day><month>12</month><year>2010</year></pub-date><volume>6</volume><issue>12</issue><elocation-id>e1001037</elocation-id><history>
<date date-type="received"><day>9</day><month>4</month><year>2010</year></date>
<date date-type="accepted"><day>17</day><month>11</month><year>2010</year></date>
</history><!--===== Grouping copyright info into permissions =====--><permissions><copyright-year>2010</copyright-year><copyright-holder>Majoros, Ohler</copyright-holder><license><license-p>This is an open-access article distributed under the terms of the Creative Commons Attribution License, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p></license></permissions><abstract>
<p>The computational detection of regulatory elements in DNA is a difficult but important problem impacting our progress in understanding the complex nature of eukaryotic gene regulation. Attempts to utilize cross-species conservation for this task have been hampered both by evolutionary changes of functional sites and poor performance of general-purpose alignment programs when applied to non-coding sequence. We describe a new and flexible framework for modeling binding site evolution in multiple related genomes, based on phylogenetic pair hidden Markov models which explicitly model the gain and loss of binding sites along a phylogeny. We demonstrate the value of this framework for both the alignment of regulatory regions and the inference of precise binding-site locations within those regions. As the underlying formalism is a stochastic, generative model, it can also be used to simulate the evolution of regulatory elements. Our implementation is scalable in terms of numbers of species and sequence lengths and can produce alignments and binding-site predictions with accuracy rivaling or exceeding current systems that specialize in only alignment or only binding-site prediction. We demonstrate the validity and power of various model components on extensive simulations of realistic sequence data and apply a specific model to study <italic>Drosophila</italic> enhancers in as many as ten related genomes and in the presence of gain and loss of binding sites. Different models and modeling assumptions can be easily specified, thus providing an invaluable tool for the exploration of biological hypotheses that can drive improvements in our understanding of the mechanisms and evolution of gene regulation.</p>
</abstract><abstract abstract-type="summary"><title>Author Summary</title>
<p>The computational detection of regulatory elements in DNA is a difficult but important problem for decoding eukaryotic gene regulation. Increasing sequence data has made it possible to utilize related genomes, but this is not as straightforward as it may seem, as the evolution of noncoding regulatory regions is relatively poorly understood. In this work we describe a modeling framework and software implementation for aligning multiple DNA sequences to each other while simultaneously predicting functional regions in that DNA (such as the locations where proteins bind to the DNA for the purpose of regulating genes). Those functional regions may or may not be evolutionarily conserved across the sequences. Our framework allows for explicit modeling of evolutionary change across sequences in both the individual nucleotides making up the sequences and in the functional significance of the sequences (functional versus nonfunctional). While most competing frameworks and implementations are limited to a maximum number of sequences and their lengths, ours is scalable. We demonstrate the value of our system by using it to align a set of complex regulatory regions across ten <italic>Drosophila</italic> species and to predict protein-binding sites in those sequences.</p>
</abstract><funding-group><funding-statement>This work was supported by grant R01 HG004065 to U.O. The funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.</funding-statement></funding-group><counts><page-count count="12"/></counts></article-meta>
</front>
<body><sec id="s1">
<title>Introduction</title>
<p>A detailed understanding of the mechanisms underlying gene regulation, including precisely how these mechanisms are encoded in an individual's genomic DNA, is of prime importance both to biomedicine and to our knowledge of molecular biology and evolution. Given the wealth of genomic sequence data currently available, computational methods for the modeling and predictive identification of regulatory binding sites play an important role in regulatory genomics. Transcriptional regulation in particular is currently understood in terms of solitary or cooperative binding of enhancer or repressor molecules to key locations in and around target loci. The precise rules governing these binding events and their combinatorial effects on gene expression have been examined in detail for small case studies, but it is currently unknown whether there exists a “regulatory code” or “grammar” that dictates the combination of binding sites, such as number, orientation, distance, and relative spacing.</p>
<p>The use of cross-species conservation in inferring binding-site locations, so-called <italic>phylogenetic footprinting</italic> <xref ref-type="bibr" rid="pcbi.1001037-Gumucio1">[1]</xref>, has become increasingly popular with the greater availability of genomic sequences from related organisms. A major impediment to the use of conservation evidence is the potential for complex evolutionary changes to obscure selection patterns. Though strong purifying selection at the whole-site level is presumed to apply to critical functional sites, the ability for sites to arise, disappear, or be translocated locally within a cis-regulatory module (e.g., via genomic rearrangements or compensatory site turnover, where the loss of binding affinity at one site is accompanied by a compensatory gain of affinity somewhere nearby) renders precise homology relations between sites difficult to establish. In the case of protein-coding genes, the use of pre-computed alignments between syntenic genomic regions often suffices for inference of coding exon boundaries, since the homology of orthologous coding segments is often easily discernible by general-purpose alignment programs. For regulatory binding sites, it becomes necessary to distinguish between <italic>molecular homology</italic>, i.e., common molecular ancestry as defined through DNA replication events, and so-called <italic>functional homology</italic>, i.e., conserved functionality of sites within larger regulatory regions regardless of the precise location.</p>
<p>Effective utilization of cross-species conservation evidence for binding-site identification therefore requires more sophisticated modeling techniques that take into account the potential for incomplete molecular homology. Sites may be present in one group of species but appear at a different location or be lost altogether in a different clade. In addition, because general-purpose alignment programs have been found to perform relatively poorly in aligning noncoding DNA <xref ref-type="bibr" rid="pcbi.1001037-Huang1">[2]</xref>, <xref ref-type="bibr" rid="pcbi.1001037-Wong1">[3]</xref>, specialized alignment techniques applicable to regulatory elements are desired. We therefore set out to develop a new and flexible framework which integrates the modeling of binding-site evolutionary dynamics directly into the alignment process, resulting in a significant advance in our ability to identify evolutionarily conserved binding sites—even those exhibiting only partial homology. A number of previous works have addressed individual parts of this problem in isolation. For example, Satija <italic>et al.</italic> <xref ref-type="bibr" rid="pcbi.1001037-Satija1">[4]</xref> incorporated the notion of “fast” versus “slow” evolution into the alignment process, but did not explicitly model positional composition biases in binding sites. He <italic>et al.</italic> <xref ref-type="bibr" rid="pcbi.1001037-He1">[5]</xref> explicitly modeled binding sites and their evolutionary “gain” and “loss”, but addressed only the two-species case, in which actual gain and loss patterns cannot be fully disambiguated due to lack of an outgroup. Moses <italic>et al</italic>. <xref ref-type="bibr" rid="pcbi.1001037-Moses1">[6]</xref> addressed the problem of modeling more than two species, but did not allow for evolutionary gain or loss. Ray <italic>et al</italic>. <xref ref-type="bibr" rid="pcbi.1001037-Ray1">[7]</xref> modeled gain and loss among multiple species, but utilized precomputed alignments.</p>
<p>Here we describe the first framework which combines all of these tasks into one process: the modeling of binding site evolution, the modeling of nucleotide substitution (including insertion and deletion), and the modeling of binding site residue preferences (positional composition bias), allowing us to simultaneously produce a multiple-species alignment and a set of binding-site predictions informed by conservation patterns. We use this formalism within MAFIA, a new software system for the inference of functional binding sites. We use simulated genomes to precisely benchmark and validate various model assumptions. We show that MAFIA rivals or exceeds the predictive accuracy of current binding-site prediction programs, as well as the alignment accuracy of state-of-the-art alignment programs, and thus combines the best of both worlds within a flexible and integrated system. Applying the system to known <italic>Drosophila</italic> enhancers showcases specific scenarios in which current existing approaches are misled by the complex arrangement of partially conserved binding sites.</p>
</sec><sec id="s2">
<title>Results</title>
<sec id="s2a">
<title>Overview of Our Modeling Framework</title>
<p>Our models simultaneously capture information about binding propensities of individual transcription factors, rates of evolutionary gain and loss of binding sites, phylogenetic distances and branching patterns between species, nucleotide insertion and deletion propensities, and the substitution biases within each of the various types of genomic elements that may occur in the input sequences. All of this information is utilized for the purpose of simultaneously aligning and annotating orthologous DNA sequences. In the following, we provide a high-level overview of the general layout and salient features of our approach; a detailed description is provided in the <xref ref-type="sec" rid="s4">Methods</xref> section, and algorithms are given in <xref ref-type="supplementary-material" rid="pcbi.1001037.s001">Text S1</xref>.</p>
<p>The underlying framework in our system is based on <italic>phylogenetic pair hidden Markov models</italic>. Hidden Markov models (HMMs) capture nucleotide composition biases and spatial organization patterns within a single sequence (see, e.g., <xref ref-type="bibr" rid="pcbi.1001037-Durbin1">[8]</xref>, <xref ref-type="bibr" rid="pcbi.1001037-Majoros1">[9]</xref>). Pair HMMs (PHMMs) perform this modeling simultaneously for two sequences, and also provide a probabilistic model of the precise nucleotide homology relation between the two sequences. Phylogenetic pair HMMs (PPHMMs) generalize PHMMs further by marginalizing over ancestral sequences, thereby allowing them to be used to align multiple sequences related by a phylogenetic tree.</p>
<p>A PPHMM consists of a set of <italic>states</italic>, which singly or in combination model specific types of genomic elements (such as binding sites for a particular factor), and a set of permissible <italic>transitions</italic> between states, effectively defining a “grammar” governing genomic elements and their preferred spatial relations. Within each state is a full probabilistic model of the genomic element it represents, including: (1) a probability distribution over the nucleotides that can occur at the modeled position, (2) an evolution model describing nucleotide substitution biases, and (3) an insertion-deletion, or “indel” model specifying the propensity for individual nucleotides to be gained or lost along a lineage. All of these probability distributions are automatically scaled according to phylogenetic distances, as denoted by the branch lengths in a phylogeny. <xref ref-type="fig" rid="pcbi-1001037-g001">Figure 1</xref> shows a state diagram for a simple PPHMM to be used for aligning background sequence; as shown in the figure, the transition probabilities are all functions of branch length <italic>t</italic>.</p>
<fig id="pcbi-1001037-g001" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1001037.g001</object-id><label>Figure 1</label><caption>
<title>State-transition diagram for a PPHMM implementing a reversible and affine background indel model for a phylogeny branch of length <italic>t</italic>.</title>
<p>Ovals denote emitting states; arrows denote transitions. Start and stop are special non-emitting states. This model can be implemented in 33 lines of SEAL code. Parameter <italic>s</italic> = 1<monospace>-</monospace>(1<monospace>-</monospace><italic>b</italic><sub>∞</sub>)(1<monospace>-</monospace><italic>b</italic>(<italic>t</italic>)) gives the probability of leaving the background model, for gain-of-function probability <italic>b</italic>(<italic>t</italic>), <italic>b</italic><sub>∞</sub> =  lim<italic><sub>t</sub></italic><sub>→∞</sub><italic>b</italic>(<italic>t</italic>). Parameters <italic>α</italic> and <italic>β</italic> influence indel rates.</p>
</caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1001037.g001" xlink:type="simple"/></fig>
<p>To allow for modeling of evolutionary change at the level of site <italic>function</italic>, we define the notion of a <italic>cross-functional state</italic>. Associated with each state are two <italic>functional classes</italic>, one for the ancestral residue, and one for the descendant; each functional class corresponds to a distinct selection regime (i.e., a substitution rate matrix). When the ancestral and descendent classes differ, we say that the state is <italic>cross-functional</italic>, and we model substitution propensities using a mixture model which integrates over all unobservable time points at which the class could have changed along the lineage:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1001037.e001" xlink:type="simple"/><label>(1)</label></disp-formula>for ancestral class <italic>B</italic> and descendent class <italic>b</italic>, where <bold>P</bold>(<italic>t</italic>) is a substitution matrix scaled to divergence time <italic>t</italic>. PPHMM state diagrams for gain and loss submodels are shown in <xref ref-type="fig" rid="pcbi-1001037-g002">Figure 2</xref>; the ancestral and descendent functional classes are shown in the top and bottom portions of each state, respectively.</p>
<fig id="pcbi-1001037-g002" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1001037.g002</object-id><label>Figure 2</label><caption>
<title>PPHMMs for loss (top) and gain (bottom) of function in a binding site.</title>
<p>Ovals are emitting states. The top half of an emitting state denotes the functional class in the parent, while the bottom half denotes the functional class in the child. Dash denotes a gap. <italic>bg</italic> denotes the background functional class. <italic>W<sub>i</sub></italic> denotes the functional class corresponding to the <italic>i</italic><sup>th</sup> column in a positional weight matrix (PWM). Transition probabilities are derived from the background indel model. Emission probabilities are derived via a substitution mixture model.</p>
</caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1001037.g002" xlink:type="simple"/></fig>
<p>Probabilities for entering a cross-functional state are model-dependent (i.e., specified via our model-description language, SEAL), but generally correspond to rates of gain and loss of function. For the experiments described below, in which we account for evolutionary gain and loss of functional binding sites in regulatory regions, we utilized a birth-death process on binding sites for estimating transition probabilities into cross-functional states. Defining <italic>b</italic>(<italic>t</italic>), <italic>p</italic>(<italic>t</italic>), and <italic>q</italic>(<italic>t</italic>) as the probabilities of a functional binding site being born within an interval of length <italic>t</italic>, surviving over such an interval, or dying over such an interval, respectively, we derive a system of differential equations describing the time evolution of these quantities:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1001037.e002" xlink:type="simple"/><label>(2)</label></disp-formula>for birth rate <italic>λ</italic> and death rate <italic>µ</italic>. From the solution to these equations we derive transition probabilities for a PPHMM modeling functional binding sites of multiple transcription factors occurring on either strand and subject to stochastic turnover (gain/loss); an example of such a model, for seven transcription factors, is shown in <xref ref-type="fig" rid="pcbi-1001037-g003">Figure 3</xref>.</p>
<fig id="pcbi-1001037-g003" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1001037.g003</object-id><label>Figure 3</label><caption>
<title>An example CRM evolution model that can be implemented in our framework.</title>
<p>Parallelograms denote groups of states in the PPHMM; small parallelograms denote states implementing a binding site profile (positional weight matrix). <italic>b</italic>(<italic>t</italic>): gain probability. <italic>q</italic>(<italic>t</italic>): loss probability. <italic>p</italic>(<italic>t</italic>): retention probability. <italic>b</italic><sub>∞</sub>: limit of <italic>b</italic>(<italic>t</italic>) as <italic>t</italic>→<sub>∞</sub>. <italic>t</italic>: branch length. <italic>s</italic>: 1<monospace>-</monospace>(1<monospace>-</monospace><italic>b</italic><sub>∞</sub>)(1<monospace>-</monospace><italic>b</italic>(<italic>t</italic>)). <italic>ε</italic>: 0.00001. Plus and minus denote strand. See <xref ref-type="sec" rid="s4">Materials and Methods</xref> for additional details.</p>
</caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1001037.g003" xlink:type="simple"/></fig>
<p>Performing simultaneous alignment and annotation with a PPHMM such as the one shown in <xref ref-type="fig" rid="pcbi-1001037-g003">Figure 3</xref> can be accomplished via progressive alignment, optionally followed by some form of <italic>refinement</italic> and/or sampling. Progressive alignment begins with alignment of siblings at the leaves of the phylogenetic tree, and progresses upward. Sibling taxa <italic>T</italic><sub>1</sub> and <italic>T</italic><sub>2</sub> having sequences <italic>S</italic><sub>1</sub> and <italic>S</italic><sub>2</sub> can be aligned by finding the most probable <italic>state path</italic> (ordered sequence of states) <italic>φ</italic><sup>*</sup> conditional on the input sequences:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1001037.e003" xlink:type="simple"/><label>(3)</label></disp-formula>Gaps in the alignment are modeled using the standard insertion/deletion state types as in traditional pair HMMs <xref ref-type="bibr" rid="pcbi.1001037-Durbin1">[8]</xref>. Emission probabilities for sibling taxa <italic>Y</italic> and <italic>Z</italic> sharing parent taxon <italic>X</italic> are computed via standard methods used in <italic>phylogenetic HMM</italic>s <xref ref-type="bibr" rid="pcbi.1001037-Siepel1">[10]</xref>:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1001037.e004" xlink:type="simple"/><label>(4)</label></disp-formula>for state <italic>q</italic> and equilibrium distribution <italic>P<sub>eq</sub></italic>; <italic>L<sub>X</sub></italic> is a recursive likelihood function which marginalizes over unobservables in the clade rooted at taxon <italic>X</italic>.</p>
<p>In summary, we have augmented standard pair HMMs by both rendering them applicable to unobservable ancestral sequences and by attributing states with <italic>type</italic> information. The latter is achieved by parameterizing state types with distinct substitution models, and by permitting states to employ type-mixture models in the case of evolutionary change-of-function events, as described above. Because standard progressive alignment algorithms are agnostic to specific functional elements and their respective evolutionary propensities, we also devised a novel, two-pass strategy for progressive alignment which takes functional classes into consideration. The aligner first performs a liberal “up-pass” intended to favor sensitivity, followed by a conservative “down-pass” intended to favor specificity. Because functional classes dictate substitution rates and potentially indel propensities during pairwise alignment, this class information can have a potentially large influence on the resulting alignment. To our knowledge, no other multiple-sequence aligner explicitly incorporates such “type” information at a global scale. In the case of cis-regulatory modules, this feature has the potential to reduce the incidence of misalignment between conserved functional elements, including elements that have undergone a gain or loss of function but that still retain at least some degree of identifiable molecular homology.</p>
</sec><sec id="s2b">
<title>Assessing Importance of Different Modeling Features</title>
<p>Our system is implemented as a configurable modeling framework that enables end-users to investigate alternative models for alignment, binding site prediction, and evolutionary reconstruction. As a proof-of-principle, we implemented the model shown in <xref ref-type="fig" rid="pcbi-1001037-g003">Figure 3</xref> within the context of our modeling framework and applied it to an array of real and simulated data sets to assess the ability of the model to produce both accurate alignments and accurate binding-site predictions. To properly evaluate all aspects, we need to perform such an assessment in the context of sequences in which the “correct” alignment and binding-site annotations are known with certainty. Unfortunately, this is impossible with currently available data sets from real biological systems. Although experimental techniques are available for identifying regions in genomic DNA bound by specific transcription factors, these experiments are typically carried out in only one species, and at this point still suffer from low resolution (i.e., insufficient for precisely delineating the binding sites). As such, predicted binding sites not known <italic>a priori</italic> to be true functional sites cannot with certainty be labeled as false positives. Fine-scaled evolutionary simulations parameterized via measurements taken from real biological data can provide a reasonable approximation to biological reality, while also providing access to the precise nucleotide homology relations and functional elements (e.g., binding sites) produced during the simulation. Currently the most practical approach is thus to supplement real biological data sets with simulations, which allows one to assess sensitivity of site inference on known binding sites, and to assess both sensitivity and specificity in simulated sequences. The utility of simulations for validating models of genome evolution has become increasingly apparent of late <xref ref-type="bibr" rid="pcbi.1001037-Lusk1">[11]</xref>–<xref ref-type="bibr" rid="pcbi.1001037-Pollard1">[14]</xref>.</p>
<p>To compare alignment and annotation performance under various model assumptions, we first employed two different simulators, both of which allowed binding sites to evolve both at the nucleotide level (via accepted point mutations) and also at the whole-site level (via the gain and loss of site function). The first simulator, EVOS, is based on the same evolutionary model as our aligner; we use it only to explore the impact of changes to the model structure in order to assess the importance of various features in the model. For these simulations we utilized a 10-species <italic>Drosophila</italic> phylogeny: ((((((<italic>melanogaster</italic>, <italic>simulans</italic>), (<italic>yakuba</italic>, <italic>erecta</italic>)), <italic>ananassae</italic>), <italic>pseudoobscura</italic>), <italic>willistoni</italic>), ((<italic>mojavensis</italic>, <italic>virilis</italic>), <italic>grimshawi</italic>)); the model incorporated seven factors: <italic>bicoid</italic> (<italic>bcd</italic>), <italic>caudal</italic> (<italic>cad</italic>), <italic>giant</italic> (<italic>gt</italic>), <italic>hunchback</italic> (<italic>hb</italic>), <italic>knirps</italic> (<italic>kni</italic>), <italic>kruppel</italic> (<italic>kr</italic>), and <italic>tailless</italic> (<italic>tll</italic>). The first modification was to remove gain and loss states from the model, producing what we call the “complete orthology” model. The next modification (called “Phylo-HMM”) employed a simple, three-state PPHMM for alignment, and then performed binding-site prediction by applying the full model (minus gain and loss states) to the root sequence. Note that both of these latter models assume complete orthology during annotation, but only the “complete orthology” model includes states for binding sites during alignment. Prediction accuracy was drastically higher for the full model than for the complete-orthology model when gain and loss events were common, supporting the need for flexible evolutionary models for non-coding sequence analysis. The differences in accuracy between the complete-orthology model and the Phylo-HMM were moderate but consistent, suggesting that the complete-orthology model does derive some advantage from its use of binding-site knowledge during alignment. <xref ref-type="fig" rid="pcbi-1001037-g004">Figure 4</xref> shows that incorporating additional species did permit the full PPHMM to monotonically increase in accuracy, though the rate of gain decreases starting at nine species. We also applied a “single factors” model which utilized the full PPHMM with gain and loss states but only one of the seven factors used in the simulation; this was repeated for each factor. The single-factors model suffered from low specificity while enjoying high sensitivity, as expected (since this model utilized several runs of the predictor and was therefore less constrained, resulting in an ability to predict overlapping binding sites for different factors). Detailed results obtained with this simulator are given in <xref ref-type="supplementary-material" rid="pcbi.1001037.s001">Text S1</xref>.</p>
<fig id="pcbi-1001037-g004" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1001037.g004</object-id><label>Figure 4</label><caption>
<title>Site-level prediction accuracy as a function of number of species in EVOS simulation runs (the simulator and predictor modeled the same number of species).</title>
</caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1001037.g004" xlink:type="simple"/></fig></sec><sec id="s2c">
<title>Comparing Our System to Earlier Approaches</title>
<p>We now compare the accuracy of our system's binding site predictions to those produced via earlier systems based on simpler models than ours. We first test prediction accuracy on sequences generated by another simulator, <italic>PSPE</italic> <xref ref-type="bibr" rid="pcbi.1001037-Huang1">[2]</xref>, that was developed independently of our aligner and which utilizes different modeling assumptions. PSPE allows binding sites to be lost, but only when another site of the same type is gained nearby, thereby modeling strict <italic>compensatory turnover</italic> of functional sites. For the PSPE simulations, we generated 300 root sequences, each 500 bp in length, and then evolved these sequences over a five-species phylogeny: (((<italic>human</italic>, <italic>baboon</italic>), <italic>mouse</italic>), (<italic>dog</italic>, <italic>cow</italic>)); branch lengths were the same as those used by Huang <italic>et al.</italic> <xref ref-type="bibr" rid="pcbi.1001037-Huang1">[2]</xref>. Each sequence was seeded with a single instance of each of six binding sites (factors: MafB, SOX9, IRF1, E2F1, SP1, Sox5); factor weight matrices were obtained from JASPAR <xref ref-type="bibr" rid="pcbi.1001037-Bryne1">[15]</xref>. The sequences at the leaves of the phylogeny were then provided to our program, MAFIA, for alignment and annotation of binding sites; an additional ten sequences were evolved and set aside for parameter estimation of the predictor (see <xref ref-type="sec" rid="s4">Materials and Methods</xref>). The average rate of turnover for these simulations was 11.3%; additional statistics are available in <xref ref-type="supplementary-material" rid="pcbi.1001037.s001">Text S1</xref>.</p>
<p>To assess relative alignment accuracy, we separately aligned the same sequences using two general-purpose aligners: MUSCLE <xref ref-type="bibr" rid="pcbi.1001037-Edgar1">[16]</xref>, a relatively recent tool which has been reported to achieve high accuracy on non-coding sequences <xref ref-type="bibr" rid="pcbi.1001037-Huang1">[2]</xref>, and CLUSTALW <xref ref-type="bibr" rid="pcbi.1001037-Thompson1">[17]</xref>, a classic progressive aligner. The alignments produced by the three aligners were compared to the known, correct alignment recorded internally by the simulator during sequence evolution. Alignment accuracy was measured by interpreting an alignment as an undirected graph of homology relations and then comparing the graphs for the correct and predicted alignments; sensitivity (<italic>Sn</italic>) and specificity (<italic>Sp</italic>) of edge prediction were computed and combined into an <italic>F</italic>-score: <italic>F</italic> = 2×<italic>Sn</italic>×<italic>Sp</italic>/(<italic>Sn</italic>+<italic>Sp</italic>). As shown in <xref ref-type="table" rid="pcbi-1001037-t001">Table 1</xref>, MAFIA's average alignment accuracy was roughly identical to MUSCLE's, while both were noticeably higher than that of CLUSTALW. Note that for this data set, the correct alignments had very few gaps, likely limiting the difficulty of the alignment task; we address this issue in a second set of simulation runs below (see also section 5.1 in <xref ref-type="supplementary-material" rid="pcbi.1001037.s001">Text S1</xref>).</p>
<table-wrap id="pcbi-1001037-t001" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1001037.t001</object-id><label>Table 1</label><caption>
<title>Alignment accuracy for PSPE simulation runs, averaged across runs (CRMs).</title>
</caption><!--===== Grouping alternate versions of objects =====--><alternatives><graphic id="pcbi-1001037-t001-1" mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1001037.t001" xlink:type="simple"/><table><colgroup span="1"><col align="left" span="1"/><col align="center" span="1"/><col align="center" span="1"/></colgroup>
<thead>
<tr>
<td align="left" colspan="1" rowspan="1">program</td>
<td align="left" colspan="1" rowspan="1">F</td>
<td align="left" colspan="1" rowspan="1">SD</td>
</tr>
</thead>
<tbody>
<tr>
<td align="left" colspan="1" rowspan="1">MAFIA</td>
<td align="left" colspan="1" rowspan="1">93.2%</td>
<td align="left" colspan="1" rowspan="1">1.7</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">MUSCLE</td>
<td align="left" colspan="1" rowspan="1">93.4%</td>
<td align="left" colspan="1" rowspan="1">1.9</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">CLUSTALW</td>
<td align="left" colspan="1" rowspan="1">91.0%</td>
<td align="left" colspan="1" rowspan="1">2.6</td>
</tr>
</tbody>
</table></alternatives><table-wrap-foot><fn id="nt101"><label/><p>Mean and <italic>SD</italic> values are given for the 300 sequences used in the simulation. <italic>F</italic> = 2×<italic>Sn</italic>×<italic>Sp</italic>/(<italic>Sn</italic>+<italic>Sp</italic>); <italic>Sn</italic> = sensitivity, <italic>Sp</italic> = specificity. <italic>SD</italic> = standard deviation.</p></fn></table-wrap-foot></table-wrap>
<p>To assess relative binding-site prediction accuracy, we compared our program to a well-known comparative binding-site predictor, rMONKEY <xref ref-type="bibr" rid="pcbi.1001037-Moses1">[6]</xref>. Because rMONKEY assumes <italic>complete orthology</italic> of binding sites (i.e., sites do not gain or lose function over evolutionary time), we expected our gain/loss/retention model to produce more accurate predictions on average, since PSPE has the ability to generate gain and loss events. Binding-site predictions were evaluated at both the nucleotide and whole-site levels. At the nucleotide level, individual residues were classified as <italic>foreground</italic> (part of <italic>any</italic> binding site) or <italic>background</italic> (not part of any binding site), and these classifications were scored via the <italic>F</italic>-score. At the whole-site level, an actual binding site was deemed to be found by the predictor if at least half of its nucleotides overlapped a predicted site for the same factor. Note that factor identity was ignored when assessing nucleotide accuracy (e.g., a nucleotide predicted as part of an E2F1 site but that was actually part of an SP1 site was still scored as a success). Nucleotide accuracy thus evaluates the ability of a predictor to detect regions of elevated purifying selection, while the site-level score assesses the ability of the predictor to also identify the correct factor involved.</p>
<p>When scoring the human binding sites only (i.e., ignoring the ability of the programs to identify binding sites in other leaf species), MAFIA outperformed rMONKEY by ∼2.2% at the nucleotide level and ∼2% at the whole-site level (<xref ref-type="table" rid="pcbi-1001037-t002">Table 2</xref>, <italic>F</italic>-scores only). However, when scoring the programs on all sites in all leaf species, MAFIA's accuracy remained nearly as high as on human only, while rMONKEY's accuracy dropped substantially: 14 percentage points at the nucleotide level and 16 percentage points at the site level. This demonstrates the clear advantage of an integrated approach which is able to reconcile potential conflicts between alignments and binding sites across many species.</p>
<table-wrap id="pcbi-1001037-t002" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1001037.t002</object-id><label>Table 2</label><caption>
<title>Binding-site prediction accuracy for PSPE simulation runs.</title>
</caption><!--===== Grouping alternate versions of objects =====--><alternatives><graphic id="pcbi-1001037-t002-2" mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1001037.t002" xlink:type="simple"/><table><colgroup span="1"><col align="left" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/></colgroup>
<thead>
<tr>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="6" rowspan="1">predict human only</td>
<td align="left" colspan="6" rowspan="1">predict all species</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="3" rowspan="1">nucleotide</td>
<td align="left" colspan="3" rowspan="1">whole site</td>
<td align="left" colspan="3" rowspan="1">nucleotide</td>
<td align="left" colspan="3" rowspan="1">whole site</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">program</td>
<td align="left" colspan="1" rowspan="1">F</td>
<td align="left" colspan="1" rowspan="1">Sn</td>
<td align="left" colspan="1" rowspan="1">Sp</td>
<td align="left" colspan="1" rowspan="1">F</td>
<td align="left" colspan="1" rowspan="1">Sn</td>
<td align="left" colspan="1" rowspan="1">Sp</td>
<td align="left" colspan="1" rowspan="1">F</td>
<td align="left" colspan="1" rowspan="1">Sn</td>
<td align="left" colspan="1" rowspan="1">Sp</td>
<td align="left" colspan="1" rowspan="1">F</td>
<td align="left" colspan="1" rowspan="1">Sn</td>
<td align="left" colspan="1" rowspan="1">Sp</td>
</tr>
</thead>
<tbody>
<tr>
<td align="left" colspan="1" rowspan="1">MAFIA</td>
<td align="left" colspan="1" rowspan="1">84.7</td>
<td align="left" colspan="1" rowspan="1">82.9</td>
<td align="left" colspan="1" rowspan="1">86.6</td>
<td align="left" colspan="1" rowspan="1">83.5</td>
<td align="left" colspan="1" rowspan="1">81.1</td>
<td align="left" colspan="1" rowspan="1">86.2</td>
<td align="left" colspan="1" rowspan="1">83.0</td>
<td align="left" colspan="1" rowspan="1">79.5</td>
<td align="left" colspan="1" rowspan="1">86.9</td>
<td align="left" colspan="1" rowspan="1">81.4</td>
<td align="left" colspan="1" rowspan="1">77.1</td>
<td align="left" colspan="1" rowspan="1">86.3</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">rMONKEY</td>
<td align="left" colspan="1" rowspan="1">82.5</td>
<td align="left" colspan="1" rowspan="1">89.0</td>
<td align="left" colspan="1" rowspan="1">76.9</td>
<td align="left" colspan="1" rowspan="1">81.5</td>
<td align="left" colspan="1" rowspan="1">86.5</td>
<td align="left" colspan="1" rowspan="1">77.0</td>
<td align="left" colspan="1" rowspan="1">68.8</td>
<td align="left" colspan="1" rowspan="1">74.5</td>
<td align="left" colspan="1" rowspan="1">64.0</td>
<td align="left" colspan="1" rowspan="1">65.2</td>
<td align="left" colspan="1" rowspan="1">69.1</td>
<td align="left" colspan="1" rowspan="1">61.6</td>
</tr>
</tbody>
</table></alternatives><table-wrap-foot><fn id="nt102"><label/><p>Left half of table: accuracy of predictions in human. Right half of table: pooled accuracy over all leaf species. For site-level accuracy, a known site must overlap a predicted site of the same factor by at least half its nucleotides to be counted correct. All numbers are percentages, averaged over 300 simulation runs.</p></fn></table-wrap-foot></table-wrap>
<p>For a second comparison, we utilized 142 sequences originating from the RedFly database <xref ref-type="bibr" rid="pcbi.1001037-Halfon1">[18]</xref>, which is derived primarily from DNAse I footprinting experiments. Only <italic>D. melanogaster</italic> sites are annotated in this set of “known” sites. Benchmark evaluations such as this can only assess annotation accuracy on one “target” species, which addresses only one (and not the crucial) aspect of our modeling approach. Nevertheless, this exercise will serve to show that our model extends the possibilities to predictions in multiple genomes, while achieving competitive performance on the simpler single-genome task. We chose to address the simple scenario of predicting individual sites within a CRM. In previous investigations <xref ref-type="bibr" rid="pcbi.1001037-He1">[5]</xref> authors have typically constructed a “gold standard” set of sites by identifying the highest-scoring positional weight matrix (“PWM”) position in each footprinting region and taking that as the “known” site for each footprint. This is doubly problematic and has the potential for circularity: for one, the PWMs are often created from the very footprinting sites used as the gold standard, and secondly, the same PWM parameters are usually employed within the model itself. We therefore evaluated sensitivity of predictions by observing whether each predicted site overlapped a DNAse I footprint for the same factor, and then separately evaluated false positive rate by counting predictions in “decoy” CRMs as false positives. In these experiments MAFIA was found to have similar performance improvements compared to rMONKEY as we observed above; details are given in <xref ref-type="supplementary-material" rid="pcbi.1001037.s001">Text S1</xref>.</p>
</sec><sec id="s2d">
<title>Assessing Predictions in Complex Regulatory Regions</title>
<p>To evaluate the value of our approach for the analysis of real, complex, and well-studied CRMs, we ran MAFIA on a set of developmental enhancers from the early embryo segmentation network, which has been frequently utilized as a benchmark. We used seventeen enhancers as annotated by He <italic>et al.</italic> <xref ref-type="bibr" rid="pcbi.1001037-He1">[5]</xref>, and used the binding site models provided by those authors. Because the footprints in RedFly are often larger than the actual binding sites, annotations were based on scanning the footprints with a PWM to identify precise boundaries for the putative binding site. As mentioned above, this process likely induces some biases.</p>
<p>We evaluated our program MAFIA running the same model described above, as well as the programs rMONKEY, EMMA <xref ref-type="bibr" rid="pcbi.1001037-He1">[5]</xref>, and PhyloGibbs-MP <xref ref-type="bibr" rid="pcbi.1001037-Siddharthan1">[19]</xref>, as to their ability to identify these putative binding sites, with <italic>D. melanogaster</italic> once again chosen as the target species (since binding site information is highly incomplete in other genomes). EMMA is the more similar of the programs to ours, since it is based on an explicit model of gain and loss and aligns the sequences within a binding-site-aware framework; however, it is currently limited to two species. We therefore performed three sets of experiments, corresponding to three phylogenies: a two-way phylogeny, (<italic>melanogaster</italic>, <italic>pseudoobscura</italic>), a six-way phylogeny, ((((<italic>melanogaster</italic>, (<italic>yakuba</italic>, <italic>erecta</italic>)), <italic>ananassae</italic>), <italic>pseudoobscura</italic>), <italic>virilis</italic>), and a 10-way phylogeny, ((((((<italic>melanogaster</italic>, <italic>simulans</italic>), (<italic>yakuba</italic>, <italic>erecta</italic>)), <italic>ananassae</italic>), <italic>pseudoobscura</italic>), <italic>willistoni</italic>), ((<italic>mojavensis</italic>, <italic>virilis</italic>), <italic>grimshawi</italic>)). We employed 17-way cross-validation—i.e., training each model on 16 sequences and testing on the remaining sequence. Training of EMMA was carried out via software included in the EMMA software distribution (program “weight_est”). Training of MAFIA was by simple hill-climbing on individual parameters (see <xref ref-type="sec" rid="s4">Materials and Methods</xref>). Training of rMONKEY was by simple hill-climbing on the single <italic>P</italic>-value threshold used to filter predictions. In all cases, the objective function for training was site-level prediction accuracy on the training sequences. The program PhyloGibbs-MP is a <italic>de novo</italic> motif finder but also accepts matrix files specifying known motifs and will predict sites based on conservation evidence; this is how the program was used here.</p>
<p>When performing prediction based on only two species, MAFIA substantially outperformed EMMA in its recommended configuration (<xref ref-type="table" rid="pcbi-1001037-t003">Table 3</xref>). Because EMMA can utilize only two input sequences at a time, our 6-way comparisons included only MAFIA and rMONKEY. MAFIA's accuracy was again superior at the whole-site level (by 2.4%). MAFIA was also applied to the 10-species set, as was PhyloGibbs-MP. rMONKEY was unable to evaluate all 10-way alignments, as some enhancers resulted in memory consumption of over 8 GB. MAFIA applied to 10 species produced the best nucleotide-level accuracy observed, and the second-best site-level accuracy (second to the 2-way MAFIA run), demonstrating that the incorporation of additional informant sequences can improve annotation accuracy for a single target genome, but need not do so in all cases. In addition, the insight gained from a comparison between runs which differ in the number of species used is inherently limited, as the information gained from the ability to annotate additional related genomes is not reflected. Note also that the nucleotide accuracy scores do not reflect the ability to correctly identify the specific factor associated with a binding site, which is a key goal of our system.</p>
<table-wrap id="pcbi-1001037-t003" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1001037.t003</object-id><label>Table 3</label><caption>
<title>Site-prediction accuracy on 17 <italic>Drosophila</italic> developmental enhancers.</title>
</caption><!--===== Grouping alternate versions of objects =====--><alternatives><graphic id="pcbi-1001037-t003-3" mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1001037.t003" xlink:type="simple"/><table><colgroup span="1"><col align="left" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/></colgroup>
<thead>
<tr>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="3" rowspan="1">nucleotides</td>
<td align="left" colspan="3" rowspan="1">whole sites</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">program</td>
<td align="left" colspan="1" rowspan="1">#taxa</td>
<td align="left" colspan="1" rowspan="1">F</td>
<td align="left" colspan="1" rowspan="1">Sn</td>
<td align="left" colspan="1" rowspan="1">Sp</td>
<td align="left" colspan="1" rowspan="1">F</td>
<td align="left" colspan="1" rowspan="1">Sn</td>
<td align="left" colspan="1" rowspan="1">Sp</td>
</tr>
</thead>
<tbody>
<tr>
<td align="left" colspan="1" rowspan="1">MAFIA</td>
<td align="left" colspan="1" rowspan="1">10</td>
<td align="left" colspan="1" rowspan="1"><italic>48.2</italic></td>
<td align="left" colspan="1" rowspan="1">51.4</td>
<td align="left" colspan="1" rowspan="1">45.4</td>
<td align="left" colspan="1" rowspan="1"><italic>41.3</italic></td>
<td align="left" colspan="1" rowspan="1">42.0</td>
<td align="left" colspan="1" rowspan="1">40.6</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">rMONKEY</td>
<td align="left" colspan="1" rowspan="1">10</td>
<td align="left" colspan="1" rowspan="1">-</td>
<td align="left" colspan="1" rowspan="1">-</td>
<td align="left" colspan="1" rowspan="1">-</td>
<td align="left" colspan="1" rowspan="1">-</td>
<td align="left" colspan="1" rowspan="1">-</td>
<td align="left" colspan="1" rowspan="1">-</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">PhyloGibbs-MP</td>
<td align="left" colspan="1" rowspan="1">10</td>
<td align="left" colspan="1" rowspan="1">37.9</td>
<td align="left" colspan="1" rowspan="1">94.0</td>
<td align="left" colspan="1" rowspan="1">23.7</td>
<td align="left" colspan="1" rowspan="1">15.5</td>
<td align="left" colspan="1" rowspan="1">71.5</td>
<td align="left" colspan="1" rowspan="1">8.7</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">MAFIA</td>
<td align="left" colspan="1" rowspan="1">6</td>
<td align="left" colspan="1" rowspan="1">44.5</td>
<td align="left" colspan="1" rowspan="1">40.6</td>
<td align="left" colspan="1" rowspan="1">49.1</td>
<td align="left" colspan="1" rowspan="1"><italic>41.0</italic></td>
<td align="left" colspan="1" rowspan="1">36.1</td>
<td align="left" colspan="1" rowspan="1">47.3</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">rMONKEY</td>
<td align="left" colspan="1" rowspan="1">6</td>
<td align="left" colspan="1" rowspan="1"><italic>45.6</italic></td>
<td align="left" colspan="1" rowspan="1">50.4</td>
<td align="left" colspan="1" rowspan="1">41.7</td>
<td align="left" colspan="1" rowspan="1">38.6</td>
<td align="left" colspan="1" rowspan="1">40.8</td>
<td align="left" colspan="1" rowspan="1">36.7</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">MAFIA</td>
<td align="left" colspan="1" rowspan="1">2</td>
<td align="left" colspan="1" rowspan="1"><italic>46.7</italic></td>
<td align="left" colspan="1" rowspan="1">43.9</td>
<td align="left" colspan="1" rowspan="1">49.8</td>
<td align="left" colspan="1" rowspan="1"><italic>42.3</italic></td>
<td align="left" colspan="1" rowspan="1">38.5</td>
<td align="left" colspan="1" rowspan="1">46.8</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">EMMA</td>
<td align="left" colspan="1" rowspan="1">2</td>
<td align="left" colspan="1" rowspan="1">33.6</td>
<td align="left" colspan="1" rowspan="1">71.3</td>
<td align="left" colspan="1" rowspan="1">22.0</td>
<td align="left" colspan="1" rowspan="1">22.3</td>
<td align="left" colspan="1" rowspan="1">45.0</td>
<td align="left" colspan="1" rowspan="1">14.8</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">EMMA-E</td>
<td align="left" colspan="1" rowspan="1">2</td>
<td align="left" colspan="1" rowspan="1">47.1</td>
<td align="left" colspan="1" rowspan="1">62.6</td>
<td align="left" colspan="1" rowspan="1">37.8</td>
<td align="left" colspan="1" rowspan="1">37.3</td>
<td align="left" colspan="1" rowspan="1">46.2</td>
<td align="left" colspan="1" rowspan="1">31.2</td>
</tr>
</tbody>
</table></alternatives><table-wrap-foot><fn id="nt103"><label/><p>Results from rMONKEY on the 10-way alignments are missing because the program does not process the longer sequences due to large (&gt;8 GB) memory requirements. All numbers are percentages. [“EMMA-E” results were obtained by running EMMA in a nonstandard configuration (command line option “-e”), which forces prior densities to be re-estimated on the test sequence. We included them here for completeness as they led to a noticeable improvement at least on this set of enhancers.]</p></fn></table-wrap-foot></table-wrap>
<p>When applied to 10 species, MAFIA took 12.5 minutes on average (SD: 10.5, max: 36.9) per CRM when using 8 CPU cores, and 304 MB of RAM (SD: 65.5, max: 453). The 10-species data files contained 600 bp sequences on average (SD: 450, max: 2400). Note that increasing the number of species to be aligned results in only a linear increase in computational complexity within our system, while our use of the Hirschberg algorithm <xref ref-type="bibr" rid="pcbi.1001037-Hirschberg1">[20]</xref> permits the application of very large models without incurring exorbitant memory costs.</p>
<p>It is worth noting that the test set includes cases of overlapping binding sites, which are indeed known to occur, either due to functional reasons (such as mutual steric occlusion of activators and repressors—e.g., <xref ref-type="bibr" rid="pcbi.1001037-Ludwig1">[21]</xref>) or fortuitously constrained co-evolution <xref ref-type="bibr" rid="pcbi.1001037-Lusk1">[11]</xref>. Though currently MAFIA cannot produce overlapping predictions, MAFIA predictions for one factor sometimes overlapped a known site for a different factor; these are counted as false positives in our evaluation, though for pairs of factors known to commonly overlap these may instead indicate true sites that are missing from the “gold standard”. Two such cases are <italic>kruppel</italic> overlapping <italic>bicoid</italic>, and <italic>giant</italic> overlapping <italic>bicoid</italic>; these overlapping pairs are widely known to function as competitive repressor-activator sites <xref ref-type="bibr" rid="pcbi.1001037-Stanojevic1">[22]</xref>, and are present both among the known sites and in the overlaps between MAFIA predictions and known sites (see tables S2 and S3 in <xref ref-type="supplementary-material" rid="pcbi.1001037.s001">Text S1</xref>). Although MAFIA currently lacks the ability to predict overlapping binding sites (except via separate runs with different factors), the future incorporation of a sampling procedure should permit the independent prediction of binding site instances via estimates of posterior probabilities.</p>
<p>In addition to identifying many known sites, MAFIA predicted a number of novel sites in this test set. As shown in <xref ref-type="fig" rid="pcbi-1001037-g005">Figure 5</xref>, the known and novel sites in <italic>D. melanogaster</italic> had very similar degree-of-orthology distributions, with a preponderance of well-conserved sites in both cases. This suggests that many of these novel sites are governed by similar selection pressures and contribute to the function of the enhancer.</p>
<fig id="pcbi-1001037-g005" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1001037.g005</object-id><label>Figure 5</label><caption>
<title>Histogram of number of extant <italic>Drosophilids</italic> predicted to share a given site, for known sites (top pane) and novel predicted sites (bottom pane), over a 10-way phylogeny.</title>
</caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1001037.g005" xlink:type="simple"/></fig></sec><sec id="s2e">
<title>Assessing Predictions Using a Novel ChIP-Seq Analysis</title>
<p>The analysis of “gold standard” binding-site annotations followed the example of previous studies, but others have recently pointed out the presence of inherent biases in such datasets (incompleteness and presence of weak but conserved, or partially conserved, sites) which impede the evaluations of multi-genome methods <xref ref-type="bibr" rid="pcbi.1001037-Hawkins1">[23]</xref>. We therefore evaluated the same 17 enhancers via a novel evaluation strategy which utilized genome-wide chromatin immunoprecipitation (“ChIP-seq”) data obtained from Bradley <italic>et al.</italic> <xref ref-type="bibr" rid="pcbi.1001037-Bradley1">[24]</xref> to construct an ROC-like curve. <xref ref-type="fig" rid="pcbi-1001037-g006">Figure 6</xref> plots <italic>sensitivity</italic> (TP/(TP+FN)) on the <italic>y</italic>-axis and <italic>false-positive rate</italic> (FP/(FP+TN)) on the <italic>x</italic>-axis, for a large ensemble of peak-calling thresholds (see <xref ref-type="sec" rid="s4">Materials and Methods</xref>). MAFIA (blue) has a significantly larger area under the curve (AUC) than rMONKEY (red): .67 versus .59 (Wilcoxon <italic>P</italic> = 2.2×10<sup>−16</sup>). The “gold standard” (gold curve) gives an AUC of only .54, showing that this set of “known sites” does indeed omit many elements that are supported by ChIP-seq data and that both MAFIA and rMONKEY are able to find using only conservation evidence.</p>
<fig id="pcbi-1001037-g006" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1001037.g006</object-id><label>Figure 6</label><caption>
<title>ROC-like curve for MAFIA (blue) applied to ten species, rMonkey (red) applied to six species, and the “gold standard” (gold).</title>
<p>Sensitivity is plotted on the y-axis, false-positive rate along the x-axis. Each point corresponds to a different stringency threshold in the processed ChIP-seq data.</p>
</caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1001037.g006" xlink:type="simple"/></fig>
<p>While this evaluation clearly shows the overall advantage of our method, it is instructive to examine individual enhancers to illustrate the advantages of MAFIA in more detail. <xref ref-type="fig" rid="pcbi-1001037-g007">Figure 7</xref> depicts a sample CRM including known sites from the “gold standard”, predictions from several programs, and density scores (F-Seq <xref ref-type="bibr" rid="pcbi.1001037-Boyle1">[25]</xref>) obtained from the genome-wide ChIP-seq data. For this particular CRM, the gold standard had only four sites annotated, all putative <italic>tailless</italic> sites (colored white, since this factor was not included in the ChIP-seq assay). This enhancer is a striking case for the incompleteness of the gold standard, as it is immediately noticeable that many predicted sites from different programs clearly fall close to a peak in the corresponding density curve. Though not all predicted sites fall near a peak, several non-peak sites were agreed upon by multiple predictors, lending support to their functional validity (see below). <xref ref-type="fig" rid="pcbi-1001037-g008">Figure 8</xref> shows the MAFIA alignments and annotations for a number of interesting sites (green bars), which we highlight in the following.</p>
<fig id="pcbi-1001037-g007" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1001037.g007</object-id><label>Figure 7</label><caption>
<title>An example <italic>D. melanogaster</italic> developmental enhancer.</title>
<p>At top are F-Seq scores from ChIP-seq data for six transcription factors (kr = <italic>kruppel</italic>, kni = <italic>knirps</italic>, hb = <italic>hunchback</italic>, gt = <italic>giant</italic>, cad = <italic>caudal</italic>, bcd = <italic>bicoid</italic>); curves were scaled to maximize visual impact for the figure. Predictions and known sites are shown below, with colors denoting factor identity as per the F-Seq curves (factor <italic>tailless</italic> was not assayed in the ChIP-seq experiments and is shown in white). Plus and minus tracks correspond respectively to sense and antisense strands of the dm3 assembly for chromosome 3R. The FlyReg track depicts known binding sites according to the “gold standard” (see text). The EMMA track was produced using the –e option for that program.</p>
</caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1001037.g007" xlink:type="simple"/></fig><fig id="pcbi-1001037-g008" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1001037.g008</object-id><label>Figure 8</label><caption>
<title>Example MAFIA alignments from the CRM shown in <xref ref-type="fig" rid="pcbi-1001037-g007"><bold>Figure 7</bold></xref>.</title>
<p>Nucleotides predicted to participate in binding are shown in bold. Weight matrices for factors are shown as sequence logos above (sense strand) or below (antisense strand) the alignment.</p>
</caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1001037.g008" xlink:type="simple"/></fig>
<p>Site A (<italic>hunchback</italic>) is strongly supported by ChIP-seq data, but the clear lack of full conservation beyond the <italic>melanogaster+obscura</italic> groups renders this site difficult to predict for some programs. Though rMONKEY was able to predict the well-conserved <italic>hunchback</italic> site shown at the left edge of the alignment, it was unable to predict site A. EMMA was fortuitous in being able to predict the site, since the site is fairly well conserved between <italic>D. melanogaster</italic> and <italic>D. pseudoobscura</italic> (the two species used for the EMMA runs); it would likely have missed the site if the second species had been chosen from outside the <italic>melanogaster+obscura</italic> clade.</p>
<p>Of particular interest is the presence of a possible hunchback site a short distance 3′ of site A which appears to be absent from the <italic>melanogaster</italic> subgroup but present in most species outside this clade. Note that these two sites reside on opposite strands, precluding the possibility that these are simply homologous sites that have been mis-aligned. Parsimony considerations would suggest that the forward-strand site is an ancient element that was lost in the <italic>melanogaster</italic> subgroup (as well as along the lineage leading to <italic>D. willistoni</italic>), while site A was gained somewhat earlier than this loss event, on the common lineage leading to the <italic>melanogaster</italic> and <italic>obscura</italic> groups. Under this hypothesis, the existence of site A may have reduced the strength of selection maintaining the forward-strand element near site A in the <italic>melanogaster</italic> subgroup, leading to the latter site's demise. The very possibility for these types of context-dependent turnover events demonstrates a potential for further extensions to models of evolutionary patterns in conservation-based prediction systems.</p>
<p>Site B is an example of a prediction with minimal support from the ChIP-seq data, but which is very likely a functional binding site nonetheless. This putative <italic>hunchback</italic> site is perfectly conserved across all ten species, while flanking sequences show less-than-perfect conservation, suggesting strong purifying selection specific to the eight positions making up the putative site. The consensus sequence perfectly matches that of the weight matrix for this factor, and produces a likelihood ratio of 5.4 when evaluated using the weight matrix with a 2<sup>nd</sup> order Markov chain as background. Three of the four predictors (MAFIA, rMONKEY, and EMMA) agree in placing a <italic>hunchback</italic> site at this precise location. Assuming that the site is indeed functional within some spatiotemporal context in the organism's lifecycle, this example illustrates the limitations of ChIP-seq data for establishing the validity of putative binding sites. In this particular case, whole embryos were collected during a narrow window of time corresponding to the anterior-posterior pattern formation stage of <italic>Drosophilid</italic> embryogenesis <xref ref-type="bibr" rid="pcbi.1001037-Bradley1">[24]</xref>. The transcription factors assayed are well known to play prominent roles in anterior-posterior pattern formation, but this does not preclude other uses of these factors later or earlier in the organism's lifecycle. Spatial resolution may also play a role in obscuring binding affinity for particular sites, since the use of whole embryos will bias the results toward more obligately bound sites, potentially leaving the signal from lower-bound sites, or sites bound in small numbers of cells, below the effective noise threshold.</p>
<p>Finally, site C (<italic>tailless</italic>) demonstrates the ability of our system to predict sites that are not only not conserved in other species, but that may be interrupted in the alignment by indels; most phylo-HMM based methods will miss sites such as these because they prohibit indels within binding sites. Though rMONKEY did predict a conserved site in the 6-way alignment at this location, in order to do so it was forced to predict consensus sequences for <italic>D. pseudoobscura</italic> (ACAATCT) and <italic>D. ananassae</italic> (AATGTCT) that are relatively poor matches to the weight matrix for this factor.</p>
</sec></sec><sec id="s3">
<title>Discussion</title>
<p>A variety of methods have been explored in recent years for alignment of DNA sequence, for identification of functional binding sites, and, in relatively few cases, for performing both simultaneously. The incorporation of binding-sites into the alignment model is an attractive idea, since the presumed higher level of conservation of binding sites in many instances may aid the alignment process by providing “alignment anchors”, which in turn should ease the task of identifying binding sites in the resulting alignment (based on conservation patterns).</p>
<p>Several recent studies have proposed techniques for adapting pair HMMs to the problem of multiple-sequence alignment, specifically within the context of regulatory modules. The work presented here continues in a direction similar to these latter efforts, but provides a more thorough computational foundation for detailed models of regulatory sequences and their evolution. The two key aspects of this foundation are: (1) the ability to implement different sequence evolution models specified via a simple but powerful modeling language; and (2) the sole reliance on pairwise sequence models (PPHMMs), which permits the use of far larger numbers of functional classes than would be possible via, e.g., composing transducers (as in <xref ref-type="bibr" rid="pcbi.1001037-Holmes1">[26]</xref>) into <italic>N</italic>-ary HMMs, for large <italic>N</italic>. We showed that our implementation's alignment accuracy and its success at binding site identification is competitive with current state-of-the-art tools for either problem, while scaling to allow for the evolutionary analysis of multiple genomes (e.g. ten <italic>Drosophila</italic> species).</p>
<p>Explicit modeling of evolutionary (non-compensatory) turnover in regulatory binding sites has recently seen an increase in interest, both in the two-species case <xref ref-type="bibr" rid="pcbi.1001037-He1">[5]</xref> and for larger numbers of species <xref ref-type="bibr" rid="pcbi.1001037-Ray1">[7]</xref>. The propensity for regulatory sequences to experience significant evolutionary change, including wholesale rearrangement of binding sites, has been well documented <xref ref-type="bibr" rid="pcbi.1001037-Ludwig2">[27]</xref>, <xref ref-type="bibr" rid="pcbi.1001037-Moses1">[6]</xref>, <xref ref-type="bibr" rid="pcbi.1001037-Wray1">[28]</xref>. Incorporating turnover into predictive models is nontrivial, however. As noted by Hawkins <italic>et al.</italic> <xref ref-type="bibr" rid="pcbi.1001037-Hawkins1">[23]</xref>, relaxation of the “complete orthology” assumption effectively increases the difficulty of the classification task (site vs. non-site) because it decreases the difference between the classes to be distinguished (i.e., it decreases the classifier's achievable “margin”). Incorporation of a gain and/or loss mechanism in a binding site model should therefore be expected to improve sensitivity at the expense of specificity. In our own simulation runs (EVOS data set #1—see <xref ref-type="supplementary-material" rid="pcbi.1001037.s001">Text S1</xref>), we found precisely the opposite, with the overall accuracy (<italic>F</italic>-score) improving after the incorporation of gain and loss states in our model, with the improvement being rather drastic when high levels of turnover were present in at least some of the test sequences. This disagreement with the theoretical findings of Hawkins <italic>et al.</italic> may be due to the effect of the gain and loss states during the alignment process; in the work by Hawkins <italic>et al.</italic>, the alignments were pre-computed by a general-purpose aligner with no knowledge of binding sites. He <italic>et al.</italic> <xref ref-type="bibr" rid="pcbi.1001037-He1">[5]</xref>, who utilized gain and loss states during the alignment, also found an improvement in prediction accuracy when gain and loss states were enabled. Ray <italic>et al.</italic> <xref ref-type="bibr" rid="pcbi.1001037-Ray1">[7]</xref>, who modeled gain and loss in a multiple-species setting but relied on pre-computed alignments, also found that their model outperformed other systems lacking gain and loss states, and that this advantage was relatively stable across different rates of turnover in simulated data.</p>
<p>Another interesting result of the Hawkins <italic>et al.</italic> <xref ref-type="bibr" rid="pcbi.1001037-He1">[5]</xref> study was their conclusion that “gold standard” test sets tend to be biased against methods capable of detecting weak binding sites (due to the experimental protocols involved in identifying the sites in the gold standard), and are therefore biased against models such as Phylo-HMMs which can detect sites with weak binding profiles but strong conservation. The 17-CRM <italic>Drosophila</italic> data set used here likely suffers from another obvious confounding problem: annotated sites were identified by scanning footprinted sequence data with a simple weight matrix and calling the highest-scoring interval the “correct” site <xref ref-type="bibr" rid="pcbi.1001037-He1">[5]</xref>, which will bias annotations toward strong sites in one annotated target species, while also being incomplete. Our use of ChIP-seq data to construct ROC-like curves provides a more unbiased means for evaluating the relative merits of competing prediction systems. Whereas other authors have applied peak-calling algorithms to ChIP data to identify putative sites, our procedure mitigates the uncertainty inherent in the peak-calling process by identifying putative binding regions at many different binding thresholds. The resulting ensemble of nested peaks is used to compute a set of sensitivity × false-positive-rate pairs that can be compared both visually, via an ROC-like curve, and more rigorously via formal statistical tests. As ChIP data continues to become available in larger volumes and for larger numbers of organisms, we believe this type of analysis will become increasingly valuable for those investigating computational methods for binding-site prediction.</p>
<p>In summary, it has been shown here that in settings in which we know the actual evolutionary history of sequences (via model-independent simulations) or can make use of genome-wide direct binding evidence (rather than a manually annotated “gold standard”), our modeling framework shows strong improvement in predictive capacity over previous attempts that relied on precomputed alignments, were limited to small numbers of sequences, or made untenable simplifying assumptions (such as complete orthology). We have concentrated here on the ability to accurately predict functional binding sites, but our framework also provides a means to align sequences as well as simulate the evolution of sequences and functional elements in those sequences, at both the nucleotide and whole-element level. In particular, it is straightforward to impose “grammatical” restrictions such as relative order or orientation of sites. We expect that the flexibility of this framework will allow further improvements to predictive accuracy as a wider range of models are investigated within the context of this easily configurable system.</p>
</sec><sec id="s4" sec-type="materials|methods">
<title>Materials and Methods</title>
<sec id="s4a">
<title>Data</title>
<p>The set of seventeen Drosophila CRMs consisted of developmental enhancers previously utilized by He <italic>et al.</italic> <xref ref-type="bibr" rid="pcbi.1001037-He1">[5]</xref>; several enhancers from the original set were excluded from our analyses because they either contained no instances of binding sites for the factors included in this analysis, or they caused one of the external software packages in our comparison to malfunction. Because the footprints in RedFly are often larger than the actual binding sites, the latter authors scanned the footprints with a positional weight matrix to identify precise boundaries for the putative binding site. This process likely induces a bias in favor of prediction methods incorporating a weight-matrix-like approach. The CRMs had a mean length of 612 bp (range: 67–1889), totaling 62391 bp (10028 in <italic>D. melanogaster</italic> alone).</p>
<p>The 142 RedFly footprinting profiles had a mean length of 662 bp (range: 610–1908), totaling 564345 bp (87824 in <italic>D. melanogaster</italic> alone); the “decoy” CRMs had a mean length of 495 bp (range: 500–5114), totaling 421644 bp (71000 bp in <italic>D. melanogaster</italic> alone). The decoy sites were chosen to have the same G+C density (within one half percent) and the same PhastCons <xref ref-type="bibr" rid="pcbi.1001037-Siepel2">[29]</xref> conservation level (these levels are given in 10% increments when downloaded from the UCSC <xref ref-type="bibr" rid="pcbi.1001037-Kent1">[30]</xref> genome browser) as one of the true CRMs (a different such CRM for each decoy site).</p>
<p>For the PSPE simulation runs, we parameterized the simulator identically to Huang, <italic>et al.</italic> <xref ref-type="bibr" rid="pcbi.1001037-Huang1">[2]</xref>—i.e., with a Markov order of 3, a negative Binomial gap model (with parameters 1 and 0.5), an HKY substitution model (with parameter 0.05), a <italic>gamma</italic> value of 1, an <italic>iota</italic> value of 0.1, and a <italic>lambda</italic> value of 0.1. Sequences had a mean length of 500 bp (range: 475–530), totaling 274975 bp (54927 bp for <italic>D. melanogaster</italic> alone).</p>
<p>For the EVOS simulation runs, the mean CRM length was 503 bp (range: 71–877), totaling 1046498 bp (104735 for <italic>D. melanogaster</italic> alone).</p>
</sec><sec id="s4b">
<title>Models</title>
<p>A <italic>phylogenetic pair hidden Markov model</italic> (PPHMM) <italic>M</italic> = (<italic>Q</italic>,<italic>A</italic>,<italic>P<sub>t</sub></italic>,<italic>S</italic>) consists of a set of states <italic>Q</italic>, an alphabet <italic>A</italic> which we take here to be the nucleotide alphabet, a state transition function <italic>P<sub>t</sub></italic>(<italic>q<sub>j</sub></italic>|<italic>q<sub>i</sub></italic>) giving the probability of transitioning from state <italic>q<sub>i</sub></italic> to <italic>q<sub>j</sub></italic>, and a conditional substitution matrix <italic>S</italic> giving the probability of one symbol from <italic>A</italic> being substituted by another symbol from <italic>A</italic>, conditional on state <italic>q</italic>: <italic>P</italic>(<italic>a</italic><sub>2</sub>|<italic>a</italic><sub>1</sub>,<italic>q</italic>). A PPHMM can be instantiated from a PPHMM template <italic>T</italic> = (<italic>Q</italic>,<italic>A</italic>,<italic>C<sub>t</sub></italic>,<italic>R</italic>), where <italic>Q</italic> and <italic>A</italic> are as defined above, <italic>C<sub>t</sub></italic> is a set of <italic>closures C<sub>t</sub></italic>(<italic>q<sub>j</sub></italic>|<italic>q<sub>i</sub></italic>,<italic>t</italic>) giving the probability of transitioning from state <italic>q<sub>i</sub></italic> to <italic>q<sub>j</sub></italic> conditional on a time parameter <italic>t</italic>, and conditional substitution rate matrix <italic>R</italic> gives the instantaneous substitution rates between symbols in <italic>A</italic> (conditional on state). Given a branch of length <italic>t</italic> in a phylogeny, a PPHMM for that branch can be instantiated via <italic>M</italic> = (<italic>Q</italic>,<italic>A</italic>,<italic>C<sub>t</sub></italic>(<italic>t</italic>),<italic>e<sup>tR</sup></italic>), where <italic>C<sub>t</sub></italic>(<italic>t</italic>) denotes the function <italic>P<sub>t</sub></italic>(<italic>q<sub>j</sub></italic>|<italic>q<sub>i</sub></italic>) = <italic>C<sub>t</sub></italic>(<italic>q<sub>j</sub></italic>|<italic>q<sub>i</sub></italic>,<italic>t</italic>). PPHMM templates can be specified compactly in our system using the <italic>SEAL</italic> modeling language, as described in <xref ref-type="supplementary-material" rid="pcbi.1001037.s001">Text S1</xref>.</p>
<p>For the experiments reported here, we implemented binding-site profiles (for “retention” events—i.e., no gain or loss of function) via a linear sequence of PPHMM states trained via the Halpern-Bruno construction <xref ref-type="bibr" rid="pcbi.1001037-Halpern1">[31]</xref> as applied to a JASPAR matrix. (The Halpern-Bruno construction provides a means of obtaining a substitution rate matrix for a foreground class, given a reversible background substitution rate matrix and a foreground equilibrium distribution). Phylogenies were constructed via the neighbor-joining algorithm <xref ref-type="bibr" rid="pcbi.1001037-Saitou1">[32]</xref>. Pre-constructed alignments used for training MAFIA and as input to competing programs were built using MUSCLE. All substitution rate matrices were general time-reversible models. Training of rate matrices was carried out as described previously <xref ref-type="bibr" rid="pcbi.1001037-Majoros2">[33]</xref>.</p>
<p>Our background model for these experiments (<xref ref-type="fig" rid="pcbi-1001037-g001">Figure 1</xref>) consisted of three states (an <italic>insert</italic>, <italic>match</italic>, and <italic>delete</italic> state) trained from the MUSCLE training alignments. The model is affine, since the probability of a transition from the match state to an indel state can differ from the self-transition probabilities within the indel states. The model is also <italic>reversible</italic> (or <italic>symmetric</italic>) in the sense that identical alignments are produced whether sequence A is aligned to B or B is aligned to A; many popular models (e.g., TKF91—<xref ref-type="bibr" rid="pcbi.1001037-Thorne1">[34]</xref>; SPH08—<xref ref-type="bibr" rid="pcbi.1001037-Satija1">[4]</xref>) do not have this property. The probability <italic>s</italic> = <italic>s</italic>(<italic>t</italic>) of leaving the background model is given by <italic>s</italic>(<italic>t</italic>) = 1<monospace>-</monospace>(1<monospace>-</monospace><italic>b</italic><sub>∞</sub>)(1<monospace>-</monospace><italic>b</italic>(<italic>t</italic>)), for <italic>b</italic><sub>∞</sub> = lim<italic><sub>t</sub></italic><sub>→∞</sub><italic>b</italic>(<italic>t</italic>), where <italic>b</italic>(<italic>t</italic>) is the <italic>gain probability</italic> for binding sites (to be defined shortly); <italic>s</italic>(<italic>t</italic>) dictates the density of binding sites. <italic>α</italic> and <italic>β</italic> are parameters to the model; their relative values influence the frequency and average lengths of gaps.</p>
<p>Binding-site gain and loss events were modeled using PPHMMs of the form depicted in <xref ref-type="fig" rid="pcbi-1001037-g002">Figure 2</xref>. The top half of each state in the figure is labeled with the functional class of the ancestral residue, while the bottom half is labeled with the class of the descendent residue; <italic>bg</italic> represents the background functional class, <italic>W<sub>i</sub></italic> represents the functional class for the <italic>i</italic><sup>th</sup> column of the corresponding binding profile, and a dash indicates a gap rather than a residue, in the case of insertion and deletion states. (For retention states the ancestral and descendent functional classes would be identical). Transition probabilities (denoted <italic>a</italic>, <italic>b</italic>, <italic>c</italic>, …, <italic>n</italic> in the figure) are derived from the background model (see Figure S1 in <xref ref-type="supplementary-material" rid="pcbi.1001037.s001">Text S1</xref>). This model enforces the constraint that indels are not permitted inside functional binding sites, but permits them to occur in non-functional sequences orthologous to functional binding sites.</p>
<p>An example illustrating the utility of these indel states in the gain/loss submodels is given in Figures S4 and S5 in <xref ref-type="supplementary-material" rid="pcbi.1001037.s001">Text S1</xref>. As shown in the figure it is quite possible to have strong matches to a binding site profile in several organisms while one or more other organisms show clear nucleotide homology with those sites without retaining a strong match to the binding site profile. Without indel states in the gain/loss submodels, these (putatively) orthologous non-functional nucleotides would often be incapable of aligning with the putative binding sites in the other sequences, and would contribute more gaps to the alignment.</p>
<p>The background, retention, gain, and loss submodels were merged into a single PPHMM template which was then used to instantiate the models used for the computational experiments. Because transitions between submodels were constrained for these experiments to be between the background submodel and a foreground (gain/loss/retention) submodel (see <xref ref-type="fig" rid="pcbi-1001037-g003">Figure 3</xref>), transitions between submodels were governed by the probabilities for gain, loss, and retention events on binding sites; these are described next.</p>
<p>Gain, loss, and retention events were modeled via a stochastic birth-death process, as follows. Let <italic>A</italic> be an ancestral taxon having a descendant <italic>D</italic>, with <italic>D</italic> following <italic>A</italic> by <italic>t</italic> time units. For any binding site present in <italic>A</italic>'s genome, <italic>p</italic>(<italic>t</italic>) will denote the probability that the orthologous site in <italic>D</italic> is a functional binding site (for the same factor), while <italic>q</italic>(<italic>t</italic>) will denote the probability that the site is not functional in <italic>D</italic>. We model the time evolution of <italic>p</italic>(<italic>t</italic>) and <italic>q</italic>(<italic>t</italic>) via the following set of differential equations:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1001037.e005" xlink:type="simple"/><label>(5)</label></disp-formula>with initial conditions <italic>q</italic>(0) = 0 and <italic>p</italic>(0) = 1; parameter <italic>λ</italic> is the instantaneous <italic>birth rate</italic>, while <italic>µ</italic> is the instantaneous <italic>death rate</italic>. The above system admits the following solution:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1001037.e006" xlink:type="simple"/><label>(6)</label></disp-formula>For any vacant interval of the proper size in the ancestral genome (lacking a binding site of any kind), we denote by <italic>b</italic>(<italic>t</italic>) the probability that the orthologous site in the descendant will now be a functional binding site for some transcription factor:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1001037.e007" xlink:type="simple"/><label>(7)</label></disp-formula>This equation admits the following solution:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1001037.e008" xlink:type="simple"/><label>(8)</label></disp-formula>The limit of this term, lim<italic><sub>t</sub></italic><sub>→∞</sub><italic>b</italic>(<italic>t</italic>) = <italic>b</italic><sub>∞</sub> = <italic>λ</italic>/(<italic>λ</italic>+<italic>µ</italic>), provides the probability for leaving the background state. The probabilities of entering a gain, loss, or retention submodel are derived from <italic>b</italic>(<italic>t</italic>), <italic>q</italic>(<italic>t</italic>), and <italic>p</italic>(<italic>t</italic>), respectively. We call <italic>b</italic>(<italic>t</italic>) the <italic>gain probability</italic>, <italic>q</italic>(<italic>t</italic>) the <italic>loss probability</italic>, and <italic>p</italic>(<italic>t</italic>) the <italic>retention probability</italic>.</p>
<p>Evolutionary rates of individual nucleotides in gain and loss states are assessed in MAFIA via a mixture model combining the foreground and background substitution rates. Let <italic>B</italic> and <italic>b</italic> denote two different functional classes, <italic>B</italic> for the ancestor and <italic>b</italic> for the descendant. <bold>P</bold><italic><sub>B</sub></italic>(<italic>t</italic>) and <bold>P</bold><italic><sub>b</sub></italic>(<italic>t</italic>) denote the respective substitution matrices for these classes. The mixture substitution model <bold>P</bold><italic><sub>B</sub></italic><sub>→<italic>b</italic></sub>(<italic>t</italic>) is given by:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1001037.e009" xlink:type="simple"/><label>(9)</label></disp-formula>where <bold>M</bold><italic><sub>i</sub></italic> and <bold>M</bold><italic><sub>i</sub></italic><monospace><sup>−</sup></monospace><sup>1</sup> are found via spectral decomposition of <bold>Q</bold><italic><sub>b</sub></italic> or <bold>Q</bold><italic><sub>B</sub></italic> (the instantaneous rate matrices from which the corresponding <bold>P</bold>(<italic>t</italic>) matrices are derived), and <italic>B<sub>ij</sub></italic> is given by:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1001037.e010" xlink:type="simple"/><label>(10)</label></disp-formula>for <italic>λ<sub>kj</sub></italic> the eigenvalues resulting from the spectral decompositions. <bold>P</bold><italic><sub>B</sub></italic><sub>→<italic>b</italic></sub>(<italic>t</italic>) is used in assessing substitution probabilities in any cross-functional state having ancestral functional class <italic>B</italic> and descendent class <italic>b</italic> (<italic>B</italic>≠<italic>b</italic>).</p>
</sec><sec id="s4c">
<title>Algorithms</title>
<p>MAFIA performs multiple-sequence alignment using a bottom-up progressive alignment approach followed by a top-down refinement step, as described in the <xref ref-type="sec" rid="s2">Results</xref>. During the bottom-up progressive phase, a modified version of Felsenstein's algorithm <xref ref-type="bibr" rid="pcbi.1001037-Felsenstein1">[35]</xref>, which we call <italic>Lossy Felsenstein</italic>, is used; this algorithm permits retention and loss events, but not gain events, in order to promote sensitivity and reduce greedy behavior. Once the progressive up-pass is complete, we apply Dollo parsimony <xref ref-type="bibr" rid="pcbi.1001037-Quesne1">[36]</xref> in an attempt to filter spurious ancestral nucleotides that were too liberally propagated up the tree during the up-pass; Dollo parsimony effectively finds the clades where individual features were first introduced by evolution (according to a parsimony criterion). Finally, we apply a down-pass to remove any inconsistencies introduced by the Dollo procedure.</p>
<p>During the up-pass, each pair of sibling taxa in the phylogeny are aligned by performing Viterbi decoding <xref ref-type="bibr" rid="pcbi.1001037-Viterbi1">[37]</xref>; emission probabilities are computed via Felsenstein pruning, as previously noted. The PPHMM for this sibling-alignment step is obtained by instantiating the PPHMM template on a branch of length <italic>t</italic><sub>1</sub>+<italic>t</italic><sub>2</sub>, where <italic>t</italic><sub>1</sub> is the branch length between the left sibling and its parent in the tree, and <italic>t</italic><sub>2</sub> is the length of the branch between the right sibling and its parent. This step differs from the sibling alignment step in the approach of Holmes and Bruno <xref ref-type="bibr" rid="pcbi.1001037-Holmes1">[26]</xref>, who instead compose the transducers on the two sibling branches into a single “triple HMM” with an enlarged state space. Decoding of the triple HMM will produce a pair of alignments: one between each sibling and its parent. Composing pair HMMs with hundreds of states each into a triple HMM would result in a vastly larger state space, so we instead construct the PPHMM for aligning the siblings directly, as previously stated. This results in an alignment <italic>A<sub>LR</sub></italic> between siblings <italic>L</italic> and <italic>R</italic>. In order to obtain alignments <italic>A<sub>PL</sub></italic> and <italic>A<sub>PR</sub></italic> between parent <italic>P</italic> and each sibling, we assume (only during the up-pass) that all residues in either sibling are present in the parent; this produces unambiguous alignments between the parent and each sibling, while retaining a similar flavor to the Lossy Felsenstein algorithm described above (since it permits only deletions and matches during the up-pass). Though this strategy favors increasing sequence lengths for taxa higher in the tree, the Dollo parsimony procedure performed after the up-pass reduces sequence lengths by identifying clades where (according to the Dollo principle) a nucleotide should be considered to have originated.</p>
<p>During the down-pass, the PPHMM instantiated at each branch in the phylogeny is used to re-align the ancestral and descendent taxa at either end of the branch. Because non-leaf taxa are unobservable, this procedure effectively re-aligns species inside the child clade (as a unit) to all species outside the child clade (as a unit). Emission probabilities are computed using a variant of Felsenstein's algorithm which finds the maximum probability over all gain/loss histories; we call this variant <italic>Gain-Loss Felsenstein</italic> (see <xref ref-type="supplementary-material" rid="pcbi.1001037.s001">Text S1</xref>). For these down-pass re-alignment steps, a constrained variant of Viterbi decoding is used, which considers only state paths which respect the <italic>functional parse</italic> (assignment of functional classes to residues) of the ancestral sequence; the very first re-alignment step of the down-pass utilizes unconstrained Viterbi decoding to obtain a functional parse for the root sequence (this root decoding step is essentially equivalent to a standard Phylo-HMM). Once the down-pass completes, all sequences (including ancestral sequences) will have been assigned a functional parse, from which binding site predictions are extracted.</p>
<p>Evaluation of emission probabilities in gain and loss states is performed via:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1001037.e011" xlink:type="simple"/><label>(11)</label></disp-formula>where <italic>P</italic>(<italic>b</italic>|<italic>B</italic>) is given by the birth-death equations described above, <italic>x</italic> is a nucleotide, <italic>C</italic>(<italic>u</italic>) are the children of <italic>u</italic>, Δ is the nucleotide alphabet, and <italic>P</italic>(<italic>y</italic>|<italic>x</italic>,<italic>θ<sub>B</sub></italic><sub>→<italic>b</italic></sub>) imposes the substitution mixture model <italic>θ<sub>B</sub></italic><sub>→<italic>b</italic></sub> for the current state, <italic>q</italic>. This formula produces a conditional likelihood, <italic>P</italic>(<bold>S</bold><italic><sub>leaves</sub></italic>|<italic>S<sub>root</sub></italic>,<italic>q</italic>)  =  <italic>L<sub>root</sub></italic>(<italic>S<sub>root</sub></italic>,<italic>B</italic>) for <italic>S<sub>root</sub></italic> the (unobserved) residue at the clade root and <bold>S</bold><italic><sub>leaves</sub></italic> the set of (observed) residues at the leaves of the clade. To obtain a marginal likelihood, <italic>P</italic>(<bold>S</bold><italic><sub>leaves</sub></italic>|<italic>q</italic>), we compute ∑<italic><sub>x</sub>L<sub>root</sub></italic>(<italic>x</italic>,<italic>B</italic>)<italic>P<sub>eq</sub></italic>(<italic>x</italic>|<italic>B</italic>), for <italic>P<sub>eq</sub></italic>(<italic>x</italic>|<italic>B</italic>) the equilibrium nucleotide frequency obtained from the substitution matrix for the class <italic>B</italic> implied by state <italic>q</italic>.</p>
<p>Detailed descriptions of all algorithms referenced above are given in <xref ref-type="supplementary-material" rid="pcbi.1001037.s001">Text S1</xref>.</p>
</sec><sec id="s4d">
<title>Training and Evaluation</title>
<p>For the experiments described here, the following protocols were observed for training and application of the software. Parameters <italic>α</italic> and <italic>β</italic> were trained via simple counts taken from a training alignment. <italic>λ</italic> and <italic>µ</italic> were constrained via <italic>λ</italic> = <italic>δµ</italic>/(1<monospace>-</monospace><italic>δ</italic>) for <italic>δ</italic> the estimated density of binding sites in training data, and then optimized to maximize site-level prediction accuracy on training data (for <italic>Drosophila</italic> experiments <italic>µ</italic> was fixed at 0.08 as early runs indicated little or no advantage to changing this value); because these were trained discriminatively they need not reflect the actual birth and death rates along ancestral lineages. Relative frequencies for individual transcription factors were estimated from training data as well, and were used to scale the probabilities of transitions entering submodels for individual factors; an additional multiplicative term of 0.5 was applied, since we included a forward and reverse-strand submodel for each factor. Two additional multiplicative factors were introduced into the model after it was observed in simulations that they could improve the discriminative power of the predictor: an indel coefficient <italic>c<sub>indel</sub></italic> which was applied to <italic>α</italic> and <italic>β</italic>, and a branch coefficient <italic>c<sub>branch</sub></italic>, which was applied to all branch lengths in the phylogeny. The need for such “fudge factors” in improving the discriminative power of generative models has been well-documented, particularly in the context of cross-species gene prediction <xref ref-type="bibr" rid="pcbi.1001037-Majoros1">[9]</xref>, and more recently in cross-species binding-site prediction <xref ref-type="bibr" rid="pcbi.1001037-Ray1">[7]</xref>. These coefficients were optimized by maximizing the predictive accuracy of the model on the training data via hill-climbing (with site-level <italic>F</italic>-score as the objective function). The background substitution rate matrix was trained via gradient ascent on training alignments; foreground rate matrices (one for each position in each factor's binding profile) were trained via the Halpern-Bruno construction, as mentioned previously. Branch lengths for the phylogeny were estimated simultaneously with the background rate matrix via gradient ascent (since rates and times are confounded). Note that these branch lengths are likely to be less suitable for use in computing the transition and gain/loss probabilities, since they were estimated specifically to maximize the likelihood of the (background) substitution matrix only. This likely accounts for the improvement observed when <italic>c<sub>branch</sub></italic> was incorporated into the model; in the future we intend to instead estimate separate branch lengths for these other components of the model. The model currently has very few free parameters, despite having many hundreds of states: <italic>α</italic>, <italic>β</italic>, <italic>λ</italic>, <italic>µ</italic>, <italic>δ</italic>, <italic>c<sub>indel</sub></italic>, <italic>c<sub>branch</sub></italic>, a relative density for each factor, the phylogeny branch lengths, and the parameters of the background rate matrix (6 for GTR); binding site profiles (positional weight matrices) were obtained from external sources and were not estimated directly by us (though we arbitrarily added pseudocounts of 0.1). Score thresholds for PhyloGibbs and rMONKEY predictions were optimized via cross-validation; overlapping predictions were disambiguated by selecting the highest scoring sites.</p>
<p>For the ROC-like curves, we obtained Bowtie <xref ref-type="bibr" rid="pcbi.1001037-Langmead1">[38]</xref> alignments of ChIP-seq reads from Bradley <italic>et al.</italic> <xref ref-type="bibr" rid="pcbi.1001037-Bradley1">[24]</xref> and subjected these to the F-Seq program <xref ref-type="bibr" rid="pcbi.1001037-Boyle1">[25]</xref>; F-Seq scores were normalized using total-chromatin files provided by Bradley <italic>et al.</italic> <xref ref-type="bibr" rid="pcbi.1001037-Bradley1">[24]</xref>. We then applied 1000 cutoff values to the resulting F-Seq profiles to obtain intervals of varying sizes around putative binding sites. At each cutoff we evaluated sensitivity and false positive rates for a fixed set of predictions and plotted these as in a standard ROC curve. The resulting curve was smoothed by averaging values in a fixed-length window; identical smoothing parameters were applied to all curves.</p>
</sec></sec><sec id="s5">
<title>Supporting Information</title>
<supplementary-material id="pcbi.1001037.s001" mimetype="application/msword" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1001037.s001" xlink:type="simple"><label>Text S1</label><caption>
<p>Detailed description of algorithms and models discussed in the manuscript, additional results, and additional methods.</p>
<p>(1.64 MB DOC)</p>
</caption></supplementary-material></sec></body>
<back>
<ack>
<p>David Corcoran provided advice regarding ChIP-Seq analyses. Stefano Guerra assisted with matrix computations.</p>
</ack>
<ref-list>
<title>References</title>
<ref id="pcbi.1001037-Gumucio1"><label>1</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Gumucio</surname><given-names>DL</given-names></name>
<name name-style="western"><surname>Heilstedt-Williamson</surname><given-names>H</given-names></name>
<name name-style="western"><surname>Gray</surname><given-names>TA</given-names></name>
<name name-style="western"><surname>Tarlé</surname><given-names>SA</given-names></name>
<name name-style="western"><surname>Shelton</surname><given-names>DA</given-names></name>
<etal/></person-group>             <year>1992</year>             <article-title>Phylogenetic footprinting reveals a nuclear protein which binds to silencer sequences in the human gamma and epsilon globin genes.</article-title>             <source>Mol Cell Biol</source>             <volume>12</volume>             <fpage>4919</fpage>             <lpage>29</lpage>          </element-citation></ref>
<ref id="pcbi.1001037-Huang1"><label>2</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Huang</surname><given-names>W</given-names></name>
<name name-style="western"><surname>Nevins</surname><given-names>JR</given-names></name>
<name name-style="western"><surname>Ohler</surname><given-names>U</given-names></name>
</person-group>             <year>2007</year>             <article-title>Phylogenetic simulation of promoter evolution: estimation and modeling of binding site turnover events and assessment of their impact on alignment tools.</article-title>             <source>Genome Biol</source>             <volume>8</volume>             <fpage>R225</fpage>          </element-citation></ref>
<ref id="pcbi.1001037-Wong1"><label>3</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Wong</surname><given-names>K</given-names></name>
<name name-style="western"><surname>Suchard</surname><given-names>M</given-names></name>
<name name-style="western"><surname>Huelsenbeck</surname><given-names>J</given-names></name>
</person-group>             <year>2008</year>             <article-title>Alignment uncertainty and genomic analysis.</article-title>             <source>Science</source>             <volume>319</volume>             <fpage>473</fpage>             <lpage>476</lpage>          </element-citation></ref>
<ref id="pcbi.1001037-Satija1"><label>4</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Satija</surname><given-names>R</given-names></name>
<name name-style="western"><surname>Pachter</surname><given-names>L</given-names></name>
<name name-style="western"><surname>Hein</surname><given-names>J</given-names></name>
</person-group>             <year>2008</year>             <article-title>Combining statistical alignment and phylogenetic footprinting to detect regulatory elements.</article-title>             <source>Bioinformatics</source>             <volume>24</volume>             <fpage>1236</fpage>             <lpage>1242</lpage>          </element-citation></ref>
<ref id="pcbi.1001037-He1"><label>5</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>He</surname><given-names>X</given-names></name>
<name name-style="western"><surname>Ling</surname><given-names>S</given-names></name>
<name name-style="western"><surname>Sinha</surname><given-names>S</given-names></name>
</person-group>             <year>2009</year>             <article-title>Alignment and Prediction of cis-Regulatory Modules Based on a Probabilistic Model of Evolution.</article-title>             <source>PLoS Comput Biol</source>             <volume>5</volume>             <fpage>e1000299</fpage>          </element-citation></ref>
<ref id="pcbi.1001037-Moses1"><label>6</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Moses</surname><given-names>AM</given-names></name>
<name name-style="western"><surname>Pollard</surname><given-names>DA</given-names></name>
<name name-style="western"><surname>Nix</surname><given-names>DA</given-names></name>
<name name-style="western"><surname>Iyer</surname><given-names>VN</given-names></name>
<name name-style="western"><surname>Li</surname><given-names>XY</given-names></name>
<etal/></person-group>             <year>2006</year>             <article-title>Large-scale turnover of functional transcription factor binding sites in Drosophila.</article-title>             <source>PLoS Comput Biol</source>             <volume>2</volume>             <fpage>e130</fpage>          </element-citation></ref>
<ref id="pcbi.1001037-Ray1"><label>7</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Ray</surname><given-names>PR</given-names></name>
<name name-style="western"><surname>Shringarpure</surname><given-names>S</given-names></name>
<name name-style="western"><surname>Kolar</surname><given-names>M</given-names></name>
<name name-style="western"><surname>Xing</surname><given-names>EP</given-names></name>
</person-group>             <year>2008</year>             <article-title>CSMET: Comparative genomic motif detection via multi-resolution phylogenetic shadowing.</article-title>             <source>PLoS Comput Biol</source>             <volume>4</volume>             <fpage>e1000090</fpage>          </element-citation></ref>
<ref id="pcbi.1001037-Durbin1"><label>8</label><element-citation publication-type="other" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Durbin</surname><given-names>R</given-names></name>
<name name-style="western"><surname>Eddy</surname><given-names>S</given-names></name>
<name name-style="western"><surname>Krogh</surname><given-names>A</given-names></name>
<name name-style="western"><surname>Mitchison</surname><given-names>G</given-names></name>
</person-group>             <year>1998</year>             <article-title>Biological Sequence Analysis.</article-title>             <publisher-loc>Cambridge</publisher-loc>             <publisher-name>Cambridge University Press</publisher-name> <!--===== Restructure page-count as size[@units="page"] =====--><size units="page">356</size>           </element-citation></ref>
<ref id="pcbi.1001037-Majoros1"><label>9</label><element-citation publication-type="other" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Majoros</surname><given-names>WH</given-names></name>
</person-group>             <year>2007</year>             <article-title>Methods for Computational Gene Prediction.</article-title>             <publisher-loc>Cambridge</publisher-loc>             <publisher-name>Cambridge University Press</publisher-name> <!--===== Restructure page-count as size[@units="page"] =====--><size units="page">430</size>           </element-citation></ref>
<ref id="pcbi.1001037-Siepel1"><label>10</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Siepel</surname><given-names>A</given-names></name>
<name name-style="western"><surname>Haussler</surname><given-names>D</given-names></name>
</person-group>             <year>2004</year>             <article-title>Combining phylogenetic and hidden Markov models in biosequence analysis.</article-title>             <source>J Comput Biol</source>             <volume>11</volume>             <fpage>413</fpage>             <lpage>428</lpage>          </element-citation></ref>
<ref id="pcbi.1001037-Lusk1"><label>11</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Lusk</surname><given-names>RW</given-names></name>
<name name-style="western"><surname>Eisen</surname><given-names>MB</given-names></name>
</person-group>             <year>2010</year>             <article-title>Evolutionary mirages: selection on binding site composition creates the illusion of conserved grammars in Drosophila enhancers.</article-title>             <source>PLoS Genet</source>             <volume>6</volume>             <fpage>e1000829</fpage>          </element-citation></ref>
<ref id="pcbi.1001037-Loytynoja1"><label>12</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Loytynoja</surname><given-names>A</given-names></name>
<name name-style="western"><surname>Goldman</surname><given-names>N</given-names></name>
</person-group>             <year>2008</year>             <article-title>Phylogeny-aware gap placement prevents errors in sequence alignment and evolutionary analysis.</article-title>             <source>Science</source>             <volume>320</volume>             <fpage>1632</fpage>             <lpage>1635</lpage>          </element-citation></ref>
<ref id="pcbi.1001037-Wagner1"><label>13</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Wagner</surname><given-names>GP</given-names></name>
<name name-style="western"><surname>Otto</surname><given-names>W</given-names></name>
<name name-style="western"><surname>Lynch</surname><given-names>V</given-names></name>
<name name-style="western"><surname>Stadler</surname><given-names>PF</given-names></name>
</person-group>             <year>2007</year>             <article-title>A stochastic model for the evolution of transcription factor binding site abundance.</article-title>             <source>J Theor Biol</source>             <volume>247</volume>             <fpage>544</fpage>             <lpage>553</lpage>          </element-citation></ref>
<ref id="pcbi.1001037-Pollard1"><label>14</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Pollard</surname><given-names>DA</given-names></name>
<name name-style="western"><surname>Moses</surname><given-names>AM</given-names></name>
<name name-style="western"><surname>Iyer</surname><given-names>VN</given-names></name>
<name name-style="western"><surname>Eisen</surname><given-names>MB</given-names></name>
</person-group>             <year>2006</year>             <article-title>Detecting the limits of regulatory element conservation and divergence estimation using pairwise and multiple alignments.</article-title>             <source>BMC Bioinformatics</source>             <volume>7</volume>             <fpage>376</fpage>          </element-citation></ref>
<ref id="pcbi.1001037-Bryne1"><label>15</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Bryne</surname><given-names>JC</given-names></name>
<name name-style="western"><surname>Valen</surname><given-names>E</given-names></name>
<name name-style="western"><surname>Tang</surname><given-names>MH</given-names></name>
<name name-style="western"><surname>Marstrand</surname><given-names>T</given-names></name>
<name name-style="western"><surname>Winther</surname><given-names>O</given-names></name>
<etal/></person-group>             <year>2008</year>             <article-title>JASPAR, the open access database of transcription factor-binding profiles: new content and tools in the 2008 update.</article-title>             <source>Nucleic Acids Res</source>             <volume>36</volume>             <fpage>D102</fpage>             <lpage>6</lpage>          </element-citation></ref>
<ref id="pcbi.1001037-Edgar1"><label>16</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Edgar</surname><given-names>RC</given-names></name>
</person-group>             <year>2004</year>             <article-title>MUSCLE: multiple sequence alignment with high accuracy and high throughput.</article-title>             <source>Nucleic Acids Res</source>             <volume>32</volume>             <fpage>1792</fpage>             <lpage>97</lpage>          </element-citation></ref>
<ref id="pcbi.1001037-Thompson1"><label>17</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Thompson</surname><given-names>JD</given-names></name>
<name name-style="western"><surname>Higgins</surname><given-names>DG</given-names></name>
<name name-style="western"><surname>Gibson</surname><given-names>TJ</given-names></name>
</person-group>             <year>1994</year>             <article-title>CLUSTAL W: improving the sensitivity of progressive multiple sequence alignment through sequence weighting, position-specific gap penalties and weight matrix choice.</article-title>             <source>Nucleic Acids Res</source>             <volume>22</volume>             <fpage>4673</fpage>             <lpage>4680</lpage>          </element-citation></ref>
<ref id="pcbi.1001037-Halfon1"><label>18</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Halfon</surname><given-names>MS</given-names></name>
<name name-style="western"><surname>Gallo</surname><given-names>SM</given-names></name>
<name name-style="western"><surname>Bergman</surname><given-names>CM</given-names></name>
</person-group>             <year>2008</year>             <article-title>REDfly 2.0: an integrated database of cis-regulatory modules and transcription factor binding sites in Drosophila.</article-title>             <source>Nucleic Acids Res</source>             <volume>36</volume>             <fpage>D594</fpage>             <lpage>598</lpage>          </element-citation></ref>
<ref id="pcbi.1001037-Siddharthan1"><label>19</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Siddharthan</surname><given-names>R</given-names></name>
</person-group>             <year>2008</year>             <article-title>PhyloGibbs-MP: Module Prediction and Discriminative Motif-Finding by Gibbs Sampling.</article-title>             <source>PLoS Comput Biol</source>             <volume>4</volume>             <fpage>e1000156</fpage>          </element-citation></ref>
<ref id="pcbi.1001037-Hirschberg1"><label>20</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Hirschberg</surname><given-names>DS</given-names></name>
</person-group>             <year>1975</year>             <article-title>A linear space algorithm for computing maximal common subsequences.</article-title>             <source>Commun ACM</source>             <volume>18</volume>             <fpage>341</fpage>             <lpage>343</lpage>          </element-citation></ref>
<ref id="pcbi.1001037-Ludwig1"><label>21</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Ludwig</surname><given-names>MZ</given-names></name>
<name name-style="western"><surname>Kreitman</surname><given-names>M</given-names></name>
</person-group>             <year>1995</year>             <article-title>Evolutionary dynamics of the enhancer region of even-skipped in Drosophila.</article-title>             <source>Mol Biol Evol</source>             <volume>12</volume>             <fpage>1002</fpage>             <lpage>1011</lpage>          </element-citation></ref>
<ref id="pcbi.1001037-Stanojevic1"><label>22</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Stanojevic</surname><given-names>D</given-names></name>
<name name-style="western"><surname>Small</surname><given-names>S</given-names></name>
<name name-style="western"><surname>Levine</surname><given-names>M</given-names></name>
</person-group>             <year>1991</year>             <article-title>Regulation of a segmentation stripe by overlapping activators and repressors in the <italic>Drosophila</italic> embryo.</article-title>             <source>Science</source>             <volume>254</volume>             <fpage>1385</fpage>             <lpage>1387</lpage>          </element-citation></ref>
<ref id="pcbi.1001037-Hawkins1"><label>23</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Hawkins</surname><given-names>J</given-names></name>
<name name-style="western"><surname>Grant</surname><given-names>C</given-names></name>
<name name-style="western"><surname>Noble</surname><given-names>WS</given-names></name>
<name name-style="western"><surname>Bailey</surname><given-names>TL</given-names></name>
</person-group>             <year>2009</year>             <article-title>Assessing phylogenetic motif models for predicting transcription factor binding sites.</article-title>             <source>Bioinformatics</source>             <volume>12</volume>             <fpage>i339</fpage>             <lpage>i347</lpage>          </element-citation></ref>
<ref id="pcbi.1001037-Bradley1"><label>24</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Bradley</surname><given-names>RK</given-names></name>
<name name-style="western"><surname>Li</surname><given-names>X-Y</given-names></name>
<name name-style="western"><surname>Trapnell</surname><given-names>C</given-names></name>
<name name-style="western"><surname>Davidson</surname><given-names>S</given-names></name>
<name name-style="western"><surname>Pachter</surname><given-names>L</given-names></name>
<etal/></person-group>             <year>2010</year>             <article-title>Binding Site Turnover Produces Pervasive Quantitative Changes in Transcription Factor Binding between Closely Related Drosophila Species.</article-title>             <source>PLoS Biol</source>             <volume>8</volume>             <fpage>e1000343</fpage>          </element-citation></ref>
<ref id="pcbi.1001037-Boyle1"><label>25</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Boyle</surname><given-names>AP</given-names></name>
<name name-style="western"><surname>Guinney</surname><given-names>J</given-names></name>
<name name-style="western"><surname>Crawford</surname><given-names>GE</given-names></name>
<name name-style="western"><surname>Furey</surname><given-names>TS</given-names></name>
</person-group>             <year>2008</year>             <article-title>F-Seq: a feature density estimator for high-throughput sequence tags.</article-title>             <source>Bioinformatics</source>             <volume>24</volume>             <fpage>2537</fpage>             <lpage>2538</lpage>          </element-citation></ref>
<ref id="pcbi.1001037-Holmes1"><label>26</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Holmes</surname><given-names>I</given-names></name>
<name name-style="western"><surname>Bruno</surname><given-names>WJ</given-names></name>
</person-group>             <year>2001</year>             <article-title>Evolutionary HMMs: a Bayesian approach to multiple alignment.</article-title>             <source>Bioinformatics</source>             <volume>17</volume>             <fpage>803</fpage>             <lpage>820</lpage>          </element-citation></ref>
<ref id="pcbi.1001037-Ludwig2"><label>27</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Ludwig</surname><given-names>MZ</given-names></name>
<name name-style="western"><surname>Palsson</surname><given-names>A</given-names></name>
<name name-style="western"><surname>Alekseeva</surname><given-names>E</given-names></name>
<name name-style="western"><surname>Bergman</surname><given-names>CM</given-names></name>
<name name-style="western"><surname>Nathan</surname><given-names>J</given-names></name>
<etal/></person-group>             <year>2005</year>             <article-title>Functional evolution of a cis regulatory module.</article-title>             <source>PLoS Biol</source>             <volume>3</volume>             <fpage>e93</fpage>          </element-citation></ref>
<ref id="pcbi.1001037-Wray1"><label>28</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Wray</surname><given-names>G</given-names></name>
</person-group>             <year>2007</year>             <article-title>The evolutionary significance of cis-regulatory mutations.</article-title>             <source>Nat Rev Genet</source>             <volume>8</volume>             <fpage>206</fpage>             <lpage>216</lpage>          </element-citation></ref>
<ref id="pcbi.1001037-Siepel2"><label>29</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Siepel</surname><given-names>A</given-names></name>
<name name-style="western"><surname>Bejerano</surname><given-names>G</given-names></name>
<name name-style="western"><surname>Pedersen</surname><given-names>JS</given-names></name>
<name name-style="western"><surname>Hinrichs</surname><given-names>AS</given-names></name>
<name name-style="western"><surname>Hou</surname><given-names>M</given-names></name>
<etal/></person-group>             <year>2005</year>             <article-title>Evolutionarily conserved elements in vertebrate, insect, worm, and yeast genomes.</article-title>             <source>Genome Res</source>             <volume>15</volume>             <fpage>1034</fpage>             <lpage>50</lpage>          </element-citation></ref>
<ref id="pcbi.1001037-Kent1"><label>30</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Kent</surname><given-names>WJ</given-names></name>
<name name-style="western"><surname>Sugnet</surname><given-names>CW</given-names></name>
<name name-style="western"><surname>Furey</surname><given-names>TS</given-names></name>
<name name-style="western"><surname>Roskin</surname><given-names>KM</given-names></name>
<name name-style="western"><surname>Pringle</surname><given-names>TH</given-names></name>
<etal/></person-group>             <year>2002</year>             <article-title>The human genome browser at UCSC.</article-title>             <source>Genome Res</source>             <volume>12</volume>             <fpage>996</fpage>             <lpage>1006</lpage>          </element-citation></ref>
<ref id="pcbi.1001037-Halpern1"><label>31</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Halpern</surname><given-names>AL</given-names></name>
<name name-style="western"><surname>Bruno</surname><given-names>WJ</given-names></name>
</person-group>             <year>1998</year>             <article-title>Evolutionary distances for protein-coding sequences: modeling site-specific residue frequencies.</article-title>             <source>Mol Biol Evol</source>             <volume>15</volume>             <fpage>910</fpage>             <lpage>917</lpage>          </element-citation></ref>
<ref id="pcbi.1001037-Saitou1"><label>32</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Saitou</surname><given-names>N</given-names></name>
<name name-style="western"><surname>Nei</surname><given-names>M</given-names></name>
</person-group>             <year>1987</year>             <article-title>The neighbor-joining method: a new method for reconstructing phylogenetic trees.</article-title>             <source>Mol Biol Evol</source>             <volume>4</volume>             <fpage>406</fpage>             <lpage>425</lpage>          </element-citation></ref>
<ref id="pcbi.1001037-Majoros2"><label>33</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Majoros</surname><given-names>WH</given-names></name>
<name name-style="western"><surname>Ohler</surname><given-names>U</given-names></name>
</person-group>             <year>2009</year>             <article-title>Complexity reduction in context-dependent DNA substitution models.</article-title>             <source>Bioinformatics</source>             <volume>25</volume>             <fpage>175</fpage>             <lpage>182</lpage>          </element-citation></ref>
<ref id="pcbi.1001037-Thorne1"><label>34</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Thorne</surname><given-names>JL</given-names></name>
<name name-style="western"><surname>Kishino</surname><given-names>H</given-names></name>
<name name-style="western"><surname>Felsenstein</surname><given-names>J</given-names></name>
</person-group>             <year>1991</year>             <article-title>An evolutionary model for maximum likelihood alignment of DNA sequences.</article-title>             <source>J Mol Evol</source>             <volume>33</volume>             <fpage>114</fpage>             <lpage>124</lpage>          </element-citation></ref>
<ref id="pcbi.1001037-Felsenstein1"><label>35</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Felsenstein</surname><given-names>J</given-names></name>
</person-group>             <year>1981</year>             <article-title>Evolutionary trees from DNA sequences.</article-title>             <source>J Mol Evol</source>             <volume>17</volume>             <fpage>368</fpage>             <lpage>376</lpage>          </element-citation></ref>
<ref id="pcbi.1001037-Quesne1"><label>36</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Quesne</surname><given-names>WJL</given-names></name>
</person-group>             <year>1974</year>             <article-title>The uniquely evolved character concept and its cladistic application.</article-title>             <source>Syst Zool</source>             <volume>23</volume>             <fpage>513</fpage>             <lpage>517</lpage>          </element-citation></ref>
<ref id="pcbi.1001037-Viterbi1"><label>37</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Viterbi</surname><given-names>A</given-names></name>
</person-group>             <year>1967</year>             <article-title>Error bounds for convolutional codes and an assymptotically optimal decoding algorithm.</article-title>             <source>IEEE Trans Inf Theory</source>             <volume>13</volume>             <fpage>260</fpage>             <lpage>269</lpage>          </element-citation></ref>
<ref id="pcbi.1001037-Langmead1"><label>38</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Langmead</surname><given-names>B</given-names></name>
<name name-style="western"><surname>Trapnell</surname><given-names>C</given-names></name>
<name name-style="western"><surname>Pop</surname><given-names>M</given-names></name>
<name name-style="western"><surname>Salzberg</surname><given-names>SL</given-names></name>
</person-group>             <year>2009</year>             <article-title>Ultrafast and memory-efficient alignment of short DNA sequences to the human genome.</article-title>             <source>Genome Biol</source>             <volume>10</volume>             <fpage>R25</fpage>          </element-citation></ref>
</ref-list>

</back>
</article>