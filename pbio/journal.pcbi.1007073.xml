<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="1.1d3" xml:lang="en">
<front>
<journal-meta>
<journal-id journal-id-type="nlm-ta">PLoS Comput Biol</journal-id>
<journal-id journal-id-type="publisher-id">plos</journal-id>
<journal-id journal-id-type="pmc">ploscomp</journal-id>
<journal-title-group>
<journal-title>PLOS Computational Biology</journal-title>
</journal-title-group>
<issn pub-type="ppub">1553-734X</issn>
<issn pub-type="epub">1553-7358</issn>
<publisher>
<publisher-name>Public Library of Science</publisher-name>
<publisher-loc>San Francisco, CA USA</publisher-loc>
</publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="publisher-id">PCOMPBIOL-D-18-01879</article-id>
<article-id pub-id-type="doi">10.1371/journal.pcbi.1007073</article-id>
<article-categories>
<subj-group subj-group-type="heading">
<subject>Research Article</subject>
</subj-group>
<subj-group subj-group-type="Discipline-v3"><subject>Physical sciences</subject><subj-group><subject>Physics</subject><subj-group><subject>Classical mechanics</subject><subj-group><subject>Continuum mechanics</subject><subj-group><subject>Fluid mechanics</subject><subj-group><subject>Fluid dynamics</subject><subj-group><subject>Fluid flow</subject></subj-group></subj-group></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Anatomy</subject><subj-group><subject>Digestive system</subject><subj-group><subject>Mouth</subject><subj-group><subject>Tongue</subject></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Medicine and health sciences</subject><subj-group><subject>Anatomy</subject><subj-group><subject>Digestive system</subject><subj-group><subject>Mouth</subject><subj-group><subject>Tongue</subject></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Anatomy</subject><subj-group><subject>Nervous system</subject><subj-group><subject>Central nervous system</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Medicine and health sciences</subject><subj-group><subject>Anatomy</subject><subj-group><subject>Nervous system</subject><subj-group><subject>Central nervous system</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Organisms</subject><subj-group><subject>Eukaryota</subject><subj-group><subject>Animals</subject><subj-group><subject>Vertebrates</subject><subj-group><subject>Amphibians</subject><subj-group><subject>Frogs</subject></subj-group></subj-group></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Computer and information sciences</subject><subj-group><subject>Network analysis</subject></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Medicine and health sciences</subject><subj-group><subject>Vascular medicine</subject><subj-group><subject>Blood pressure</subject></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Physical sciences</subject><subj-group><subject>Materials science</subject><subj-group><subject>Material properties</subject><subj-group><subject>Porosity</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Research and analysis methods</subject><subj-group><subject>Simulation and modeling</subject></subj-group></subj-group></article-categories>
<title-group>
<article-title>A new framework for assessing subject-specific whole brain circulation and perfusion using MRI-based measurements and a multi-scale continuous flow model</article-title>
<alt-title alt-title-type="running-head">Assessment of whole brain perfusion</alt-title>
</title-group>
<contrib-group>
<contrib contrib-type="author" corresp="yes" xlink:type="simple">
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0003-2828-1521</contrib-id>
<name name-style="western">
<surname>Hodneland</surname> <given-names>Erlend</given-names></name>
<role content-type="http://credit.casrai.org/">Conceptualization</role>
<role content-type="http://credit.casrai.org/">Funding acquisition</role>
<role content-type="http://credit.casrai.org/">Methodology</role>
<role content-type="http://credit.casrai.org/">Resources</role>
<role content-type="http://credit.casrai.org/">Software</role>
<role content-type="http://credit.casrai.org/">Writing – original draft</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff001"><sup>1</sup></xref>
<xref ref-type="aff" rid="aff002"><sup>2</sup></xref>
<xref ref-type="corresp" rid="cor001">*</xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<name name-style="western">
<surname>Hanson</surname> <given-names>Erik</given-names></name>
<role content-type="http://credit.casrai.org/">Funding acquisition</role>
<role content-type="http://credit.casrai.org/">Methodology</role>
<role content-type="http://credit.casrai.org/">Software</role>
<role content-type="http://credit.casrai.org/">Validation</role>
<role content-type="http://credit.casrai.org/">Writing – original draft</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff003"><sup>3</sup></xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<name name-style="western">
<surname>Sævareid</surname> <given-names>Ove</given-names></name>
<role content-type="http://credit.casrai.org/">Conceptualization</role>
<role content-type="http://credit.casrai.org/">Methodology</role>
<role content-type="http://credit.casrai.org/">Software</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff001"><sup>1</sup></xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0003-2497-198X</contrib-id>
<name name-style="western">
<surname>Nævdal</surname> <given-names>Geir</given-names></name>
<role content-type="http://credit.casrai.org/">Conceptualization</role>
<role content-type="http://credit.casrai.org/">Funding acquisition</role>
<role content-type="http://credit.casrai.org/">Methodology</role>
<role content-type="http://credit.casrai.org/">Resources</role>
<role content-type="http://credit.casrai.org/">Validation</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff001"><sup>1</sup></xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<name name-style="western">
<surname>Lundervold</surname> <given-names>Arvid</given-names></name>
<role content-type="http://credit.casrai.org/">Conceptualization</role>
<role content-type="http://credit.casrai.org/">Funding acquisition</role>
<xref ref-type="aff" rid="aff002"><sup>2</sup></xref>
<xref ref-type="aff" rid="aff004"><sup>4</sup></xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<name name-style="western">
<surname>Šoltészová</surname> <given-names>Veronika</given-names></name>
<role content-type="http://credit.casrai.org/">Visualization</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff001"><sup>1</sup></xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<name name-style="western">
<surname>Munthe-Kaas</surname> <given-names>Antonella Z.</given-names></name>
<role content-type="http://credit.casrai.org/">Funding acquisition</role>
<role content-type="http://credit.casrai.org/">Methodology</role>
<role content-type="http://credit.casrai.org/">Project administration</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff002"><sup>2</sup></xref>
<xref ref-type="aff" rid="aff003"><sup>3</sup></xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<name name-style="western">
<surname>Deistung</surname> <given-names>Andreas</given-names></name>
<role content-type="http://credit.casrai.org/">Data curation</role>
<role content-type="http://credit.casrai.org/">Validation</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff005"><sup>5</sup></xref>
<xref ref-type="aff" rid="aff006"><sup>6</sup></xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<name name-style="western">
<surname>Reichenbach</surname> <given-names>Jürgen R.</given-names></name>
<role content-type="http://credit.casrai.org/">Conceptualization</role>
<role content-type="http://credit.casrai.org/">Data curation</role>
<role content-type="http://credit.casrai.org/">Validation</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff005"><sup>5</sup></xref>
<xref ref-type="aff" rid="aff007"><sup>7</sup></xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0003-1455-5704</contrib-id>
<name name-style="western">
<surname>Nordbotten</surname> <given-names>Jan M.</given-names></name>
<role content-type="http://credit.casrai.org/">Conceptualization</role>
<role content-type="http://credit.casrai.org/">Formal analysis</role>
<role content-type="http://credit.casrai.org/">Funding acquisition</role>
<role content-type="http://credit.casrai.org/">Methodology</role>
<role content-type="http://credit.casrai.org/">Resources</role>
<role content-type="http://credit.casrai.org/">Software</role>
<role content-type="http://credit.casrai.org/">Validation</role>
<role content-type="http://credit.casrai.org/">Writing – original draft</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff003"><sup>3</sup></xref>
</contrib>
</contrib-group>
<aff id="aff001">
<label>1</label>
<addr-line>Norwegian Research Centre, Bergen, Norway</addr-line>
</aff>
<aff id="aff002">
<label>2</label>
<addr-line>Mohn Medical Imaging and Visualization Centre, Department of Radiology, Haukeland Universitetssykehus, Bergen, Norway</addr-line>
</aff>
<aff id="aff003">
<label>3</label>
<addr-line>Department of Mathematics, University of Bergen, Bergen, Norway</addr-line>
</aff>
<aff id="aff004">
<label>4</label>
<addr-line>Department of Biomedicine, University of Bergen, Bergen, Norway</addr-line>
</aff>
<aff id="aff005">
<label>5</label>
<addr-line>Medical Physics Group, Institute of Diagnostic and Interventional Radiology, Jena University Hospital - Friedrich Schiller University Jena, Germany</addr-line>
</aff>
<aff id="aff006">
<label>6</label>
<addr-line>Department of Neurology, Essen University Hospital, Essen, Germany</addr-line>
</aff>
<aff id="aff007">
<label>7</label>
<addr-line>Michael Stifel Center Jena for Data-driven and Simulation Science, Friedrich Schiller University, Jena, Germany</addr-line>
</aff>
<contrib-group>
<contrib contrib-type="editor" xlink:type="simple">
<name name-style="western">
<surname>Marsden</surname> <given-names>Alison L</given-names></name>
<role>Editor</role>
<xref ref-type="aff" rid="edit1"/>
</contrib>
</contrib-group>
<aff id="edit1">
<addr-line>Stanford University, UNITED STATES</addr-line>
</aff>
<author-notes>
<fn fn-type="conflict" id="coi001">
<p>The authors have declared that no competing interests exist.</p>
</fn>
<corresp id="cor001">* E-mail: <email xlink:type="simple">erlend.hodneland@norceresearch.no</email></corresp>
</author-notes>
<pub-date pub-type="collection">
<month>6</month>
<year>2019</year>
</pub-date>
<pub-date pub-type="epub">
<day>25</day>
<month>6</month>
<year>2019</year>
</pub-date>
<volume>15</volume>
<issue>6</issue>
<elocation-id>e1007073</elocation-id>
<history>
<date date-type="received">
<day>7</day>
<month>11</month>
<year>2018</year>
</date>
<date date-type="accepted">
<day>7</day>
<month>5</month>
<year>2019</year>
</date>
</history>
<permissions>
<copyright-year>2019</copyright-year>
<copyright-holder>Hodneland et al</copyright-holder>
<license xlink:href="http://creativecommons.org/licenses/by/4.0/" xlink:type="simple">
<license-p>This is an open access article distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/" xlink:type="simple">Creative Commons Attribution License</ext-link>, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p>
</license>
</permissions>
<self-uri content-type="pdf" xlink:href="info:doi/10.1371/journal.pcbi.1007073"/>
<abstract>
<p>A large variety of severe medical conditions involve alterations in microvascular circulation. Hence, measurements or simulation of circulation and perfusion has considerable clinical value and can be used for diagnostics, evaluation of treatment efficacy, and for surgical planning. However, the accuracy of traditional tracer kinetic one-compartment models is limited due to scale dependency. As a remedy, we propose a scale invariant mathematical framework for simulating whole brain perfusion. The suggested framework is based on a segmentation of anatomical geometry down to imaging voxel resolution. Large vessels in the arterial and venous network are identified from time-of-flight (ToF) and quantitative susceptibility mapping (QSM). Macro-scale flow in the large-vessel-network is accurately modelled using the Hagen-Poiseuille equation, whereas capillary flow is treated as two-compartment porous media flow. Macro-scale flow is coupled with micro-scale flow by a spatially distributing support function in the terminal endings. Perfusion is defined as the transition of fluid from the arterial to the venous compartment. We demonstrate a whole brain simulation of tracer propagation on a realistic geometric model of the human brain, where the model comprises distinct areas of grey and white matter, as well as large vessels in the arterial and venous vascular network. Our proposed framework is an accurate and viable alternative to traditional compartment models, with high relevance for simulation of brain perfusion and also for restoration of field parameters in clinical brain perfusion applications.</p>
</abstract>
<abstract abstract-type="summary">
<title>Author summary</title>
<p>An accurate simulation of blood-flow in the human brain can be used for improved diagnostics and assignment of personalized treatment regimes. However, current algorithms are limited to simulation of blood flow within tumours only, and in terms of parameter estimation, traditional compartment models have limited accuracy due to lack of spatial connectivity within the models. As a remedy, we propose a data-driven computational fluid dynamics model where the geometric domains for simulation are defined from state-of-the art MR acquisitions enabling a segmentation of large arteries and veins. In the capillary tissue we apply a two-compartment porous media model, where the perfusion is pressure-driven and is defined as the transition of blood from arterial to venous side. In addition, we propose a model for dealing with the intermediate scale problem where the vessels are undetectable and the flow does not adhere to requirements of porous media flow. For this scale, we propose a support function distributing the fluid in a nearby region around the vessel terminals. Combining these elements, we have developed a novel full human brain blood-flow simulator.</p>
</abstract>
<funding-group>
<award-group id="award001">
<funding-source>
<institution-wrap>
<institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/501100005416</institution-id>
<institution>Norges Forskningsråd</institution>
</institution-wrap>
</funding-source>
<award-id>#262203</award-id>
<principal-award-recipient>
<name name-style="western">
<surname>Munthe-Kaas</surname> <given-names>Antonella Z.</given-names></name>
</principal-award-recipient>
</award-group>
<award-group id="award002">
<funding-source>
<institution-wrap>
<institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/501100005416</institution-id>
<institution>Norges Forskningsråd</institution>
</institution-wrap>
</funding-source>
<award-id>#262203</award-id>
<principal-award-recipient>
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0003-2828-1521</contrib-id>
<name name-style="western">
<surname>Hodneland</surname> <given-names>Erlend</given-names></name>
</principal-award-recipient>
</award-group>
<award-group id="award003">
<funding-source>
<institution-wrap>
<institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/501100005416</institution-id>
<institution>Norges Forskningsråd</institution>
</institution-wrap>
</funding-source>
<award-id>#262203</award-id>
<principal-award-recipient>
<name name-style="western">
<surname>Hanson</surname> <given-names>Erik</given-names></name>
</principal-award-recipient>
</award-group>
<award-group id="award004">
<funding-source>
<institution-wrap>
<institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/501100005416</institution-id>
<institution>Norges Forskningsråd</institution>
</institution-wrap>
</funding-source>
<award-id>#262203</award-id>
<principal-award-recipient>
<name name-style="western">
<surname>Sævareid</surname> <given-names>Ove</given-names></name>
</principal-award-recipient>
</award-group>
<award-group id="award005">
<funding-source>
<institution-wrap>
<institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/501100005416</institution-id>
<institution>Norges Forskningsråd</institution>
</institution-wrap>
</funding-source>
<award-id>#262203</award-id>
<principal-award-recipient>
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0003-2497-198X</contrib-id>
<name name-style="western">
<surname>Nævdal</surname> <given-names>Geir</given-names></name>
</principal-award-recipient>
</award-group>
<award-group id="award006">
<funding-source>
<institution-wrap>
<institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/501100001659</institution-id>
<institution>Deutsche Forschungsgemeinschaft</institution>
</institution-wrap>
</funding-source>
<award-id>DFG, DE 2516/1-1</award-id>
<principal-award-recipient>
<name name-style="western">
<surname>Deistung</surname> <given-names>Andreas</given-names></name>
</principal-award-recipient>
</award-group>
<funding-statement>The authors E. H., E. H., O.S., G.N., V.S., and A.Z.M.-K. received funding from the Research Council of Norway project #262203. A.D. was supported by the German Research Foundation (DFG, DE 2516/1-1). The funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.</funding-statement>
</funding-group>
<counts>
<fig-count count="16"/>
<table-count count="3"/>
<page-count count="31"/>
</counts>
<custom-meta-group>
<custom-meta>
<meta-name>PLOS Publication Stage</meta-name>
<meta-value>vor-update-to-uncorrected-proof</meta-value>
</custom-meta>
<custom-meta>
<meta-name>Publication Update</meta-name>
<meta-value>2019-07-08</meta-value>
</custom-meta>
<custom-meta id="data-availability">
<meta-name>Data Availability</meta-name>
<meta-value>All data used as input in the study are available in the Supporting Information.</meta-value>
</custom-meta>
</custom-meta-group>
</article-meta>
</front>
<body>
<sec id="sec001" sec-type="intro">
<title>Introduction</title>
<p>Applying traditional compartment models to in vivo hemodynamic measurements provides clinically valuable parameters in a wide range of medical conditions, e.g. Alzheimer disease [<xref ref-type="bibr" rid="pcbi.1007073.ref001">1</xref>], stroke [<xref ref-type="bibr" rid="pcbi.1007073.ref002">2</xref>, <xref ref-type="bibr" rid="pcbi.1007073.ref003">3</xref>] or cancer [<xref ref-type="bibr" rid="pcbi.1007073.ref004">4</xref>, <xref ref-type="bibr" rid="pcbi.1007073.ref005">5</xref>]. In these approaches, a pharmacokinetic compartment model is fitted to tracer evolution time curves from perfusion acquisitions to extract estimates of physiological parameters. The methodology is applied to entire organs, or regional- or voxel-wise, depending on the application.</p>
<p>In the case of tracer-based measurements of brain hemodynamics, cerebral blood flow (CBF, or perfusion), cerebral blood volume (CBV), and mean transit time (MTT) are commonly extracted parameters from one-compartment (1C) models. However, a fundamental drawback of these methods has been previously pointed out: determining CBF from traditional 1C models is scale dependent, hence the results depend on discretization level [<xref ref-type="bibr" rid="pcbi.1007073.ref006">6</xref>–<xref ref-type="bibr" rid="pcbi.1007073.ref008">8</xref>]. In [<xref ref-type="bibr" rid="pcbi.1007073.ref009">9</xref>] it was demonstrated that 1C models are prone to substantial errors when applied to smaller computational units connected in space instead of entire organs. This implies that measurements of perfusion on different discretization scales can provide considerably varying results depending on the choice of imaging device and post-processing software. The major reason for scale dependency of traditional 1C models is the lack of spatial connectivity in the model, hence allowing for repeated counts of the same fluid volume when applying the model to spatially connected units.</p>
<p>Recognition of the deficiencies of traditional compartment models has led to the development of multiscale, continuous blood flow models. Such models are highly relevant for improved understanding of the conditions affecting both global blood flow and microrheology in disease states, such as, e.g. cerebral aneurysms and sickle cell anemia [<xref ref-type="bibr" rid="pcbi.1007073.ref010">10</xref>]. Treatment of patients, such as by means of neurosurgery, may also benefit from individualized models that describe complex geometrical phenotypes [<xref ref-type="bibr" rid="pcbi.1007073.ref011">11</xref>]. Multiscale blood flow models may also contribute to a better understanding of angiogenesis and interstitial flow in simulated tumor microvascular networks, thus providing a more comprehensive and descriptive model for drug delivery [<xref ref-type="bibr" rid="pcbi.1007073.ref012">12</xref>–<xref ref-type="bibr" rid="pcbi.1007073.ref015">15</xref>].</p>
<p>A challenging topic within multiscale flow models is the precise mathematical formulation of perfusion within a continuous flow model. A model of perfusion should be in accordance with the physiological interpretation of perfusion being considered as a feeding arterial flow of oxygenated blood into the tissue or an organ. As a solution, we adopt a continuous flow model in which perfusion is regarded as the volume flux of oxygenated blood, which transits from arterial to the venous side in a two-compartment (2C) model [<xref ref-type="bibr" rid="pcbi.1007073.ref016">16</xref>–<xref ref-type="bibr" rid="pcbi.1007073.ref019">19</xref>]. This understanding of perfusion is both mathematically strict and physiologically sound.</p>
<p>The vascular system is a geometrically highly complex tubular network connecting vessels at different spatial scales. One particular challenge of whole brain simulation of perfusion is how to connect flow on the various scales, ranging from the carotid artery lumen with diameter close to 6 mm [<xref ref-type="bibr" rid="pcbi.1007073.ref020">20</xref>] down to capillaries with diameters of approximately 6 μm [<xref ref-type="bibr" rid="pcbi.1007073.ref021">21</xref>]. A suitable continuum model for flow simulations is expected to care for both tissue inhomogeneity and anisotropy, with the inconvenience of requiring a large number of unknown modelling parameters. One common approach is therefore to represent the vessels as an inexpensive 1D flow model coupled with a 3D continuum model for the brain tissue [<xref ref-type="bibr" rid="pcbi.1007073.ref019">19</xref>, <xref ref-type="bibr" rid="pcbi.1007073.ref022">22</xref>–<xref ref-type="bibr" rid="pcbi.1007073.ref024">24</xref>]. The simple geometry of a 1D model reduces the number of required modelling parameters, while the vascular geometry can be observed in dedicated MR acquisitions. However, well-posedness and stability of the solution at the interface between the 1D and 3D model is challenging [<xref ref-type="bibr" rid="pcbi.1007073.ref022">22</xref>, <xref ref-type="bibr" rid="pcbi.1007073.ref023">23</xref>]. In the current work, we address this problem by introducing a local flow distribution region where interface conditions are governed by a mass conserving, smooth support function, hence ensuring stability of the system.</p>
</sec>
<sec id="sec002" sec-type="materials|methods">
<title>Methods</title>
<p>The workflow of our proposed method for whole brain simulation is schematically shown in <xref ref-type="fig" rid="pcbi.1007073.g001">Fig 1</xref>. Three dedicated MR acquisitions together with their appropriate data reconstruction and data post-processing are used to create the data-driven geometry: (i) A T1-weighted anatomical 3D data set used for segmenting white and grey matter, (ii) a time-of-flight (ToF) acquisition for identifying larger arteries, and (iii) a quantitative susceptibility map (QSM), which allows to extract larger veins. In the macro-scale network of arteries and veins we model the flow according to the Hagen-Poiseuille equation [<xref ref-type="bibr" rid="pcbi.1007073.ref025">25</xref>]. However, the brain also contains a large number of micro-scale capillaries, not recognizeable in space by any in vivo imaging device. So far, as a solution to this limitation, flow in capillaries is frequently modelled as porous media flow according to Darcy’s law [<xref ref-type="bibr" rid="pcbi.1007073.ref016">16</xref>, <xref ref-type="bibr" rid="pcbi.1007073.ref017">17</xref>, <xref ref-type="bibr" rid="pcbi.1007073.ref019">19</xref>]. We couple macro-scale Hagen-Poiseuille flow in large vessels with micro-scale Darcy flow in the capillaries by a set of locally distributing source terminals, hence providing a complete linear system, which is solved for node pressure values within the vascular network and voxel pressure values within the brain tissue. Finally, fluid flux obtained from the pressure gradient is used to simulate tracer transport, leading to an in-silico model of combined whole brain perfusion and tracer evolution. For the remaining, we make the assumption that our data represents healthy human brain tissue with an intact blood-brain barrier. Hence, no leakage of tracer into the extravascular space is expected, and one can exclusively model the tracer in the vascular space [<xref ref-type="bibr" rid="pcbi.1007073.ref026">26</xref>]. In the following, we carefully address individual processing steps.</p>
<fig id="pcbi.1007073.g001" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1007073.g001</object-id>
<label>Fig 1</label>
<caption>
<title>Workflow of algorithm for whole brain flow simulation.</title>
<p>A FreeSurfer segmentation of the T1-weighted acquisition is used to define a brain mask from the union of white and grey matter. The ToF and QSM images were used to segment arteries and veins, respectively. Within the vascular network the flow is implemented according to the Hagen-Poiseuille equation. Flow in the brain is represented by Darcy flow, and coupled with Hagen-Poiseuille flow in the vascular tree using locally distributing source terminals. The resulting linear system is solved for the pressure. Flux is directly proportional to the pressure drop, and is used to compute tracer transport as a function of time. Finally, the workflow provides an in-silico model of whole brain perfusion and indicator dilution.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1007073.g001" xlink:type="simple"/>
</fig>
<sec id="sec003">
<title>Data sets used for simulation</title>
<p>The purpose of the numerical simulations is twofold. First, by examples to illustrate working principles of our algorithm, and secondly, to demonstrate scale invariance. With this in mind, we have chosen the geometry of a frog tongue as example data [<xref ref-type="bibr" rid="pcbi.1007073.ref027">27</xref>]. This data set exhibits a realistic vascular geometry. Practically, the data set was scanned from a written source [<xref ref-type="bibr" rid="pcbi.1007073.ref027">27</xref>]. Preprocessing steps included semi-automatic segmentation of each of the vascular networks. Length of the tongue was measured to be 35 mm, and field of view (FOV) was set accordingly. As an approximation we consider the data to be almost two-dimensional. The tongue is also stretched between the nails pinning it to the surface, leading to a deformed geometry compared to a unprepared frog tongue. A visualization of the arterial and venous network, as well as the tongue tissue is shown in <xref ref-type="fig" rid="pcbi.1007073.g002">Fig 2</xref>. Input data can be found in Supporting Information <xref ref-type="supplementary-material" rid="pcbi.1007073.s002">S1</xref>–<xref ref-type="supplementary-material" rid="pcbi.1007073.s004">S3</xref> Data. Furthermore, we used a full human brain for simulation of flow. Acquisition parameters and postprocessing steps of these data are described in the following.</p>
<fig id="pcbi.1007073.g002" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1007073.g002</object-id>
<label>Fig 2</label>
<caption>
<title>Geometry of a frog tongue with segmentation labels from dark to bright: Background (black), arterial network (red), venous network (blue), and tongue tissue (white).</title>
<p>The sharp corners of the tongue tissue occur when the tongue is pinned down to the surface prior to imaging. The arterial input and venous outlet are in the bottom of the picture.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1007073.g002" xlink:type="simple"/>
</fig>
<sec id="sec004">
<title>MR acquisitions</title>
<p>Magnetic resonance (MR) imaging of a healthy male subject (age 26 years) was carried out at the Jena University Hospital (Jena, Germany) on a 3T MR system equipped with a 12 channel-phased-array receive head coil (Siemens Healthineers, Erlangen, Germany). Consent was not obtained because data were analyzed anonymously. A 3D, whole-head, T1-weighted MRI data set was collected by applying a magnetization-prepared rapid gradient echo (MP-RAGE) sequence (echo time TE = 3.24 ms, bandwidth BW = 200 Hz/px, repetition time TR = 2530 ms, inversion time TI = 1100 ms, flip angle FA = 9°, acquisition matrix = 320×240×224, voxel size = 0.8 mm×0.8 mm× 0.8 mm, acquisition time TA = 12:00 min:sec) for whole brain parcellation.</p>
<p>Image information about the cerebral arterial vessels was collected by performing a multi-slab time-of-flight (ToF) MR angiography (MRA) [<xref ref-type="bibr" rid="pcbi.1007073.ref028">28</xref>] with a single echo, 3D gradient-echo sequence (TE = 4.16 ms, BW = 180 Hz/px, TR = 23 ms, ramped FA = 20° [TONE pulse with 20° and TONE ratio 2:1] [<xref ref-type="bibr" rid="pcbi.1007073.ref029">29</xref>], acquisition matrix per slab = 448×346×64, voxel size = 0.49 mm×0.49 mm× 0.49 mm, TA = 32:57 min:sec). Signal saturation due to slow flowing arterial blood was reduced by acquiring six slabs with a slab overlapping factor of -20% [<xref ref-type="bibr" rid="pcbi.1007073.ref030">30</xref>]. Venous contamination in the ToF data was reduced by using additional venous saturation pulses.</p>
<p>To assess the cerebral venous vasculature, quantitative susceptibility mapping (QSM) was performed [<xref ref-type="bibr" rid="pcbi.1007073.ref031">31</xref>, <xref ref-type="bibr" rid="pcbi.1007073.ref032">32</xref>]. For this purpose, data were acquired with a 3D, dual-echo gradient-echo sequence with flow compensation in all three spatial directions of the second echo (ToF-SWI sequence) [<xref ref-type="bibr" rid="pcbi.1007073.ref033">33</xref>]. The acquisition parameters included TE1 = 3.38 ms, BW1 = 272 Hz/px, TE2 = 24.7 ms, BW2 = 80 Hz/px, TR = 34 ms, acquisition matrix = 448×350×256, voxel size = 0.49 mm×0.49 mm×0.60 resulting in an acquisition time of 32:57 min:sec. The phase information of the second echo of the ToF-SWI sequence was used to compute magnetic susceptibility maps while applying sophisticated harmonic artefact reduction for phase data with variable radii (V-SHARP, 10 spherical kernels with radii ranging from 0.49 mm to 4.9 mm, regularization parameter [TSVD]: 0.05) [<xref ref-type="bibr" rid="pcbi.1007073.ref034">34</xref>, <xref ref-type="bibr" rid="pcbi.1007073.ref035">35</xref>] for background field removal and homogeneity enabled incremental dipole inversion (HEIDI) [<xref ref-type="bibr" rid="pcbi.1007073.ref036">36</xref>] for field-to-susceptibility inversion. Finally, all three different contrasts were brought into a unified space with a common voxel size of 0.49 mm isotropic by linear registration, both the MP-RAGE and magnetic susceptibility maps to the ToF MRA data. Original input data can be found in Supporting Information <xref ref-type="supplementary-material" rid="pcbi.1007073.s005">S4</xref>–<xref ref-type="supplementary-material" rid="pcbi.1007073.s008">S7</xref> Data. Shown pictures of the frog tongue and the human brain example were rescaled at double resolution and smoothed by anisotropic diffusion for visualization purposes.</p>
</sec>
<sec id="sec005">
<title>Detection of brain tissue</title>
<p>FreeSurfer v6.0 (<monospace>recon-all</monospace>) was used to create a whole brain parcellation from the high-resolution T1-weighted dataset [<xref ref-type="bibr" rid="pcbi.1007073.ref037">37</xref>]. Masks of white and grey matter were extracted from the FreeSurfer parcellation. A brain mask was generated as the union of white and grey matter. These segmented data sets defined the geometry in the numerical example of whole brain perfusion. Porous media flow was applied only within the brain mask.</p>
</sec>
<sec id="sec006">
<title>Detection of arterial and venous networks</title>
<p>The vessel detection procedure was split into two consecutive workflows, see <xref ref-type="fig" rid="pcbi.1007073.g003">Fig 3</xref> for an overview. In the first workflow we create a connected, binary network. In a second workflow, we identify graph parameters, e.g. leafs, medial axes, nodes and edges. In the next, we describe the two workflows in more detail.</p>
<fig id="pcbi.1007073.g003" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1007073.g003</object-id>
<label>Fig 3</label>
<caption>
<title>Automatic detection of vascular networks is divided into two consecutive workflows.</title>
<p>(I) In the first part, (A) a connected, binary mask of the vascular network is generated from the input image (i.e. the ToF or the QSM in the case of a real application), here represented as a synthetic image demonstrating a small network of vessels. (B) Segmentation by adaptive thresholding creates a first approximation to the vascular network. However, due to local dropout in the signal, the segmented map also contains a satellite structure disconnected from the root structure. Computing the distance function around the root structure with the image itself as a speed function generates a favorable map which can be used for backtracing from the satellite structure to the root structure. This procedure generates a most probable path connecting these two structures (green path). (C) End points of the resulting, connected vascular network are either root points or leafs. (II) In the second part, from the connected network in (I), we identify leafs, root points, the skeleton, as well as network nodes. (D) Computing a distance function around the binary segmentation generates a map for a second backpropagation. A consecutive backpropagation from leaf 1 and 2 towards the root ensures a connected skeleton of the network. In addition, the procedure provides the nodes as the points of intersection of two paths of backpropagation, here indicated by the red arrow intersecting the green path.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1007073.g003" xlink:type="simple"/>
</fig>
</sec>
<sec id="sec007">
<title>Detection of a connected, binary network</title>
<p>The ToF and QSM data were used for identifying arteries and veins, respectively (cfr. the workflow in <xref ref-type="fig" rid="pcbi.1007073.g003">Fig 3A–3C</xref>, where we have used an example image for demonstration purposes). Adaptive thresholding of each of these maps indicated most probable locations for vessels, resulting in a set of <italic>N</italic><sub><italic>R</italic></sub> disconnected components <inline-formula id="pcbi.1007073.e001"><alternatives><graphic id="pcbi.1007073.e001g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e001" xlink:type="simple"/><mml:math display="inline" id="M1"><mml:mrow><mml:msubsup><mml:mo>∪</mml:mo> <mml:mrow><mml:mi>i</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:msub><mml:mi>N</mml:mi> <mml:mi>R</mml:mi></mml:msub></mml:msubsup> <mml:msub><mml:mi>R</mml:mi> <mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>. The largest structure <italic>R</italic><sub>1</sub> is referred to as the root structure, while remaining structures are referred to as satellite structures (cfr. <xref ref-type="fig" rid="pcbi.1007073.g003">Fig 3B</xref>). Now, assume the components in <inline-formula id="pcbi.1007073.e002"><alternatives><graphic id="pcbi.1007073.e002g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e002" xlink:type="simple"/><mml:math display="inline" id="M2"><mml:mrow><mml:msubsup><mml:mo>∪</mml:mo> <mml:mrow><mml:mi>i</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:msub><mml:mi>N</mml:mi> <mml:mi>R</mml:mi></mml:msub></mml:msubsup> <mml:msub><mml:mi>R</mml:mi> <mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> are sorted in descending order according to shortest Euclidean distance to the root structure. To overcome the problem that adaptive thresholding does not guarantee 3D connectivity, we solved the eikonal equation
<disp-formula id="pcbi.1007073.e003"><alternatives><graphic id="pcbi.1007073.e003g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e003" xlink:type="simple"/><mml:math display="block" id="M3"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd/><mml:mtd><mml:mrow><mml:mo>|</mml:mo> <mml:mo>∇</mml:mo> <mml:mi>T</mml:mi> <mml:mo>|</mml:mo> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn> <mml:mo>/</mml:mo> <mml:mi>S</mml:mi> <mml:mo>,</mml:mo> <mml:mspace width="2.em"/><mml:mi>x</mml:mi> <mml:mo>∈</mml:mo> <mml:mo>Ω</mml:mo></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd/><mml:mtd><mml:mrow><mml:mi>T</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:mn>0</mml:mn> <mml:mo>,</mml:mo> <mml:mspace width="2.em"/><mml:mi>x</mml:mi> <mml:mo>∈</mml:mo> <mml:msub><mml:mi>R</mml:mi> <mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(1)</label></disp-formula>
for the arrival time field <inline-formula id="pcbi.1007073.e004"><alternatives><graphic id="pcbi.1007073.e004g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e004" xlink:type="simple"/><mml:math display="inline" id="M4"><mml:mrow><mml:mi>T</mml:mi> <mml:mo>:</mml:mo> <mml:mo>Ω</mml:mo> <mml:mo>→</mml:mo> <mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow></mml:math></alternatives></inline-formula>, <italic>T</italic> ≥ 0 and where Ω is the domain corresponding to the field-of-view (FOV). <xref ref-type="disp-formula" rid="pcbi.1007073.e003">Eq (1)</xref> was solved by fast marching [<xref ref-type="bibr" rid="pcbi.1007073.ref038">38</xref>]. Backpropagation in the arrival time field provides the shortest path to the root from any point, given the velocity <inline-formula id="pcbi.1007073.e005"><alternatives><graphic id="pcbi.1007073.e005g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e005" xlink:type="simple"/><mml:math display="inline" id="M5"><mml:mrow><mml:mi>S</mml:mi> <mml:mo>:</mml:mo> <mml:mo>Ω</mml:mo> <mml:mo>→</mml:mo> <mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow></mml:math></alternatives></inline-formula>, <italic>S</italic> ≥ 0. Using <italic>S</italic> equal to the ToF or QSM data facilitates a backpropagation along high intensity structures strongly associated with the path of arteries and veins, respectively. Backpropagation from the satellite structure <italic>R</italic><sub>2</sub> to the root structure <italic>R</italic><sub>1</sub> along the arrival time map <italic>T</italic>(<italic>x</italic>) provides the most probable path from <italic>R</italic><sub>2</sub> to <italic>R</italic><sub>1</sub> (cfr. <xref ref-type="fig" rid="pcbi.1007073.g003">Fig 3C</xref>). The region <italic>R</italic><sub>2</sub> is then assimilated into the root structure, <italic>R</italic><sub>1</sub> ← <italic>R</italic><sub>1</sub> ∪ <italic>R</italic><sub>2</sub>, and the process of solving (<xref ref-type="disp-formula" rid="pcbi.1007073.e003">1</xref>) is repeated for <italic>i</italic> = {2, 3, 4, …, <italic>N</italic><sub><italic>R</italic></sub>}. Each backpropagation is applied until it reaches the growing root structure. Backpropagation ensures connectivity of every component <italic>R</italic><sub><italic>i</italic></sub> in the vessel network to the initial root structure. Backpropagation in the space between the connecting structures <italic>R</italic><sub>1</sub> and <italic>R</italic><sub><italic>i</italic></sub> was later combined with a dilatation of the connecting edge to produce tubular structures matching the average radius of (<italic>R</italic><sub>1</sub> + <italic>R</italic><sub><italic>i</italic></sub>)/2 (cfr. <xref ref-type="fig" rid="pcbi.1007073.g003">Fig 3C</xref>). The resulting vascular network is referred to as the arterial or venous mask <italic>R</italic><sub>1</sub>.</p>
</sec>
<sec id="sec008">
<title>Identification of graph parameters</title>
<p>In the second part we identify leafs, medial axis, nodes and edges of the network (cfr. <xref ref-type="fig" rid="pcbi.1007073.g003">Fig 3D</xref>). To provide these parameters, let us first define a domain <inline-formula id="pcbi.1007073.e006"><alternatives><graphic id="pcbi.1007073.e006g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e006" xlink:type="simple"/><mml:math display="inline" id="M6"><mml:msubsup><mml:mo>Ω</mml:mo> <mml:mi mathvariant="script">B</mml:mi> <mml:mrow><mml:mi>C</mml:mi> <mml:mi>H</mml:mi></mml:mrow></mml:msubsup></mml:math></alternatives></inline-formula> associated with the convex hull of the brain, as well as a binary image <italic>B</italic><sub>1</sub>: Ω → {0, 1}, {<italic>B</italic><sub>1</sub>(<italic>x</italic>) = 1 if <italic>x</italic> ∈ <italic>R</italic><sub>1</sub>, else <italic>B</italic><sub>1</sub>(<italic>x</italic>) = 0}. Then, we solve the boundary value problem
<disp-formula id="pcbi.1007073.e007"><alternatives><graphic id="pcbi.1007073.e007g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e007" xlink:type="simple"/><mml:math display="block" id="M7"><mml:mtable columnalign="left"><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:mrow><mml:mo>|</mml:mo> <mml:mrow><mml:mo>∇</mml:mo> <mml:mi>T</mml:mi></mml:mrow> <mml:mo>|</mml:mo></mml:mrow> <mml:mo>=</mml:mo></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mrow><mml:mo>{</mml:mo> <mml:mrow><mml:mtable columnalign="left"><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:mn>1</mml:mn> <mml:mo>/</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:mtext>dist</mml:mtext> <mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:msubsup><mml:mi>B</mml:mi> <mml:mn>1</mml:mn> <mml:mi>C</mml:mi></mml:msubsup> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:mrow> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>+</mml:mo> <mml:mi>ξ</mml:mi></mml:mrow> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr> <mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:mtext>inf</mml:mtext></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mrow></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mtable columnalign="left"><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:mtext>if</mml:mtext></mml:mrow></mml:mtd></mml:mtr> <mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:mtext>if</mml:mtext></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mtable columnalign="left"><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:mi>x</mml:mi> <mml:mo>∈</mml:mo> <mml:msub><mml:mi>R</mml:mi> <mml:mn>1</mml:mn></mml:msub> <mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr> <mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:mi>x</mml:mi> <mml:mo>∈</mml:mo> <mml:mo>Ω</mml:mo> <mml:mo>/</mml:mo> <mml:msub><mml:mi>R</mml:mi> <mml:mn>1</mml:mn></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mtd></mml:mtr> <mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:mi>T</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mn>0</mml:mn></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mtext>if</mml:mtext></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mi>x</mml:mi> <mml:mo>∈</mml:mo> <mml:msub><mml:mi>R</mml:mi> <mml:mn>1</mml:mn></mml:msub> <mml:mo>∩</mml:mo> <mml:mo>∂</mml:mo> <mml:msubsup><mml:mo>Ω</mml:mo> <mml:mi>ℬ</mml:mi> <mml:mrow><mml:mi>C</mml:mi> <mml:mi>H</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(2)</label></disp-formula>
for the arrival time <italic>T</italic>, where <inline-formula id="pcbi.1007073.e008"><alternatives><graphic id="pcbi.1007073.e008g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e008" xlink:type="simple"/><mml:math display="inline" id="M8"><mml:mrow><mml:msubsup><mml:mi>B</mml:mi> <mml:mn>1</mml:mn> <mml:mi>C</mml:mi></mml:msubsup> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> is the complement of <italic>B</italic><sub>1</sub>(<italic>x</italic>), <italic>ξ</italic> = 0.1 is a small number to avoid dividing by zero, and where dist() is the Euclidean distance function. Zero arrival time is set in the root points (i.e. the AIF points), defined as the intersection of the convex hull of the brain with the vessel network. <xref ref-type="disp-formula" rid="pcbi.1007073.e007">Eq (2)</xref> provides a monotonically increasing map of arrival times along the arterial/venous network away from the root points. Leafs of the vascular network were identified from regional maxima (<monospace>imregionalmax</monospace> in MATLAB, cfr. <xref ref-type="fig" rid="pcbi.1007073.g003">Fig 3C</xref>), and backpropagation from the leafs towards the root leads to a set of spatially connected medial axis associated with the skeleton of the network. The path of backpropagation becomes the edges in the graph. Bifurcation points or nodes occur whenever a path of backpropagation intersects with a previous path of backpropagation, or with any of the root points (cfr. <xref ref-type="fig" rid="pcbi.1007073.g003">Fig 3D</xref>).</p>
</sec>
</sec>
<sec id="sec009">
<title>Governing equations in the 3D domain</title>
<p>In the coupled model combining 1D flow in larger vessels with 3D Darcy flow in the brain, the majority of tissue is modelled as a porous medium where pressure driven flow is restricted by fluid mass balance and generic assumptions about the vascular microstructure of the arterioles, venules and the capillary system. In order to describe perfusion mathematically, we work under the assumption of two parallel 3D systems (or compartments), one accounting for arterial and one accounting for venous flow. The perfusion is interpreted as the delivery of oxygenated blood from the first to the latter compartment. Further details regarding the 3D model are given below.</p>
<sec id="sec010">
<title>Fluid mass balance</title>
<p>Let us now define a brain mask <inline-formula id="pcbi.1007073.e009"><alternatives><graphic id="pcbi.1007073.e009g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e009" xlink:type="simple"/><mml:math display="inline" id="M9"><mml:msub><mml:mo>Ω</mml:mo> <mml:mi mathvariant="script">B</mml:mi></mml:msub></mml:math></alternatives></inline-formula> as the union of grey and white matter. Fluid mass balance is ensured by the continuity equation, expressed in global form as
<disp-formula id="pcbi.1007073.e010"><alternatives><graphic id="pcbi.1007073.e010g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e010" xlink:type="simple"/><mml:math display="block" id="M10"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mfrac><mml:mi>d</mml:mi> <mml:mrow><mml:mi>d</mml:mi> <mml:mi>t</mml:mi></mml:mrow></mml:mfrac> <mml:msub><mml:mo>∫</mml:mo> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi>i</mml:mi></mml:msub></mml:msub> <mml:mi>ϕ</mml:mi> <mml:mi>ρ</mml:mi> <mml:mi>d</mml:mi> <mml:mi>x</mml:mi> <mml:mo>+</mml:mo> <mml:msub><mml:mo>∫</mml:mo> <mml:mrow><mml:mi>∂</mml:mi> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msub> <mml:mi>ρ</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>u</mml:mi> <mml:mo>·</mml:mo> <mml:mi>n</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mi>d</mml:mi> <mml:mi>A</mml:mi> <mml:mo>=</mml:mo> <mml:msub><mml:mo>∫</mml:mo> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi>i</mml:mi></mml:msub></mml:msub> <mml:mover accent="true"><mml:mi>Q</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mi>d</mml:mi> <mml:mi>x</mml:mi></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(3)</label></disp-formula>
for a geometric control volume Ω<sub><italic>i</italic></sub> with boundaries ∂Ω<sub><italic>i</italic></sub>. In (<xref ref-type="disp-formula" rid="pcbi.1007073.e010">3</xref>), <italic>n</italic> is the outer unit normal vector of ∂Ω<sub><italic>i</italic></sub>, <inline-formula id="pcbi.1007073.e011"><alternatives><graphic id="pcbi.1007073.e011g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e011" xlink:type="simple"/><mml:math display="inline" id="M11"><mml:mrow><mml:mi>u</mml:mi> <mml:mo>:</mml:mo> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi mathvariant="script">B</mml:mi></mml:msub> <mml:mo>×</mml:mo> <mml:mi>T</mml:mi> <mml:mo>→</mml:mo> <mml:msup><mml:mi mathvariant="double-struck">R</mml:mi> <mml:mn>3</mml:mn></mml:msup></mml:mrow></mml:math></alternatives></inline-formula> is the flow per unit area (i.e. flux), [m<sup>3</sup> s<sup>−1</sup> m<sup>−2</sup>], <inline-formula id="pcbi.1007073.e012"><alternatives><graphic id="pcbi.1007073.e012g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e012" xlink:type="simple"/><mml:math display="inline" id="M12"><mml:mrow><mml:mi>ρ</mml:mi> <mml:mo>:</mml:mo> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi mathvariant="script">B</mml:mi></mml:msub> <mml:mo>×</mml:mo> <mml:mi>T</mml:mi> <mml:mo>→</mml:mo> <mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> is the fluid density [kg m<sup>−3</sup>], <inline-formula id="pcbi.1007073.e013"><alternatives><graphic id="pcbi.1007073.e013g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e013" xlink:type="simple"/><mml:math display="inline" id="M13"><mml:mrow><mml:mi>ϕ</mml:mi> <mml:mo>:</mml:mo> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi mathvariant="script">B</mml:mi></mml:msub> <mml:mo>×</mml:mo> <mml:mi>T</mml:mi> <mml:mo>→</mml:mo> <mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> is the porosity [-], and <inline-formula id="pcbi.1007073.e014"><alternatives><graphic id="pcbi.1007073.e014g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e014" xlink:type="simple"/><mml:math display="inline" id="M14"><mml:mrow><mml:mover accent="true"><mml:mi>Q</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mo>:</mml:mo> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi mathvariant="script">B</mml:mi></mml:msub> <mml:mo>×</mml:mo> <mml:mi>T</mml:mi> <mml:mo>→</mml:mo> <mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> is a fluid source term [kg s<sup>−1</sup> m<sup>−3</sup>]. In geoscience, the parameter 0 ≤ <italic>ϕ</italic> ≤ 1 is known as the porosity, and in the field of neuroimaging it is known as cerebral blood volume (CBV). <xref ref-type="disp-formula" rid="pcbi.1007073.e010">Eq (3)</xref> must be valid for every geometric control volume Ω<sub><italic>i</italic></sub>, hence, by the divergence theorem
<disp-formula id="pcbi.1007073.e015"><alternatives><graphic id="pcbi.1007073.e015g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e015" xlink:type="simple"/><mml:math display="block" id="M15"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mfrac><mml:mi>∂</mml:mi> <mml:mrow><mml:mi>∂</mml:mi> <mml:mi>t</mml:mi></mml:mrow></mml:mfrac> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>ϕ</mml:mi> <mml:mi>ρ</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>+</mml:mo> <mml:mo>∇</mml:mo> <mml:mo>·</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>ρ</mml:mi> <mml:mi>u</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:mover accent="true"><mml:mi>Q</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(4)</label></disp-formula>
For an incompressible fluid and for a situation of constant fluid density, (<xref ref-type="disp-formula" rid="pcbi.1007073.e015">4</xref>) is equivalent with
<disp-formula id="pcbi.1007073.e016"><alternatives><graphic id="pcbi.1007073.e016g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e016" xlink:type="simple"/><mml:math display="block" id="M16"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mo>∇</mml:mo> <mml:mo>·</mml:mo> <mml:mi>u</mml:mi> <mml:mo>=</mml:mo> <mml:mi>Q</mml:mi></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(5)</label></disp-formula>
where <inline-formula id="pcbi.1007073.e017"><alternatives><graphic id="pcbi.1007073.e017g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e017" xlink:type="simple"/><mml:math display="inline" id="M17"><mml:mrow><mml:mi>Q</mml:mi> <mml:mo>=</mml:mo> <mml:mover accent="true"><mml:mi>Q</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mo>/</mml:mo> <mml:mi>ρ</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> has units [m<sup>3</sup> s<sup>−1</sup> m<sup>−3</sup>].</p>
</sec>
<sec id="sec011">
<title>Flow equations in the brain</title>
<p>Assuming a low velocity flow within the capillary brain tissue according to Darcy’s law, provides the relation
<disp-formula id="pcbi.1007073.e018"><alternatives><graphic id="pcbi.1007073.e018g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e018" xlink:type="simple"/><mml:math display="block" id="M18"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>u</mml:mi> <mml:mo>=</mml:mo> <mml:mo>-</mml:mo> <mml:mfrac><mml:mi>k</mml:mi> <mml:mi>μ</mml:mi></mml:mfrac> <mml:mo>∇</mml:mo> <mml:mi>p</mml:mi></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(6)</label></disp-formula>
between the flux <inline-formula id="pcbi.1007073.e019"><alternatives><graphic id="pcbi.1007073.e019g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e019" xlink:type="simple"/><mml:math display="inline" id="M19"><mml:mrow><mml:mi>u</mml:mi> <mml:mo>:</mml:mo> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi mathvariant="script">B</mml:mi></mml:msub> <mml:mo>→</mml:mo> <mml:msup><mml:mi mathvariant="double-struck">R</mml:mi> <mml:mn>3</mml:mn></mml:msup></mml:mrow></mml:math></alternatives></inline-formula> [m<sup>3</sup> s<sup>−1</sup> m<sup>−3</sup>] and the pressure <inline-formula id="pcbi.1007073.e020"><alternatives><graphic id="pcbi.1007073.e020g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e020" xlink:type="simple"/><mml:math display="inline" id="M20"><mml:mrow><mml:mi>p</mml:mi> <mml:mo>:</mml:mo> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi mathvariant="script">B</mml:mi></mml:msub> <mml:mo>→</mml:mo> <mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> [Pa] when neglecting the gravitational acceleration [<xref ref-type="bibr" rid="pcbi.1007073.ref016">16</xref>, <xref ref-type="bibr" rid="pcbi.1007073.ref017">17</xref>, <xref ref-type="bibr" rid="pcbi.1007073.ref019">19</xref>, <xref ref-type="bibr" rid="pcbi.1007073.ref039">39</xref>]. The flux <italic>u</italic> is also known as the Darcy velocity, and is related to the fluid velocity by the porosity since only a fraction of the geometric volume is available to flow. The viscosity <italic>μ</italic> is assumed to be constant everywhere, and <inline-formula id="pcbi.1007073.e021"><alternatives><graphic id="pcbi.1007073.e021g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e021" xlink:type="simple"/><mml:math display="inline" id="M21"><mml:mrow><mml:mi>k</mml:mi> <mml:mo>:</mml:mo> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi mathvariant="script">B</mml:mi></mml:msub> <mml:mo>→</mml:mo> <mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> [mm<sup>2</sup>] is the vascular permeability, in this work assumed to be isotropic.</p>
<p>Now, consider two fluid compartments, the arterial and venous compartment, where we employ an index <italic>β</italic> indicating the compartment i.e. <italic>β</italic> ∈ {<italic>a</italic> = arterial, <italic>v</italic> = venous}. We allow each compartment to possess heterogenous porosity <italic>ϕ</italic><sub><italic>β</italic></sub>(<italic>x</italic>) and vascular permeability <italic>k</italic><sub><italic>β</italic></sub>(<italic>x</italic>). However, in the current work, we assign regionally constant parameter values of porosity and vascular permeability within each compartment due to lacking prior information of regional variability. Furthermore, let the perfusion <inline-formula id="pcbi.1007073.e022"><alternatives><graphic id="pcbi.1007073.e022g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e022" xlink:type="simple"/><mml:math display="inline" id="M22"><mml:mrow><mml:mi>P</mml:mi> <mml:mo>:</mml:mo> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi mathvariant="script">B</mml:mi></mml:msub> <mml:mo>→</mml:mo> <mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> [m<sup>3</sup> s<sup>−1</sup> m<sup>−3</sup>] be the volume flux between the two compartments, hence understanding perfusion as the transition rate of blood from oxygenated to deoxygenated state [<xref ref-type="bibr" rid="pcbi.1007073.ref016">16</xref>–<xref ref-type="bibr" rid="pcbi.1007073.ref019">19</xref>]. Vascular flow is mainly pressure driven, and a legitimate model for perfusion is linearly proportional to the pressure difference between the arterial and venous compartment,
<disp-formula id="pcbi.1007073.e023"><alternatives><graphic id="pcbi.1007073.e023g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e023" xlink:type="simple"/><mml:math display="block" id="M23"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>P</mml:mi> <mml:mo>=</mml:mo> <mml:mi>α</mml:mi> <mml:mo>(</mml:mo> <mml:msub><mml:mi>p</mml:mi> <mml:mi>a</mml:mi></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mi>p</mml:mi> <mml:mi>v</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(7)</label></disp-formula>
with a perfusion proportionality factor <italic>α</italic> = <italic>α</italic>(<italic>x</italic>) [m s kg<sup>−1</sup>]. The parameter <italic>α</italic> is assumed to reflect anatomical factors affecting the tissue’s ability to facilitate perfusion, e.g. capillary density and microstructural organization, and can later be refined to separate the various factors. Combining mass conservation (<xref ref-type="disp-formula" rid="pcbi.1007073.e016">5</xref>) with porous media flow (<xref ref-type="disp-formula" rid="pcbi.1007073.e018">6</xref>) for each of the two compartments while coupling the compartments with the perfusion (<xref ref-type="disp-formula" rid="pcbi.1007073.e023">7</xref>) yields a set of partial differential equations in the pressure fields <italic>p</italic><sub><italic>a</italic></sub> and <italic>p</italic><sub><italic>v</italic></sub> <disp-formula id="pcbi.1007073.e024"><alternatives><graphic id="pcbi.1007073.e024g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e024" xlink:type="simple"/><mml:math display="block" id="M24"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mo>-</mml:mo> <mml:mo>∇</mml:mo> <mml:mo>·</mml:mo> <mml:mo>(</mml:mo> <mml:mfrac><mml:mrow><mml:msub><mml:mi>k</mml:mi> <mml:mi>a</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:mrow> <mml:mi>μ</mml:mi></mml:mfrac> <mml:mo>∇</mml:mo> <mml:msub><mml:mi>p</mml:mi> <mml:mi>a</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>)</mml:mo></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mo>=</mml:mo> <mml:munder><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>k</mml:mi> <mml:mo>∈</mml:mo> <mml:msubsup><mml:mi>T</mml:mi> <mml:mi>a</mml:mi> <mml:mi>I</mml:mi></mml:msubsup></mml:mrow></mml:munder> <mml:msubsup><mml:mi>Q</mml:mi> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow> <mml:mi>ϵ</mml:mi></mml:msubsup> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>-</mml:mo> <mml:mi>P</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mspace width="2.em"/></mml:mrow></mml:mtd> <mml:mtd columnalign="right"><mml:mrow><mml:mi>x</mml:mi> <mml:mo>∈</mml:mo> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi mathvariant="script">B</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mo>-</mml:mo> <mml:mo>∇</mml:mo> <mml:mo>·</mml:mo> <mml:mo>(</mml:mo> <mml:mfrac><mml:mrow><mml:msub><mml:mi>k</mml:mi> <mml:mi>v</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:mrow> <mml:mi>μ</mml:mi></mml:mfrac> <mml:mo>∇</mml:mo> <mml:msub><mml:mi>p</mml:mi> <mml:mi>v</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>)</mml:mo></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mo>=</mml:mo> <mml:munder><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>k</mml:mi> <mml:mo>∈</mml:mo> <mml:msubsup><mml:mi>T</mml:mi> <mml:mi>v</mml:mi> <mml:mi>I</mml:mi></mml:msubsup></mml:mrow></mml:munder> <mml:msubsup><mml:mi>Q</mml:mi> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow> <mml:mi>ϵ</mml:mi></mml:msubsup> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>+</mml:mo> <mml:mi>P</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mspace width="2.em"/></mml:mrow></mml:mtd> <mml:mtd columnalign="right"><mml:mrow><mml:mi>x</mml:mi> <mml:mo>∈</mml:mo> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi mathvariant="script">B</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>u</mml:mi> <mml:mi>β</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>·</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mi>β</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mo>=</mml:mo> <mml:mn>0</mml:mn></mml:mrow></mml:mtd> <mml:mtd columnalign="right"><mml:mrow><mml:mspace width="2.em"/><mml:mi>β</mml:mi> <mml:mo>=</mml:mo> <mml:mrow><mml:mo>{</mml:mo> <mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>v</mml:mi> <mml:mo>}</mml:mo></mml:mrow> <mml:mo>,</mml:mo> <mml:mspace width="1.em"/><mml:mi>x</mml:mi> <mml:mo>∈</mml:mo> <mml:mi>∂</mml:mi> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi mathvariant="script">B</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(8)</label></disp-formula>
where <italic>n</italic><sub><italic>β</italic></sub> is the outer normal vector of the boundaries <inline-formula id="pcbi.1007073.e025"><alternatives><graphic id="pcbi.1007073.e025g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e025" xlink:type="simple"/><mml:math display="inline" id="M25"><mml:mrow><mml:mi>∂</mml:mi> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi mathvariant="script">B</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> of <inline-formula id="pcbi.1007073.e026"><alternatives><graphic id="pcbi.1007073.e026g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e026" xlink:type="simple"/><mml:math display="inline" id="M26"><mml:msub><mml:mo>Ω</mml:mo> <mml:mi mathvariant="script">B</mml:mi></mml:msub></mml:math></alternatives></inline-formula>. No-flow Neumann boundary conditions for the flux <italic>u</italic> ∝ ∇<italic>p</italic> are imposed for <inline-formula id="pcbi.1007073.e027"><alternatives><graphic id="pcbi.1007073.e027g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e027" xlink:type="simple"/><mml:math display="inline" id="M27"><mml:mrow><mml:mi>x</mml:mi> <mml:mo>∈</mml:mo> <mml:mi>∂</mml:mi> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi mathvariant="script">B</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>. The parameter <italic>ϵ</italic> is a local radius around <italic>x</italic> where <inline-formula id="pcbi.1007073.e028"><alternatives><graphic id="pcbi.1007073.e028g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e028" xlink:type="simple"/><mml:math display="inline" id="M28"><mml:mrow><mml:msubsup><mml:mi>Q</mml:mi> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow> <mml:mi>ϵ</mml:mi></mml:msubsup> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> has support, and will later be explained in more detail. Right hand side terms <inline-formula id="pcbi.1007073.e029"><alternatives><graphic id="pcbi.1007073.e029g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e029" xlink:type="simple"/><mml:math display="inline" id="M29"><mml:mrow><mml:msubsup><mml:mi>Q</mml:mi> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow> <mml:mi>ϵ</mml:mi></mml:msubsup> <mml:mo>=</mml:mo> <mml:msubsup><mml:mi>Q</mml:mi> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow> <mml:mi>ϵ</mml:mi></mml:msubsup> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> [m<sup>3</sup> s<sup>−1</sup> m<sup>−3</sup>] are volumetric sink or source terms. The perfusion <italic>P</italic> becomes a sink term for the arterial compartment and a source term in the venous compartment.</p>
</sec>
</sec>
<sec id="sec012">
<title>Governing equations in the vascular network</title>
<p>For simplicity, we currently omit the index <italic>β</italic> = {<italic>a</italic>, <italic>v</italic>} and consider either the arterial or the venous vascular network consisting of nodes <italic>N</italic><sub><italic>i</italic></sub> and edges <italic>E</italic><sub><italic>jk</italic></sub>. Each node <italic>N</italic><sub><italic>i</italic></sub> has an associated position <inline-formula id="pcbi.1007073.e030"><alternatives><graphic id="pcbi.1007073.e030g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e030" xlink:type="simple"/><mml:math display="inline" id="M30"><mml:msub><mml:mover accent="true"><mml:mi>x</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mi>i</mml:mi></mml:msub></mml:math></alternatives></inline-formula> and pressure <inline-formula id="pcbi.1007073.e031"><alternatives><graphic id="pcbi.1007073.e031g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e031" xlink:type="simple"/><mml:math display="inline" id="M31"><mml:msub><mml:mover accent="true"><mml:mi>p</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mi>i</mml:mi></mml:msub></mml:math></alternatives></inline-formula> [Pa]. An edge <italic>E</italic><sub><italic>jk</italic></sub> is the connection between the pair of nodes (<italic>N</italic><sub><italic>j</italic></sub>, <italic>N</italic><sub><italic>k</italic></sub>), and is associated with a tubular length <italic>L</italic><sub><italic>jk</italic></sub> [m] and a constant tubular radius <italic>R</italic><sub><italic>jk</italic></sub> [m]. The length <italic>L</italic><sub><italic>jk</italic></sub> is a geodesic distance measured along the tubular medial axis, and <italic>R</italic><sub><italic>jk</italic></sub> is computed as the average tubular radius along the structure <italic>E</italic><sub><italic>jk</italic></sub>. Each edge <italic>E</italic><sub><italic>jk</italic></sub> mediates an absolute flow <inline-formula id="pcbi.1007073.e032"><alternatives><graphic id="pcbi.1007073.e032g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e032" xlink:type="simple"/><mml:math display="inline" id="M32"><mml:msub><mml:mover accent="true"><mml:mi>q</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>j</mml:mi> <mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:math></alternatives></inline-formula> [m<sup>3</sup> s<sup>−1</sup>] from node <italic>N</italic><sub><italic>j</italic></sub> to node <italic>N</italic><sub><italic>k</italic></sub>. Algorithmically, the network is represented as a connectivity matrix of an undirected graph. A schematic illustration of a vascular network with proper notation is shown in <xref ref-type="fig" rid="pcbi.1007073.g004">Fig 4</xref>.</p>
<fig id="pcbi.1007073.g004" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1007073.g004</object-id>
<label>Fig 4</label>
<caption>
<title>Illustration of an arterial network with nodes <italic>N</italic><sub><italic>i</italic></sub>, <italic>i</italic> = {0, … 3} and connecting edges.</title>
<p>Each edge has an associated length <italic>L</italic><sub><italic>jk</italic></sub>, radius <italic>R</italic><sub><italic>jk</italic></sub> and medial axis (dashed lines). In the current example, <italic>N</italic><sub>0</sub>, <italic>N</italic><sub>2</sub>, <italic>N</italic><sub>3</sub> are terminal nodes, while <italic>N</italic><sub>0</sub> is also a root terminal mediating incoming fluid into the vascular network. Node <italic>N</italic><sub>1</sub> is an interior node. Brain tissue <inline-formula id="pcbi.1007073.e033"><alternatives><graphic id="pcbi.1007073.e033g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e033" xlink:type="simple"/><mml:math display="inline" id="M33"><mml:msub><mml:mo>Ω</mml:mo> <mml:mi mathvariant="script">B</mml:mi></mml:msub></mml:math></alternatives></inline-formula> is shown as a filled ellipsoid, and arrowheads indicate direction of flow. For the sake of illustration, only the arterial network is shown, but a similar, fluid collecting venous network is also present in the model.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1007073.g004" xlink:type="simple"/>
</fig>
<p>Each node <italic>N</italic><sub><italic>i</italic></sub> is connected to a set of neighboring nodes <inline-formula id="pcbi.1007073.e034"><alternatives><graphic id="pcbi.1007073.e034g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e034" xlink:type="simple"/><mml:math display="inline" id="M34"><mml:mrow><mml:mi mathvariant="script">N</mml:mi> <mml:mo>(</mml:mo> <mml:msub><mml:mi>N</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula>. A terminal node is defined as any node with only one neighbour, i.e. <inline-formula id="pcbi.1007073.e035"><alternatives><graphic id="pcbi.1007073.e035g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e035" xlink:type="simple"/><mml:math display="inline" id="M35"><mml:mrow><mml:msup><mml:mi>N</mml:mi> <mml:mi>T</mml:mi></mml:msup> <mml:mo>≔</mml:mo> <mml:mrow><mml:mo>{</mml:mo> <mml:mi>i</mml:mi> <mml:mo>:</mml:mo> <mml:mo>|</mml:mo> <mml:mi mathvariant="script">N</mml:mi></mml:mrow> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>N</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>|</mml:mo> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn> <mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> for the cardinality |⋅|, while interior nodes are nodes with more than one neighbour, <inline-formula id="pcbi.1007073.e036"><alternatives><graphic id="pcbi.1007073.e036g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e036" xlink:type="simple"/><mml:math display="inline" id="M36"><mml:mrow><mml:msup><mml:mi>N</mml:mi> <mml:mi>I</mml:mi></mml:msup> <mml:mo>≔</mml:mo> <mml:mrow><mml:mo>{</mml:mo> <mml:mi>i</mml:mi> <mml:mo>:</mml:mo> <mml:mo>|</mml:mo> <mml:mi mathvariant="script">N</mml:mi></mml:mrow> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>N</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>|</mml:mo> <mml:mo>&gt;</mml:mo> <mml:mn>1</mml:mn> <mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>. We further split the terminal nodes into root terminals and interior terminals. Root terminals <italic>N</italic><sup><italic>R</italic></sup> are pressurized terminal nodes with imposed Dirichlet boundary conditions. Algorithmically, the root terminals are the intersection points of the large vessels with the brain-background interphase <inline-formula id="pcbi.1007073.e037"><alternatives><graphic id="pcbi.1007073.e037g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e037" xlink:type="simple"/><mml:math display="inline" id="M37"><mml:mrow><mml:mi>∂</mml:mi> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi mathvariant="script">B</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>, <inline-formula id="pcbi.1007073.e038"><alternatives><graphic id="pcbi.1007073.e038g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e038" xlink:type="simple"/><mml:math display="inline" id="M38"><mml:mrow><mml:msup><mml:mi>N</mml:mi> <mml:mi>R</mml:mi></mml:msup> <mml:mo>=</mml:mo> <mml:mrow><mml:mo>{</mml:mo> <mml:mi>i</mml:mi> <mml:mo>:</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>x</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mi>i</mml:mi></mml:msub> <mml:mo>∈</mml:mo> <mml:mi>∂</mml:mi> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi mathvariant="script">B</mml:mi></mml:msub> <mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>. Interior terminals are terminal nodes placed within the domain, mediating flow from/to the vascular tree into the 3D domain. The flow in the interior terminals is a Neumann boundary condition for the microvascular flow in the 3D domain. For the remaining, we refer to interior terminals as terminals. Finally, the set of all nodes is the union of interior nodes, terminals and root terminals, <italic>N</italic><sup><italic>I</italic></sup> ∪ <italic>N</italic><sup><italic>T</italic></sup> ∪ <italic>N</italic><sup><italic>R</italic></sup>.</p>
<p>For modelling of flow through larger vessels we approximate the vessels as straight tubes of constant, circular cross-sections. We also assume laminar flow of an incompressible, Newtonian fluid. The assumption of laminar flow is supported by Reynold numbers &lt; 200 for any of the middle cerebral arteries and penetrating arterioles [<xref ref-type="bibr" rid="pcbi.1007073.ref040">40</xref>]. Under these assumptions, the vascular flow in larger vessels can be modelled using the Hagen-Poiseuille equation, relating a pressure drop <inline-formula id="pcbi.1007073.e039"><alternatives><graphic id="pcbi.1007073.e039g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e039" xlink:type="simple"/><mml:math display="inline" id="M39"><mml:mrow><mml:mo>Δ</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>p</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>j</mml:mi> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mo>≔</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>p</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mi>j</mml:mi></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>p</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mi>k</mml:mi></mml:msub></mml:mrow></mml:math></alternatives></inline-formula> of an incompressible fluid of viscosity <italic>μ</italic> [Pa ⋅ s] through <italic>E</italic><sub><italic>jk</italic></sub> to the flow <inline-formula id="pcbi.1007073.e040"><alternatives><graphic id="pcbi.1007073.e040g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e040" xlink:type="simple"/><mml:math display="inline" id="M40"><mml:msub><mml:mover accent="true"><mml:mi>q</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>j</mml:mi> <mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:math></alternatives></inline-formula> between two nodes <italic>N</italic><sub><italic>j</italic></sub> and <italic>N</italic><sub><italic>k</italic></sub> [<xref ref-type="bibr" rid="pcbi.1007073.ref041">41</xref>],
<disp-formula id="pcbi.1007073.e041"><alternatives><graphic id="pcbi.1007073.e041g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e041" xlink:type="simple"/><mml:math display="block" id="M41"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mo>Δ</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>p</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>j</mml:mi> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mo>=</mml:mo> <mml:mfrac><mml:mrow><mml:mn>8</mml:mn> <mml:mi>μ</mml:mi> <mml:msub><mml:mi>L</mml:mi> <mml:mrow><mml:mi>j</mml:mi> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:msub><mml:mover accent="true"><mml:mi>q</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>j</mml:mi> <mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow> <mml:mrow><mml:mi>π</mml:mi> <mml:msubsup><mml:mi>R</mml:mi> <mml:mrow><mml:mi>j</mml:mi> <mml:mi>k</mml:mi></mml:mrow> <mml:mn>4</mml:mn></mml:msubsup></mml:mrow></mml:mfrac> <mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(9)</label></disp-formula>
Fluid mass balance must be ensured for each interior node
<disp-formula id="pcbi.1007073.e042"><alternatives><graphic id="pcbi.1007073.e042g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e042" xlink:type="simple"/><mml:math display="block" id="M42"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:munder><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>j</mml:mi> <mml:mo>∈</mml:mo> <mml:mi mathvariant="script">N</mml:mi> <mml:mo>(</mml:mo> <mml:msub><mml:mi>N</mml:mi> <mml:mi>k</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow></mml:munder> <mml:msub><mml:mover accent="true"><mml:mi>q</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>j</mml:mi> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mo>=</mml:mo> <mml:mn>0</mml:mn> <mml:mo>,</mml:mo> <mml:mspace width="2.em"/><mml:mi>k</mml:mi> <mml:mo>∈</mml:mo> <mml:msup><mml:mi>N</mml:mi> <mml:mi>I</mml:mi></mml:msup> <mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(10)</label></disp-formula>
Denoting <inline-formula id="pcbi.1007073.e043"><alternatives><graphic id="pcbi.1007073.e043g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e043" xlink:type="simple"/><mml:math display="inline" id="M43"><mml:mrow><mml:msub><mml:mi>κ</mml:mi> <mml:mrow><mml:mi>j</mml:mi> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mo>≔</mml:mo> <mml:mi>π</mml:mi> <mml:msubsup><mml:mi>R</mml:mi> <mml:mrow><mml:mi>j</mml:mi> <mml:mi>k</mml:mi></mml:mrow> <mml:mn>4</mml:mn></mml:msubsup> <mml:mo>/</mml:mo> <mml:mn>8</mml:mn> <mml:mi>μ</mml:mi> <mml:msub><mml:mi>L</mml:mi> <mml:mrow><mml:mi>j</mml:mi> <mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:math></alternatives></inline-formula>, and combining (<xref ref-type="disp-formula" rid="pcbi.1007073.e041">9</xref>) with (<xref ref-type="disp-formula" rid="pcbi.1007073.e042">10</xref>) yields the relation
<disp-formula id="pcbi.1007073.e044"><alternatives><graphic id="pcbi.1007073.e044g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e044" xlink:type="simple"/><mml:math display="block" id="M44"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:munder><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>j</mml:mi> <mml:mo>∈</mml:mo> <mml:mi mathvariant="script">N</mml:mi> <mml:mo>(</mml:mo> <mml:msub><mml:mi>N</mml:mi> <mml:mi>k</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow></mml:munder> <mml:msub><mml:mi>κ</mml:mi> <mml:mrow><mml:mi>j</mml:mi> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>p</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mi>j</mml:mi></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>p</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mi>k</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:mn>0</mml:mn> <mml:mo>,</mml:mo> <mml:mspace width="2.em"/><mml:mi>k</mml:mi> <mml:mo>∈</mml:mo> <mml:msup><mml:mi>N</mml:mi> <mml:mi>I</mml:mi></mml:msup></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(11)</label></disp-formula>
for the fluid mass balance of each interior node. Within the arterial and networks we assume full porosity, hence collapsing into one-compartment flow. The root terminals represent the outer boundaries of the complete flow system, and each of the root terminals are therefore assigned a user-provided Dirichlet boundary condition <inline-formula id="pcbi.1007073.e045"><alternatives><graphic id="pcbi.1007073.e045g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e045" xlink:type="simple"/><mml:math display="inline" id="M45"><mml:msub><mml:mover accent="true"><mml:mi>p</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mn>0</mml:mn></mml:msub></mml:math></alternatives></inline-formula> <disp-formula id="pcbi.1007073.e046"><alternatives><graphic id="pcbi.1007073.e046g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e046" xlink:type="simple"/><mml:math display="block" id="M46"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>p</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mi>k</mml:mi></mml:msub> <mml:mo>=</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>p</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mn>0</mml:mn></mml:msub> <mml:mspace width="2.em"/><mml:mo>∀</mml:mo> <mml:mspace width="3.33333pt"/><mml:mi>k</mml:mi> <mml:mo>∈</mml:mo> <mml:msup><mml:mi>N</mml:mi> <mml:mi>R</mml:mi></mml:msup> <mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(12)</label></disp-formula>
From the definition of a terminal node, terminal nodes have only one neighbour, i.e. only one edge connection, and the flow in each of the terminal nodes can be expressed as
<disp-formula id="pcbi.1007073.e047"><alternatives><graphic id="pcbi.1007073.e047g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e047" xlink:type="simple"/><mml:math display="block" id="M47"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mover accent="true"><mml:msub><mml:mi>q</mml:mi> <mml:mi>k</mml:mi></mml:msub> <mml:mo>˜</mml:mo></mml:mover> <mml:mo>=</mml:mo> <mml:msub><mml:mi>κ</mml:mi> <mml:mrow><mml:mi>j</mml:mi> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>p</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mi>j</mml:mi></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>p</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mi>k</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>,</mml:mo> <mml:mspace width="1.em"/><mml:mi>j</mml:mi> <mml:mo>∈</mml:mo> <mml:mi mathvariant="script">N</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>N</mml:mi> <mml:mi>k</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mspace width="2.em"/><mml:mo>∀</mml:mo> <mml:mspace width="3.33333pt"/><mml:mi>k</mml:mi> <mml:mo>∈</mml:mo> <mml:msup><mml:mi>N</mml:mi> <mml:mi>I</mml:mi></mml:msup> <mml:mspace width="2.em"/></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(13)</label></disp-formula>
providing Neumann boundary conditions of flow continuity between the arterial/venous network and the brain. This topic is further addressed in the next section.</p>
</sec>
<sec id="sec013">
<title>Distributing flow from the terminals</title>
<p>The intersection point connecting the flow in the 1D tubular network with the flow in the generic 3D tissue yields a singularity both in terms of physics and numerics. Physically, there is a modelling gap between the explicit, macro scale representation of arterial/veinal flow and the micro circulation in the 3D domain. In our model, we fill this gap using a volumetric source term <italic>Q</italic><sup><italic>ϵ</italic></sup> [m<sup>3</sup> s<sup>−1</sup> m<sup>−3</sup>]. For <italic>ϵ</italic> = 0 this is essentially a Dirac measure
<disp-formula id="pcbi.1007073.e048"><alternatives><graphic id="pcbi.1007073.e048g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e048" xlink:type="simple"/><mml:math display="block" id="M48"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msup><mml:mi>Q</mml:mi> <mml:mn>0</mml:mn></mml:msup> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:msub><mml:mo>∫</mml:mo> <mml:mo>Ω</mml:mo></mml:msub> <mml:mi>Q</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>y</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mi>δ</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>-</mml:mo> <mml:mi>y</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mi>d</mml:mi> <mml:mi>y</mml:mi></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(14)</label></disp-formula>
where all fluid is distributed within an infinitely small point. However, assume that the blood from the terminals is distributed along a fine scale network which is not visible at the imaging resolution. The idea is to replace the Dirac measure, which is not physically sound, with a more realistic model of the source region with a characteristic radius <italic>ϵ</italic>. To this end, define the support function
<disp-formula id="pcbi.1007073.e049"><alternatives><graphic id="pcbi.1007073.e049g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e049" xlink:type="simple"/><mml:math display="block" id="M49"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msup><mml:mi>η</mml:mi> <mml:mi>ϵ</mml:mi></mml:msup> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>≔</mml:mo> <mml:mfrac><mml:mn>1</mml:mn> <mml:msup><mml:mi>ϵ</mml:mi> <mml:mi>n</mml:mi></mml:msup></mml:mfrac> <mml:mi>η</mml:mi> <mml:mo>(</mml:mo> <mml:mfrac><mml:mi>x</mml:mi> <mml:mi>ϵ</mml:mi></mml:mfrac> <mml:mo>)</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(15)</label></disp-formula>
where the shape function <italic>η</italic> is any positive and continuously differentiable function satisfying <inline-formula id="pcbi.1007073.e050"><alternatives><graphic id="pcbi.1007073.e050g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e050" xlink:type="simple"/><mml:math display="inline" id="M50"><mml:mrow><mml:msub><mml:mo>∫</mml:mo> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi mathvariant="double-struck">B</mml:mi></mml:msub></mml:msub> <mml:mi>η</mml:mi> <mml:mi>d</mml:mi> <mml:mi>x</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow></mml:math></alternatives></inline-formula>. In principle, the shape function <italic>η</italic> should reflect the structure of the sub-resolution arterial and venous trees, but due to the lack of such data we adopt the generic choice
<disp-formula id="pcbi.1007073.e051"><alternatives><graphic id="pcbi.1007073.e051g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e051" xlink:type="simple"/><mml:math display="block" id="M51"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>η</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>≔</mml:mo> <mml:mo>{</mml:mo> <mml:mtable><mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:mi>C</mml:mi> <mml:mspace width="2pt"/><mml:mtext>exp</mml:mtext> <mml:mspace width="2pt"/><mml:mo>(</mml:mo> <mml:mfrac><mml:mn>1</mml:mn> <mml:mrow><mml:msup><mml:mrow><mml:mo>|</mml:mo> <mml:mi>x</mml:mi> <mml:mo>|</mml:mo></mml:mrow> <mml:mn>2</mml:mn></mml:msup> <mml:mo>-</mml:mo> <mml:mn>1</mml:mn></mml:mrow></mml:mfrac> <mml:mo>)</mml:mo></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mspace width="4.pt"/><mml:mtext>if</mml:mtext> <mml:mspace width="4.pt"/><mml:mo>|</mml:mo> <mml:mi>x</mml:mi> <mml:mo>[</mml:mo> <mml:mo>&lt;</mml:mo> <mml:mn>1</mml:mn> <mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mn>0</mml:mn></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mspace width="4.pt"/><mml:mtext>if</mml:mtext> <mml:mspace width="4.pt"/><mml:mo>|</mml:mo> <mml:mi>x</mml:mi> <mml:mo>|</mml:mo> <mml:mo>≥</mml:mo> <mml:mn>1</mml:mn> <mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable> <mml:mo/></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(16)</label></disp-formula>
An appropriate expression for the source terms then becomes
<disp-formula id="pcbi.1007073.e052"><alternatives><graphic id="pcbi.1007073.e052g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e052" xlink:type="simple"/><mml:math display="block" id="M52"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msup><mml:mi>Q</mml:mi> <mml:mi>ϵ</mml:mi></mml:msup> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:msub><mml:mo>∫</mml:mo> <mml:mo>Ω</mml:mo></mml:msub> <mml:mi>Q</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>y</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:msup><mml:mi>η</mml:mi> <mml:mi>ϵ</mml:mi></mml:msup> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>-</mml:mo> <mml:mi>y</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mi>d</mml:mi> <mml:mi>y</mml:mi> <mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(17)</label></disp-formula>
Due to the properties that both the Dirac delta distribution and the source distribution integrate to unity, we note that the total integral over (<xref ref-type="disp-formula" rid="pcbi.1007073.e048">14</xref>) and (<xref ref-type="disp-formula" rid="pcbi.1007073.e052">17</xref>) remains the same and global mass balance is ensured from the terminals. Moreover, (<xref ref-type="disp-formula" rid="pcbi.1007073.e052">17</xref>) converges to (<xref ref-type="disp-formula" rid="pcbi.1007073.e048">14</xref>) in the case where <italic>ϵ</italic> → 0, justifying the notation <italic>Q</italic><sup>0</sup> in (<xref ref-type="disp-formula" rid="pcbi.1007073.e048">14</xref>). For the remaining, adopt the notation of <italic>β</italic> indicating characteristics of the arterial (<italic>β</italic> = <italic>a</italic>) or venous (<italic>β</italic> = <italic>v</italic>) tree, e.g. single nodes <italic>N</italic><sub><italic>k</italic></sub> → <italic>N</italic><sub><italic>β</italic>,<italic>k</italic></sub> or the set of nodes <inline-formula id="pcbi.1007073.e053"><alternatives><graphic id="pcbi.1007073.e053g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e053" xlink:type="simple"/><mml:math display="inline" id="M53"><mml:mrow><mml:msup><mml:mi>N</mml:mi> <mml:mi>j</mml:mi></mml:msup> <mml:mo>→</mml:mo> <mml:msubsup><mml:mi>N</mml:mi> <mml:mi>β</mml:mi> <mml:mi>j</mml:mi></mml:msubsup> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi> <mml:mo>∈</mml:mo> <mml:mrow><mml:mo>{</mml:mo> <mml:mi>I</mml:mi> <mml:mo>,</mml:mo> <mml:mi>T</mml:mi> <mml:mo>,</mml:mo> <mml:mi>R</mml:mi> <mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>. Considering the volumetric source/sink terms <inline-formula id="pcbi.1007073.e054"><alternatives><graphic id="pcbi.1007073.e054g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e054" xlink:type="simple"/><mml:math display="inline" id="M54"><mml:msubsup><mml:mi>Q</mml:mi> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow> <mml:mi>ϵ</mml:mi></mml:msubsup></mml:math></alternatives></inline-formula> in (<xref ref-type="disp-formula" rid="pcbi.1007073.e024">8</xref>), the total flow contribution (<xref ref-type="disp-formula" rid="pcbi.1007073.e052">17</xref>) from terminal <italic>k</italic> can be approximated as
<disp-formula id="pcbi.1007073.e055"><alternatives><graphic id="pcbi.1007073.e055g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e055" xlink:type="simple"/><mml:math display="block" id="M55"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msubsup><mml:mi>Q</mml:mi> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow> <mml:mi>ϵ</mml:mi></mml:msubsup> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:msub><mml:mi>Q</mml:mi> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:msubsup><mml:mi>η</mml:mi> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow> <mml:mi>ϵ</mml:mi></mml:msubsup> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>-</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>x</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mi>k</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>|</mml:mo> <mml:msub><mml:mi>N</mml:mi> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mo>|</mml:mo></mml:mrow> <mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(18)</label></disp-formula>
where |<italic>N</italic><sub><italic>β</italic>,<italic>k</italic></sub>| is the node volume. The volumetric flow <italic>Q</italic><sub><italic>β</italic>,<italic>k</italic></sub> through terminal <italic>k</italic> relates to the absolute flow <inline-formula id="pcbi.1007073.e056"><alternatives><graphic id="pcbi.1007073.e056g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e056" xlink:type="simple"/><mml:math display="inline" id="M56"><mml:msub><mml:mover accent="true"><mml:mi>q</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:math></alternatives></inline-formula> by
<disp-formula id="pcbi.1007073.e057"><alternatives><graphic id="pcbi.1007073.e057g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e057" xlink:type="simple"/><mml:math display="block" id="M57"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>Q</mml:mi> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mo>=</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>q</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mo>/</mml:mo> <mml:mrow><mml:mo>|</mml:mo> <mml:msub><mml:mi>N</mml:mi> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mo>|</mml:mo></mml:mrow> <mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(19)</label></disp-formula>
thus providing the relation
<disp-formula id="pcbi.1007073.e058"><alternatives><graphic id="pcbi.1007073.e058g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e058" xlink:type="simple"/><mml:math display="block" id="M58"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msubsup><mml:mi>Q</mml:mi> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow> <mml:mi>ϵ</mml:mi></mml:msubsup> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>q</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:msubsup><mml:mi>η</mml:mi> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow> <mml:mi>ϵ</mml:mi></mml:msubsup> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>-</mml:mo> <mml:msub><mml:mi>x</mml:mi> <mml:mi>k</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(20)</label></disp-formula></p>
</sec>
<sec id="sec014">
<title>Continuity in pressure</title>
<p>In the flow-distribution region around each interior terminal |<italic>x</italic> − <italic>x</italic><sub><italic>k</italic></sub>| &lt; <italic>ϵ</italic> we require that the pressure drop between a terminal node <italic>N</italic><sub><italic>β</italic>,<italic>k</italic></sub> and the surrounding brain tissue satisfying |<italic>x</italic> − <italic>x</italic><sub><italic>k</italic></sub>| &lt; <italic>ϵ</italic> scales with the terminal flow up to a user-provided constant <italic>γ</italic><sub><italic>β</italic></sub> <disp-formula id="pcbi.1007073.e059"><alternatives><graphic id="pcbi.1007073.e059g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e059" xlink:type="simple"/><mml:math display="block" id="M59"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>q</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mo>=</mml:mo> <mml:mfrac><mml:msub><mml:mi>γ</mml:mi> <mml:mi>β</mml:mi></mml:msub> <mml:mi>μ</mml:mi></mml:mfrac> <mml:mo>(</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>p</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mo>∫</mml:mo> <mml:mo>Ω</mml:mo></mml:msub> <mml:msubsup><mml:mi>η</mml:mi> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow> <mml:mi>ϵ</mml:mi></mml:msubsup> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>-</mml:mo> <mml:msub><mml:mi>x</mml:mi> <mml:mi>k</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:msub><mml:mi>p</mml:mi> <mml:mi>β</mml:mi></mml:msub> <mml:mi>d</mml:mi> <mml:mi>x</mml:mi> <mml:mo>)</mml:mo> <mml:mspace width="2.em"/><mml:mspace width="2.em"/></mml:mrow></mml:mtd> <mml:mtd><mml:mrow><mml:mo>∀</mml:mo> <mml:mspace width="3.33333pt"/><mml:mi>k</mml:mi> <mml:mo>∈</mml:mo> <mml:msubsup><mml:mi>N</mml:mi> <mml:mi>β</mml:mi> <mml:mi>I</mml:mi></mml:msubsup> <mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(21)</label></disp-formula>
The coefficient <italic>γ</italic><sub><italic>β</italic></sub> has the interpretation of an effective resistance in the unresolved network extending from the terminal node. A higher value of <italic>γ</italic><sub><italic>β</italic></sub> will enforce a lower pressure drop between the vascular tree and the microvascular model, and vice versa. This closes the coupled modelling system, where the complete flow model is formed from (<xref ref-type="disp-formula" rid="pcbi.1007073.e023">7</xref>), (<xref ref-type="disp-formula" rid="pcbi.1007073.e024">8</xref>), (<xref ref-type="disp-formula" rid="pcbi.1007073.e044">11</xref>), (<xref ref-type="disp-formula" rid="pcbi.1007073.e046">12</xref>), (<xref ref-type="disp-formula" rid="pcbi.1007073.e047">13</xref>), (<xref ref-type="disp-formula" rid="pcbi.1007073.e058">20</xref>), (<xref ref-type="disp-formula" rid="pcbi.1007073.e059">21</xref>).</p>
</sec>
<sec id="sec015">
<title>Generating maps of the perfusion proportionality factor <italic>α</italic>(<italic>x</italic>)</title>
<p>For the real brain application, voxelwise maps of the perfusion proportionality factor <italic>α</italic> (<xref ref-type="disp-formula" rid="pcbi.1007073.e023">7</xref>) were generated with higher values in grey matter than in white matter [<xref ref-type="bibr" rid="pcbi.1007073.ref042">42</xref>], ensuring a physiologically reasonable map. We illustrate our approach by applying the method also to simulate flow in a frog tongue. In this specific example there is no grey or white matter, and we use <italic>α</italic> constant everywhere.</p>
</sec>
<sec id="sec016">
<title>Tracer mass balance and indicator dilution</title>
<p>The equations in the preceding sections describe blood propagation from the arterial to the venous side of the brain vascularity. In order to simulate a real contrast enhanced MR acquisition we also introduce a model for transport of a tracer in the bloodstream. All quantities are assumed to be in SI units, and later converted to more appropriate units for presentation whenever needed. Observable or volumetric tracer concentration <italic>C</italic>(<italic>x</italic>, <italic>t</italic>) [mol/m<sup>3</sup>] is a linear function of the fractional volumetric tracer concentrations <italic>C</italic><sub><italic>β</italic></sub>(<italic>x</italic>, <italic>t</italic>) for each of the compartments
<disp-formula id="pcbi.1007073.e060"><alternatives><graphic id="pcbi.1007073.e060g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e060" xlink:type="simple"/><mml:math display="block" id="M60"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>C</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>,</mml:mo> <mml:mi>t</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:msub><mml:mi>C</mml:mi> <mml:mi>a</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>,</mml:mo> <mml:mi>t</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>+</mml:mo> <mml:msub><mml:mi>C</mml:mi> <mml:mi>v</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>,</mml:mo> <mml:mi>t</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(22)</label></disp-formula>
Furthermore, tracer distribution volume is different from a geometric volume whenever <italic>ϕ</italic><sub><italic>β</italic></sub> &lt; 1, leading to the relation
<disp-formula id="pcbi.1007073.e061"><alternatives><graphic id="pcbi.1007073.e061g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e061" xlink:type="simple"/><mml:math display="block" id="M61"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>C</mml:mi> <mml:mi>β</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>,</mml:mo> <mml:mi>t</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:msub><mml:mi>ϕ</mml:mi> <mml:mi>β</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:msub><mml:mi>c</mml:mi> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>b</mml:mi></mml:mrow></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>,</mml:mo> <mml:mi>t</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(23)</label></disp-formula>
connecting blood tracer concentration <italic>c</italic><sub><italic>β</italic>,<italic>b</italic></sub>(<italic>x</italic>, <italic>t</italic>) [mol/m<sup>3</sup>] to volumetric tracer concentration <italic>C</italic><sub><italic>β</italic></sub>(<italic>x</italic>, <italic>t</italic>).</p>
<p>The following criteria are assumed to hold: The tracer is homogeneously distributed in the fluid within a small distribution volume Ω<sub><italic>i</italic></sub> (i.e. a voxel or a node), all physiological and structural parameters are stationary within the time of acquisition, and tracer transport by diffusion is not considered. Under these assumptions, the influx of tracer into Ω<sub><italic>i</italic></sub> is determined by the product of fluid tracer concentration <italic>c</italic><sub><italic>β</italic></sub>(<italic>x</italic>, <italic>t</italic>) and flux <italic>u</italic><sub><italic>β</italic></sub>(<italic>x</italic>)
<disp-formula id="pcbi.1007073.e062"><alternatives><graphic id="pcbi.1007073.e062g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e062" xlink:type="simple"/><mml:math display="block" id="M62"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mo>-</mml:mo> <mml:msub><mml:mo>∫</mml:mo> <mml:mrow><mml:mi>∂</mml:mi> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msub> <mml:msub><mml:mi>c</mml:mi> <mml:mi>β</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>u</mml:mi> <mml:mi>β</mml:mi></mml:msub> <mml:mo>·</mml:mo> <mml:mi>n</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mi>d</mml:mi> <mml:mi>A</mml:mi></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(24)</label></disp-formula>
where <italic>n</italic> is the outward pointing surface normal of Ω<sub><italic>i</italic></sub>. The rate of change of tracer within the control volume yields
<disp-formula id="pcbi.1007073.e063"><alternatives><graphic id="pcbi.1007073.e063g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e063" xlink:type="simple"/><mml:math display="block" id="M63"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mstyle displaystyle="true" scriptlevel="0"><mml:mfrac><mml:mi>d</mml:mi> <mml:mrow><mml:mi>d</mml:mi> <mml:mi>t</mml:mi></mml:mrow></mml:mfrac></mml:mstyle> <mml:msub><mml:mo>∫</mml:mo> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi>i</mml:mi></mml:msub></mml:msub> <mml:msub><mml:mi>C</mml:mi> <mml:mi>β</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>,</mml:mo> <mml:mi>t</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mi>d</mml:mi> <mml:mi>x</mml:mi> <mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(25)</label></disp-formula>
In addition, one must account for volumetric source terms. Combining (<xref ref-type="disp-formula" rid="pcbi.1007073.e062">24</xref>) with (<xref ref-type="disp-formula" rid="pcbi.1007073.e063">25</xref>) and allowing for perfusion and inflow and outflow of tracer from/to all interior terminals, an upstream finite volume model for tracer mass balance can be phrased as
<disp-formula id="pcbi.1007073.e064"><alternatives><graphic id="pcbi.1007073.e064g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e064" xlink:type="simple"/><mml:math display="block" id="M64"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mo>∫</mml:mo> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi>i</mml:mi></mml:msub></mml:msub> <mml:msub><mml:mi>ϕ</mml:mi> <mml:mi>a</mml:mi></mml:msub> <mml:mstyle displaystyle="true" scriptlevel="0"><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi> <mml:msub><mml:mi>c</mml:mi> <mml:mi>a</mml:mi></mml:msub></mml:mrow> <mml:mrow><mml:mi>∂</mml:mi> <mml:mi>t</mml:mi></mml:mrow></mml:mfrac></mml:mstyle> <mml:mi>d</mml:mi> <mml:mi>x</mml:mi></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mo>=</mml:mo> <mml:mo>-</mml:mo> <mml:msub><mml:mo>∫</mml:mo> <mml:mrow><mml:mi>∂</mml:mi> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msub> <mml:msub><mml:mi>c</mml:mi> <mml:mi>a</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>u</mml:mi> <mml:mi>a</mml:mi></mml:msub> <mml:mo>·</mml:mo> <mml:mi>n</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mi>d</mml:mi> <mml:mi>A</mml:mi> <mml:mo>-</mml:mo> <mml:msub><mml:mo>∫</mml:mo> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi>i</mml:mi></mml:msub></mml:msub> <mml:msup><mml:mi>c</mml:mi> <mml:mrow><mml:mo>″</mml:mo></mml:mrow></mml:msup> <mml:mi>P</mml:mi> <mml:mi>d</mml:mi> <mml:mi>x</mml:mi> <mml:mo>+</mml:mo> <mml:munder><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>k</mml:mi> <mml:mo>∈</mml:mo> <mml:msubsup><mml:mi>N</mml:mi> <mml:mi>a</mml:mi> <mml:mi>I</mml:mi></mml:msubsup></mml:mrow></mml:munder> <mml:msub><mml:mo>∫</mml:mo> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi>i</mml:mi></mml:msub></mml:msub> <mml:msubsup><mml:mi>c</mml:mi> <mml:mi>a</mml:mi> <mml:mo>′</mml:mo></mml:msubsup> <mml:msub><mml:mover accent="true"><mml:mi>q</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:msubsup><mml:mi>η</mml:mi> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow> <mml:mi>ϵ</mml:mi></mml:msubsup> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>-</mml:mo> <mml:msub><mml:mi>x</mml:mi> <mml:mi>k</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mi>d</mml:mi> <mml:mi>x</mml:mi> <mml:mspace width="2.em"/></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mi>x</mml:mi> <mml:mo>∈</mml:mo> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi mathvariant="script">B</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mtext>for</mml:mtext> <mml:mspace width="4.pt"/><mml:msubsup><mml:mi>c</mml:mi> <mml:mi>a</mml:mi> <mml:mo>′</mml:mo></mml:msubsup></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mo>=</mml:mo> <mml:mo>{</mml:mo> <mml:mtable><mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>c</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>t</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mspace width="4.pt"/><mml:mtext>if</mml:mtext> <mml:mspace width="4.pt"/><mml:msub><mml:mover accent="true"><mml:mi>q</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mo>≥</mml:mo> <mml:mn>0</mml:mn> <mml:mspace width="2.em"/><mml:mtext>(Node</mml:mtext> <mml:mspace width="4.pt"/><mml:mtext>is</mml:mtext> <mml:mspace width="4.pt"/><mml:mtext>upstream)</mml:mtext></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:msub><mml:mi>c</mml:mi> <mml:mi>a</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>,</mml:mo> <mml:mi>t</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mspace width="4.pt"/><mml:mtext>if</mml:mtext> <mml:mspace width="4.pt"/><mml:msub><mml:mover accent="true"><mml:mi>q</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mo>&lt;</mml:mo> <mml:mn>0</mml:mn> <mml:mspace width="2.em"/><mml:mtext>(Brain</mml:mtext> <mml:mspace width="4.pt"/><mml:mtext>tissue</mml:mtext> <mml:mspace width="4.pt"/><mml:mtext>is</mml:mtext> <mml:mspace width="4.pt"/><mml:mtext>upstream)</mml:mtext></mml:mrow></mml:mtd></mml:mtr></mml:mtable> <mml:mo/></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mo>∫</mml:mo> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi>i</mml:mi></mml:msub></mml:msub> <mml:msub><mml:mi>ϕ</mml:mi> <mml:mi>v</mml:mi></mml:msub> <mml:mstyle displaystyle="true" scriptlevel="0"><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi> <mml:msub><mml:mi>c</mml:mi> <mml:mi>v</mml:mi></mml:msub></mml:mrow> <mml:mrow><mml:mi>∂</mml:mi> <mml:mi>t</mml:mi></mml:mrow></mml:mfrac></mml:mstyle> <mml:mi>d</mml:mi> <mml:mi>x</mml:mi></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mo>=</mml:mo> <mml:mo>-</mml:mo> <mml:msub><mml:mo>∫</mml:mo> <mml:mrow><mml:mi>∂</mml:mi> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msub> <mml:msub><mml:mi>c</mml:mi> <mml:mi>v</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>u</mml:mi> <mml:mi>v</mml:mi></mml:msub> <mml:mo>·</mml:mo> <mml:mi>n</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mi>d</mml:mi> <mml:mi>A</mml:mi> <mml:mo>+</mml:mo> <mml:msub><mml:mo>∫</mml:mo> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi>i</mml:mi></mml:msub></mml:msub> <mml:msup><mml:mi>c</mml:mi> <mml:mrow><mml:mo>″</mml:mo></mml:mrow></mml:msup> <mml:mi>P</mml:mi> <mml:mi>d</mml:mi> <mml:mi>x</mml:mi> <mml:mo>+</mml:mo> <mml:munder><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>k</mml:mi> <mml:mo>∈</mml:mo> <mml:msubsup><mml:mi>N</mml:mi> <mml:mi>v</mml:mi> <mml:mi>I</mml:mi></mml:msubsup></mml:mrow></mml:munder> <mml:msub><mml:mo>∫</mml:mo> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi>i</mml:mi></mml:msub></mml:msub> <mml:msubsup><mml:mi>c</mml:mi> <mml:mi>v</mml:mi> <mml:mo>′</mml:mo></mml:msubsup> <mml:msub><mml:mover accent="true"><mml:mi>q</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:msubsup><mml:mi>η</mml:mi> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow> <mml:mi>ϵ</mml:mi></mml:msubsup> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>-</mml:mo> <mml:msub><mml:mi>x</mml:mi> <mml:mi>k</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mi>d</mml:mi> <mml:mi>x</mml:mi> <mml:mspace width="2.em"/></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mi>x</mml:mi> <mml:mo>∈</mml:mo> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi mathvariant="script">B</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mtext>for</mml:mtext> <mml:mspace width="4.pt"/><mml:msubsup><mml:mi>c</mml:mi> <mml:mi>v</mml:mi> <mml:mo>′</mml:mo></mml:msubsup></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mo>=</mml:mo> <mml:mo>{</mml:mo> <mml:mtable><mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:msub><mml:mi>c</mml:mi> <mml:mi>v</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>,</mml:mo> <mml:mi>t</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mspace width="4.pt"/><mml:mtext>if</mml:mtext> <mml:mspace width="4.pt"/><mml:msub><mml:mover accent="true"><mml:mi>q</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mo>&lt;</mml:mo> <mml:mn>0</mml:mn> <mml:mspace width="2.em"/><mml:mtext>(Brain</mml:mtext> <mml:mspace width="4.pt"/><mml:mtext>tissue</mml:mtext> <mml:mspace width="4.pt"/><mml:mtext>is</mml:mtext> <mml:mspace width="4.pt"/><mml:mtext>upstream)</mml:mtext></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>c</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>t</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mspace width="4.pt"/><mml:mtext>if</mml:mtext> <mml:mspace width="4.pt"/><mml:msub><mml:mover accent="true"><mml:mi>q</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mo>≥</mml:mo> <mml:mn>0</mml:mn> <mml:mspace width="2.em"/><mml:mtext>(Node</mml:mtext> <mml:mspace width="4.pt"/><mml:mtext>is</mml:mtext> <mml:mspace width="4.pt"/><mml:mtext>upstream)</mml:mtext></mml:mrow></mml:mtd></mml:mtr></mml:mtable> <mml:mo/></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mspace width="4.pt"/><mml:mtext>and</mml:mtext> <mml:mspace width="4.pt"/><mml:mtext>where</mml:mtext> <mml:mspace width="4.pt"/><mml:msup><mml:mi>c</mml:mi> <mml:mrow><mml:mo>″</mml:mo></mml:mrow></mml:msup></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mo>=</mml:mo> <mml:mo>{</mml:mo> <mml:mtable><mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:msub><mml:mi>c</mml:mi> <mml:mi>a</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>,</mml:mo> <mml:mi>t</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mspace width="4.pt"/><mml:mtext>if</mml:mtext> <mml:mspace width="4.pt"/><mml:msub><mml:mi>p</mml:mi> <mml:mi>a</mml:mi></mml:msub> <mml:mo>≥</mml:mo> <mml:msub><mml:mi>p</mml:mi> <mml:mi>v</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:msub><mml:mi>c</mml:mi> <mml:mi>v</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>,</mml:mo> <mml:mi>t</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mspace width="4.pt"/><mml:mtext>if</mml:mtext> <mml:mspace width="4.pt"/><mml:msub><mml:mi>p</mml:mi> <mml:mi>a</mml:mi></mml:msub> <mml:mo>&lt;</mml:mo> <mml:msub><mml:mi>p</mml:mi> <mml:mi>v</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable> <mml:mo/> <mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(26)</label></disp-formula>
For the edges <italic>E</italic><sub><italic>β</italic>,<italic>jk</italic></sub> we construct a finer discretization in order to facilitate graded tracer concentration along the edges. Hence, split each edge <italic>E</italic><sub><italic>β</italic>,<italic>jk</italic></sub> into <italic>n</italic><sub><italic>β</italic>,<italic>jk</italic></sub> subsegments associated with medial axis voxels, and assign every remaining voxel in the edge to the closest medial axis point, leading to disc-like discretization volumes <italic>E</italic><sub><italic>β</italic>,<italic>jk</italic>,<italic>i</italic></sub> referring to subsegment <italic>i</italic> within edge <italic>E</italic><sub><italic>β</italic>,<italic>jk</italic></sub>. Also, assume the order of subsegments is downstream with increasing index <italic>i</italic>. In particular, <inline-formula id="pcbi.1007073.e065"><alternatives><graphic id="pcbi.1007073.e065g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e065" xlink:type="simple"/><mml:math display="inline" id="M65"><mml:msub><mml:mi>c</mml:mi> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi> <mml:mi>k</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi> <mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:math></alternatives></inline-formula> refers to the tracer concentration in the last subsegment of edge <italic>E</italic><sub><italic>β</italic>,<italic>jk</italic></sub>, which is identical to the first subsegment upstream of node <italic>k</italic>. Similar equations as (<xref ref-type="disp-formula" rid="pcbi.1007073.e064">26</xref>) apply to the nodes under the assumption of full porosity within the distributing node volume
<disp-formula id="pcbi.1007073.e066"><alternatives><graphic id="pcbi.1007073.e066g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e066" xlink:type="simple"/><mml:math display="block" id="M66"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mo>∫</mml:mo> <mml:msub><mml:mi>N</mml:mi> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:msub> <mml:msub><mml:mover accent="true"><mml:mi>ϕ</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mstyle displaystyle="true" scriptlevel="0"><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi> <mml:msub><mml:mover accent="true"><mml:mi>c</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow> <mml:mrow><mml:mi>∂</mml:mi> <mml:mi>t</mml:mi></mml:mrow></mml:mfrac></mml:mstyle> <mml:mi>d</mml:mi> <mml:mi>x</mml:mi></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mo>=</mml:mo> <mml:mo>Δ</mml:mo> <mml:msub><mml:mi>f</mml:mi> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mo>Δ</mml:mo> <mml:msub><mml:mi>f</mml:mi> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mo>=</mml:mo> <mml:mo>{</mml:mo> <mml:mtable><mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:mo>-</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>c</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>A</mml:mi> <mml:mi>I</mml:mi> <mml:mi>F</mml:mi></mml:mrow></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>c</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:msub><mml:mover accent="true"><mml:mi>q</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mspace width="4.pt"/><mml:mtext>if</mml:mtext> <mml:mspace width="4.pt"/><mml:mi>k</mml:mi> <mml:mo>∈</mml:mo> <mml:msubsup><mml:mi>N</mml:mi> <mml:mi>a</mml:mi> <mml:mi>R</mml:mi></mml:msubsup> <mml:mspace width="4.pt"/><mml:mtext>(root</mml:mtext> <mml:mspace width="4.pt"/><mml:mtext>terminal,</mml:mtext> <mml:mspace width="4.pt"/><mml:msub><mml:mover accent="true"><mml:mi>q</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mrow><mml:mo>&lt;</mml:mo> <mml:mn>0</mml:mn> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:munder><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>j</mml:mi> <mml:mo>∈</mml:mo> <mml:mi mathvariant="script">N</mml:mi> <mml:mo>(</mml:mo> <mml:msub><mml:mi>N</mml:mi> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mo>)</mml:mo></mml:mrow></mml:munder> <mml:msup><mml:mi>c</mml:mi> <mml:msup><mml:mrow/><mml:mo>′</mml:mo></mml:msup></mml:msup> <mml:msub><mml:mover accent="true"><mml:mi>q</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi> <mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mspace width="4.pt"/><mml:mtext>if</mml:mtext> <mml:mspace width="4.pt"/><mml:mi>k</mml:mi> <mml:mo>∈</mml:mo> <mml:msubsup><mml:mi>N</mml:mi> <mml:mi>a</mml:mi> <mml:mi>I</mml:mi></mml:msubsup> <mml:mspace width="4.pt"/><mml:mtext>(interior</mml:mtext> <mml:mspace width="4.pt"/><mml:mtext>node)</mml:mtext></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:mo>Δ</mml:mo> <mml:mi>c</mml:mi> <mml:msub><mml:mover accent="true"><mml:mi>q</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mspace width="4.pt"/><mml:mtext>if</mml:mtext> <mml:mspace width="4.pt"/><mml:mi>k</mml:mi> <mml:mo>∈</mml:mo> <mml:msubsup><mml:mi>N</mml:mi> <mml:mi>a</mml:mi> <mml:mi>T</mml:mi></mml:msubsup> <mml:mspace width="4.pt"/><mml:mtext>(terminal)</mml:mtext></mml:mrow></mml:mtd></mml:mtr></mml:mtable> <mml:mo/></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd columnalign="right"><mml:msup><mml:mi>c</mml:mi> <mml:msup><mml:mrow/><mml:mo>′</mml:mo></mml:msup></mml:msup></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mo>=</mml:mo> <mml:mo>{</mml:mo> <mml:mtable><mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:msub><mml:mover accent="true"><mml:mi>c</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi> <mml:mi>k</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi> <mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mspace width="4.pt"/><mml:mtext>if</mml:mtext> <mml:mspace width="4.pt"/><mml:msub><mml:mover accent="true"><mml:mi>q</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mo>&gt;</mml:mo> <mml:mn>0</mml:mn> <mml:mspace width="4.pt"/><mml:mtext>(incoming</mml:mtext> <mml:mspace width="4.pt"/><mml:mtext>fluid)</mml:mtext> <mml:mspace width="4.pt"/></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:msub><mml:mover accent="true"><mml:mi>c</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mspace width="4.pt"/><mml:mtext>if</mml:mtext> <mml:mspace width="4.pt"/><mml:msub><mml:mover accent="true"><mml:mi>q</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mo>&lt;</mml:mo> <mml:mn>0</mml:mn> <mml:mspace width="4.pt"/><mml:mtext>(outgoing</mml:mtext> <mml:mspace width="4.pt"/><mml:mtext>fluid)</mml:mtext> <mml:mspace width="4.pt"/></mml:mrow></mml:mtd></mml:mtr></mml:mtable> <mml:mo/></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mo>Δ</mml:mo> <mml:mi>c</mml:mi></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mo>=</mml:mo> <mml:mo>{</mml:mo> <mml:mtable><mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>c</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi> <mml:mi>k</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi> <mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>c</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mspace width="4.pt"/><mml:mtext>if</mml:mtext> <mml:mspace width="4.pt"/><mml:msub><mml:mi>q</mml:mi> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mo>&gt;</mml:mo> <mml:mn>0</mml:mn> <mml:mspace width="4.pt"/><mml:mtext>(terminal</mml:mtext> <mml:mspace width="4.pt"/><mml:mtext>is</mml:mtext> <mml:mspace width="4.pt"/><mml:mtext>a</mml:mtext> <mml:mspace width="4.pt"/><mml:mtext>source)</mml:mtext> <mml:mspace width="4.pt"/></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:msub><mml:mo>∫</mml:mo> <mml:mo>Ω</mml:mo></mml:msub> <mml:msub><mml:mover accent="true"><mml:mi>c</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:msubsup><mml:mi>η</mml:mi> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow> <mml:mi>ϵ</mml:mi></mml:msubsup> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>-</mml:mo> <mml:msub><mml:mi>x</mml:mi> <mml:mi>k</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mi>d</mml:mi> <mml:mi>x</mml:mi> <mml:mo>-</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>c</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mspace width="4.pt"/><mml:mtext>if</mml:mtext> <mml:mspace width="4.pt"/><mml:msub><mml:mi>q</mml:mi> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mo>&lt;</mml:mo> <mml:mn>0</mml:mn> <mml:mspace width="4.pt"/><mml:mtext>(terminal</mml:mtext> <mml:mspace width="4.pt"/><mml:mtext>is</mml:mtext> <mml:mspace width="4.pt"/><mml:mtext>a</mml:mtext> <mml:mspace width="4.pt"/><mml:mtext>sink)</mml:mtext> <mml:mspace width="4.pt"/></mml:mrow></mml:mtd></mml:mtr></mml:mtable> <mml:mo/></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mo>∫</mml:mo> <mml:msub><mml:mi>N</mml:mi> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:msub> <mml:msub><mml:mover accent="true"><mml:mi>ϕ</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mstyle displaystyle="true" scriptlevel="0"><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi> <mml:msub><mml:mover accent="true"><mml:mi>c</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow> <mml:mrow><mml:mi>∂</mml:mi> <mml:mi>t</mml:mi></mml:mrow></mml:mfrac></mml:mstyle> <mml:mi>d</mml:mi> <mml:mi>x</mml:mi></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mo>=</mml:mo> <mml:mo>Δ</mml:mo> <mml:msub><mml:mi>f</mml:mi> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mo>Δ</mml:mo> <mml:msub><mml:mi>f</mml:mi> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mo>=</mml:mo> <mml:mo>{</mml:mo> <mml:mtable><mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>c</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi> <mml:mi>k</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi> <mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>c</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:msub><mml:mover accent="true"><mml:mi>q</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mspace width="4.pt"/><mml:mtext>if</mml:mtext> <mml:mspace width="4.pt"/><mml:mi>k</mml:mi> <mml:mo>∈</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mi>N</mml:mi> <mml:mi>v</mml:mi> <mml:mi>I</mml:mi></mml:msubsup> <mml:mo>∪</mml:mo> <mml:msubsup><mml:mi>N</mml:mi> <mml:mi>v</mml:mi> <mml:mi>R</mml:mi></mml:msubsup> <mml:mo>)</mml:mo></mml:mrow> <mml:mspace width="4.pt"/><mml:mtext>(root</mml:mtext> <mml:mspace width="4.pt"/><mml:mtext>terminal,</mml:mtext> <mml:mspace width="4.pt"/><mml:msub><mml:mover accent="true"><mml:mi>q</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mrow><mml:mo>&gt;</mml:mo> <mml:mn>0</mml:mn> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:munder><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>j</mml:mi> <mml:mo>∈</mml:mo> <mml:mi mathvariant="script">N</mml:mi> <mml:mo>(</mml:mo> <mml:msub><mml:mi>N</mml:mi> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mo>)</mml:mo></mml:mrow></mml:munder> <mml:msup><mml:mi>c</mml:mi> <mml:msup><mml:mrow/><mml:mo>′</mml:mo></mml:msup></mml:msup> <mml:msub><mml:mover accent="true"><mml:mi>q</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi> <mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mspace width="4.pt"/><mml:mtext>if</mml:mtext> <mml:mspace width="4.pt"/><mml:mi>k</mml:mi> <mml:mo>∈</mml:mo> <mml:msubsup><mml:mi>N</mml:mi> <mml:mi>v</mml:mi> <mml:mi>I</mml:mi></mml:msubsup> <mml:mspace width="4.pt"/><mml:mtext>(interior</mml:mtext> <mml:mspace width="4.pt"/><mml:mtext>node)</mml:mtext></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:mo>Δ</mml:mo> <mml:mi>c</mml:mi> <mml:msub><mml:mover accent="true"><mml:mi>q</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mspace width="4.pt"/><mml:mtext>if</mml:mtext> <mml:mspace width="4.pt"/><mml:mi>k</mml:mi> <mml:mo>∈</mml:mo> <mml:msubsup><mml:mi>N</mml:mi> <mml:mi>v</mml:mi> <mml:mi>T</mml:mi></mml:msubsup> <mml:mspace width="4.pt"/><mml:mtext>(terminal)</mml:mtext></mml:mrow></mml:mtd></mml:mtr></mml:mtable> <mml:mo/></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd columnalign="right"><mml:msup><mml:mi>c</mml:mi> <mml:msup><mml:mrow/><mml:mo>′</mml:mo></mml:msup></mml:msup></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mo>=</mml:mo> <mml:mo>{</mml:mo> <mml:mtable><mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:msub><mml:mover accent="true"><mml:mi>c</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi> <mml:mi>k</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi> <mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mspace width="4.pt"/><mml:mtext>if</mml:mtext> <mml:mspace width="4.pt"/><mml:msub><mml:mover accent="true"><mml:mi>q</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mo>&gt;</mml:mo> <mml:mn>0</mml:mn> <mml:mspace width="4.pt"/><mml:mtext>(incoming</mml:mtext> <mml:mspace width="4.pt"/><mml:mtext>fluid)</mml:mtext> <mml:mspace width="4.pt"/></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:msub><mml:mover accent="true"><mml:mi>c</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mspace width="4.pt"/><mml:mtext>if</mml:mtext> <mml:mspace width="4.pt"/><mml:msub><mml:mover accent="true"><mml:mi>q</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mo>&lt;</mml:mo> <mml:mn>0</mml:mn> <mml:mspace width="4.pt"/><mml:mtext>(outgoing</mml:mtext> <mml:mspace width="4.pt"/><mml:mtext>fluid)</mml:mtext> <mml:mspace width="4.pt"/></mml:mrow></mml:mtd></mml:mtr></mml:mtable> <mml:mo/></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mo>Δ</mml:mo> <mml:mi>c</mml:mi></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mo>=</mml:mo> <mml:mo>{</mml:mo> <mml:mtable><mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>c</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi> <mml:mi>k</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi> <mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>c</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mspace width="4.pt"/><mml:mtext>if</mml:mtext> <mml:mspace width="4.pt"/><mml:msub><mml:mi>q</mml:mi> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mo>&gt;</mml:mo> <mml:mn>0</mml:mn> <mml:mspace width="4.pt"/><mml:mtext>(terminal</mml:mtext> <mml:mspace width="4.pt"/><mml:mtext>is</mml:mtext> <mml:mspace width="4.pt"/><mml:mtext>a</mml:mtext> <mml:mspace width="4.pt"/><mml:mtext>source)</mml:mtext> <mml:mspace width="4.pt"/></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:msub><mml:mo>∫</mml:mo> <mml:mo>Ω</mml:mo></mml:msub> <mml:msub><mml:mover accent="true"><mml:mi>c</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:msubsup><mml:mi>η</mml:mi> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow> <mml:mi>ϵ</mml:mi></mml:msubsup> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>-</mml:mo> <mml:msub><mml:mi>x</mml:mi> <mml:mi>k</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mi>d</mml:mi> <mml:mi>x</mml:mi> <mml:mo>-</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>c</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mspace width="4.pt"/><mml:mtext>if</mml:mtext> <mml:mspace width="4.pt"/><mml:msub><mml:mi>q</mml:mi> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mo>&lt;</mml:mo> <mml:mn>0</mml:mn> <mml:mspace width="4.pt"/><mml:mtext>(terminal</mml:mtext> <mml:mspace width="4.pt"/><mml:mtext>is</mml:mtext> <mml:mspace width="4.pt"/><mml:mtext>a</mml:mtext> <mml:mspace width="4.pt"/><mml:mtext>sink)</mml:mtext> <mml:mspace width="4.pt"/></mml:mrow></mml:mtd></mml:mtr></mml:mtable> <mml:mo/></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(27)</label></disp-formula>
where <italic>f</italic><sub><italic>β</italic>,<italic>k</italic></sub> is the incoming/outgoing tracer flux of node <italic>k</italic>. Within the edges, tracer concentrations in each subsegment follows accordingly
<disp-formula id="pcbi.1007073.e067"><alternatives><graphic id="pcbi.1007073.e067g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e067" xlink:type="simple"/><mml:math display="block" id="M67"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:msub><mml:mo>∫</mml:mo> <mml:msub><mml:mi>E</mml:mi> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi> <mml:mi>k</mml:mi> <mml:mo>,</mml:mo> <mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:msub> <mml:msub><mml:mover accent="true"><mml:mi>ϕ</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi> <mml:mi>k</mml:mi> <mml:mo>,</mml:mo> <mml:mi>i</mml:mi></mml:mrow></mml:msub> <mml:mstyle displaystyle="true" scriptlevel="0"><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi> <mml:msub><mml:mover accent="true"><mml:mi>c</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi> <mml:mi>k</mml:mi> <mml:mo>,</mml:mo> <mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow> <mml:mrow><mml:mi>∂</mml:mi> <mml:mi>t</mml:mi></mml:mrow></mml:mfrac></mml:mstyle> <mml:mi>d</mml:mi> <mml:mi>x</mml:mi></mml:mrow> <mml:mrow><mml:mo>=</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>c</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>c</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi> <mml:mi>k</mml:mi> <mml:mo>,</mml:mo> <mml:mi>i</mml:mi></mml:mrow></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:msub><mml:mover accent="true"><mml:mi>q</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi> <mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mtd> <mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:mi>i</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd columnalign="left"><mml:mrow><mml:msub><mml:mo>∫</mml:mo> <mml:msub><mml:mi>E</mml:mi> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi> <mml:mi>k</mml:mi> <mml:mo>,</mml:mo> <mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:msub> <mml:msub><mml:mover accent="true"><mml:mi>ϕ</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi> <mml:mi>k</mml:mi> <mml:mo>,</mml:mo> <mml:mi>i</mml:mi></mml:mrow></mml:msub> <mml:mstyle displaystyle="true" scriptlevel="0"><mml:mfrac><mml:mrow><mml:mi>∂</mml:mi> <mml:msub><mml:mover accent="true"><mml:mi>c</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi> <mml:mi>k</mml:mi> <mml:mo>,</mml:mo> <mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:mrow> <mml:mrow><mml:mi>∂</mml:mi> <mml:mi>t</mml:mi></mml:mrow></mml:mfrac></mml:mstyle> <mml:mi>d</mml:mi> <mml:mi>x</mml:mi></mml:mrow> <mml:mrow><mml:mo>=</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>c</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi> <mml:mi>k</mml:mi> <mml:mo>,</mml:mo> <mml:mi>i</mml:mi> <mml:mo>-</mml:mo> <mml:mn>1</mml:mn></mml:mrow></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>c</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi> <mml:mi>k</mml:mi> <mml:mo>,</mml:mo> <mml:mi>i</mml:mi></mml:mrow></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:msub><mml:mover accent="true"><mml:mi>q</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi> <mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mtd> <mml:mtd/><mml:mtd columnalign="left"><mml:mrow><mml:mi>i</mml:mi> <mml:mo>=</mml:mo> <mml:mn>2</mml:mn> <mml:mo>,</mml:mo> <mml:mo>…</mml:mo> <mml:mo>,</mml:mo> <mml:msub><mml:mi>n</mml:mi> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi> <mml:mi>k</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(28)</label></disp-formula>
for <italic>β</italic> = {<italic>a</italic>, <italic>v</italic>}. Note that the first subsegment relates to the upstream node. The hematocrit factor <italic>Hct</italic> connects blood tracer concentration <italic>c</italic><sub><italic>β</italic>,<italic>b</italic></sub> with plasma tracer concentration <italic>c</italic><sub><italic>β</italic></sub> according to
<disp-formula id="pcbi.1007073.e068"><alternatives><graphic id="pcbi.1007073.e068g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e068" xlink:type="simple"/><mml:math display="block" id="M68"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>c</mml:mi> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>b</mml:mi></mml:mrow></mml:msub> <mml:mo>=</mml:mo> <mml:msub><mml:mi>c</mml:mi> <mml:mi>β</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mn>1</mml:mn> <mml:mo>-</mml:mo> <mml:mi>H</mml:mi> <mml:mi>c</mml:mi> <mml:mi>t</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(29)</label></disp-formula>
Tracer can only distribute within the arterial and the venous compartment, and the observable tracer concentration becomes
<disp-formula id="pcbi.1007073.e069"><alternatives><graphic id="pcbi.1007073.e069g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e069" xlink:type="simple"/><mml:math display="block" id="M69"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>C</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>,</mml:mo> <mml:mi>t</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:mo>(</mml:mo> <mml:msub><mml:mi>c</mml:mi> <mml:mi>a</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>,</mml:mo> <mml:mi>t</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:msub><mml:mi>ϕ</mml:mi> <mml:mi>a</mml:mi></mml:msub> <mml:mo>+</mml:mo> <mml:msub><mml:mi>c</mml:mi> <mml:mi>v</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>,</mml:mo> <mml:mi>t</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:msub><mml:mi>ϕ</mml:mi> <mml:mi>v</mml:mi></mml:msub> <mml:mo>)</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:mn>1</mml:mn> <mml:mo>-</mml:mo> <mml:mi>H</mml:mi> <mml:mi>c</mml:mi> <mml:mi>t</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(30)</label></disp-formula>
when applying (<xref ref-type="disp-formula" rid="pcbi.1007073.e060">22</xref>), (<xref ref-type="disp-formula" rid="pcbi.1007073.e061">23</xref>), and (<xref ref-type="disp-formula" rid="pcbi.1007073.e068">29</xref>). In the current model, the hematocrit is independent of vessel scale, and therefore only has the role as a global scaling factor of the tracer concentration curves. Eqs (<xref ref-type="disp-formula" rid="pcbi.1007073.e064">26</xref>), (<xref ref-type="disp-formula" rid="pcbi.1007073.e066">27</xref>), (<xref ref-type="disp-formula" rid="pcbi.1007073.e067">28</xref>), and (<xref ref-type="disp-formula" rid="pcbi.1007073.e069">30</xref>) form the model for indicator dilution. Further details on the numerical implementation are shown in Supporting Information.</p>
</sec>
<sec id="sec017">
<title>Numerical implementation of flow</title>
<p>Integrating (<xref ref-type="disp-formula" rid="pcbi.1007073.e024">8</xref>) over a control volume (voxel) Ω<sub><italic>i</italic></sub> ⊂ Ω and applying the divergence theorem yields
<disp-formula id="pcbi.1007073.e070"><alternatives><graphic id="pcbi.1007073.e070g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e070" xlink:type="simple"/><mml:math display="block" id="M70"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mo>-</mml:mo> <mml:msub><mml:mo>∫</mml:mo> <mml:mrow><mml:mi>∂</mml:mi> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mo>λ</mml:mo> <mml:mi>a</mml:mi></mml:msub> <mml:mo>∇</mml:mo> <mml:msub><mml:mi>p</mml:mi> <mml:mi>a</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>·</mml:mo> <mml:mi>n</mml:mi> <mml:mi>d</mml:mi> <mml:mi>A</mml:mi></mml:mrow></mml:mtd> <mml:mtd><mml:mrow><mml:mo>=</mml:mo> <mml:munder><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>k</mml:mi> <mml:mo>∈</mml:mo> <mml:msubsup><mml:mi>T</mml:mi> <mml:mi>a</mml:mi> <mml:mi>I</mml:mi></mml:msubsup></mml:mrow></mml:munder> <mml:msub><mml:mo>∫</mml:mo> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi>i</mml:mi></mml:msub></mml:msub> <mml:msubsup><mml:mi>Q</mml:mi> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow> <mml:mi>ϵ</mml:mi></mml:msubsup> <mml:mi>d</mml:mi> <mml:mi>x</mml:mi> <mml:mo>-</mml:mo> <mml:msub><mml:mo>∫</mml:mo> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi>i</mml:mi></mml:msub></mml:msub> <mml:mi>P</mml:mi> <mml:mi>d</mml:mi> <mml:mi>x</mml:mi></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mo>-</mml:mo> <mml:msub><mml:mo>∫</mml:mo> <mml:mrow><mml:mi>∂</mml:mi> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mo>λ</mml:mo> <mml:mi>v</mml:mi></mml:msub> <mml:mo>∇</mml:mo> <mml:msub><mml:mi>p</mml:mi> <mml:mi>v</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>·</mml:mo> <mml:mi>n</mml:mi> <mml:mi>d</mml:mi> <mml:mi>A</mml:mi></mml:mrow></mml:mtd> <mml:mtd><mml:mrow><mml:mo>=</mml:mo> <mml:munder><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>k</mml:mi> <mml:mo>∈</mml:mo> <mml:msubsup><mml:mi>T</mml:mi> <mml:mi>v</mml:mi> <mml:mi>I</mml:mi></mml:msubsup></mml:mrow></mml:munder> <mml:msub><mml:mo>∫</mml:mo> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi>i</mml:mi></mml:msub></mml:msub> <mml:msubsup><mml:mi>Q</mml:mi> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow> <mml:mi>ϵ</mml:mi></mml:msubsup> <mml:mi>d</mml:mi> <mml:mi>x</mml:mi> <mml:mo>+</mml:mo> <mml:msub><mml:mo>∫</mml:mo> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi>i</mml:mi></mml:msub></mml:msub> <mml:mi>P</mml:mi> <mml:mi>d</mml:mi> <mml:mi>x</mml:mi></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(31)</label></disp-formula>
for the conductivities λ<sub><italic>β</italic></sub> ≔ <italic>k</italic><sub><italic>β</italic></sub>/<italic>μ</italic>, <italic>β</italic> = {<italic>a</italic>, <italic>v</italic>}. The elliptic term of <xref ref-type="disp-formula" rid="pcbi.1007073.e024">Eq (8)</xref> was discretized using finite volume TPFA (two-point flux approximation), leading to a linear relation in the transmissibilities <italic>t</italic><sub><italic>ij</italic></sub> and pressure difference <italic>p</italic><sub><italic>β</italic>,<italic>i</italic></sub> − <italic>p</italic><sub><italic>β</italic>,<italic>j</italic></sub> between a center voxel <italic>x</italic><sub><italic>i</italic></sub> and an adjacent neighbor <italic>x</italic><sub><italic>j</italic></sub>. TPFA is widely applied in reservoir mechanics, and the reader is referred to [<xref ref-type="bibr" rid="pcbi.1007073.ref043">43</xref>] for more details. Following TPFA, <xref ref-type="disp-formula" rid="pcbi.1007073.e070">Eq (31)</xref> can be approximated as a linear system
<disp-formula id="pcbi.1007073.e071"><alternatives><graphic id="pcbi.1007073.e071g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e071" xlink:type="simple"/><mml:math display="block" id="M71"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd/><mml:mtd><mml:mrow><mml:munder><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>j</mml:mi> <mml:mo>∈</mml:mo> <mml:msub><mml:mi mathvariant="script">N</mml:mi> <mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:munder> <mml:msub><mml:mi>t</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mi>j</mml:mi></mml:mrow></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>p</mml:mi> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>i</mml:mi></mml:mrow></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mi>p</mml:mi> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi></mml:mrow></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>+</mml:mo> <mml:msub><mml:mi>α</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>p</mml:mi> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>i</mml:mi></mml:mrow></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mi>p</mml:mi> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>i</mml:mi></mml:mrow></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>|</mml:mo></mml:mrow> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi>i</mml:mi></mml:msub> <mml:mrow><mml:mo>|</mml:mo> <mml:mo>-</mml:mo></mml:mrow> <mml:munder><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>k</mml:mi> <mml:mo>∈</mml:mo> <mml:msubsup><mml:mi>T</mml:mi> <mml:mi>a</mml:mi> <mml:mi>I</mml:mi></mml:msubsup></mml:mrow></mml:munder> <mml:msub><mml:mover accent="true"><mml:mi>q</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:msubsup><mml:mi>η</mml:mi> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow> <mml:mi>ϵ</mml:mi></mml:msubsup> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>x</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mi>x</mml:mi> <mml:mi>k</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>|</mml:mo> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi>i</mml:mi></mml:msub> <mml:mo>|</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:mn>0</mml:mn></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow/></mml:mtd></mml:mtr> <mml:mtr><mml:mtd/><mml:mtd><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>q</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mo>=</mml:mo> <mml:msub><mml:mi>κ</mml:mi> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>p</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi></mml:mrow></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>p</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>,</mml:mo> <mml:mspace width="1.em"/><mml:mi>j</mml:mi> <mml:mo>∈</mml:mo> <mml:mi mathvariant="script">N</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>N</mml:mi> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mspace width="2.em"/><mml:mo>∀</mml:mo> <mml:mspace width="3.33333pt"/><mml:mi>k</mml:mi> <mml:mo>∈</mml:mo> <mml:msubsup><mml:mi>N</mml:mi> <mml:mi>a</mml:mi> <mml:mi>I</mml:mi></mml:msubsup> <mml:mspace width="2.em"/><mml:mtext>Continuity</mml:mtext> <mml:mspace width="4.pt"/><mml:mtext>in</mml:mtext> <mml:mspace width="4.pt"/><mml:mtext>flow</mml:mtext></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd/><mml:mtd><mml:mrow><mml:munder><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>j</mml:mi> <mml:mo>∈</mml:mo> <mml:msub><mml:mi mathvariant="script">N</mml:mi> <mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:munder> <mml:msub><mml:mi>t</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mi>j</mml:mi></mml:mrow></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>p</mml:mi> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>i</mml:mi></mml:mrow></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mi>p</mml:mi> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi></mml:mrow></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>-</mml:mo> <mml:msub><mml:mi>α</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>p</mml:mi> <mml:mrow><mml:mi>a</mml:mi> <mml:mo>,</mml:mo> <mml:mi>i</mml:mi></mml:mrow></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mi>p</mml:mi> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>i</mml:mi></mml:mrow></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>|</mml:mo></mml:mrow> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi>i</mml:mi></mml:msub> <mml:mrow><mml:mo>|</mml:mo> <mml:mo>-</mml:mo></mml:mrow> <mml:munder><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>k</mml:mi> <mml:mo>∈</mml:mo> <mml:msubsup><mml:mi>T</mml:mi> <mml:mi>v</mml:mi> <mml:mi>I</mml:mi></mml:msubsup></mml:mrow></mml:munder> <mml:msub><mml:mover accent="true"><mml:mi>q</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:msubsup><mml:mi>η</mml:mi> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow> <mml:mi>ϵ</mml:mi></mml:msubsup> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>x</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mi>x</mml:mi> <mml:mi>k</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mrow><mml:mo>|</mml:mo> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi>i</mml:mi></mml:msub> <mml:mo>|</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:mn>0</mml:mn></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow/></mml:mtd></mml:mtr> <mml:mtr><mml:mtd/><mml:mtd><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>q</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mo>=</mml:mo> <mml:msub><mml:mi>κ</mml:mi> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>p</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi></mml:mrow></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>p</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>,</mml:mo> <mml:mspace width="1.em"/><mml:mi>j</mml:mi> <mml:mo>∈</mml:mo> <mml:mi mathvariant="script">N</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>N</mml:mi> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mspace width="2.em"/><mml:mo>∀</mml:mo> <mml:mspace width="3.33333pt"/><mml:mi>k</mml:mi> <mml:mo>∈</mml:mo> <mml:msubsup><mml:mi>N</mml:mi> <mml:mi>v</mml:mi> <mml:mi>I</mml:mi></mml:msubsup> <mml:mspace width="2.em"/><mml:mtext>Continuity</mml:mtext> <mml:mspace width="4.pt"/><mml:mtext>in</mml:mtext> <mml:mspace width="4.pt"/><mml:mtext>flow</mml:mtext></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(32)</label></disp-formula>
when also applying <xref ref-type="disp-formula" rid="pcbi.1007073.e058">Eq (20)</xref>. Further define the voxel neighborship around an interior node <inline-formula id="pcbi.1007073.e072"><alternatives><graphic id="pcbi.1007073.e072g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e072" xlink:type="simple"/><mml:math display="inline" id="M72"><mml:mrow><mml:msub><mml:mi mathvariant="script">N</mml:mi> <mml:mi>v</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>N</mml:mi> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>≔</mml:mo> <mml:mrow><mml:mo>{</mml:mo> <mml:mi>j</mml:mi> <mml:mo>:</mml:mo> <mml:msubsup><mml:mi>η</mml:mi> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow> <mml:mi>ϵ</mml:mi></mml:msubsup> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>x</mml:mi> <mml:mi>j</mml:mi></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mi>x</mml:mi> <mml:mi>k</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>&gt;</mml:mo> <mml:mn>0</mml:mn> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi> <mml:mo>∈</mml:mo> <mml:msubsup><mml:mi>N</mml:mi> <mml:mi>β</mml:mi> <mml:mi>I</mml:mi></mml:msubsup> <mml:mo>}</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> including all voxels close to terminal <italic>N</italic><sub><italic>β</italic>,<italic>k</italic></sub> receiving a nonzero fluid distribution. The network Eqs (<xref ref-type="disp-formula" rid="pcbi.1007073.e044">11</xref>) and (<xref ref-type="disp-formula" rid="pcbi.1007073.e046">12</xref>) are readily discretized, while the condition on pressure continuity <xref ref-type="disp-formula" rid="pcbi.1007073.e059">Eq (21)</xref> becomes
<disp-formula id="pcbi.1007073.e073"><alternatives><graphic id="pcbi.1007073.e073g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e073" xlink:type="simple"/><mml:math display="block" id="M73"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd/><mml:mtd><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>q</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mo>=</mml:mo> <mml:mfrac><mml:msub><mml:mi>γ</mml:mi> <mml:mi>β</mml:mi></mml:msub> <mml:mi>μ</mml:mi></mml:mfrac> <mml:mo>(</mml:mo> <mml:msub><mml:mover accent="true"><mml:mi>p</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mo>-</mml:mo> <mml:munder><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>j</mml:mi> <mml:mo>∈</mml:mo> <mml:mi mathvariant="script">N</mml:mi> <mml:mo>(</mml:mo> <mml:msub><mml:mi>N</mml:mi> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:msub> <mml:mo>)</mml:mo></mml:mrow></mml:munder> <mml:msubsup><mml:mi>η</mml:mi> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>k</mml:mi></mml:mrow> <mml:mi>ϵ</mml:mi></mml:msubsup> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>x</mml:mi> <mml:mi>j</mml:mi></mml:msub> <mml:mo>-</mml:mo> <mml:msub><mml:mi>x</mml:mi> <mml:mi>k</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:msub><mml:mi>p</mml:mi> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>j</mml:mi></mml:mrow></mml:msub> <mml:mrow><mml:mo>|</mml:mo> <mml:msub><mml:mo>Ω</mml:mo> <mml:mi>j</mml:mi></mml:msub> <mml:mo>|</mml:mo></mml:mrow> <mml:mo>)</mml:mo> <mml:mspace width="2.em"/></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mo>∀</mml:mo> <mml:mspace width="3.33333pt"/><mml:mi>k</mml:mi> <mml:mo>∈</mml:mo> <mml:msubsup><mml:mi>N</mml:mi> <mml:mi>β</mml:mi> <mml:mi>I</mml:mi></mml:msubsup> <mml:mspace width="2.em"/></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(33)</label></disp-formula>
A linear system <inline-formula id="pcbi.1007073.e074"><alternatives><graphic id="pcbi.1007073.e074g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e074" xlink:type="simple"/><mml:math display="inline" id="M74"><mml:mrow><mml:mi mathvariant="script">A</mml:mi> <mml:mi>x</mml:mi> <mml:mo>=</mml:mo> <mml:mi>d</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> was created,
<disp-formula id="pcbi.1007073.e075"><alternatives><graphic id="pcbi.1007073.e075g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e075" xlink:type="simple"/><mml:math display="block" id="M75"><mml:mi mathvariant="script">A</mml:mi> <mml:mo>=</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:mtable columnlines="solid" rowlines="solid"><mml:mtr><mml:mtd><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mi mathvariant="script">A</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:msub><mml:mi>D</mml:mi> <mml:mi>a</mml:mi></mml:msub> <mml:mo>→</mml:mo> <mml:msub><mml:mi>D</mml:mi> <mml:mi>a</mml:mi></mml:msub></mml:mrow> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd> <mml:mtd><mml:mrow><mml:mi mathvariant="script">A</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:msub><mml:mi>D</mml:mi> <mml:mi>a</mml:mi></mml:msub> <mml:mo>→</mml:mo> <mml:msub><mml:mi>D</mml:mi> <mml:mi>v</mml:mi></mml:msub></mml:mrow> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd><mml:mrow><mml:mi mathvariant="script">A</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:msub><mml:mi>D</mml:mi> <mml:mi>v</mml:mi></mml:msub> <mml:mo>→</mml:mo> <mml:msub><mml:mi>D</mml:mi> <mml:mi>a</mml:mi></mml:msub></mml:mrow> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd> <mml:mtd><mml:mrow><mml:mi mathvariant="script">A</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:msub><mml:mi>D</mml:mi> <mml:mi>v</mml:mi></mml:msub> <mml:mo>→</mml:mo> <mml:msub><mml:mi>D</mml:mi> <mml:mi>v</mml:mi></mml:msub></mml:mrow> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mtd> <mml:mtd><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mi mathvariant="script">A</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:msub><mml:mi>D</mml:mi> <mml:mi>a</mml:mi></mml:msub> <mml:mo>→</mml:mo> <mml:msub><mml:mi>N</mml:mi> <mml:mi>a</mml:mi></mml:msub></mml:mrow> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd> <mml:mtd><mml:mn>0</mml:mn></mml:mtd></mml:mtr> <mml:mtr><mml:mtd><mml:mn>0</mml:mn></mml:mtd> <mml:mtd><mml:mrow><mml:mi mathvariant="script">A</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:msub><mml:mi>D</mml:mi> <mml:mi>v</mml:mi></mml:msub> <mml:mo>→</mml:mo> <mml:msub><mml:mi>N</mml:mi> <mml:mi>v</mml:mi></mml:msub></mml:mrow> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mi mathvariant="script">A</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:msub><mml:mi>N</mml:mi> <mml:mi>a</mml:mi></mml:msub> <mml:mo>→</mml:mo> <mml:msub><mml:mi>D</mml:mi> <mml:mi>a</mml:mi></mml:msub></mml:mrow> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd> <mml:mtd><mml:mn>0</mml:mn></mml:mtd></mml:mtr> <mml:mtr><mml:mtd><mml:mn>0</mml:mn></mml:mtd> <mml:mtd><mml:mrow><mml:mi mathvariant="script">A</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:msub><mml:mi>N</mml:mi> <mml:mi>v</mml:mi></mml:msub> <mml:mo>→</mml:mo> <mml:msub><mml:mi>D</mml:mi> <mml:mi>v</mml:mi></mml:msub></mml:mrow> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mtd> <mml:mtd><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mi mathvariant="script">A</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:msub><mml:mi>N</mml:mi> <mml:mi>a</mml:mi></mml:msub> <mml:mo>→</mml:mo> <mml:msub><mml:mi>N</mml:mi> <mml:mi>a</mml:mi></mml:msub></mml:mrow> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd> <mml:mtd><mml:mn>0</mml:mn></mml:mtd></mml:mtr> <mml:mtr><mml:mtd><mml:mn>0</mml:mn></mml:mtd> <mml:mtd><mml:mrow><mml:mi mathvariant="script">A</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:msub><mml:mi>N</mml:mi> <mml:mi>v</mml:mi></mml:msub> <mml:mo>→</mml:mo> <mml:msub><mml:mi>N</mml:mi> <mml:mi>v</mml:mi></mml:msub></mml:mrow> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow> <mml:mo>)</mml:mo></mml:mrow></mml:math></alternatives> <label>(34)</label></disp-formula>
where <italic>x</italic> is the concatenation of the voxelwise pressure values <italic>p</italic><sub><italic>β</italic>,<italic>i</italic></sub> and nodal pressure values <inline-formula id="pcbi.1007073.e076"><alternatives><graphic id="pcbi.1007073.e076g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e076" xlink:type="simple"/><mml:math display="inline" id="M76"><mml:msub><mml:mover accent="true"><mml:mi>p</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>β</mml:mi> <mml:mo>,</mml:mo> <mml:mi>i</mml:mi></mml:mrow></mml:msub></mml:math></alternatives></inline-formula>. The argument <italic>D</italic> refers to the Darcy equation in the continuum, and <italic>N</italic> refers to the nodes. The subscript indicates arterial or venous compartment/tree. The arrow indicates interactions, e.g. the submatrix <inline-formula id="pcbi.1007073.e077"><alternatives><graphic id="pcbi.1007073.e077g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e077" xlink:type="simple"/><mml:math display="inline" id="M77"><mml:mrow><mml:mi mathvariant="script">A</mml:mi> <mml:mo>(</mml:mo> <mml:msub><mml:mi>D</mml:mi> <mml:mi>a</mml:mi></mml:msub> <mml:mo>→</mml:mo> <mml:msub><mml:mi>N</mml:mi> <mml:mi>a</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> contains the interaction between the arterial compartment and arterial-tree nodes. Right hand side <italic>d</italic> depends on Dirichlet boundary conditions on the pressure. The linear system of equations was solved using GMRES [<xref ref-type="bibr" rid="pcbi.1007073.ref044">44</xref>] with a tolerance of 10<sup>−6</sup>, and a LUP decomposition for preconditioning.</p>
</sec>
<sec id="sec018">
<title>Numerical implementation of indicator dilution</title>
<p>A first approximation of the forward time step was initially computed from the largest possible time step satisfying the CFL conditions of the Darcy domain, the nodes, and the segments. However, due to the implementation of a backward Euler solver, we were able to use significantly longer time steps, leading to a sequence of time points <italic>t</italic><sub><italic>i</italic></sub> = <italic>iδt</italic>, <italic>i</italic> = {0, 1, …, <italic>n</italic>} where <italic>δt</italic> was ten times the maximum time step according to the CFL condition. Total number of iterations became <italic>n</italic> = floor(120/<italic>δt</italic>), where 120 is maximum simulation time. Forward simulation of tracer evolution was performed by creating a discrete linear system of equations from (<xref ref-type="disp-formula" rid="pcbi.1007073.e064">26</xref>), (<xref ref-type="disp-formula" rid="pcbi.1007073.e066">27</xref>), (<xref ref-type="disp-formula" rid="pcbi.1007073.e067">28</xref>)
<disp-formula id="pcbi.1007073.e078"><alternatives><graphic id="pcbi.1007073.e078g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e078" xlink:type="simple"/><mml:math display="block" id="M78"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>c</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mo>+</mml:mo> <mml:mn>1</mml:mn></mml:mrow></mml:msub> <mml:mo>=</mml:mo> <mml:msub><mml:mi>c</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>+</mml:mo> <mml:mi>δ</mml:mi> <mml:mi>t</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi mathvariant="script">A</mml:mi> <mml:msub><mml:mi>c</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>+</mml:mo> <mml:msub><mml:mi>b</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>,</mml:mo> <mml:mspace width="2.em"/><mml:mi>i</mml:mi> <mml:mo>=</mml:mo> <mml:mrow><mml:mo>{</mml:mo> <mml:mn>2</mml:mn> <mml:mo>,</mml:mo> <mml:mn>3</mml:mn> <mml:mo>,</mml:mo> <mml:mo>…</mml:mo> <mml:mo>,</mml:mo> <mml:mi>n</mml:mi> <mml:mo>}</mml:mo></mml:mrow> <mml:mo>,</mml:mo> <mml:mspace width="2.em"/><mml:msub><mml:mi>c</mml:mi> <mml:mn>0</mml:mn></mml:msub> <mml:mo>=</mml:mo> <mml:mn>0</mml:mn></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(35)</label></disp-formula>
in the variable
<disp-formula id="pcbi.1007073.e079"><alternatives><graphic id="pcbi.1007073.e079g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e079" xlink:type="simple"/><mml:math display="block" id="M79"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>c</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>=</mml:mo> <mml:mo>[</mml:mo> <mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:msub><mml:mi>c</mml:mi> <mml:mrow><mml:mi>D</mml:mi> <mml:mo>,</mml:mo> <mml:mi>a</mml:mi></mml:mrow></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>c</mml:mi> <mml:mrow><mml:mi>D</mml:mi> <mml:mo>,</mml:mo> <mml:mi>v</mml:mi></mml:mrow></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>c</mml:mi> <mml:mrow><mml:mi>N</mml:mi> <mml:mo>,</mml:mo> <mml:mi>a</mml:mi></mml:mrow></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>c</mml:mi> <mml:mrow><mml:mi>N</mml:mi> <mml:mo>,</mml:mo> <mml:mi>v</mml:mi></mml:mrow></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>c</mml:mi> <mml:mrow><mml:mi>E</mml:mi> <mml:mo>,</mml:mo> <mml:mi>a</mml:mi></mml:mrow></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>c</mml:mi> <mml:mrow><mml:mi>E</mml:mi> <mml:mo>,</mml:mo> <mml:mi>v</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable> <mml:msubsup><mml:mo>]</mml:mo> <mml:mi>i</mml:mi> <mml:mi>T</mml:mi></mml:msubsup></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(36)</label></disp-formula>
containing the concatenation of discrete variables of tracer concentration at time point <italic>t</italic><sub><italic>i</italic></sub> in the Darcy domain <italic>c</italic><sub><italic>D</italic>,<italic>β</italic></sub>, the nodes <italic>c</italic><sub><italic>N</italic>,<italic>β</italic></sub>, and the edges <italic>c</italic><sub><italic>E</italic>,<italic>β</italic></sub>, and where <inline-formula id="pcbi.1007073.e080"><alternatives><graphic id="pcbi.1007073.e080g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e080" xlink:type="simple"/><mml:math display="inline" id="M80"><mml:mi mathvariant="script">B</mml:mi></mml:math></alternatives></inline-formula> is a block-diagonal matrix
<disp-formula id="pcbi.1007073.e081"><alternatives><graphic id="pcbi.1007073.e081g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e081" xlink:type="simple"/><mml:math display="block" id="M81"><mml:mi>ℬ</mml:mi> <mml:mo>=</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:mrow><mml:mtable columnlines="solid" rowlines="solid"><mml:mtr><mml:mtd><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mi>ℬ</mml:mi> <mml:mo stretchy="false">(</mml:mo> <mml:msub><mml:mi>D</mml:mi> <mml:mi>a</mml:mi></mml:msub> <mml:mo>→</mml:mo> <mml:msub><mml:mi>D</mml:mi> <mml:mi>a</mml:mi></mml:msub> <mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mtd> <mml:mtd><mml:mrow><mml:mi>ℬ</mml:mi> <mml:mo stretchy="false">(</mml:mo> <mml:msub><mml:mi>N</mml:mi> <mml:mi>a</mml:mi></mml:msub> <mml:mo>→</mml:mo> <mml:msub><mml:mi>D</mml:mi> <mml:mi>a</mml:mi></mml:msub> <mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd><mml:mrow><mml:mi>ℬ</mml:mi> <mml:mo stretchy="false">(</mml:mo> <mml:msub><mml:mi>D</mml:mi> <mml:mi>v</mml:mi></mml:msub> <mml:mo>→</mml:mo> <mml:msub><mml:mi>D</mml:mi> <mml:mi>a</mml:mi></mml:msub> <mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mtd> <mml:mtd><mml:mrow><mml:mi>ℬ</mml:mi> <mml:mo stretchy="false">(</mml:mo> <mml:msub><mml:mi>D</mml:mi> <mml:mi>v</mml:mi></mml:msub> <mml:mo>→</mml:mo> <mml:msub><mml:mi>D</mml:mi> <mml:mi>v</mml:mi></mml:msub> <mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mtd> <mml:mtd><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mi>ℬ</mml:mi> <mml:mo stretchy="false">(</mml:mo> <mml:msub><mml:mi>D</mml:mi> <mml:mi>a</mml:mi></mml:msub> <mml:mo>→</mml:mo> <mml:msub><mml:mi>N</mml:mi> <mml:mi>a</mml:mi></mml:msub> <mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mtd> <mml:mtd><mml:mn>0</mml:mn></mml:mtd></mml:mtr> <mml:mtr><mml:mtd><mml:mn>0</mml:mn></mml:mtd> <mml:mtd><mml:mrow><mml:mi>ℬ</mml:mi> <mml:mo stretchy="false">(</mml:mo> <mml:msub><mml:mi>D</mml:mi> <mml:mi>v</mml:mi></mml:msub> <mml:mo>→</mml:mo> <mml:msub><mml:mi>N</mml:mi> <mml:mi>v</mml:mi></mml:msub> <mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mtd> <mml:mtd><mml:mrow><mml:mtable><mml:mtr><mml:mtd columnalign="center"><mml:mn>0</mml:mn></mml:mtd> <mml:mtd><mml:mn>0</mml:mn></mml:mtd></mml:mtr> <mml:mtr><mml:mtd><mml:mn>0</mml:mn></mml:mtd> <mml:mtd><mml:mn>0</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mi>ℬ</mml:mi> <mml:mo stretchy="false">(</mml:mo> <mml:msub><mml:mi>N</mml:mi> <mml:mi>a</mml:mi></mml:msub> <mml:mo>→</mml:mo> <mml:msub><mml:mi>D</mml:mi> <mml:mi>a</mml:mi></mml:msub> <mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mtd> <mml:mtd><mml:mn>0</mml:mn></mml:mtd></mml:mtr> <mml:mtr><mml:mtd><mml:mn>0</mml:mn></mml:mtd> <mml:mtd><mml:mrow><mml:mi>ℬ</mml:mi> <mml:mo stretchy="false">(</mml:mo> <mml:msub><mml:mi>N</mml:mi> <mml:mi>v</mml:mi></mml:msub> <mml:mo>→</mml:mo> <mml:msub><mml:mi>D</mml:mi> <mml:mi>v</mml:mi></mml:msub> <mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mtd> <mml:mtd><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mi>ℬ</mml:mi> <mml:mo stretchy="false">(</mml:mo> <mml:msub><mml:mi>N</mml:mi> <mml:mi>a</mml:mi></mml:msub> <mml:mo>→</mml:mo> <mml:msub><mml:mi>N</mml:mi> <mml:mi>a</mml:mi></mml:msub> <mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mtd> <mml:mtd><mml:mn>0</mml:mn></mml:mtd></mml:mtr> <mml:mtr><mml:mtd><mml:mn>0</mml:mn></mml:mtd> <mml:mtd><mml:mrow><mml:mi>ℬ</mml:mi> <mml:mo stretchy="false">(</mml:mo> <mml:msub><mml:mi>N</mml:mi> <mml:mi>v</mml:mi></mml:msub> <mml:mo>→</mml:mo> <mml:msub><mml:mi>N</mml:mi> <mml:mi>v</mml:mi></mml:msub> <mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mtd> <mml:mtd><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mi>ℬ</mml:mi> <mml:mo stretchy="false">(</mml:mo> <mml:msub><mml:mi>N</mml:mi> <mml:mi>a</mml:mi></mml:msub> <mml:mo>→</mml:mo> <mml:msub><mml:mi>E</mml:mi> <mml:mi>a</mml:mi></mml:msub> <mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mtd> <mml:mtd><mml:mn>0</mml:mn></mml:mtd></mml:mtr> <mml:mtr><mml:mtd><mml:mn>0</mml:mn></mml:mtd> <mml:mtd><mml:mrow><mml:mi>ℬ</mml:mi> <mml:mo stretchy="false">(</mml:mo> <mml:msub><mml:mi>N</mml:mi> <mml:mi>v</mml:mi></mml:msub> <mml:mo>→</mml:mo> <mml:msub><mml:mi>E</mml:mi> <mml:mi>v</mml:mi></mml:msub> <mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mn>0</mml:mn></mml:mtd> <mml:mtd><mml:mn>0</mml:mn></mml:mtd></mml:mtr> <mml:mtr><mml:mtd><mml:mrow/></mml:mtd> <mml:mtd><mml:mn>0</mml:mn></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mtd> <mml:mtd><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mi>ℬ</mml:mi> <mml:mo stretchy="false">(</mml:mo> <mml:msub><mml:mi>E</mml:mi> <mml:mi>a</mml:mi></mml:msub> <mml:mo>→</mml:mo> <mml:msub><mml:mi>N</mml:mi> <mml:mi>a</mml:mi></mml:msub> <mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mtd> <mml:mtd><mml:mn>0</mml:mn></mml:mtd></mml:mtr> <mml:mtr><mml:mtd><mml:mn>0</mml:mn></mml:mtd> <mml:mtd><mml:mrow><mml:mi>ℬ</mml:mi> <mml:mo stretchy="false">(</mml:mo> <mml:msub><mml:mi>E</mml:mi> <mml:mi>v</mml:mi></mml:msub> <mml:mo>→</mml:mo> <mml:msub><mml:mi>N</mml:mi> <mml:mi>v</mml:mi></mml:msub> <mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mtd> <mml:mtd><mml:mrow><mml:mtable><mml:mtr><mml:mtd><mml:mrow><mml:mi>ℬ</mml:mi> <mml:mo stretchy="false">(</mml:mo> <mml:msub><mml:mi>E</mml:mi> <mml:mi>a</mml:mi></mml:msub> <mml:mo>→</mml:mo> <mml:msub><mml:mi>E</mml:mi> <mml:mi>a</mml:mi></mml:msub> <mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mtd> <mml:mtd><mml:mn>0</mml:mn></mml:mtd></mml:mtr> <mml:mtr><mml:mtd><mml:mn>0</mml:mn></mml:mtd> <mml:mtd><mml:mrow><mml:mi>ℬ</mml:mi> <mml:mo stretchy="false">(</mml:mo> <mml:msub><mml:mi>E</mml:mi> <mml:mi>v</mml:mi></mml:msub> <mml:mo>→</mml:mo> <mml:msub><mml:mi>E</mml:mi> <mml:mi>v</mml:mi></mml:msub> <mml:mo stretchy="false">)</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow> <mml:mo>)</mml:mo></mml:mrow></mml:math></alternatives> <label>(37)</label></disp-formula>
with similar notation as (<xref ref-type="disp-formula" rid="pcbi.1007073.e075">34</xref>), in addition to <italic>E</italic><sub>(⋅)</sub> referring to the edges. The constant vector <italic>b</italic><sub><italic>i</italic></sub> depends on AIF values <italic>c</italic><sub>AIF,<italic>i</italic></sub>. A backward Euler updates the concentration at time point <italic>t</italic><sub><italic>i</italic></sub> according to
<disp-formula id="pcbi.1007073.e082"><alternatives><graphic id="pcbi.1007073.e082g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e082" xlink:type="simple"/><mml:math display="block" id="M82"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mo>(</mml:mo> <mml:mi>I</mml:mi> <mml:mo>-</mml:mo> <mml:mi>δ</mml:mi> <mml:mi>t</mml:mi> <mml:mi mathvariant="script">A</mml:mi> <mml:mo>)</mml:mo> <mml:msub><mml:mi>c</mml:mi> <mml:mrow><mml:mi>i</mml:mi> <mml:mo>+</mml:mo> <mml:mn>1</mml:mn></mml:mrow></mml:msub> <mml:mo>=</mml:mo> <mml:msub><mml:mi>c</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>+</mml:mo> <mml:mi>δ</mml:mi> <mml:mi>t</mml:mi> <mml:msub><mml:mi>b</mml:mi> <mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(38)</label></disp-formula>
where <italic>I</italic> is the identity matrix. The matrix <inline-formula id="pcbi.1007073.e083"><alternatives><graphic id="pcbi.1007073.e083g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e083" xlink:type="simple"/><mml:math display="inline" id="M83"><mml:mo>(</mml:mo> <mml:mi>I</mml:mi> <mml:mo>-</mml:mo> <mml:mi>δ</mml:mi> <mml:mi>t</mml:mi> <mml:mi mathvariant="script">B</mml:mi> <mml:mo>)</mml:mo></mml:math></alternatives></inline-formula> is fixed over iterations, and a GMRES solver was used as a solver with a LUP preconditioner with the previous iterate as initial guess in the consecutive time iteration.</p>
</sec>
<sec id="sec019">
<title>Arterial input function</title>
<p>As arterial input function we used a gamma-variate function
<disp-formula id="pcbi.1007073.e084"><alternatives><graphic id="pcbi.1007073.e084g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e084" xlink:type="simple"/><mml:math display="block" id="M84"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>c</mml:mi> <mml:mo>˜</mml:mo></mml:mover> <mml:mrow><mml:mi>A</mml:mi> <mml:mi>I</mml:mi> <mml:mi>F</mml:mi></mml:mrow></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>t</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:msub><mml:mi>C</mml:mi> <mml:mn>0</mml:mn></mml:msub> <mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:mi>t</mml:mi> <mml:mo>-</mml:mo> <mml:mi>t</mml:mi> <mml:mn>0</mml:mn> <mml:mo>)</mml:mo></mml:mrow> <mml:mi>A</mml:mi></mml:msup> <mml:msup><mml:mi>e</mml:mi> <mml:mrow><mml:mo>-</mml:mo> <mml:mo>(</mml:mo> <mml:mi>t</mml:mi> <mml:mo>-</mml:mo> <mml:mi>t</mml:mi> <mml:mn>0</mml:mn> <mml:mo>)</mml:mo> <mml:mo>/</mml:mo> <mml:mi>B</mml:mi></mml:mrow></mml:msup></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(39)</label></disp-formula>
with constants <italic>A</italic> = 3, <italic>B</italic> = 1 [<xref ref-type="bibr" rid="pcbi.1007073.ref045">45</xref>]. Tracer simulation time was 120 s, with a delay <italic>t</italic><sub>0</sub> = 7.5 min. All program code was written in MATLAB.</p>
</sec>
<sec id="sec020">
<title>Sensitivity analysis</title>
<p>We performed a numerical sensitivity analysis to examine how uncertanties in the input parameters are propagating through the model and affecting the output parameters. For a function <italic>y</italic> = <italic>f</italic>(<italic>x</italic><sub><italic>i</italic></sub>) depending on a set of variables <italic>x</italic><sub><italic>i</italic></sub>, <italic>i</italic> = {1, 2, …}, the relative sensitivity coefficient
<disp-formula id="pcbi.1007073.e085"><alternatives><graphic id="pcbi.1007073.e085g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e085" xlink:type="simple"/><mml:math display="block" id="M85"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msubsup><mml:mi>c</mml:mi> <mml:mi>i</mml:mi> <mml:mo>*</mml:mo></mml:msubsup> <mml:mo>≔</mml:mo> <mml:mfrac><mml:msub><mml:mi>x</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mi>y</mml:mi></mml:mfrac> <mml:mfrac><mml:mrow><mml:mi>∂</mml:mi> <mml:mi>y</mml:mi></mml:mrow> <mml:mrow><mml:mi>∂</mml:mi> <mml:msub><mml:mi>x</mml:mi> <mml:mi>i</mml:mi></mml:msub></mml:mrow></mml:mfrac></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(40)</label></disp-formula>
is a measure of how the input parameter <italic>x</italic><sub><italic>i</italic></sub> affects the outcome <italic>y</italic>. The derivative was computed around an expected <italic>x</italic><sub><italic>i</italic></sub> with a 1% variation on <italic>x</italic><sub><italic>i</italic></sub>. We report <inline-formula id="pcbi.1007073.e086"><alternatives><graphic id="pcbi.1007073.e086g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e086" xlink:type="simple"/><mml:math display="inline" id="M86"><mml:msubsup><mml:mi>c</mml:mi> <mml:mi>i</mml:mi> <mml:mo>*</mml:mo></mml:msubsup></mml:math></alternatives></inline-formula> for the perfusion parameter <italic>α</italic>, the fluid viscosity <italic>μ</italic>, as well as the arterial and venous components of the porosity <italic>ϕ</italic><sub><italic>β</italic></sub>, the permeability <italic>k</italic><sub><italic>β</italic></sub>, and the pressure drop parameter <italic>γ</italic><sub><italic>β</italic></sub>. As investigated output parameters we used the arterial and venous pressures <italic>p</italic><sub><italic>a</italic></sub> and <italic>p</italic><sub><italic>v</italic></sub>, respectively, the perfusion (P), time to peak (TTP), and the mean transit time (MTT). Time to peak and mean transit time were computed according to standard definitions from tracer kinetic modelling. Time to peak is the average time in seconds to maximum height of the contrast enhancement curves. Mean transit time becomes CBV/CBF, which is equivalent to MTT = (<italic>ϕ</italic><sub><italic>a</italic></sub> + <italic>ϕ</italic><sub><italic>v</italic></sub>)/<italic>P</italic> in terms of our notation.</p>
</sec>
</sec>
<sec id="sec021" sec-type="results">
<title>Results</title>
<sec id="sec022">
<title>Numerical simulation of circulation and perfusion in a frog tongue</title>
<p>The current section accounts for simulation of circulation and perfusion in the frog tongue previously described. The vascular networks were segmented in terms of a binary mask, nodes, edges, and medial axes. In <xref ref-type="fig" rid="pcbi.1007073.g005">Fig 5</xref> we have aligned these structures with the support function <italic>η</italic><sup><italic>ϵ</italic></sup>(<italic>x</italic> − <italic>x</italic><sub><italic>k</italic></sub>) (<xref ref-type="disp-formula" rid="pcbi.1007073.e049">15</xref>). Simulation parameters used in the numerical simulations are shown in <xref ref-type="table" rid="pcbi.1007073.t001">Table 1</xref>. Several of the parameters are not accurately known, and literature references were used to find appropriate estimates. The parameters <italic>k</italic><sub><italic>β</italic></sub> and <italic>ϕ</italic><sub><italic>β</italic></sub> are field parameters, but were held constant in space within each compartment. The perfusion proportionality factor <italic>α</italic> was held constant everywhere within the frog tongue. Obtained pressure maps of the arterial and venous compartments are depicted in <xref ref-type="fig" rid="pcbi.1007073.g006">Fig 6</xref>. Pressure conditions in the vessel network are completely determined by the node pressure, but for visualization purposes the pressure was approximated along the edges using linear interpolation between connecting nodes. The obtained map of perfusion is shown in <xref ref-type="fig" rid="pcbi.1007073.g007">Fig 7</xref>. For the applied set of parameters an average perfusion of 65 ml/min/100ml was obtained, in the same order as human brain perfusion [<xref ref-type="bibr" rid="pcbi.1007073.ref050">50</xref>]. Average fluid tracer concentration of the arterial input function, and the arterial and venous compartments are shown in <xref ref-type="fig" rid="pcbi.1007073.g008">Fig 8</xref>. Voxelwise, volumetric tracer concentration <italic>C</italic> [mmol L<sup>−1</sup>] (<xref ref-type="disp-formula" rid="pcbi.1007073.e069">30</xref>) as a function of time is shown in <xref ref-type="fig" rid="pcbi.1007073.g009">Fig 9</xref>. We used a time step Δ<italic>t</italic> = 5 s between each time frame for plotting. In order to demonstrate scale invariance of the algorithm, perfusion was recomputed within a smaller FOV with different resolutions represented by multiplicative resolution scales <italic>S</italic><sub><italic>i</italic></sub>, <italic>i</italic> = {1, 2, 4, 6, 8, 10, 12, 14, 16}. See the red rectangle in <xref ref-type="fig" rid="pcbi.1007073.g005">Fig 5</xref> for the applied FOV with matrix size <italic>S</italic><sub>1</sub> = (100 × 100). The matrix size at scale <italic>i</italic> becomes <italic>S</italic><sub><italic>i</italic></sub> = (100 × 100)<italic>i</italic>. With except from the FOV, same parameter settings as reported in <xref ref-type="table" rid="pcbi.1007073.t001">Table 1</xref> were used for these simulations. Average perfusion for each scale was computed within the frog tongue, and obtained values are shown in <xref ref-type="fig" rid="pcbi.1007073.g010">Fig 10</xref>. For all practical means, perfusion remains constant over the resolution scales.</p>
<fig id="pcbi.1007073.g005" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1007073.g005</object-id>
<label>Fig 5</label>
<caption>
<title>Vascular network of the frog tongue.</title>
<p>Node centers are indicated with black dots. The medial axis of the network structure is shown as the set of lines connecting the nodes (red lines: arterial network, blue lines: venous network). The grey area within the tongue tissue indicates the support function <italic>η</italic><sup><italic>ϵ</italic></sup>(<italic>x</italic> − <italic>x</italic><sub><italic>k</italic></sub>) (<xref ref-type="disp-formula" rid="pcbi.1007073.e049">15</xref>) summed up for all terminals. The red rectangle in the lower field is the small FOV used for demonstrating scale invariance.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1007073.g005" xlink:type="simple"/>
</fig>
<fig id="pcbi.1007073.g006" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1007073.g006</object-id>
<label>Fig 6</label>
<caption>
<title>Pressure maps <italic>p</italic><sub><italic>a</italic></sub> and <italic>p</italic><sub><italic>v</italic></sub> of arterial (left) and venous compartment (right) of the frog tongue, respectively.</title>
<p>Note the different greyscale range between the plots, applied for visualization purposes.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1007073.g006" xlink:type="simple"/>
</fig>
<fig id="pcbi.1007073.g007" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1007073.g007</object-id>
<label>Fig 7</label>
<caption>
<title>Regional variability of the perfusion <italic>P</italic> [ml/min/100ml] within the frog tongue.</title>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1007073.g007" xlink:type="simple"/>
</fig>
<fig id="pcbi.1007073.g008" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1007073.g008</object-id>
<label>Fig 8</label>
<caption>
<title>Average fluid tracer concentration [mmol L<sup>−1</sup>] as a function of time for the arterial input function (AIF), and for the arterial and venous compartment of the frog tongue.</title>
<p>The average was calculated over the frog tongue.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1007073.g008" xlink:type="simple"/>
</fig>
<fig id="pcbi.1007073.g009" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1007073.g009</object-id>
<label>Fig 9</label>
<caption>
<title>Voxelwise volumetric tracer concentration <italic>C</italic> [mmol L<sup>−1</sup>] (<xref ref-type="disp-formula" rid="pcbi.1007073.e060">22</xref>) as a function of time for the frog tongue.</title>
<p>Every five second is shown from left to right and top to bottom, T = {0, 5, …, 60} s.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1007073.g009" xlink:type="simple"/>
</fig>
<fig id="pcbi.1007073.g010" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1007073.g010</object-id>
<label>Fig 10</label>
<caption>
<title>Average brain perfusion computed within the same FOV but under various multiplicative resolution scales.</title>
<p>All other simulation parameters were identical across the resolution scales. The average perfusion is converging at higher resolution scales.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1007073.g010" xlink:type="simple"/>
</fig>
<table-wrap id="pcbi.1007073.t001" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1007073.t001</object-id>
<label>Table 1</label>
<caption>
<title>Scalar simulation parameters for the frog tongue within various domains.</title>
<p>Matrix size was limited by the native input data. Arterial and venous boundary pressure values were applied as Dirichlet boundary conditions to the vascular root terminals <italic>N</italic><sup><italic>R</italic></sup>. The perfusion proportionality factor <italic>α</italic>(<italic>x</italic>) (<xref ref-type="disp-formula" rid="pcbi.1007073.e023">7</xref>) was assigned a constant value everywhere. par. = parameter. Field parameter <italic>α</italic> is only valid for the brain <inline-formula id="pcbi.1007073.e087"><alternatives><graphic id="pcbi.1007073.e087g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e087" xlink:type="simple"/><mml:math display="inline" id="M87"><mml:msub><mml:mo>Ω</mml:mo> <mml:mi mathvariant="script">B</mml:mi></mml:msub></mml:math></alternatives></inline-formula>.</p>
</caption>
<alternatives>
<graphic id="pcbi.1007073.t001g" mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1007073.t001" xlink:type="simple"/>
<table border="0" frame="box" rules="all">
<colgroup>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
</colgroup>
<thead>
<tr>
<th align="left">Parameter</th>
<th align="right">Symbol</th>
<th align="right">Unit</th>
<th align="center" colspan="5">Domain of validity</th>
</tr>
<tr>
<th align="left" rowspan="2"/>
<th align="right" rowspan="2"/>
<th align="right" rowspan="2"/>
<th align="center" rowspan="2">Entire domain</th>
<th align="center" colspan="2">Compartment</th>
<th align="center" colspan="2">Vascular network</th>
</tr>
<tr>
<th align="right">Arterial</th>
<th align="right">Venous</th>
<th align="right">Arterial</th>
<th align="right">Venous</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Field-of-view</td>
<td align="right">FOV</td>
<td align="right">mm</td>
<td align="right">(40, 33, 1)</td>
<td align="right"/>
<td align="right"/>
<td align="right"/>
<td align="right"/>
</tr>
<tr>
<td align="left">Matrix size</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">(634, 515, 1)</td>
<td align="right"/>
<td align="right"/>
<td align="right"/>
<td align="right"/>
</tr>
<tr>
<td align="left">Voxel size</td>
<td align="right"><italic>h</italic></td>
<td align="right">mm</td>
<td align="right">(0.063, 0.064, 1)</td>
<td align="right"/>
<td align="right"/>
<td align="right"/>
<td align="right"/>
</tr>
<tr>
<td align="left">Viscosity blood [<xref ref-type="bibr" rid="pcbi.1007073.ref046">46</xref>]</td>
<td align="right"><italic>μ</italic><sub><italic>b</italic></sub></td>
<td align="right">Pa ⋅ s</td>
<td align="right">3.00 × 10<sup>−3</sup></td>
<td align="right"/>
<td align="right"/>
<td align="right"/>
<td align="right"/>
</tr>
<tr>
<td align="left">Support radius (<xref ref-type="disp-formula" rid="pcbi.1007073.e052">17</xref>)</td>
<td align="right"><italic>ϵ</italic></td>
<td align="right">mm</td>
<td align="right">10.0</td>
<td align="right"/>
<td align="right"/>
<td align="right"/>
<td align="right"/>
</tr>
<tr>
<td align="left">Hematocrit</td>
<td align="right">Hct</td>
<td align="right">-</td>
<td align="right">0.40</td>
<td align="right"/>
<td align="right"/>
<td align="right"/>
<td align="right"/>
</tr>
<tr>
<td align="left">Perfusion par. (<xref ref-type="disp-formula" rid="pcbi.1007073.e023">7</xref>)</td>
<td align="right"><italic>α</italic></td>
<td align="right">m s kg<sup>−1</sup></td>
<td align="right">1.00 × 10<sup>−6</sup></td>
<td align="right"/>
<td align="right"/>
<td align="right"/>
<td align="right"/>
</tr>
<tr>
<td align="left">Permeability [<xref ref-type="bibr" rid="pcbi.1007073.ref047">47</xref>]</td>
<td align="right"><italic>k</italic><sub><italic>β</italic></sub></td>
<td align="right">10<sup>−12</sup> m<sup>2</sup></td>
<td align="right"/>
<td align="char" char=".">1.00</td>
<td align="char" char=".">5.00</td>
<td align="right"/>
<td align="right"/>
</tr>
<tr>
<td align="left">Porosity [<xref ref-type="bibr" rid="pcbi.1007073.ref048">48</xref>]</td>
<td align="right"><italic>ϕ</italic><sub><italic>β</italic></sub></td>
<td align="right">-</td>
<td align="right"/>
<td align="char" char=".">0.05</td>
<td align="char" char=".">0.10</td>
<td align="right"/>
<td align="right"/>
</tr>
<tr>
<td align="left">Boundary pressure [<xref ref-type="bibr" rid="pcbi.1007073.ref049">49</xref>]</td>
<td align="right"><italic>p</italic><sub><italic>β</italic>,0</sub></td>
<td align="right">kPa</td>
<td align="right"/>
<td align="right"/>
<td align="right"/>
<td align="char" char=".">10.6</td>
<td align="char" char=".">1.60</td>
</tr>
<tr>
<td align="left">Pressure drop par. (<xref ref-type="disp-formula" rid="pcbi.1007073.e059">21</xref>)</td>
<td align="right"><italic>γ</italic><sub><italic>β</italic></sub></td>
<td align="right">10<sup>−12</sup> m<sup>3</sup></td>
<td align="right"/>
<td align="right"/>
<td align="right"/>
<td align="char" char=".">0.01</td>
<td align="char" char=".">0.01</td>
</tr>
</tbody>
</table>
</alternatives>
</table-wrap>
</sec>
<sec id="sec023">
<title>Whole brain simulation on a MRI-extracted geometry</title>
<p>The current section describes numerical simulation of circulation and perfusion in a complete human brain where the geometry, including grey and white matter, as well as the vascular networks were extracted from MRI data. Simulation parameters are shown in <xref ref-type="table" rid="pcbi.1007073.t002">Table 2</xref>. All figures show the same image slice (no. 180) of the 3D image stack, with except from the 3D rendering in <xref ref-type="fig" rid="pcbi.1007073.g011">Fig 11</xref>.</p>
<table-wrap id="pcbi.1007073.t002" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1007073.t002</object-id>
<label>Table 2</label>
<caption>
<title>Simulation parameters for the human brain geometry within the various sub-domains.</title>
<p>Arterial and venous boundary pressures were applied as Dirichlet boundary conditions to the vascular root terminals <italic>N</italic><sup><italic>R</italic></sup>. Permeability and porosity are field parameters, but were assigned constant values within each tissue and compartment. par. = parameter.</p>
</caption>
<alternatives>
<graphic id="pcbi.1007073.t002g" mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1007073.t002" xlink:type="simple"/>
<table border="0" frame="box" rules="all">
<colgroup>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
</colgroup>
<thead>
<tr>
<th align="left">Parameter</th>
<th align="right">Symbol</th>
<th align="right">Unit</th>
<th align="center" colspan="5">Domain of validity</th>
</tr>
<tr>
<th align="left" rowspan="2"/>
<th align="right" rowspan="2"/>
<th align="right" rowspan="2"/>
<th align="center" rowspan="2">Entire domain</th>
<th align="center" colspan="2">Compartment</th>
<th align="center" colspan="2">Vascular network</th>
</tr>
<tr>
<th align="right">Arterial</th>
<th align="right">Venous</th>
<th align="right">Arterial</th>
<th align="right">Venous</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Field-of-view</td>
<td align="right">FOV</td>
<td align="right">mm</td>
<td align="right">(170, 220, 153)</td>
<td align="right"/>
<td align="right"/>
<td align="right"/>
<td align="right"/>
</tr>
<tr>
<td align="left">Matrix size</td>
<td align="right">-</td>
<td align="right">-</td>
<td align="right">(346, 448, 311)</td>
<td align="right"/>
<td align="right"/>
<td align="right"/>
<td align="right"/>
</tr>
<tr>
<td align="left">Voxel size</td>
<td align="right"><italic>h</italic></td>
<td align="right">mm</td>
<td align="right">(0.49, 0.49, 0.49)</td>
<td align="right"/>
<td align="right"/>
<td align="right"/>
<td align="right"/>
</tr>
<tr>
<td align="left">Viscosity blood [<xref ref-type="bibr" rid="pcbi.1007073.ref046">46</xref>]</td>
<td align="right"><italic>μ</italic><sub><italic>b</italic></sub></td>
<td align="right">[Pa ⋅ s]</td>
<td align="right">3.00 × 10<sup>−3</sup></td>
<td align="right"/>
<td align="right"/>
<td align="right"/>
<td align="right"/>
</tr>
<tr>
<td align="left">Support radius (<xref ref-type="disp-formula" rid="pcbi.1007073.e052">17</xref>)</td>
<td align="right"><italic>ϵ</italic></td>
<td align="right">mm</td>
<td align="right">30.0</td>
<td align="right"/>
<td align="right"/>
<td align="right"/>
<td align="right"/>
</tr>
<tr>
<td align="left">Hematocrit</td>
<td align="right">Hct</td>
<td align="right">-</td>
<td align="right">0.40</td>
<td align="right"/>
<td align="right"/>
<td align="right"/>
<td align="right"/>
</tr>
<tr>
<td align="left">Perfusion par. (<xref ref-type="disp-formula" rid="pcbi.1007073.e023">7</xref>)</td>
<td align="right"><italic>α</italic></td>
<td align="right">m s kg<sup>−1</sup></td>
<td align="right">1.00 × 10<sup>−5</sup></td>
<td align="right"/>
<td align="right"/>
<td align="right"/>
<td align="right"/>
</tr>
<tr>
<td align="left">Permeability [<xref ref-type="bibr" rid="pcbi.1007073.ref047">47</xref>]</td>
<td align="right"><italic>k</italic><sub><italic>β</italic></sub></td>
<td align="right">10<sup>−12</sup> m<sup>2</sup></td>
<td align="right"/>
<td align="char" char=".">12.5</td>
<td align="char" char=".">25.0</td>
<td align="right"/>
<td align="right"/>
</tr>
<tr>
<td align="left">Porosity [<xref ref-type="bibr" rid="pcbi.1007073.ref048">48</xref>, <xref ref-type="bibr" rid="pcbi.1007073.ref051">51</xref>]</td>
<td align="right"><italic>ϕ</italic><sub><italic>β</italic></sub></td>
<td align="right">-</td>
<td align="right"/>
<td align="char" char=".">0.05</td>
<td align="char" char=".">0.10</td>
<td align="right"/>
<td align="right"/>
</tr>
<tr>
<td align="left">Boundary pressure [<xref ref-type="bibr" rid="pcbi.1007073.ref049">49</xref>]</td>
<td align="right"><italic>p</italic><sub><italic>β</italic>,0</sub></td>
<td align="right">kPa</td>
<td align="right"/>
<td align="right"/>
<td align="right"/>
<td align="char" char=".">13.3</td>
<td align="char" char=".">0.66</td>
</tr>
<tr>
<td align="left">Pressure drop par. (<xref ref-type="disp-formula" rid="pcbi.1007073.e059">21</xref>)</td>
<td align="right"><italic>γ</italic><sub><italic>β</italic></sub></td>
<td align="right">10<sup>−12</sup> m<sup>3</sup></td>
<td align="right"/>
<td align="right"/>
<td align="right"/>
<td align="char" char=".">0.20</td>
<td align="char" char=".">0.20</td>
</tr>
</tbody>
</table>
</alternatives>
</table-wrap>
<fig id="pcbi.1007073.g011" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1007073.g011</object-id>
<label>Fig 11</label>
<caption>
<title>3D volume rendering of the T1-weighted data including the arterial (red) and venous (blue) vessels.</title>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1007073.g011" xlink:type="simple"/>
</fig>
<p>A volume rendering of the T1-weighted input data with superimposed arterial and venous masks is shown in <xref ref-type="fig" rid="pcbi.1007073.g011">Fig 11</xref> [<xref ref-type="bibr" rid="pcbi.1007073.ref052">52</xref>]. Vascular permeability <italic>k</italic><sub><italic>β</italic></sub> and porosity <italic>ϕ</italic><sub><italic>β</italic></sub> were assigned constant values within grey and white matter for each compartment, according to <xref ref-type="table" rid="pcbi.1007073.t002">Table 2</xref>. The perfusion proportionality factor <italic>α</italic>(<italic>x</italic>) (<xref ref-type="disp-formula" rid="pcbi.1007073.e023">7</xref>) is plotted in <xref ref-type="fig" rid="pcbi.1007073.g012">Fig 12</xref> for one axial slice. The grey matter value of <italic>α</italic> was set 1.6 times higher than the white matter value in order to resemble regional distribution of human brain perfusion [<xref ref-type="bibr" rid="pcbi.1007073.ref042">42</xref>]. The piecewise constant parameter maps of <italic>k</italic><sub><italic>β</italic></sub>(<italic>x</italic>), <italic>ϕ</italic><sub><italic>β</italic></sub>(<italic>x</italic>), and <italic>α</italic>(<italic>x</italic>) were smoothed using a Gaussian convolution with radius 2.5 mm and standard deviation 1.5 mm to impose smoothness in the white matter/grey matter boundary. The Gaussian smoothing is an attempt to simulate partial volume effects in MR, where a voxel situated on the boundary between different tissue will possess properties reflecting both tissue types. Calculated pressure maps of the arterial and venous compartments are shown in <xref ref-type="fig" rid="pcbi.1007073.g013">Fig 13</xref>. The voxelwise map of perfusion for a single axial slice is shown in <xref ref-type="fig" rid="pcbi.1007073.g014">Fig 14</xref>. Obtained values of average perfusion, arterial and venous pressure, time to peak (TTP), and mean transit time (MTT) are reported in <xref ref-type="table" rid="pcbi.1007073.t003">Table 3</xref> for the entire brain, as well as for white, and grey matter. The ratio of white matter perfusion to grey matter perfusion is 1.45, not far away from the expected ratio of approximately 1.6. The total number of arterial and venous nodes found in the data set was 335 and 1222, respectively. Spatially averaged tracer concentration-time-curves are shown in <xref ref-type="fig" rid="pcbi.1007073.g015">Fig 15</xref> for the arterial input function, as well as the arterial and venous compartments. Run-time for the whole brain simulation was 2.5 d on a 32 multicore 2.29 GHz linux server with 355 Mb RAM without use of parallel computing environments.</p>
<fig id="pcbi.1007073.g012" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1007073.g012</object-id>
<label>Fig 12</label>
<caption>
<title>Map of the perfusion proportionality factor <italic>α</italic>(<italic>x</italic>) used as input to the simulations.</title>
<p>Higher perfusion was assigned to grey matter than to white matter in order to resemble regional distribution of perfusion within a real human brain.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1007073.g012" xlink:type="simple"/>
</fig>
<fig id="pcbi.1007073.g013" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1007073.g013</object-id>
<label>Fig 13</label>
<caption>
<title>One slice of the calculated pressure maps <italic>p</italic><sub><italic>a</italic></sub> and <italic>p</italic><sub><italic>v</italic></sub> of the arterial (left) and venous (right) compartment, respectively.</title>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1007073.g013" xlink:type="simple"/>
</fig>
<fig id="pcbi.1007073.g014" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1007073.g014</object-id>
<label>Fig 14</label>
<caption>
<title>Obtained voxelwise perfusion <italic>P</italic> [ml/min/100ml] (<xref ref-type="disp-formula" rid="pcbi.1007073.e023">7</xref>) for one axial slice.</title>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1007073.g014" xlink:type="simple"/>
</fig>
<fig id="pcbi.1007073.g015" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1007073.g015</object-id>
<label>Fig 15</label>
<caption>
<title>Average tracer concentration time curves within the arterial input function, as well as the arterial and venous compartments of the human brain dataset.</title>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1007073.g015" xlink:type="simple"/>
</fig>
<table-wrap id="pcbi.1007073.t003" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1007073.t003</object-id>
<label>Table 3</label>
<caption>
<title>Obtained average perfusion <inline-formula id="pcbi.1007073.e088"><alternatives><graphic id="pcbi.1007073.e088g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e088" xlink:type="simple"/><mml:math display="inline" id="M88"><mml:mover accent="true"><mml:mi>P</mml:mi> <mml:mo>¯</mml:mo></mml:mover></mml:math></alternatives></inline-formula>, arterial <inline-formula id="pcbi.1007073.e089"><alternatives><graphic id="pcbi.1007073.e089g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e089" xlink:type="simple"/><mml:math display="inline" id="M89"><mml:msub><mml:mover accent="true"><mml:mi>p</mml:mi> <mml:mo>¯</mml:mo></mml:mover> <mml:mi>a</mml:mi></mml:msub></mml:math></alternatives></inline-formula> and venous <inline-formula id="pcbi.1007073.e090"><alternatives><graphic id="pcbi.1007073.e090g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e090" xlink:type="simple"/><mml:math display="inline" id="M90"><mml:msub><mml:mover accent="true"><mml:mi>p</mml:mi> <mml:mo>¯</mml:mo></mml:mover> <mml:mi>v</mml:mi></mml:msub></mml:math></alternatives></inline-formula> pressure, time to peak (<inline-formula id="pcbi.1007073.e091"><alternatives><graphic id="pcbi.1007073.e091g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e091" xlink:type="simple"/><mml:math display="inline" id="M91"><mml:mover accent="true"><mml:mtext>TTP</mml:mtext> <mml:mo>¯</mml:mo></mml:mover></mml:math></alternatives></inline-formula>), and mean transit time (<inline-formula id="pcbi.1007073.e092"><alternatives><graphic id="pcbi.1007073.e092g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e092" xlink:type="simple"/><mml:math display="inline" id="M92"><mml:mover accent="true"><mml:mtext>MTT</mml:mtext> <mml:mo>¯</mml:mo></mml:mover></mml:math></alternatives></inline-formula>) for various brain regions in the whole brain simulation.</title>
</caption>
<alternatives>
<graphic id="pcbi.1007073.t003g" mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1007073.t003" xlink:type="simple"/>
<table border="0" frame="box" rules="all">
<colgroup>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
<col align="left" valign="middle"/>
</colgroup>
<thead>
<tr>
<th align="left">Brain region</th>
<th align="left">
<inline-formula id="pcbi.1007073.e093">
<alternatives>
<graphic id="pcbi.1007073.e093g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e093" xlink:type="simple"/>
<mml:math display="inline" id="M93">
<mml:mover accent="true">
<mml:mi>P</mml:mi>
<mml:mo>¯</mml:mo>
</mml:mover>
</mml:math>
</alternatives>
</inline-formula>
</th>
<th align="left">
<inline-formula id="pcbi.1007073.e094">
<alternatives>
<graphic id="pcbi.1007073.e094g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e094" xlink:type="simple"/>
<mml:math display="inline" id="M94">
<mml:msub>
<mml:mover accent="true">
<mml:mi>p</mml:mi>
<mml:mo>¯</mml:mo>
</mml:mover>
<mml:mi>a</mml:mi>
</mml:msub>
</mml:math>
</alternatives>
</inline-formula>
</th>
<th align="left">
<inline-formula id="pcbi.1007073.e095">
<alternatives>
<graphic id="pcbi.1007073.e095g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e095" xlink:type="simple"/>
<mml:math display="inline" id="M95">
<mml:msub>
<mml:mover accent="true">
<mml:mi>p</mml:mi>
<mml:mo>¯</mml:mo>
</mml:mover>
<mml:mi>v</mml:mi>
</mml:msub>
</mml:math>
</alternatives>
</inline-formula>
</th>
<th align="left">
<inline-formula id="pcbi.1007073.e096">
<alternatives>
<graphic id="pcbi.1007073.e096g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e096" xlink:type="simple"/>
<mml:math display="inline" id="M96">
<mml:mover accent="true">
<mml:mtext>TTP</mml:mtext>
<mml:mo>¯</mml:mo>
</mml:mover>
</mml:math>
</alternatives>
</inline-formula>
</th>
<th align="left">
<inline-formula id="pcbi.1007073.e097">
<alternatives>
<graphic id="pcbi.1007073.e097g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e097" xlink:type="simple"/>
<mml:math display="inline" id="M97">
<mml:mover accent="true">
<mml:mtext>MTT</mml:mtext>
<mml:mo>¯</mml:mo>
</mml:mover>
</mml:math>
</alternatives>
</inline-formula>
</th>
</tr>
<tr>
<th align="left">Unit</th>
<th align="left">mL/min100/mL</th>
<th align="left">Pa</th>
<th align="left">Pa</th>
<th align="left">s</th>
<th align="left">s</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">Entire brain</td>
<td align="char" char=".">35.78</td>
<td align="char" char=".">8.10</td>
<td align="char" char=".">7.62</td>
<td align="char" char=".">17.03</td>
<td align="char" char=".">35.30</td>
</tr>
<tr>
<td align="left">White matter</td>
<td align="char" char=".">29.20</td>
<td align="char" char=".">8.15</td>
<td align="char" char=".">7.68</td>
<td align="char" char=".">18.01</td>
<td align="char" char=".">40.36</td>
</tr>
<tr>
<td align="left">Grey matter</td>
<td align="char" char=".">42.21</td>
<td align="char" char=".">8.06</td>
<td align="char" char=".">7.57</td>
<td align="char" char=".">17.03</td>
<td align="char" char=".">30.36</td>
</tr>
</tbody>
</table>
</alternatives>
</table-wrap>
</sec>
<sec id="sec024">
<title>Parameter sensitivity analysis</title>
<p>The relative sensitivity coefficient <inline-formula id="pcbi.1007073.e098"><alternatives><graphic id="pcbi.1007073.e098g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e098" xlink:type="simple"/><mml:math display="inline" id="M98"><mml:msubsup><mml:mi>c</mml:mi> <mml:mi>i</mml:mi> <mml:mo>*</mml:mo></mml:msubsup></mml:math></alternatives></inline-formula> according to (<xref ref-type="disp-formula" rid="pcbi.1007073.e085">40</xref>) was computed for each output variable for the frog tongue and the 3D human brain example. Spatially averaged relative sensitivity coefficients of the human brain example are shown in <xref ref-type="fig" rid="pcbi.1007073.g016">Fig 16</xref> (left panel), where it is found that the perfusion proportionality parameter <italic>α</italic> has a strong positive relation to the perfusion <italic>P</italic> (grid position (1,3)), and a negative relation to MTT (grid position (1,5)). Venous porosity <italic>ϕ</italic><sub><italic>v</italic></sub> is strongly positively correlated with MTT (grid position (3,5)). An example of a voxelwise map of <inline-formula id="pcbi.1007073.e099"><alternatives><graphic id="pcbi.1007073.e099g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1007073.e099" xlink:type="simple"/><mml:math display="inline" id="M99"><mml:msubsup><mml:mi>c</mml:mi> <mml:mi>i</mml:mi> <mml:mo>*</mml:mo></mml:msubsup></mml:math></alternatives></inline-formula> for the frog tongue is shown in <xref ref-type="fig" rid="pcbi.1007073.g016">Fig 16</xref> (right panel), demonstrating a local variability in the coefficients.</p>
<fig id="pcbi.1007073.g016" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1007073.g016</object-id>
<label>Fig 16</label>
<caption>
<title>Relative sensitivity coefficients for the perfusion proportionality parameter <italic>α</italic>, porosities <italic>ϕ</italic><sub><italic>a</italic></sub>, <italic>ϕ</italic><sub><italic>v</italic></sub>, vascular permeabilities <italic>k</italic><sub><italic>a</italic></sub>, <italic>k</italic><sub><italic>v</italic></sub>, the pressure drop parameter <italic>γ</italic><sub><italic>a</italic></sub>, <italic>γ</italic><sub><italic>v</italic></sub>, and fluid viscosity <italic>μ</italic> investigated for the compartmental pressures <italic>p</italic><sub><italic>a</italic></sub>, <italic>p</italic><sub><italic>v</italic></sub>, the perfusion <italic>P</italic>, time to peak (TTP), and mean transit time (MTT) for the frog tongue.</title>
<p>Brighter values indicate higher sensitivity of the input parameter to the output parameter. Left: Relative sensitivity coefficient averaged over the voxels for the 3D human brain example. Right: Voxelwise, relative sensitivity coefficients from the frog tongue showing the relation between <italic>α</italic> and <italic>P</italic>.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1007073.g016" xlink:type="simple"/>
</fig>
</sec>
</sec>
<sec id="sec025" sec-type="conclusions">
<title>Discussion</title>
<p>A proper mathematical model of circulation and perfusion is essential for simulating the pathway of blood, nutrients, oxygen, and drugs within the brain and other organs. In this respect, a comprehensive simulation tool for entire organs should address certain requirements: (i) It needs to be scale invariant, (ii) it should reflect a clinical understanding of perfusion, and (iii) it should apply to an entire organ. We claim that existing simulation tools are lacking at least one of these requirements. Traditional pharmacokinetic compartment models are useful to describe perfusion within entire organs, but they are inaccurate for voxelwise descriptions [<xref ref-type="bibr" rid="pcbi.1007073.ref006">6</xref>–<xref ref-type="bibr" rid="pcbi.1007073.ref009">9</xref>], hence, they are short of (i). On the other hand, numerous simulation studies have described the intertwined processes of angiogenesis, drug delivery and interstitial flow in artificial tumor microvascular networks [<xref ref-type="bibr" rid="pcbi.1007073.ref012">12</xref>–<xref ref-type="bibr" rid="pcbi.1007073.ref015">15</xref>]. However, these models are not explicitly expressing perfusion as a clinical parameter, and they have not been developed for the whole brain, hence lacking in (ii) and (iii). In this context, there is a need for precise mathematical models describing perfusion both locally and globally, also requested in [<xref ref-type="bibr" rid="pcbi.1007073.ref053">53</xref>]. The current study is an attempt to bridge this gap. Our main contribution is a comprehensive, data-driven and scale invariant model for whole brain circulation and perfusion using a mathematically strict definition of perfusion in line with its clinical understanding. Thus, our method is simultaneously addressing (i)-(iii), and it represents a new generation of simulation tools for predicting transport of nutrients, oxygen and drugs in live, human tissue. Simulation of flow in live, human tissue is a challenging task where compartment models with suitable modifications can be transferred across organs and physiology [<xref ref-type="bibr" rid="pcbi.1007073.ref018">18</xref>]. In this context, our model is generic and can be modified for description of other organs than the brain, as well as pathological conditions. At present, our model assumes no leakage and an intact blood-brain barrier, and the focus for discussion is restricted to brain perfusion in the absence of pathological conditions.</p>
<p>In the current study we demonstrate scale invariance of our algorithm, thus fulfilling (i). This becomes clear in <xref ref-type="fig" rid="pcbi.1007073.g010">Fig 10</xref>, where the average perfusion within a patch convergences towards a fixed number at higher multiplicative scales. In this respect, we have shown that our method can be used to retrieve or simulate perfusion in isolated patches of various scale and resolution given appropriate boundary conditions. Practically speaking, the average perfusion over a ROI is by all practical means independent of discretization level, a property lacking for traditional compartment models of perfusion. With respect to (ii) above, our implementation is in line with previous work where it was suggested to define perfusion as the transition of blood from the arterial to the venous side in a 2C model [<xref ref-type="bibr" rid="pcbi.1007073.ref016">16</xref>–<xref ref-type="bibr" rid="pcbi.1007073.ref019">19</xref>].</p>
<p>An important novelty of our work is the data-driven whole brain geometry applied in the simulations, satisfying (iii) above. Geometry largely affects simulation results by imposing no-flow conditions between the brain and non-brain regions. Our approach to generate the whole brain geometry utilizes advanced MR acquisitions to provide a mask of the brain, and also spatially connected vascular networks in 3D for the arteries and veins. The visibility of the brain mask and the vascular networks is limited by the imaging voxel resolution. A strong argument in favor of whole brain simulation in contrast to simulating on smaller patches only is the application of simpler no-flow boundary conditions around the organ. Also, Dirichlet boundary conditions are effectively applied at the arterial inlet and the venous outlet in the larger vessels. On the contrary, simulating small patches requires unknown and complex boundary conditions along all boundaries with permeating flow.</p>
<p>Our simulation results demonstrate a somewhat higher mean transit time [<xref ref-type="bibr" rid="pcbi.1007073.ref054">54</xref>], and lower perfusion than expected [<xref ref-type="bibr" rid="pcbi.1007073.ref055">55</xref>] (i.e. <xref ref-type="table" rid="pcbi.1007073.t003">Table 3</xref>), although the obtained ratio of grey matter perfusion to white matter perfusion was reasonable. These deviations may be due to erroneous parameter settings, as they must be determined by trial and error. This is also supported by the sensitivity analysis demonstrating a high variability in the sensitivity of input parameters within the investigated parameter range to the output fields (see <xref ref-type="fig" rid="pcbi.1007073.g016">Fig 16</xref>). One useful application of our model is the estimation of local model parameters of porosity, permeability and <italic>α</italic> in the framework of inverse modelling. In these approaches, a tracer kinetic model is fitted to concentration time curves subsequent to a bolus injection of a contrast agent [<xref ref-type="bibr" rid="pcbi.1007073.ref056">56</xref>]. Common to both forward simulation and inverse modelling tasks is the need for accurate forward kinetic models ensuring conservation of mass. In addition, flow models providing conservation of fluid momentum are applied in more comprehensive models, e.g. ensemble Kalman filters [<xref ref-type="bibr" rid="pcbi.1007073.ref057">57</xref>]. An initial investigation on estimating parameters of a forward model utilizing a multi-compartment model to estimate perfusion is presented in [<xref ref-type="bibr" rid="pcbi.1007073.ref058">58</xref>]. The approach presented there is based on the ensemble Kalman filter which is a promising candidate for parameter estimation also in our setting. The ensemble Kalman filter is used for parameter estimation of many large scale problems within geoscience (see e.g. [<xref ref-type="bibr" rid="pcbi.1007073.ref058">58</xref>]).</p>
<p>A commonly debated challenge of vascular flow simulations is how to connect 1D tubular flow in the vessel network with 3D Darcy flow in the continuum [<xref ref-type="bibr" rid="pcbi.1007073.ref022">22</xref>, <xref ref-type="bibr" rid="pcbi.1007073.ref059">59</xref>, <xref ref-type="bibr" rid="pcbi.1007073.ref060">60</xref>]. It is well-known that the numerical accuracy of elliptic PDEs with Dirac source terms is below optimal order estimates since the solution is not in <italic>H</italic><sup>1</sup>. Several solutions to the problem of numerical instability have been proposed, e.g. modification of the source term itself by smoothing kernels, by locally refined meshes [<xref ref-type="bibr" rid="pcbi.1007073.ref061">61</xref>], or by quasi-uniform meshes [<xref ref-type="bibr" rid="pcbi.1007073.ref062">62</xref>]. Our suggested solution circumvents the numerical challenges by modifying the underlying mathematical model of the vascular network, thus becoming compliant with a numerically stable approximation to the PDE. As described earlier, we define a local support function <italic>η</italic><sup><italic>ϵ</italic></sup> where the flow is distributed from the 1D network into the 3D brain tissue, in this sense avoiding the singularity and also adopting to the physiological circumstances of distributing micro-flow below imaging resolution. The support function ensures fluid mass balance. Furthermore, it assures that a majority of the fluid is distributed close to the terminals rather than further away, while at the same time adopting to local, complex geometrical shapes. Outside a strict threshold <italic>ϵ</italic> no fluid is allocated. For the venous network, the opposite process takes place with fluid uptake instead of delivery within the non-zero support function. The non-local distribution of fluid eliminates the singularities from the mathematical model, at the cost of a (slight) non-locality in the equation. From an abstract perspective, this mimics the situation of modelling fracture propagation in elasticity, where peridynamics is a model that incorporates physically motivated non-local terms [<xref ref-type="bibr" rid="pcbi.1007073.ref063">63</xref>].</p>
<p>A work of particular relevance is the model in Peyrounette et al. [<xref ref-type="bibr" rid="pcbi.1007073.ref053">53</xref>]. The authors provide a consistent coupling of the node terminals with the continuum following an analytical approximation of Darcy’s law. In contrast to our model, they require pointwise consistency of pressure drop in adjacent voxels, while we demand consistency in average pressure drop. Also, the authors are not focusing on perfusion as a clinical model parameter, and a whole brain simulation on a data-driven geometry is a task they foresee in future work.</p>
<p>Another approach for dealing with the 1D-3D coupling problem is the simulation of branched mesoscale vessel trees below imaging resolution according to a set of growth rules related to bifurcation angles, vessel radii and length [<xref ref-type="bibr" rid="pcbi.1007073.ref064">64</xref>]. To the best of our knowledge, whole brain flow simulation on these networks coupled with data-driven macro-scale vessels has not been carried out yet. To this point, we claim that such growth of vessels deprived from attracting forces is mathematically redundant to achieve the goal of a smooth distribution of flow, which is equally well obtained by our proposed method of a smooth support function.</p>
<p>Since we are applying porous media-like flow in the capillaries we are not depending on segmenting single vessels down to the capillary scale. On the macro-scale, we assume the knowledge of vascular networks down to imaging resolution. Hence, there exists an intermediate scale of approximately 50-500 μm with unknown vessel architecture associated with medium-sized arterioles and venules, requiring a novel solution for representing the flow. One proposed solution is the coupling of a 1D vascular network with a hierarchical Darcy flow model [<xref ref-type="bibr" rid="pcbi.1007073.ref065">65</xref>, <xref ref-type="bibr" rid="pcbi.1007073.ref066">66</xref>]. A noticeable challenge following this approach is determination of model parameters for each hierarchical state. Moreover, flow in increasingly larger arterioles does not sufficiently well adhere to classical Darcy flow. Our support function is a novel approach for simultaneously dealing with the 1D-3D coupling problem as well as with the transport of fluid on an invisible, fine-scale network of medium sized arterioles and venules.</p>
<p>A common challenge with the implementation of forward simulation tools is the assignment of accurate parameter settings, which is also a limitation in our work. We tried to accomplish this task by using literature values whenever possible. Another open question is the method’s sensitivity to missing vessel segments below the resolution scale. Clearly, macrostructural geometry is strongly influencing the flow pattern, and even higher resolution data than we apply in our work are expected to produce simulation results with certain differences. However, this is future work of high relevance that should be systematically investigated over a range of admissible resolution scales.</p>
<p>We emphasize that simulation on a full brain geometry is highly challenging from a computational perspective [<xref ref-type="bibr" rid="pcbi.1007073.ref053">53</xref>, <xref ref-type="bibr" rid="pcbi.1007073.ref067">67</xref>]. Indeed, our discrete representation of the whole brain contains 324 arterial segments, 1212 venous segments, and 13.9 millions active voxels on which Darcy’s law is discretized. To our knowledge, no comparable simulations have been conducted at this scale on real data.</p>
<p>In conclusion, we have implemented a scale invariant, whole brain flow model in accordance with a clinical understanding of perfusion. To the best of our knowledge, none of the existing approaches possess these essential properties. Hence, our model represents a new generation of scale invariant simulation tools for brain perfusion, with a wide range of possible applications related to forward simulations as well as to inverse modelling tasks in contrast enhanced imaging. From a clinical point of view, such generic and scale-invariant simulation tools have a large potential to improve the accuracy of postprocessing tools used in dynamic imaging methods. They can also be highly useful for a better understanding of drug delivery and hence treatment efficacy as well as for preoperative planning stages, with a possibly large impact on daily health-care.</p>
</sec>
<sec id="sec026">
<title>Supporting information</title>
<supplementary-material id="pcbi.1007073.s001" mimetype="video/mp4" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1007073.s001" xlink:type="simple">
<label>S1 Video</label>
<caption>
<title>3D rendering of arteries, veins, and brain tissue.</title>
<p>Geometric domains for the 3D whole brain simulation including arteries (red vessels), veins (blue vessel), and brain tissue (bright, curved surface). In the simulation, arterial blood moves in on the arterial side, it propagates through capillaries in the brain tissue, and moves out on the other side via the veins.</p>
<p>(MP4)</p>
</caption>
</supplementary-material>
<supplementary-material id="pcbi.1007073.s002" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1007073.s002.nii" xlink:type="simple">
<label>S1 Data</label>
<caption>
<title>Tissue mask frog.</title>
<p>(GZ)</p>
</caption>
</supplementary-material>
<supplementary-material id="pcbi.1007073.s003" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1007073.s003.nii" xlink:type="simple">
<label>S2 Data</label>
<caption>
<title>Arterial mask frog.</title>
<p>(GZ)</p>
</caption>
</supplementary-material>
<supplementary-material id="pcbi.1007073.s004" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1007073.s004.nii" xlink:type="simple">
<label>S3 Data</label>
<caption>
<title>Venous mask frog.</title>
<p>(GZ)</p>
</caption>
</supplementary-material>
<supplementary-material id="pcbi.1007073.s005" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1007073.s005.nii" xlink:type="simple">
<label>S4 Data</label>
<caption>
<title>White matter mask human brain.</title>
<p>(GZ)</p>
</caption>
</supplementary-material>
<supplementary-material id="pcbi.1007073.s006" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1007073.s006.nii" xlink:type="simple">
<label>S5 Data</label>
<caption>
<title>Grey matter mask human brain.</title>
<p>(GZ)</p>
</caption>
</supplementary-material>
<supplementary-material id="pcbi.1007073.s007" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1007073.s007.nii" xlink:type="simple">
<label>S6 Data</label>
<caption>
<title>Arterial mask human brain.</title>
<p>(GZ)</p>
</caption>
</supplementary-material>
<supplementary-material id="pcbi.1007073.s008" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1007073.s008.nii" xlink:type="simple">
<label>S7 Data</label>
<caption>
<title>Venous mask human brain.</title>
<p>(GZ)</p>
</caption>
</supplementary-material>
</sec>
</body>
<back>
<ack>
<p>The authors wish to thank PhD Astrid Marie Skålvik for useful discussions on sensitivity analyses.</p>
</ack>
<ref-list>
<title>References</title>
<ref id="pcbi.1007073.ref001">
<label>1</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Chen</surname> <given-names>Y</given-names></name>, <name name-style="western"><surname>Wolk</surname> <given-names>DA</given-names></name>, <name name-style="western"><surname>Reddin</surname> <given-names>JS</given-names></name>, <name name-style="western"><surname>Korczykowski</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Martinez</surname> <given-names>PM</given-names></name>, <name name-style="western"><surname>Musiek</surname> <given-names>ES</given-names></name>, <etal>et al</etal>. <article-title>Voxel-level comparison of arterial spin-labeled perfusion MRI and FDG-PET in Alzheimer disease</article-title>. <source>Neurology</source>. <year>2011</year>;<volume>77</volume>(<issue>22</issue>):<fpage>1977</fpage>–<lpage>85</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1212/WNL.0b013e31823a0ef7" xlink:type="simple">10.1212/WNL.0b013e31823a0ef7</ext-link></comment> <object-id pub-id-type="pmid">22094481</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref002">
<label>2</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Vorstrup</surname> <given-names>S</given-names></name>, <name name-style="western"><surname>Paulson</surname> <given-names>O</given-names></name>, <name name-style="western"><surname>Lassen</surname> <given-names>N</given-names></name>. <article-title>Cerebral blood flow in acute and chronic ischemic stroke using xenon-133 inhalation tomography</article-title>. <source>Acta neurologica scandinavica</source>. <year>1986</year>;<volume>74</volume>(<issue>6</issue>):<fpage>439</fpage>–<lpage>451</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1111/j.1600-0404.1986.tb07869.x" xlink:type="simple">10.1111/j.1600-0404.1986.tb07869.x</ext-link></comment> <object-id pub-id-type="pmid">3493616</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref003">
<label>3</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Rubin</surname> <given-names>G</given-names></name>, <name name-style="western"><surname>Firlik</surname> <given-names>AD</given-names></name>, <name name-style="western"><surname>Levy</surname> <given-names>EI</given-names></name>, <name name-style="western"><surname>Pindzola</surname> <given-names>RR</given-names></name>, <name name-style="western"><surname>Yonas</surname> <given-names>H</given-names></name>. <article-title>Relationship between cerebral blood flow and clinical outcome in acute stroke</article-title>. <source>Cerebrovascular Diseases</source>. <year>2000</year>;<volume>10</volume>(<issue>4</issue>):<fpage>298</fpage>–<lpage>306</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1159/000016074" xlink:type="simple">10.1159/000016074</ext-link></comment> <object-id pub-id-type="pmid">10878436</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref004">
<label>4</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Nudelman</surname> <given-names>KN</given-names></name>, <name name-style="western"><surname>Wang</surname> <given-names>Y</given-names></name>, <name name-style="western"><surname>McDonald</surname> <given-names>BC</given-names></name>, <name name-style="western"><surname>Conroy</surname> <given-names>SK</given-names></name>, <name name-style="western"><surname>Smith</surname> <given-names>DJ</given-names></name>, <name name-style="western"><surname>West</surname> <given-names>JD</given-names></name>, <etal>et al</etal>. <article-title>Altered cerebral blood flow one month after systemic chemotherapy for breast cancer: a prospective study using pulsed arterial spin labeling MRI perfusion</article-title>. <source>PloS one</source>. <year>2014</year>;<volume>9</volume>(<issue>5</issue>):<fpage>e96713</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1371/journal.pone.0096713" xlink:type="simple">10.1371/journal.pone.0096713</ext-link></comment> <object-id pub-id-type="pmid">24816641</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref005">
<label>5</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Andre</surname> <given-names>JB</given-names></name>, <name name-style="western"><surname>Nagpal</surname> <given-names>S</given-names></name>, <name name-style="western"><surname>Hippe</surname> <given-names>DS</given-names></name>, <name name-style="western"><surname>Ravanpay</surname> <given-names>AC</given-names></name>, <name name-style="western"><surname>Schmiedeskamp</surname> <given-names>H</given-names></name>, <name name-style="western"><surname>Bammer</surname> <given-names>R</given-names></name>, <etal>et al</etal>. <article-title>Cerebral blood flow changes in glioblastoma patients undergoing bevacizumab treatment are seen in both tumor and normal brain</article-title>. <source>The neuroradiology journal</source>. <year>2015</year>;<volume>28</volume>(<issue>2</issue>):<fpage>112</fpage>–<lpage>119</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1177/1971400915576641" xlink:type="simple">10.1177/1971400915576641</ext-link></comment> <object-id pub-id-type="pmid">25923677</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref006">
<label>6</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Henkelman</surname> <given-names>RM</given-names></name>. <article-title>Does IVIM measure classical perfusion?</article-title> <source>Magn Reson Med</source>. <year>1990</year>;<volume>16</volume>(<issue>3</issue>):<fpage>470</fpage>–<lpage>75</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1002/mrm.1910160313" xlink:type="simple">10.1002/mrm.1910160313</ext-link></comment> <object-id pub-id-type="pmid">2077337</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref007">
<label>7</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Guibert</surname> <given-names>R</given-names></name>, <name name-style="western"><surname>Fonta</surname> <given-names>C</given-names></name>, <name name-style="western"><surname>Estève</surname> <given-names>F</given-names></name>, <name name-style="western"><surname>Plouraboué</surname> <given-names>F</given-names></name>. <article-title>On the normalization of cerebral blood flow</article-title>. <source>Journal of Cerebral Blood Flow &amp; Metabolism</source>. <year>2013</year>;<volume>33</volume>(<issue>5</issue>):<fpage>669</fpage>–<lpage>672</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1038/jcbfm.2013.39" xlink:type="simple">10.1038/jcbfm.2013.39</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref008">
<label>8</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Sourbron</surname> <given-names>SP</given-names></name>. <article-title>A tracer-kinetic field theory for medical imaging</article-title>. <source>IEEE Trans Med Imaging</source>. <year>2014</year>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1109/TMI.2014.2300450" xlink:type="simple">10.1109/TMI.2014.2300450</ext-link></comment> <object-id pub-id-type="pmid">24710162</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref009">
<label>9</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Hanson</surname> <given-names>EA</given-names></name>, <name name-style="western"><surname>Sandmann</surname> <given-names>C</given-names></name>, <name name-style="western"><surname>Malyshev</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Lundervold</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Modersitzki</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Hodneland</surname> <given-names>E</given-names></name>. <article-title>Estimating the discretization dependent accuracy of perfusion in coupled capillary flow measurements</article-title>. <source>PLOS ONE</source>. <year>2018</year>;<volume>13</volume>(<issue>7</issue>):<fpage>1</fpage>–<lpage>16</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1371/journal.pone.0200521" xlink:type="simple">10.1371/journal.pone.0200521</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref010">
<label>10</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Perdikaris</surname> <given-names>P</given-names></name>, <name name-style="western"><surname>Grinberg</surname> <given-names>L</given-names></name>, <name name-style="western"><surname>Karniadakis</surname> <given-names>GE</given-names></name>. <article-title>Multiscale modeling and simulation of brain blood flow</article-title>. <source>Physics of Fluids</source>. <year>2016</year>;<volume>28</volume>(<issue>2</issue>):<fpage>021304</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1063/1.4941315" xlink:type="simple">10.1063/1.4941315</ext-link></comment> <object-id pub-id-type="pmid">26909005</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref011">
<label>11</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Reichold</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Stampanoni</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Keller</surname> <given-names>AL</given-names></name>, <name name-style="western"><surname>Buck</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Jenny</surname> <given-names>P</given-names></name>, <name name-style="western"><surname>Weber</surname> <given-names>B</given-names></name>. <article-title>Vascular graph model to simulate the cerebral blood flow in realistic vascular networks</article-title>. <source>Journal of Cerebral Blood Flow &amp; Metabolism</source>. <year>2009</year>;<volume>29</volume>(<issue>8</issue>):<fpage>1429</fpage>–<lpage>1443</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1038/jcbfm.2009.58" xlink:type="simple">10.1038/jcbfm.2009.58</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref012">
<label>12</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Sefidgar</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Soltani</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Raahemifar</surname> <given-names>K</given-names></name>, <name name-style="western"><surname>Bazmara</surname> <given-names>H</given-names></name>. <article-title>Effect of fluid friction on interstitial fluid flow coupled with blood flow through solid tumor microvascular network</article-title>. <source>Comput Math Methods Med</source>. <year>2015</year>;<volume>2015</volume>:<fpage>e673426</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1155/2015/673426" xlink:type="simple">10.1155/2015/673426</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref013">
<label>13</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Cattaneo</surname> <given-names>L</given-names></name>, <name name-style="western"><surname>Zunino</surname> <given-names>P</given-names></name>. <article-title>A computational model of drug delivery through microcirculation to compare different tumor treatments</article-title>. <source>Int J Numer Method Biomed Eng</source>. <year>2014</year>;<volume>30</volume>(<issue>11</issue>):<fpage>1347</fpage>–<lpage>1371</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1002/cnm.2661" xlink:type="simple">10.1002/cnm.2661</ext-link></comment> <object-id pub-id-type="pmid">25044965</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref014">
<label>14</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Schuff</surname> <given-names>MM</given-names></name>, <name name-style="western"><surname>Gore</surname> <given-names>JP</given-names></name>, <name name-style="western"><surname>Nauman</surname> <given-names>EA</given-names></name>. <article-title>A mixture theory model of fluid and solute transport in the microvasculature of normal and malignant tissues. I. Theory</article-title>. <source>J Math Biol</source>. <year>2013</year>;<volume>66</volume>(<issue>6</issue>):<fpage>1179</fpage>–<lpage>1207</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1007/s00285-012-0528-7" xlink:type="simple">10.1007/s00285-012-0528-7</ext-link></comment> <object-id pub-id-type="pmid">22526836</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref015">
<label>15</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Cai</surname> <given-names>Y</given-names></name>, <name name-style="western"><surname>Xu</surname> <given-names>S</given-names></name>, <name name-style="western"><surname>Wu</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Long</surname> <given-names>Q</given-names></name>. <article-title>Coupled modelling of tumour angiogenesis, tumour growth and blood perfusion</article-title>. <source>J Theor Biol</source>. <year>2011</year>;<volume>279</volume>(<issue>1</issue>):<fpage>90</fpage>–<lpage>101</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.jtbi.2011.02.017" xlink:type="simple">10.1016/j.jtbi.2011.02.017</ext-link></comment> <object-id pub-id-type="pmid">21392511</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref016">
<label>16</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Cookson</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Lee</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Michler</surname> <given-names>C</given-names></name>, <name name-style="western"><surname>Chabiniok</surname> <given-names>R</given-names></name>, <name name-style="western"><surname>Hyde</surname> <given-names>E</given-names></name>, <name name-style="western"><surname>Nordsletten</surname> <given-names>D</given-names></name>, <etal>et al</etal>. <article-title>A novel porous mechanical framework for modelling the interaction between coronary perfusion and myocardial mechanics</article-title>. <source>Journal of biomechanics</source>. <year>2012</year>;<volume>45</volume>(<issue>5</issue>):<fpage>850</fpage>–<lpage>855</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.jbiomech.2011.11.026" xlink:type="simple">10.1016/j.jbiomech.2011.11.026</ext-link></comment> <object-id pub-id-type="pmid">22154392</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref017">
<label>17</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Cookson</surname> <given-names>AN</given-names></name>, <name name-style="western"><surname>Lee</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Michler</surname> <given-names>C</given-names></name>, <name name-style="western"><surname>Chabiniok</surname> <given-names>R</given-names></name>, <name name-style="western"><surname>Hyde</surname> <given-names>E</given-names></name>, <name name-style="western"><surname>Nordsletten</surname> <given-names>D</given-names></name>, <etal>et al</etal>. <article-title>A spatially-distributed computational model to quantify behaviour of contrast agents in MR perfusion imaging</article-title>. <source>Medical image analysis</source>. <year>2014</year>;<volume>18</volume>(<issue>7</issue>):<fpage>1200</fpage>–<lpage>1216</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.media.2014.07.002" xlink:type="simple">10.1016/j.media.2014.07.002</ext-link></comment> <object-id pub-id-type="pmid">25103922</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref018">
<label>18</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Sourbron</surname> <given-names>SP</given-names></name>, <name name-style="western"><surname>Buckley</surname> <given-names>DL</given-names></name>. <article-title>Classic models for dynamic contrast-enhanced MRI</article-title>. <source>NMR in Biomedicine</source>. <year>2013</year>;<volume>26</volume>(<issue>8</issue>):<fpage>1004</fpage>–<lpage>1027</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1002/nbm.2940" xlink:type="simple">10.1002/nbm.2940</ext-link></comment> <object-id pub-id-type="pmid">23674304</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref019">
<label>19</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Rohan</surname> <given-names>E</given-names></name>, <name name-style="western"><surname>Lukeš</surname> <given-names>V</given-names></name>, <name name-style="western"><surname>Jonášová</surname> <given-names>A</given-names></name>. <article-title>Modeling of the contrast-enhanced perfusion test in liver based on the multi-compartment flow in porous media</article-title>. <source>Journal of mathematical biology</source>. <year>2018</year>;<volume>77</volume>(<issue>2</issue>):<fpage>421</fpage>–<lpage>454</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1007/s00285-018-1209-y" xlink:type="simple">10.1007/s00285-018-1209-y</ext-link></comment> <object-id pub-id-type="pmid">29368273</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref020">
<label>20</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Limbu</surname> <given-names>YR</given-names></name>, <name name-style="western"><surname>Gurung</surname> <given-names>G</given-names></name>, <name name-style="western"><surname>Malla</surname> <given-names>R</given-names></name>, <name name-style="western"><surname>Rajbhandari</surname> <given-names>R</given-names></name>, <name name-style="western"><surname>Regmi</surname> <given-names>SR</given-names></name>. <article-title>Assessment of carotid artery dimensions by ultrasound in non-smoker healthy adults of both sexes</article-title>. <source>Nepal Medical College journal: NMCJ</source>. <year>2006</year>;<volume>8</volume>(<issue>3</issue>):<fpage>200</fpage>–<lpage>203</lpage>. <object-id pub-id-type="pmid">17203830</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref021">
<label>21</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Boron</surname> <given-names>W</given-names></name>, <name name-style="western"><surname>Boulpaep</surname> <given-names>E</given-names></name>. <article-title>Medical physiology</article-title>. <source>Philadelphia: Saunders Google Scholar</source>. <year>2003</year>.</mixed-citation>
</ref>
<ref id="pcbi.1007073.ref022">
<label>22</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Formaggia</surname> <given-names>L</given-names></name>, <name name-style="western"><surname>Gerbeau</surname> <given-names>JF</given-names></name>, <name name-style="western"><surname>Nobile</surname> <given-names>F</given-names></name>, <name name-style="western"><surname>Quarteroni</surname> <given-names>A</given-names></name>. <article-title>On the coupling of 3D and 1D Navier–Stokes equations for flow problems in compliant vessels</article-title>. <source>Computer Methods in Applied Mechanics and Engineering</source>. <year>2001</year>;<volume>191</volume>(<issue>6</issue>):<fpage>561</fpage>–<lpage>582</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/S0045-7825(01)00302-4" xlink:type="simple">10.1016/S0045-7825(01)00302-4</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref023">
<label>23</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>D’Agostino</surname> <given-names>E</given-names></name>, <name name-style="western"><surname>Maes</surname> <given-names>F</given-names></name>, <name name-style="western"><surname>Vandermeulen</surname> <given-names>D</given-names></name>, <name name-style="western"><surname>Suetens</surname> <given-names>P</given-names></name>. <article-title>A viscous fluid model for multimodal non-rigid image registration using mutual information</article-title>. <source>Med Image Anal</source>. <year>2003</year>;<volume>7</volume>(<issue>4</issue>):<fpage>565</fpage>–<lpage>575</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/S1361-8415(03)00039-2" xlink:type="simple">10.1016/S1361-8415(03)00039-2</ext-link></comment> <object-id pub-id-type="pmid">14561559</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref024">
<label>24</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Blanco</surname> <given-names>P</given-names></name>, <name name-style="western"><surname>Feijóo</surname> <given-names>R</given-names></name>, <name name-style="western"><surname>Urquiza</surname> <given-names>S</given-names></name>. <article-title>A unified variational approach for coupling 3D–1D models and its blood flow applications</article-title>. <source>Computer Methods in Applied Mechanics and Engineering</source>. <year>2007</year>;<volume>196</volume>(<issue>41-44</issue>):<fpage>4391</fpage>–<lpage>4410</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.cma.2007.05.008" xlink:type="simple">10.1016/j.cma.2007.05.008</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref025">
<label>25</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Sutera</surname> <given-names>SP</given-names></name>, <name name-style="western"><surname>Skalak</surname> <given-names>R</given-names></name>. <article-title>The history of Poiseuille’s law</article-title>. <source>Annual Review of Fluid Mechanics</source>. <year>1993</year>;<volume>25</volume>(<issue>1</issue>):<fpage>1</fpage>–<lpage>20</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1007073.ref026">
<label>26</label>
<mixed-citation publication-type="book" xlink:type="simple">
<name name-style="western"><surname>Ku</surname> <given-names>MC</given-names></name>, <name name-style="western"><surname>Waiczies</surname> <given-names>S</given-names></name>, <name name-style="western"><surname>Niendorf</surname> <given-names>T</given-names></name>, <name name-style="western"><surname>Pohlmann</surname> <given-names>A</given-names></name>. <chapter-title>Assessment of blood brain barrier leakage with gadolinium-enhanced MRI</chapter-title>. In: <source>Preclinical MRI</source>. <publisher-name>Springer</publisher-name>; <year>2018</year>. p. <fpage>395</fpage>–<lpage>408</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1007073.ref027">
<label>27</label>
<mixed-citation publication-type="book" xlink:type="simple">
<name name-style="western"><surname>Cohnheim</surname> <given-names>J</given-names></name>. <source>Untersuchungen über die embolischen Processe</source>. <publisher-name>A. Hirschwald</publisher-name>; <year>1872</year>.</mixed-citation>
</ref>
<ref id="pcbi.1007073.ref028">
<label>28</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Nishimura</surname> <given-names>DG</given-names></name>. <article-title>Time-of-flight MR angiography</article-title>. <source>Magnetic Resonance in Medicine</source>. <year>1990</year>;<volume>14</volume>:<fpage>194</fpage>–<lpage>201</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1002/mrm.1910140206" xlink:type="simple">10.1002/mrm.1910140206</ext-link></comment> <object-id pub-id-type="pmid">2345502</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref029">
<label>29</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Atkinson</surname> <given-names>D</given-names></name>, <name name-style="western"><surname>Brant-Zawadzki</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Gillan</surname> <given-names>G</given-names></name>, <name name-style="western"><surname>Purdy</surname> <given-names>D</given-names></name>, <name name-style="western"><surname>Laub</surname> <given-names>G</given-names></name>. <article-title>Improved MR angiography: magnetization transfer suppression with variable flip angle excitation and increased resolution</article-title>. <source>Radiology</source>. <year>1994</year>;<volume>190</volume>(<issue>3</issue>):<fpage>890</fpage>–<lpage>894</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1007073.ref030">
<label>30</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Parker</surname> <given-names>DL</given-names></name>, <name name-style="western"><surname>Yuan</surname> <given-names>C</given-names></name>, <name name-style="western"><surname>Blatter</surname> <given-names>DD</given-names></name>. <article-title>MR angiography by multiple thin slab 3D acquisition</article-title>. <source>Magnetic Resonance in Medicine</source>. <year>1991</year>;<volume>17</volume>(<issue>2</issue>):<fpage>434</fpage>–<lpage>451</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1002/mrm.1910170215" xlink:type="simple">10.1002/mrm.1910170215</ext-link></comment> <object-id pub-id-type="pmid">2062215</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref031">
<label>31</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Reichenbach</surname> <given-names>JR</given-names></name>. <article-title>The future of susceptibility contrast for assessment of anatomy and function</article-title>. <source>Neuroimage</source>. <year>2012</year>;<volume>62</volume>(<issue>2</issue>):<fpage>1311</fpage>–<lpage>1315</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.neuroimage.2012.01.004" xlink:type="simple">10.1016/j.neuroimage.2012.01.004</ext-link></comment> <object-id pub-id-type="pmid">22245644</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref032">
<label>32</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Deistung</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Schweser</surname> <given-names>F</given-names></name>, <name name-style="western"><surname>Reichenbach</surname> <given-names>JR</given-names></name>. <article-title>Overview of quantitative susceptibility mapping</article-title>. <source>NMR Biomed</source>. <year>2017</year>;<volume>30</volume>(<issue>4</issue>):<fpage>e3569</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1002/nbm.3569" xlink:type="simple">10.1002/nbm.3569</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref033">
<label>33</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Deistung</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Dittrich</surname> <given-names>E</given-names></name>, <name name-style="western"><surname>Sedlacik</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Rauscher</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Reichenbach</surname> <given-names>JR</given-names></name>. <article-title>ToF-SWI: simultaneous time of flight and fully flow compensated susceptibility weighted imaging</article-title>. <source>Magnetic Resonance Imaging</source>. <year>2009</year>;<volume>29</volume>(<issue>6</issue>):<fpage>1478</fpage>–<lpage>1484</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1002/jmri.21673" xlink:type="simple">10.1002/jmri.21673</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref034">
<label>34</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Schweser</surname> <given-names>F</given-names></name>, <name name-style="western"><surname>Deistung</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Lehr</surname> <given-names>BW</given-names></name>, <name name-style="western"><surname>Reichenbach</surname> <given-names>JR</given-names></name>. <article-title>Quantitative imaging of intrinsic magnetic tissue properties using MRI signal phase: an approach to in vivo brain iron metabolism?</article-title> <source>Neuroimage</source>. <year>2011</year>;<volume>54</volume>:<fpage>2789</fpage>–<lpage>2807</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.neuroimage.2010.10.070" xlink:type="simple">10.1016/j.neuroimage.2010.10.070</ext-link></comment> <object-id pub-id-type="pmid">21040794</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref035">
<label>35</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Wu</surname> <given-names>B</given-names></name>, <name name-style="western"><surname>Li</surname> <given-names>W</given-names></name>, <name name-style="western"><surname>Guidon</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Liu</surname> <given-names>C</given-names></name>. <article-title>Whole brain susceptibility mapping using compressed sensing</article-title>. <source>Magnetic Resonance in Medicine</source>. <year>2012</year>;<volume>67</volume>:<fpage>137</fpage>–<lpage>147</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1002/mrm.23000" xlink:type="simple">10.1002/mrm.23000</ext-link></comment> <object-id pub-id-type="pmid">21671269</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref036">
<label>36</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Schweser</surname> <given-names>F</given-names></name>, <name name-style="western"><surname>Sommer</surname> <given-names>K</given-names></name>, <name name-style="western"><surname>Deistung</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Reichenbach</surname> <given-names>JR</given-names></name>. <article-title>Quantitative susceptibility mapping for investigating subtle susceptibility variations in the human brain</article-title>. <source>Neuroimage</source>. <year>2012</year>;<volume>62</volume>:<fpage>2083</fpage>–<lpage>2100</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.neuroimage.2012.05.067" xlink:type="simple">10.1016/j.neuroimage.2012.05.067</ext-link></comment> <object-id pub-id-type="pmid">22659482</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref037">
<label>37</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Dale</surname> <given-names>AM</given-names></name>, <name name-style="western"><surname>Fischl</surname> <given-names>B</given-names></name>, <name name-style="western"><surname>Sereno</surname> <given-names>MI</given-names></name>. <article-title>Cortical surface-based analysis. I. Segmentation and surface reconstruction</article-title>. <source>Neuroimage</source>. <year>1999</year>;<volume>9</volume>(<issue>2</issue>):<fpage>179</fpage>–<lpage>194</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1006/nimg.1998.0395" xlink:type="simple">10.1006/nimg.1998.0395</ext-link></comment> <object-id pub-id-type="pmid">9931268</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref038">
<label>38</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Sethian</surname> <given-names>JA</given-names></name>. <article-title>A fast marching level set method for monotonically advancing fronts</article-title>. <source>Proceedings of the National Academy of Sciences</source>. <year>1996</year>;<volume>93</volume>(<issue>4</issue>):<fpage>1591</fpage>–<lpage>1595</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1073/pnas.93.4.1591" xlink:type="simple">10.1073/pnas.93.4.1591</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref039">
<label>39</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Darcy</surname> <given-names>H</given-names></name>. <article-title>Les Fontaines Publiques de la Ville de Dijon</article-title>. <source>Victor Dalmont</source>. <year>1856</year>.</mixed-citation>
</ref>
<ref id="pcbi.1007073.ref040">
<label>40</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Bryan</surname> <given-names>RM</given-names> <suffix>Jr</suffix></name>, <name name-style="western"><surname>Marrelli</surname> <given-names>SP</given-names></name>, <name name-style="western"><surname>Steenberg</surname> <given-names>ML</given-names></name>, <name name-style="western"><surname>Schildmeyer</surname> <given-names>LA</given-names></name>, <name name-style="western"><surname>Johnson</surname> <given-names>TD</given-names></name>. <article-title>Effects of luminal shear stress on cerebral arteries and arterioles</article-title>. <source>American Journal of Physiology-Heart and Circulatory Physiology</source>. <year>2001</year>;<volume>280</volume>(<issue>5</issue>):<fpage>H2011</fpage>–<lpage>H2022</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1152/ajpheart.2001.280.5.H2011" xlink:type="simple">10.1152/ajpheart.2001.280.5.H2011</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref041">
<label>41</label>
<mixed-citation publication-type="book" xlink:type="simple">
<name name-style="western"><surname>White</surname> <given-names>FM</given-names></name>. <source>Fluid mechanics, chapter 6</source>. <publisher-name>McGraw-Hill</publisher-name>, <publisher-loc>New York, NY</publisher-loc>. <year>2003</year>; p. <fpage>366</fpage>–<lpage>376</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1007073.ref042">
<label>42</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Li</surname> <given-names>X</given-names></name>, <name name-style="western"><surname>Sarkar</surname> <given-names>SN</given-names></name>, <name name-style="western"><surname>Purdy</surname> <given-names>DE</given-names></name>, <name name-style="western"><surname>Briggs</surname> <given-names>RW</given-names></name>. <article-title>Quantifying cerebellum grey matter and white matter perfusion using pulsed arterial spin labeling</article-title>. <source>BioMed Research International</source>. <year>2014</year>;<volume>2014</volume>.</mixed-citation>
</ref>
<ref id="pcbi.1007073.ref043">
<label>43</label>
<mixed-citation publication-type="book" xlink:type="simple">
<name name-style="western"><surname>Aarnes</surname> <given-names>JE</given-names></name>, <name name-style="western"><surname>Gimse</surname> <given-names>T</given-names></name>, <name name-style="western"><surname>Lie</surname> <given-names>KA</given-names></name>. <chapter-title>An introduction to the numerics of flow in porous media using Matlab</chapter-title>. In: <source>Geometric modelling, numerical simulation, and optimization</source>. <publisher-loc>Springer</publisher-loc>; <year>2007</year>. p. <fpage>265</fpage>–<lpage>306</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1007073.ref044">
<label>44</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Saad</surname> <given-names>Y</given-names></name>, <name name-style="western"><surname>Schultz</surname> <given-names>MH</given-names></name>. <article-title>GMRES: A generalized minimal residual algorithm for solving nonsymmetric linear systems</article-title>. <source>SIAM Journal on scientific and statistical computing</source>. <year>1986</year>;<volume>7</volume>(<issue>3</issue>):<fpage>856</fpage>–<lpage>869</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1137/0907058" xlink:type="simple">10.1137/0907058</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref045">
<label>45</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Wu</surname> <given-names>O</given-names></name>, <name name-style="western"><surname>Østergaard</surname> <given-names>L</given-names></name>, <name name-style="western"><surname>M</surname> <given-names>WR</given-names></name>, <name name-style="western"><surname>T</surname> <given-names>B</given-names></name>, <name name-style="western"><surname>R</surname> <given-names>RB</given-names></name>, <name name-style="western"><surname>G</surname> <given-names>SA</given-names></name>. <article-title>Tracer arrival timing-insensitive technique for estimating flow in MR perfusion-weighted imaging using singular value decomposition with a block-circulant deconvolution matrix</article-title>. <source>Magn Reson Med</source>. <year>2003</year>;<volume>50</volume>(<issue>1</issue>):<fpage>164</fpage>–<lpage>74</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1002/mrm.10522" xlink:type="simple">10.1002/mrm.10522</ext-link></comment> <object-id pub-id-type="pmid">12815691</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref046">
<label>46</label>
<mixed-citation publication-type="book" xlink:type="simple">
<name name-style="western"><surname>Purves</surname> <given-names>WK</given-names></name>, <name name-style="western"><surname>Orians</surname> <given-names>G</given-names></name>, <name name-style="western"><surname>Heller</surname> <given-names>H</given-names></name>, <name name-style="western"><surname>Sadava</surname> <given-names>D</given-names></name>. <source>Life, the Science of Biology</source>, <edition>7th</edition>. <publisher-loc>Sunderland, Mass</publisher-loc>: <publisher-name>Sinauer Associates</publisher-name>. <year>2004</year>;<fpage>954</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1007073.ref047">
<label>47</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Hodneland</surname> <given-names>E</given-names></name>, <name name-style="western"><surname>Hanson</surname> <given-names>E</given-names></name>, <name name-style="western"><surname>Munthe-Kaas</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Lundervold</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Nordbotten</surname> <given-names>J</given-names></name>. <article-title>Physical models for simulation and reconstruction of human tissue deformation fields in dynamic MRI</article-title>. <source>IEEE Transactions on Biomedical Engineering</source>. <year>2016</year>;<volume>63</volume>(<issue>10</issue>):<fpage>2200</fpage>–<lpage>2210</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1109/TBME.2015.2514262" xlink:type="simple">10.1109/TBME.2015.2514262</ext-link></comment> <object-id pub-id-type="pmid">26742122</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref048">
<label>48</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Sourbron</surname> <given-names>SP</given-names></name>, <name name-style="western"><surname>Michaely</surname> <given-names>HJ</given-names></name>, <name name-style="western"><surname>Reiser</surname> <given-names>MF</given-names></name>, <name name-style="western"><surname>Schoenberg</surname> <given-names>SO</given-names></name>. <article-title>MRI-measurement of perfusion and glomerular filtration in the human kidney with a separable compartment model</article-title>. <source>Invest Radiol</source>. <year>2008</year>;<volume>43</volume>(<issue>1</issue>):<fpage>40</fpage>–<lpage>48</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1097/RLI.0b013e31815597c5" xlink:type="simple">10.1097/RLI.0b013e31815597c5</ext-link></comment> <object-id pub-id-type="pmid">18097276</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref049">
<label>49</label>
<mixed-citation publication-type="book" xlink:type="simple">
<name name-style="western"><surname>Boron</surname> <given-names>W</given-names></name>, <name name-style="western"><surname>Boulpaep</surname> <given-names>E</given-names></name>. <source>Medical Physiology</source>. <publisher-name>Elsevier</publisher-name>; <year>2016</year>.</mixed-citation>
</ref>
<ref id="pcbi.1007073.ref050">
<label>50</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>WD</surname> <given-names>O</given-names></name>, <name name-style="western"><surname>TW</surname> <given-names>L</given-names></name>, <name name-style="western"><surname>JL</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>J</surname> <given-names>C</given-names></name>, <name name-style="western"><surname>TA</surname> <given-names>G</given-names></name>. <article-title>Cerebral blood flow and metabolism in comatose patients with acute head injury: relationship to intracranial hypertension</article-title>. <source>J Neurosurg</source>. <year>1984</year>;<volume>61</volume>(<issue>2</issue>):<fpage>241</fpage>–<lpage>53</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.3171/jns.1984.61.2.0241" xlink:type="simple">10.3171/jns.1984.61.2.0241</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref051">
<label>51</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Wiedeman</surname> <given-names>MP</given-names></name>. <article-title>Dimensions of Blood Vessels from Distributing Artery to Collecting Vein</article-title>. <source>Circulation Research</source>. <year>1963</year>;<volume>12</volume>:<fpage>375</fpage>–<lpage>378</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1161/01.RES.12.4.375" xlink:type="simple">10.1161/01.RES.12.4.375</ext-link></comment> <object-id pub-id-type="pmid">14000509</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref052">
<label>52</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Patel</surname> <given-names>D</given-names></name>, <name name-style="western"><surname>Šoltészová</surname> <given-names>V</given-names></name>, <name name-style="western"><surname>Nordbotten</surname> <given-names>JM</given-names></name>, <name name-style="western"><surname>Bruckner</surname> <given-names>S</given-names></name>. <article-title>Instant convolution shadows for volumetric detail mapping</article-title>. <source>ACM Transactions on Graphics (TOG)</source>. <year>2013</year>;<volume>32</volume>(<issue>5</issue>):<fpage>154</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1145/2492684" xlink:type="simple">10.1145/2492684</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref053">
<label>53</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Peyrounette</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Davit</surname> <given-names>Y</given-names></name>, <name name-style="western"><surname>Quintard</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Lorthois</surname> <given-names>S</given-names></name>. <article-title>Multiscale modelling of blood flow in cerebral microcirculation: Details at capillary scale control accuracy at the level of the cortex</article-title>. <source>PloS one</source>. <year>2018</year>;<volume>13</volume>(<issue>1</issue>):<fpage>e0189474</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1371/journal.pone.0189474" xlink:type="simple">10.1371/journal.pone.0189474</ext-link></comment> <object-id pub-id-type="pmid">29324784</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref054">
<label>54</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Ibaraki</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Ito</surname> <given-names>H</given-names></name>, <name name-style="western"><surname>Shimosegawa</surname> <given-names>E</given-names></name>, <name name-style="western"><surname>Toyoshima</surname> <given-names>H</given-names></name>, <name name-style="western"><surname>Ishigame</surname> <given-names>K</given-names></name>, <name name-style="western"><surname>Takahashi</surname> <given-names>K</given-names></name>, <etal>et al</etal>. <article-title>Cerebral vascular mean transit time in healthy humans: a comparative study with PET and dynamic susceptibility contrast-enhanced MRI</article-title>. <source>Journal of Cerebral Blood Flow &amp; Metabolism</source>. <year>2007</year>;<volume>27</volume>(<issue>2</issue>):<fpage>404</fpage>–<lpage>413</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1038/sj.jcbfm.9600337" xlink:type="simple">10.1038/sj.jcbfm.9600337</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref055">
<label>55</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Roberts</surname> <given-names>D</given-names></name>, <name name-style="western"><surname>Detre</surname> <given-names>JA</given-names></name>, <name name-style="western"><surname>Bolinger</surname> <given-names>L</given-names></name>, <name name-style="western"><surname>Insko</surname> <given-names>EK</given-names></name>, <name name-style="western"><surname>Leigh</surname> <given-names>JS</given-names></name>. <article-title>Quantitative magnetic resonance imaging of human brain perfusion at 1.5 T using steady-state inversion of arterial water</article-title>. <source>Proceedings of the National Academy of Sciences</source>. <year>1994</year>;<volume>91</volume>(<issue>1</issue>):<fpage>33</fpage>–<lpage>37</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1073/pnas.91.1.33" xlink:type="simple">10.1073/pnas.91.1.33</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref056">
<label>56</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Ingrisch</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Sourbron</surname> <given-names>S</given-names></name>. <article-title>Tracer-kinetic modeling of dynamic contrast-enhanced MRI and CT: a primer</article-title>. <source>Journal of pharmacokinetics and pharmacodynamics</source>. <year>2013</year>;<volume>40</volume>(<issue>3</issue>):<fpage>281</fpage>–<lpage>300</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1007/s10928-013-9315-3" xlink:type="simple">10.1007/s10928-013-9315-3</ext-link></comment> <object-id pub-id-type="pmid">23563847</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref057">
<label>57</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Aanonsen</surname> <given-names>SI</given-names></name>, <name name-style="western"><surname>Nævdal</surname> <given-names>G</given-names></name>, <name name-style="western"><surname>Oliver</surname> <given-names>DS</given-names></name>, <name name-style="western"><surname>Reynolds</surname> <given-names>AC</given-names></name>, <name name-style="western"><surname>Vallès</surname> <given-names>B</given-names></name>. <article-title>The ensemble Kalman filter in reservoir engineering–a review</article-title>. <source>Spe Journal</source>. <year>2009</year>;<volume>14</volume>(<issue>03</issue>):<fpage>393</fpage>–<lpage>412</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.2118/117274-PA" xlink:type="simple">10.2118/117274-PA</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref058">
<label>58</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Nævdal</surname> <given-names>G</given-names></name>, <name name-style="western"><surname>Sævareid</surname> <given-names>O</given-names></name>, <name name-style="western"><surname>Lorentzen</surname> <given-names>RJ</given-names></name>. <article-title>Data assimilation using MRI data</article-title>. <source>Proceedings, VII European Congress on Computational Methods in Applied Sciences and Engineering</source>. <year>2016</year>.</mixed-citation>
</ref>
<ref id="pcbi.1007073.ref059">
<label>59</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Passerini</surname> <given-names>T</given-names></name>, <name name-style="western"><surname>Luca</surname> <given-names>Md</given-names></name>, <name name-style="western"><surname>Formaggia</surname> <given-names>L</given-names></name>, <name name-style="western"><surname>Quarteroni</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Veneziani</surname> <given-names>A</given-names></name>. <article-title>A 3D/1D geometrical multiscale model of cerebral vasculature</article-title>. <source>Journal of Engineering Mathematics</source>. <year>2009</year>;<volume>64</volume>(<issue>4</issue>):<fpage>319</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1007/s10665-009-9281-3" xlink:type="simple">10.1007/s10665-009-9281-3</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref060">
<label>60</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Blanco</surname> <given-names>PJ</given-names></name>, <name name-style="western"><surname>Feijóo</surname> <given-names>RA</given-names></name>. <article-title>The role of the variational formulation in the dimensionally-heterogeneous modelling of the human cardiovascular system</article-title>. <source>Modeling of Physiological Flows</source>. <year>2012</year>;<volume>5</volume>:<fpage>251</fpage>–<lpage>288</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1007/978-88-470-1935-5_9" xlink:type="simple">10.1007/978-88-470-1935-5_9</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref061">
<label>61</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Apel</surname> <given-names>T</given-names></name>, <name name-style="western"><surname>Pfefferer</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>R¨osch</surname> <given-names>A</given-names></name>. <article-title>Finite element error estimates for Neumann boundary control problems on graded meshes</article-title>. <source>Comput Optim Appl</source>. <year>2012</year>;<volume>52</volume>:<fpage>3</fpage>–<lpage>28</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1007/s10589-011-9427-x" xlink:type="simple">10.1007/s10589-011-9427-x</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref062">
<label>62</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Koppl</surname> <given-names>T</given-names></name>, <name name-style="western"><surname>Wohlmuth</surname> <given-names>B</given-names></name>. <article-title>Optimal a priori error estimates for an elliptic problem with Dirac right-hand side</article-title>. <source>SIAM Journal on Numerical Analysis</source>. <year>2014</year>;<volume>52</volume>(<issue>4</issue>):<fpage>1753</fpage>–<lpage>1769</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1137/130927619" xlink:type="simple">10.1137/130927619</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref063">
<label>63</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Silling</surname> <given-names>SA</given-names></name>. <article-title>Reformulation of elasticity theory for discontinuities and long-range forces</article-title>. <source>Journal of the Mechanics and Physics of Solids</source>. <year>2000</year>;<volume>48</volume>(<issue>1</issue>):<fpage>175</fpage>–<lpage>209</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/S0022-5096(99)00029-0" xlink:type="simple">10.1016/S0022-5096(99)00029-0</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref064">
<label>64</label>
<mixed-citation publication-type="other" xlink:type="simple">Kociński M, Materka A, Deistung A, Reichenbach J, Lundervold A. Towards multi-scale personalized modeling of brain vasculature based on magnetic resonance image processing. In: 2017 International Conference on Systems, Signals and Image Processing (IWSSIP). I; 2017. p. 1–5.</mixed-citation>
</ref>
<ref id="pcbi.1007073.ref065">
<label>65</label>
<mixed-citation publication-type="other" xlink:type="simple">Caldeira L, Silva I, Sanches J. Automatic liver tumor diagnosis with Dynamic-Contrast Enhanced MRI. In: Proc. 15th IEEE Int. Conf. Image Processing; 2008. p. 2256–2259.</mixed-citation>
</ref>
<ref id="pcbi.1007073.ref066">
<label>66</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Michler</surname> <given-names>C</given-names></name>, <name name-style="western"><surname>Cookson</surname> <given-names>AN</given-names></name>, <name name-style="western"><surname>Chabiniok</surname> <given-names>R</given-names></name>, <name name-style="western"><surname>Hyde</surname> <given-names>E</given-names></name>, <name name-style="western"><surname>Lee</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Sinclair</surname> <given-names>M</given-names></name>, <etal>et al</etal>. <article-title>A computationally efficient framework for the simulation of cardiac perfusion using a multi-compartment Darcy porous-media flow model</article-title>. <source>International journal for numerical methods in biomedical engineering</source>. <year>2013</year>;<volume>29</volume>:<fpage>217</fpage>–<lpage>232</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1002/cnm.2520" xlink:type="simple">10.1002/cnm.2520</ext-link></comment> <object-id pub-id-type="pmid">23345266</object-id></mixed-citation>
</ref>
<ref id="pcbi.1007073.ref067">
<label>67</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Linninger</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Gould</surname> <given-names>I</given-names></name>, <name name-style="western"><surname>Marinnan</surname> <given-names>T</given-names></name>, <name name-style="western"><surname>Hsu</surname> <given-names>CY</given-names></name>, <name name-style="western"><surname>Chojecki</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Alaraj</surname> <given-names>A</given-names></name>. <article-title>Cerebral microcirculation and oxygen tension in the human secondary cortex</article-title>. <source>Annals of biomedical engineering</source>. <year>2013</year>;<volume>41</volume>(<issue>11</issue>):<fpage>2264</fpage>–<lpage>2284</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1007/s10439-013-0828-0" xlink:type="simple">10.1007/s10439-013-0828-0</ext-link></comment> <object-id pub-id-type="pmid">23842693</object-id></mixed-citation>
</ref>
</ref-list>
</back>
</article>