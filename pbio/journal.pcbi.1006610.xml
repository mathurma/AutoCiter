<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="1.1d3" xml:lang="en">
<front>
<journal-meta>
<journal-id journal-id-type="nlm-ta">PLoS Comput Biol</journal-id>
<journal-id journal-id-type="publisher-id">plos</journal-id>
<journal-id journal-id-type="pmc">ploscomp</journal-id>
<journal-title-group>
<journal-title>PLOS Computational Biology</journal-title>
</journal-title-group>
<issn pub-type="ppub">1553-734X</issn>
<issn pub-type="epub">1553-7358</issn>
<publisher>
<publisher-name>Public Library of Science</publisher-name>
<publisher-loc>San Francisco, CA USA</publisher-loc>
</publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="publisher-id">PCOMPBIOL-D-18-00247</article-id>
<article-id pub-id-type="doi">10.1371/journal.pcbi.1006610</article-id>
<article-categories>
<subj-group subj-group-type="heading">
<subject>Research Article</subject>
</subj-group>
<subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Anatomy</subject><subj-group><subject>Histology</subject></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Medicine and health sciences</subject><subj-group><subject>Anatomy</subject><subj-group><subject>Histology</subject></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Physical sciences</subject><subj-group><subject>Physics</subject><subj-group><subject>Classical mechanics</subject><subj-group><subject>Deformation</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Physical sciences</subject><subj-group><subject>Physics</subject><subj-group><subject>Classical mechanics</subject><subj-group><subject>Damage mechanics</subject><subj-group><subject>Deformation</subject></subj-group></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Medicine and health sciences</subject><subj-group><subject>Diagnostic medicine</subject><subj-group><subject>Diagnostic radiology</subject><subj-group><subject>Magnetic resonance imaging</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Research and analysis methods</subject><subj-group><subject>Imaging techniques</subject><subj-group><subject>Diagnostic radiology</subject><subj-group><subject>Magnetic resonance imaging</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Medicine and health sciences</subject><subj-group><subject>Radiology and imaging</subject><subj-group><subject>Diagnostic radiology</subject><subj-group><subject>Magnetic resonance imaging</subject></subj-group></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Research and analysis methods</subject><subj-group><subject>Specimen preparation and treatment</subject><subj-group><subject>Specimen sectioning</subject></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Research and analysis methods</subject><subj-group><subject>Imaging techniques</subject><subj-group><subject>Fluorescence imaging</subject></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Neuroscience</subject><subj-group><subject>Brain mapping</subject></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Research and analysis methods</subject><subj-group><subject>Imaging techniques</subject><subj-group><subject>Neuroimaging</subject></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Biology and life sciences</subject><subj-group><subject>Neuroscience</subject><subj-group><subject>Neuroimaging</subject></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v3"><subject>Physical sciences</subject><subj-group><subject>Mathematics</subject><subj-group><subject>Optimization</subject></subj-group></subj-group></subj-group></article-categories>
<title-group>
<article-title>On variational solutions for whole brain serial-section histology using a Sobolev prior in the computational anatomy random orbit model</article-title>
<alt-title alt-title-type="running-head">Variational solutions for informed reconstruction and registration of histology</alt-title>
</title-group>
<contrib-group>
<contrib contrib-type="author" corresp="yes" xlink:type="simple">
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-1849-5801</contrib-id>
<name name-style="western">
<surname>Lee</surname> <given-names>Brian C.</given-names></name>
<role content-type="http://credit.casrai.org/">Conceptualization</role>
<role content-type="http://credit.casrai.org/">Formal analysis</role>
<role content-type="http://credit.casrai.org/">Methodology</role>
<role content-type="http://credit.casrai.org/">Software</role>
<role content-type="http://credit.casrai.org/">Validation</role>
<role content-type="http://credit.casrai.org/">Writing – original draft</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff001"><sup>1</sup></xref>
<xref ref-type="corresp" rid="cor001">*</xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-4607-6807</contrib-id>
<name name-style="western">
<surname>Tward</surname> <given-names>Daniel J.</given-names></name>
<role content-type="http://credit.casrai.org/">Conceptualization</role>
<role content-type="http://credit.casrai.org/">Software</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff001"><sup>1</sup></xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<name name-style="western">
<surname>Mitra</surname> <given-names>Partha P.</given-names></name>
<role content-type="http://credit.casrai.org/">Conceptualization</role>
<role content-type="http://credit.casrai.org/">Resources</role>
<role content-type="http://credit.casrai.org/">Supervision</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff002"><sup>2</sup></xref>
</contrib>
<contrib contrib-type="author" xlink:type="simple">
<name name-style="western">
<surname>Miller</surname> <given-names>Michael I.</given-names></name>
<role content-type="http://credit.casrai.org/">Conceptualization</role>
<role content-type="http://credit.casrai.org/">Formal analysis</role>
<role content-type="http://credit.casrai.org/">Supervision</role>
<role content-type="http://credit.casrai.org/">Writing – review &amp; editing</role>
<xref ref-type="aff" rid="aff001"><sup>1</sup></xref>
</contrib>
</contrib-group>
<aff id="aff001">
<label>1</label>
<addr-line>Center for Imaging Science, Department of Biomedical Engineering, Johns Hopkins University, Baltimore, MD, USA</addr-line>
</aff>
<aff id="aff002">
<label>2</label>
<addr-line>Cold Spring Harbor Laboratory, Cold Spring Harbor, NY, USA</addr-line>
</aff>
<contrib-group>
<contrib contrib-type="editor" xlink:type="simple">
<name name-style="western">
<surname>Gee</surname> <given-names>James C</given-names></name>
<role>Editor</role>
<xref ref-type="aff" rid="edit1"/>
</contrib>
</contrib-group>
<aff id="edit1">
<addr-line>University of Pennsylvania, UNITED STATES</addr-line>
</aff>
<author-notes>
<fn fn-type="conflict" id="coi001">
<p>Michael I. Miller reports personal fees from AnatomyWorks, LLC, outside the submitted work and jointly owns AnatomyWorks. This arrangement is being managed by the Johns Hopkins University in accordance with its conflict of interest policies. Michael I Miller’s relationship with AnatomyWorks is being handled under full disclosure by the Johns Hopkins University.</p>
</fn>
<corresp id="cor001">* E-mail: <email xlink:type="simple">blee105@jhu.edu</email></corresp>
</author-notes>
<pub-date pub-type="collection">
<month>12</month>
<year>2018</year>
</pub-date>
<pub-date pub-type="epub">
<day>26</day>
<month>12</month>
<year>2018</year>
</pub-date>
<volume>14</volume>
<issue>12</issue>
<elocation-id>e1006610</elocation-id>
<history>
<date date-type="received">
<day>10</day>
<month>2</month>
<year>2018</year>
</date>
<date date-type="accepted">
<day>27</day>
<month>10</month>
<year>2018</year>
</date>
</history>
<permissions>
<copyright-year>2018</copyright-year>
<copyright-holder>Lee et al</copyright-holder>
<license xlink:href="http://creativecommons.org/licenses/by/4.0/" xlink:type="simple">
<license-p>This is an open access article distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/" xlink:type="simple">Creative Commons Attribution License</ext-link>, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p>
</license>
</permissions>
<self-uri content-type="pdf" xlink:href="info:doi/10.1371/journal.pcbi.1006610"/>
<abstract>
<p>This paper presents a variational framework for dense diffeomorphic atlas-mapping onto high-throughput histology stacks at the 20 μm meso-scale. The observed sections are modelled as Gaussian random fields conditioned on a sequence of unknown section by section rigid motions and unknown diffeomorphic transformation of a three-dimensional atlas. To regularize over the high-dimensionality of our parameter space (which is a product space of the rigid motion dimensions and the diffeomorphism dimensions), the histology stacks are modelled as arising from a first order Sobolev space smoothness prior. We show that the joint maximum a-posteriori, penalized-likelihood estimator of our high dimensional parameter space emerges as a joint optimization interleaving rigid motion estimation for histology restacking and large deformation diffeomorphic metric mapping to atlas coordinates. We show that joint optimization in this parameter space solves the classical curvature non-identifiability of the histology stacking problem. The algorithms are demonstrated on a collection of whole-brain histological image stacks from the Mouse Brain Architecture Project.</p>
</abstract>
<abstract abstract-type="summary">
<title>Author summary</title>
<p>New developments in neural tracing techniques have motivated the widespread use of histology as a modality for exploring the circuitry of the brain. Automated mapping of pre-labeled atlases onto modern large datasets of histological imagery is a critical step for elucidating the brain’s neural circuitry and shape. This task is challenging as histological sections are imaged independently and the reconstruction of the unsectioned volume is nontrivial. Typically, neuroanatomists use reference volumes of the same subject (e.g. MRI) to guide reconstruction. However, obtaining reference imagery is often non-standard, as in high-throughput animal models like mouse histology. Others have proposed using anatomical atlases as guides, but have not accounted for the intrinsic nonlinear shape difference from atlas to subject. Our method addresses these limitations by jointly optimizing reconstruction informed by an atlas simultaneously with the nonlinear change of coordinates that encapsulates anatomical variation. This accounts for intrinsic shape differences and enables rigorous, direct comparisons of atlas and subject coordinates. Using simulations, we demonstrate that our method recovers the reconstruction parameters more accurately than atlas-free models and innately produces accurate segmentations from simultaneous atlas mapping. We also demonstrate our method on the Mouse Brain Architecture dataset, successfully mapping and reconstructing over 1000 brains.</p>
</abstract>
<funding-group>
<award-group id="award001">
<funding-source>
<institution-wrap>
<institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/100000002</institution-id>
<institution>National Institutes of Health</institution>
</institution-wrap>
</funding-source>
<award-id>DA036400, P41-EB015909, R01-EB020062, R01-NS102670</award-id>
<principal-award-recipient>
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-1849-5801</contrib-id>
<name name-style="western">
<surname>Lee</surname> <given-names>Brian Curtis</given-names></name>
</principal-award-recipient>
</award-group>
<award-group id="award002">
<funding-source>
<institution-wrap>
<institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/100001229</institution-id>
<institution>G. Harold and Leila Y. Mathers Charitable Foundation</institution>
</institution-wrap>
</funding-source>
<principal-award-recipient>
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-1849-5801</contrib-id>
<name name-style="western">
<surname>Lee</surname> <given-names>Brian Curtis</given-names></name>
</principal-award-recipient>
</award-group>
<award-group id="award003">
<funding-source>
<institution>Crick-Clay Fellowship</institution>
</funding-source>
<principal-award-recipient>
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-1849-5801</contrib-id>
<name name-style="western">
<surname>Lee</surname> <given-names>Brian Curtis</given-names></name>
</principal-award-recipient>
</award-group>
<award-group id="award004">
<funding-source>
<institution-wrap>
<institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/100000001</institution-id>
<institution>National Science Foundation</institution>
</institution-wrap>
</funding-source>
<award-id>1450957</award-id>
<principal-award-recipient>
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-1849-5801</contrib-id>
<name name-style="western">
<surname>Lee</surname> <given-names>Brian Curtis</given-names></name>
</principal-award-recipient>
</award-group>
<award-group id="award005">
<funding-source>
<institution>XSEDE</institution>
</funding-source>
<award-id>ASC140026</award-id>
<principal-award-recipient>
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-1849-5801</contrib-id>
<name name-style="western">
<surname>Lee</surname> <given-names>Brian Curtis</given-names></name>
</principal-award-recipient>
</award-group>
<award-group id="award006">
<funding-source>
<institution-wrap>
<institution-id institution-id-type="funder-id">http://dx.doi.org/10.13039/100001201</institution-id>
<institution>Kavli Foundation</institution>
</institution-wrap>
</funding-source>
<principal-award-recipient>
<contrib-id authenticated="true" contrib-id-type="orcid">http://orcid.org/0000-0002-1849-5801</contrib-id>
<name name-style="western">
<surname>Lee</surname> <given-names>Brian Curtis</given-names></name>
</principal-award-recipient>
</award-group>
<funding-statement>This work was supported by NIH grants P41-EB015909, R01-EB020062, R01-NS102670, R01-MH105660, U19-AG033655, U19-MH114821, U01-MH114824, DA036400 (nih.gov), the G. Harold and Leila Y. Mathers Foundation (mathersfoundation.org), the Crick-Clay Fellowship at CSHL, the H.N. Mahabala Chair at IIT Madras, National Science Foundation Eager award 1450957 and 16-569 NeuroNex contract 1707298 (nsf.gov), the Computational Anatomy Science Gateway as part of the Extreme Science and Engineering Discovery Environment (XSEDE) grant ASC140026 (xsede.org), as well as the Kavli Neuroscience Discovery Institute supported by the Kavli Foundation (kavlifoundation.org). The funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.</funding-statement>
</funding-group>
<counts>
<fig-count count="10"/>
<table-count count="0"/>
<page-count count="20"/>
</counts>
<custom-meta-group>
<custom-meta>
<meta-name>PLOS Publication Stage</meta-name>
<meta-value>vor-update-to-uncorrected-proof</meta-value>
</custom-meta>
<custom-meta>
<meta-name>Publication Update</meta-name>
<meta-value>2019-01-08</meta-value>
</custom-meta>
<custom-meta id="data-availability">
<meta-name>Data Availability</meta-name>
<meta-value>All data, images, and graph data required to reproduce the results of the paper using the described method can be downloaded at <ext-link ext-link-type="uri" xlink:href="http://www.cis.jhu.edu/data.sets/mouse_histology/" xlink:type="simple">http://www.cis.jhu.edu/data.sets/mouse_histology/</ext-link>. The Allen Mouse Brain Atlas is a free open resource available for research use and has been cited per the Allen Institute’s guidelines.</meta-value>
</custom-meta>
</custom-meta-group>
</article-meta>
</front>
<body>
<sec id="sec001" sec-type="intro">
<title>Introduction</title>
<sec id="sec002">
<title>Mapping brain circuitry</title>
<p>Recent advances in brain imaging [<xref ref-type="bibr" rid="pcbi.1006610.ref001">1</xref>, <xref ref-type="bibr" rid="pcbi.1006610.ref002">2</xref>], methods to label neurons [<xref ref-type="bibr" rid="pcbi.1006610.ref003">3</xref>], and computational methods have brought about a new era of neuroanatomical research, with a focus on comprehensively mapping brain circuits [<xref ref-type="bibr" rid="pcbi.1006610.ref004">4</xref>]. Mapping whole-brain circuitry is important for three distinct reasons: scientific understanding of how the brain works, mechanistic understanding of neurological and neuropsychiatric disorders, and as a comparison point for artificial neural networks used in machine learning [<xref ref-type="bibr" rid="pcbi.1006610.ref005">5</xref>, <xref ref-type="bibr" rid="pcbi.1006610.ref006">6</xref>].</p>
<p>Circuit mapping is technique limited, and falls into three broad scales corresponding to distinct imaging modalities—indirect mapping at a macroscopic scale corresponding to MRI-based methods [<xref ref-type="bibr" rid="pcbi.1006610.ref007">7</xref>], and direct mapping at light (LM) and electron microscopic (EM) scales. For MRI and LM data, atlas mapping is an important step in the analysis. Several approaches exist for gathering LM data at the whole brain level [<xref ref-type="bibr" rid="pcbi.1006610.ref008">8</xref>–<xref ref-type="bibr" rid="pcbi.1006610.ref010">10</xref>]. For some of these approaches (two-photon serial block-face imaging, knife edge scanning microscopy and light sheet microscopy for cleared brains) two-dimensional (2D) optical sections are acquired in three-dimensional (3D) registry with each other, so that the only computational step required is 3D volumetric registration of the individual brain data set to a canonical atlas. However, for classical neurohistological approaches using tissue sectioning followed by histochemical processing, the 2D sections are gathered independently and each section can undergo an arbitrary rotation and translation compared to the block face. This may be considered a disadvantage of the classical neuroanatomical workflow, however the physical sectioning method followed by conventional histochemical analysis has certain important advantages. This allows for the full spectrum of histochemical stains, acquisition of physical sections for downstream molecular analyses, and processing for larger brains (upto and including whole human brains). Therefore it is necessary to perform an intermediate 2D to 3D registration step, where the individually acquired 2D sections are mutually co-registered into a 3D volume.</p>
<p>This paper develops a joint stack reconstruction and atlas mapping procedure that simultaneously restacks the 2D histology sections, applying a sequence of rigid motions to the sections, and estimates the diffeomorphic correspondence between the registered histology stack and the 3D atlas. We apply these algorithms to data sets from the Mouse Brain Architecture Project (MBAP), for which the experimental workflow generating the data utilizes a tape transfer technique [<xref ref-type="bibr" rid="pcbi.1006610.ref011">11</xref>], allowing for the sections to maintain geometrical rigidity within section and also allowing for physically disjoint components to maintain their spatial relations. The tape method ensures that the number of missing sections is minimal, with serial sections cut at a thickness of 20 μm and alternate sections subjected to Nissl staining alongside staining with histochemical or fluorescent label. These Nissl stained sections form the basis of alignment to a Nissl whole-brain reference atlas.</p>
</sec>
<sec id="sec003">
<title>Computational anatomy methods for brain histology</title>
<p>The histological reconstruction problem has been explored by several groups previously. Malandain first described the ill-posedness of reconstructing 3D sections and object curvature without prior knowledge of the shape of the object [<xref ref-type="bibr" rid="pcbi.1006610.ref012">12</xref>]. Rigid transformations for stack reconstruction have been estimated via block-matching of histological sections in [<xref ref-type="bibr" rid="pcbi.1006610.ref013">13</xref>], with point information based on landmarks introduced to guide volume reconstruction [<xref ref-type="bibr" rid="pcbi.1006610.ref014">14</xref>]. Dense external reference information such as MRI has been applied to guide reconstruction via registration of corresponding block-face photographs and for histology to MRI mapping [<xref ref-type="bibr" rid="pcbi.1006610.ref015">15</xref>, <xref ref-type="bibr" rid="pcbi.1006610.ref016">16</xref>].</p>
<p>The principal contribution of this work is to rigorously solve the problem when an external resource of identical geometry (such as an MRI of the same mouse) is not available, while accommodating for the innate anatomical variation from atlas to subject. The lack of a same-subject reference volume is often the standard in mouse brain histology and other large scale histology studies. This places us into the computational anatomy (CA) orbit problem for which constraints are inherited from an atlas that is diffeomorphic but not geometrically identical. With the availability of dense brain atlases at many resolution scales [<xref ref-type="bibr" rid="pcbi.1006610.ref017">17</xref>–<xref ref-type="bibr" rid="pcbi.1006610.ref020">20</xref>], methods to map atlas labels onto target coordinate systems are being ubiquitously deployed across neuroscience applications. Since Christensen’s early work [<xref ref-type="bibr" rid="pcbi.1006610.ref021">21</xref>], diffeomorphic transformation has become the de-facto standard as diffeomorphisms generate one-to-one and onto correspondences between coordinate systems. Herein we focus on the diffeomorphometry orbit model [<xref ref-type="bibr" rid="pcbi.1006610.ref022">22</xref>, <xref ref-type="bibr" rid="pcbi.1006610.ref023">23</xref>] of computational anatomy [<xref ref-type="bibr" rid="pcbi.1006610.ref024">24</xref>], where the space of dense volume imagery is modelled as a Riemannian orbit of an atlas under the diffeomorphism group. We use the large deformation diffeomorphic metric mapping (LDDMM) algorithm first derived for dense imagery by Beg [<xref ref-type="bibr" rid="pcbi.1006610.ref025">25</xref>] to retrieve the unknown high-dimensional reparameterization of the template coordinates.</p>
<p>Of course, for the histological stacking problem solved here, the interesting twist is the augmentation of the random orbit model with 3 rigid motion dimensions for each target section. At 20 μm, this implies as many as 500 sections augmenting the high-dimensionality of the diffeomorphism space to include as many as 1500 extra dimensions for planar rigid motions for restacking. Here lies the crux of the challenge. To accommodate the high-dimensionality of the unknown rigid motions, the space of stacked targets is modelled to have finite-squared energy Sobolev norm, which enters the problem as a prior distribution restricting the roughness of the allowed restacked volumes. The variational method jointly optimizes over the high-dimensional diffeomorphism associated to the atlas reparameterization and the high-dimensional concatenation of rigid motions associated to the target.</p>
</sec>
</sec>
<sec id="sec004" sec-type="materials|methods">
<title>Materials and methods</title>
<sec id="sec005">
<title>The log-likelihood model of the histology sectioning problem</title>
<p>
<xref ref-type="fig" rid="pcbi.1006610.g001">Fig 1</xref> shows the components of the model for the histology stacking problem. We define the mouse brain to be sectioned as a dense three-dimensional (3D) object <inline-formula id="pcbi.1006610.e001"><alternatives><graphic id="pcbi.1006610.e001g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e001" xlink:type="simple"/><mml:math display="inline" id="M1"><mml:mrow><mml:mi>I</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>,</mml:mo> <mml:mi>y</mml:mi> <mml:mo>,</mml:mo> <mml:mi>z</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>,</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>,</mml:mo> <mml:mi>y</mml:mi> <mml:mo>,</mml:mo> <mml:mi>z</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>∈</mml:mo> <mml:msup><mml:mi mathvariant="double-struck">R</mml:mi> <mml:mn>3</mml:mn></mml:msup></mml:mrow></mml:math></alternatives></inline-formula>, modelled to be a smooth deformation of a known, given template <italic>I</italic><sub>0</sub> so that <italic>I</italic> = <italic>I</italic><sub>0</sub> ∘ <italic>φ</italic><sup>−1</sup> for some invertible diffeomorphic transformation <italic>φ</italic>. The Allen Institute’s mouse brain atlas [<xref ref-type="bibr" rid="pcbi.1006610.ref026">26</xref>] (CCF 2017) is taken as the template. Distinct from volumetric imaging such as MRI which delivers a dense 3D metric of the brain, the histology procedure (bottom row, <xref ref-type="fig" rid="pcbi.1006610.g001">Fig 1</xref>) consisting of sectioning, staining, and imaging generates a jitter process which randomly translates and rotates the stack sections. Denote the rigid motions acting on the 2D sectioning planes <inline-formula id="pcbi.1006610.e002"><alternatives><graphic id="pcbi.1006610.e002g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e002" xlink:type="simple"/><mml:math display="inline" id="M2"><mml:mrow><mml:msub><mml:mi>R</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>:</mml:mo> <mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow> <mml:mn>2</mml:mn></mml:msup> <mml:mo>→</mml:mo> <mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow> <mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:math></alternatives></inline-formula>,
<disp-formula id="pcbi.1006610.e003"><alternatives><graphic id="pcbi.1006610.e003g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e003" xlink:type="simple"/><mml:math display="block" id="M3"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>R</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>,</mml:mo> <mml:mi>y</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:mo form="prefix">cos</mml:mo> <mml:msub><mml:mi>θ</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mi>x</mml:mi> <mml:mo>+</mml:mo> <mml:mo form="prefix">sin</mml:mo> <mml:msub><mml:mi>θ</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mi>y</mml:mi> <mml:mo>+</mml:mo> <mml:msubsup><mml:mi>t</mml:mi> <mml:mi>i</mml:mi> <mml:mi>x</mml:mi></mml:msubsup> <mml:mo>,</mml:mo> <mml:mo>−</mml:mo> <mml:mo form="prefix">sin</mml:mo> <mml:msub><mml:mi>θ</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mi>x</mml:mi> <mml:mo>+</mml:mo> <mml:mo form="prefix">cos</mml:mo> <mml:msub><mml:mi>θ</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mi>y</mml:mi> <mml:mo>+</mml:mo> <mml:msubsup><mml:mi>t</mml:mi> <mml:mi>i</mml:mi> <mml:mi>y</mml:mi></mml:msubsup> <mml:mo>)</mml:mo></mml:mrow> <mml:mspace width="4pt"/><mml:mo>,</mml:mo> <mml:mspace width="4pt"/><mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>,</mml:mo> <mml:mi>y</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>∈</mml:mo> <mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow> <mml:mn>2</mml:mn></mml:msup> <mml:mspace width="4pt"/><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(1)</label></disp-formula>
with <italic>θ</italic><sub><italic>i</italic></sub> the rotation angle and <inline-formula id="pcbi.1006610.e004"><alternatives><graphic id="pcbi.1006610.e004g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e004" xlink:type="simple"/><mml:math display="inline" id="M4"><mml:mrow><mml:mrow><mml:mo>(</mml:mo> <mml:msubsup><mml:mi>t</mml:mi> <mml:mi>i</mml:mi> <mml:mi>x</mml:mi></mml:msubsup> <mml:mo>,</mml:mo> <mml:msubsup><mml:mi>t</mml:mi> <mml:mi>i</mml:mi> <mml:mi>y</mml:mi></mml:msubsup> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>∈</mml:mo> <mml:msup><mml:mi mathvariant="double-struck">R</mml:mi> <mml:mn>2</mml:mn></mml:msup></mml:mrow></mml:math></alternatives></inline-formula> the translation vector in section <italic>i</italic>. The histology stack <inline-formula id="pcbi.1006610.e005"><alternatives><graphic id="pcbi.1006610.e005g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e005" xlink:type="simple"/><mml:math display="inline" id="M5"><mml:mrow><mml:msub><mml:mi>J</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>,</mml:mo> <mml:mi>y</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>,</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>,</mml:mo> <mml:mi>y</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>∈</mml:mo> <mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow> <mml:mn>2</mml:mn></mml:msup> <mml:mo>,</mml:mo> <mml:mi>i</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn> <mml:mo>,</mml:mo> <mml:mo>…</mml:mo> <mml:mo>,</mml:mo> <mml:mi>n</mml:mi></mml:mrow></mml:math></alternatives></inline-formula>, is a sequence of 2D image sections with jitter under smooth deformation of the atlas in noise:
<disp-formula id="pcbi.1006610.e006"><alternatives><graphic id="pcbi.1006610.e006g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e006" xlink:type="simple"/><mml:math display="block" id="M6"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>J</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>∘</mml:mo> <mml:msub><mml:mi>R</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>,</mml:mo> <mml:mi>y</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:msub><mml:mi>I</mml:mi> <mml:mn>0</mml:mn></mml:msub> <mml:mo>∘</mml:mo> <mml:msup><mml:mi>φ</mml:mi> <mml:mrow><mml:mo>−</mml:mo> <mml:mn>1</mml:mn></mml:mrow></mml:msup> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>,</mml:mo> <mml:mi>y</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>z</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>+</mml:mo> <mml:mi>n</mml:mi><mml:mi>o</mml:mi><mml:mi>i</mml:mi><mml:mi>s</mml:mi><mml:mi>e</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>,</mml:mo> <mml:mi>y</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>,</mml:mo> <mml:mspace width="4pt"/><mml:mspace width="4pt"/><mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>,</mml:mo> <mml:mi>y</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>∈</mml:mo> <mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow> <mml:mn>2</mml:mn></mml:msup> <mml:mspace width="4pt"/><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(2)</label></disp-formula></p>
<fig id="pcbi.1006610.g001" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1006610.g001</object-id>
<label>Fig 1</label>
<caption>
<title>The histological sectioning model.</title>
<p>The template <italic>I</italic><sub>0</sub>, the mouse brain in the orbit <inline-formula id="pcbi.1006610.e007"><alternatives><graphic id="pcbi.1006610.e007g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e007" xlink:type="simple"/><mml:math display="inline" id="M7"><mml:mrow><mml:mi>I</mml:mi> <mml:mo>∈</mml:mo> <mml:mi mathvariant="script">I</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> and observed histological sections <italic>J</italic><sub><italic>i</italic></sub>, <italic>i</italic> = 1, …, <italic>n</italic> are illustrated. The Sobolev image intensity prior and the shape prior are depicted in the top row. The model shows the template and mouse brain as elements of the same orbit <inline-formula id="pcbi.1006610.e008"><alternatives><graphic id="pcbi.1006610.e008g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e008" xlink:type="simple"/><mml:math display="inline" id="M8"><mml:mrow><mml:msub><mml:mi>I</mml:mi> <mml:mn>0</mml:mn></mml:msub> <mml:mo>,</mml:mo> <mml:mi>I</mml:mi> <mml:mo>∈</mml:mo> <mml:mi mathvariant="script">I</mml:mi></mml:mrow></mml:math></alternatives></inline-formula>, such that there exists diffeomorphism <italic>I</italic> = <italic>I</italic><sub>0</sub> ∘ <italic>φ</italic><sup>−1</sup>, <italic>φ</italic> ∈ <italic>Diff</italic>.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1006610.g001" xlink:type="simple"/>
</fig>
<p>Modeling the photographic noise as Gaussian and conditioning on the sequences of jitters <italic>R</italic><sub><italic>i</italic></sub>, <italic>i</italic> = 1, …, <italic>n</italic> and atlas deformation <italic>I</italic> = <italic>I</italic><sub>0</sub> ∘ <italic>φ</italic><sup>−1</sup>, <italic>φ</italic> ∈ <italic>Diff</italic>, the photographic sections <italic>J</italic><sub><italic>i</italic></sub> are a sequence of conditionally Gaussian random fields with log-likelihood
<disp-formula id="pcbi.1006610.e009"><alternatives><graphic id="pcbi.1006610.e009g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e009" xlink:type="simple"/><mml:math display="block" id="M9"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>ℓ</mml:mi> <mml:mo>(</mml:mo> <mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mi>R</mml:mi> <mml:mo>;</mml:mo> <mml:mi>J</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:mtd> <mml:mtd><mml:mo>=</mml:mo></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:munder><mml:mo>∑</mml:mo> <mml:mi>i</mml:mi></mml:munder> <mml:mo>(</mml:mo> <mml:mo>−</mml:mo> <mml:msub><mml:mi>α</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:msub><mml:mo>∫</mml:mo> <mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow> <mml:mn>2</mml:mn></mml:msup></mml:msub> <mml:msup><mml:mrow><mml:mo>|</mml:mo> <mml:msub><mml:mi>J</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>∘</mml:mo> <mml:msub><mml:mi>R</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>,</mml:mo> <mml:mi>y</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>−</mml:mo> <mml:msub><mml:mi>I</mml:mi> <mml:mn>0</mml:mn></mml:msub> <mml:mo>∘</mml:mo> <mml:msup><mml:mi>φ</mml:mi> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>,</mml:mo> <mml:mo>−</mml:mo> <mml:mn>1</mml:mn></mml:mrow></mml:msup> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>,</mml:mo> <mml:mi>y</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>z</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>|</mml:mo></mml:mrow> <mml:mn>2</mml:mn></mml:msup> <mml:mi>d</mml:mi> <mml:mi>x</mml:mi> <mml:mi>d</mml:mi> <mml:mi>y</mml:mi> <mml:mo>)</mml:mo> <mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(3)</label></disp-formula>
Here <italic>α</italic><sub><italic>i</italic></sub> is a weighting factor dependent on the noise of each section such that damaged sections can be weighted; <italic>v</italic> denotes the vector field which indexes the deformation as a diffeomorphic flow (see below).</p>
</sec>
<sec id="sec006">
<title>The priors: Diffeomorphisms and Sobolev smoothness of images</title>
<p>The parameterization of the histology pipeline augments the standard random orbit model of computational anatomy with the rigid-motion dimensions of the random jitter sectioning process. The unknowns to be estimated become <inline-formula id="pcbi.1006610.e010"><alternatives><graphic id="pcbi.1006610.e010g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e010" xlink:type="simple"/><mml:math display="inline" id="M10"><mml:mrow><mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>R</mml:mi> <mml:mn>1</mml:mn></mml:msub> <mml:mo>,</mml:mo> <mml:mo>…</mml:mo> <mml:mo>,</mml:mo> <mml:msub><mml:mi>R</mml:mi> <mml:mi>n</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:mi>φ</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>∈</mml:mo> <mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow> <mml:mrow><mml:mn>3</mml:mn> <mml:mi>n</mml:mi></mml:mrow></mml:msup> <mml:mo>×</mml:mo> <mml:mi>D</mml:mi><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mi>f</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> for <italic>n</italic>−sections. At 20 μm then <italic>n</italic> = 500 implying the nuisance rigid motions are of high dimension <italic>O</italic>(1500). The solution space must be constrained. We use priors on the deformations and on the rigid motion stacking of the images.</p>
<sec id="sec007">
<title>The diffeomorphism prior</title>
<p>The histological stacking constrains the brains as smooth transformations of the template, where the diffeomorphisms are generated as diffeomorphic flows <italic>φ</italic><sub><italic>t</italic></sub> ∈ <italic>Diff</italic> [<xref ref-type="bibr" rid="pcbi.1006610.ref024">24</xref>], solving the ordinary differential equation
<disp-formula id="pcbi.1006610.e011"><alternatives><graphic id="pcbi.1006610.e011g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e011" xlink:type="simple"/><mml:math display="block" id="M11"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mover accent="true"><mml:mi>φ</mml:mi> <mml:mo>˙</mml:mo></mml:mover> <mml:mi>t</mml:mi></mml:msub> <mml:mo>=</mml:mo> <mml:msub><mml:mi>v</mml:mi> <mml:mi>t</mml:mi></mml:msub> <mml:mo>∘</mml:mo> <mml:msub><mml:mi>φ</mml:mi> <mml:mi>t</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:mi>t</mml:mi> <mml:mo>∈</mml:mo> <mml:mrow><mml:mo>[</mml:mo> <mml:mn>0</mml:mn> <mml:mo>,</mml:mo> <mml:mn>1</mml:mn> <mml:mo>]</mml:mo></mml:mrow> <mml:mo>,</mml:mo> <mml:mspace width="4pt"/><mml:msub><mml:mi>φ</mml:mi> <mml:mn>0</mml:mn></mml:msub> <mml:mo>=</mml:mo> <mml:mi>i</mml:mi><mml:mi>d</mml:mi><mml:mi>e</mml:mi><mml:mi>n</mml:mi><mml:mi>t</mml:mi><mml:mi>i</mml:mi><mml:mi>t</mml:mi><mml:mi>y</mml:mi> <mml:mspace width="4pt"/><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(4)</label></disp-formula>
with <italic>v</italic><sub><italic>t</italic></sub> the Eulerian velocity taking values in <inline-formula id="pcbi.1006610.e012"><alternatives><graphic id="pcbi.1006610.e012g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e012" xlink:type="simple"/><mml:math display="inline" id="M12"><mml:msup><mml:mi mathvariant="double-struck">R</mml:mi> <mml:mn>3</mml:mn></mml:msup></mml:math></alternatives></inline-formula>, <italic>identity</italic> the identity mapping. The top row of <xref ref-type="fig" rid="pcbi.1006610.g001">Fig 1a</xref> shows that each <italic>φ</italic> has an inverse and that the random orbit model assumes any individual brain <inline-formula id="pcbi.1006610.e013"><alternatives><graphic id="pcbi.1006610.e013g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e013" xlink:type="simple"/><mml:math display="inline" id="M13"><mml:mrow><mml:mi>I</mml:mi> <mml:mo>∈</mml:mo> <mml:mi mathvariant="script">I</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> can be generated from the exemplar under the action of the diffeomorphism, so that for some <italic>φ</italic> ∈ <italic>Diff</italic>, <italic>I</italic> = <italic>I</italic><sub>0</sub> ∘ <italic>φ</italic><sup>−1</sup>.</p>
<p>To score the distances between mouse brain coordinate systems and reject outlier solutions we use geodesic flows minimizing metric length [<xref ref-type="bibr" rid="pcbi.1006610.ref027">27</xref>]. Large deviations as measured by the diffeomorphometry metric [<xref ref-type="bibr" rid="pcbi.1006610.ref022">22</xref>] from template atlas to target mouse brain are thus removed from the solution space. The vector fields are modeled to be in a reproducing kernel Hilbert space (RKHS) (<italic>V</italic>, ‖⋅‖<sub><italic>V</italic></sub>), supporting one continuous spatial derivative, and having geodesic length between coordinate systems determined by the norm-square <inline-formula id="pcbi.1006610.e014"><alternatives><graphic id="pcbi.1006610.e014g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e014" xlink:type="simple"/><mml:math display="inline" id="M14"><mml:msubsup><mml:mrow><mml:mo>‖</mml:mo> <mml:mi>v</mml:mi> <mml:mo>‖</mml:mo></mml:mrow> <mml:mi>V</mml:mi> <mml:mn>2</mml:mn></mml:msubsup></mml:math></alternatives></inline-formula> of the RKHS:
<disp-formula id="pcbi.1006610.e015"><alternatives><graphic id="pcbi.1006610.e015g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e015" xlink:type="simple"/><mml:math display="block" id="M15"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msubsup><mml:mrow><mml:mo>‖</mml:mo> <mml:mi>v</mml:mi> <mml:mo>‖</mml:mo></mml:mrow> <mml:mi>V</mml:mi> <mml:mn>2</mml:mn></mml:msubsup> <mml:mo>=</mml:mo> <mml:munderover><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>i</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:mn>3</mml:mn></mml:munderover> <mml:msub><mml:mo>∫</mml:mo> <mml:msup><mml:mi mathvariant="double-struck">R</mml:mi> <mml:mn>3</mml:mn></mml:msup></mml:msub> <mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:mo>−</mml:mo> <mml:msup><mml:mo>∇</mml:mo> <mml:mn>2</mml:mn></mml:msup> <mml:mo>+</mml:mo> <mml:mn>1</mml:mn> <mml:mo>)</mml:mo></mml:mrow> <mml:mn>2</mml:mn></mml:msup> <mml:msub><mml:mi>v</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>,</mml:mo> <mml:mi>y</mml:mi> <mml:mo>,</mml:mo> <mml:mi>z</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>)</mml:mo></mml:mrow> <mml:mn>2</mml:mn></mml:msup> <mml:mi>d</mml:mi> <mml:mi>x</mml:mi> <mml:mi>d</mml:mi> <mml:mi>y</mml:mi> <mml:mi>d</mml:mi> <mml:mi>z</mml:mi> <mml:mo>&lt;</mml:mo> <mml:mi>∞</mml:mi> <mml:mspace width="4pt"/><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(5)</label></disp-formula>
This square-metric is used as a quadratic potential for the smoothness prior between images <inline-formula id="pcbi.1006610.e016"><alternatives><graphic id="pcbi.1006610.e016g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e016" xlink:type="simple"/><mml:math display="inline" id="M16"><mml:mrow><mml:mi>I</mml:mi> <mml:mo>,</mml:mo> <mml:msup><mml:mi>I</mml:mi> <mml:mo>′</mml:mo></mml:msup> <mml:mo>∈</mml:mo> <mml:mi mathvariant="script">I</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> [<xref ref-type="bibr" rid="pcbi.1006610.ref028">28</xref>, <xref ref-type="bibr" rid="pcbi.1006610.ref029">29</xref>] minimizes the action
<disp-formula id="pcbi.1006610.e017"><alternatives><graphic id="pcbi.1006610.e017g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e017" xlink:type="simple"/><mml:math display="block" id="M17"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msup><mml:mi>ρ</mml:mi> <mml:mn>2</mml:mn></mml:msup> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>I</mml:mi> <mml:mo>,</mml:mo> <mml:msup><mml:mi>I</mml:mi> <mml:mo>′</mml:mo></mml:msup> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:munder><mml:mo form="prefix" movablelimits="true">min</mml:mo> <mml:mrow><mml:mi>φ</mml:mi> <mml:mo>:</mml:mo> <mml:msub><mml:mi>φ</mml:mi> <mml:mn>0</mml:mn></mml:msub> <mml:mo>=</mml:mo> <mml:mi>i</mml:mi><mml:mi>d</mml:mi> <mml:mspace width="0.166667em"/><mml:mo>,</mml:mo> <mml:msub><mml:mi>φ</mml:mi> <mml:mn>1</mml:mn></mml:msub> <mml:mo>·</mml:mo> <mml:mi>I</mml:mi> <mml:mo>=</mml:mo> <mml:msup><mml:mi>I</mml:mi> <mml:mo>′</mml:mo></mml:msup></mml:mrow></mml:munder> <mml:msubsup><mml:mo>∫</mml:mo> <mml:mn>0</mml:mn> <mml:mn>1</mml:mn></mml:msubsup> <mml:msubsup><mml:mrow><mml:mo>‖</mml:mo> <mml:msub><mml:mi>v</mml:mi> <mml:mi>t</mml:mi></mml:msub> <mml:mo>‖</mml:mo></mml:mrow> <mml:mi>V</mml:mi> <mml:mn>2</mml:mn></mml:msubsup> <mml:mi>d</mml:mi> <mml:mi>t</mml:mi> <mml:mspace width="4pt"/><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(6)</label></disp-formula>
See <xref ref-type="supplementary-material" rid="pcbi.1006610.s002">S2 Text</xref> for the explicit equations for geodesics satisfying the Euler-Lagrange equations [<xref ref-type="bibr" rid="pcbi.1006610.ref027">27</xref>, <xref ref-type="bibr" rid="pcbi.1006610.ref030">30</xref>] and <xref ref-type="supplementary-material" rid="pcbi.1006610.s001">S1 Text</xref> for the matrix Green’s kernel.</p>
<p>We use the notation <italic>φ</italic><sup><italic>v</italic></sup> to emphasize the dependence of the diffeomorphism and the geodesic metric on the vector field <italic>v</italic>. Strictly speaking, the group generated by integrating (<xref ref-type="disp-formula" rid="pcbi.1006610.e011">4</xref>) with finite norm ‖⋅‖<sub><italic>V</italic></sub> is both dependent on the norm of <italic>V</italic> as well as a subgroup of all diffeomorphisms; we shall suppress that technical detail in the notation.</p>
</sec>
<sec id="sec008">
<title>The prior distribution on image smoothness</title>
<p>To score the maximum a-posteriori (MAP) reconstruction of the rigid motions acting on the stack, we exploit a smoothness prior on the reconstructed histology stack which enforces the fact that anatomical structures are smooth and continuous. We model the images as arising from a smooth “Sobolev” or RKHS <italic>I</italic> ∈ <italic>H</italic><sup><italic>k</italic></sup> supporting derivatives <inline-formula id="pcbi.1006610.e018"><alternatives><graphic id="pcbi.1006610.e018g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e018" xlink:type="simple"/><mml:math display="inline" id="M18"><mml:mrow><mml:msub><mml:mi>∂</mml:mi> <mml:mi>h</mml:mi></mml:msub> <mml:mi>f</mml:mi> <mml:mo>=</mml:mo> <mml:mfrac><mml:msup><mml:mi>∂</mml:mi> <mml:mrow><mml:msub><mml:mi>h</mml:mi> <mml:mn>1</mml:mn></mml:msub> <mml:mo>+</mml:mo> <mml:msub><mml:mi>h</mml:mi> <mml:mn>2</mml:mn></mml:msub> <mml:mo>+</mml:mo> <mml:msub><mml:mi>h</mml:mi> <mml:mn>3</mml:mn></mml:msub></mml:mrow></mml:msup> <mml:mrow><mml:mi>∂</mml:mi> <mml:msup><mml:mi>x</mml:mi> <mml:msub><mml:mi>h</mml:mi> <mml:mn>1</mml:mn></mml:msub></mml:msup> <mml:mi>∂</mml:mi> <mml:msup><mml:mi>y</mml:mi> <mml:msub><mml:mi>h</mml:mi> <mml:mn>2</mml:mn></mml:msub></mml:msup> <mml:mi>∂</mml:mi> <mml:msup><mml:mi>z</mml:mi> <mml:msub><mml:mi>h</mml:mi> <mml:mn>3</mml:mn></mml:msub></mml:msup></mml:mrow></mml:mfrac> <mml:mi>f</mml:mi></mml:mrow></mml:math></alternatives></inline-formula> that are square integrable, with norm:
<disp-formula id="pcbi.1006610.e019"><alternatives><graphic id="pcbi.1006610.e019g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e019" xlink:type="simple"/><mml:math display="block" id="M19"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msubsup><mml:mrow><mml:mo>‖</mml:mo> <mml:mi>I</mml:mi> <mml:mo>‖</mml:mo></mml:mrow> <mml:mrow><mml:msup><mml:mi>H</mml:mi> <mml:mi>k</mml:mi></mml:msup></mml:mrow> <mml:mn>2</mml:mn></mml:msubsup> <mml:mo>=</mml:mo> <mml:munder><mml:mo>∑</mml:mo> <mml:mrow><mml:msub><mml:mi>h</mml:mi> <mml:mn>1</mml:mn></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>h</mml:mi> <mml:mn>2</mml:mn></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>h</mml:mi> <mml:mn>3</mml:mn></mml:msub> <mml:mo>:</mml:mo> <mml:mrow><mml:mo>|</mml:mo> <mml:msubsup><mml:mo>∑</mml:mo> <mml:mrow><mml:mi>i</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn></mml:mrow> <mml:mn>3</mml:mn></mml:msubsup> <mml:msub><mml:mi>h</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>|</mml:mo></mml:mrow> <mml:mo>≤</mml:mo> <mml:mi>k</mml:mi></mml:mrow></mml:munder> <mml:msub><mml:mo>∫</mml:mo> <mml:msup><mml:mi mathvariant="double-struck">R</mml:mi> <mml:mn>3</mml:mn></mml:msup></mml:msub> <mml:msup><mml:mrow><mml:mo>|</mml:mo> <mml:msub><mml:mi>∂</mml:mi> <mml:mi>h</mml:mi></mml:msub> <mml:mi>I</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>,</mml:mo> <mml:mi>y</mml:mi> <mml:mo>,</mml:mo> <mml:mi>z</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>|</mml:mo></mml:mrow> <mml:mn>2</mml:mn></mml:msup> <mml:mi>d</mml:mi> <mml:mi>x</mml:mi> <mml:mi>d</mml:mi> <mml:mi>y</mml:mi> <mml:mi>d</mml:mi> <mml:mi>z</mml:mi> <mml:mspace width="4pt"/><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(7)</label></disp-formula></p>
<p>This is a quadratic form for a Gaussian random field prior on the dense histology stack with zero mean and covariance dependent on the squared norm <inline-formula id="pcbi.1006610.e020"><alternatives><graphic id="pcbi.1006610.e020g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e020" xlink:type="simple"/><mml:math display="inline" id="M20"><mml:msubsup><mml:mrow><mml:mo>‖</mml:mo> <mml:mi>I</mml:mi> <mml:mo>‖</mml:mo></mml:mrow> <mml:mrow><mml:msup><mml:mi>H</mml:mi> <mml:mi>k</mml:mi></mml:msup></mml:mrow> <mml:mn>2</mml:mn></mml:msubsup></mml:math></alternatives></inline-formula>. For the purpose of stacking, the z-axis sections are sparse 20-40 μm; the differential operators ∂<sub><italic>h</italic></sub> are implemented via the difference operator along the sectioning z-axis (see <xref ref-type="disp-formula" rid="pcbi.1006610.e021">Eq (8)</xref>). The Gaussian field has covariance determined by the difference operators; see [<xref ref-type="bibr" rid="pcbi.1006610.ref031">31</xref>] for example. We define the mixed differential-difference operator <italic>D</italic><sub><italic>h</italic></sub> as the centered difference for the z-partial derivatives,
<disp-formula id="pcbi.1006610.e021"><alternatives><graphic id="pcbi.1006610.e021g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e021" xlink:type="simple"/><mml:math display="block" id="M21"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mi>D</mml:mi> <mml:mi>h</mml:mi></mml:msub> <mml:mi>f</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>,</mml:mo> <mml:mi>y</mml:mi> <mml:mo>,</mml:mo> <mml:mi>z</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:msub><mml:mi>∂</mml:mi> <mml:mrow><mml:msub><mml:mi>h</mml:mi> <mml:mn>1</mml:mn></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>h</mml:mi> <mml:mn>2</mml:mn></mml:msub></mml:mrow></mml:msub> <mml:mo>(</mml:mo> <mml:mfrac><mml:mrow><mml:mi>f</mml:mi> <mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>,</mml:mo> <mml:mi>y</mml:mi> <mml:mo>,</mml:mo> <mml:mi>z</mml:mi> <mml:mo>+</mml:mo> <mml:mo>Δ</mml:mo> <mml:mo>/</mml:mo> <mml:mn>2</mml:mn> <mml:mo>)</mml:mo> <mml:mo>−</mml:mo> <mml:mi>f</mml:mi> <mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>,</mml:mo> <mml:mi>y</mml:mi> <mml:mo>,</mml:mo> <mml:mi>z</mml:mi> <mml:mo>−</mml:mo> <mml:mo>Δ</mml:mo> <mml:mo>/</mml:mo> <mml:mn>2</mml:mn> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>Δ</mml:mo></mml:mfrac> <mml:mo>)</mml:mo> <mml:mspace width="4pt"/><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(8)</label></disp-formula>
The gradient is forced to 0 at the boundaries of the image.</p>
</sec>
</sec>
<sec id="sec009">
<title>MAP, penalized-likelihood reconstruction</title>
<p>Model the random sectioning with section-independent jitter as a product density <inline-formula id="pcbi.1006610.e022"><alternatives><graphic id="pcbi.1006610.e022g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e022" xlink:type="simple"/><mml:math display="inline" id="M22"><mml:mrow><mml:mi>π</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>R</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:msub><mml:mo>∏</mml:mo> <mml:mi>i</mml:mi></mml:msub> <mml:mi>π</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>θ</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msubsup><mml:mi>t</mml:mi> <mml:mi>i</mml:mi> <mml:mi>x</mml:mi></mml:msubsup> <mml:mo>,</mml:mo> <mml:msubsup><mml:mi>t</mml:mi> <mml:mi>i</mml:mi> <mml:mi>y</mml:mi></mml:msubsup> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>, the priors centered at identity, with the priors on <italic>θ</italic> circular Gaussian with standard-deviation <italic>σ</italic><sub><italic>θ</italic></sub> and translation with means <inline-formula id="pcbi.1006610.e023"><alternatives><graphic id="pcbi.1006610.e023g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e023" xlink:type="simple"/><mml:math display="inline" id="M23"><mml:mrow><mml:msubsup><mml:mi>μ</mml:mi> <mml:mi>c</mml:mi> <mml:mi>x</mml:mi></mml:msubsup> <mml:mo>,</mml:mo> <mml:msubsup><mml:mi>μ</mml:mi> <mml:mi>c</mml:mi> <mml:mi>y</mml:mi></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula> at the center of the sections with <inline-formula id="pcbi.1006610.e024"><alternatives><graphic id="pcbi.1006610.e024g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e024" xlink:type="simple"/><mml:math display="inline" id="M24"><mml:mrow><mml:msubsup><mml:mi>σ</mml:mi> <mml:mi>c</mml:mi> <mml:mi>x</mml:mi></mml:msubsup> <mml:mo>=</mml:mo> <mml:msubsup><mml:mi>σ</mml:mi> <mml:mi>c</mml:mi> <mml:mi>y</mml:mi></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula>:
<disp-formula id="pcbi.1006610.e025"><alternatives><graphic id="pcbi.1006610.e025g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e025" xlink:type="simple"/><mml:math display="block" id="M25"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mi>π</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>θ</mml:mi> <mml:mo>,</mml:mo> <mml:msup><mml:mi>t</mml:mi> <mml:mi>x</mml:mi></mml:msup> <mml:mo>,</mml:mo> <mml:msup><mml:mi>t</mml:mi> <mml:mi>y</mml:mi></mml:msup> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:mfrac><mml:mn>1</mml:mn> <mml:mrow><mml:msqrt><mml:mrow><mml:mn>2</mml:mn> <mml:mi>π</mml:mi></mml:mrow></mml:msqrt> <mml:msub><mml:mi>σ</mml:mi> <mml:mi>θ</mml:mi></mml:msub></mml:mrow></mml:mfrac> <mml:msup><mml:mi>e</mml:mi> <mml:mrow><mml:mo>−</mml:mo> <mml:mfrac><mml:msup><mml:mi>θ</mml:mi> <mml:mn>2</mml:mn></mml:msup> <mml:mrow><mml:mn>2</mml:mn> <mml:msubsup><mml:mi>σ</mml:mi> <mml:mi>θ</mml:mi> <mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mfrac></mml:mrow></mml:msup> <mml:mfrac><mml:mn>1</mml:mn> <mml:mrow><mml:msqrt><mml:mrow><mml:mn>2</mml:mn> <mml:mi>π</mml:mi></mml:mrow></mml:msqrt> <mml:msubsup><mml:mi>σ</mml:mi> <mml:mi>c</mml:mi> <mml:mi>x</mml:mi></mml:msubsup></mml:mrow></mml:mfrac> <mml:msup><mml:mi>e</mml:mi> <mml:mrow><mml:mo>−</mml:mo> <mml:mfrac><mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>t</mml:mi> <mml:mi>x</mml:mi></mml:msub> <mml:mo>−</mml:mo> <mml:msubsup><mml:mi>μ</mml:mi> <mml:mi>c</mml:mi> <mml:mi>x</mml:mi></mml:msubsup> <mml:mo>)</mml:mo></mml:mrow> <mml:mn>2</mml:mn></mml:msup> <mml:mrow><mml:mn>2</mml:mn> <mml:msubsup><mml:mi>σ</mml:mi> <mml:mi>c</mml:mi> <mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mfrac></mml:mrow></mml:msup> <mml:mfrac><mml:mn>1</mml:mn> <mml:mrow><mml:msqrt><mml:mrow><mml:mn>2</mml:mn> <mml:mi>π</mml:mi></mml:mrow></mml:msqrt> <mml:msubsup><mml:mi>σ</mml:mi> <mml:mi>c</mml:mi> <mml:mi>y</mml:mi></mml:msubsup></mml:mrow></mml:mfrac> <mml:msup><mml:mi>e</mml:mi> <mml:mrow><mml:mo>−</mml:mo> <mml:mfrac><mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>t</mml:mi> <mml:mi>y</mml:mi></mml:msub> <mml:mo>−</mml:mo> <mml:msubsup><mml:mi>μ</mml:mi> <mml:mi>c</mml:mi> <mml:mi>y</mml:mi></mml:msubsup> <mml:mo>)</mml:mo></mml:mrow> <mml:mn>2</mml:mn></mml:msup> <mml:mrow><mml:mn>2</mml:mn> <mml:msubsup><mml:mi>σ</mml:mi> <mml:mi>c</mml:mi> <mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mfrac></mml:mrow></mml:msup> <mml:mspace width="4pt"/><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(9)</label></disp-formula>
We choose our standard-deviations so that they are small relative to the center of the image, and a small rotation, roughly 5 percent of the total range of each. Generating MAP estimates of the rigid motions generates the MAP estimator of the histology restacking problem denoted as
<disp-formula id="pcbi.1006610.e026"><alternatives><graphic id="pcbi.1006610.e026g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e026" xlink:type="simple"/><mml:math display="block" id="M26"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msup><mml:mi>I</mml:mi> <mml:mi>R</mml:mi></mml:msup> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>,</mml:mo> <mml:mi>y</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>z</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>=</mml:mo> <mml:msub><mml:mi>J</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>∘</mml:mo> <mml:msub><mml:mi>R</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>,</mml:mo> <mml:mi>y</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>,</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>,</mml:mo> <mml:mi>y</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>∈</mml:mo> <mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow> <mml:mn>2</mml:mn></mml:msup> <mml:mo>,</mml:mo> <mml:mspace width="4pt"/><mml:mspace width="4pt"/><mml:mi>i</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn> <mml:mo>,</mml:mo> <mml:mo>…</mml:mo> <mml:mo>,</mml:mo> <mml:mi>n</mml:mi> <mml:mspace width="4pt"/><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives></disp-formula>
Since the diffeomorphisms are infinite dimensional, the maximization of the log-likelihood function with respect to a function with the deformation penalty is termed the “penalized-likelihood estimator”. Conditioned on the known atlas, the augmented random variables to be estimated are <inline-formula id="pcbi.1006610.e027"><alternatives><graphic id="pcbi.1006610.e027g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e027" xlink:type="simple"/><mml:math display="inline" id="M27"><mml:mrow><mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>R</mml:mi> <mml:mn>1</mml:mn></mml:msub> <mml:mo>,</mml:mo> <mml:mo>…</mml:mo> <mml:mo>,</mml:mo> <mml:msub><mml:mi>R</mml:mi> <mml:mi>n</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:mi>φ</mml:mi> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>∈</mml:mo> <mml:mrow><mml:mo>(</mml:mo> <mml:msup><mml:mrow><mml:mi mathvariant="double-struck">R</mml:mi></mml:mrow> <mml:mrow><mml:mn>3</mml:mn> <mml:mi>n</mml:mi></mml:mrow></mml:msup> <mml:mo>×</mml:mo> <mml:mi>D</mml:mi><mml:mi>i</mml:mi><mml:mi>f</mml:mi><mml:mi>f</mml:mi> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula>.</p>
<p><bold>Problem 1 (MAP, Penalized-Likelihood Estimator)</bold>.</p>
<p><italic>Given histology stack</italic> <inline-formula id="pcbi.1006610.e028"><alternatives><graphic id="pcbi.1006610.e028g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e028" xlink:type="simple"/><mml:math display="inline" id="M28"><mml:mrow><mml:msub><mml:mi>J</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo><mml:mo stretchy="false">(</mml:mo><mml:mi>x</mml:mi><mml:mo>,</mml:mo><mml:mi>y</mml:mi><mml:mo stretchy="false">)</mml:mo><mml:mo>∈</mml:mo><mml:msup><mml:mi>ℝ</mml:mi><mml:mn>2</mml:mn></mml:msup><mml:mo>,</mml:mo><mml:mspace width="4pt"/><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo></mml:mrow></mml:math></alternatives></inline-formula> <italic>and reconstructed stack I</italic><sup><italic>R</italic></sup>(⋅, <italic>z</italic><sub><italic>i</italic></sub>) = <italic>J</italic><sub><italic>i</italic></sub> ∘ <italic>R</italic><sub><italic>i</italic></sub>(⋅), <italic>i</italic> = 1, …, <italic>n modelled as conditionally Gaussian random fields conditioned on jitter and smooth dormation of the template. The joint MAP, Penalized-Likelihood estimators arg max</italic><sub><italic>R</italic>,<italic>v</italic></sub> log <italic>π</italic>(<italic>R</italic>, <italic>v</italic>|<italic>J</italic>) <italic>given by</italic>
<disp-formula id="pcbi.1006610.e029"><alternatives><graphic id="pcbi.1006610.e029g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e029" xlink:type="simple"/><mml:math display="block" id="M29"><mml:mtable columnalign="left"><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:msub><mml:mrow><mml:mtext>argmax</mml:mtext></mml:mrow><mml:mrow><mml:mi>R</mml:mi><mml:mo>,</mml:mo><mml:mi>v</mml:mi></mml:mrow></mml:msub></mml:mrow></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:munderover><mml:mstyle displaystyle="true" mathsize="140%"><mml:mo>∫</mml:mo></mml:mstyle><mml:mn>0</mml:mn><mml:mn>1</mml:mn></mml:munderover><mml:mo>‖</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:msubsup><mml:mo>‖</mml:mo><mml:mi>V</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mi>d</mml:mi><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:munder><mml:mstyle displaystyle="true" mathsize="140%"><mml:mo>∑</mml:mo></mml:mstyle><mml:mi>i</mml:mi></mml:munder><mml:mo>‖</mml:mo><mml:msub><mml:mi>D</mml:mi><mml:mi>h</mml:mi></mml:msub><mml:msup><mml:mi>I</mml:mi><mml:mi>R</mml:mi></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>·</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msubsup><mml:mo>‖</mml:mo><mml:mn>2</mml:mn><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mtd></mml:mtr><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow/></mml:mtd><mml:mtd columnalign="left"><mml:mrow><mml:mo>+</mml:mo><mml:munder><mml:mstyle displaystyle="true" mathsize="140%"><mml:mo>∑</mml:mo></mml:mstyle><mml:mi>i</mml:mi></mml:munder><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mtext>log</mml:mtext><mml:mspace width="2pt"/><mml:mi>π</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:msub><mml:mi>α</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>‖</mml:mo><mml:msup><mml:mi>I</mml:mi><mml:mi>R</mml:mi></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>·</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:msub><mml:mi>I</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>∘</mml:mo><mml:msup><mml:mi>φ</mml:mi><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>·</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msubsup><mml:mo>‖</mml:mo><mml:mn>2</mml:mn><mml:mn>2</mml:mn></mml:msubsup></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(10)</label></disp-formula>
<italic>The MAP</italic>, <italic>Penalized-Likelihood estimators satisfy</italic>
<disp-formula id="pcbi.1006610.e030"><alternatives><graphic id="pcbi.1006610.e030g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e030" xlink:type="simple"/><mml:math display="block" id="M30"><mml:mrow><mml:mo>{</mml:mo> <mml:mrow><mml:mtable columnalign="left"><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:msup><mml:mi>R</mml:mi><mml:mo>*</mml:mo></mml:msup><mml:mo>=</mml:mo><mml:msub><mml:mtext>argmax</mml:mtext><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>,</mml:mo><mml:mi>i</mml:mi><mml:mo>=</mml:mo><mml:mn>1</mml:mn><mml:mo>,</mml:mo><mml:mo>…</mml:mo></mml:mrow></mml:msub><mml:munder><mml:mstyle displaystyle="true" mathsize="140%"><mml:mo>∑</mml:mo></mml:mstyle><mml:mi>i</mml:mi></mml:munder><mml:mo stretchy="false">(</mml:mo><mml:mtext>log</mml:mtext><mml:mspace width="2pt"/><mml:mi>π</mml:mi><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:msub><mml:mi>R</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:mo>‖</mml:mo><mml:msub><mml:mi>D</mml:mi><mml:mi>h</mml:mi></mml:msub><mml:msup><mml:mi>I</mml:mi><mml:mi>R</mml:mi></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>·</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msubsup><mml:mo>‖</mml:mo><mml:mn>2</mml:mn><mml:mn>2</mml:mn></mml:msubsup><mml:mo>−</mml:mo><mml:msub><mml:mi>α</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>‖</mml:mo><mml:msup><mml:mi>I</mml:mi><mml:mi>R</mml:mi></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>·</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:msub><mml:mi>I</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>∘</mml:mo><mml:msup><mml:mi>φ</mml:mi><mml:mrow><mml:msup><mml:mi>v</mml:mi><mml:mo>*</mml:mo></mml:msup><mml:mo>,</mml:mo><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>·</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msubsup><mml:mo>‖</mml:mo><mml:mn>2</mml:mn><mml:mn>2</mml:mn></mml:msubsup><mml:mo stretchy="false">)</mml:mo><mml:mo>,</mml:mo></mml:mrow></mml:mtd></mml:mtr><mml:mtr columnalign="left"><mml:mtd columnalign="left"><mml:mrow><mml:msup><mml:mi>v</mml:mi><mml:mo>*</mml:mo></mml:msup><mml:mo>=</mml:mo><mml:msub><mml:mtext>argmax</mml:mtext><mml:mi>v</mml:mi></mml:msub><mml:mo>−</mml:mo><mml:mfrac><mml:mn>1</mml:mn><mml:mn>2</mml:mn></mml:mfrac><mml:munderover><mml:mstyle displaystyle="true" mathsize="140%"><mml:mo>∫</mml:mo></mml:mstyle><mml:mn>0</mml:mn><mml:mn>1</mml:mn></mml:munderover><mml:mo>‖</mml:mo><mml:msub><mml:mi>v</mml:mi><mml:mi>t</mml:mi></mml:msub><mml:msubsup><mml:mo>‖</mml:mo><mml:mi>V</mml:mi><mml:mn>2</mml:mn></mml:msubsup><mml:mi>d</mml:mi><mml:mi>t</mml:mi><mml:mo>−</mml:mo><mml:munder><mml:mstyle displaystyle="true" mathsize="140%"><mml:mo>∑</mml:mo></mml:mstyle><mml:mi>i</mml:mi></mml:munder><mml:msub><mml:mi>α</mml:mi><mml:mi>i</mml:mi></mml:msub><mml:mo>‖</mml:mo><mml:msup><mml:mi>I</mml:mi><mml:mrow><mml:msup><mml:mi>R</mml:mi><mml:mo>*</mml:mo></mml:msup></mml:mrow></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>·</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:mo>−</mml:mo><mml:msub><mml:mi>I</mml:mi><mml:mn>0</mml:mn></mml:msub><mml:mo>∘</mml:mo><mml:msup><mml:mi>φ</mml:mi><mml:mrow><mml:mi>v</mml:mi><mml:mo>,</mml:mo><mml:mo>−</mml:mo><mml:mn>1</mml:mn></mml:mrow></mml:msup><mml:mrow><mml:mo>(</mml:mo><mml:mrow><mml:mo>·</mml:mo><mml:mo>,</mml:mo><mml:msub><mml:mi>z</mml:mi><mml:mi>i</mml:mi></mml:msub></mml:mrow><mml:mo>)</mml:mo></mml:mrow><mml:msubsup><mml:mo>‖</mml:mo><mml:mn>2</mml:mn><mml:mn>2</mml:mn></mml:msubsup></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:mrow></mml:mrow></mml:math></alternatives></disp-formula>
<italic>with</italic> <inline-formula id="pcbi.1006610.e031"><alternatives><graphic id="pcbi.1006610.e031g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e031" xlink:type="simple"/><mml:math display="inline" id="M31"><mml:msubsup><mml:mrow><mml:mo>‖</mml:mo> <mml:mo>·</mml:mo> <mml:mo>‖</mml:mo></mml:mrow> <mml:mn>2</mml:mn> <mml:mn>2</mml:mn></mml:msubsup></mml:math></alternatives></inline-formula> <italic>denoting the norm per z-axis section</italic>:
<disp-formula id="pcbi.1006610.e032"><alternatives><graphic id="pcbi.1006610.e032g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e032" xlink:type="simple"/><mml:math display="block" id="M32"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:mrow><mml:mo>‖</mml:mo> <mml:mi>f</mml:mi></mml:mrow> <mml:mrow><mml:mo>(</mml:mo> <mml:mo>·</mml:mo> <mml:mo>,</mml:mo> <mml:msub><mml:mi>z</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:msubsup><mml:mrow><mml:mo>‖</mml:mo></mml:mrow> <mml:mn>2</mml:mn> <mml:mn>2</mml:mn></mml:msubsup> <mml:mo>=</mml:mo> <mml:msub><mml:mo>∫</mml:mo> <mml:msup><mml:mi mathvariant="double-struck">R</mml:mi> <mml:mn>2</mml:mn></mml:msup></mml:msub> <mml:mi>f</mml:mi> <mml:msup><mml:mrow><mml:mo>(</mml:mo> <mml:mi>x</mml:mi> <mml:mo>,</mml:mo> <mml:mi>y</mml:mi> <mml:mo>,</mml:mo> <mml:msub><mml:mi>z</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mn>2</mml:mn></mml:msup> <mml:mi>d</mml:mi> <mml:mi>x</mml:mi> <mml:mi>d</mml:mi> <mml:mi>y</mml:mi> <mml:mspace width="4pt"/><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(11)</label></disp-formula></p>
<p>We call this the <bold>atlas-informed</bold> model. The first two prior terms of (<xref ref-type="disp-formula" rid="pcbi.1006610.e029">10</xref>) control the smoothness of template deformation and the realigned target image stack, with the third keeping the rigid motions close to the identity. The last term is the “log-likelihood” conditioned on the other variables.</p>
<p>The optimization for the <italic>R</italic>* rigid-motions is not decoupled across sections because of the smooth diffeomorphism of the LDDMM update and the Sobolev metric represented through the difference operator across the <italic>z</italic>− sections. Clearly, the smooth diffeomorphism is able to interpolate through the measured target sectioning data when the restacking solution gives a relatively smooth target, as diffeomorphisms are spatially smooth with at least one derivative. The optimization of the vector field <italic>v</italic>* corresponds to the LDDMM solution of Beg [<xref ref-type="bibr" rid="pcbi.1006610.ref025">25</xref>].</p>
<p>The principal algorithm used for solving this joint MAP-penalized likelihood problem alternates between fixing the rigid motions and solving LDDMM and fixing the diffeomorphism and solving for the rigid motions. This is described below in the following section.</p>
<p>When there is no atlas available this is equivalent to setting <italic>α</italic><sub><italic>i</italic></sub> small and becomes a MAP rigid motion restacking of the sections:
<disp-formula id="pcbi.1006610.e033"><alternatives><graphic id="pcbi.1006610.e033g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e033" xlink:type="simple"/><mml:math display="block" id="M33"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:mrow><mml:msub><mml:mtext>argmax</mml:mtext> <mml:mrow><mml:msub><mml:mi>R</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:mi>i</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn> <mml:mo>,</mml:mo> <mml:mo>…</mml:mo></mml:mrow></mml:msub> <mml:munder><mml:mo>∑</mml:mo> <mml:mi>i</mml:mi></mml:munder> <mml:mo>(</mml:mo> <mml:mo form="prefix">log</mml:mo> <mml:mi>π</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>R</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>−</mml:mo> <mml:mfrac><mml:mn>1</mml:mn> <mml:mn>2</mml:mn></mml:mfrac> <mml:msubsup><mml:mrow><mml:mo>‖</mml:mo> <mml:msub><mml:mi>D</mml:mi> <mml:mi>h</mml:mi></mml:msub> <mml:msup><mml:mi>I</mml:mi> <mml:mi>R</mml:mi></mml:msup> <mml:mrow><mml:mo>(</mml:mo> <mml:mo>·</mml:mo> <mml:mo>,</mml:mo> <mml:msub><mml:mi>z</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>‖</mml:mo></mml:mrow> <mml:mn>2</mml:mn> <mml:mn>2</mml:mn></mml:msubsup> <mml:mo>)</mml:mo> <mml:mspace width="4pt"/><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives></disp-formula>
We term this the <bold>atlas-free</bold> model. The gradient of the rigid motions with respect to the components of translations <italic>t</italic><sup><italic>x</italic></sup>, <italic>t</italic><sup><italic>y</italic></sup> and rotation <italic>θ</italic> is defined in <xref ref-type="supplementary-material" rid="pcbi.1006610.s003">S3 Text</xref>. The registration is not independent across sections due to coupling through the Sobolev metric.</p>
</sec>
<sec id="sec010">
<title>Iterative algorithm for joint penalized likelihood and MAP estimator</title>
<p>Here we describe the details of the algorithm used for solving for the MAP/penalized–likelihood problem described above. The algorithm alternately fixes the set of rigid motions while updating LDDMM and fixes the diffeomorphism while updating the rigid motions.</p>
<p><bold>Algorithm 1</bold>.</p>
<p specific-use="line"><italic>0</italic>. <italic>Initialize φ</italic><sup><italic>new</italic></sup>, <italic>R</italic><sup><italic>new</italic></sup> ← <italic>φ</italic><sup><italic>init</italic></sup>, <italic>R</italic><sup><italic>init</italic></sup>, <italic>I</italic><sup><italic>old</italic></sup> ← <italic>J</italic> ∘ <italic>R</italic><sup><italic>init</italic></sup>:</p>
<p specific-use="line"><italic>1</italic>. <italic>Update</italic> <inline-formula id="pcbi.1006610.e034"><alternatives><graphic id="pcbi.1006610.e034g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e034" xlink:type="simple"/><mml:math display="inline" id="M34"><mml:mrow><mml:msup><mml:mi>φ</mml:mi><mml:mrow><mml:mi>o</mml:mi><mml:mi>l</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msup><mml:mo>←</mml:mo><mml:msup><mml:mi>φ</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>e</mml:mi><mml:mi>w</mml:mi></mml:mrow></mml:msup><mml:mo>,</mml:mo><mml:msubsup><mml:mi>R</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mi>o</mml:mi><mml:mi>l</mml:mi><mml:mi>d</mml:mi></mml:mrow></mml:msubsup><mml:mo>←</mml:mo><mml:msubsup><mml:mi>R</mml:mi><mml:mi>i</mml:mi><mml:mrow><mml:mi>n</mml:mi><mml:mi>e</mml:mi><mml:mi>w</mml:mi></mml:mrow></mml:msubsup></mml:mrow></mml:math></alternatives></inline-formula>, <italic>I</italic><sup><italic>old</italic></sup>(⋅, <italic>z</italic><sub><italic>i</italic></sub>) ← <italic>I</italic><sup><italic>new</italic></sup>(⋅, <italic>z</italic><sub><italic>i</italic></sub>), <italic>i</italic> = 1,….</p>
<p specific-use="line"><italic>2</italic>. <italic>Update LDDMM for diffeomorphic transformation of atlas coordinates</italic>:
<disp-formula id="pcbi.1006610.e035"><alternatives><graphic id="pcbi.1006610.e035g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e035" xlink:type="simple"/><mml:math display="block" id="M35"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd columnalign="right"><mml:msup><mml:mi>v</mml:mi> <mml:mrow><mml:mi>n</mml:mi> <mml:mi>e</mml:mi> <mml:mi>w</mml:mi></mml:mrow></mml:msup></mml:mtd> <mml:mtd><mml:mo>=</mml:mo></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:msub><mml:mtext>argmax</mml:mtext> <mml:mi>v</mml:mi></mml:msub> <mml:mspace width="4pt"/><mml:mo>−</mml:mo> <mml:mfrac><mml:mn>1</mml:mn> <mml:mn>2</mml:mn></mml:mfrac> <mml:msubsup><mml:mo>∫</mml:mo> <mml:mn>0</mml:mn> <mml:mn>1</mml:mn></mml:msubsup> <mml:mrow><mml:mo>‖</mml:mo></mml:mrow> <mml:msub><mml:mi>v</mml:mi> <mml:mi>t</mml:mi></mml:msub> <mml:msubsup><mml:mrow><mml:mo>‖</mml:mo></mml:mrow> <mml:mi>V</mml:mi> <mml:mn>2</mml:mn></mml:msubsup> <mml:mi>d</mml:mi> <mml:mi>t</mml:mi> <mml:mo>−</mml:mo> <mml:munder><mml:mo>∑</mml:mo> <mml:mi>i</mml:mi></mml:munder> <mml:msub><mml:mi>α</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:msup><mml:mrow><mml:mo>‖</mml:mo> <mml:msup><mml:mi>I</mml:mi> <mml:mrow><mml:mi>R</mml:mi> <mml:mo>−</mml:mo> <mml:mi>o</mml:mi> <mml:mi>l</mml:mi> <mml:mi>d</mml:mi></mml:mrow></mml:msup> <mml:mrow><mml:mo>(</mml:mo> <mml:mo>·</mml:mo> <mml:mo>,</mml:mo> <mml:msub><mml:mi>z</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>−</mml:mo> <mml:msub><mml:mi>I</mml:mi> <mml:mn>0</mml:mn></mml:msub> <mml:mo>∘</mml:mo> <mml:msubsup><mml:mi>φ</mml:mi> <mml:mn>1</mml:mn> <mml:mrow><mml:mi>v</mml:mi> <mml:mo>−</mml:mo> <mml:mn>1</mml:mn></mml:mrow></mml:msubsup> <mml:mrow><mml:mo>(</mml:mo> <mml:mo>·</mml:mo> <mml:mo>,</mml:mo> <mml:msub><mml:mi>z</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>‖</mml:mo></mml:mrow> <mml:mn>2</mml:mn></mml:msup> <mml:mspace width="4pt"/><mml:mo>,</mml:mo> <mml:mspace width="4pt"/><mml:mspace width="4pt"/><mml:mspace width="4pt"/><mml:mspace width="4pt"/><mml:mspace width="4pt"/><mml:mspace width="4pt"/><mml:mspace width="4pt"/></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd columnalign="right"><mml:msup><mml:mi>φ</mml:mi> <mml:mrow><mml:mi>n</mml:mi> <mml:mi>e</mml:mi> <mml:mi>w</mml:mi></mml:mrow></mml:msup></mml:mtd> <mml:mtd><mml:mo>=</mml:mo></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:msubsup><mml:mo>∫</mml:mo> <mml:mn>0</mml:mn> <mml:mn>1</mml:mn></mml:msubsup> <mml:msubsup><mml:mi>v</mml:mi> <mml:mi>t</mml:mi> <mml:mrow><mml:mi>n</mml:mi> <mml:mi>e</mml:mi> <mml:mi>w</mml:mi></mml:mrow></mml:msubsup> <mml:mo>∘</mml:mo> <mml:msubsup><mml:mi>φ</mml:mi> <mml:mi>t</mml:mi> <mml:mrow><mml:mi>n</mml:mi> <mml:mi>e</mml:mi> <mml:mi>w</mml:mi></mml:mrow></mml:msubsup> <mml:mi>d</mml:mi> <mml:mi>t</mml:mi> <mml:mo>+</mml:mo> <mml:mtext>id</mml:mtext> <mml:mspace width="0.166667em"/><mml:mspace width="4pt"/><mml:mo>.</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(12)</label></disp-formula></p>
<p specific-use="line"><italic>3</italic>. <italic>Deform atlas I</italic><sub>0</sub> ∘ <italic>φ</italic><sup><italic>new</italic>−1</sup> <italic>and generate new histology image stack</italic>:
<disp-formula id="pcbi.1006610.e036"><alternatives><graphic id="pcbi.1006610.e036g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e036" xlink:type="simple"/><mml:math display="block" id="M36"><mml:mtable displaystyle="true"><mml:mtr><mml:mtd/><mml:mtd><mml:msup><mml:mi>R</mml:mi> <mml:mrow><mml:mi>n</mml:mi> <mml:mi>e</mml:mi> <mml:mi>w</mml:mi></mml:mrow></mml:msup></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mo>=</mml:mo> <mml:mo form="prefix">arg</mml:mo> <mml:munder><mml:mo form="prefix" movablelimits="true">max</mml:mo> <mml:mrow><mml:msub><mml:mi>R</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:mi>i</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn> <mml:mo>,</mml:mo> <mml:mo>…</mml:mo></mml:mrow></mml:munder> <mml:munder><mml:mo>∑</mml:mo> <mml:mi>i</mml:mi></mml:munder> <mml:mo>(</mml:mo> <mml:mo form="prefix">log</mml:mo> <mml:mi>π</mml:mi> <mml:mo>(</mml:mo> <mml:msub><mml:mi>R</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>)</mml:mo> <mml:mo/></mml:mrow><mml:mrow><mml:mo/> <mml:mo>−</mml:mo> <mml:mfrac><mml:mn>1</mml:mn> <mml:mn>2</mml:mn></mml:mfrac> <mml:mrow><mml:mo>‖</mml:mo></mml:mrow> <mml:msub><mml:mi>D</mml:mi> <mml:mi>h</mml:mi></mml:msub> <mml:msup><mml:mi>I</mml:mi> <mml:mi>R</mml:mi></mml:msup> <mml:mrow><mml:mo>(</mml:mo> <mml:mo>·</mml:mo> <mml:mo>,</mml:mo> <mml:msub><mml:mi>z</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:msubsup><mml:mrow><mml:mo>‖</mml:mo></mml:mrow> <mml:mn>2</mml:mn> <mml:mn>2</mml:mn></mml:msubsup> <mml:mo>−</mml:mo> <mml:msub><mml:mi>α</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:msubsup><mml:mrow><mml:mo>‖</mml:mo> <mml:msup><mml:mi>I</mml:mi> <mml:mi>R</mml:mi></mml:msup> <mml:mrow><mml:mo>(</mml:mo> <mml:mo>·</mml:mo> <mml:mo>,</mml:mo> <mml:msub><mml:mi>z</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>−</mml:mo> <mml:msub><mml:mi>I</mml:mi> <mml:mn>0</mml:mn></mml:msub> <mml:mo>∘</mml:mo> <mml:msup><mml:mi>φ</mml:mi> <mml:mrow><mml:mi>n</mml:mi> <mml:mi>e</mml:mi> <mml:mi>w</mml:mi> <mml:mo>−</mml:mo> <mml:mn>1</mml:mn></mml:mrow></mml:msup> <mml:mrow><mml:mo>(</mml:mo> <mml:mo>·</mml:mo> <mml:mo>,</mml:mo> <mml:msub><mml:mi>z</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>‖</mml:mo></mml:mrow> <mml:mn>2</mml:mn> <mml:mn>2</mml:mn></mml:msubsup> <mml:mo>)</mml:mo> <mml:mspace width="4pt"/><mml:mo>;</mml:mo></mml:mrow></mml:mtd></mml:mtr> <mml:mtr><mml:mtd/><mml:mtd><mml:mrow><mml:msup><mml:mi>I</mml:mi> <mml:mrow><mml:mi>R</mml:mi> <mml:mo>−</mml:mo> <mml:mi>n</mml:mi> <mml:mi>e</mml:mi> <mml:mi>w</mml:mi></mml:mrow></mml:msup> <mml:mrow><mml:mo>(</mml:mo> <mml:mo>·</mml:mo> <mml:mo>,</mml:mo> <mml:msub><mml:mi>z</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:mtd> <mml:mtd columnalign="left"><mml:mrow><mml:mo>=</mml:mo> <mml:msub><mml:mi>J</mml:mi> <mml:mi>i</mml:mi></mml:msub> <mml:mo>∘</mml:mo> <mml:msubsup><mml:mi>R</mml:mi> <mml:mi>i</mml:mi> <mml:mrow><mml:mi>n</mml:mi> <mml:mi>e</mml:mi> <mml:mi>w</mml:mi></mml:mrow></mml:msubsup> <mml:mrow><mml:mo>(</mml:mo> <mml:mo>·</mml:mo> <mml:mo>)</mml:mo></mml:mrow> <mml:mspace width="4pt"/><mml:mo>,</mml:mo> <mml:mi>i</mml:mi> <mml:mo>=</mml:mo> <mml:mn>1</mml:mn> <mml:mo>…</mml:mo></mml:mrow></mml:mtd></mml:mtr></mml:mtable></mml:math></alternatives> <label>(13)</label></disp-formula></p>
<p specific-use="line"><italic>4</italic>. <italic>Return to Step 1 until convergence criterion met</italic>.</p>
<p>The form of the gradients for the rigid motions is given in <xref ref-type="supplementary-material" rid="pcbi.1006610.s004">S4 Text</xref>. The LDDMM update solutions are given by Beg [<xref ref-type="bibr" rid="pcbi.1006610.ref025">25</xref>].</p>
</sec>
<sec id="sec011">
<title>Software implementation</title>
<p>The algorithm described above is applied to Nissl histological stacks using the Allen Institute’s mouse brain atlas as a template. The Allen Mouse Brain Atlas is a micron-scale atlas that includes annotated Nissl-stained images at 10, 25, 50, and 100 μm voxel resolution, with 738 labeled compartments in the annotation.</p>
<p>Atlas mapping is computed on the Nissl-stained histological image stack showing the clear definition of anatomical boundaries. The associated fluorescent tracer images are transformed to the Nissl stack so that the atlas subvolume labels can be cast onto the new modality. The fluorescent and Nissl images are registered within animals by applying rigid registration based on a mutual information cost function.</p>
<p>A software pipeline which performs start-to-finish registration operations was implemented on a high performance computing cluster for atlas-mapping and histology restacking on the Mouse Brain Architecture data. To date, the pipeline has been successfully run on over 1000 MBAP brains. The general pipeline workflow is illustrated in <xref ref-type="fig" rid="pcbi.1006610.g002">Fig 2</xref>. In our application, we apply a two channel LDDMM [<xref ref-type="bibr" rid="pcbi.1006610.ref032">32</xref>] algorithm for the optimization with respect to <italic>φ</italic>, where the first channel is the Nissl-stained grayscale image, and the second channel is a mask of the brain tissue with ventricles and background set to a pixel value of zero. The brain mask for each brain stack is automatically generated by thresholding at an estimated background intensity value and applying morphological opening and closing for denoising. The threshold value is estimated by a RANSAC-like procedure over the image histogram, assuming a normal distribution of intensity values in the image foreground. A first-order Sobolev-norm (see below) is used for the smoothness constraint regularization of the histology stack. In order to accommodate for sections damaged by the histology process or structures excluded from imaging, the objective functions in all parts of the algorithm are optimized with respect to only the image data that exists. Essentially, this is a masking procedure on the cost function that allows matching between a whole atlas brain and some target which is a partial, or subset of a whole brain.</p>
<fig id="pcbi.1006610.g002" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1006610.g002</object-id>
<label>Fig 2</label>
<caption>
<title>Histology registration pipeline workflow.</title>
<p>The pipeline begins with an atlas volume and target sections, proceeds through nissl-to-atlas mapping following by fluoro-to-nissl mapping, and ends with connectivity analysis.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1006610.g002" xlink:type="simple"/>
</fig>
<p>After registration of the structural Nissl image, the fluorescence volume is registered to its corresponding Nissl volume. The registration is restricted to rigid motions on each individual section. The optimization bears a similar form to <xref ref-type="disp-formula" rid="pcbi.1006610.e036">Eq (13)</xref> with the squared error matching term replaced with mutual information in order to account for the different modalities of the template and target histology stack. Once fluoro-to-Nissl registration is complete, the Nissl segmentation can be applied to the fluorescence image.</p>
<p>The LDDMM algorithm that maps the atlas image to an aligned stack of sections is implemented in C++. Images and other data are stored as basic arrays, and there are no dependencies other than for FFTs (we use FFTW or Intel MKL depending on availability). The remainder of code is written in Matlab (Natick, MA).</p>
<p>The run-time/complexity for the volume LDDMM algorithm has complexity order <italic>n</italic><sub><italic>T</italic></sub> <italic>N</italic><sub><italic>vox</italic></sub><italic>log</italic>(<italic>N</italic><sub><italic>vox</italic></sub>), where <italic>n</italic><sub><italic>T</italic></sub> is the number of steps for integrating the time varying velocity field, and <italic>N</italic><sub><italic>vox</italic></sub> is the total number of voxels. The slice based portion of the code is order <italic>N</italic><sub><italic>vox</italic></sub>. While the FFTs are order <italic>NlogN</italic>, in practice most computation time is spent during linear interpolation (order <italic>N</italic>). The end-to-end running time from initial stack alignment to completed atlas registration is approximately 6-8 hours using 8 cores on an Intel Xeon E5-2665 processor for target and template image volumes of approximately 200 × 300 × 300 voxels. Jobs are performed in parallel on a high performance cluster at CSHL. The fluoro-to-nissl cross registration running time is approximately 1 hour on the same environment and volume size.</p>
<p>The following hyper-parameters are required by our model, with sample values provided for the MBAP dataset:
<list list-type="order">
<list-item><p>the weights between the matching term (1.0), the regularizing prior (0.001), and the Sobolev norm (1.0) on the rigid objective function</p></list-item>
<list-item><p>the variances of the priors on rotation (<inline-formula id="pcbi.1006610.e037"><alternatives><graphic id="pcbi.1006610.e037g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e037" xlink:type="simple"/><mml:math display="inline" id="M37"><mml:mfrac><mml:mi>π</mml:mi> <mml:mn>9</mml:mn></mml:mfrac></mml:math></alternatives></inline-formula>) and translation (7.0) in each stacking plane</p></list-item>
<list-item><p>the weight between the matching term (0.4) and the regularizing term in LDDMM (1.0)</p></list-item>
<list-item><p>the LDDMM kernel size (a cascade of 0.05, 0.02, and 0.01)</p></list-item>
<list-item><p>the initial gradient descent step size (0.000025 for rigid parameters and 5e-13 for LDDMM parameters)</p></list-item>
</list></p>
<p>The hyper-parameters were selected by grid search on a predefined range of parameter values, testing the rigid stack alignment and LDDMM parameters separately.</p>
</sec>
</sec>
<sec id="sec012" sec-type="conclusions">
<title>Results and discussion</title>
<sec id="sec013">
<title>Validation on simulated reconstructions</title>
<sec id="sec014">
<title>Binary phantom with curvature distortion</title>
<p>The model was applied to binary image phantoms in order to examine the “curvature” problem in which a 3D curved object cannot be accurately reconstructed after being sectioned. This is illustrated in <xref ref-type="fig" rid="pcbi.1006610.g003">Fig 3</xref>. We produced sections through the 3D phantom, applying the atlas-free and the atlas-informed models. The results from the atlas-free algorithm in which the sections are aligned based on the Sobolev smoothness followed by mapping of the atlas via LDDMM are summarized in <xref ref-type="fig" rid="pcbi.1006610.g003">Fig 3c</xref>. The atlas-free section alignment reconstructs the target stack, demonstrating a cylindrical reconstruction rather than the curved template shape, followed by LDDMM alignment <italic>I</italic><sub>0</sub> ∘ <italic>φ</italic><sup>−1</sup>. This illustrates the curvature issue. The atlas coordinate grid is transformed significantly (bottom right of <xref ref-type="fig" rid="pcbi.1006610.g003">Fig 3c</xref>) in order to match the target. Despite this significant deformation, there is some residual error in the atlas-to-target mapping with the remaining tendrils where the ends of the phantom did not shrink inwards. Here, the energy required to push the ends of the atlas inwards was greater than the potential image matching improvement.</p>
<fig id="pcbi.1006610.g003" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1006610.g003</object-id>
<label>Fig 3</label>
<caption>
<title>Comparison of atlas-free and atlas-informed models in simulated binary phantom.</title>
<p>a) An illustration of the classic curvature reconstruction problem. b) The unobserved 3D-phantom is randomly sectioned and observed as <italic>J</italic><sub><italic>i</italic></sub>, <italic>i</italic> = 1, …, <italic>n</italic>. c) Reconstruction of the histological stack using the atlas-free method. The top row shows the histological stack and atlas. The bottom row shows the reconstructed histological stack <inline-formula id="pcbi.1006610.e038"><alternatives><graphic id="pcbi.1006610.e038g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e038" xlink:type="simple"/><mml:math display="inline" id="M38"><mml:msup><mml:mi>I</mml:mi> <mml:mover accent="true"><mml:mi>R</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:msup></mml:math></alternatives></inline-formula> alongside the deformed phantom atlas <italic>I</italic> = <italic>I</italic><sub>0</sub> ∘ <italic>φ</italic><sup>−1</sup> which has been mapped to histological sections, and the diffeomorphic change of coordinates <inline-formula id="pcbi.1006610.e039"><alternatives><graphic id="pcbi.1006610.e039g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e039" xlink:type="simple"/><mml:math display="inline" id="M39"><mml:msup><mml:mover accent="true"><mml:mi>φ</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mrow><mml:mo>−</mml:mo> <mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:math></alternatives></inline-formula>. d) Reconstruction of phantom using the atlas-informed model. Each row depicts iterations of the reconstructed histological stack <inline-formula id="pcbi.1006610.e040"><alternatives><graphic id="pcbi.1006610.e040g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e040" xlink:type="simple"/><mml:math display="inline" id="M40"><mml:msup><mml:mi>I</mml:mi> <mml:mover accent="true"><mml:mi>R</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:msup></mml:math></alternatives></inline-formula> alongside the deformed atlas <inline-formula id="pcbi.1006610.e041"><alternatives><graphic id="pcbi.1006610.e041g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e041" xlink:type="simple"/><mml:math display="inline" id="M41"><mml:mrow><mml:mi>I</mml:mi> <mml:mo>=</mml:mo> <mml:msub><mml:mi>I</mml:mi> <mml:mn>0</mml:mn></mml:msub> <mml:mo>∘</mml:mo> <mml:msup><mml:mover accent="true"><mml:mi>φ</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mrow><mml:mo>−</mml:mo> <mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></alternatives></inline-formula> and deformed coordinates. The bottom row is the convergence point of the algorithm.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1006610.g003" xlink:type="simple"/>
</fig>
<p>Shown in <xref ref-type="fig" rid="pcbi.1006610.g003">Fig 3d</xref> is the atlas-informed solution. The bottom row shows that simultaneously solving for reconstruction and registration parameters allows for more consistent stack reconstruction of the target resulting from the influence of the smooth deformation of the template onto the target in the joint solution.</p>
<p>These results are depicted by the motions of the atlas coordinate grids when deforming onto the targets in <xref ref-type="fig" rid="pcbi.1006610.g004">Fig 4</xref>. Tandem optimization of section alignment parameters and diffeomorphisms produces a nonlinear mapping with lower metric cost (<xref ref-type="fig" rid="pcbi.1006610.g004">Fig 4c</xref> is less warped than <xref ref-type="fig" rid="pcbi.1006610.g004">Fig 4b</xref>).</p>
<fig id="pcbi.1006610.g004" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1006610.g004</object-id>
<label>Fig 4</label>
<caption>
<title>Comparison of resulting diffeomorphic transformation of atlas phantoms.</title>
<p>The warped coordinate grids illustrate the difference in the mapping deformation from the atlas-free methods from (A) to histology stack target (B) versus the atlas-informed algorithm which produces (C).</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1006610.g004" xlink:type="simple"/>
</fig>
</sec>
<sec id="sec015">
<title>Simulated jitter on the Allen atlas</title>
<p>A similar experiment was performed using the Allen mouse brain atlas as the 3D phantom. A target histology stack was generated by sectioning the Allen atlas in simulation and applying random rigid transforms to its coronal sections. The atlas images were sampled at 40 μm isotropic voxels. This is depicted in <xref ref-type="fig" rid="pcbi.1006610.g005">Fig 5a</xref>. A simulated atlas was generated by applying a given random diffeomorphism to the Allen atlas. This random diffeomorphism is depicted in <xref ref-type="fig" rid="pcbi.1006610.g005">Fig 5c</xref>. The histology stacks were then reconstructed and diffeomorphic transformations generated between the atlas and target stacks using both models, intending to recover both the unknown rigid transforms from <xref ref-type="fig" rid="pcbi.1006610.g005">Fig 5a</xref> and the unknown diffeomorphism from <xref ref-type="fig" rid="pcbi.1006610.g005">Fig 5c</xref>. <xref ref-type="fig" rid="pcbi.1006610.g005">Fig 5b</xref> shows the atlas-free method method (bottom left) compared to the atlas-informed method (bottom right). The atlas-informed method nearly reproduces the original coordinates whereas the atlas-free method drifts away from the original coordinates. Note that although the diffeomorphisms are not identical, this does not necessarily indicate segmentation error as small differences in stack alignment can be compensated for by nonlinear registration during atlas-mapping.</p>
<fig id="pcbi.1006610.g005" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1006610.g005</object-id>
<label>Fig 5</label>
<caption>
<title>Atlas phantom simulation to validate recovery of sectioning parameters and diffeomorphic shape difference.</title>
<p>a) The ground truth target <italic>I</italic> is sectioned to generate the observed target <italic>J</italic><sub><italic>i</italic></sub>. b) Transformed grids illustrating the brain phantom atlas (top) shown mapped onto the histological stack using the atlas-free algorithm (bottom left) and the atlas-informed algorithm (bottom right). c) The ground truth diffeomorphism to be recovered.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1006610.g005" xlink:type="simple"/>
</fig>
</sec>
<sec id="sec016">
<title>Simulated bias and variance statistics</title>
<p>Figs <xref ref-type="fig" rid="pcbi.1006610.g006">6</xref> and <xref ref-type="fig" rid="pcbi.1006610.g007">7</xref> show results quantifying the bias and viarance of the joint estimation of the diffeomorphism transformation and the rigid motion jitter in simulation. <xref ref-type="disp-formula" rid="pcbi.1006610.e006">Eq (2)</xref> was simulated over a range of Gaussian white noise selections while simultaneously varying the jitter rigid motions of the sections along with multiple deformations of shearing applied to the template <italic>I</italic><sub>0</sub>. Shearing produced images where each section was successively offset by 0.25 pixels in both x and y directions, cumulatively producing the “shear” effect illustrated in <xref ref-type="fig" rid="pcbi.1006610.g006">Fig 6</xref>. <xref ref-type="fig" rid="pcbi.1006610.g007">Fig 7a</xref> keeps the stack jitter fixed and varies the noise levels; <xref ref-type="fig" rid="pcbi.1006610.g007">Fig 7b</xref> varies the stack jitter. The random rigid motion jitter was normally distributed <inline-formula id="pcbi.1006610.e042"><alternatives><graphic id="pcbi.1006610.e042g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e042" xlink:type="simple"/><mml:math display="inline" id="M42"><mml:mrow><mml:mrow><mml:mo>(</mml:mo> <mml:msub><mml:mi>t</mml:mi> <mml:mi>x</mml:mi></mml:msub> <mml:mo>,</mml:mo> <mml:msub><mml:mi>t</mml:mi> <mml:mi>y</mml:mi></mml:msub> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>∼</mml:mo> <mml:mi mathvariant="script">N</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>μ</mml:mi> <mml:mo>=</mml:mo> <mml:mn>0</mml:mn> <mml:mo>,</mml:mo> <mml:msup><mml:mi>σ</mml:mi> <mml:mn>2</mml:mn></mml:msup> <mml:mo>=</mml:mo> <mml:mn>36</mml:mn> <mml:mo>)</mml:mo></mml:mrow> <mml:mo>,</mml:mo> <mml:mi>θ</mml:mi> <mml:mo>∼</mml:mo> <mml:mi mathvariant="script">N</mml:mi> <mml:mrow><mml:mo>(</mml:mo> <mml:mi>μ</mml:mi> <mml:mo>=</mml:mo> <mml:mn>0</mml:mn> <mml:mo>,</mml:mo> <mml:msup><mml:mi>σ</mml:mi> <mml:mn>2</mml:mn></mml:msup> <mml:mo>=</mml:mo> <mml:mn>100</mml:mn> <mml:mo>)</mml:mo></mml:mrow></mml:mrow></mml:math></alternatives></inline-formula> in pixel units. The RMSE, bias, and standard deviation of the estimated parameters were computed in each experiment and plotted as a function of error units versus noise level. 500 simulations per experiment were performed.</p>
<fig id="pcbi.1006610.g006" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1006610.g006</object-id>
<label>Fig 6</label>
<caption>
<title>Simulated noise on a binary image phantom.</title>
<p>Left column shows phantom for identity, shearing, and jitter of sections (successive rows); right column shows Gaussian white noise added to the atlas at various standard deviations.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1006610.g006" xlink:type="simple"/>
</fig>
<fig id="pcbi.1006610.g007" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1006610.g007</object-id>
<label>Fig 7</label>
<caption>
<title>Evaluation of estimator MSE, variance, and bias.</title>
<p>a) Statistics on the translation-rotation estimators for noise levels varying initial conditions. b) Statistics on the rigid motion estimators where the section jitter was added in a random fashion.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1006610.g007" xlink:type="simple"/>
</fig>
<p>In each experiment, estimator accuracy is preserved up to high noise levels. At typical noise levels (<italic>σ</italic> ≤ 0.5), we observe subpixel RMSE and small bias. <xref ref-type="fig" rid="pcbi.1006610.g007">Fig 7b</xref> shows that the rotation estimator is virtually unbiased whereas the translation estimator does have small subvoxel bias. It is likely that more rotational error is accounted for by section realignment than deformable mapping, whereas both play a relatively balanced role in translation correction. Small motions are ill-posed in that small rigid-motions can accommodate small atlas deformation. <xref ref-type="fig" rid="pcbi.1006610.g007">Fig 7c</xref> (top row) shows the case where there is jitter in the target stack. Estimator statistics are computed in each of these cases showing similar subpixel errors.</p>
<p>A similar analysis was performed for the Allen atlas brain phantom simulations. The reconstruction RMSE observed in the brain phantom simulation (bottom row of <xref ref-type="fig" rid="pcbi.1006610.g007">Fig 7c</xref>) is lower than that observed in the simple curved phantom in pixels. It is likely that this is due to the presence of more contour lines in grayscale images versus binary images. These additional features allow for more accurate distinction of matching error than simpler images with small numbers of distinct level lines. This is consistent with the demonstration in [<xref ref-type="bibr" rid="pcbi.1006610.ref027">27</xref>] showing that the stabilizer of the group corresponding to vector fields tangent to the level lines of the image cannot be uniquely identified or retrieved via any mapping methods that look at color or contrast of the image as the identifying feature.</p>
</sec>
</sec>
<sec id="sec017">
<title>Mouse Brain Architecture Project data</title>
<p>A final experiment was conducted on brain data sampled from the MBAP database, using the Allen mouse brain as the atlas. We selected specific targets which were prone to poor registration results due to image intensity local minima. In particular, structures like the cerebellum tend to be difficult to register accurately due to their folded nature; one fold can easily be mistaken for the adjacent fold, and if the target and atlas are not well initialized, the deformation required to flow one fold onto another can have a high metric cost. We are also interested in inspecting lower-contrast structures like the corpus callossum, which may be poorly registered due to local minima in other nearby bright structures. We also evaluate our mapping quality in the hippocampal region, which is one of the most relevant regions for the study of neurodegenerative diseases.</p>
<p>The reconstructed histological target stack in the atlas-informed model shown in <xref ref-type="fig" rid="pcbi.1006610.g008">Fig 8a</xref> takes on the shape of the atlas but is prone to reconstruction artifacts. The deformation grids produced by the atlas-informed mapping is much smoother and has many fewer wrinkles than the atlas-free mapping. This is seen clearly in <xref ref-type="fig" rid="pcbi.1006610.g009">Fig 9</xref>.</p>
<fig id="pcbi.1006610.g008" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1006610.g008</object-id>
<label>Fig 8</label>
<caption>
<title>Comparison of reconstruction and mapping using atlas-free and atlas-informed models on data from the MBAP database.</title>
<p>a) Reconstruction of an MBA Nissl-stained brain histological stack using the atlas-free method. Top row shows the histological stack and Allen mouse brain atlas. Bottom row shows the reconstructed histological stack <inline-formula id="pcbi.1006610.e043"><alternatives><graphic id="pcbi.1006610.e043g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e043" xlink:type="simple"/><mml:math display="inline" id="M43"><mml:msup><mml:mi>I</mml:mi> <mml:mover accent="true"><mml:mi>R</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:msup></mml:math></alternatives></inline-formula> alongside the deformed phantom atlas <italic>I</italic>, and the diffeomorphic change of coordinates <inline-formula id="pcbi.1006610.e044"><alternatives><graphic id="pcbi.1006610.e044g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e044" xlink:type="simple"/><mml:math display="inline" id="M44"><mml:msup><mml:mover accent="true"><mml:mi>φ</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mrow><mml:mo>−</mml:mo> <mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:math></alternatives></inline-formula>. b) Reconstruction using the atlas-informed method. Top row shows the histological stack and Allen mouse brain atlas. Middle row depicts intermediate iterations of the reconstructed stack <inline-formula id="pcbi.1006610.e045"><alternatives><graphic id="pcbi.1006610.e045g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e045" xlink:type="simple"/><mml:math display="inline" id="M45"><mml:msup><mml:mi>I</mml:mi> <mml:mover accent="true"><mml:mi>R</mml:mi> <mml:mo>^</mml:mo></mml:mover></mml:msup></mml:math></alternatives></inline-formula> alongside the deformed atlas <inline-formula id="pcbi.1006610.e046"><alternatives><graphic id="pcbi.1006610.e046g" mimetype="image" position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1006610.e046" xlink:type="simple"/><mml:math display="inline" id="M46"><mml:mrow><mml:msub><mml:mi>I</mml:mi> <mml:mn>0</mml:mn></mml:msub> <mml:mo>∘</mml:mo> <mml:msup><mml:mover accent="true"><mml:mi>φ</mml:mi> <mml:mo>^</mml:mo></mml:mover> <mml:mrow><mml:mo>−</mml:mo> <mml:mn>1</mml:mn></mml:mrow></mml:msup></mml:mrow></mml:math></alternatives></inline-formula> and coordinate grid. Bottom row shows the convergence point of algorithm.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1006610.g008" xlink:type="simple"/>
</fig>
<fig id="pcbi.1006610.g009" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1006610.g009</object-id>
<label>Fig 9</label>
<caption>
<title>Comparison of diffeomorphic transformation recovered from atlas-free and atlas-informed models.</title>
<p>The warped grids illustrate the difference in the mapping deformation from atlas (top) to target using the atlas-free method (bottom left) versus the atlas-informed method (bottom right), performed on real brain data from the MBA Project.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1006610.g009" xlink:type="simple"/>
</fig>
<p>
<xref ref-type="fig" rid="pcbi.1006610.g010">Fig 10</xref> shows examples of improved segmentations in selected regions of the brain. The atlas-informed model generates more accurate segmentation results and produces smoother mappings as exhibited by the less wrinkled and distorted grids (bottom row b), showing more consistent results throughout the MBAP dataset.</p>
<fig id="pcbi.1006610.g010" position="float">
<object-id pub-id-type="doi">10.1371/journal.pcbi.1006610.g010</object-id>
<label>Fig 10</label>
<caption>
<title>Selected regions of the brain segmented by the atlas-informed and atlas-free models carry the label map from the Allen atlas under the computed diffeomorphism.</title>
<p>The left column shows several examples where optimization of the atlas-free solution is trapped in false minima due to folded or low-contrast structures. The right column shows correction by the atlas-informed algorithm. A) The corpus callossum and lateral ventricle. B) The dentate gyrus, corpus callossum, and lateral ventricle. C) The cerebellar white matter.</p>
</caption>
<graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1006610.g010" xlink:type="simple"/>
</fig>
</sec>
<sec id="sec018">
<title>Conclusion</title>
<p>This paper examines the CA random orbit model at the mesoscale for the stacking of sectioned whole brains coupled with mapping to annotated atlases. The standard CA model has been expanded to include the O(3 × <italic>n</italic>) extra rigid motion dimensions representing the planar histology sections. The estimation procedure solved here simultaneously estimates the diffeomorphic change of coordinates between atlas and target histological stack, as well as the “nuisance” rigid motion parameters for each section in stack space. This requires the introduction of a smoothness constraint on the target jitter simultaneous with LDDMM, which is enforced via a Sobolev metric, encouraging the reconstructed stack to be smooth by controlling the derivative along the cutting axis.</p>
<p>Results are shown demonstrating that the introduction of an atlas into the estimation scheme and simultaneously accommodating for the nonlinear atlas-to-target shape difference via diffeomorphism solves several of the classic problems associated with volume reconstruction, including the recovery of the curvature of extended structures. Since the atlas gives <italic>a priori</italic> indication of the global shape, the tendency to remove distortions along the section axis is balanced against the desire to minimize the amount of deformation of the atlas onto the reconstruction. The algorithm is shown to mediate this tension well.</p>
<p>The clear limitation of this method is that we model sections that are out of order, folded upon themselves, or damaged by censoring from the mapping solution using the weighting coefficient <italic>α</italic><sub><italic>i</italic></sub> and removing their impact from the overall deformation. This is a global censoring, but we do not apply shearing deformations within plane and we do not include in the algorithm an automatic solution to detecting the folding problem. Although we do not currently include correction beyond rigid motion within the plane of each section, one could imagine attempting to add such shearing distortions to the model, which would remain stable as the number of new dimensions would remain low. The global censoring solution requires human quality control within the pipeline for detection of globally deformed or damaged sections.</p>
<p>The use of dense large deformation diffeomorphic image matching is being used extensively for magnetic resonance imaging in the brain at 1 millimeter scale for both T1 and DTI [<xref ref-type="bibr" rid="pcbi.1006610.ref023">23</xref>, <xref ref-type="bibr" rid="pcbi.1006610.ref025">25</xref>, <xref ref-type="bibr" rid="pcbi.1006610.ref032">32</xref>, <xref ref-type="bibr" rid="pcbi.1006610.ref033">33</xref>] as well as for human anatomy [<xref ref-type="bibr" rid="pcbi.1006610.ref022">22</xref>] including for transferring the geometries of Cardiac fibers in dense Cardiac imaging [<xref ref-type="bibr" rid="pcbi.1006610.ref034">34</xref>, <xref ref-type="bibr" rid="pcbi.1006610.ref035">35</xref>] and for radiation treatment planning [<xref ref-type="bibr" rid="pcbi.1006610.ref036">36</xref>]. These technologies form the basis of many implementations such as Ashburner’s important SPM [<xref ref-type="bibr" rid="pcbi.1006610.ref037">37</xref>, <xref ref-type="bibr" rid="pcbi.1006610.ref038">38</xref>]. The aforementioned applications have not included complex prior distributions to encode distortions such as the Sobolev derivative prior introduced here that may have be required due to the distortions introduced in the imaging and stacking process.</p>
</sec>
</sec>
<sec id="sec019">
<title>Supporting information</title>
<supplementary-material id="pcbi.1006610.s001" mimetype="application/pdf" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1006610.s001" xlink:type="simple">
<label>S1 Text</label>
<caption>
<title>Reproducing Kernel Hilbert Space and Green’s Kernel.</title>
<p>(PDF)</p>
</caption>
</supplementary-material>
<supplementary-material id="pcbi.1006610.s002" mimetype="application/pdf" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1006610.s002" xlink:type="simple">
<label>S2 Text</label>
<caption>
<title>Geodesics solving Euler-Lagrange equations.</title>
<p>(PDF)</p>
</caption>
</supplementary-material>
<supplementary-material id="pcbi.1006610.s003" mimetype="application/pdf" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1006610.s003" xlink:type="simple">
<label>S3 Text</label>
<caption>
<title>Gradients for Atlas free model.</title>
<p>(PDF)</p>
</caption>
</supplementary-material>
<supplementary-material id="pcbi.1006610.s004" mimetype="application/pdf" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1006610.s004" xlink:type="simple">
<label>S4 Text</label>
<caption>
<title>Gradients for Atlas informed model.</title>
<p>(PDF)</p>
</caption>
</supplementary-material>
</sec>
</body>
<back>
<ack>
<p>The authors would like to acknowledge Keerthi K Ram and Daniel Ferrante for all of their guidance in understanding the Mouse Brain Architecture Project datasets.</p>
</ack>
<ref-list>
<title>References</title>
<ref id="pcbi.1006610.ref001">
<label>1</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Hagmann</surname> <given-names>P</given-names></name>, <name name-style="western"><surname>Cammoun</surname> <given-names>L</given-names></name>, <name name-style="western"><surname>Gigandet</surname> <given-names>X</given-names></name>, <name name-style="western"><surname>Meuli</surname> <given-names>R</given-names></name>, <name name-style="western"><surname>Honey</surname> <given-names>CJ</given-names></name>, <name name-style="western"><surname>Wedeen</surname> <given-names>VJ</given-names></name>, <etal>et al</etal>. <article-title>Mapping the structural core of human cerebral cortex</article-title>. <source>PLoS Biology</source>. <year>2008</year>;<volume>6</volume>(<issue>7</issue>). <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1371/journal.pbio.0060159" xlink:type="simple">10.1371/journal.pbio.0060159</ext-link></comment> <object-id pub-id-type="pmid">18597554</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006610.ref002">
<label>2</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Rubinov</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Sporns</surname> <given-names>O</given-names></name>. <article-title>Complex network measures of brain connectivity: uses and interpretations</article-title>. <source>Neuroimage</source>. <year>2010</year>;<volume>52</volume>(<issue>3</issue>):<fpage>1059</fpage>–<lpage>1069</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.neuroimage.2009.10.003" xlink:type="simple">10.1016/j.neuroimage.2009.10.003</ext-link></comment> <object-id pub-id-type="pmid">19819337</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006610.ref003">
<label>3</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Taniguchi</surname> <given-names>H</given-names></name>, <name name-style="western"><surname>He</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Wu</surname> <given-names>P</given-names></name>, <name name-style="western"><surname>Kim</surname> <given-names>S</given-names></name>, <name name-style="western"><surname>Paik</surname> <given-names>R</given-names></name>, <name name-style="western"><surname>Sugino</surname> <given-names>K</given-names></name>, <etal>et al</etal>. <article-title>A resource of cre driver lines for genetic targeting of gabaergic neurons in cerebral cortex</article-title>. <source>Neuron</source>. <year>2011</year>;<volume>71</volume>(<issue>6</issue>):<fpage>995</fpage>–<lpage>1013</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.neuron.2011.07.026" xlink:type="simple">10.1016/j.neuron.2011.07.026</ext-link></comment> <object-id pub-id-type="pmid">21943598</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006610.ref004">
<label>4</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Kasthuri</surname> <given-names>N</given-names></name>, <name name-style="western"><surname>Lichtman</surname> <given-names>JW</given-names></name>. <article-title>The rise of the ‘projectome’</article-title>. <source>Nature Methods</source>. <year>2007</year>;<volume>4</volume>(<issue>4</issue>):<fpage>307</fpage>–<lpage>309</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1038/nmeth0407-307" xlink:type="simple">10.1038/nmeth0407-307</ext-link></comment> <object-id pub-id-type="pmid">17396125</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006610.ref005">
<label>5</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Mitra</surname> <given-names>PP</given-names></name>. <article-title>The circuit architecture of whole brains at the mesoscopic scale</article-title>. <source>Neuron</source>. <year>2014</year>;<volume>83</volume>(<issue>6</issue>):<fpage>1273</fpage>–<lpage>1283</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.neuron.2014.08.055" xlink:type="simple">10.1016/j.neuron.2014.08.055</ext-link></comment> <object-id pub-id-type="pmid">25233311</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006610.ref006">
<label>6</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Sporns</surname> <given-names>O</given-names></name>. <article-title>The human connectome: a complex network</article-title>. <source>Annals of the New York Academy of Sciences</source>. <year>2011</year>;<volume>1224</volume>(<issue>1</issue>):<fpage>109</fpage>–<lpage>125</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1111/j.1749-6632.2010.05888.x" xlink:type="simple">10.1111/j.1749-6632.2010.05888.x</ext-link></comment> <object-id pub-id-type="pmid">21251014</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006610.ref007">
<label>7</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Hagmann</surname> <given-names>P</given-names></name>, <name name-style="western"><surname>Kurant</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Gigandet</surname> <given-names>X</given-names></name>, <name name-style="western"><surname>Thiran</surname> <given-names>P</given-names></name>, <name name-style="western"><surname>Wedeen</surname> <given-names>VJ</given-names></name>, <name name-style="western"><surname>Meuli</surname> <given-names>R</given-names></name>, <etal>et al</etal>. <article-title>Mapping human whole-brain structural networks with diffusion MRI</article-title>. <source>PLoS One</source>. <year>2007</year>;<volume>2</volume>(<issue>7</issue>). <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1371/journal.pone.0000597" xlink:type="simple">10.1371/journal.pone.0000597</ext-link></comment> <object-id pub-id-type="pmid">17611629</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006610.ref008">
<label>8</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Osten</surname> <given-names>P</given-names></name>, <name name-style="western"><surname>Margrie</surname> <given-names>TW</given-names></name>. <article-title>Mapping brain circuitry with a light microscope</article-title>. <source>Nature Methods</source>. <year>2013</year>;<volume>10</volume>(<issue>6</issue>):<fpage>515</fpage>–<lpage>523</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1038/nmeth.2477" xlink:type="simple">10.1038/nmeth.2477</ext-link></comment> <object-id pub-id-type="pmid">23722211</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006610.ref009">
<label>9</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Okano</surname> <given-names>H</given-names></name>, <name name-style="western"><surname>Mitra</surname> <given-names>PP</given-names></name>. <article-title>Brain-mapping projects using the common marmoset</article-title>. <source>Neuroscience research</source>. <year>2015</year>;<volume>93</volume>:<fpage>3</fpage>–<lpage>7</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.neures.2014.08.014" xlink:type="simple">10.1016/j.neures.2014.08.014</ext-link></comment> <object-id pub-id-type="pmid">25264372</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006610.ref010">
<label>10</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Papp</surname> <given-names>EA</given-names></name>, <name name-style="western"><surname>Leergaard</surname> <given-names>TB</given-names></name>, <name name-style="western"><surname>Csucs</surname> <given-names>G</given-names></name>, <name name-style="western"><surname>Bjaalie</surname> <given-names>JG</given-names></name>. <article-title>Brain-wide mapping of axonal connections: workflow for automated detection and spatial analysis of labeling in microscopic sections</article-title>. <source>Frontiers in neuroinformatics</source>. <year>2016</year>;<volume>10</volume>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.3389/fninf.2016.00011" xlink:type="simple">10.3389/fninf.2016.00011</ext-link></comment> <object-id pub-id-type="pmid">27148038</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006610.ref011">
<label>11</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Pinksly</surname> <given-names>V</given-names></name>, <name name-style="western"><surname>Jones</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Tolpygo</surname> <given-names>AS</given-names></name>, <name name-style="western"><surname>Franciotti</surname> <given-names>N</given-names></name>, <name name-style="western"><surname>Weber</surname> <given-names>K</given-names></name>, <name name-style="western"><surname>Mitra</surname> <given-names>PP</given-names></name>. <article-title>High-Throughput Method of Whole-Brain Sectioning, Using the Tape-Transfer Technique</article-title>. <source>PLoS One</source>. <year>2015</year>;<volume>10</volume>(<issue>7</issue>).</mixed-citation>
</ref>
<ref id="pcbi.1006610.ref012">
<label>12</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Malandain</surname> <given-names>G</given-names></name>, <name name-style="western"><surname>Bardinet</surname> <given-names>E</given-names></name>, <name name-style="western"><surname>Nelissen</surname> <given-names>K</given-names></name>, <name name-style="western"><surname>Vanduffel</surname> <given-names>W</given-names></name>. <article-title>Fusion of autoradiographs with an MR volume using 2-D and 3-D linear transformations</article-title>. <source>Neuroimage</source>. <year>2004</year>;<volume>23</volume>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.neuroimage.2004.04.038" xlink:type="simple">10.1016/j.neuroimage.2004.04.038</ext-link></comment> <object-id pub-id-type="pmid">15325358</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006610.ref013">
<label>13</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Ourselin</surname> <given-names>S</given-names></name>, <name name-style="western"><surname>Roche</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Subsol</surname> <given-names>G</given-names></name>, <name name-style="western"><surname>Pennec</surname> <given-names>X</given-names></name>, <name name-style="western"><surname>Ayache</surname> <given-names>N</given-names></name>. <article-title>Reconstructing a 3D structure from serial histological sections</article-title>. <source>Image Vision Comput. Image Vision Comput</source>. <year>2001</year>;<volume>19</volume>(<issue>1</issue>).</mixed-citation>
</ref>
<ref id="pcbi.1006610.ref014">
<label>14</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Streicher</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Weninger</surname> <given-names>W</given-names></name>, <name name-style="western"><surname>Muller</surname> <given-names>G</given-names></name>. <article-title>External marker-based automatic congruencing: a new method of 3D reconstruction from serial sections</article-title>. <source>Anat Rec</source>. <year>1997</year>;<volume>248</volume>(<issue>4</issue>):<fpage>583</fpage>–<lpage>602</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1002/(SICI)1097-0185(199708)248:4%3C583::AID-AR10%3E3.0.CO;2-L" xlink:type="simple">10.1002/(SICI)1097-0185(199708)248:4%3C583::AID-AR10%3E3.0.CO;2-L</ext-link></comment> <object-id pub-id-type="pmid">9268147</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006610.ref015">
<label>15</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Dauguet</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Delzescaux</surname> <given-names>T</given-names></name>, <name name-style="western"><surname>Conde</surname> <given-names>F</given-names></name>, <name name-style="western"><surname>Mangin</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Ayache</surname> <given-names>N</given-names></name>, <name name-style="western"><surname>Hantraye</surname> <given-names>P</given-names></name>. <article-title>Three-dimensional reconstruction of stained histological slices and 3D non-linear registration with in vivo MRI for whole baboon brain</article-title>. <source>J Neurosci Methods</source>. <year>2007</year>;<volume>164</volume>(<issue>1</issue>):<fpage>191</fpage>–<lpage>204</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.jneumeth.2007.04.017" xlink:type="simple">10.1016/j.jneumeth.2007.04.017</ext-link></comment> <object-id pub-id-type="pmid">17560659</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006610.ref016">
<label>16</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Adler</surname> <given-names>DH</given-names></name>, <name name-style="western"><surname>Pluta</surname> <given-names>J</given-names></name>, <name name-style="western"><surname>Kadivar</surname> <given-names>S</given-names></name>, <name name-style="western"><surname>Craige</surname> <given-names>C</given-names></name>, <name name-style="western"><surname>Gee</surname> <given-names>JC</given-names></name>, <name name-style="western"><surname>Avants</surname> <given-names>BB</given-names></name>, <etal>et al</etal>. <article-title>Histology-derived volumetric annotation of the human hippocampal subfields in postmortem MRI</article-title>. <source>Neuroimage</source>. <year>2014</year>;<volume>84</volume>:<fpage>505</fpage>–<lpage>23</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.neuroimage.2013.08.067" xlink:type="simple">10.1016/j.neuroimage.2013.08.067</ext-link></comment> <object-id pub-id-type="pmid">24036353</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006610.ref017">
<label>17</label>
<mixed-citation publication-type="book" xlink:type="simple">
<name name-style="western"><surname>Mai</surname> <given-names>JK</given-names></name>, <name name-style="western"><surname>Paxinos</surname> <given-names>G</given-names></name>. <source>The Human Nervous System</source>. <publisher-name>Academic Press</publisher-name>; <year>2011</year>.</mixed-citation>
</ref>
<ref id="pcbi.1006610.ref018">
<label>18</label>
<mixed-citation publication-type="book" xlink:type="simple">
<name name-style="western"><surname>Mori</surname> <given-names>S</given-names></name>, <name name-style="western"><surname>Oishi</surname> <given-names>K</given-names></name>, <name name-style="western"><surname>Faria</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Zijl</surname> <given-names>PCM</given-names></name>. <source>MRI Atlas of Human White Matter</source>. <publisher-name>Elsevier</publisher-name>; <year>2005</year>.</mixed-citation>
</ref>
<ref id="pcbi.1006610.ref019">
<label>19</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Chuang</surname> <given-names>N</given-names></name>, <name name-style="western"><surname>Mori</surname> <given-names>S</given-names></name>, <name name-style="western"><surname>Yamamoto</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Jiang</surname> <given-names>H</given-names></name>, <name name-style="western"><surname>Ye</surname> <given-names>X</given-names></name>, <name name-style="western"><surname>Xu</surname> <given-names>X</given-names></name>, <etal>et al</etal>. <article-title>An MRI-based atlas and database of the developing mouse brain</article-title>. <source>Neuroimage</source>. <year>2011</year>;<volume>54</volume>(<issue>1</issue>):<fpage>80</fpage>–<lpage>89</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.neuroimage.2010.07.043" xlink:type="simple">10.1016/j.neuroimage.2010.07.043</ext-link></comment> <object-id pub-id-type="pmid">20656042</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006610.ref020">
<label>20</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Mori</surname> <given-names>S</given-names></name>, <name name-style="western"><surname>Oishi</surname> <given-names>K</given-names></name>, <name name-style="western"><surname>Faria</surname> <given-names>AV</given-names></name>, <name name-style="western"><surname>Miller</surname> <given-names>MI</given-names></name>. <article-title>Atlas-Based Neuroinformatics via MRI: Harnessing Information from Past Clinical Cases and Quantitative Image Analysis for Patient Care</article-title>. <source>Annual Review of Biomedical Engineering</source>. <year>2013</year>;<volume>15</volume>:<fpage>71</fpage>–<lpage>92</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1146/annurev-bioeng-071812-152335" xlink:type="simple">10.1146/annurev-bioeng-071812-152335</ext-link></comment> <object-id pub-id-type="pmid">23642246</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006610.ref021">
<label>21</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Christensen</surname> <given-names>G</given-names></name>, <name name-style="western"><surname>Miller</surname> <given-names>MI</given-names></name>, <name name-style="western"><surname>Rabbit</surname> <given-names>RD</given-names></name>. <article-title>Deformable templates using large deformation kinematics</article-title>. <source>IEEE Transactions of Medical Imaging</source>. <year>1995</year>;<volume>5</volume>:<fpage>1435</fpage>–<lpage>1447</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1109/83.536892" xlink:type="simple">10.1109/83.536892</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1006610.ref022">
<label>22</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Miller</surname> <given-names>MI</given-names></name>, <name name-style="western"><surname>Trouvé</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Younes</surname> <given-names>L</given-names></name>. <article-title>Diffeomorphometry and geodesic positioning systems for human anatomy</article-title>. <source>Technology</source>. <year>2014</year>;<volume>1</volume>:<fpage>36</fpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1142/S2339547814500010" xlink:type="simple">10.1142/S2339547814500010</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1006610.ref023">
<label>23</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Tward</surname> <given-names>DJ</given-names></name>, <name name-style="western"><surname>Miller</surname> <given-names>MI</given-names></name>, <name name-style="western"><surname>Trouvé</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Younes</surname> <given-names>L</given-names></name>. <article-title>Parametric Surface Diffeomorphometry for Low Dimensional Embeddings of Dense Segmentations and Imagery</article-title>. <source>IEEE Transactions on Pattern Analysis and Machine Intelligence</source>. <year>2016</year>;PP:<fpage>99</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1006610.ref024">
<label>24</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Grenander</surname> <given-names>U</given-names></name>, <name name-style="western"><surname>Miller</surname> <given-names>MI</given-names></name>. <article-title>Computational anatomy: An emerging discipline</article-title>. <source>Quarterly of Applied Mathematics</source>. <year>1998</year>;<volume>56</volume>(<issue>4</issue>):<fpage>617</fpage>–<lpage>694</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1090/qam/1668732" xlink:type="simple">10.1090/qam/1668732</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1006610.ref025">
<label>25</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Beg</surname> <given-names>MF</given-names></name>, <name name-style="western"><surname>Miller</surname> <given-names>MI</given-names></name>, <name name-style="western"><surname>Trouvé</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Younes</surname> <given-names>L</given-names></name>. <article-title>Computing Large Deformation Metric Mappings via Geodesic Flows of Diffeomorphisms</article-title>. <source>International Journal of Computer Vision</source>. <year>2005</year>;<volume>61</volume>(<issue>2</issue>):<fpage>139</fpage>–<lpage>157</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1023/B:VISI.0000043755.93987.aa" xlink:type="simple">10.1023/B:VISI.0000043755.93987.aa</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1006610.ref026">
<label>26</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Lein</surname> <given-names>ES</given-names></name>, <etal>et al</etal>. <article-title>Genome-wide atlas of gene expression in the adult mouse brain</article-title>. <source>Nature</source>. <year>2007</year>;<volume>445</volume>:<fpage>168</fpage>–<lpage>176</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1038/nature05453" xlink:type="simple">10.1038/nature05453</ext-link></comment> <object-id pub-id-type="pmid">17151600</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006610.ref027">
<label>27</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Miller</surname> <given-names>MI</given-names></name>, <name name-style="western"><surname>Trouvé</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Younes</surname> <given-names>L</given-names></name>. <article-title>Geodesic Shooting for Computational Anatomy</article-title>. <source>Journal of Mathematical Imaging and Vision</source>. <year>2006</year>;<volume>24</volume>(<issue>2</issue>):<fpage>209</fpage>–<lpage>228</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1007/s10851-005-3624-0" xlink:type="simple">10.1007/s10851-005-3624-0</ext-link></comment> <object-id pub-id-type="pmid">20613972</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006610.ref028">
<label>28</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Miller</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Younes</surname> <given-names>L</given-names></name>. <article-title>Group Actions, Homeomorphisms, and Matching: A General Framework</article-title>. <source>International Journal of Computer Vision</source>. <year>2001</year>;<volume>41</volume>(<issue>4</issue>):<fpage>61</fpage>–<lpage>84</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1023/A:1011161132514" xlink:type="simple">10.1023/A:1011161132514</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1006610.ref029">
<label>29</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Miller</surname> <given-names>MI</given-names></name>, <name name-style="western"><surname>Trouvé</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Younes</surname> <given-names>L</given-names></name>. <article-title>Hamiltonian Systems and Optimal Control in Computational Anatomy: 100 Years Since D’Arcy Thompson</article-title>. <source>Annual Review of Biomed Engineering</source>. <year>2015</year>;(<issue>17</issue>):<fpage>447</fpage>–<lpage>509</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1146/annurev-bioeng-071114-040601" xlink:type="simple">10.1146/annurev-bioeng-071114-040601</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1006610.ref030">
<label>30</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Miller</surname> <given-names>MI</given-names></name>, <name name-style="western"><surname>Trouvé</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Younes</surname> <given-names>L</given-names></name>. <article-title>On the metrics and euler-lagrange equations of computational anatomy</article-title>. <source>Annual Review of Biomedical Engineering</source>. <year>2002</year>;<volume>4</volume>(<issue>1</issue>):<fpage>375</fpage>–<lpage>405</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1146/annurev.bioeng.4.092101.125733" xlink:type="simple">10.1146/annurev.bioeng.4.092101.125733</ext-link></comment> <object-id pub-id-type="pmid">12117763</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006610.ref031">
<label>31</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Lanterman</surname> <given-names>AD</given-names></name>, <name name-style="western"><surname>Grenander</surname> <given-names>U</given-names></name>, <name name-style="western"><surname>Miller</surname> <given-names>MI</given-names></name>. <article-title>Bayesian Segmentation via Asymptotic Partition Functions</article-title>. <source>IEEE Trans on Pattern Analysis and Machine Intelligence</source>. <year>2000</year>;<volume>22</volume>(<issue>4</issue>):<fpage>337</fpage>–<lpage>347</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1006610.ref032">
<label>32</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Ceritoglu</surname> <given-names>C</given-names></name>, <name name-style="western"><surname>Oishi</surname> <given-names>K</given-names></name>, <name name-style="western"><surname>Li</surname> <given-names>X</given-names></name>, <name name-style="western"><surname>Chou</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Younes</surname> <given-names>L</given-names></name>, <name name-style="western"><surname>Albert</surname> <given-names>M</given-names></name>, <etal>et al</etal>. <article-title>Multi-contrast large deformation diffeomorphic metric mapping for diffusion tensor imaging</article-title>. <source>Neuroimage</source>. <year>2009</year>;<volume>47</volume>(<issue>2</issue>):<fpage>618</fpage>–<lpage>27</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.neuroimage.2009.04.057" xlink:type="simple">10.1016/j.neuroimage.2009.04.057</ext-link></comment> <object-id pub-id-type="pmid">19398016</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006610.ref033">
<label>33</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Cao</surname> <given-names>Y</given-names></name>, <name name-style="western"><surname>Miller</surname> <given-names>MI</given-names></name>, <name name-style="western"><surname>Winslow</surname> <given-names>RL</given-names></name>, <name name-style="western"><surname>Younes</surname> <given-names>L</given-names></name>. <article-title>Large deformation diffeomorphic metric mapping of vector fields</article-title>. <source>IEEE Transactions on Medical Imaging</source>. <year>2005</year>;<volume>24</volume>(<issue>9</issue>):<fpage>1216</fpage>–<lpage>1230</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1109/TMI.2005.853923" xlink:type="simple">10.1109/TMI.2005.853923</ext-link></comment> <object-id pub-id-type="pmid">16156359</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006610.ref034">
<label>34</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Beg</surname> <given-names>MF</given-names></name>, <name name-style="western"><surname>Helm</surname> <given-names>PA</given-names></name>, <name name-style="western"><surname>McVeigh</surname> <given-names>E</given-names></name>, <name name-style="western"><surname>Miller</surname> <given-names>MI</given-names></name>, <name name-style="western"><surname>Winslow</surname> <given-names>RL</given-names></name>. <article-title>Computational cardiac anatomy using MRI</article-title>. <source>Magnetic Resonance in Medicine: An Official Journal of the International Society for Magnetic Resonance in Medicine</source>. <year>2004</year>;<volume>52</volume>(<issue>5</issue>):<fpage>1167</fpage>–<lpage>1174</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1002/mrm.20255" xlink:type="simple">10.1002/mrm.20255</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1006610.ref035">
<label>35</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Vigmond</surname> <given-names>E</given-names></name>, <name name-style="western"><surname>Vadakkumpadan</surname> <given-names>F</given-names></name>, <name name-style="western"><surname>Gurev</surname> <given-names>V</given-names></name>, <name name-style="western"><surname>Arevalo</surname> <given-names>H</given-names></name>, <name name-style="western"><surname>Deo</surname> <given-names>M</given-names></name>, <name name-style="western"><surname>Plank</surname> <given-names>G</given-names></name>, <name name-style="western"><surname>Trayanova</surname> <given-names>N</given-names></name>. <article-title>Towards predictive modelling of the electrophysiology of the heart</article-title>. <source>Experimental Physiology</source>. <year>2012</year>;<volume>94</volume>(<issue>5</issue>):<fpage>563</fpage>–<lpage>77</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1113/expphysiol.2008.044073" xlink:type="simple">10.1113/expphysiol.2008.044073</ext-link></comment></mixed-citation>
</ref>
<ref id="pcbi.1006610.ref036">
<label>36</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Tward</surname> <given-names>DJ</given-names></name>, <name name-style="western"><surname>Ceritoglu</surname> <given-names>C</given-names></name>, <name name-style="western"><surname>Kolasny</surname> <given-names>A</given-names></name>, <name name-style="western"><surname>Sturgeon</surname> <given-names>GM</given-names></name>, <name name-style="western"><surname>Segars</surname> <given-names>WP</given-names></name>, <name name-style="western"><surname>Miller</surname> <given-names>MI</given-names></name>, <name name-style="western"><surname>Ratnanather</surname> <given-names>JT</given-names></name>. <article-title>Patient Specific Dosimetry Phantoms Using Multichannel LDDMM of the Whole Body</article-title>. <source>International Journal of Biomedical Imaging</source>. <year>2011</year>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1155/2011/481064" xlink:type="simple">10.1155/2011/481064</ext-link></comment> <object-id pub-id-type="pmid">21960989</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006610.ref037">
<label>37</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Ashburner</surname> <given-names>J</given-names></name>. <article-title>A fast diffeomorphic image registration algorithm</article-title>. <source>Neuroimage</source>. <year>2007</year>;<volume>38</volume>(<issue>1</issue>):<fpage>95</fpage>–<lpage>113</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.neuroimage.2007.07.007" xlink:type="simple">10.1016/j.neuroimage.2007.07.007</ext-link></comment> <object-id pub-id-type="pmid">17761438</object-id></mixed-citation>
</ref>
<ref id="pcbi.1006610.ref038">
<label>38</label>
<mixed-citation publication-type="journal" xlink:type="simple">
<name name-style="western"><surname>Ashburner</surname> <given-names>J</given-names></name>. <article-title>Computational Anatomy with the SPM Software</article-title>. <source>Magnetic Resonance Imaging</source>. <year>2009</year>;<volume>27</volume>(<issue>8</issue>):<fpage>1163</fpage>–<lpage>1174</lpage>. <comment>doi: <ext-link ext-link-type="uri" xlink:href="https://doi.org/10.1016/j.mri.2009.01.006" xlink:type="simple">10.1016/j.mri.2009.01.006</ext-link></comment> <object-id pub-id-type="pmid">19249168</object-id></mixed-citation>
</ref>
</ref-list>
</back>
</article>