<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article
  PUBLIC "-//NLM//DTD Journal Publishing DTD v3.0 20080202//EN" "http://dtd.nlm.nih.gov/publishing/3.0/journalpublishing3.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="3.0" xml:lang="EN">
<front>
<journal-meta><journal-id journal-id-type="publisher-id">plos</journal-id><journal-id journal-id-type="nlm-ta">PLoS Comput Biol</journal-id><journal-id journal-id-type="pmc">ploscomp</journal-id><!--===== Grouping journal title elements =====--><journal-title-group><journal-title>PLoS Computational Biology</journal-title></journal-title-group><issn pub-type="ppub">1553-734X</issn><issn pub-type="epub">1553-7358</issn><publisher>
<publisher-name>Public Library of Science</publisher-name>
<publisher-loc>San Francisco, USA</publisher-loc></publisher></journal-meta>
<article-meta><article-id pub-id-type="publisher-id">10-PLCB-RA-2047R3</article-id><article-id pub-id-type="doi">10.1371/journal.pcbi.1000885</article-id><article-categories><subj-group subj-group-type="heading"><subject>Research Article</subject></subj-group><subj-group subj-group-type="Discipline"><subject>Computational Biology/Evolutionary Modeling</subject><subject>Evolutionary Biology/Bioinformatics</subject></subj-group></article-categories><title-group><article-title>CodonTest: Modeling Amino Acid Substitution Preferences in Coding Sequences</article-title><alt-title alt-title-type="running-head">Codon Model Selection</alt-title></title-group><contrib-group>
<contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Delport</surname><given-names>Wayne</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref></contrib>
<contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Scheffler</surname><given-names>Konrad</given-names></name><xref ref-type="aff" rid="aff2"><sup>2</sup></xref></contrib>
<contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Botha</surname><given-names>Gordon</given-names></name><xref ref-type="aff" rid="aff2"><sup>2</sup></xref></contrib>
<contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Gravenor</surname><given-names>Mike B.</given-names></name><xref ref-type="aff" rid="aff3"><sup>3</sup></xref></contrib>
<contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Muse</surname><given-names>Spencer V.</given-names></name><xref ref-type="aff" rid="aff4"><sup>4</sup></xref></contrib>
<contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Kosakovsky Pond</surname><given-names>Sergei L.</given-names></name><xref ref-type="aff" rid="aff5"><sup>5</sup></xref><xref ref-type="corresp" rid="cor1"><sup>*</sup></xref></contrib>
</contrib-group><aff id="aff1"><label>1</label><addr-line>Department of Pathology, University of California, San Diego, La Jolla, California, United States of America</addr-line>       </aff><aff id="aff2"><label>2</label><addr-line>Computer Science Division, Department of Mathematical Sciences, Stellenbosch University, Stellenbosch, South Africa</addr-line>       </aff><aff id="aff3"><label>3</label><addr-line>School of Medicine, University of Swansea, Swansea, United Kingdom</addr-line>       </aff><aff id="aff4"><label>4</label><addr-line>Department of Statistics, North Carolina State University, Raleigh, North Carolina, United States of America</addr-line>       </aff><aff id="aff5"><label>5</label><addr-line>Department of Medicine, University of California, San Diego, La Jolla, California, United States of America</addr-line>       </aff><contrib-group>
<contrib contrib-type="editor" xlink:type="simple"><name name-style="western"><surname>Li</surname><given-names>Wen-Hsiung</given-names></name>
<role>Editor</role>
<xref ref-type="aff" rid="edit1"/></contrib>
</contrib-group><aff id="edit1">University of Chicago, United States of America</aff><author-notes>
<corresp id="cor1">* E-mail: <email xlink:type="simple">spond@ucsd.edu</email></corresp>
<fn fn-type="con"><p>Conceived and designed the experiments: KS MBG SVM SLKP. Performed the experiments: WD GB SLKP. Analyzed the data: WD SLKP. Contributed reagents/materials/analysis tools: MBG SLKP. Wrote the paper: WD KS SVM SLKP.</p></fn>
<fn fn-type="conflict"><p>The authors have declared that no competing interests exist.</p></fn></author-notes><pub-date pub-type="collection"><month>8</month><year>2010</year></pub-date><pub-date pub-type="epub"><day>19</day><month>8</month><year>2010</year></pub-date><volume>6</volume><issue>8</issue><elocation-id>e1000885</elocation-id><history>
<date date-type="received"><day>3</day><month>4</month><year>2010</year></date>
<date date-type="accepted"><day>14</day><month>7</month><year>2010</year></date>
</history><!--===== Grouping copyright info into permissions =====--><permissions><copyright-year>2010</copyright-year><copyright-holder>Delport et al</copyright-holder><license><license-p>This is an open-access article distributed under the terms of the Creative Commons Attribution License, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p></license></permissions><abstract>
<p>Codon models of evolution have facilitated the interpretation of selective forces operating on genomes. These models, however, assume a single rate of non-synonymous substitution irrespective of the nature of amino acids being exchanged. Recent developments have shown that models which allow for amino acid pairs to have independent rates of substitution offer improved fit over single rate models. However, these approaches have been limited by the necessity for large alignments in their estimation. An alternative approach is to assume that substitution rates between amino acid pairs can be subdivided into <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e001" xlink:type="simple"/></inline-formula> rate classes, dependent on the information content of the alignment. However, given the combinatorially large number of such models, an efficient model search strategy is needed. Here we develop a Genetic Algorithm (GA) method for the estimation of such models. A GA is used to assign amino acid substitution pairs to a series of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e002" xlink:type="simple"/></inline-formula> rate classes, where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e003" xlink:type="simple"/></inline-formula> is estimated from the alignment. Other parameters of the phylogenetic Markov model, including substitution rates, character frequencies and branch lengths are estimated using standard maximum likelihood optimization procedures. We apply the GA to empirical alignments and show improved model fit over existing models of codon evolution. Our results suggest that current models are poor approximations of protein evolution and thus gene and organism specific multi-rate models that incorporate amino acid substitution biases are preferred. We further anticipate that the clustering of amino acid substitution rates into classes will be biologically informative, such that genes with similar functions exhibit similar clustering, and hence this clustering will be useful for the evolutionary fingerprinting of genes.</p>
</abstract><abstract abstract-type="summary"><title>Author Summary</title>
<p>Evolution in protein-coding DNA sequences can be modeled at three levels: nucleotides, amino acids or codons that encode the amino acids. Codon models incorporate nucleotide and amino acid information, and allow the estimation of the rate at which amino acids are replaced (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e004" xlink:type="simple"/></inline-formula>) versus the rate at which they are preserved (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e005" xlink:type="simple"/></inline-formula>). The <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e006" xlink:type="simple"/></inline-formula> ratio has been used in thousands of studies to detect molecular footprints of natural selection. A serious limitation of most codon models is the unrealistic assumption that all non-synonymous substitutions occur at the same rate. Indeed, amino acid models have consistently demonstrated that different residues are exchanged more or less frequently, depending on incompletely understood factors. We derive and validate a computational approach for inferring codon models which combine the power to investigate natural selection with data-driven amino acid substitution biases from alignments. The addition of amino acid properties can lead to more powerful and accurate methods for studying natural selection and the evolutionary history of protein-coding sequences. The pattern of amino acid substitutions specific to a given alignment can be used to compare and contrast the evolutionary properties of different genes, providing an evolutionary analog to protein family comparisons.</p>
</abstract><funding-group><funding-statement>This research was supported by the Joint DMS/NIGMS Mathematical Biology Initiative through Grant NSF-0714991, the National Institutes of Health (AI47745), and by a University of California, San Diego Center for AIDS Research/NIAID Developmental Award to WD and SLKP (AI36214). The funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.</funding-statement></funding-group><counts><page-count count="17"/></counts></article-meta>
</front>
<body><sec id="s1">
<title>Introduction</title>
<p>Modern molecular evolution has benefited greatly from the development of a sound probabilistic framework for modeling the evolution of homologous gene sequences <xref ref-type="bibr" rid="pcbi.1000885-Felsenstein1">[1]</xref>. In particular, codon substitution models <xref ref-type="bibr" rid="pcbi.1000885-Muse1">[2]</xref>, <xref ref-type="bibr" rid="pcbi.1000885-Goldman1">[3]</xref> have facilitated the estimation of the ratio of non-synonymous to synonymous substitution rates (referred to as <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e007" xlink:type="simple"/></inline-formula>), which can be interpreted as an indicator of the strength and type of natural selection (see <xref ref-type="bibr" rid="pcbi.1000885-Anisimova1">[4]</xref> or <xref ref-type="bibr" rid="pcbi.1000885-Delport1">[5]</xref> for recent reviews). Codon models are fundamentally mechanistic because they use the structure of the genetic code to partition codon substitutions into classes. Initially, and in most subsequent applications of codon models, all one-nucleotide substitutions were stratified into synonymous (rate <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e008" xlink:type="simple"/></inline-formula>, using the notation of <xref ref-type="bibr" rid="pcbi.1000885-Muse1">[2]</xref>) and non-synonymous (rate <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e009" xlink:type="simple"/></inline-formula>) classes. Despite several early attempts, e.g. <xref ref-type="bibr" rid="pcbi.1000885-Goldman1">[3]</xref>, none of the widely-adopted codon models incorporated physicochemical properties of the two residues being exchanged. In contrast, most protein substitution models are derived by estimating the relative rates of amino-acid substitutions in large protein databases <xref ref-type="bibr" rid="pcbi.1000885-Dayhoff1">[6]</xref>–<xref ref-type="bibr" rid="pcbi.1000885-Whelan1">[8]</xref>, and consistently report dramatic differences in the relative replacement rates of different residues.</p>
<p>The persisting dissonance between how codon and protein models approach amino acid substitution rates has fostered multiple recent efforts to develop what we will call <italic>multi-rate</italic> codon models (or more accurately, multi- nonsynonymous rate models), in contrast to the existing single-rate model. These models divide amino acid pairs (or codon pairs) into multiple rate categories, such that every category has its own rate which governs substitutions between the pairs in that category. In the most extreme case, every amino acid or codon pair belongs to a different category and thus has its own rate – potentially leading to a very large number of parameters that need to be estimated. Several strategies have been proposed for limiting the number of parameters in multi-rate models.</p>
<p>Doron-Faigenboim et al. <xref ref-type="bibr" rid="pcbi.1000885-DoronFaigenboim1">[9]</xref> proposed to overlay existing empirically derived amino acid substitution matrices (e.g. <xref ref-type="bibr" rid="pcbi.1000885-Jones1">[7]</xref> or <xref ref-type="bibr" rid="pcbi.1000885-Whelan1">[8]</xref>) onto single-rate codon models by weighted partitioning of the empirical rate of substitution between two protein residues. Kosiol, Holmes &amp; Goldman <xref ref-type="bibr" rid="pcbi.1000885-Kosiol1">[10]</xref> directly estimated all <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e010" xlink:type="simple"/></inline-formula> codon-to-codon substitution rates in an empirical codon model – a codon equivalent of the nucleotide GTR model <xref ref-type="bibr" rid="pcbi.1000885-Tavar1">[11]</xref>, assuming the universal genetic code. However, this effort required a truly massive training dataset encompassing alignments from <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e011" xlink:type="simple"/></inline-formula> protein families of the Pandit database <xref ref-type="bibr" rid="pcbi.1000885-Whelan2">[12]</xref>. The resulting empirical codon model (ECM) encodes evolution patterns averaged over many proteins. However, no single empirically-derived substitution rate matrix appears to be generalizable across multiple genes and taxonomic groups, as evidenced by a plethora of specialized substitution models, e.g. for mammalian mitochondrial genomes <xref ref-type="bibr" rid="pcbi.1000885-Adachi1">[13]</xref>, plant chloroplast genes <xref ref-type="bibr" rid="pcbi.1000885-Adachi2">[14]</xref>, viral reverse transcriptases <xref ref-type="bibr" rid="pcbi.1000885-Dimmic1">[15]</xref> or HIV-1 genes <xref ref-type="bibr" rid="pcbi.1000885-Nickle1">[16]</xref>.</p>
<p>More mechanistic parameters can be introduced to improve biological realism of codon-models. The linear combination of amino acid properties (LCAP) model <xref ref-type="bibr" rid="pcbi.1000885-Conant1">[17]</xref> expresses exchangeability of a pair of codons as an (exponentiated) linear combination of differences in five independently validated amino acid physicochemical properties. This parameterization incorporates weighting (or importance) coefficients inferred from the data to allow for differences in protein evolution between genes, shown to be significant and biologically meaningful in yeast proteins <xref ref-type="bibr" rid="pcbi.1000885-Conant2">[18]</xref>, and once again underscoring the utility of gene-specific evolutionary models.</p>
<p>All multi-rate codon models published to date have shown clear improvements in model fit over the single-rate model. However, multi-rate models in which substitutions were randomly assigned to classes easily outperform the single-rate model <xref ref-type="bibr" rid="pcbi.1000885-Delport2">[19]</xref> and thus it is a poor performance benchmark. At the other extreme of model space is the full time-reversible codon model, with <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e012" xlink:type="simple"/></inline-formula> parameters (or <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e013" xlink:type="simple"/></inline-formula>, if only single nucleotide substitutions are modeled), which will certainly suffer from massive over-fitting on single gene alignments. Over-parameterization can be reduced by “smoothing”, i.e. by grouping the rates into exchangeability classes based on the physicochemical properties of amino acids <xref ref-type="bibr" rid="pcbi.1000885-Sainudiin1">[20]</xref>. However, without a rigorous model selection framework, it is difficult to ascertain how well any particular smoothing approach fits the data. To appreciate how large the space of potential models is, consider that there are are approximately <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e014" xlink:type="simple"/></inline-formula> possible multi-rate codon models with <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e015" xlink:type="simple"/></inline-formula> nonsynonymous rate classes, and approximately <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e016" xlink:type="simple"/></inline-formula> possible models for <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e017" xlink:type="simple"/></inline-formula>. Given such a large search space it is impossible to evaluate even a small fraction of possible models exhaustively, and one cannot presume that any given model or a small set of models are sufficiently representative without exploring the alternatives.</p>
<p>Huelsenbeck et al. <xref ref-type="bibr" rid="pcbi.1000885-Huelsenbeck1">[21]</xref> examined a Bayesian approach to estimate empirical amino acid substitution models in which amino acid exchangeability classes are assigned using a Dirichlet process. However, a prior distribution needs to be specified for the number of classes (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e018" xlink:type="simple"/></inline-formula> = 2, 5, or 10), and mechanistic features of codon evolution are excluded. Models which combine empirical codon models and mechanistic parameters, such as <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e019" xlink:type="simple"/></inline-formula> and transition-transversion bias <xref ref-type="bibr" rid="pcbi.1000885-Kosiol1">[10]</xref>, have been shown to outperform the models which include only a single effect. This evidence highlights the necessity to model both mutational effects, which result in substitution preferences for particular amino acids, and selective effects, the result of fitness differences of alternate phenotypes. In this manuscript, we present an information-theoretic model selection procedure that extends the concept of ModelTest <xref ref-type="bibr" rid="pcbi.1000885-Posada1">[22]</xref>, formulated for nucleotide model selection, to codon models. Unlike ModelTest, which examines <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e020" xlink:type="simple"/></inline-formula> <italic>a priori</italic> defined models, we use a Genetic Algorithm (GA) to search the combinatorially large set of codon models (i.e. select the number of rate classes), to assign amino acid substitution rates to these classes, infer rate parameters and, finally, report a set of credible models given the data. Our group has successfully applied GAs to a variety of problems in evolutionary biology, including inference of lineage-specific selective regimes <xref ref-type="bibr" rid="pcbi.1000885-KosakovskyPond1">[23]</xref>, detecting recombination in homologous sequence alignments <xref ref-type="bibr" rid="pcbi.1000885-KosakovskyPond2">[24]</xref>, and model selection for paired RNA sequences <xref ref-type="bibr" rid="pcbi.1000885-KosakovskyPond3">[25]</xref>, where the GA was able to recover biologically relevant properties and outperformed all known mechanistic models.</p>
<p>Using simulated data, we demonstrate that GA model selection (under a sufficiently stringent model selection criterion) is not susceptible to over-fitting, and that codon alignments of typical size contains sufficient signal to reliably allocate non-synonymous substitutions into a small number of rate classes, typically <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e021" xlink:type="simple"/></inline-formula>. On empirical data sets, GA-selected codon substitution models consistently outperformed published empirical and mechanistic models. In addition to selecting a single best fitting model, the GA also estimates a set of credible models for an alignment. A weighted combination of models in the credible set enable model averaged phylogenetic <xref ref-type="bibr" rid="pcbi.1000885-Posada2">[26]</xref> and substitution rate matrix <xref ref-type="bibr" rid="pcbi.1000885-KosakovskyPond3">[25]</xref> inference and further reduces the risk of over-fitting. We anticipate that improvements in model realism will translate into improved sequence alignment, phylogeny estimation, and selection detection. Moreover, we hypothesize that the clustering of non-synonymous substitution rates into groups with the same rate parameter is shared by genes with similar biological and structural properties, and hence this clustering is informative for improving evolutionary fingerprinting of genes <xref ref-type="bibr" rid="pcbi.1000885-KosakovskyPond4">[27]</xref>.</p>
</sec><sec id="s2" sec-type="methods">
<title>Methods</title>
<sec id="s2a">
<title>Model definition</title>
<p>Models considered in this paper assume that codon substitutions along a branch in a phylogenetic tree can be described by an appropriately parameterized continuous-time homogeneous and stationary Markov process; an assumption ubiquitous in codon-evolution literature. The substitution process is uniquely defined by the rate matrix, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e022" xlink:type="simple"/></inline-formula>, whose elements <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e023" xlink:type="simple"/></inline-formula> denote the instantaneous substitution rate from codon <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e024" xlink:type="simple"/></inline-formula> to codon <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e025" xlink:type="simple"/></inline-formula>. Using <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e026" xlink:type="simple"/></inline-formula> to label the amino-acid encoded by codon <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e027" xlink:type="simple"/></inline-formula>, and assuming a universal genetic code with three stop codons (other codes can be handled with obvious modifications), matrix <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e028" xlink:type="simple"/></inline-formula> comprises 61×61 such elements, where<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e029" xlink:type="simple"/><label>(1)</label></disp-formula>Here, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e030" xlink:type="simple"/></inline-formula> denote equilibrium frequency parameters, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e031" xlink:type="simple"/></inline-formula> denote nucleotide mutational biases, and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e032" xlink:type="simple"/></inline-formula> denote the substitution rates between amino acids encoded by codons <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e033" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e034" xlink:type="simple"/></inline-formula>. How to infer <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e035" xlink:type="simple"/></inline-formula> is the primary focus of this paper. We consider two different parameterizations of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e036" xlink:type="simple"/></inline-formula>: the GY parameterization <xref ref-type="bibr" rid="pcbi.1000885-Goldman1">[3]</xref>, where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e037" xlink:type="simple"/></inline-formula> is the equilibrium frequency of the target <italic>codon</italic>, and the MG parameterization <xref ref-type="bibr" rid="pcbi.1000885-Muse1">[2]</xref>, where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e038" xlink:type="simple"/></inline-formula> is a <italic>nucleotide</italic> frequency parameter for the position that is being substituted (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e039" xlink:type="simple"/></inline-formula>; <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e040" xlink:type="simple"/></inline-formula>). For the GY parameterization, we estimate codon equilibrium frequencies by their proportions in the data (the F61 estimator, 60 parameters for the universal genetic code). For the MG parameterization, we estimate the nine frequency parameters by maximum likelihood <xref ref-type="bibr" rid="pcbi.1000885-KosakovskyPond5">[28]</xref>. The equilibrium frequency of codon <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e041" xlink:type="simple"/></inline-formula> can then be computed as<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e042" xlink:type="simple"/></disp-formula>where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e043" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e044" xlink:type="simple"/></inline-formula>.</p>
<p>Finally, we set <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e045" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e046" xlink:type="simple"/></inline-formula> and estimate <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e047" xlink:type="simple"/></inline-formula> other rates (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e048" xlink:type="simple"/></inline-formula>) by maximum likelihood; this parameterization follows the MG94<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e049" xlink:type="simple"/></inline-formula>REV model from <xref ref-type="bibr" rid="pcbi.1000885-KosakovskyPond6">[29]</xref>.</p>
</sec><sec id="s2b">
<title>Inferring non-synonymous substitution rates</title>
<p>By varying the parametric complexity of the non-synonymous substitution rate <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e050" xlink:type="simple"/></inline-formula> encoding in equation (1), we can span the range of models from the single rate model (SR, current default standard, 1 non-synonymous rate parameter), to the general codon time-reversible model (REV) with each amino-acid pair substitution exchanged at its own rate. Only 75 out of 190 total amino-acid pairs can be exchanged via a single nucleotide substitution, for example <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e051" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e052" xlink:type="simple"/></inline-formula> are one such pair, but <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e053" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e054" xlink:type="simple"/></inline-formula> are not. Consequently, the REV model has <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e055" xlink:type="simple"/></inline-formula> non-synonymous rate parameters. The purpose of our study is to explore the model space between these two extremes, taking into account the limitations of information content in single gene alignments. Note that most existing multi-rate models can be represented with an appropriate choice of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e056" xlink:type="simple"/></inline-formula> in equation (1). Empirical models (e.g. ECM) replace <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e057" xlink:type="simple"/></inline-formula> with numerical values estimated from large training data sets, whereas mechanistic models (e.g. LCAP) assume that rates can be modeled via a function measuring differences/similarities in physicochemical properties of residues (<xref ref-type="table" rid="pcbi-1000885-t001">Table 1</xref>).</p>
<table-wrap id="pcbi-1000885-t001" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1000885.t001</object-id><label>Table 1</label><caption>
<title>Various approaches to estimating residue-dependent non-synonymous substitution rates.</title>
</caption><!--===== Grouping alternate versions of objects =====--><alternatives><graphic id="pcbi-1000885-t001-1" mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000885.t001" xlink:type="simple"/><table><colgroup span="1"><col align="left" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/></colgroup>
<thead>
<tr>
<td align="left" colspan="1" rowspan="1">Model</td>
<td align="left" colspan="1" rowspan="1"><inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e058" xlink:type="simple"/></inline-formula></td>
<td align="left" colspan="1" rowspan="1">p</td>
<td align="left" colspan="1" rowspan="1">Description</td>
</tr>
</thead>
<tbody>
<tr>
<td align="left" colspan="1" rowspan="1">Single rate</td>
<td align="left" colspan="1" rowspan="1"><inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e059" xlink:type="simple"/></inline-formula></td>
<td align="left" colspan="1" rowspan="1">1</td>
<td align="left" colspan="1" rowspan="1"/>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">Random – X</td>
<td align="left" colspan="1" rowspan="1"><inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e060" xlink:type="simple"/></inline-formula></td>
<td align="left" colspan="1" rowspan="1">X</td>
<td align="left" colspan="1" rowspan="1">Rates randomly assigned to <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e061" xlink:type="simple"/></inline-formula> classes</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">ECM</td>
<td align="left" colspan="1" rowspan="1"><inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e062" xlink:type="simple"/></inline-formula></td>
<td align="left" colspan="1" rowspan="1">0</td>
<td align="left" colspan="1" rowspan="1">Codon level rates <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e063" xlink:type="simple"/></inline-formula> are inferred from a large training data set</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">ECM+<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e064" xlink:type="simple"/></inline-formula></td>
<td align="left" colspan="1" rowspan="1"><inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e065" xlink:type="simple"/></inline-formula></td>
<td align="left" colspan="1" rowspan="1">1</td>
<td align="left" colspan="1" rowspan="1">Codon level rates <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e066" xlink:type="simple"/></inline-formula> are inferred from a large training data set</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1">Correction parameter <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e067" xlink:type="simple"/></inline-formula> inferred from the data</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">LCAP</td>
<td align="left" colspan="1" rowspan="1"><inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e068" xlink:type="simple"/></inline-formula></td>
<td align="left" colspan="1" rowspan="1">5</td>
<td align="left" colspan="1" rowspan="1">Based on a weighted combination of 5 physico-chemical distances <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e069" xlink:type="simple"/></inline-formula></td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">GA - X</td>
<td align="left" colspan="1" rowspan="1"><inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e070" xlink:type="simple"/></inline-formula></td>
<td align="left" colspan="1" rowspan="1">X</td>
<td align="left" colspan="1" rowspan="1">X and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e071" xlink:type="simple"/></inline-formula> are inferred by the GA</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">REV</td>
<td align="left" colspan="1" rowspan="1"><inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e072" xlink:type="simple"/></inline-formula></td>
<td align="left" colspan="1" rowspan="1">75</td>
<td align="left" colspan="1" rowspan="1">Each unique residue pair within one nucleotide substitution has its own rate</td>
</tr>
</tbody>
</table></alternatives><table-wrap-foot><fn id="nt101"><label/><p><inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e073" xlink:type="simple"/></inline-formula> = number of model parameters estimated from the data. <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e074" xlink:type="simple"/></inline-formula> denotes rates that are estimated by maximum likelihood by the data and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e075" xlink:type="simple"/></inline-formula> – those that are estimated in other ways.</p></fn></table-wrap-foot></table-wrap>
<p>We focus on structured (or rate clustering) models: those which assume that substitution rates can be partitioned/structured into <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e076" xlink:type="simple"/></inline-formula> classes, where each class has a single estimated rate parameter. These structured models may be defined using amino acid similarity classes <xref ref-type="bibr" rid="pcbi.1000885-Stanfel1">[30]</xref>, but instead of adopting <italic>a priori</italic> classes of rates, we propose to <italic>infer</italic> their number and identity from the data. A structured model with <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e077" xlink:type="simple"/></inline-formula> substitutions (e.g. <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e078" xlink:type="simple"/></inline-formula> for the Universal genetic code) in <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e079" xlink:type="simple"/></inline-formula> classes can be represented as a vector <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e080" xlink:type="simple"/></inline-formula> of length <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e081" xlink:type="simple"/></inline-formula>, where each element is an integer between <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e082" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e083" xlink:type="simple"/></inline-formula> labeling the class. For example if the vector entries corresponding to <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e084" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e085" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e086" xlink:type="simple"/></inline-formula> substitutions have values <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e087" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e088" xlink:type="simple"/></inline-formula>, then <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e089" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e090" xlink:type="simple"/></inline-formula>. As an analogy, the HKY85 nucleotide model <xref ref-type="bibr" rid="pcbi.1000885-Hasegawa1">[31]</xref> is a structured model with vector, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e091" xlink:type="simple"/></inline-formula>, where the substitutions between 6 nucleotide pairs (indicated by a subscript) are placed into transition (1) and transversion (0) classes. Given the structure of a codon model, e.g. <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e092" xlink:type="simple"/></inline-formula><inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e093" xlink:type="simple"/></inline-formula>, it can be fitted to the data using standard maximum likelihood phylogenetic algorithms, e.g. as implemented in HyPhy <xref ref-type="bibr" rid="pcbi.1000885-KosakovskyPond7">[32]</xref>. The resulting set of rate estimates <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e094" xlink:type="simple"/></inline-formula> instantiate a structured model and induce a corresponding empirical model, e.g. <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e095" xlink:type="simple"/></inline-formula>.</p>
<p>Because the space of structured codon models is combinatorially large, we utilize a GA previously used to solve an analogous model selection problem for paired RNA data <xref ref-type="bibr" rid="pcbi.1000885-KosakovskyPond3">[25]</xref>. Parameter space is defined by two components: a discrete component which assigns pairwise non-synonymous substitutions between codons to <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e096" xlink:type="simple"/></inline-formula> rate classes using the structured vector described above, and a continuous component comprising a vector of branch lengths, nucleotide substitution rates, frequency parameters and non-synonymous rates <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e097" xlink:type="simple"/></inline-formula>. The discrete component is optimized by the GA, while the continuous component is estimated using numerical non-linear optimization procedures, given the structure of the model. We initially approximate branch lengths using the SR model and update them whenever the GA iteration improves the fitness score by more than 50 <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e098" xlink:type="simple"/></inline-formula> points (see below) as compared to the most recent model for which branch lengths have been estimated. Further details of the genetic algorithm are described in detail in <xref ref-type="bibr" rid="pcbi.1000885-KosakovskyPond3">[25]</xref>, and for the sake of brevity we do not present it here.</p>
<p>We are left with the problem of inferring the number of rate classes <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e099" xlink:type="simple"/></inline-formula>. This is done by starting with <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e100" xlink:type="simple"/></inline-formula> and iteratively proposing to increment <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e101" xlink:type="simple"/></inline-formula>. For each proposal, the model with <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e102" xlink:type="simple"/></inline-formula> rate classes is optimized using the optimized <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e103" xlink:type="simple"/></inline-formula>-class model as initialization. If the proposal results in a model with a better fitness value (see below), it is accepted and a new proposal generated. The process terminates when the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e104" xlink:type="simple"/></inline-formula>-class proposal does not beat the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e105" xlink:type="simple"/></inline-formula>-class model.</p>
<p>We initially assigned a fitness value to each model using <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e106" xlink:type="simple"/></inline-formula> where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e107" xlink:type="simple"/></inline-formula> is the sample size and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e108" xlink:type="simple"/></inline-formula> is the number of parameters in the model <xref ref-type="bibr" rid="pcbi.1000885-Schwarz1">[33]</xref>. The “sample size” of a sequence alignment is difficult to quantify with a single number, since it depends on both the number of sequences in the alignment and the lengths of those sequences. We use the number of characters to approximate “sample size” to make the model selection criterion maximally conservative. While it is straightforward to count the number of estimated parameters in any given structured model, setting <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e109" xlink:type="simple"/></inline-formula> to that number leads to model over-fitting (results not shown), because the topological component (the assignment of rates to classes) adds further “degrees of freedom” to the model. To determine the appropriate penalty term, we conducted simulations; there is precedent for this in statistical literature on generalized information criteria (e.g. <xref ref-type="bibr" rid="pcbi.1000885-Atkinson1">[34]</xref>). We removed the effect of phylogeny by simulating nine sets of two-sequence alignments (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e110" xlink:type="simple"/></inline-formula> divergence): each set of simulations consisted of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e111" xlink:type="simple"/></inline-formula> replicates with between <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e112" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e113" xlink:type="simple"/></inline-formula> codons (in <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e114" xlink:type="simple"/></inline-formula> increments). The sets had 1 to 5 rate classes (<xref ref-type="fig" rid="pcbi-1000885-g001">Figure 1</xref>), representing rate classification problems that ranged from easy (large numerical differences between class rates, e.g. <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e115" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e116" xlink:type="simple"/></inline-formula>) to difficult (small numerical differences, e.g. <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e117" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e118" xlink:type="simple"/></inline-formula>). We constructed generating multi-rate models by assigning rates to <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e119" xlink:type="simple"/></inline-formula> bins randomly with equal probability. For each simulation set we plotted the difference in log likelihood (scaled by the sample size = log of characters) between the correct model (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e120" xlink:type="simple"/></inline-formula> rates), and models with <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e121" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e122" xlink:type="simple"/></inline-formula> rates, respectively. Simulations indicated that doubling the number of parameters in the BIC penalty term ensured sufficient power, and controlled false positives for all simulation sets (<xref ref-type="fig" rid="pcbi-1000885-g001">Figure 1</xref>). We used this modified BIC, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e123" xlink:type="simple"/></inline-formula> to assign fitness to every model examined by a GA run and select those with the lowest <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e124" xlink:type="simple"/></inline-formula>.</p>
<fig id="pcbi-1000885-g001" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1000885.g001</object-id><label>Figure 1</label><caption>
<title>Simulation studies used to derive the appropriate penalty term for <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e125" xlink:type="simple"/></inline-formula>.</title>
<p>Each panel plots the difference in log likelihood (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e126" xlink:type="simple"/></inline-formula>) normalized by the logarithm of the sample size (number of characters), between best fitting GA models with <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e127" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e128" xlink:type="simple"/></inline-formula> rates (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e129" xlink:type="simple"/></inline-formula>), against the number of sites in the alignment. For simulations with a single rate class we plotted <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e130" xlink:type="simple"/></inline-formula>, top right. Figures for multiple rate simulations (2–5 rates) show <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e131" xlink:type="simple"/></inline-formula> as black dots (left column); and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e132" xlink:type="simple"/></inline-formula> as blue dots (right column). Values to the right of row report simulated rates for each class. The left column is a reflection of power, whereas the right column – of the degree of over-fitting. For the case where a single rate was simulated, the degree of over-fitting is the rate of false positives. The desired behavior for <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e133" xlink:type="simple"/></inline-formula> is achieved when the model with <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e134" xlink:type="simple"/></inline-formula> rate classes is preferred to models with <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e135" xlink:type="simple"/></inline-formula>, and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e136" xlink:type="simple"/></inline-formula> rate classes. For a modified BIC criterion <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e137" xlink:type="simple"/></inline-formula> with <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e138" xlink:type="simple"/></inline-formula>, the former happens if <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e139" xlink:type="simple"/></inline-formula> (more definitively with increasing sample size), and the latter if <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e140" xlink:type="simple"/></inline-formula> (regardless of sample size).</p>
</caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000885.g001" xlink:type="simple"/></fig></sec><sec id="s2c">
<title>Simulated data analysis</title>
<p>We also simulated realistic “gene-size” alignments on <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e141" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e142" xlink:type="simple"/></inline-formula> taxon trees. Nucleotide frequencies were uniform (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e143" xlink:type="simple"/></inline-formula>) for each position, and the nucleotide bias component was set to HKY85 with transition/transversion ratio, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e144" xlink:type="simple"/></inline-formula>. We generated <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e145" xlink:type="simple"/></inline-formula> data sets for each <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e146" xlink:type="simple"/></inline-formula>:rate vector combination, under the single rate, and a fixed Random-K model (<xref ref-type="table" rid="pcbi-1000885-t002">Table 2</xref>). These data allowed us to assess the performance of the model when the true underlying model was known.</p>
<table-wrap id="pcbi-1000885-t002" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1000885.t002</object-id><label>Table 2</label><caption>
<title>The performance of GA model selection with <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e147" xlink:type="simple"/></inline-formula> in estimating the number and membership of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e148" xlink:type="simple"/></inline-formula> rate classes as well as rate values from simulated data.</title>
</caption><!--===== Grouping alternate versions of objects =====--><alternatives><graphic id="pcbi-1000885-t002-2" mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000885.t002" xlink:type="simple"/><table><colgroup span="1"><col align="left" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/></colgroup>
<thead>
<tr>
<td align="left" colspan="1" rowspan="1"><inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e149" xlink:type="simple"/></inline-formula></td>
<td align="left" colspan="1" rowspan="1">taxa</td>
<td align="left" colspan="1" rowspan="1"><inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e150" xlink:type="simple"/></inline-formula></td>
<td align="left" colspan="1" rowspan="1">simulated rates</td>
<td align="left" colspan="1" rowspan="1"><inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e151" xlink:type="simple"/></inline-formula></td>
<td align="left" colspan="1" rowspan="1"><inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e152" xlink:type="simple"/></inline-formula></td>
<td align="left" colspan="1" rowspan="1"><inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e153" xlink:type="simple"/></inline-formula></td>
<td align="left" colspan="1" rowspan="1"><inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e154" xlink:type="simple"/></inline-formula></td>
<td align="left" colspan="1" rowspan="1"><inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e155" xlink:type="simple"/></inline-formula></td>
</tr>
</thead>
<tbody>
<tr>
<td align="left" colspan="1" rowspan="1">1</td>
<td align="left" colspan="1" rowspan="1">2</td>
<td align="left" colspan="1" rowspan="1">0.2</td>
<td align="left" colspan="1" rowspan="1">n/a</td>
<td align="left" colspan="1" rowspan="1">n/a</td>
<td align="left" colspan="1" rowspan="1">0.99</td>
<td align="left" colspan="1" rowspan="1">n/a</td>
<td align="left" colspan="1" rowspan="1">0.01</td>
<td align="left" colspan="1" rowspan="1">n/a</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">2</td>
<td align="left" colspan="1" rowspan="1">2</td>
<td align="left" colspan="1" rowspan="1">0.2</td>
<td align="left" colspan="1" rowspan="1">(0.25, 1.0)</td>
<td align="left" colspan="1" rowspan="1">(0.004, 0.010)</td>
<td align="left" colspan="1" rowspan="1">1.00</td>
<td align="left" colspan="1" rowspan="1">0</td>
<td align="left" colspan="1" rowspan="1">0</td>
<td align="left" colspan="1" rowspan="1">1.00</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1">(0.25, 0.3)</td>
<td align="left" colspan="1" rowspan="1">(0.012, 0.009)</td>
<td align="left" colspan="1" rowspan="1">0.98</td>
<td align="left" colspan="1" rowspan="1">0.02</td>
<td align="left" colspan="1" rowspan="1">0</td>
<td align="left" colspan="1" rowspan="1">0.860</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">3</td>
<td align="left" colspan="1" rowspan="1">2</td>
<td align="left" colspan="1" rowspan="1">0.2</td>
<td align="left" colspan="1" rowspan="1">(0.25, 0.5, 1.0)</td>
<td align="left" colspan="1" rowspan="1">(0.011, 0.015, 0.053)</td>
<td align="left" colspan="1" rowspan="1">1.00</td>
<td align="left" colspan="1" rowspan="1">0</td>
<td align="left" colspan="1" rowspan="1">0</td>
<td align="left" colspan="1" rowspan="1">0.996</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1">(0.25, 0.35, 0.5)</td>
<td align="left" colspan="1" rowspan="1">(0.004, 0.011, 0.008)</td>
<td align="left" colspan="1" rowspan="1">0.97</td>
<td align="left" colspan="1" rowspan="1">0.03</td>
<td align="left" colspan="1" rowspan="1">0</td>
<td align="left" colspan="1" rowspan="1">0.971</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">4</td>
<td align="left" colspan="1" rowspan="1">2</td>
<td align="left" colspan="1" rowspan="1">0.2</td>
<td align="left" colspan="1" rowspan="1">(0.05, 0.35, 0.7, 1.0)</td>
<td align="left" colspan="1" rowspan="1">(0.006, 0.021, 0.040, 0.041)</td>
<td align="left" colspan="1" rowspan="1">0.99</td>
<td align="left" colspan="1" rowspan="1">0.01</td>
<td align="left" colspan="1" rowspan="1">0</td>
<td align="left" colspan="1" rowspan="1">0.993</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1">(0.5, 0.65, 0.75, 1.0)</td>
<td align="left" colspan="1" rowspan="1">(0.004, 0.007, 0.006, 0.006)</td>
<td align="left" colspan="1" rowspan="1">0.82</td>
<td align="left" colspan="1" rowspan="1">0.18</td>
<td align="left" colspan="1" rowspan="1">0</td>
<td align="left" colspan="1" rowspan="1">0.936</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">5</td>
<td align="left" colspan="1" rowspan="1">2</td>
<td align="left" colspan="1" rowspan="1">0.2</td>
<td align="left" colspan="1" rowspan="1">(0.05, 0.25, 0.5, 0.75, 1.0)</td>
<td align="left" colspan="1" rowspan="1">(0.003, 0.012, 0.008, 0.014, 0.012)</td>
<td align="left" colspan="1" rowspan="1">0.91</td>
<td align="left" colspan="1" rowspan="1">0.09</td>
<td align="left" colspan="1" rowspan="1">0</td>
<td align="left" colspan="1" rowspan="1">0.981</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1">(0.5, 0.65, 0.75, 0.85, 1.0)</td>
<td align="left" colspan="1" rowspan="1">(0.003, 0.005, 0.006, 0.007, 0.010)</td>
<td align="left" colspan="1" rowspan="1">0.67</td>
<td align="left" colspan="1" rowspan="1">0.33</td>
<td align="left" colspan="1" rowspan="1">0</td>
<td align="left" colspan="1" rowspan="1">0.927</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">1</td>
<td align="left" colspan="1" rowspan="1">16</td>
<td align="left" colspan="1" rowspan="1">0.2</td>
<td align="left" colspan="1" rowspan="1">n/a</td>
<td align="left" colspan="1" rowspan="1">n/a</td>
<td align="left" colspan="1" rowspan="1">1.00</td>
<td align="left" colspan="1" rowspan="1">0</td>
<td align="left" colspan="1" rowspan="1">0</td>
<td align="left" colspan="1" rowspan="1">n/a</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">2</td>
<td align="left" colspan="1" rowspan="1">16</td>
<td align="left" colspan="1" rowspan="1">0.2</td>
<td align="left" colspan="1" rowspan="1">(0.25, 1.0)</td>
<td align="left" colspan="1" rowspan="1">(0.016, 0.044)</td>
<td align="left" colspan="1" rowspan="1">1.00</td>
<td align="left" colspan="1" rowspan="1">0</td>
<td align="left" colspan="1" rowspan="1">0</td>
<td align="left" colspan="1" rowspan="1">0.923</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">3</td>
<td align="left" colspan="1" rowspan="1">16</td>
<td align="left" colspan="1" rowspan="1">0.2</td>
<td align="left" colspan="1" rowspan="1">(0.25, 0.5, 1.0)</td>
<td align="left" colspan="1" rowspan="1">(0.022, 0.045, 0.052)</td>
<td align="left" colspan="1" rowspan="1">0.23</td>
<td align="left" colspan="1" rowspan="1">0.77</td>
<td align="left" colspan="1" rowspan="1">0</td>
<td align="left" colspan="1" rowspan="1">0.713</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1">0.2</td>
<td align="left" colspan="1" rowspan="1">(0.25, 0.75, 1.5)</td>
<td align="left" colspan="1" rowspan="1">(0.019, 0.050, 0.061)</td>
<td align="left" colspan="1" rowspan="1">1.00</td>
<td align="left" colspan="1" rowspan="1">0</td>
<td align="left" colspan="1" rowspan="1">0</td>
<td align="left" colspan="1" rowspan="1">0.837</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1">0.5</td>
<td align="left" colspan="1" rowspan="1">(0.25, 0.5, 1.0)</td>
<td align="left" colspan="1" rowspan="1">(0.014, 0.022, 0.037)</td>
<td align="left" colspan="1" rowspan="1">1.00</td>
<td align="left" colspan="1" rowspan="1">0</td>
<td align="left" colspan="1" rowspan="1">0</td>
<td align="left" colspan="1" rowspan="1">0.861</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">3</td>
<td align="left" colspan="1" rowspan="1">32</td>
<td align="left" colspan="1" rowspan="1">0.2</td>
<td align="left" colspan="1" rowspan="1">(0.25, 0.5, 1.0)</td>
<td align="left" colspan="1" rowspan="1">(0.018, 0.026, 0.038)</td>
<td align="left" colspan="1" rowspan="1">0.89</td>
<td align="left" colspan="1" rowspan="1">0.11</td>
<td align="left" colspan="1" rowspan="1">0</td>
<td align="left" colspan="1" rowspan="1">0.817</td>
</tr>
</tbody>
</table></alternatives><table-wrap-foot><fn id="nt102"><label/><p><inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e156" xlink:type="simple"/></inline-formula> measures the simulated pairwise sequence divergence (expected substitutions/nucleotide site); <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e157" xlink:type="simple"/></inline-formula>, standard deviation (averaged over replicates) of estimated rates from the generating values; <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e158" xlink:type="simple"/></inline-formula>, the proportion of simulations for which the correct number of rate classes are inferred; <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e159" xlink:type="simple"/></inline-formula>, the proportion of simulations which are under-fitted, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e160" xlink:type="simple"/></inline-formula>, the proportion of simulations which are over-fitted, and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e161" xlink:type="simple"/></inline-formula>, the mean Rand C-statistic <xref ref-type="bibr" rid="pcbi.1000885-Rand1">[35]</xref> between rate clusters in the generating model and that in the inferred models.</p></fn></table-wrap-foot></table-wrap>
<p>For each simulation scenario, we report the proportion of replicates <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e162" xlink:type="simple"/></inline-formula> for which the GA inferred the correct number of rate classes <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e163" xlink:type="simple"/></inline-formula>, the proportion of underfitted replicates <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e164" xlink:type="simple"/></inline-formula> (too few rate classes were inferred) and the proportion of overfitted replicates <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e165" xlink:type="simple"/></inline-formula> (too many rate classes were inferred). For the replicates where the correct number of rate classes was inferred, we computed the Rand statistic (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e166" xlink:type="simple"/></inline-formula>, <xref ref-type="bibr" rid="pcbi.1000885-Rand1">[35]</xref>) on the generating and inferred model structures to quantify the similarity between two clusterings rates. The Rand statistic quantifies the similarity between two clusterings (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e167" xlink:type="simple"/></inline-formula>) of the same set of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e168" xlink:type="simple"/></inline-formula> objects and can be defined as <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e169" xlink:type="simple"/></inline-formula>, where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e170" xlink:type="simple"/></inline-formula> is the number of objects (pairs of substitution rates) that belong to different classes in both A and B, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e171" xlink:type="simple"/></inline-formula> (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e172" xlink:type="simple"/></inline-formula>) is the number of objects that belong to different (same) classes in A, but the same (different) class in B, and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e173" xlink:type="simple"/></inline-formula> is the number of objects that belong to the same class in both A and B. Clearly, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e174" xlink:type="simple"/></inline-formula> for perfect agreement (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e175" xlink:type="simple"/></inline-formula>) and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e176" xlink:type="simple"/></inline-formula> for perfect disagreement (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e177" xlink:type="simple"/></inline-formula>).</p>
</sec><sec id="s2d">
<title>Empirical data analysis</title>
<p>We prepared a collection of reference empirical data sets (see <xref ref-type="table" rid="pcbi-1000885-t003">Table 3</xref>), to be used for benchmarking GA, published and extreme-case models. The collection included three protein family alignments from Pandit <xref ref-type="bibr" rid="pcbi.1000885-Whelan2">[12]</xref> selected randomly from all alignments with <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e178" xlink:type="simple"/></inline-formula> taxa, a randomly selected Yeast protein alignment <xref ref-type="bibr" rid="pcbi.1000885-Conant2">[18]</xref>, a group M HIV-1 <italic>pol</italic> alignment <xref ref-type="bibr" rid="pcbi.1000885-KosakovskyPond8">[36]</xref> and an Influenza A virus (IAV) <italic>HA</italic> alignment comprising H3N2, H5N1, H2N2 and H1N1 serotypes. The latter was assembled by random selection of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e179" xlink:type="simple"/></inline-formula> post-2005 sequences for each serotype from the NCBI Influenza database <xref ref-type="bibr" rid="pcbi.1000885-Bao1">[37]</xref>. Finally, we examined the vertebrate rhodopsin protein, recently analyzed for molecular mechanisms of phenotypic adaptation by <xref ref-type="bibr" rid="pcbi.1000885-Yokoyama1">[38]</xref>. We inferred a structured multi-rate model for each of these data sets using the genetic algorithm and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e180" xlink:type="simple"/></inline-formula> model fitness function defined above. A comparison of the GA-fitted model against existing models is unfair, since the former was selected among a set of candidate models using the test alignment. To confirm that GA models were generalizable, we evaluated the fit of the GA models and that of existing models for both the reference datasets, and independent test alignments for the same taxonomic groups (validation data sets). Two HIV-1 pol gene alignments were obtained for subtypes B <xref ref-type="bibr" rid="pcbi.1000885-Brumme1">[39]</xref> and C <xref ref-type="bibr" rid="pcbi.1000885-Rousseau1">[40]</xref>. Subtype assignments were confirmed using the SCUEAL sub-typing tool <xref ref-type="bibr" rid="pcbi.1000885-KosakovskyPond8">[36]</xref>, and inter- and intra-subtype recombinants were pruned from the analysis. For IAV <italic>HA</italic> we used independent alignments for serotypes H5N1 and H3N2, filtered from the NCBI Influenza database <xref ref-type="bibr" rid="pcbi.1000885-Bao1">[37]</xref>, and from <xref ref-type="bibr" rid="pcbi.1000885-Russell1">[41]</xref>, respectively.</p>
<table-wrap id="pcbi-1000885-t003" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1000885.t003</object-id><label>Table 3</label><caption>
<title>Empirical data set characteristics.</title>
</caption><!--===== Grouping alternate versions of objects =====--><alternatives><graphic id="pcbi-1000885-t003-3" mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000885.t003" xlink:type="simple"/><table><colgroup span="1"><col align="left" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/></colgroup>
<thead>
<tr>
<td align="left" colspan="1" rowspan="1">source</td>
<td align="left" colspan="1" rowspan="1">Taxon</td>
<td align="left" colspan="1" rowspan="1">Gene</td>
<td align="left" colspan="1" rowspan="1"># taxa</td>
<td align="left" colspan="1" rowspan="1"># sites</td>
<td align="left" colspan="1" rowspan="1"><inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e181" xlink:type="simple"/></inline-formula></td>
<td align="left" colspan="1" rowspan="1"><inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e182" xlink:type="simple"/></inline-formula></td>
<td align="left" colspan="1" rowspan="1"><inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e183" xlink:type="simple"/></inline-formula></td>
</tr>
</thead>
<tbody>
<tr>
<td align="left" colspan="1" rowspan="1">Pandit/Pfam (PF03477)<xref ref-type="table-fn" rid="nt104">*</xref></td>
<td align="left" colspan="1" rowspan="1">Multiple</td>
<td align="left" colspan="1" rowspan="1">ATP cone</td>
<td align="left" colspan="1" rowspan="1">72</td>
<td align="left" colspan="1" rowspan="1">312</td>
<td align="left" colspan="1" rowspan="1">66.6<xref ref-type="table-fn" rid="nt105">†</xref></td>
<td align="left" colspan="1" rowspan="1">5</td>
<td align="left" colspan="1" rowspan="1">(0.007, 0.036, 0.144, 0.341, 3.108)</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">Pandit/Pfam (PF06455)<xref ref-type="table-fn" rid="nt104">*</xref></td>
<td align="left" colspan="1" rowspan="1">Multiple</td>
<td align="left" colspan="1" rowspan="1">NADH5 C</td>
<td align="left" colspan="1" rowspan="1">82</td>
<td align="left" colspan="1" rowspan="1">552</td>
<td align="left" colspan="1" rowspan="1">1.68</td>
<td align="left" colspan="1" rowspan="1">4</td>
<td align="left" colspan="1" rowspan="1">(0.043, 0.208, 0.456, 0.910)</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">Pandit/Pfam (PF02780)<xref ref-type="table-fn" rid="nt104">*</xref></td>
<td align="left" colspan="1" rowspan="1">Multiple</td>
<td align="left" colspan="1" rowspan="1">Transketolase C</td>
<td align="left" colspan="1" rowspan="1">83</td>
<td align="left" colspan="1" rowspan="1">393</td>
<td align="left" colspan="1" rowspan="1">3.00</td>
<td align="left" colspan="1" rowspan="1">6</td>
<td align="left" colspan="1" rowspan="1">(0.002, 0.033, 0.094,</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1">0.268, 0.678, 4.744)</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1"><xref ref-type="bibr" rid="pcbi.1000885-Yokoyama1">[38]</xref><xref ref-type="table-fn" rid="nt104">*</xref></td>
<td align="left" colspan="1" rowspan="1">Vertebrate</td>
<td align="left" colspan="1" rowspan="1">Rhodopsin</td>
<td align="left" colspan="1" rowspan="1">38</td>
<td align="left" colspan="1" rowspan="1">990</td>
<td align="left" colspan="1" rowspan="1">0.44</td>
<td align="left" colspan="1" rowspan="1">4</td>
<td align="left" colspan="1" rowspan="1">(0.018, 0.116, 0.371, 0.724)</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1"><xref ref-type="bibr" rid="pcbi.1000885-Conant2">[18]</xref></td>
<td align="left" colspan="1" rowspan="1">Yeast</td>
<td align="left" colspan="1" rowspan="1">Pyruvate kinase</td>
<td align="left" colspan="1" rowspan="1">16</td>
<td align="left" colspan="1" rowspan="1">1389</td>
<td align="left" colspan="1" rowspan="1">0.51</td>
<td align="left" colspan="1" rowspan="1">4</td>
<td align="left" colspan="1" rowspan="1">(0.024, 0.093, 0.226, 0.608)</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">(YAL038W)<xref ref-type="table-fn" rid="nt104">*</xref></td>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1"/>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">NCBI<xref ref-type="table-fn" rid="nt104">*</xref></td>
<td align="left" colspan="1" rowspan="1">HIV-1 group M</td>
<td align="left" colspan="1" rowspan="1"><italic>pol</italic></td>
<td align="left" colspan="1" rowspan="1">142</td>
<td align="left" colspan="1" rowspan="1">2847</td>
<td align="left" colspan="1" rowspan="1">0.15</td>
<td align="left" colspan="1" rowspan="1">7</td>
<td align="left" colspan="1" rowspan="1">(0.047, 0.114, 0.211, 0.350,</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1">0.532, 0.998, 1.562)</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1"><xref ref-type="bibr" rid="pcbi.1000885-Brumme1">[39]</xref></td>
<td align="left" colspan="1" rowspan="1">HIV-1 subtype B</td>
<td align="left" colspan="1" rowspan="1"><italic>pol</italic></td>
<td align="left" colspan="1" rowspan="1">371</td>
<td align="left" colspan="1" rowspan="1">1497</td>
<td align="left" colspan="1" rowspan="1">0.06</td>
<td align="left" colspan="1" rowspan="1">n/a</td>
<td align="left" colspan="1" rowspan="1">n/a</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1"><xref ref-type="bibr" rid="pcbi.1000885-Rousseau1">[40]</xref></td>
<td align="left" colspan="1" rowspan="1">HIV-1 subtype C</td>
<td align="left" colspan="1" rowspan="1"><italic>pol</italic></td>
<td align="left" colspan="1" rowspan="1">348</td>
<td align="left" colspan="1" rowspan="1">1170</td>
<td align="left" colspan="1" rowspan="1">0.09</td>
<td align="left" colspan="1" rowspan="1">n/a</td>
<td align="left" colspan="1" rowspan="1">n/a</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">NCBI<xref ref-type="table-fn" rid="nt104">*</xref></td>
<td align="left" colspan="1" rowspan="1">Seasonal IAV</td>
<td align="left" colspan="1" rowspan="1"><italic>HA</italic></td>
<td align="left" colspan="1" rowspan="1">349</td>
<td align="left" colspan="1" rowspan="1">987</td>
<td align="left" colspan="1" rowspan="1">0.09</td>
<td align="left" colspan="1" rowspan="1">3</td>
<td align="left" colspan="1" rowspan="1">(0.350, 1.211, 3.287)</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">NCBI</td>
<td align="left" colspan="1" rowspan="1">IAV A H5N1</td>
<td align="left" colspan="1" rowspan="1"><italic>HA</italic></td>
<td align="left" colspan="1" rowspan="1">279</td>
<td align="left" colspan="1" rowspan="1">1545</td>
<td align="left" colspan="1" rowspan="1">0.04</td>
<td align="left" colspan="1" rowspan="1">n/a</td>
<td align="left" colspan="1" rowspan="1">n/a</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1"><xref ref-type="bibr" rid="pcbi.1000885-Russell1">[41]</xref></td>
<td align="left" colspan="1" rowspan="1">IAV A H3N2</td>
<td align="left" colspan="1" rowspan="1"><italic>HA</italic></td>
<td align="left" colspan="1" rowspan="1">68</td>
<td align="left" colspan="1" rowspan="1">987</td>
<td align="left" colspan="1" rowspan="1">0.02</td>
<td align="left" colspan="1" rowspan="1">n/a</td>
<td align="left" colspan="1" rowspan="1">n/a</td>
</tr>
</tbody>
</table></alternatives><table-wrap-foot><fn id="nt103"><label/><p><inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e184" xlink:type="simple"/></inline-formula> is mean pairwise nucleotide divergence (substitutions/site, estimated under the single rate codon model), <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e185" xlink:type="simple"/></inline-formula> is the number of rates estimated in the GA, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e186" xlink:type="simple"/></inline-formula> are the maximum likelihood estimates for the rates.</p></fn><fn id="nt104"><label/><p>*Reference alignments for which GA models were estimated. All GA results presented are for the model with best <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e187" xlink:type="simple"/></inline-formula>.</p></fn><fn id="nt105"><label>†</label><p>ATP cone is comprised of highly divergent sequences, with only <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e188" xlink:type="simple"/></inline-formula> average pairwise amino-acid identity; synonymous rates appear to be saturated.</p></fn></table-wrap-foot></table-wrap>
<p>We fitted five reference models to each dataset: (i) the single-rate model, (ii) a Random-<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e189" xlink:type="simple"/></inline-formula> and a Random-<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e190" xlink:type="simple"/></inline-formula> model, (iii) the empirical codon model (ECM, <xref ref-type="bibr" rid="pcbi.1000885-Kosiol1">[10]</xref>), (iv) the Linear Combination of Amino Acid Properties (LCAP) model <xref ref-type="bibr" rid="pcbi.1000885-Conant1">[17]</xref>, <xref ref-type="bibr" rid="pcbi.1000885-Conant2">[18]</xref>, and (v) the reversible (REV) model (see <xref ref-type="table" rid="pcbi-1000885-t001">Table 1</xref>).</p>
<p>For every dataset, the corresponding GA-run was processed to obtain three different alignment-specific multi-rate models.</p>
<list list-type="order"><list-item>
<p>A structured GA model (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e191" xlink:type="simple"/></inline-formula>): this is the best-fitting model (with value <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e192" xlink:type="simple"/></inline-formula>), which defines <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e193" xlink:type="simple"/></inline-formula> rate clusters. The numerical values of corresponding <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e194" xlink:type="simple"/></inline-formula> substitution rates are inferred using maximum likelihood. This model is a direct analog of the single “best” substitution model reported by the familiar ModelTest <xref ref-type="bibr" rid="pcbi.1000885-Posada1">[22]</xref> nucleotide model selection procedure.</p>
</list-item><list-item>
<p>A numerical model-averaged GA model (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e195" xlink:type="simple"/></inline-formula>), which is computed by weighting the numerical rate estimates from all models in the credible set using <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e196" xlink:type="simple"/></inline-formula>-based Akaike weights (as in <xref ref-type="bibr" rid="pcbi.1000885-KosakovskyPond3">[25]</xref>). Briefly, for the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e197" xlink:type="simple"/></inline-formula>th model examined by the GA, we compute its evidence ratio versus the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e198" xlink:type="simple"/></inline-formula> model as <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e199" xlink:type="simple"/></inline-formula>, which can be thought of as the probability that model <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e200" xlink:type="simple"/></inline-formula> is the best model to explain the data, in the sense of minimizing the Kullback-Leibler divergence from the “true” unobserved model <xref ref-type="bibr" rid="pcbi.1000885-Burnham1">[42]</xref>. In addition to the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e201" xlink:type="simple"/></inline-formula> model, we also construct a set of credible models, i.e. all those models whose <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e202" xlink:type="simple"/></inline-formula> is sufficiently large (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e203" xlink:type="simple"/></inline-formula>). From this credible set we compute a model averaged estimate of any parameter <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e204" xlink:type="simple"/></inline-formula>, by a weighted sum of the estimate under model <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e205" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e206" xlink:type="simple"/></inline-formula> as <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e207" xlink:type="simple"/></inline-formula>, where the Akaike weight of model <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e208" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e209" xlink:type="simple"/></inline-formula> is defined as <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e210" xlink:type="simple"/></inline-formula>. This <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e211" xlink:type="simple"/></inline-formula> model is an analog of an empirical substitution model (e.g. ECM), and has no rate parameters that are estimated from validation data sets. By combining information from multiple models, statistical noise may be reduced (e.g. <xref ref-type="bibr" rid="pcbi.1000885-Posada2">[26]</xref>).</p>
</list-item><list-item>
<p>The numerical <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e212" xlink:type="simple"/></inline-formula> model with the addition of a single non-synonymous substitution rate parameter (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e213" xlink:type="simple"/></inline-formula>) which multiplies all non-synonymous substitution rates in the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e214" xlink:type="simple"/></inline-formula> matrix. The direct analog is the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e215" xlink:type="simple"/></inline-formula> model of <xref ref-type="bibr" rid="pcbi.1000885-Kosiol1">[10]</xref>, and its purpose is to add a dataset specific “adjustment” to the baseline numerical model, since the estimated parameters of the baseline numerical model are weighted over the credible set and fixed at these estimates when applied to other datasets.</p>
</list-item></list>
<p>We used both BIC <xref ref-type="bibr" rid="pcbi.1000885-Schwarz1">[33]</xref> and Likelihood ratio tests, where appropriate, for model comparison. These goodness-of-fit comparisons allowed us to evaluate whether a model estimated on reference alignments yielded a significant improvement over the other models when fitted to independent alignments for the same taxonomic groups. All models were implemented with the F61 frequency parameterization, in addition to their original frequency parameterizations, because the methodology used to estimate the ECM model precluded the use of other frequency parameterizations for across-the-board comparison. Alignments and phylogenetic trees were provided for the Pandit data set. In all other cases, alignments were generated using codon alignment tools implemented in HyPhy <xref ref-type="bibr" rid="pcbi.1000885-KosakovskyPond7">[32]</xref>. Maximum likelihood phylogenetic trees were estimated using PhyML <xref ref-type="bibr" rid="pcbi.1000885-Guindon1">[43]</xref> under a GTR <xref ref-type="bibr" rid="pcbi.1000885-Tavar2">[44]</xref> model of nucleotide substitution and among-site rate variation modeled as a discretized gamma distribution with 4 rate-classes <xref ref-type="bibr" rid="pcbi.1000885-Yang1">[45]</xref>. Empirical alignments and trees are available at <ext-link ext-link-type="uri" xlink:href="http://www.hyphy.org/pubs/cms/" xlink:type="simple">http://www.hyphy.org/pubs/cms/</ext-link>.</p>
</sec><sec id="s2e">
<title>Rate matrix comparisons</title>
<p>The entries of the substitution rate matrix <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e216" xlink:type="simple"/></inline-formula> can be used to estimate the expected number of substitutions per site per unit time, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e217" xlink:type="simple"/></inline-formula>, and to determine the value of the time parameter (assuming all other parameters are known) <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e218" xlink:type="simple"/></inline-formula> which yields <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e219" xlink:type="simple"/></inline-formula>. Furthermore, the expression for the number of expected one-nucleotide substitutions between codons <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e220" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e221" xlink:type="simple"/></inline-formula>, in time <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e222" xlink:type="simple"/></inline-formula>, at a site is given by <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e223" xlink:type="simple"/></inline-formula> (the simplification is the consequence of time-reversibility). Given two amino-acid residues <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e224" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e225" xlink:type="simple"/></inline-formula> which can be exchanged by a single nucleotide substitution, we can further define <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e226" xlink:type="simple"/></inline-formula><inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e227" xlink:type="simple"/></inline-formula>, where <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e228" xlink:type="simple"/></inline-formula> denotes the residue encoded by codon <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e229" xlink:type="simple"/></inline-formula>. Consider a <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e230" xlink:type="simple"/></inline-formula>element substitution spectrum vector <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e231" xlink:type="simple"/></inline-formula>, which describes the relative abundance or paucity of a particular type of amino-acid pair substitution under the model defined by <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e232" xlink:type="simple"/></inline-formula>. Given two models, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e233" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e234" xlink:type="simple"/></inline-formula>, we propose to compare their similarity by computing the distance between the corresponding substitution spectrum vectors evaluated at the corresponding “normalized” times:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e235" xlink:type="simple"/><label>(2)</label></disp-formula>Any norm on the standard <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e236" xlink:type="simple"/></inline-formula>dimension real valued vector space can be used, but for the purposes of this paper we consider the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e237" xlink:type="simple"/></inline-formula> norm, and the corresponding induced Euclidean distance metric.</p>
</sec><sec id="s2f">
<title>Implementation</title>
<p>All models and data sets utilized in this study are implemented as scripts in the HyPhy Batch Language (HBL), and are be available with the current source release of HyPhy <xref ref-type="bibr" rid="pcbi.1000885-KosakovskyPond7">[32]</xref>. In addition, we have made the GA codon model selector available as an analysis option at <ext-link ext-link-type="uri" xlink:href="http://www.datamonkey.org" xlink:type="simple">http://www.datamonkey.org</ext-link> <xref ref-type="bibr" rid="pcbi.1000885-KosakovskyPond9">[46]</xref>. The GA model selection code requires an MPI cluster environment with typical runtimes of approximately 36–48 hours for an intermediate-sized alignment (50 taxa) and 32 compute nodes.</p>
</sec></sec><sec id="s3">
<title>Results</title>
<sec id="s3a">
<title>Power and accuracy analysis on simulated data</title>
<p>Results from both two- and multi-taxon simulations (<xref ref-type="table" rid="pcbi-1000885-t002">Table 2</xref>, <xref ref-type="fig" rid="pcbi-1000885-g001">Figure 1</xref>) indicated that <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e238" xlink:type="simple"/></inline-formula> controlled the rates of overfitting, defined as the proportion of replicates that overestimated the number of rate classes <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e239" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e240" xlink:type="simple"/></inline-formula>. For null (single-rate model) simulations (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e241" xlink:type="simple"/></inline-formula>), false positive rates were <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e242" xlink:type="simple"/></inline-formula> for two-taxon simulations and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e243" xlink:type="simple"/></inline-formula> for <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e244" xlink:type="simple"/></inline-formula>-taxon simulation. Neither two- nor multi-taxon simulations showed over-fitting across any simulation scenarios (<xref ref-type="table" rid="pcbi-1000885-t002">Table 2</xref>). We deliberately designed the procedure to be conservative, since over-fitting is a major concern in statistical model selection. The power to select the correct number of rate classes <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e245" xlink:type="simple"/></inline-formula> (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e246" xlink:type="simple"/></inline-formula>) behaved as expected: increasing, and eventually reaching <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e247" xlink:type="simple"/></inline-formula>, given sufficiently divergent sequences and well resolved rate classes (<xref ref-type="table" rid="pcbi-1000885-t002">Table 2</xref>). Indeed, the limited information content of alignments where simulated rate classes are similar (i.e 3 rates of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e248" xlink:type="simple"/></inline-formula>), and/or where pairwise sequence divergence is low (0.2), was evident as increased model under-fitting (<xref ref-type="table" rid="pcbi-1000885-t002">Table 2</xref>), <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e249" xlink:type="simple"/></inline-formula>. Model under-fitting was substantially reduced when information content was increased, either by boosting the disparity in rate classes, or by elevating sequence divergence and/or number of taxa (<xref ref-type="table" rid="pcbi-1000885-t002">Table 2</xref>). Further evidence that the GA procedure has high power is provided by the positive association of the difference between <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e250" xlink:type="simple"/></inline-formula> scores of the correct model with <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e251" xlink:type="simple"/></inline-formula> rates, and one with <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e252" xlink:type="simple"/></inline-formula>-1 rates, and separation between simulated rates, pairwise sequence divergence or number of taxa (<xref ref-type="supplementary-material" rid="pcbi.1000885.s001">Table S1</xref>). The ability to assign individual rates to the correct group (as measured by the Rand statistic) was similarly improved, while the variance in numerical rate parameter estimates decreased, for more divergent sequences and rate classes, suggesting that the GA search procedure recaptures most of the rate class structure, given sufficient information.</p>
</sec><sec id="s3b">
<title>Empirical data analysis</title>
<p>We compared the fit of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e253" xlink:type="simple"/></inline-formula> codon substitution models (<xref ref-type="table" rid="pcbi-1000885-t001">Table 1</xref>) on <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e254" xlink:type="simple"/></inline-formula> empirical data sets (<xref ref-type="table" rid="pcbi-1000885-t003">Table 3</xref>), spanning a range of proteins, taxonomic groups and divergence levels, using the BIC to measure goodness-of-fit. Using the GA procedure, we inferred distinct multi-rate models from <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e255" xlink:type="simple"/></inline-formula> of these data sets (labelled with asterisks in <xref ref-type="table" rid="pcbi-1000885-t003">Table 3</xref>). The remaining <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e256" xlink:type="simple"/></inline-formula> alignments were used for validation such that we could determine the generalizability of two of the GA-fitted models (HIV and IAV) to other alignments from the same taxonomic groups. In <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e257" xlink:type="simple"/></inline-formula> cases, the GA model outperforms every other model (often by a large margin), and in <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e258" xlink:type="simple"/></inline-formula> cases it comes in second after the parameter rich REV model (<xref ref-type="table" rid="pcbi-1000885-t004">Table 4</xref>). Note that the GA model outperforms REV in all <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e259" xlink:type="simple"/></inline-formula> cases under the more conservative <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e260" xlink:type="simple"/></inline-formula> criterion (which was used to inform the GA). Data set specific GA models consistently fit the data better than state-of-the-art empirical (ECM) and mechanistic (LCAP) models.</p>
<table-wrap id="pcbi-1000885-t004" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1000885.t004</object-id><label>Table 4</label><caption>
<title>Comparison of empirical model fits using BIC.</title>
</caption><!--===== Grouping alternate versions of objects =====--><alternatives><graphic id="pcbi-1000885-t004-4" mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000885.t004" xlink:type="simple"/><table><colgroup span="1"><col align="left" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/></colgroup>
<thead>
<tr>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1">S+F61</td>
<td align="left" colspan="1" rowspan="1">ECM+F61</td>
<td align="left" colspan="1" rowspan="1">ECM+F61+<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e261" xlink:type="simple"/></inline-formula></td>
<td align="left" colspan="1" rowspan="1">LCAP+F61</td>
<td align="left" colspan="1" rowspan="1">GA<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e262" xlink:type="simple"/></inline-formula>+F61</td>
<td align="left" colspan="1" rowspan="1">REV+F61</td>
</tr>
</thead>
<tbody>
<tr>
<td align="left" colspan="1" rowspan="1">ATP cone<xref ref-type="table-fn" rid="nt107">*</xref></td>
<td align="left" colspan="1" rowspan="1">42176.4 (5)</td>
<td align="left" colspan="1" rowspan="1">41563.4 (3)</td>
<td align="left" colspan="1" rowspan="1">41329.6 (2)</td>
<td align="left" colspan="1" rowspan="1">49049 (6)</td>
<td align="left" colspan="1" rowspan="1"><bold>41214.6 (1)</bold></td>
<td align="left" colspan="1" rowspan="1">41831.6 (4)</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">NADH5 C<xref ref-type="table-fn" rid="nt107">*</xref></td>
<td align="left" colspan="1" rowspan="1">69057.9 (3)</td>
<td align="left" colspan="1" rowspan="1">69148.1 (5)</td>
<td align="left" colspan="1" rowspan="1">69099 (4)</td>
<td align="left" colspan="1" rowspan="1">72329.4 (6)</td>
<td align="left" colspan="1" rowspan="1">68086.3 (2)</td>
<td align="left" colspan="1" rowspan="1"><bold>67211.8 (1)</bold></td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">Transketolase C<xref ref-type="table-fn" rid="nt107">*</xref></td>
<td align="left" colspan="1" rowspan="1">63509.4 (5)</td>
<td align="left" colspan="1" rowspan="1">61436.2 (2)</td>
<td align="left" colspan="1" rowspan="1">61443.7 (3)</td>
<td align="left" colspan="1" rowspan="1">67819.7 (6)</td>
<td align="left" colspan="1" rowspan="1"><bold>61227.8 (1)</bold></td>
<td align="left" colspan="1" rowspan="1">61469.4 (4)</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">Rhodopsin <xref ref-type="table-fn" rid="nt107">*</xref></td>
<td align="left" colspan="1" rowspan="1">27918.7 (5)</td>
<td align="left" colspan="1" rowspan="1">28583.3 (6)</td>
<td align="left" colspan="1" rowspan="1">27769.6 (3)</td>
<td align="left" colspan="1" rowspan="1">27614.7 (2)</td>
<td align="left" colspan="1" rowspan="1"><bold>27322.7 (1)</bold></td>
<td align="left" colspan="1" rowspan="1">27781.3 (4)</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">Yeast Protein YAL038W<xref ref-type="table-fn" rid="nt107">*</xref></td>
<td align="left" colspan="1" rowspan="1">21219.1 (5)</td>
<td align="left" colspan="1" rowspan="1">22246.1 (6)</td>
<td align="left" colspan="1" rowspan="1">20988.8 (2)</td>
<td align="left" colspan="1" rowspan="1">21098.2 (3)</td>
<td align="left" colspan="1" rowspan="1"><bold>20822.7 (1)</bold></td>
<td align="left" colspan="1" rowspan="1">21142.7 (4)</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">HIV-1 <italic>pol</italic> Group M<xref ref-type="table-fn" rid="nt107">*</xref></td>
<td align="left" colspan="1" rowspan="1">148650 (4)</td>
<td align="left" colspan="1" rowspan="1">158788 (6)</td>
<td align="left" colspan="1" rowspan="1">156792 (5)</td>
<td align="left" colspan="1" rowspan="1">146381 (3)</td>
<td align="left" colspan="1" rowspan="1">145338 (2)</td>
<td align="left" colspan="1" rowspan="1"><bold>145209 (1)</bold></td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">HIV-1 <italic>pol</italic> subtype B</td>
<td align="left" colspan="1" rowspan="1">113583 (4)</td>
<td align="left" colspan="1" rowspan="1">119721 (6)</td>
<td align="left" colspan="1" rowspan="1">119196 (5)</td>
<td align="left" colspan="1" rowspan="1">111249 (3)</td>
<td align="left" colspan="1" rowspan="1"><bold>108251 (1)</bold></td>
<td align="left" colspan="1" rowspan="1">110113 (2)</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">HIV-1 <italic>pol</italic> subtype C</td>
<td align="left" colspan="1" rowspan="1">127143 (4)</td>
<td align="left" colspan="1" rowspan="1">134719 (6)</td>
<td align="left" colspan="1" rowspan="1">133794 (5)</td>
<td align="left" colspan="1" rowspan="1">125407 (3)</td>
<td align="left" colspan="1" rowspan="1">124434 (2)</td>
<td align="left" colspan="1" rowspan="1"><bold>123346 (1)</bold></td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">Influenza A <italic>HA</italic><xref ref-type="table-fn" rid="nt107">*</xref></td>
<td align="left" colspan="1" rowspan="1">17803.9 (3)</td>
<td align="left" colspan="1" rowspan="1">19479.7 (6)</td>
<td align="left" colspan="1" rowspan="1">18883.3 (5)</td>
<td align="left" colspan="1" rowspan="1">17750.6 (2)</td>
<td align="left" colspan="1" rowspan="1"><bold>17558.8 (1)</bold></td>
<td align="left" colspan="1" rowspan="1">18110.3 (4)</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">Influenza A <italic>HA</italic> H5N1</td>
<td align="left" colspan="1" rowspan="1"><bold>28326.2 (1)</bold></td>
<td align="left" colspan="1" rowspan="1">28987.1 (6)</td>
<td align="left" colspan="1" rowspan="1">28911.7 (5)</td>
<td align="left" colspan="1" rowspan="1">28382.8 (3)</td>
<td align="left" colspan="1" rowspan="1">28347.2 (2)</td>
<td align="left" colspan="1" rowspan="1">28904.2 (4)</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">Influenza A <italic>HA</italic> H3N2</td>
<td align="left" colspan="1" rowspan="1"><bold>7527.03 (1)</bold></td>
<td align="left" colspan="1" rowspan="1">7649.29 (4)</td>
<td align="left" colspan="1" rowspan="1">7658.29 (5)</td>
<td align="left" colspan="1" rowspan="1">7562.29 (3)</td>
<td align="left" colspan="1" rowspan="1">7546.24 (2)</td>
<td align="left" colspan="1" rowspan="1">8096.39 (6)</td>
</tr>
</tbody>
</table></alternatives><table-wrap-foot><fn id="nt106"><label/><p>The best model (with smallest BIC) is shown in boldface and the rank of each model is provided in parentheses.</p></fn><fn id="nt107"><label/><p>*Reference alignments from which GA models were estimated.</p></fn></table-wrap-foot></table-wrap>
<p>An intuitive understanding of the model selection process via the GA may be gained by thinking of it as a non-linear curve fitting problem, where the “true” curve is the unobserved distribution of biological substitution rates (<xref ref-type="fig" rid="pcbi-1000885-g002">Figure 2</xref>). We consider the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e263" xlink:type="simple"/></inline-formula> substitution rate matrix for a codon model, extract non-synonymous rates for the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e264" xlink:type="simple"/></inline-formula> above-diagonal entries which correspond to one-step non-synonymous substitutions and rank them in an increasing order to obtain monotonically increasing rate curves as shown in (<xref ref-type="fig" rid="pcbi-1000885-g002">Figure 2</xref>). Note that because the ratios for all substitutions between the same pair of amino-acids (of which there are <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e265" xlink:type="simple"/></inline-formula> pairs) are identical, this will create steps in such curves. In the case of one non-synonymous substitution rate (SR) the curve is a flat line at the estimated average non-synonymous substitution rate across all residue pairs. This is easily improved on by a random model which assigns non-synonymous substitutions randomly to one of 5 rate classes. At the other extreme lies the general time reversible models with <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e266" xlink:type="simple"/></inline-formula> estimated rates. Since we have no <italic>a priori</italic> reason to believe that any two non-synonymous substitution rates will be exactly the same, REV is the most biologically realistic of the models which assume time-reversibility and only single nucleotide substitutions. However, fitting the parameter rich REV model to limited data is statistically unsound. The GA-approach, instead, searches for the best (in an information theoretic sense) step-wise smoothing of the biological distribution given the data available (<xref ref-type="fig" rid="pcbi-1000885-g002">Figure 2</xref>).</p>
<fig id="pcbi-1000885-g002" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1000885.g002</object-id><label>Figure 2</label><caption>
<title>Evolutionary rate estimation as “curve fitting.”</title>
<p>An example from HIV-1 polymerase gene alignment for which the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e267" xlink:type="simple"/></inline-formula> inferred 7 non-synonymous rate classes. The idealized biological rate distribution (unobservable) is depicted by the dashed line. The goodness of fit, the complexity of the models, and the range of maximum likelihood parameter estimates are listed in the table.</p>
</caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000885.g002" xlink:type="simple"/></fig>
<p>The “generalist” ECM model sacrifices gene-level resolution, in some cases so dramatically that it underperforms the single-rate model, even with the correction factor <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e268" xlink:type="simple"/></inline-formula> (<xref ref-type="table" rid="pcbi-1000885-t004">Table 4</xref>). For instance, ECM appears to be ill suited for the analysis of viral genes. LCAP, on the other hand, performs poorly for highly divergent data sets; indeed the original validation of LCAP took place on relatively closely related yeast species <xref ref-type="bibr" rid="pcbi.1000885-Conant2">[18]</xref>, and the mechanistic properties assumed by the model may be insufficient in alignments spanning multiple genera and taxonomic groups. To test whether GA structured models are generalizable, we estimated two viral models: one for HIV-1 polymerase and one for human IAV hemagglutinin. We then applied each of these models (holding the inferred class structure fixed) to two additional samples of sequences from the same gene, obtained independently from the training sample. In all <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e269" xlink:type="simple"/></inline-formula> cases <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e270" xlink:type="simple"/></inline-formula> outperformed ECM, ECM+<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e271" xlink:type="simple"/></inline-formula> and LCAP by wide margins, lending credence to the claim that data-driven structured models recover substitutional biases that are shared by other samples shaped by similar evolutionary parameters. Curiously, for very low divergence (and low information content) intra-serotype IAV alignments, the single rate model was preferred to all other models by BIC, suggesting that there are biologically interesting alignments, which do not contain sufficient amino-acid variability to indicate the use of a multi-rate model.</p>
<p>As a test of protein-specificity of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e272" xlink:type="simple"/></inline-formula> models, we randomly selected four Pandit data sets to assess how well <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e273" xlink:type="simple"/></inline-formula> models inferred from unrelated proteins fitted these data (<xref ref-type="supplementary-material" rid="pcbi.1000885.s002">Table S2</xref>). Not surprisingly, ECM was the best model in <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e274" xlink:type="simple"/></inline-formula> cases, because it was derived as the best “average” protein model. LCAP topped the list in one case, but placed outside the top three in the other three cases. The GA structured models, being tailored to specific proteins, tended to differ from each other (<xref ref-type="supplementary-material" rid="pcbi.1000885.s003">Table S3</xref>) and did not perform well on proteins from different families. However, the GA structured models for ATP cone and Transketolase C did outperform the LCAP model in <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e275" xlink:type="simple"/></inline-formula> cases, which suggests some similarity between the respective protein families in those cases. This indicates the GA models fitted to different proteins may be generalizable, with the degree limited by taxonomy, protein function or both. The generalizability of GA models could further be quantified by evolutionary fingerprinting of genes <xref ref-type="bibr" rid="pcbi.1000885-KosakovskyPond4">[27]</xref>; see also <xref ref-type="fig" rid="pcbi-1000885-g003">Figure 3(b)</xref>.</p>
<fig id="pcbi-1000885-g003" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1000885.g003</object-id><label>Figure 3</label><caption>
<title>Neighbor-joining <xref ref-type="bibr" rid="pcbi.1000885-Saitou1">[57]</xref> trees built from matrices of pairwise substitution spectrum distances (<bold>Eq. 2</bold>) computed between different models fitted to the HIV-1 group M <italic>pol</italic> alignment, and between <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e276" xlink:type="simple"/></inline-formula> models inferred from different alignments.</title>
</caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000885.g003" xlink:type="simple"/></fig></sec><sec id="s3c">
<title>Further analysis of GA multi-rate models</title>
<p>A GA search run typically examines between two- and a hundred-thousand potential models, e.g. <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e277" xlink:type="simple"/></inline-formula> models with <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e278" xlink:type="simple"/></inline-formula> to <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e279" xlink:type="simple"/></inline-formula> rate classes for the HIV-1 group M <italic>pol</italic> dataset. <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e280" xlink:type="simple"/></inline-formula>, which we compared to existing models in the previous section, is simply the single “best” model, i.e. the model that minimized the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e281" xlink:type="simple"/></inline-formula> criterion among all those examined during the run. Further, we estimate the credible set of models as those models whose evidence ratio versus the best model is sufficiently large (see methods). Among <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e282" xlink:type="simple"/></inline-formula> models fitted to HIV-1 pol by the GA, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e283" xlink:type="simple"/></inline-formula> belonged to the credible set. Given sufficient data and knowing that the true model is in the set examined by the GA, e.g. in the long 2-sequence simulations discussed above, the size of the credible set frequently shrinks to <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e284" xlink:type="simple"/></inline-formula> (the true model). These structured (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e285" xlink:type="simple"/></inline-formula>) and model-averaged (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e286" xlink:type="simple"/></inline-formula>) models can be analyzed further to draw inferences of the substitution process.</p>
<p>For instance, the structured <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e287" xlink:type="simple"/></inline-formula> model identifies which residue pairs are exchanged rarely, relative to the baseline synonymous rate. In <xref ref-type="fig" rid="pcbi-1000885-g004">Figures 4</xref> and <xref ref-type="fig" rid="pcbi-1000885-g005">5</xref> we cluster the pairs of residues which have the same rate of non-synonymous substitution; residues are labelled by Stanfel class and physicochemical properties. Note that the same residue can be present as a node in multiple clusters because the GA partitions residue pairs (i.e. the rates between them), not the residues themselves. The model reveals a startling heterogeneity of substitution rates in HIV-1 <italic>pol</italic>: the single rate <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e288" xlink:type="simple"/></inline-formula> estimate of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e289" xlink:type="simple"/></inline-formula> is resolved into <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e290" xlink:type="simple"/></inline-formula> rate classes (<xref ref-type="fig" rid="pcbi-1000885-g004">Figure 4</xref>), with relative non-synonymous substitution rates ranging from <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e291" xlink:type="simple"/></inline-formula> (20 residue pairs) to <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e292" xlink:type="simple"/></inline-formula> (3 residue pairs); a similar range is revealed for other datasets (<xref ref-type="table" rid="pcbi-1000885-t003">Table 3</xref>). It is remarkable that some of the non-synonymous substitutions occur at rates matching or exceeding the gene-average rate of synonymous substitutions. This can be interpreted, for instance, as lack of selective constraint on particular residue substitutions gene-wide, or evidence of directional selection when some residues are preferentially replaced with others. Regardless of how this result is interpreted, a remarkable complexity of substitution patterns is revealed by the analysis. We hypothesize that such patterns reflect complex dynamics of substitutional preferences that may be shared by multiple samples of the same genes. This hypothesis is supported (by the goodness-of-fit of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e293" xlink:type="simple"/></inline-formula> vs other models) on HIV-1 and IAV samples in this study (<xref ref-type="table" rid="pcbi-1000885-t004">Table 4</xref>), and we are currently undertaking the GA analysis of several thousand alignments to confirm this finding.</p>
<fig id="pcbi-1000885-g004" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1000885.g004</object-id><label>Figure 4</label><caption>
<title>Evolutionary rate clusters in structured GA models (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e294" xlink:type="simple"/></inline-formula>) inferred from the HIV-1 group M <italic>pol</italic> alignment.</title>
<p>Each cluster is labeled with the maximum likelihood estimate of its rate inferred under <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e295" xlink:type="simple"/></inline-formula>. The residues (nodes) are annotated by their biochemical properties and Stanfel class, and the rates (edges) are labeled with model-averaged (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e296" xlink:type="simple"/></inline-formula>) rate estimates. The style of an edge is determined by its cluster affinity, where high cluster affinities indicate that a large proportion of models in the credible set were consistent with the structured <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e297" xlink:type="simple"/></inline-formula> model.</p>
</caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000885.g004" xlink:type="simple"/></fig><fig id="pcbi-1000885-g005" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1000885.g005</object-id><label>Figure 5</label><caption>
<title>Evolutionary rate clusters in structured GA models (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e298" xlink:type="simple"/></inline-formula>) inferred from the vertebrate rhodopsin protein alignment.</title>
<p>Each cluster is labeled with the maximum likelihood estimate of its rate inferred under <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e299" xlink:type="simple"/></inline-formula>. The residues (nodes) are annotated by their biochemical properties and Stanfel class, and the rates (edges) are labeled with model-averaged (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e300" xlink:type="simple"/></inline-formula>) rate estimates. The style of an edge is determined by its cluster affinity, where high cluster affinities indicate that a large proportion of models in the credible set were consistent with the structured <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e301" xlink:type="simple"/></inline-formula> model.</p>
</caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000885.g005" xlink:type="simple"/></fig>
<p>One of the benefits of using the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e302" xlink:type="simple"/></inline-formula> model instead of REV or other models is that the former model automatically classifies all substitutions into similarity groups, supplying a data-driven analog of “conservative” or “radical” substitutions, previously defined <italic>a priori</italic> based on chemical properties of the residues, or a more sophisticated multi-property basis defined in the LCAP model. For example, the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e303" xlink:type="simple"/></inline-formula> substitution rates are partitioned into seven classes in the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e304" xlink:type="simple"/></inline-formula> model inferred from HIV-1 <italic>pol</italic>, and into <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e305" xlink:type="simple"/></inline-formula> rate classes for the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e306" xlink:type="simple"/></inline-formula> model fitted to a smaller, but more divergent vertebrate rhodopsin alignment (<xref ref-type="fig" rid="pcbi-1000885-g005">Figure 5</xref>).</p>
<p>Multi-model inference is instrumental in assessing how robust the clustering assignment made by <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e307" xlink:type="simple"/></inline-formula> is. In <xref ref-type="fig" rid="pcbi-1000885-g004">Figures 4</xref> and <xref ref-type="fig" rid="pcbi-1000885-g005">5</xref>, we present this information by labeling individual substitution rates with their model averaged values. An examination of the numerical differences between rate estimates (for a particular amino-acid pair) obtained under <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e308" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e309" xlink:type="simple"/></inline-formula> can reveal ambiguities in assigning a particular rate to a class. More formally, we can compute a model averaged support for the probability that rates <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e310" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e311" xlink:type="simple"/></inline-formula> (for residues <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e312" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e313" xlink:type="simple"/></inline-formula>) are in the same class, as described above, or that the corresponding edges <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e314" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e315" xlink:type="simple"/></inline-formula> are in the same component of the rate graph (<xref ref-type="fig" rid="pcbi-1000885-g004">Figure 4</xref>). If <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e316" xlink:type="simple"/></inline-formula> is a cluster defined by <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e317" xlink:type="simple"/></inline-formula> (with the number of nodes in <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e318" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e319" xlink:type="simple"/></inline-formula>), we define the <italic>cluster affinity</italic> of an edge <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e320" xlink:type="simple"/></inline-formula> as the mean of the model averaged estimates of the probabilities that edge <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e321" xlink:type="simple"/></inline-formula> and other edges in <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e322" xlink:type="simple"/></inline-formula> belong to the same cluster:<disp-formula><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e323" xlink:type="simple"/></disp-formula>If <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e324" xlink:type="simple"/></inline-formula> is below a certain threshold, for instance <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e325" xlink:type="simple"/></inline-formula> for majority rule, then cluster membership of edge <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e326" xlink:type="simple"/></inline-formula> is ambiguous. For example, the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e327" xlink:type="simple"/></inline-formula> substitution pair with a model-averaged non-synonymous rate of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e328" xlink:type="simple"/></inline-formula> is one of two rate pairs with low (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e329" xlink:type="simple"/></inline-formula>) cluster affinity for HIV-1 (<xref ref-type="fig" rid="pcbi-1000885-g004">Figure 4</xref>). Two of the inferred <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e330" xlink:type="simple"/></inline-formula> rate classes have non-synonymous rates of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e331" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e332" xlink:type="simple"/></inline-formula>, respectively, and the placement of model-averaged rate for <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e333" xlink:type="simple"/></inline-formula> between the two values is indicative of the alternate assignment of this substitution pair to these two rate classes among models of the credible set. A larger training data set may be able to infer an additional intermediate rate class between <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e334" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e335" xlink:type="simple"/></inline-formula>. While <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e336" xlink:type="simple"/></inline-formula> yields more robust numeric estimates of substitution rates for a single data set, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e337" xlink:type="simple"/></inline-formula> has better <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e338" xlink:type="simple"/></inline-formula> fit on validation HIV and IAV alignments (results not shown).</p>
</sec><sec id="s3d">
<title>The relationship between substitution rates and residue properties</title>
<p>The expectation that substitutions which preserve amino acid physicochemical properties occur at a lower rate than property-altering substitutions has previously been evaluated in the maximum likelihood codon model context <xref ref-type="bibr" rid="pcbi.1000885-Sainudiin1">[20]</xref>, <xref ref-type="bibr" rid="pcbi.1000885-Wong1">[47]</xref>. However, in published work, property-altering and property-conserving amino acid classes are defined <italic>a priori</italic>, whereas in the GA approach amino acid substitution pairs are first partitioned into classes based on rate similarity, and thereafter property preserving versus property-altering rates can be compared. The increased substitution rate of property preserving substitutions, holds largely – but not universally – for <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e339" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e340" xlink:type="simple"/></inline-formula> rates, as evidenced in <xref ref-type="fig" rid="pcbi-1000885-g006">Figures 6</xref> and <xref ref-type="fig" rid="pcbi-1000885-g007">7</xref>. For example, in the vertebrate rhodopsin sample, the median rate of charge-changing substitutions is significantly lower than the charge-preserving substitutions, but the two medians are not significantly different in the HIV-1 <italic>pol</italic> sample. The rates were negatively correlated (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e341" xlink:type="simple"/></inline-formula>, one-sided Pearson product moment test, no multiple test correction) with <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e342" xlink:type="simple"/></inline-formula> out of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e343" xlink:type="simple"/></inline-formula> property-based distances (polarity, volume, isoelectric point and hydropathy) that form the basis of the LCAP model. However, while the broad pattern follows the expectation, the consistently better fit of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e344" xlink:type="simple"/></inline-formula>-based models, and the presence of strong outliers, such as <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e345" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e346" xlink:type="simple"/></inline-formula> in the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e347" xlink:type="simple"/></inline-formula> cluster of HIV-1 rates (<xref ref-type="fig" rid="pcbi-1000885-g004">Figure 4</xref>), suggests that our data driven approach detects significant deviations from purely biochemical rate expectation. These deviations could be attributed to selective pressures which promote property changes, or could arise because not all biologically relevant important properties have been included into structured models.</p>
<fig id="pcbi-1000885-g006" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1000885.g006</object-id><label>Figure 6</label><caption>
<title>Correlations of lower substitution rates and property preservation in the HIV-1 group M <italic>pol</italic> alignment.</title>
<p>Model-averaged <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e348" xlink:type="simple"/></inline-formula> rates were stratified by whether or not they involved a change in polarity, charge or Stanfel class, the medians of two rate distributions were compared using a one sided Wilcoxon rank-sum test. We further correlated the magnitude of substitution rates with one of five property-based distances between the corresponding residues (defined in <xref ref-type="bibr" rid="pcbi.1000885-Conant2">[18]</xref>) using a one-sided (negative correlation) Pearson product-moment correlation test.</p>
</caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000885.g006" xlink:type="simple"/></fig><fig id="pcbi-1000885-g007" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1000885.g007</object-id><label>Figure 7</label><caption>
<title>Correlations of lower substitution rates and property preservation in the vertebrate rhodopsin alignment.</title>
<p>Model-averaged <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e349" xlink:type="simple"/></inline-formula> rates were stratified by whether or not they involved a change in polarity, charge or Stanfel class, the medians of two rate distributions were compared using a one sided Wilcoxon rank-sum test. We further correlated the magnitude of substitution rates with one of five property-based distances between the corresponding residues (defined in <xref ref-type="bibr" rid="pcbi.1000885-Conant2">[18]</xref>) using a one-sided (negative correlation) Pearson product-moment correlation test.</p>
</caption><graphic mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000885.g007" xlink:type="simple"/></fig>
<p>One benefit of our approach over the “amino acid class” models <xref ref-type="bibr" rid="pcbi.1000885-Sainudiin1">[20]</xref>, <xref ref-type="bibr" rid="pcbi.1000885-Wong1">[47]</xref> is that transitivity of rates (i.e. the requirement that if <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e350" xlink:type="simple"/></inline-formula>, and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e351" xlink:type="simple"/></inline-formula> are in the same rate class, then so is <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e352" xlink:type="simple"/></inline-formula>) is not enforced by the GA models. Because we focus on modeling single-nucleotide substitution rates only, the structure of the genetic code itself contradicts transitivity. For instance both <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e353" xlink:type="simple"/></inline-formula> (encoded by <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e354" xlink:type="simple"/></inline-formula>) <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e355" xlink:type="simple"/></inline-formula> <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e356" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e357" xlink:type="simple"/></inline-formula> are one-step substitutions, but <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e358" xlink:type="simple"/></inline-formula> is not. Further, since amino acid class models only estimate two non-synonymous rates (within and between classes), it is a necessary condition that non-synonymous rates which change amino acid property be shared irrespective of how much the property is being changed. For instance, substitution rates which change charge from negative to positive will be the same as those which change charge from negative/positive to uncharged. If amino acid substitutions that result in a positive charge are favored, then these transitive conditions are not representative of the substitution process. Furthermore, the amino acid class models assume all substitutions within classes occur at the same rate. This is a very strong assumption since some amino acids with the same physicochemical property class are separated by more than one nucleotide substitution, e.g. positively charged amino acids <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e359" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e360" xlink:type="simple"/></inline-formula>. Although we do not account for multiple nucleotide substitutions in the GA model directly (but see below), previous work has demonstrated that these occur at lower rates than single-nucleotide substitutions <xref ref-type="bibr" rid="pcbi.1000885-DoronFaigenboim1">[9]</xref>, <xref ref-type="bibr" rid="pcbi.1000885-Kosiol1">[10]</xref>, <xref ref-type="bibr" rid="pcbi.1000885-Whelan3">[48]</xref>.</p>
</sec><sec id="s3e">
<title>Model clustering</title>
<p>Using the substitution spectrum distance defined in Equation (2), it is easy to construct a hierarchical clustering of several models fitted to the same dataset, as well as between models fitted to different datasets. The former is useful to interpret how much difference in predicted substitution patterns over a unit of evolutionary time there is between different descriptions of the same data, whilst the latter naturally extends the concept of evolutionary fingerprinting of non-homologous genes <xref ref-type="bibr" rid="pcbi.1000885-KosakovskyPond4">[27]</xref>. For HIV-1 pol (<xref ref-type="fig" rid="pcbi-1000885-g003">Figure 3</xref>), <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e361" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e362" xlink:type="simple"/></inline-formula> models both clustered closely with the rate substitution pattern predicted by the REV model, followed by LCAP, ECM+F+<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e363" xlink:type="simple"/></inline-formula>, and finally – distant single rate models. The similarity between REV and GA models was especially strong for the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e364" xlink:type="simple"/></inline-formula> parameterization, under which the GA models were inferred. In a between-genes model comparison (<xref ref-type="fig" rid="pcbi-1000885-g003">Figure 3</xref>), the two viral alignments clustered together, as did the two most divergent alignments (ATP-cone and Transketolase C).</p>
</sec><sec id="s3f">
<title>Effects of substitution models on statistical inference</title>
<p>Statistical inference procedures based on phylogenetic models have varying degrees of robustness with respect to the substitution rate matrix used in the analysis. For a multi-rate model, it is intuitively clear that the types of inference that rely on “mean” rates should be minimally affected, whereas those that depend on the individual residue rates can be affected significantly. We examine several such measures inferred from two of the datasets in this study.</p>
<p>Branch length estimates are essentially unchanged when moving from the single-rate (SR) model to a <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e365" xlink:type="simple"/></inline-formula> model. On the example HIV-1 <italic>pol</italic> dataset, the total tree length changed from to <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e366" xlink:type="simple"/></inline-formula> (SR) expected substitutions/nucleotide to <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e367" xlink:type="simple"/></inline-formula> (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e368" xlink:type="simple"/></inline-formula>), and the lengths of individual branches were nearly perfectly linearly correlated with linear regression slope of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e369" xlink:type="simple"/></inline-formula>, intercept of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e370" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e371" xlink:type="simple"/></inline-formula>.</p>
<p>Ancestral character reconstruction is considerably more sensitive to the substitution model. In the vertebrate rhodopsin data set, for example, the joint maximum likelihood ancestral reconstruction <xref ref-type="bibr" rid="pcbi.1000885-Pupko1">[49]</xref> under SR and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e372" xlink:type="simple"/></inline-formula> models differed in the number of inferred non-synonymous substitutions at <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e373" xlink:type="simple"/></inline-formula> sites, with more non-synonymous substitutions in <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e374" xlink:type="simple"/></inline-formula> cases under <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e375" xlink:type="simple"/></inline-formula>. At <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e376" xlink:type="simple"/></inline-formula> sites substitutions were mapped to a different set of branches.</p>
<p>Site-specific diversifying selection screens are likely to be profoundly affected by a switch from single- to multi-rate models. Consider the FEL method <xref ref-type="bibr" rid="pcbi.1000885-KosakovskyPond10">[50]</xref>, where the SR model is fitted site-by-site and a likelihood ratio test (LRT) is used to test whether <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e377" xlink:type="simple"/></inline-formula>. First, because <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e378" xlink:type="simple"/></inline-formula> defines multiple substitution classes, one can now apply a variety of tests to see <italic>which</italic> non-synonymous rates at a given site exceed the baseline synonymous rate. To explore this approach for a <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e379" xlink:type="simple"/></inline-formula>rate <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e380" xlink:type="simple"/></inline-formula> multi-class model applied to the vertebrate rhodopsin alignment, we performed <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e381" xlink:type="simple"/></inline-formula> LRT tests, where we independently constrained each non-synonymous rate parameter (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e382" xlink:type="simple"/></inline-formula>, <xref ref-type="table" rid="pcbi-1000885-t001">Table 1</xref>) to be equal to <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e383" xlink:type="simple"/></inline-formula> at a site (neutral evolution in class <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e384" xlink:type="simple"/></inline-formula>), vs an unconstrained <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e385" xlink:type="simple"/></inline-formula>parameter alternative. This is analogous to performing a test for selection at a site by constraining the non-synonymous rate to be equal to the synonymous rate, and comparing the fit to the unconstrained model (FEL), except that we only place the constraint on one rate class at a time. At <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e386" xlink:type="simple"/></inline-formula>, the standard (SR) FEL reported <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e387" xlink:type="simple"/></inline-formula> (codon 54) sites as being under diversifying selection (positively selected). However, for the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e388" xlink:type="simple"/></inline-formula> model, there were <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e389" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e390" xlink:type="simple"/></inline-formula> positively selected sites for the four substitution classes (<xref ref-type="fig" rid="pcbi-1000885-g005">Figure 5</xref>, increasing rate magnitude), respectively at the Bonferroni corrected <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e391" xlink:type="simple"/></inline-formula> of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e392" xlink:type="simple"/></inline-formula>. Codon 54 was selected only with the fastest rate class (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e393" xlink:type="simple"/></inline-formula>), because the signal of selection is driven by a large number of <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e394" xlink:type="simple"/></inline-formula> substitutions. Only one codon (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e395" xlink:type="simple"/></inline-formula>) was selected with two or more different tests (rate classes <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e396" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e397" xlink:type="simple"/></inline-formula>).</p>
</sec><sec id="s3g">
<title>The effect of site-to-site rate variation</title>
<p>We remark that the effects of site-to-site rate variation and multiple non-synonymous rates appear to be largely additive, and not confounded. This is a critical observation: if the effects are confounded, then we cannot justify inferring the multi-rate model independently assuming no site-to-site rate variation, as is done in this manuscript for computational expedience. To illustrate, we fitted both a constant rate model and the general bivariate distribution <xref ref-type="bibr" rid="pcbi.1000885-KosakovskyPond4">[27]</xref>, with and without accounting for multiple non-synonymous rate classes (<xref ref-type="table" rid="pcbi-1000885-t005">Table 5</xref>). The constant rate model assumes all sites share the same rate of substitution, whereas a general bivariate distribution infers the number of site-to-site variation classes from the data <xref ref-type="bibr" rid="pcbi.1000885-KosakovskyPond4">[27]</xref>. These models were fitted to the vertebrate rhodopsin alignment, which exhibits extensive site to site rate heterogeneity. The <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e398" xlink:type="simple"/></inline-formula> inferred 4 non-synonymous rate classes for the rhodopsin alignment, whereas the single <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e399" xlink:type="simple"/></inline-formula> has one, resulting in three degrees of freedom for the comparison of these models. When the general bivariate model was fitted with a single <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e400" xlink:type="simple"/></inline-formula> or <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e401" xlink:type="simple"/></inline-formula>, 6 and 7 site classes were inferred, respectively, resulting in 4 degrees of freedom for the comparison of single <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e402" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e403" xlink:type="simple"/></inline-formula> models (3 rate and 1 site class are added to the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e404" xlink:type="simple"/></inline-formula> model). The important observation is that the addition of site-to-site rate variation component resulted in a significant improvement in log likelihood scores, regardless of the underlying substitution model (single <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e405" xlink:type="simple"/></inline-formula> or <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e406" xlink:type="simple"/></inline-formula>). This suggests that by allowing multiple rate classes, we are not merely fitting variability in site-to-site selective constraints. However, as the cost of computing cores in clusters decreases, we expect that it will become practical to infer <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e407" xlink:type="simple"/></inline-formula> models with the site-to-site rate variation component included directly in the search procedure.</p>
<table-wrap id="pcbi-1000885-t005" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1000885.t005</object-id><label>Table 5</label><caption>
<title>The effects of modeling site-to-site rate variation and multiple non-synonymous rates in the vertebrate rhodopsin alignment using the MG frequency parameterization.</title>
</caption><!--===== Grouping alternate versions of objects =====--><alternatives><graphic id="pcbi-1000885-t005-5" mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000885.t005" xlink:type="simple"/><table><colgroup span="1"><col align="left" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/></colgroup>
<thead>
<tr>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1">Single <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e408" xlink:type="simple"/></inline-formula></td>
<td align="left" colspan="1" rowspan="1"><inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e409" xlink:type="simple"/></inline-formula> (+3 df)</td>
<td align="left" colspan="1" rowspan="1"><inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e410" xlink:type="simple"/></inline-formula></td>
</tr>
</thead>
<tbody>
<tr>
<td align="left" colspan="1" rowspan="1">Constant rates</td>
<td align="left" colspan="1" rowspan="1">−13382.6</td>
<td align="left" colspan="1" rowspan="1">−12954.2</td>
<td align="left" colspan="1" rowspan="1">428.4</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">General bivariate rates (+4 df)</td>
<td align="left" colspan="1" rowspan="1">−12780.8</td>
<td align="left" colspan="1" rowspan="1">−12500.4</td>
<td align="left" colspan="1" rowspan="1">280.4</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1"><inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e411" xlink:type="simple"/></inline-formula></td>
<td align="left" colspan="1" rowspan="1">601.8</td>
<td align="left" colspan="1" rowspan="1">453.8</td>
<td align="left" colspan="1" rowspan="1"/>
</tr>
</tbody>
</table></alternatives><table-wrap-foot><fn id="nt108"><label/><p>The entry for joint effect was obtained by running the general bivariate model fit using the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e412" xlink:type="simple"/></inline-formula> model obtained under the assumption of constant site-to-site rates. df = degrees of freedom.</p></fn></table-wrap-foot></table-wrap></sec><sec id="s3h">
<title>The effect of allowing multiple instantaneous nucleotide substitutions</title>
<p>Recent extensions of codon models which permit multiple instantaneous nucleotide substitutions <xref ref-type="bibr" rid="pcbi.1000885-DoronFaigenboim1">[9]</xref>, <xref ref-type="bibr" rid="pcbi.1000885-Kosiol1">[10]</xref>, <xref ref-type="bibr" rid="pcbi.1000885-Whelan3">[48]</xref> tend to fit the data better than their traditionally parameterized counterparts. We explored whether this observation held for <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e413" xlink:type="simple"/></inline-formula> models using a straightforward extension of the rate matrix in Equation (1), following the ideas of <xref ref-type="bibr" rid="pcbi.1000885-DoronFaigenboim1">[9]</xref>. We introduce four new independently estimated parameters to model the relative rates of synonymous (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e414" xlink:type="simple"/></inline-formula>) and non-synonymous (<inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e415" xlink:type="simple"/></inline-formula>) substitutions which replace two or three nucleotides, and modulate them by the product of the corresponding nucleotide rates <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e416" xlink:type="simple"/></inline-formula> and the target codon frequency <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e417" xlink:type="simple"/></inline-formula> (assuming the GY parameterization with the F61 estimator). For instance the rate of synonymous substitution (Serine) from <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e418" xlink:type="simple"/></inline-formula> to <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e419" xlink:type="simple"/></inline-formula> is <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e420" xlink:type="simple"/></inline-formula>, while the rate of non-synonymous substitution <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e421" xlink:type="simple"/></inline-formula> (Lysine to Proline) is <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e422" xlink:type="simple"/></inline-formula>.</p>
<p><xref ref-type="table" rid="pcbi-1000885-t006">Table 6</xref> summarizes the effect of adding multi-step substitutions to SR and <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e423" xlink:type="simple"/></inline-formula> models for the vertebrate rhodopsin alignment. Much as was the case for site-to-site rate variation, the effects of multiple single-step non-synonymous rates and the non-zero rates of two or three nucleotide substitutions are additive at the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e424" xlink:type="simple"/></inline-formula> level, and the estimates of single-step substitution rates were minimally influenced by the presence of the multi-step component (results not shown). The <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e425" xlink:type="simple"/></inline-formula> model augmented to allow multi-step substitutions can be directly compared to the Mechanistic-Empirical codon (MEC) model <xref ref-type="bibr" rid="pcbi.1000885-DoronFaigenboim1">[9]</xref> coupled with the LG <xref ref-type="bibr" rid="pcbi.1000885-Le1">[51]</xref>empirical amino-acid substitution model (selected as the best fitting empirical model using the procedure implemented on <ext-link ext-link-type="uri" xlink:href="http://www.datamonkey.org" xlink:type="simple">http://www.datamonkey.org</ext-link>. Assuming no site-to-site rate variation, BIC of the MEC model is <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e426" xlink:type="simple"/></inline-formula>, while that of the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e427" xlink:type="simple"/></inline-formula>+multi-step model using the HKY85 nucleotide component (a direct analog to the MEC model) is <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e428" xlink:type="simple"/></inline-formula>, once again highlighting how strongly the substitution process in an individual gene appears to deviate from the “average” encoded by empirical protein models.</p>
<table-wrap id="pcbi-1000885-t006" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1000885.t006</object-id><label>Table 6</label><caption>
<title>The effects of modeling multi-nucleotide instantaneous substitutions and multiple non-synonymous rates in the vertebrate rhodopsin alignment using the F61 frequency parameterization.</title>
</caption><!--===== Grouping alternate versions of objects =====--><alternatives><graphic id="pcbi-1000885-t006-6" mimetype="image" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000885.t006" xlink:type="simple"/><table><colgroup span="1"><col align="left" span="1"/><col align="center" span="1"/><col align="center" span="1"/><col align="center" span="1"/></colgroup>
<thead>
<tr>
<td align="left" colspan="1" rowspan="1"/>
<td align="left" colspan="1" rowspan="1">Single <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e429" xlink:type="simple"/></inline-formula></td>
<td align="left" colspan="1" rowspan="1"><inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e430" xlink:type="simple"/></inline-formula> (+3 df)</td>
<td align="left" colspan="1" rowspan="1"><inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e431" xlink:type="simple"/></inline-formula></td>
</tr>
</thead>
<tbody>
<tr>
<td align="left" colspan="1" rowspan="1">Single-nucleotide substitutions only</td>
<td align="left" colspan="1" rowspan="1">−13317.6</td>
<td align="left" colspan="1" rowspan="1">−13005.5</td>
<td align="left" colspan="1" rowspan="1">312.1</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1">Single and multi-nucleotide substitutions (+4 df)</td>
<td align="left" colspan="1" rowspan="1">−13033.4</td>
<td align="left" colspan="1" rowspan="1">−12712.5</td>
<td align="left" colspan="1" rowspan="1">320.9</td>
</tr>
<tr>
<td align="left" colspan="1" rowspan="1"><inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e432" xlink:type="simple"/></inline-formula></td>
<td align="left" colspan="1" rowspan="1">284.2</td>
<td align="left" colspan="1" rowspan="1">293</td>
<td align="left" colspan="1" rowspan="1"/>
</tr>
</tbody>
</table></alternatives><table-wrap-foot><fn id="nt109"><label/><p>The entry for joint effect was obtained by augmenting the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e433" xlink:type="simple"/></inline-formula> model with non-zero rates for substitutions requiring two or three nucleotide changes. df = degrees of freedom.</p></fn></table-wrap-foot></table-wrap>
<p>The GA could be modified to search for optimal partitions among all <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e434" xlink:type="simple"/></inline-formula> pairs of rates, for example using the above parameterization, but as the rhodopsin example indicates, the single-step and multi-step rate rate components appear to be effectively independent. We will explore this option in future versions of the model selection GA.</p>
</sec></sec><sec id="s4">
<title>Discussion</title>
<p>In this manuscript we have developed, validated and benchmarked a procedure to quickly and reliably infer a multi-rate model from the combinatorially large class of general time-reversible codon substitution models. Using extensive simulations, we demonstrated that our conservative <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e435" xlink:type="simple"/></inline-formula> model selection criterion controls over-fitting and has excellent power on data sets of biologically realistic size, inferring the exact model simulated given sufficient sequence divergence and length. We have previously argued against using the single rate model as a benchmark against which multi-rate models should be compared, since it is trivial to improve upon using a random assignment of substitutions to rate classes <xref ref-type="bibr" rid="pcbi.1000885-Delport2">[19]</xref>. We reiterate this argument here, and suggest we should rather consider how well a multi-rate model approximates the REV model (<xref ref-type="fig" rid="pcbi-1000885-g002">Figure 2</xref>), given the limitations posed by the information content in an alignment. On a diverse collection of biological data, <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e436" xlink:type="simple"/></inline-formula> models consistently outperform the best-in-class empirical and mechanistic models, and match the performance of fully parameterized general time reversible models with only a few biologically relevant rate parameters (<xref ref-type="table" rid="pcbi-1000885-t004">Table 4</xref>). Therefore, the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e437" xlink:type="simple"/></inline-formula> provides goodness of fit matching or exceeding that of REV, with substantially fewer parameters and is thus computationally and statistically feasible for downstream analyses.</p>
<p>ModelTest <xref ref-type="bibr" rid="pcbi.1000885-Posada1">[22]</xref> has been universally adopted to mitigate the effect of model misspecification on statistical inference from nucleotide data, and we posit that a robust codon model selection procedure, for example the one offered in this paper, will play a similar role for codon data. In the same vein as ModelTest, we infer the best model (which we term the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e438" xlink:type="simple"/></inline-formula>) for an alignment, and also utilize model averaging <xref ref-type="bibr" rid="pcbi.1000885-Posada2">[26]</xref> to achieve more robust estimates of biologically relevant parameters. Certain applications of codon models, such as divergence estimation, appear unaffected by the gross biological over-simplification of single-rate models, because they are only influenced by the mean of substitution rates. Others, including ancestral sequence reconstruction (e.g. for guided site directed mutagenesis, <xref ref-type="bibr" rid="pcbi.1000885-Yokoyama1">[38]</xref>), substitution mapping (e.g. for co-evolutionary analysis, <xref ref-type="bibr" rid="pcbi.1000885-Poon1">[52]</xref>) and character sampling (e.g. for data augmentation modeling approaches, <xref ref-type="bibr" rid="pcbi.1000885-Rodrigue1">[53]</xref>) can see moderate effects. Applications which are tightly integrated with the substitution model and the interpretation of its parameters, such as site-by-site positive selection detection (e.g. <xref ref-type="bibr" rid="pcbi.1000885-KosakovskyPond10">[50]</xref>, <xref ref-type="bibr" rid="pcbi.1000885-Yang2">[54]</xref>), will be profoundly affected by the introduction of multiple rates. Our results strongly argue against the prospect of deriving a single “generalist” model of codon evolution, that is capable of fitting most protein alignments well. Hence we should strive to fit both gene and taxonomy specific models of codon evolution. We further hypothesize that independent alignments representing a gene or a protein family will share most of the model structure and confirm this with HIV-1 polymerase and Influenza A virus hemagglutinin examples. While significant further validation is required and is currently underway, we assert that a collection of substitution models inferred from carefully selected training datasets can provide a useful library of organism and gene-specific models to be used in inference on codon sequences. This is conceptually similar to a library of Hidden Markov profile models, inferred from seed alignments, used for detecting protein domain homology in the Pfam database <xref ref-type="bibr" rid="pcbi.1000885-Sonnhammer1">[55]</xref>. In order to facilitate the process of generating gene and taxonomic specific multi-rate codon models we have implemented the GA on our free analysis webserver (<ext-link ext-link-type="uri" xlink:href="http://www.datamonkey.org" xlink:type="simple">http://www.datamonkey.org</ext-link>, <xref ref-type="bibr" rid="pcbi.1000885-KosakovskyPond9">[46]</xref>), and have begun to assemble a library of representative multi-rate substitution models that are needed to reduce biases in those procedures that are sensitive to model misspecification.</p>
<p>The inference of the multi-rate codon models should be considered more than just a necessary step for downstream applications. By examining the structure of inferred rate classes, we argue that the <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e439" xlink:type="simple"/></inline-formula> captures the <italic>a priori</italic> expectation that radical changes in one or more biochemical properties of a residue happen relatively infrequently, but also that a mere reliance on such data-abstract mechanistic properties misses out important gene and organism specific peculiarities of the evolutionary process. For instance the elevation of substitution rates between amino acids that do not preserve physicochemical properties may be indicative of selective pressures which promote property changes. These selective pressures are of crucial importance in understanding evolution in viruses, such as HIV-1, known to evade host immune response <xref ref-type="bibr" rid="pcbi.1000885-Leslie1">[56]</xref>. We anticipate that considering specific substitution types when estimating selective pressures will improve power, as demonstrated with our multi-rate FEL analysis of vertebrate rhodopsin. However, this may also increase the rate of false positives, a conjecture that can be evaluated with straightforward, but laborious simulations.</p>
<p>Finally, we demonstrate how simple metrics on <inline-formula><inline-graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1000885.e440" xlink:type="simple"/></inline-formula> models inferred from different (e.g. non-homologous) alignments can be used to obtain an objective measure of similarity and disparity in substitutional preferences in different proteins and thus improve the resolution in evolutionary fingerprinting of genes <xref ref-type="bibr" rid="pcbi.1000885-KosakovskyPond4">[27]</xref>.</p>
</sec><sec id="s5">
<title>Supporting Information</title>
<supplementary-material id="pcbi.1000885.s001" mimetype="application/pdf" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000885.s001" xlink:type="simple"><label>Table S1</label><caption>
<p>Difference in mean (standard deviation) model <italic>mBIC</italic> scores for multi-taxon simulations. <italic>D</italic> is the average pairwise divergence; <italic>mBIC<sub>n</sub></italic> is the difference in model <italic>mBIC</italic> score between the model with <italic>n</italic>−1 rates and a more complex with <italic>n</italic> rates; P is the proportion of correctly identified models for 100 simulations. Positive <italic>mBIC</italic> scores indicate preference for the more complex model with <italic>n</italic> rates, i.e. <italic>mBIC<sub>n</sub></italic> = <italic>mBIC<sub>n−1</sub>−mBIC<sub>n</sub></italic>.</p>
<p>(0.04 MB PDF)</p>
</caption></supplementary-material><supplementary-material id="pcbi.1000885.s002" mimetype="application/pdf" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000885.s002" xlink:type="simple"><label>Table S2</label><caption>
<p>Randomly selected Pandit data model comparisons using BIC. In each case we fitted the ECM, LCAP and <italic>GA<sub>s</sub></italic> models to each of four randomly selected Pandit datasets. Model ranks (BIC/difference in BIC score relative to the best model) are shown.</p>
<p>(0.03 MB PDF)</p>
</caption></supplementary-material><supplementary-material id="pcbi.1000885.s003" mimetype="application/pdf" position="float" xlink:href="info:doi/10.1371/journal.pcbi.1000885.s003" xlink:type="simple"><label>Table S3</label><caption>
<p>Qualitative comparison of structured GA models.</p>
<p>(0.02 MB PDF)</p>
</caption></supplementary-material></sec></body>
<back>
<ack>
<p>We thank Associate Editor, Wen-Hsiung Li, Tal Pupko and an anonymous reviewer for insightful comments on an earlier draft of this manuscript.</p>
</ack>
<ref-list>
<title>References</title>
<ref id="pcbi.1000885-Felsenstein1"><label>1</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Felsenstein</surname><given-names>J</given-names></name>
</person-group>             <year>1981</year>             <article-title>Evolutionary trees from DNA-sequences – a maximum-likelihood approach.</article-title>             <source>J Mol Evol</source>             <volume>17</volume>             <fpage>368</fpage>             <lpage>376</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-Muse1"><label>2</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Muse</surname><given-names>SV</given-names></name>
<name name-style="western"><surname>Gaut</surname><given-names>BS</given-names></name>
</person-group>             <year>1994</year>             <article-title>A likelihood approach for comparing synonymous and nonsynonymous nucleotide substitution rates, with application to the chloroplast genome.</article-title>             <source>Mol Biol Evol</source>             <volume>11</volume>             <fpage>715</fpage>             <lpage>724</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-Goldman1"><label>3</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Goldman</surname><given-names>N</given-names></name>
<name name-style="western"><surname>Yang</surname><given-names>Z</given-names></name>
</person-group>             <year>1994</year>             <article-title>A codon-based model of nucleotide substitution for protein-coding DNA sequences.</article-title>             <source>Mol Biol Evol</source>             <volume>11</volume>             <fpage>725</fpage>             <lpage>736</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-Anisimova1"><label>4</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Anisimova</surname><given-names>M</given-names></name>
<name name-style="western"><surname>Kosiol</surname><given-names>C</given-names></name>
</person-group>             <year>2009</year>             <article-title>Investigating protein-coding sequence evolution with probabilistic codon substitution models.</article-title>             <source>Mol Biol Evol</source>             <volume>26</volume>             <fpage>255</fpage>             <lpage>271</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-Delport1"><label>5</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Delport</surname><given-names>W</given-names></name>
<name name-style="western"><surname>Scheffler</surname><given-names>K</given-names></name>
<name name-style="western"><surname>Seoighe</surname><given-names>C</given-names></name>
</person-group>             <year>2009</year>             <article-title>Models of coding sequence evolution.</article-title>             <source>Brief Bioinform</source>             <volume>10</volume>             <fpage>97</fpage>             <lpage>109</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-Dayhoff1"><label>6</label><element-citation publication-type="other" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Dayhoff</surname><given-names>MO</given-names></name>
<name name-style="western"><surname>Eck</surname><given-names>EV</given-names></name>
<name name-style="western"><surname>Park</surname><given-names>CM</given-names></name>
</person-group>             <year>1972</year>             <article-title>A model of evolutionary change in proteins.</article-title>             <person-group person-group-type="editor">
<name name-style="western"><surname>Dayhoff</surname><given-names>MO</given-names></name>
</person-group>             <source>Atlas of protein sequence and structure, National Biomedical Research Foundation, Washington D.C., volume 5</source>             <fpage>89</fpage>             <lpage>99</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-Jones1"><label>7</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Jones</surname><given-names>D</given-names></name>
<name name-style="western"><surname>Taylor</surname><given-names>W</given-names></name>
<name name-style="western"><surname>Thornton</surname><given-names>J</given-names></name>
</person-group>             <year>1992</year>             <article-title>The rapid generation of mutation data matrices from protein sequences.</article-title>             <source>Comput Appl Biosci</source>             <volume>8</volume>             <fpage>275</fpage>             <lpage>82</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-Whelan1"><label>8</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Whelan</surname><given-names>S</given-names></name>
<name name-style="western"><surname>Goldman</surname><given-names>N</given-names></name>
</person-group>             <year>2001</year>             <article-title>A general empirical model of protein evolution derived from multiple protein families using a maximum-likelihood approach.</article-title>             <source>Mol Biol Evol</source>             <volume>18</volume>             <fpage>691</fpage>             <lpage>699</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-DoronFaigenboim1"><label>9</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Doron-Faigenboim</surname><given-names>A</given-names></name>
<name name-style="western"><surname>Pupko</surname><given-names>T</given-names></name>
</person-group>             <year>2007</year>             <article-title>A combined empirical and mechanistic codon model.</article-title>             <source>Mol Biol Evol</source>             <volume>24</volume>             <fpage>388</fpage>             <lpage>397</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-Kosiol1"><label>10</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Kosiol</surname><given-names>C</given-names></name>
<name name-style="western"><surname>Holmes</surname><given-names>I</given-names></name>
<name name-style="western"><surname>Goldman</surname><given-names>N</given-names></name>
</person-group>             <year>2007</year>             <article-title>An empirical codon model for protein sequence evolution.</article-title>             <source>Mol Biol Evol</source>             <volume>24</volume>             <fpage>1464</fpage>             <lpage>1479</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-Tavar1"><label>11</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Tavaré</surname><given-names>S</given-names></name>
</person-group>             <year>1986</year>             <article-title>Some probabilistic and statistical problems in the analysis of DNA sequences.</article-title>             <source>Lectures on Mathematics in the Life Sciences</source>             <volume>17</volume>             <fpage>57</fpage>             <lpage>86</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-Whelan2"><label>12</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Whelan</surname><given-names>S</given-names></name>
<name name-style="western"><surname>de Bakker</surname><given-names>PIW</given-names></name>
<name name-style="western"><surname>Quevillon</surname><given-names>E</given-names></name>
<name name-style="western"><surname>Rodriguez</surname><given-names>N</given-names></name>
<name name-style="western"><surname>Goldman</surname><given-names>N</given-names></name>
</person-group>             <year>2006</year>             <article-title>Pandit: an evolution-centric database of protein and associated nucleotide domains with inferred trees.</article-title>             <source>Nucleic Acids Res</source>             <volume>34</volume>             <fpage>D327</fpage>             <lpage>31</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-Adachi1"><label>13</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Adachi</surname><given-names>J</given-names></name>
<name name-style="western"><surname>Hasegawa</surname><given-names>M</given-names></name>
</person-group>             <year>1996</year>             <article-title>Model of amino acid substitution in proteins encoded by mitochondrial DNA.</article-title>             <source>J Mol Evol</source>             <volume>42</volume>             <fpage>459</fpage>             <lpage>468</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-Adachi2"><label>14</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Adachi</surname><given-names>J</given-names></name>
<name name-style="western"><surname>Waddell</surname><given-names>P</given-names></name>
<name name-style="western"><surname>Martin</surname><given-names>W</given-names></name>
<name name-style="western"><surname>Hasegawa</surname><given-names>M</given-names></name>
</person-group>             <year>2000</year>             <article-title>Plastid genome phylogeny and a model of amino acid substitution for proteins encoded by chloroplast DNA.</article-title>             <source>J Mol Evol</source>             <volume>50</volume>             <fpage>348</fpage>             <lpage>358</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-Dimmic1"><label>15</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Dimmic</surname><given-names>MW</given-names></name>
<name name-style="western"><surname>Rest</surname><given-names>JS</given-names></name>
<name name-style="western"><surname>Mindell</surname><given-names>DP</given-names></name>
<name name-style="western"><surname>Goldstein</surname><given-names>RA</given-names></name>
</person-group>             <year>2002</year>             <article-title>rtREV: an amino acid substitution matrix for inference of retrovirus and reverse transcriptase phylogeny.</article-title>             <source>J Mol Evol</source>             <volume>55</volume>             <fpage>65</fpage>             <lpage>73</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-Nickle1"><label>16</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Nickle</surname><given-names>DC</given-names></name>
<name name-style="western"><surname>Heath</surname><given-names>L</given-names></name>
<name name-style="western"><surname>Jensen</surname><given-names>MA</given-names></name>
<name name-style="western"><surname>Gilbert</surname><given-names>PB</given-names></name>
<name name-style="western"><surname>Mullins</surname><given-names>JI</given-names></name>
<etal/></person-group>             <year>2007</year>             <article-title>HIV-specific probabilistic models of protein evolution.</article-title>             <source>PLoS ONE</source>             <volume>2</volume>             <fpage>e503</fpage>          </element-citation></ref>
<ref id="pcbi.1000885-Conant1"><label>17</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Conant</surname><given-names>GC</given-names></name>
<name name-style="western"><surname>Wagner</surname><given-names>GP</given-names></name>
<name name-style="western"><surname>Stadler</surname><given-names>PF</given-names></name>
</person-group>             <year>2007</year>             <article-title>Modeling amino acid substitution patterns in orthologous and paralogous genes.</article-title>             <source>Mol Phylogenet Evol</source>             <volume>42</volume>             <fpage>298</fpage>             <lpage>307</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-Conant2"><label>18</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Conant</surname><given-names>GC</given-names></name>
<name name-style="western"><surname>Stadler</surname><given-names>PF</given-names></name>
</person-group>             <year>2009</year>             <article-title>Solvent exposure imparts similar selective pressures across a range of yeast proteins.</article-title>             <source>Mol Biol Evol</source>             <volume>26</volume>             <fpage>1155</fpage>             <lpage>1161</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-Delport2"><label>19</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Delport</surname><given-names>W</given-names></name>
<name name-style="western"><surname>Scheffler</surname><given-names>K</given-names></name>
<name name-style="western"><surname>Muse</surname><given-names>SV</given-names></name>
<name name-style="western"><surname>Kosakovsky Pond</surname><given-names>S</given-names></name>
</person-group>             <year>in press</year>             <article-title>Benchmarking multi-rate codon models.</article-title>             <source>PLoS One</source>          </element-citation></ref>
<ref id="pcbi.1000885-Sainudiin1"><label>20</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Sainudiin</surname><given-names>R</given-names></name>
<name name-style="western"><surname>Wong</surname><given-names>WSW</given-names></name>
<name name-style="western"><surname>Yogeeswaran</surname><given-names>K</given-names></name>
<name name-style="western"><surname>Nasrallah</surname><given-names>JB</given-names></name>
<name name-style="western"><surname>Yang</surname><given-names>Z</given-names></name>
<etal/></person-group>             <year>2005</year>             <article-title>Detecting site-specific physicochemical selective pressures: applications to the Class I HLA of the human major histocompatibility complex and the SRK of the plant sporophytic self-incompatibility system.</article-title>             <source>J Mol Evol</source>             <volume>60</volume>             <fpage>315</fpage>             <lpage>326</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-Huelsenbeck1"><label>21</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Huelsenbeck</surname><given-names>JP</given-names></name>
<name name-style="western"><surname>Joyce</surname><given-names>P</given-names></name>
<name name-style="western"><surname>Lakner</surname><given-names>C</given-names></name>
<name name-style="western"><surname>Ronquist</surname><given-names>F</given-names></name>
</person-group>             <year>2008</year>             <article-title>Bayesian analysis of amino acid substitution models.</article-title>             <source>Philos Trans R Soc Lond B Biol Sci</source>             <volume>363</volume>             <fpage>3941</fpage>             <lpage>3953</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-Posada1"><label>22</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Posada</surname><given-names>D</given-names></name>
<name name-style="western"><surname>Crandall</surname><given-names>K</given-names></name>
</person-group>             <year>1998</year>             <article-title>Modeltest: testing the model of DNA substitution.</article-title>             <source>Bioinformatics</source>             <volume>14</volume>             <fpage>817</fpage>             <lpage>818</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-KosakovskyPond1"><label>23</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Kosakovsky Pond</surname><given-names>SL</given-names></name>
<name name-style="western"><surname>Frost</surname><given-names>SDW</given-names></name>
</person-group>             <year>2005</year>             <article-title>A genetic algorithm approach to detecting lineage-specific variation in selection pressure.</article-title>             <source>Mol Biol Evol</source>             <volume>22</volume>             <fpage>478</fpage>             <lpage>485</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-KosakovskyPond2"><label>24</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Kosakovsky Pond</surname><given-names>SL</given-names></name>
<name name-style="western"><surname>Posada</surname><given-names>D</given-names></name>
<name name-style="western"><surname>Gravenor</surname><given-names>MB</given-names></name>
<name name-style="western"><surname>Woelk</surname><given-names>CH</given-names></name>
<name name-style="western"><surname>Frost</surname><given-names>SD</given-names></name>
</person-group>             <year>2006</year>             <article-title>Automated phylogenetic detection of recombination using a genetic algorithm.</article-title>             <source>Mol Biol Evol</source>             <volume>23</volume>             <fpage>1891</fpage>             <lpage>1901</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-KosakovskyPond3"><label>25</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Kosakovsky Pond</surname><given-names>SL</given-names></name>
<name name-style="western"><surname>Mannino</surname><given-names>FV</given-names></name>
<name name-style="western"><surname>Gravenor</surname><given-names>MB</given-names></name>
<name name-style="western"><surname>Muse</surname><given-names>SV</given-names></name>
<name name-style="western"><surname>Frost</surname><given-names>SD</given-names></name>
</person-group>             <year>2007</year>             <article-title>Evolutionary model selection with a genetic algorithm: a case study using stem RNA.</article-title>             <source>Mol Biol Evol</source>             <volume>24</volume>             <fpage>159</fpage>             <lpage>170</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-Posada2"><label>26</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Posada</surname><given-names>D</given-names></name>
</person-group>             <year>2008</year>             <article-title>jModelTest: phylogenetic model averaging.</article-title>             <source>Mol Biol Evol</source>             <volume>25</volume>             <fpage>1253</fpage>             <lpage>1256</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-KosakovskyPond4"><label>27</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Kosakovsky Pond</surname><given-names>S</given-names></name>
<name name-style="western"><surname>Scheffler</surname><given-names>K</given-names></name>
<name name-style="western"><surname>Gravenor</surname><given-names>M</given-names></name>
<name name-style="western"><surname>Poon</surname><given-names>A</given-names></name>
<name name-style="western"><surname>Frost</surname><given-names>S</given-names></name>
</person-group>             <year>2009</year>             <article-title>Evolutionary fingerprinting of genes.</article-title>             <source>Mol Biol Evol</source>             <volume>27</volume>             <fpage>520</fpage>             <lpage>536</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-KosakovskyPond5"><label>28</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Kosakovsky Pond</surname><given-names>S</given-names></name>
<name name-style="western"><surname>Delport</surname><given-names>W</given-names></name>
<name name-style="western"><surname>Muse</surname><given-names>SV</given-names></name>
<name name-style="western"><surname>Scheffler</surname><given-names>K</given-names></name>
</person-group>             <year>in press</year>             <article-title>Correcting the bias of empirical frequency parameter estimators in codon models.</article-title>             <source>PLoS One</source>          </element-citation></ref>
<ref id="pcbi.1000885-KosakovskyPond6"><label>29</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Kosakovsky Pond</surname><given-names>SL</given-names></name>
<name name-style="western"><surname>Muse</surname><given-names>SV</given-names></name>
</person-group>             <year>2005</year>             <article-title>Site-to-site variation of synonymous substitution rates.</article-title>             <source>Mol Biol Evol</source>             <volume>22</volume>             <fpage>2375</fpage>             <lpage>2385</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-Stanfel1"><label>30</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Stanfel</surname><given-names>L</given-names></name>
</person-group>             <year>1996</year>             <article-title>A new approach to clustering the amino acids.</article-title>             <source>J Theor Biol</source>             <volume>183</volume>             <fpage>195</fpage>             <lpage>205</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-Hasegawa1"><label>31</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Hasegawa</surname><given-names>M</given-names></name>
<name name-style="western"><surname>Kishino</surname><given-names>H</given-names></name>
<name name-style="western"><surname>Yano</surname><given-names>T</given-names></name>
</person-group>             <year>1985</year>             <article-title>Dating of the human-ape splitting by a molecular clock of mitochondrial DNA.</article-title>             <source>Mol Biol Evol</source>             <volume>21</volume>             <fpage>160</fpage>             <lpage>174</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-KosakovskyPond7"><label>32</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Kosakovsky Pond</surname><given-names>SL</given-names></name>
<name name-style="western"><surname>Frost</surname><given-names>SDW</given-names></name>
<name name-style="western"><surname>Muse</surname><given-names>SV</given-names></name>
</person-group>             <year>2005</year>             <article-title>HyPhy: hypothesis testing using phylogenies.</article-title>             <source>Bioinformatics</source>             <volume>21</volume>             <fpage>676</fpage>             <lpage>9</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-Schwarz1"><label>33</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Schwarz</surname><given-names>G</given-names></name>
</person-group>             <year>1978</year>             <article-title>Estimating the dimension of a model.</article-title>             <source>Ann Stat</source>             <volume>6</volume>             <fpage>461</fpage>             <lpage>464</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-Atkinson1"><label>34</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Atkinson</surname><given-names>AC</given-names></name>
</person-group>             <year>1980</year>             <article-title>A note on the generalized information criterion for choice of a model.</article-title>             <source>Biometrika</source>             <volume>67</volume>             <fpage>413</fpage>             <lpage>418</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-Rand1"><label>35</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Rand</surname><given-names>WM</given-names></name>
</person-group>             <year>1971</year>             <article-title>Objective criteria for the evaluation of clustering methods.</article-title>             <source>J Amer Statist Assoc</source>             <volume>66</volume>             <fpage>846</fpage>             <lpage>850</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-KosakovskyPond8"><label>36</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Kosakovsky Pond</surname><given-names>SL</given-names></name>
<name name-style="western"><surname>Posada</surname><given-names>D</given-names></name>
<name name-style="western"><surname>Stawiski</surname><given-names>E</given-names></name>
<name name-style="western"><surname>Chappey</surname><given-names>C</given-names></name>
<name name-style="western"><surname>Poon</surname><given-names>AFY</given-names></name>
<etal/></person-group>             <year>2009</year>             <article-title>An evolutionary model-based algorithm for accurate phylogenetic breakpoint mapping and subtype prediction in HIV-1.</article-title>             <source>PLoS Comput Biol</source>             <volume>5</volume>             <fpage>e1000581</fpage>          </element-citation></ref>
<ref id="pcbi.1000885-Bao1"><label>37</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Bao</surname><given-names>Y</given-names></name>
<name name-style="western"><surname>Bolotov</surname><given-names>P</given-names></name>
<name name-style="western"><surname>Dernovoy</surname><given-names>D</given-names></name>
<name name-style="western"><surname>Kiryutin</surname><given-names>B</given-names></name>
<name name-style="western"><surname>Zaslavsky</surname><given-names>L</given-names></name>
<etal/></person-group>             <year>2007</year>             <article-title>The influenza virus resource at the national center for biotechnology information.</article-title>             <source>J Virol</source>             <volume>82</volume>             <fpage>596</fpage>             <lpage>601</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-Yokoyama1"><label>38</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Yokoyama</surname><given-names>S</given-names></name>
<name name-style="western"><surname>Tada</surname><given-names>T</given-names></name>
<name name-style="western"><surname>Zhang</surname><given-names>H</given-names></name>
<name name-style="western"><surname>Britt</surname><given-names>L</given-names></name>
</person-group>             <year>2008</year>             <article-title>Elucidation of phenotypic adaptations: Molecular analyses of dim-light vision proteins in vertebrates.</article-title>             <source>Proc Natl Acad Sci U S A</source>             <volume>105</volume>             <fpage>13480</fpage>             <lpage>13485</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-Brumme1"><label>39</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Brumme</surname><given-names>ZL</given-names></name>
<name name-style="western"><surname>Brumme</surname><given-names>CJ</given-names></name>
<name name-style="western"><surname>Heckerman</surname><given-names>D</given-names></name>
<name name-style="western"><surname>Korber</surname><given-names>BT</given-names></name>
<name name-style="western"><surname>Daniels</surname><given-names>M</given-names></name>
<etal/></person-group>             <year>2007</year>             <article-title>Evidence of differential HLA class I-mediated viral evolution in functional and accessory/regulatory genes of HIV-1.</article-title>             <source>PLoS Pathog</source>             <volume>3</volume>             <fpage>e94</fpage>          </element-citation></ref>
<ref id="pcbi.1000885-Rousseau1"><label>40</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Rousseau</surname><given-names>CM</given-names></name>
<name name-style="western"><surname>Daniels</surname><given-names>MG</given-names></name>
<name name-style="western"><surname>Carlson</surname><given-names>JM</given-names></name>
<name name-style="western"><surname>Kadie</surname><given-names>C</given-names></name>
<name name-style="western"><surname>Crawford</surname><given-names>H</given-names></name>
<etal/></person-group>             <year>2008</year>             <article-title>HLA class I-driven evolution of human immunodeficiency virus type 1 subtype C proteome: immune escape and viral load.</article-title>             <source>J Virol</source>             <volume>82</volume>             <fpage>6434</fpage>             <lpage>6446</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-Russell1"><label>41</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Russell</surname><given-names>CA</given-names></name>
<name name-style="western"><surname>Jones</surname><given-names>TC</given-names></name>
<name name-style="western"><surname>Barr</surname><given-names>IG</given-names></name>
<name name-style="western"><surname>Cox</surname><given-names>NJ</given-names></name>
<name name-style="western"><surname>Garten</surname><given-names>RJ</given-names></name>
<etal/></person-group>             <year>2008</year>             <article-title>The global circulation of seasonal influenza A (H3N2) viruses.</article-title>             <source>Science</source>             <volume>320</volume>             <fpage>340</fpage>             <lpage>346</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-Burnham1"><label>42</label><element-citation publication-type="other" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Burnham</surname><given-names>K</given-names></name>
<name name-style="western"><surname>Anderson</surname><given-names>D</given-names></name>
</person-group>             <year>2003</year>             <source>Model selection and multimodel inference</source>             <publisher-loc>New York</publisher-loc>             <publisher-name>Springer</publisher-name>             <comment>2nd ed. edition</comment>          </element-citation></ref>
<ref id="pcbi.1000885-Guindon1"><label>43</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Guindon</surname><given-names>S</given-names></name>
<name name-style="western"><surname>Gascuel</surname><given-names>O</given-names></name>
</person-group>             <year>2003</year>             <article-title>A simple, fast, and accurate algorithm to estimate large phylogenies by maximum likelihood.</article-title>             <source>Syst Biol</source>             <volume>52</volume>             <fpage>696</fpage>             <lpage>704</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-Tavar2"><label>44</label><element-citation publication-type="other" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Tavaré</surname><given-names>S</given-names></name>
</person-group>             <year>1986</year>             <article-title>Some probabilistic and statistical problems in the analysis of DNA sequences.</article-title>             <person-group person-group-type="editor">
<name name-style="western"><surname>Miura</surname><given-names>RM</given-names></name>
</person-group>             <source>Lectures on Mathematics in the Life Sciences</source>             <publisher-loc>Providence, R.I.</publisher-loc>             <publisher-name>Amer. Math. Soc</publisher-name>             <fpage>57</fpage>             <lpage>86</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-Yang1"><label>45</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Yang</surname><given-names>Z</given-names></name>
</person-group>             <year>1993</year>             <article-title>Maximum-likelihood estimation of phylogeny from DNA sequences when substitution rates differ over sites.</article-title>             <source>Mol Biol Evol</source>             <volume>10</volume>             <fpage>1396</fpage>             <lpage>1401</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-KosakovskyPond9"><label>46</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Kosakovsky Pond</surname><given-names>SL</given-names></name>
<name name-style="western"><surname>Frost</surname><given-names>SDW</given-names></name>
</person-group>             <year>2005</year>             <article-title>Datamonkey: rapid detection of selective pressure on individual sites of codon alignments.</article-title>             <source>Bioinformatics</source>             <volume>21</volume>             <fpage>2531</fpage>             <lpage>2533</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-Wong1"><label>47</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Wong</surname><given-names>W</given-names></name>
<name name-style="western"><surname>Sainudiin</surname><given-names>R</given-names></name>
<name name-style="western"><surname>Nielsen</surname><given-names>R</given-names></name>
</person-group>             <year>2006</year>             <article-title>Identification of physicochemical selective pressure on protein encoding nucleotide sequences.</article-title>             <source>BMC Bioinformatics</source>             <volume>7</volume>             <fpage>148</fpage>             <lpage>158</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-Whelan3"><label>48</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Whelan</surname><given-names>S</given-names></name>
<name name-style="western"><surname>Goldman</surname><given-names>N</given-names></name>
</person-group>             <year>2004</year>             <article-title>Estimating the frequency of events that cause multiple-nucleotide changes.</article-title>             <source>Genetics</source>             <volume>167</volume>             <fpage>2027</fpage>             <lpage>2043</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-Pupko1"><label>49</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Pupko</surname><given-names>T</given-names></name>
<name name-style="western"><surname>Pe'er</surname><given-names>I</given-names></name>
<name name-style="western"><surname>Shamir</surname><given-names>R</given-names></name>
<name name-style="western"><surname>Graur</surname><given-names>D</given-names></name>
</person-group>             <year>2000</year>             <article-title>A fast algorithm for joint reconstruction of ancestral amino acid sequences.</article-title>             <source>Mol Biol Evol</source>             <volume>17</volume>             <fpage>890</fpage>             <lpage>896</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-KosakovskyPond10"><label>50</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Kosakovsky Pond</surname><given-names>SL</given-names></name>
<name name-style="western"><surname>Frost</surname><given-names>SDW</given-names></name>
</person-group>             <year>2005</year>             <article-title>Not so different after all: a comparison of methods for detecting amino acid sites under selection.</article-title>             <source>Mol Biol Evol</source>             <volume>22</volume>             <fpage>1208</fpage>             <lpage>1222</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-Le1"><label>51</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Le</surname><given-names>SQ</given-names></name>
<name name-style="western"><surname>Gascuel</surname><given-names>O</given-names></name>
</person-group>             <year>2008</year>             <article-title>An improved general amino acid replacement matrix.</article-title>             <source>Mol Biol Evol</source>             <volume>25</volume>             <fpage>1307</fpage>             <lpage>20</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-Poon1"><label>52</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Poon</surname><given-names>AFY</given-names></name>
<name name-style="western"><surname>Lewis</surname><given-names>FI</given-names></name>
<name name-style="western"><surname>Pond</surname><given-names>SLK</given-names></name>
<name name-style="western"><surname>Frost</surname><given-names>SDW</given-names></name>
</person-group>             <year>2007</year>             <article-title>An evolutionary-network model reveals stratified interactions in the V3 loop of the HIV-1 envelope.</article-title>             <source>PLoS Comput Biol</source>             <volume>3</volume>             <fpage>e231</fpage>          </element-citation></ref>
<ref id="pcbi.1000885-Rodrigue1"><label>53</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Rodrigue</surname><given-names>N</given-names></name>
<name name-style="western"><surname>Kleinman</surname><given-names>CL</given-names></name>
<name name-style="western"><surname>Philippe</surname><given-names>H</given-names></name>
<name name-style="western"><surname>Lartillot</surname><given-names>N</given-names></name>
</person-group>             <year>2009</year>             <article-title>Computational methods for evaluating phylogenetic models of coding sequence evolution with dependence between codons.</article-title>             <source>Mol Biol Evol</source>             <volume>26</volume>             <fpage>1663</fpage>             <lpage>76</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-Yang2"><label>54</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Yang</surname><given-names>Z</given-names></name>
<name name-style="western"><surname>Nielsen</surname><given-names>R</given-names></name>
<name name-style="western"><surname>Goldman</surname><given-names>N</given-names></name>
<name name-style="western"><surname>Pedersen</surname><given-names>AM</given-names></name>
</person-group>             <year>2000</year>             <article-title>Codon-substitution models for heterogeneous selection pressure at amino acid sites.</article-title>             <source>Genetics</source>             <volume>155</volume>             <fpage>431</fpage>             <lpage>449</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-Sonnhammer1"><label>55</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Sonnhammer</surname><given-names>EL</given-names></name>
<name name-style="western"><surname>Eddy</surname><given-names>SR</given-names></name>
<name name-style="western"><surname>Durbin</surname><given-names>R</given-names></name>
</person-group>             <year>1997</year>             <article-title>Pfam: a comprehensive database of protein domain families based on seed alignments.</article-title>             <source>Proteins</source>             <volume>28</volume>             <fpage>405</fpage>             <lpage>20</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-Leslie1"><label>56</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Leslie</surname><given-names>A</given-names></name>
<name name-style="western"><surname>Pfafferott</surname><given-names>K</given-names></name>
<name name-style="western"><surname>Chetty</surname><given-names>P</given-names></name>
<name name-style="western"><surname>Draenert</surname><given-names>R</given-names></name>
<name name-style="western"><surname>Addo</surname><given-names>M</given-names></name>
<etal/></person-group>             <year>2004</year>             <article-title>HIV evolution: CTL escape mutation and reversion after transmission.</article-title>             <source>Nat Med</source>             <volume>10</volume>             <fpage>282</fpage>             <lpage>9</lpage>          </element-citation></ref>
<ref id="pcbi.1000885-Saitou1"><label>57</label><element-citation publication-type="journal" xlink:type="simple">             <person-group person-group-type="author">
<name name-style="western"><surname>Saitou</surname><given-names>N</given-names></name>
<name name-style="western"><surname>Nei</surname><given-names>M</given-names></name>
</person-group>             <year>1987</year>             <article-title>The neighbor-joining method: a new method for reconstructing phylogenetic trees.</article-title>             <source>Mol Biol Evol</source>             <volume>4</volume>             <fpage>406</fpage>             <lpage>25</lpage>          </element-citation></ref>
</ref-list>

</back>
</article>