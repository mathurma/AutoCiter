<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article
  PUBLIC "-//NLM//DTD Journal Publishing DTD v3.0 20080202//EN" "http://dtd.nlm.nih.gov/publishing/3.0/journalpublishing3.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="3.0" xml:lang="en">
<front>
<journal-meta>
<journal-id journal-id-type="publisher-id">plos</journal-id>
<journal-id journal-id-type="nlm-ta">PLoS Comput Biol</journal-id>
<journal-id journal-id-type="pmc">ploscomp</journal-id><journal-title-group>
<journal-title>PLoS Computational Biology</journal-title></journal-title-group>
<issn pub-type="ppub">1553-734X</issn>
<issn pub-type="epub">1553-7358</issn>
<publisher>
<publisher-name>Public Library of Science</publisher-name>
<publisher-loc>San Francisco, USA</publisher-loc></publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="publisher-id">PCOMPBIOL-D-14-00883</article-id>
<article-id pub-id-type="doi">10.1371/journal.pcbi.1003942</article-id>
<article-categories><subj-group subj-group-type="heading"><subject>Research Article</subject></subj-group><subj-group subj-group-type="Discipline-v2"><subject>Biology and life sciences</subject><subj-group><subject>Biochemistry</subject><subj-group><subject>Biochemical simulations</subject></subj-group></subj-group><subj-group><subject>Computational biology</subject><subj-group><subject>Genome analysis</subject><subj-group><subject>Genetic networks</subject></subj-group></subj-group><subj-group><subject>Gene regulatory networks</subject></subj-group></subj-group></subj-group><subj-group subj-group-type="Discipline-v2"><subject>Computer and information sciences</subject><subj-group><subject>Network analysis</subject></subj-group></subj-group><subj-group subj-group-type="Discipline-v2"><subject>Physical sciences</subject><subj-group><subject>Mathematics</subject><subj-group><subject>Probability theory</subject><subj-group><subject>Markov models</subject><subject>Stochastic processes</subject></subj-group></subj-group></subj-group></subj-group></article-categories>
<title-group>
<article-title>Uncoupled Analysis of Stochastic Reaction Networks in Fluctuating Environments</article-title>
<alt-title alt-title-type="running-head">Uncoupled Analysis of Stochastic Reaction Networks</alt-title>
</title-group>
<contrib-group>
<contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Zechner</surname><given-names>Christoph</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref><xref ref-type="fn" rid="fn1"><sup>¤</sup></xref></contrib>
<contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Koeppl</surname><given-names>Heinz</given-names></name><xref ref-type="aff" rid="aff2"><sup>2</sup></xref><xref ref-type="corresp" rid="cor1"><sup>*</sup></xref></contrib>
</contrib-group>
<aff id="aff1"><label>1</label><addr-line>Department of Information Technology and Electrical Engineering, ETH Zurich, Zurich, Switzerland</addr-line></aff>
<aff id="aff2"><label>2</label><addr-line>Department of Electrical Engineering and Information Technology, Technische Universität Darmstadt, Darmstadt, Germany</addr-line></aff>
<contrib-group>
<contrib contrib-type="editor" xlink:type="simple"><name name-style="western"><surname>Ermentrout</surname><given-names>Bard</given-names></name>
<role>Editor</role>
<xref ref-type="aff" rid="edit1"/></contrib>
</contrib-group>
<aff id="edit1"><addr-line>University of Pittsburgh, United States of America</addr-line></aff>
<author-notes>
<corresp id="cor1">* E-mail: <email xlink:type="simple">heinz.koeppl@bcs.tu-darmstadt.de</email></corresp>
<fn fn-type="conflict"><p>The authors have declared that no competing interests exist.</p></fn>
<fn fn-type="con"><p>Conceived and designed the experiments: CZ HK. Performed the experiments: CZ. Analyzed the data: CZ. Contributed reagents/materials/analysis tools: CZ HK. Wrote the paper: CZ HK.</p></fn>
<fn id="fn1" fn-type="current-aff"><label>¤</label><p>Current address: Department of Biosystems Science and Engineering, ETH Zurich, Zurich, Switzerland</p></fn>
</author-notes>
<pub-date pub-type="collection"><month>12</month><year>2014</year></pub-date>
<pub-date pub-type="epub"><day>4</day><month>12</month><year>2014</year></pub-date>
<volume>10</volume>
<issue>12</issue>
<elocation-id>e1003942</elocation-id>
<history>
<date date-type="received"><day>20</day><month>5</month><year>2014</year></date>
<date date-type="accepted"><day>28</day><month>9</month><year>2014</year></date>
</history>
<permissions>
<copyright-year>2014</copyright-year>
<copyright-holder>Zechner, Koeppl</copyright-holder><license xlink:type="simple"><license-p>This is an open-access article distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/" xlink:type="simple">Creative Commons Attribution License</ext-link>, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p></license></permissions>
<abstract>
<p>The dynamics of stochastic reaction networks within cells are inevitably modulated by factors considered extrinsic to the network such as, for instance, the fluctuations in ribosome copy numbers for a gene regulatory network. While several recent studies demonstrate the importance of accounting for such extrinsic components, the resulting models are typically hard to analyze. In this work we develop a general mathematical framework that allows to uncouple the network from its dynamic environment by incorporating only the environment's effect onto the network into a new model. More technically, we show how such fluctuating extrinsic components (e.g., chemical species) can be marginalized in order to obtain this decoupled model. We derive its corresponding process- and master equations and show how stochastic simulations can be performed. Using several case studies, we demonstrate the significance of the approach.</p>
</abstract>
<abstract abstract-type="summary"><title>Author Summary</title>
<p>Cellular reaction networks show a substantial degree of complexity, and many of the regulatory mechanisms are yet to be discovered. Therefore, building detailed mathematical models of complete networks is not only unrewarding but most often impossible. Instead, focus is put on small subnetworks such as the transcriptional circuitry associated with a few genes. Practically, those subnetworks are still embedded in the cellular environment and are consequently modulated by it. The mathematical framework that we present in this work allows to build models of such subnetworks only, while still incorporating the impact of the environment. Such models are instrumental not only for advancing our biological understanding through them, but also for the reliable forward engineering of new subnetworks in synthetic biology.</p>
</abstract>
<funding-group><funding-statement>CZ and HK acknowledge the support from the Swiss National Science Foundation (<ext-link ext-link-type="uri" xlink:href="http://www.snf.ch" xlink:type="simple">www.snf.ch</ext-link>), grant no. PP00P2 128503. The funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.</funding-statement></funding-group><counts><page-count count="9"/></counts><custom-meta-group><custom-meta id="data-availability" xlink:type="simple"><meta-name>Data Availability</meta-name><meta-value>The authors confirm that all data underlying the findings are fully available without restriction. All relevant data are within the paper and its Supporting Information files.</meta-value></custom-meta></custom-meta-group></article-meta>
</front>
<body><sec id="s1">
<title>Introduction</title>
<p>Biochemical systems involving low-copy molecules demand for mathematical models that account for the intrinsic stochasticity <xref ref-type="bibr" rid="pcbi.1003942-McAdams1">[1]</xref>. In recent years, however, realization has grown that intrinsic noise alone cannot account for the observed substantial phenotypic variability among isogenic cells. That is, fluctuations in the intracellular environment, commonly termed extrinsic noise, represent an additional source of variability <xref ref-type="bibr" rid="pcbi.1003942-Elowitz1">[2]</xref>, <xref ref-type="bibr" rid="pcbi.1003942-ColmanLerner1">[3]</xref>, <xref ref-type="bibr" rid="pcbi.1003942-Raser1">[4]</xref>.</p>
<p>Several recent studies focus on separating intrinsic and extrinsic fluctuations through dual-reporter measurements <xref ref-type="bibr" rid="pcbi.1003942-Hilfinger1">[5]</xref>, <xref ref-type="bibr" rid="pcbi.1003942-Swain1">[6]</xref>. Other approaches model extrinsic noise through certain parameters (i.e., the translation rate) of a kinetic model which is calibrated subsequently using flow-cytometry <xref ref-type="bibr" rid="pcbi.1003942-Ruess1">[7]</xref>, <xref ref-type="bibr" rid="pcbi.1003942-Zechner1">[8]</xref> or time-lapse microscopy data <xref ref-type="bibr" rid="pcbi.1003942-Zechner2">[9]</xref>, <xref ref-type="bibr" rid="pcbi.1003942-Finkenstdt1">[10]</xref>. All of those approaches have in common that they consider the biochemical process under study – i.e., the expression of a gene – as a small subpart that is embedded into a larger dynamical system. Accordingly, they rely on augmenting the original kinetic model by certain environmental components which are assumed to be fixed but random <xref ref-type="bibr" rid="pcbi.1003942-Hasenauer1">[11]</xref>, <xref ref-type="bibr" rid="pcbi.1003942-Finkenstdt1">[10]</xref>, <xref ref-type="bibr" rid="pcbi.1003942-Zechner1">[8]</xref>, <xref ref-type="bibr" rid="pcbi.1003942-Zechner2">[9]</xref> or fluctuating over time <xref ref-type="bibr" rid="pcbi.1003942-Hilfinger1">[5]</xref>, <xref ref-type="bibr" rid="pcbi.1003942-Shahrezaei1">[12]</xref>, <xref ref-type="bibr" rid="pcbi.1003942-Newby1">[13]</xref>. In fact, such models agree very well with the variability that is observed experimentally, but on their downside, suffer from the increased dimensionality - somehow defeating the original purpose of tractable dedicated models.</p>
<p>A natural question arising in that context is whether we can find a proper dynamical description of just the system of interest as if it was still embedded into its stochastically modulating environment. In other words, we aim to find a “self-contained” stochastic model that summarizes all system behaviors attainable under all possible realizations of the extrinsic fluctuations. Such models could then be used to perform an uncoupled analysis of a reaction network subject to extrinsic noise. The mathematical correct answer that we provide in this work is the marginalization of the system dynamics with respect to those extrinsic fluctuations. Interestingly it turns out that the resulting model exploits its own stochasticity to emulate the effect of extrinsic noise, leading to a self-exciting process. A simple instance of such self-excitation is the Polya urn scheme: at each draw from the Polya urn with balls of two colors the drawn ball and a fixed number of new balls of the same color as the draw are placed in the urn. This scheme is known to be equivalent to Bernoulli trials marginalized over random (and here correspondingly extrinsic) success rates <xref ref-type="bibr" rid="pcbi.1003942-Johnson1">[14]</xref>. Intuitively, due to its self-excitation, the number of draws of the same color for a Polya urn over repeated draws displays a much richer and dispersed dynamics than the number of successful draws in a Bernoulli trial with fixed success rate.</p>
<p>For the purpose of inference we recently proposed a first attempt of such marginalization for the special case of fixed but random environmental conditions <xref ref-type="bibr" rid="pcbi.1003942-Zechner2">[9]</xref>. In this work we develop a general mathematical framework from which the uncoupled dynamics can be constructed in a principled manner, regardless whether the environment is constant or dynamically changing.</p>
</sec><sec id="s2">
<title>Results</title>
<sec id="s2a">
<title>Mathematical framework</title>
<p>We describe the time-evolution of a stochastic reaction network by a continous-time Markov chain (CTMC) <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e001" xlink:type="simple"/></inline-formula> with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e002" xlink:type="simple"/></inline-formula> chemical species and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e003" xlink:type="simple"/></inline-formula> reaction channels. The system state at time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e004" xlink:type="simple"/></inline-formula> is denoted <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e005" xlink:type="simple"/></inline-formula> and we write its random path on time intervals <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e006" xlink:type="simple"/></inline-formula> as <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e007" xlink:type="simple"/></inline-formula>. Throughout we will follow the usual convention to refer to upper-case and lower-case versions of a symbol as a random variable and its realization, respectively. Furthermore, we assume that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e008" xlink:type="simple"/></inline-formula> depends on another multivariate Markov process <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e009" xlink:type="simple"/></inline-formula> through its hazard functions in the form <disp-formula id="pcbi.1003942.e010"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003942.e010" xlink:type="simple"/><label>(1)</label></disp-formula>with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e011" xlink:type="simple"/></inline-formula> some positive function and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e012" xlink:type="simple"/></inline-formula> a polynomial determined by the law of mass-action, for instance. For reactions independent of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e013" xlink:type="simple"/></inline-formula>, we thus have <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e014" xlink:type="simple"/></inline-formula>. Typically, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e015" xlink:type="simple"/></inline-formula> is another jump or diffusion process corresponding to a set of modulating <italic>environmental</italic> species or conditions that are considered extrinsic to the system of interest, whereas the species in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e016" xlink:type="simple"/></inline-formula> represent the actual system of interest. For example, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e017" xlink:type="simple"/></inline-formula> could be the fluctuating ribosome copy numbers affecting the kinetics of a gene regulatory network represented by <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e018" xlink:type="simple"/></inline-formula>. Although a more general treatment is possible, we assume a feed-forward structure between <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e019" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e020" xlink:type="simple"/></inline-formula>, which means that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e021" xlink:type="simple"/></inline-formula> modulates <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e022" xlink:type="simple"/></inline-formula> but not vice-versa. Consequently, the dynamics of the joint system <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e023" xlink:type="simple"/></inline-formula> can be described by a Markov process <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e024" xlink:type="simple"/></inline-formula> together with a conditional Markov chain <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e025" xlink:type="simple"/></inline-formula>.</p>
<sec id="s2a1">
<title>Uncoupled dynamics</title>
<p>Mathematical descriptions of the joint system <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e026" xlink:type="simple"/></inline-formula> are readily obtained using available techniques for modeling Markovian dynamics <xref ref-type="bibr" rid="pcbi.1003942-Hilfinger1">[5]</xref>, <xref ref-type="bibr" rid="pcbi.1003942-Koeppl1">[15]</xref>, <xref ref-type="bibr" rid="pcbi.1003942-Shahrezaei1">[12]</xref>. For complexity reasons, however, we aim for models that can properly describe <italic>only</italic> the interesting components <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e027" xlink:type="simple"/></inline-formula>. In order to see that marginalization over <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e028" xlink:type="simple"/></inline-formula> yields the desired model, let us first consider two dependent random variables <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e029" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e030" xlink:type="simple"/></inline-formula> described by a joint probability distribution <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e031" xlink:type="simple"/></inline-formula>. If we are interested in analyzing <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e032" xlink:type="simple"/></inline-formula> under all possible values of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e033" xlink:type="simple"/></inline-formula>, we need to average the probability at <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e034" xlink:type="simple"/></inline-formula> over all possible values of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e035" xlink:type="simple"/></inline-formula>, i.e., <disp-formula id="pcbi.1003942.e036"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003942.e036" xlink:type="simple"/></disp-formula></p>
<p>Note that as a consequence of averaging probabilities, any value of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e037" xlink:type="simple"/></inline-formula> possible under the joint distribution <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e038" xlink:type="simple"/></inline-formula> is possible under the marginal <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e039" xlink:type="simple"/></inline-formula>, while this does not necessarily apply to <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e040" xlink:type="simple"/></inline-formula> for any choice of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e041" xlink:type="simple"/></inline-formula>. The resulting <italic>marginal</italic> distribution <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e042" xlink:type="simple"/></inline-formula> is an exact mathematical description of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e043" xlink:type="simple"/></inline-formula> only, or in other words, it allows to analyze <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e044" xlink:type="simple"/></inline-formula> uncoupled from <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e045" xlink:type="simple"/></inline-formula>.</p>
<p>In case of the coupled processes <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e046" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e047" xlink:type="simple"/></inline-formula>, we analogously <italic>marginalize</italic> the joint Markov chain <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e048" xlink:type="simple"/></inline-formula> with respect to the environmental process <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e049" xlink:type="simple"/></inline-formula>. While such a marginalization involves several difficulties, the idea remains the same: we try to construct an uncoupled process <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e050" xlink:type="simple"/></inline-formula> which directly admits the marginal path distribution <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e051" xlink:type="simple"/></inline-formula>. As a result, we obtain a jump process, which - in contrast to the conditional process <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e052" xlink:type="simple"/></inline-formula> - no longer depends on the environment <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e053" xlink:type="simple"/></inline-formula>. We remark that a straightforward marginalization of the joint master equation of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e054" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e055" xlink:type="simple"/></inline-formula> generally leads to intractable propensities <xref ref-type="bibr" rid="pcbi.1003942-Rao1">[16]</xref>, <xref ref-type="bibr" rid="pcbi.1003942-Hilfinger1">[5]</xref>. Based on the innovation theorem <xref ref-type="bibr" rid="pcbi.1003942-Aalen1">[17]</xref> we demonstrate in section S.1 in <xref ref-type="supplementary-material" rid="pcbi.1003942.s001">S1 Text</xref> that the hazard functions of the uncoupled process (later referred to as the <italic>marginal</italic> hazard functions) can be generally written as <disp-formula id="pcbi.1003942.e056"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003942.e056" xlink:type="simple"/><label>(2)</label></disp-formula>where the expectation is taken with respect to the conditional distribution <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e057" xlink:type="simple"/></inline-formula>. The latter describes the conditional probability of the environmental process <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e058" xlink:type="simple"/></inline-formula> given the entire history (or filtration) of process <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e059" xlink:type="simple"/></inline-formula> until time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e060" xlink:type="simple"/></inline-formula>. Using the expected value of that distribution, the feed-forward influence of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e061" xlink:type="simple"/></inline-formula> on the hazard functions of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e062" xlink:type="simple"/></inline-formula> can be replaced by a deterministic function of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e063" xlink:type="simple"/></inline-formula>, which no longer depends on the actual state of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e064" xlink:type="simple"/></inline-formula>. Instead, the uncoupled process <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e065" xlink:type="simple"/></inline-formula> becomes <italic>self-exciting</italic>, meaning that it exerts a feedback on itself. Hence, given that we can evaluate Eq.2, we have a means to simulate <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e066" xlink:type="simple"/></inline-formula> while bypassing the need to draw realizations of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e067" xlink:type="simple"/></inline-formula>. This has for instance been exploited for the exact simulation of diffusion-driven Poisson processes <xref ref-type="bibr" rid="pcbi.1003942-Giesecke1">[18]</xref>. Note that the uncoupled process <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e068" xlink:type="simple"/></inline-formula> is no longer Markovian, since the conditional expectation - and hence the hazard function - possibly depends on the full process history <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e069" xlink:type="simple"/></inline-formula>. A schematic illustration of that uncoupling is given in <xref ref-type="fig" rid="pcbi-1003942-g001">Fig. 1</xref>.</p>
<fig id="pcbi-1003942-g001" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003942.g001</object-id><label>Figure 1</label><caption>
<title>Uncoupled stochastic dynamics.</title>
<p>The environmental process <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e070" xlink:type="simple"/></inline-formula> modulates the dynamics of the process under study <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e071" xlink:type="simple"/></inline-formula>, e.g., through one of its hazard functions. Marginalization with respect to <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e072" xlink:type="simple"/></inline-formula> yields the uncoupled dynamics of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e073" xlink:type="simple"/></inline-formula>, whereas the original dependency on the environment <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e074" xlink:type="simple"/></inline-formula> is replaced by its optimal estimator given the history of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e075" xlink:type="simple"/></inline-formula>. Consequently, the marginal process <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e076" xlink:type="simple"/></inline-formula> is self-exciting, i.e., it exerts a feedback on itself.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003942.g001" position="float" xlink:type="simple"/></fig></sec><sec id="s2a2">
<title>Associated filtering problem</title>
<p>Although the construction of the uncoupled dynamics is general, any practical implementation thereof will depend on an explicit computation of the conditional expectation in Eq. 2. This expectation estimates the environmental state <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e077" xlink:type="simple"/></inline-formula> given the full history of the uncoupled process <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e078" xlink:type="simple"/></inline-formula> and therefore, can be understood as the solution to a <italic>stochastic filtering</italic> problem <xref ref-type="bibr" rid="pcbi.1003942-Bain1">[19]</xref>. Filtering techniques deal with the problem of optimally reconstructing a hidden stochastic process at time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e079" xlink:type="simple"/></inline-formula> from noisy observations of that process up to time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e080" xlink:type="simple"/></inline-formula>. In the situation considered here, the hidden process corresponds to the environment <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e081" xlink:type="simple"/></inline-formula>, which gets reconstructed from the “observed” history <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e082" xlink:type="simple"/></inline-formula> through the conditional mean in Eq. 2.</p>
<p>We assume that the environment <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e083" xlink:type="simple"/></inline-formula> admits a probability distribution <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e084" xlink:type="simple"/></inline-formula> described by a Kolmogorov-forward equation of the form <disp-formula id="pcbi.1003942.e085"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003942.e085" xlink:type="simple"/><label>(3)</label></disp-formula>where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e086" xlink:type="simple"/></inline-formula> represents the temporal change of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e087" xlink:type="simple"/></inline-formula>, i.e., is the infinitesimal generator of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e088" xlink:type="simple"/></inline-formula>. For instance, if <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e089" xlink:type="simple"/></inline-formula> is a diffusion process, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e090" xlink:type="simple"/></inline-formula> corresponds to the Fokker-Planck operator, while in case of a CTMC, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e091" xlink:type="simple"/></inline-formula> is given by the difference operator of the chemical master equation (CME). In terms of filtering, Eq. 3 corresponds to the process model of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e092" xlink:type="simple"/></inline-formula>. Furthermore, we know that at a given time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e093" xlink:type="simple"/></inline-formula>, the solution of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e094" xlink:type="simple"/></inline-formula> can be written as a sum of independent but time-transformed Poisson processes <xref ref-type="bibr" rid="pcbi.1003942-Anderson1">[20]</xref>, each of them corresponding to a particular reaction channel. Consequently, the observation model is given by a set of Poisson counting observations with the hazard functions given in Eq.1. This is closely related to Markov-modulated Poisson processes <xref ref-type="bibr" rid="pcbi.1003942-Snyder1">[21]</xref> and their corresponding optimal filtering <xref ref-type="bibr" rid="pcbi.1003942-Elliott1">[22]</xref>.</p>
<p>While a more general treatment is provided in <xref ref-type="supplementary-material" rid="pcbi.1003942.s001">S1 Text</xref>, we assume in the following that a one-dimensional process <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e095" xlink:type="simple"/></inline-formula> is modulating <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e096" xlink:type="simple"/></inline-formula> through its <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e097" xlink:type="simple"/></inline-formula>-th reaction of order zero. We further restrict ourselves to the case where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e098" xlink:type="simple"/></inline-formula> is a linear function of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e099" xlink:type="simple"/></inline-formula>, i.e., <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e100" xlink:type="simple"/></inline-formula>. Under those assumptions, it can be shown that the conditional process <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e101" xlink:type="simple"/></inline-formula> follows a filtering distribution <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e102" xlink:type="simple"/></inline-formula> with <disp-formula id="pcbi.1003942.e103"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003942.e103" xlink:type="simple"/><label>(4)</label></disp-formula>with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e104" xlink:type="simple"/></inline-formula> as the number of reactions of type <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e105" xlink:type="simple"/></inline-formula> up to time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e106" xlink:type="simple"/></inline-formula> in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e107" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e108" xlink:type="simple"/></inline-formula> (for a derivation see S.2 in <xref ref-type="supplementary-material" rid="pcbi.1003942.s001">S1 Text</xref>). Since Eq. 4 shows an implicit dependency on its own mean, it is complicated to handle numerically. A simpler equation can be obtained for an unnormalized variant <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e109" xlink:type="simple"/></inline-formula> of the filtering distribution <xref ref-type="bibr" rid="pcbi.1003942-Eden1">[23]</xref>, i.e.,<disp-formula id="pcbi.1003942.e110"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003942.e110" xlink:type="simple"/><label>(5)</label></disp-formula>with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e111" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e112" xlink:type="simple"/></inline-formula> a time-dependent normalizing factor independent of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e113" xlink:type="simple"/></inline-formula>. Thus, Eq.5 describes a scaled version of the normalized filtering distribution from Eq.4. However, once <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e114" xlink:type="simple"/></inline-formula> has been numerically solved for, it can be easily rescaled such that it integrates (or sums up) to one for all <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e115" xlink:type="simple"/></inline-formula>.</p>
<p>Note that Eq. 5 is a stochastic partial differential equation (SPDE) in case <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e116" xlink:type="simple"/></inline-formula> describes a diffusion process or a stochastic difference-differential equation (SDDE) if <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e117" xlink:type="simple"/></inline-formula> is a CTMC. In the latter case, the solution of Eq.5 can be compactly written as <disp-formula id="pcbi.1003942.e118"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003942.e118" xlink:type="simple"/><label>(6)</label></disp-formula>with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e119" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e120" xlink:type="simple"/></inline-formula> the number of reachable states of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e121" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e122" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e123" xlink:type="simple"/></inline-formula> the initial distribution over <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e124" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e125" xlink:type="simple"/></inline-formula> the generator matrix of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e126" xlink:type="simple"/></inline-formula>. Note that we define <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e127" xlink:type="simple"/></inline-formula> to be a left stochastic matrix, i.e., its rows sum up to zero.</p>
</sec><sec id="s2a3">
<title>Conditional moment dynamics</title>
<p>In order to evaluate Eq. 2, we only require the mean (i.e., the first moment) of the filtering distribution, i.e., <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e128" xlink:type="simple"/></inline-formula>. In general, however, the mean also depends on the second-order moment, which in turn depends on the third-order moment and so forth. Generally, the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e129" xlink:type="simple"/></inline-formula>-th order non-central moment is found by multiplying both sides of Eq.4 with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e130" xlink:type="simple"/></inline-formula> and summing (or integrating) over all <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e131" xlink:type="simple"/></inline-formula>, i.e., <disp-formula id="pcbi.1003942.e132"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003942.e132" xlink:type="simple"/><label>(7)</label></disp-formula>such that the filtering moment dynamics up to order <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e133" xlink:type="simple"/></inline-formula> can be generally written as<disp-formula id="pcbi.1003942.e134"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003942.e134" xlink:type="simple"/><label>(8)</label></disp-formula>with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e135" xlink:type="simple"/></inline-formula> as the unconditional moment dynamics. The computation of moments in case of multivariate environments is performed analogously. Although Eq.8 is generally infinite-dimensional, there are several relevant scenarios, for which the moment dynamics are <italic>closed</italic>, i.e., only depend on higher-order moments up to a certain order. This is for instance the case, if <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e136" xlink:type="simple"/></inline-formula> is a Cox-Ingersoll-Ross (CIR) process <xref ref-type="bibr" rid="pcbi.1003942-Leijdekker1">[24]</xref> or any finite state Markov chain. On the other hand, if the moment dynamics are infinite-dimensional, suitable assumptions on the filtering distribution <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e137" xlink:type="simple"/></inline-formula> can be imposed to yield a closed moment-dynamics (see <xref ref-type="bibr" rid="pcbi.1003942-Hespanha1">[25]</xref> and S.3 in <xref ref-type="supplementary-material" rid="pcbi.1003942.s001">S1 Text</xref>). An important closure is found by analyzing Eq. 6: especially for large <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e138" xlink:type="simple"/></inline-formula> we have that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e139" xlink:type="simple"/></inline-formula> and furthermore,<disp-formula id="pcbi.1003942.e140"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003942.e140" xlink:type="simple"/><label>(9)</label></disp-formula>suggesting that Eq. 6 can be well approximated by a Gamma-distribution. We note that the Gamma-distribution is fully characterized by two parameters – or equivalently – its first two moments <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e141" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e142" xlink:type="simple"/></inline-formula>. As a consequence, we may express the third order moment as a function of the first two moments, i.e., <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e143" xlink:type="simple"/></inline-formula>, such that the second conditional moment closes as</p>
<p><disp-formula id="pcbi.1003942.e144"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003942.e144" xlink:type="simple"/></disp-formula></p>
<p>Further discussion on moment-closure is provided in section S.3 in <xref ref-type="supplementary-material" rid="pcbi.1003942.s001">S1 Text</xref>. In the following, we demonstrate the uncoupled dynamics using several numerical and analytical case studies.</p>
</sec></sec><sec id="s2b">
<title>Uncoupled dynamics for network simulation</title>
<sec id="s2b1">
<title>The marginal simulation algorithm (MSA)</title>
<p>Although the uncoupled dynamics of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e145" xlink:type="simple"/></inline-formula> are non-Markovian, the Markov property can be enforced by virtually extending the state space by the first moment of Eq. 8, summarizing the history of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e146" xlink:type="simple"/></inline-formula>. As a result, one can simulate sample paths of the uncoupled process using standard methods that can account for the explicit time-dependency of the hazard functions <xref ref-type="bibr" rid="pcbi.1003942-Anderson2">[26]</xref>. In general, such algorithms rely on the generation of random waiting times for each of the reaction channels. All reactions that are independent of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e147" xlink:type="simple"/></inline-formula> will retain their exponentially distributed waiting times. In contrast, the time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e148" xlink:type="simple"/></inline-formula> that passes until a reaction of type <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e149" xlink:type="simple"/></inline-formula> happens is distributed according to <disp-formula id="pcbi.1003942.e150"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003942.e150" xlink:type="simple"/><label>(10)</label></disp-formula></p>
<p>We note that as long as no reaction of type <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e151" xlink:type="simple"/></inline-formula> happens, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e152" xlink:type="simple"/></inline-formula> is zero and hence, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e153" xlink:type="simple"/></inline-formula> is found by solving a set ordinary differential equations (ODEs). Since that solution is not generally known in closed form, we cannot directly sample from Eq. 10. However, several efficient solutions to that problem have been developed in the context of inhomogeneous Poisson processes, e.g., such as the method of <italic>thinning</italic> <xref ref-type="bibr" rid="pcbi.1003942-Lewis1">[27]</xref>. Once a reaction has fired, the filtering moments need to be updated by the terms multiplying the firing process <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e154" xlink:type="simple"/></inline-formula> in Eq. 8 (i.e., they exhibit a discontinuity). The following lines describe a possible implementation of the MSA.</p>
<p><bold>Algorithm 1</bold> (Marginal simulation algorithm) <italic>The algorithm simulates the uncoupled dynamics of a reaction network with </italic><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e155" xlink:type="simple"/></inline-formula><italic> reactions associated with stoichiometric change vectors </italic><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e156" xlink:type="simple"/></inline-formula><italic>. The </italic><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e157" xlink:type="simple"/></inline-formula><italic>-th reaction is assumed to be driven by the environmental network </italic><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e158" xlink:type="simple"/></inline-formula><italic>. The algorithm requires a real-valued constant </italic><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e159" xlink:type="simple"/></inline-formula><italic> to be given as an input.</italic></p>
<p><italic>1 Initialize variables</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e160" xlink:type="simple"/></inline-formula> <italic>and</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e161" xlink:type="simple"/></inline-formula>.</p>
<p><italic>2 </italic><bold><italic>while</italic></bold> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e162" xlink:type="simple"/></inline-formula> <bold><italic>do</italic></bold></p>
<p><italic>3 </italic><bold><italic>for</italic></bold> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e163" xlink:type="simple"/></inline-formula> <bold><italic>do</italic></bold></p>
<p><italic>4 </italic> <bold><italic>if</italic></bold> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e164" xlink:type="simple"/></inline-formula> (<italic>marginal hazard</italic>) <bold><italic>then</italic></bold></p>
<p><italic>5   Initialize</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e165" xlink:type="simple"/></inline-formula> <italic>and</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e166" xlink:type="simple"/></inline-formula>.</p>
<p><italic>6 </italic>  <bold><italic>while</italic></bold> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e167" xlink:type="simple"/></inline-formula> <bold><italic>do</italic></bold></p>
<p><italic>7   Simulate</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e168" xlink:type="simple"/></inline-formula>.</p>
<p><italic>8   Set</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e169" xlink:type="simple"/></inline-formula>.</p>
<p><italic>9   Simulate</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e170" xlink:type="simple"/></inline-formula>.</p>
<p><italic>10 </italic> <bold><italic>end while</italic></bold></p>
<p><italic>11  </italic><bold><italic>else</italic></bold></p>
<p><italic>12  Simulate exponential waiting-time</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e171" xlink:type="simple"/></inline-formula>.</p>
<p><italic>13  </italic><bold><italic>end if</italic></bold></p>
<p><italic>14 </italic><bold><italic>end for</italic></bold></p>
<p><italic>15 Choose reaction associated with the minimal waiting-time</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e172" xlink:type="simple"/></inline-formula>.</p>
<p><italic>16 Update state</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e173" xlink:type="simple"/></inline-formula>.</p>
<p><italic>17 Update time</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e174" xlink:type="simple"/></inline-formula>.</p>
<p><italic>18 </italic><bold><italic>if</italic></bold> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e175" xlink:type="simple"/></inline-formula><italic> </italic><bold><italic>then</italic></bold></p>
<p><italic>19  Update</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e176" xlink:type="simple"/></inline-formula> <italic>by the terms accompanying</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e177" xlink:type="simple"/></inline-formula> <italic>in Eq. 8</italic>.</p>
<p><italic>20 </italic><bold><italic>end if</italic></bold></p>
<p><italic>21 Output</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e178" xlink:type="simple"/></inline-formula> <italic>and</italic> <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e179" xlink:type="simple"/></inline-formula>.</p>
<p><italic>22 </italic><bold><italic>end while</italic></bold></p>
<p>Evidently, simulation from Eq. 10 (i.e., through the thinning method in lines 5-10 of Algorithm 1) comes at higher cost than simulating from an exponential distribution, since in general, it relies on the numerical integration of an ODE. However, reactions associated with the environmental part no longer need to be simulated, which yields a significant reduction in computational effort as soon as the environmental network is large and expensive to simulate due to high propensity reactions, for instance.</p>
</sec><sec id="s2b2">
<title>An illustrative example</title>
<p>We will now instantiate the proposed framework using a simple telegraph model of transcription, i.e., <disp-formula id="pcbi.1003942.e180"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003942.e180" xlink:type="simple"/></disp-formula>with propensities given by the law of mass action. The two-state promoter <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e181" xlink:type="simple"/></inline-formula> stochastically switches between its inactive state <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e182" xlink:type="simple"/></inline-formula> and its active state <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e183" xlink:type="simple"/></inline-formula>, whereas only the latter allows transcription of mRNA (denoted by <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e184" xlink:type="simple"/></inline-formula>). For the sake of illustration, this model is now understood as a process <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e185" xlink:type="simple"/></inline-formula> which is driven by an environmental perturbation <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e186" xlink:type="simple"/></inline-formula>. We thus aim to find the uncoupled dynamics of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e187" xlink:type="simple"/></inline-formula>, where fluctuations in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e188" xlink:type="simple"/></inline-formula> have been marginalized.</p>
<p>In order to evaluate the marginal hazard function, we need to compute the conditional expectation <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e189" xlink:type="simple"/></inline-formula>. It is straightforward to show that the unconditional probability distribution over the promoter states satisfies the CME <disp-formula id="pcbi.1003942.e190"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003942.e190" xlink:type="simple"/><label>(11)</label></disp-formula>with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e191" xlink:type="simple"/></inline-formula>. From equation Eq. 5 we further know that the unnormalized conditional probability <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e192" xlink:type="simple"/></inline-formula> admits the linear stochastic differential equation</p>
<p><disp-formula id="pcbi.1003942.e193"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003942.e193" xlink:type="simple"/><label>(12)</label></disp-formula>As long as no transcription event takes place (i.e., <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e194" xlink:type="simple"/></inline-formula>), the conditional distribution from Eq.12 is just given by a linear homogeneous ODE, whose solution is known in closed form. We refer to this distribution as <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e195" xlink:type="simple"/></inline-formula>. In case a reaction happens at time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e196" xlink:type="simple"/></inline-formula>, the distribution will be updated according to <disp-formula id="pcbi.1003942.e197"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003942.e197" xlink:type="simple"/><label>(13)</label></disp-formula></p>
<p>Upon normalization of the distribution <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e198" xlink:type="simple"/></inline-formula> we may express its expectation between two consecutive firing times <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e199" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e200" xlink:type="simple"/></inline-formula> with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e201" xlink:type="simple"/></inline-formula> as <disp-formula id="pcbi.1003942.e202"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003942.e202" xlink:type="simple"/><label>(14)</label></disp-formula>with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e203" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e204" xlink:type="simple"/></inline-formula>. Furthermore, normalization of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e205" xlink:type="simple"/></inline-formula> shows that when the next reaction at time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e206" xlink:type="simple"/></inline-formula> fires, the conditional expectation instantaneously changes to one. This is consistent with the fact that for a transcription event to happen at <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e207" xlink:type="simple"/></inline-formula>, the promoter must be in its active state at least until <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e208" xlink:type="simple"/></inline-formula>. <xref ref-type="fig" rid="pcbi-1003942-g002">Fig. 2</xref> illustrates the computation of the marginal hazard function used during MSA.</p>
<fig id="pcbi-1003942-g002" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003942.g002</object-id><label>Figure 2</label><caption>
<title>Schematic illustration of the marginal simulation algorithm.</title>
<p>The red line shows the computation of the marginal hazard function <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e209" xlink:type="simple"/></inline-formula> of the telegraph model (i.e., using Eq.14). The blue dots indicate the corresponding transcription events. Also shown is a possible corresponding realization of the promoter state (gray bars indicate the time the promoter has been active). The figure illustrates that using the MSA algorithm, only the events associated with X need to be simulated (in this case the transcription of mRNA). In contrast, SSA requires explicit simulation of all environmental states, which – depending on the time-scale – may become computationally prohibitive.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003942.g002" position="float" xlink:type="simple"/></fig>
<p>Another important quantity to describe the uncoupled model is its Kolmogorov-forward- (or master-) equation. We remark that since the uncoupled dynamics are non-Markovian, they do not satisfy a conventional master equation. Instead, such processes are described by <italic>generalized master equations</italic> (GME) that can account for memory effects in the dynamics (see S.5 in <xref ref-type="supplementary-material" rid="pcbi.1003942.s001">S1 Text</xref> for further discussion). In particular, there exists a fundamental relation between a GME's memory and the corresponding network's waiting-time distributions <xref ref-type="bibr" rid="pcbi.1003942-Montroll1">[28]</xref>. For the uncoupled telegraph model, the waiting-time distribution <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e210" xlink:type="simple"/></inline-formula> of the transcription events is fully tractable using Eq. 10 (for an explicit expression see <xref ref-type="supplementary-material" rid="pcbi.1003942.s002">S1 Mathematica Notebook</xref>). It is therefore straightforward to develop a Chapman-Kolmogorov type of equation for the transcriptional dynamics <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e211" xlink:type="simple"/></inline-formula>, i.e., <disp-formula id="pcbi.1003942.e212"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003942.e212" xlink:type="simple"/><label>(15)</label></disp-formula>for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e213" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e214" xlink:type="simple"/></inline-formula> with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e215" xlink:type="simple"/></inline-formula> as the cumulative waiting-time distribution. Following <xref ref-type="bibr" rid="pcbi.1003942-Montroll1">[28]</xref>, Eq. 15 can be transformed into a gain-loss-type of master equation, i.e.,<disp-formula id="pcbi.1003942.e216"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003942.e216" xlink:type="simple"/><label>(16)</label></disp-formula>where the memory kernel <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e217" xlink:type="simple"/></inline-formula> is related to <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e218" xlink:type="simple"/></inline-formula> through the <italic>Montroll-Weiss</italic> equation (see S.5 in <xref ref-type="supplementary-material" rid="pcbi.1003942.s001">S1 Text</xref>). Eq. 16 represents the desired marginal master equation, from which further analysis could be deduced.</p>
</sec><sec id="s2b3">
<title>Comparison of MSA to existing approaches</title>
<p>The impact of environmental fluctuations on a dynamical system of interest is as diverse as the timescale on which they operate. For instance, extrinsic noise in the context of gene expression might be slowly varying (e.g., correlates well with the cell-cycle <xref ref-type="bibr" rid="pcbi.1003942-Rosenfeld1">[29]</xref>, <xref ref-type="bibr" rid="pcbi.1003942-Volfson1">[30]</xref>), while fluctuations in transcription factor abundance might be significantly faster than the expression kinetics downstream. From a technical point of view, timescales range from constant environmental conditions that are random but fixed <xref ref-type="bibr" rid="pcbi.1003942-Zechner3">[31]</xref> to regimes where the fluctuations are very fast, such that quasi-steady-state (QSS) assumptions become applicable <xref ref-type="bibr" rid="pcbi.1003942-Rao1">[16]</xref>, <xref ref-type="bibr" rid="pcbi.1003942-Kepler1">[32]</xref>. A QSS-based approach for simulating a system <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e219" xlink:type="simple"/></inline-formula> in the presence of extrinsic noise <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e220" xlink:type="simple"/></inline-formula> corresponds to simulating the conditional CTMC <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e221" xlink:type="simple"/></inline-formula>, where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e222" xlink:type="simple"/></inline-formula> is replaced by the mean of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e223" xlink:type="simple"/></inline-formula>. Alternatively, one may try to replace a fluctuating environment <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e224" xlink:type="simple"/></inline-formula> through a random but fixed environment of same variance but this leads to an overestimation of the process variance in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e225" xlink:type="simple"/></inline-formula> <xref ref-type="bibr" rid="pcbi.1003942-Hilfinger1">[5]</xref>, as discussed in a later section. To investigate the two above simplifying assumptions and compare them to the exact solution obtained via SSA and MSA, we performed a simulation study on a linear three-stage birth-death model given in <xref ref-type="fig" rid="pcbi-1003942-g003">Fig. 3a</xref>. In this case only species <italic>C</italic> is considered of interest whose uncoupled dynamics are obtained by marginalizing <italic>A</italic> and <italic>B</italic>. The results from <xref ref-type="fig" rid="pcbi-1003942-g003">Fig. 3b</xref> and <xref ref-type="fig" rid="pcbi-1003942-g003">Fig. 3c</xref> show that MSA facilitates accurate and fast approximations also under intermediate environmental time-scales where QSS- and static environmental assumptions break down.</p>
<fig id="pcbi-1003942-g003" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003942.g003</object-id><label>Figure 3</label><caption>
<title>Evaluation of the marginal simulation algorithm.</title>
<p>(a) Simple three-stage model. Species A, B and C are modeled as coupled linear birth-death processes. Filled arrows correspond to mass-action reactions, whereas empty arrows connecting species S and reaction <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e226" xlink:type="simple"/></inline-formula> indicate that S linearly modulates the rate of that reaction, i.e., <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e227" xlink:type="simple"/></inline-formula>. The rate constants were chosen to be <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e228" xlink:type="simple"/></inline-formula>. The uncoupled marginal dynamics of C are obtained under a second-order zero-cumulants closure. (b, c) Evaluation of the marginal simulation algorithm. Simulations based on the QSS-approximation neglect a significant portion of variability as opposed to assuming a constant environment (CE) in which case the variability is overestimated. In contrast, the uncoupled dynamics correctly predict the fluctuations on the protein level, while yielding a reduction in computational effort when compared to standard SSA (i.e., a simulation time of approximately 20 min instead of 46 min). For each of the schemes, 7000 sample paths have been used to compute the respective histograms (and moments). (d) Nonlinear reaction network. A ten-dimensional reaction network consisting of species (A, B,…, J) modulates the production rate of a birth-death process X (rate constants <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e229" xlink:type="simple"/></inline-formula>). (e) The uncoupled dynamics of X were computed under a second-order zero-cumulants closure. Different environmental time-scales were realized by multiplying the vector of rate constants by a constant factor <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e230" xlink:type="simple"/></inline-formula>. For each <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e231" xlink:type="simple"/></inline-formula>, 2000 samples paths were simulated to assess the performance of MSA and SSA, respectively. In all cases, the estimated Kolmogorov distance between the SSA and MSA distributions was below <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e232" xlink:type="simple"/></inline-formula>. (f) Bistable reaction network. The environmental part was modeled as a one-dimensional Schloegl system <xref ref-type="bibr" rid="pcbi.1003942-Schlgl1">[33]</xref> modulating the production rate of a birth-death process X (rate constants <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e233" xlink:type="simple"/></inline-formula>). (g) The uncoupled dynamics were computed by integrating Eq.5 on a truncated state space (i.e., feasible states <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e234" xlink:type="simple"/></inline-formula>). The distribution over X was computed at <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e235" xlink:type="simple"/></inline-formula> minutes using 50000 MSA and SSA samples (estimated Kolmogorov distance of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e236" xlink:type="simple"/></inline-formula>). The computation of 50 MSA and SSA samples took 13.79 and 255.05 seconds, respectively.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003942.g003" position="float" xlink:type="simple"/></fig></sec><sec id="s2b4">
<title>Varying environmental time-scales</title>
<p>Simulation of the joint system <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e237" xlink:type="simple"/></inline-formula> becomes particularly challenging if the environmental fluctuations are fast, while with Eq. 8 the complexity of the marginal process simulation is invariant with respect to the time-scale of the environment. To demonstrate this effect, we performed a simulation study using a ten-dimensional, non-linear environmental network (<xref ref-type="fig" rid="pcbi-1003942-g003">Fig. 3d</xref>). Different time-scales were realized by multiplying the vector of environmental rate constants by a constant factor <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e238" xlink:type="simple"/></inline-formula>, effectively changing the number of reactions that have to be simulated on average. The results from <xref ref-type="fig" rid="pcbi-1003942-g003">Fig. 3e</xref> demonstrate that the computation time of the SSA simulation strongly increases with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e239" xlink:type="simple"/></inline-formula>. In contrast, the MSA's efficiency appears largely invariant with respect to the environmental time-scale, possibly leading to a substantial reduction in computational effort. We remark that for all three time-scales, the MSA algorithm achieved very high accuracies (i.e., estimated Kolmogorov distances below <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e240" xlink:type="simple"/></inline-formula>). However, If the environmental time-scale is comparably slow (i.e., if <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e241" xlink:type="simple"/></inline-formula>), the extra effort needed for computing the marginal hazard function dominates, in which case SSA appears favorable.</p>
</sec><sec id="s2b5">
<title>Bistable environmental fluctuations</title>
<p>We further analyzed the case where the environmental network exhibits a more complex dynamics. In particular, we considered a bistable Schloegl system <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e242" xlink:type="simple"/></inline-formula> <xref ref-type="bibr" rid="pcbi.1003942-Schlgl1">[33]</xref> modulating the production rate of a birth-death process <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e243" xlink:type="simple"/></inline-formula> (<xref ref-type="fig" rid="pcbi-1003942-g003">Fig. 3f</xref>). Here the most efficient way to compute the marginal hazard functions was to directly integrate Eq. 5 under a suitable state space truncation (see caption of <xref ref-type="fig" rid="pcbi-1003942-g003">Fig. 3g</xref> for fuller details). The results shown in <xref ref-type="fig" rid="pcbi-1003942-g003">Fig. 3g</xref> indicate that also in this case, the MSA algorithm achieves high accuracies but at the same time finishes around <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e244" xlink:type="simple"/></inline-formula> times faster than the corresponding SSA algorithm. These results underpin the significance of MSA in cases where the environmental network is costly to simulate (i.e., many reactions take place) but at the same time, a QSS-based approach is unable to capture the correct dynamics (e.g., a bistable production rate).</p>
</sec></sec><sec id="s2c">
<title>Uncoupled dynamics for network analysis</title>
<sec id="s2c1">
<title>Propagation of environmental fluctuations and the effective noise</title>
<p>Several recent studies <xref ref-type="bibr" rid="pcbi.1003942-Bowsher1">[34]</xref>, <xref ref-type="bibr" rid="pcbi.1003942-Hilfinger1">[5]</xref>, <xref ref-type="bibr" rid="pcbi.1003942-Swain1">[6]</xref>, <xref ref-type="bibr" rid="pcbi.1003942-Raser1">[4]</xref> are centered around the separation of different noise contributions in biochemical networks. Typically, the law of total variance is employed to decompose the fluctuations of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e245" xlink:type="simple"/></inline-formula> into parts that are intrinsic to <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e246" xlink:type="simple"/></inline-formula> and parts that come from <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e247" xlink:type="simple"/></inline-formula> (i.e., are extrinsic to <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e248" xlink:type="simple"/></inline-formula>). Here we found that performing such an analysis on <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e249" xlink:type="simple"/></inline-formula> instead of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e250" xlink:type="simple"/></inline-formula> – in conjunction with our decoupling approach – provides a novel way to study how stochasticity is propagated through biochemical networks. Using the law of total variance, we can decompose the total (or unconditional) variance of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e251" xlink:type="simple"/></inline-formula> as <disp-formula id="pcbi.1003942.e252"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003942.e252" xlink:type="simple"/><label>(17)</label></disp-formula></p>
<p>The two terms on the r.h.s. can be interpreted as follows. Assume we can observe <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e253" xlink:type="simple"/></inline-formula> only through <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e254" xlink:type="simple"/></inline-formula>. Since <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e255" xlink:type="simple"/></inline-formula> is intrinsically stochastic, a part of the variability of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e256" xlink:type="simple"/></inline-formula> is not carried over to <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e257" xlink:type="simple"/></inline-formula>. In Eq. 17, this part (i.e., the <italic>suppressed noise</italic>) corresponds to the first term on the r.h.s. since it quantifies the uncertainty about <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e258" xlink:type="simple"/></inline-formula> that remains after observing <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e259" xlink:type="simple"/></inline-formula>. The second term determines how accurate <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e260" xlink:type="simple"/></inline-formula> can be reconstructed from trajectories <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e261" xlink:type="simple"/></inline-formula>. Alternatively, it can be understood as the amount of noise in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e262" xlink:type="simple"/></inline-formula> that effectively impacts <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e263" xlink:type="simple"/></inline-formula> (i.e., the <italic>effective noise</italic>). For instance, the environmental process could be characterized by a large variance, but still have only marginal impact on <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e264" xlink:type="simple"/></inline-formula> – depending on the timescale of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e265" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e266" xlink:type="simple"/></inline-formula>.</p>
<p>In order to quantify those terms, we note that the conditional variance within the first term coincides with the second-order central moment of the filtering distribution from Eq.5. This further implies that it can be computed “on-the-fly” when simulating <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e267" xlink:type="simple"/></inline-formula> using the marginal simulation algorithm which allows an efficient estimation of its expectation. However, in some biologically relevant cases, the effective noise can be determined even analytically, which we demonstrate in the following.</p>
<p>We derive in section S.4 in <xref ref-type="supplementary-material" rid="pcbi.1003942.s001">S1 Text</xref> that the expected central moments are generally given by <disp-formula id="pcbi.1003942.e268"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003942.e268" xlink:type="simple"/><label>(18)</label></disp-formula></p>
<p>The mean in Eq.18 is just the unconditional mean of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e269" xlink:type="simple"/></inline-formula>, while the derivative of the expected variance shows an additional negative term, causing it to be smaller than the unconditional variance. Let us for instance consider the case where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e270" xlink:type="simple"/></inline-formula> follows a Cox-Ingersoll-Ross process governed by the SDE <disp-formula id="pcbi.1003942.e271"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003942.e271" xlink:type="simple"/><label>(19)</label></disp-formula>with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e272" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e273" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e274" xlink:type="simple"/></inline-formula> as real process parameters and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e275" xlink:type="simple"/></inline-formula> as a standard Wiener process. Note that in this case, Eq. 18 reduces to an autonomous ODE, which for large <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e276" xlink:type="simple"/></inline-formula> yields the relative effective noise <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e277" xlink:type="simple"/></inline-formula> at stationarity, i.e.,<disp-formula id="pcbi.1003942.e278"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003942.e278" xlink:type="simple"/><label>(20)</label></disp-formula>where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e279" xlink:type="simple"/></inline-formula> can be considered a normalized timescale of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e280" xlink:type="simple"/></inline-formula> (see section S.4 in <xref ref-type="supplementary-material" rid="pcbi.1003942.s001">S1 Text</xref>). The computation of the effective noise and its dependency on the environmental timescale is illustrated in <xref ref-type="fig" rid="pcbi-1003942-g004">Fig. 4</xref>.</p>
<fig id="pcbi-1003942-g004" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003942.g004</object-id><label>Figure 4</label><caption>
<title>Propagation and suppression of environmental fluctuations.</title>
<p>(a) Linear birth-death process in a fluctuation environment. The birth-rate is assumed to be linearly modulated by its environment <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e281" xlink:type="simple"/></inline-formula> modeled as a CIR process (see Eq. 19). (b) Calculation of suppressed and effective noise. Individual components were computed analytically by solving an ordinary differential equation (see Eq. 22 in <xref ref-type="supplementary-material" rid="pcbi.1003942.s001">S1 Text</xref>) with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e282" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e283" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e284" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e285" xlink:type="simple"/></inline-formula>. For orientation, we also show the information gain between <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e286" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e287" xlink:type="simple"/></inline-formula>, computed using the marginal simulation algorithm (green); it can be understood as the gain in information about <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e288" xlink:type="simple"/></inline-formula> through observing <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e289" xlink:type="simple"/></inline-formula> and it exhibits a monotone relationship with the effective noise. (c) Relation between the effective noise and the speed of the environmental fluctuations. Noise contributions were computed by numerically solving Eq. 22 in <xref ref-type="supplementary-material" rid="pcbi.1003942.s001">S1 Text</xref> for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e290" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e291" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e292" xlink:type="simple"/></inline-formula> and different values of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e293" xlink:type="simple"/></inline-formula>. Note that the results are independent of the death rate <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e294" xlink:type="simple"/></inline-formula>. Also shown are realizations of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e295" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e296" xlink:type="simple"/></inline-formula> for the case for two different time-scales. If <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e297" xlink:type="simple"/></inline-formula> is fast, the output <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e298" xlink:type="simple"/></inline-formula> is able to suppress most of the variability in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e299" xlink:type="simple"/></inline-formula>. In contrast, if <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e300" xlink:type="simple"/></inline-formula> is slow, fluctuations are largely transferred to <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e301" xlink:type="simple"/></inline-formula> (i.e.,<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e302" xlink:type="simple"/></inline-formula> has a large effective noise) such that extrinsic noise in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e303" xlink:type="simple"/></inline-formula> is substantial.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003942.g004" position="float" xlink:type="simple"/></fig></sec><sec id="s2c2">
<title>The slow noise approximation (SNA)</title>
<p>The effective noise can be understood as a measure of how strong <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e304" xlink:type="simple"/></inline-formula> impacts <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e305" xlink:type="simple"/></inline-formula>. Only in the special case of a very slow or constant environment, i.e., <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e306" xlink:type="simple"/></inline-formula>, it turns out that for large <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e307" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e308" xlink:type="simple"/></inline-formula>, i.e., all variability in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e309" xlink:type="simple"/></inline-formula> is transferred to <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e310" xlink:type="simple"/></inline-formula>. Hence, a more noisy but fluctuating environment may induce a similar (or even the same) effective noise in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e311" xlink:type="simple"/></inline-formula> as a random but fixed environment of the same variance. Consequently, when looking at only snapshot data for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e312" xlink:type="simple"/></inline-formula> one can generally not infer whether the environment is constant or fluctuating. On the other hand, this implies that we may well approximate the impact of a complicated and dynamically changing environment by a simple random variable of appropriate variance. More specifically, we demand for an equivalent constant environment <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e313" xlink:type="simple"/></inline-formula> such that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e314" xlink:type="simple"/></inline-formula>, where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e315" xlink:type="simple"/></inline-formula> is the effective noise of the original, fluctuating environment <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e316" xlink:type="simple"/></inline-formula> at stationarity. Let us again consider the birth-death process of <xref ref-type="fig" rid="pcbi-1003942-g004">Fig. 4a</xref> and set the birth rate to one such that any scaling is subsumed in the environmental process <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e317" xlink:type="simple"/></inline-formula>. With <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e318" xlink:type="simple"/></inline-formula>, the abundance of the birth death process at any time is given by <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e319" xlink:type="simple"/></inline-formula> with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e320" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e321" xlink:type="simple"/></inline-formula> as counting processes for the birth and death reaction, respectively. We show in section S.5.1 in <xref ref-type="supplementary-material" rid="pcbi.1003942.s001">S1 Text</xref> that the marginal birth hazard is approximately given by <disp-formula id="pcbi.1003942.e322"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003942.e322" xlink:type="simple"/><label>(21)</label></disp-formula>with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e323" xlink:type="simple"/></inline-formula> the unconditional mean and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e324" xlink:type="simple"/></inline-formula> the effective noise of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e325" xlink:type="simple"/></inline-formula>, whereas the expression becomes exact for constant and infinitely fast environments. Note that the marginal hazard does not depend on the full history, but only the number of birth-reactions <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e326" xlink:type="simple"/></inline-formula> up to time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e327" xlink:type="simple"/></inline-formula>. That is, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e328" xlink:type="simple"/></inline-formula> is a sufficient statistic for evaluating the conditional expectation <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e329" xlink:type="simple"/></inline-formula>. In relation to QSS, which assumes that no fluctuations of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e330" xlink:type="simple"/></inline-formula> are propagated to <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e331" xlink:type="simple"/></inline-formula>, the found equivalent constant environment with the proper effective noise provides a better approximation for a decoupled simulation of environment and process of interest than QSS.</p>
<p>Using the effective noise, we now aim to find a master equation, which describes the time-evolution of the marginal probability distribution <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e332" xlink:type="simple"/></inline-formula>. Since <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e333" xlink:type="simple"/></inline-formula> depends on <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e334" xlink:type="simple"/></inline-formula> rather than <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e335" xlink:type="simple"/></inline-formula>, it appears natural to formulate the master equation in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e336" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e337" xlink:type="simple"/></inline-formula> as well. For the example considered here, one can show that the probability distribution <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e338" xlink:type="simple"/></inline-formula> satisfies a GME of the form <disp-formula id="pcbi.1003942.e339"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003942.e339" xlink:type="simple"/><label>(22)</label></disp-formula>that can be solved analytically using generating functions (see S.5.1 in <xref ref-type="supplementary-material" rid="pcbi.1003942.s001">S1 Text</xref>). From <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e340" xlink:type="simple"/></inline-formula> we compute the distribution of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e341" xlink:type="simple"/></inline-formula> as<disp-formula id="pcbi.1003942.e342"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003942.e342" xlink:type="simple"/><label>(23)</label></disp-formula>i.e., a negative binomial distribution. Eq. 23 provides a surprisingly simple approximate solution for the transient probability distribution of birth death processes in a fluctuating environment. In order to check its validity, we compared the analytical approximate distributions to the ones obtained through SSA for a gene expression model, where the environmental fluctuations are assumed to be due to the mRNA dynamics (see <xref ref-type="fig" rid="pcbi-1003942-g005">Fig. 5</xref>). More specifically, we computed the Kolmogorov distance between the resulting protein distributions as a function of the environmental timescale. Apart from the exact correspondence for the limiting time-scales, <xref ref-type="fig" rid="pcbi-1003942-g005">Fig. 5</xref> indicates that the SNA provides a good approximation regardless of the environmental timescale.</p>
<fig id="pcbi-1003942-g005" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003942.g005</object-id><label>Figure 5</label><caption>
<title>Analytical protein distributions through the slow noise approximation.</title>
<p>(a) Two-stage gene expression model. Transcription and translation are modeled through mass-action kinetics with reaction rate constants <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e343" xlink:type="simple"/></inline-formula>-<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e344" xlink:type="simple"/></inline-formula>. Fluctuations on the mRNA are considered environmental and hence, integrated out in order to obtain a one-dimensional stochastic process describing only the protein. (b) Accuracy of the slow noise approximation. The SNA was compared to the QSS- and CE-approximations by means of the Kolmogorov distance between the respective approximate and exact distribution (SSA) as a function of the relative speed of the mRNA fluctuations defined by <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e345" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e346" xlink:type="simple"/></inline-formula>. The mRNA birth- and death-rates were varied between <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e347" xlink:type="simple"/></inline-formula> and 1 while maintaining a constant ratio of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e348" xlink:type="simple"/></inline-formula>. The remaining parameters were chosen as <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e349" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003942.e350" xlink:type="simple"/></inline-formula>. QSS- and CE approximations break down for slow or fast environmental fluctuations respectively, whereas the SNA yields accurate distributions regardless of the mRNA's timescale. (c) Exemplary distributions obtained through the different approaches in three different regimes (slow, intermediate, fast).</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003942.g005" position="float" xlink:type="simple"/></fig></sec></sec></sec><sec id="s3">
<title>Discussion</title>
<p>There is increasing evidence that models of biochemical networks need to account for both intrinsic and extrinsic noise caused by variations in the intracellular environment. In recent studies, this is done by extending a model's state space by certain environmental species, whose dynamics are described along with the actual system of interest. In particular, the resulting system dynamics are described and studied <italic>conditional</italic> on a particular history of the environment and thus, do not provide a coherent description of a dynamical system subject to extrinsic noise. In this work, we derived and analyzed a novel process framework, which is able to describe just the system of interest as if it was still embedded into its environment. In that sense, it permits a mathematically exact way to analyze small parts of networks in an <italic>uncoupled</italic> fashion.</p>
<p>Several recent studies rely on the extreme assumptions that the environmental fluctuations are either infinitely fast or slow. While both strategies may in fact lead to strongly simplified and tractable models, they are characterized by significant approximation errors when considering intermediate environmental timescales (see e.g., <xref ref-type="fig" rid="pcbi-1003942-g005">Fig. 5b</xref>). The approach proposed here allows to uncouple a reaction network from its surrounding environment regardless of the latter's timescale. In that sense, the approach is fully general although practical implementations may rely on efficient but approximate solutions of the discussed filtering problem.</p>
<p>In the context of Monte Carlo simulation the decoupled process can yield a significant reduction in computational effort when compared to standard SSA – especially if the environmental network is costly to simulate. This highlights the role of the provided framework as a general tool to split stochastic biochemical networks into individual parts that are easier to simulate. We believe that it will aid in turning stochastic modeling and simulation techniques more large-scale and more faithful to <italic>in vivo</italic> conditions, where significant environmental fluctuations are present. Moreover, the framework can be used in the model-based design of novel circuit motifs in synthetic biology and is related to the notion of retroactivity <xref ref-type="bibr" rid="pcbi.1003942-Jayanthi1">[35]</xref>.</p>
<p>We further demonstrate that the uncoupled dynamics provide a novel analytical tool to study how environmental stochasticity is propagated along coupled reaction networks. For instance, we have shown that the total environmental noise splits up into two terms: one corresponding to the noise that is suppressed and a second term that quantifies the effective noise that is <italic>sensed</italic> by the target network. In <xref ref-type="bibr" rid="pcbi.1003942-Lestas1">[36]</xref> the authors derive a lower bound on a network's ability to suppress fluctuations and show its immediate relation to the uncertainty at which those fluctuations can be estimated – similar to what we defined as effective noise. The methods proposed here allow to not only bound, but fully determine both the suppressed and effective environmental noise. Our results further indicate that two environments with very different timescales may impact a network in a similar way. For instance a fixed but random environment may yield the same effective noise as a fluctuating environment with larger variance. Along those lines, we derived a simple but widely applicable approximation of the transient probability distribution for birth-death processes subject to environmental noise. It is based on the idea to approximate a fluctuating environmental process by a simple random variable that impacts the birth death process in an equivalent way. In order to solve for the transient probability distribution we derived a generalized master equation for this non-Markovian process. The results were derived under the assumption of a one-dimensional environmental process but its extension to multivariate scenarios shall be examined at a later stage.</p>
<p>The presented framework provides a novel and orthogonal notion of environmentally perturbed stochastic networks from which several interesting avenues could be pursued. However, the approach in its current form has a few practical limitations that should be addressed in future work. Above all, if the uncoupled dynamics cannot be computed analytically, its accuracy – and hence, reliability will depend on finding suitable approximate schemes. For that sake, we believe that one will profit from the approach's tight connection to stochastic filtering – a field that has been thoroughly explored over the past decades. Therefore, the marginal hazard functions may be approximated by exploiting certain features of the associated filtering problems such as their asymptotic theories and so forth. Those could for instance be used to derive more general moment-closure schemes or to construct concise and more efficient state-space truncations <xref ref-type="bibr" rid="pcbi.1003942-Munsky1">[37]</xref> when integrating the respective filtering distribution. The main bottleneck of the MSA algorithm is the simulation of the non-exponential waiting-times, which relies on the integration of an ODE. Therefore, the use of optimized and dedicated ODE solvers could further boost the algorithm's performance.</p>
</sec><sec id="s4">
<title>Models</title>
<p>All models and simulations were implemented in MATLAB (The MathWorks, Natick, MA). Source codes for reproducing the numerical results have been attached as <xref ref-type="supplementary-material" rid="pcbi.1003942.s003">S1 Database</xref>.</p>
</sec><sec id="s5">
<title>Supporting Information</title>
<supplementary-material id="pcbi.1003942.s001" mimetype="application/pdf" xlink:href="info:doi/10.1371/journal.pcbi.1003942.s001" position="float" xlink:type="simple"><label>S1 Text</label><caption>
<p>Supplementary theory and derivations.</p>
<p>(PDF)</p>
</caption></supplementary-material><supplementary-material id="pcbi.1003942.s002" mimetype="application/mathematica" xlink:href="info:doi/10.1371/journal.pcbi.1003942.s002" position="float" xlink:type="simple"><label>S1 Mathematica Notebook</label><caption>
<p>Mathematica notebook for the telegraph model.</p>
<p>(NB)</p>
</caption></supplementary-material><supplementary-material id="pcbi.1003942.s003" mimetype="application/zip" xlink:href="info:doi/10.1371/journal.pcbi.1003942.s003" position="float" xlink:type="simple"><label>S1 Database</label><caption>
<p>MATLAB source codes used for simulations.</p>
<p>(ZIP)</p>
</caption></supplementary-material></sec></body>
<back>
<ack>
<p>We thank Jakob Ruess for sharing code for generating moments of chemical reaction networks.</p>
</ack>
<ref-list>
<title>References</title>
<ref id="pcbi.1003942-McAdams1"><label>1</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>McAdams</surname><given-names>HH</given-names></name>, <name name-style="western"><surname>Arkin</surname><given-names>A</given-names></name> (<year>1997</year>) <article-title>Stochastic mechanisms in gene expression</article-title>. <source>Proc Natl Acad Sci USA</source> <volume>94</volume>: <fpage>814</fpage>–<lpage>819</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003942-Elowitz1"><label>2</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Elowitz</surname><given-names>MB</given-names></name>, <name name-style="western"><surname>Levine</surname><given-names>AJ</given-names></name>, <name name-style="western"><surname>Siggia</surname><given-names>ED</given-names></name>, <name name-style="western"><surname>Swain</surname><given-names>PS</given-names></name> (<year>2002</year>) <article-title>Stochastic gene expression in a single cell</article-title>. <source>Science</source> <volume>297</volume>: <fpage>1183</fpage>–<lpage>6</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003942-ColmanLerner1"><label>3</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Colman-Lerner</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Gordon</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Serra</surname><given-names>E</given-names></name>, <name name-style="western"><surname>Chin</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Resnekov</surname><given-names>O</given-names></name>, <etal>et al</etal>. (<year>2005</year>) <article-title>Regulated cell-to-cell variation in a cell-fate decision system</article-title>. <source>Nature</source> <volume>437</volume>: <fpage>699</fpage>–<lpage>706</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003942-Raser1"><label>4</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Raser</surname><given-names>JM</given-names></name>, <name name-style="western"><surname>O'Shea</surname><given-names>EK</given-names></name> (<year>2004</year>) <article-title>Control of stochasticity in eukaryotic gene expression</article-title>. <source>Science</source> <volume>304</volume>: <fpage>1811</fpage>–<lpage>1814</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003942-Hilfinger1"><label>5</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Hilfinger</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Paulsson</surname><given-names>J</given-names></name> (<year>2011</year>) <article-title>Separating intrinsic from extrinsic fluctuations in dynamic biological systems</article-title>. <source>Proc Natl Acad Sci USA</source> <volume>108</volume>: <fpage>12167</fpage>–<lpage>12172</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003942-Swain1"><label>6</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Swain</surname><given-names>PS</given-names></name>, <name name-style="western"><surname>Elowitz</surname><given-names>MB</given-names></name>, <name name-style="western"><surname>Siggia</surname><given-names>ED</given-names></name> (<year>2002</year>) <article-title>Intrinsic and extrinsic contributions to stochasticity in gene expression</article-title>. <source>Proceedings of the National Academy of Sciences</source> <volume>99</volume>: <fpage>12795</fpage>–<lpage>12800</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003942-Ruess1"><label>7</label>
<mixed-citation publication-type="other" xlink:type="simple">Ruess J, Milias-Argeitis A, Lygeros J (2013) Designing experiments to understand the variability in biochemical reaction networks. Journal of The Royal Society Interface 10.</mixed-citation>
</ref>
<ref id="pcbi.1003942-Zechner1"><label>8</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Zechner</surname><given-names>C</given-names></name>, <name name-style="western"><surname>Ruess</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Krenn</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Pelet</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Peter</surname><given-names>M</given-names></name>, <etal>et al</etal>. (<year>2012</year>) <article-title>Moment-based inference predicts bimodality in transient gene expression</article-title>. <source>Proc Natl Acad Sci USA</source> <volume>109</volume>: <fpage>8340</fpage>–<lpage>8345</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003942-Zechner2"><label>9</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Zechner</surname><given-names>C</given-names></name>, <name name-style="western"><surname>Unger</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Pelet</surname><given-names>S</given-names></name>, <name name-style="western"><surname>M</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Koeppl</surname><given-names>H</given-names></name> (<year>2014</year>) <article-title>Scalable inference of heterogeneous reaction kinetics from pooled single-cell recordings</article-title>. <source>Nat Methods</source> <volume>11</volume>: <fpage>197</fpage>–<lpage>202</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003942-Finkenstdt1"><label>10</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Finkenstädt</surname><given-names>B</given-names></name>, <name name-style="western"><surname>Woodcock</surname><given-names>DJ</given-names></name>, <name name-style="western"><surname>Komorowski</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Harper</surname><given-names>CV</given-names></name>, <name name-style="western"><surname>Davis</surname><given-names>JR</given-names></name>, <etal>et al</etal>. (<year>2013</year>) <article-title>Quantifying intrinsic and extrinsic noise in gene transcription using the linear noise approximation: An application to single cell data</article-title>. <source>The Annals of Applied Statistics</source> <volume>7</volume>: <fpage>1960</fpage>–<lpage>1982</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003942-Hasenauer1"><label>11</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Hasenauer</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Waldherr</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Doszczak</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Radde</surname><given-names>N</given-names></name>, <name name-style="western"><surname>Scheurich</surname><given-names>P</given-names></name>, <etal>et al</etal>. (<year>2011</year>) <article-title>Identification of models of heterogeneous cell populations from population snapshot data</article-title>. <source>BMC Bioinformatics</source> <volume>12</volume>: <fpage>125</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003942-Shahrezaei1"><label>12</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Shahrezaei</surname><given-names>V</given-names></name>, <name name-style="western"><surname>Ollivier</surname><given-names>JF</given-names></name>, <name name-style="western"><surname>Swain</surname><given-names>PS</given-names></name> (<year>2008</year>) <article-title>Colored extrinsic fluctuations and stochastic gene expression</article-title>. <source>Mol Syst Biol</source> <volume>4</volume>: <fpage>196</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003942-Newby1"><label>13</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Newby</surname><given-names>JM</given-names></name> (<year>2012</year>) <article-title>Isolating intrinsic noise sources in a stochastic genetic switch</article-title>. <source>Physical biology</source> <volume>9</volume>: <fpage>026002</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003942-Johnson1"><label>14</label>
<mixed-citation publication-type="other" xlink:type="simple">Johnson N, Kotz S (1977) Urn Models and Their Application. Wiley &amp; Sons, New York.</mixed-citation>
</ref>
<ref id="pcbi.1003942-Koeppl1"><label>15</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Koeppl</surname><given-names>H</given-names></name>, <name name-style="western"><surname>Zechner</surname><given-names>C</given-names></name>, <name name-style="western"><surname>Ganguly</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Pelet</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Peter</surname><given-names>M</given-names></name> (<year>2012</year>) <article-title>Accounting for extrinsic variability in the estimation of stochastic rate constants</article-title>. <source>Int J Robust Nonlin</source> <volume>22</volume>: <fpage>1103</fpage>–<lpage>1119</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003942-Rao1"><label>16</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Rao</surname><given-names>CV</given-names></name>, <name name-style="western"><surname>Arkin</surname><given-names>AP</given-names></name> (<year>2003</year>) <article-title>Stochastic chemical kinetics and the quasi-steady-state assumption: Application to the gillespie algorithm</article-title>. <source>The Journal of Chemical Physics</source> <volume>118</volume>: <fpage>4999</fpage>–<lpage>5010</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003942-Aalen1"><label>17</label>
<mixed-citation publication-type="other" xlink:type="simple">Aalen OO, Borgan, Gjessing HK (2008) Survival and event history analysis: a process point of view. Springer Verlag.</mixed-citation>
</ref>
<ref id="pcbi.1003942-Giesecke1"><label>18</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Giesecke</surname><given-names>K</given-names></name>, <name name-style="western"><surname>Kakavand</surname><given-names>H</given-names></name>, <name name-style="western"><surname>Mousavi</surname><given-names>M</given-names></name> (<year>2011</year>) <article-title>Exact simulation of point processes with stochastic intensities</article-title>. <source>Operations research</source> <volume>59</volume>: <fpage>1233</fpage>–<lpage>1245</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003942-Bain1"><label>19</label>
<mixed-citation publication-type="other" xlink:type="simple">Bain A, Crisan D (2009) Fundamentals of stochastic filtering. Springer, New York.</mixed-citation>
</ref>
<ref id="pcbi.1003942-Anderson1"><label>20</label>
<mixed-citation publication-type="other" xlink:type="simple">Anderson DF, Kurtz TG (2011) Continuous time Markov chain models for chemical reaction networks. In: Design and Analysis of Biomolecular Circuits, Springer. pp. 3–42.</mixed-citation>
</ref>
<ref id="pcbi.1003942-Snyder1"><label>21</label>
<mixed-citation publication-type="other" xlink:type="simple">Snyder DL, Miller MI (1975) Random Point Processes in Time and Space. Wiley &amp; Sons, New York.</mixed-citation>
</ref>
<ref id="pcbi.1003942-Elliott1"><label>22</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Elliott</surname><given-names>RJ</given-names></name>, <name name-style="western"><surname>Malcolm</surname><given-names>WP</given-names></name> (<year>2005</year>) <article-title>General smoothing formulas for markov-modulated poisson observations</article-title>. <source>Automatic Control, IEEE Transactions on</source> <volume>50</volume>: <fpage>1123</fpage>–<lpage>1134</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003942-Eden1"><label>23</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Eden</surname><given-names>UT</given-names></name>, <name name-style="western"><surname>Brown</surname><given-names>EN</given-names></name> (<year>2008</year>) <article-title>Continuous-time filters for state estimation from point process models of neural data</article-title>. <source>Statistica Sinica</source> <volume>18</volume>: <fpage>1293</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003942-Leijdekker1"><label>24</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Leijdekker</surname><given-names>V</given-names></name>, <name name-style="western"><surname>Spreij</surname><given-names>P</given-names></name> (<year>2011</year>) <article-title>Explicit computations for a filtering problem with point process observations with applications to credit risk</article-title>. <source>Probability in the Engineering and Informational Sciences</source> <volume>25</volume>: <fpage>393</fpage>–<lpage>418</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003942-Hespanha1"><label>25</label>
<mixed-citation publication-type="other" xlink:type="simple">Hespanha J (2008) Moment closure for biochemical networks. In: Communications, Control and Signal Processing, 2008. ISCCSP 2008. 3rd International Symposium on. IEEE, pp. 142–147.</mixed-citation>
</ref>
<ref id="pcbi.1003942-Anderson2"><label>26</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Anderson</surname><given-names>DF</given-names></name> (<year>2007</year>) <article-title>A modified next reaction method for simulating chemical systems with time dependent propensities and delays</article-title>. <source>J Chem Phys</source> <volume>127</volume>: <fpage>214107</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003942-Lewis1"><label>27</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Lewis</surname><given-names>PAW</given-names></name>, <name name-style="western"><surname>Shedler</surname><given-names>GS</given-names></name> (<year>1979</year>) <article-title>Simulation of nonhomogeneous Poisson processes by thinning</article-title>. <source>Naval Research Logistics Quarterly</source> <volume>26</volume>: <fpage>403</fpage>–<lpage>413</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003942-Montroll1"><label>28</label>
<mixed-citation publication-type="other" xlink:type="simple">Montroll EW, Weiss GH (1965) Random walks on lattices. ii. Journal of Mathematical Physics 6.</mixed-citation>
</ref>
<ref id="pcbi.1003942-Rosenfeld1"><label>29</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Rosenfeld</surname><given-names>N</given-names></name>, <name name-style="western"><surname>Young</surname><given-names>JW</given-names></name>, <name name-style="western"><surname>Alon</surname><given-names>U</given-names></name>, <name name-style="western"><surname>Swain</surname><given-names>PS</given-names></name>, <name name-style="western"><surname>Elowitz</surname><given-names>MB</given-names></name> (<year>2005</year>) <article-title>Gene regulation at the single-cell level</article-title>. <source>Science</source> <volume>307</volume>: <fpage>1962</fpage>–<lpage>1965</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003942-Volfson1"><label>30</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Volfson</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Marciniak</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Blake</surname><given-names>WJ</given-names></name>, <name name-style="western"><surname>Ostroff</surname><given-names>N</given-names></name>, <name name-style="western"><surname>Tsimring</surname><given-names>LS</given-names></name>, <etal>et al</etal>. (<year>2006</year>) <article-title>Origins of extrinsic variability in eukaryotic gene expression</article-title>. <source>Nature</source> <volume>439</volume>: <fpage>861</fpage>–<lpage>864</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003942-Zechner3"><label>31</label>
<mixed-citation publication-type="other" xlink:type="simple">Zechner C, Deb S, Koeppl H (2013) Marginal dynamics of stochastic biochemical networks in random environments. 2013 European Control Conference (ECC): 4269–4274.</mixed-citation>
</ref>
<ref id="pcbi.1003942-Kepler1"><label>32</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Kepler</surname><given-names>TB</given-names></name>, <name name-style="western"><surname>Elston</surname><given-names>TC</given-names></name> (<year>2001</year>) <article-title>Stochasticity in transcriptional regulation: origins, consequences, and mathematical representations</article-title>. <source>Biophysical journal</source> <volume>81</volume>: <fpage>3116</fpage>–<lpage>3136</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003942-Schlgl1"><label>33</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Schlögl</surname><given-names>F</given-names></name> (<year>1972</year>) <article-title>Chemical reaction models for non-equilibrium phase transitions</article-title>. <source>Zeitschrift für Physik</source> <volume>253</volume>: <fpage>147</fpage>–<lpage>161</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003942-Bowsher1"><label>34</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Bowsher</surname><given-names>CG</given-names></name>, <name name-style="western"><surname>Voliotis</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Swain</surname><given-names>PS</given-names></name> (<year>2013</year>) <article-title>The fidelity of dynamic signaling by noisy biomolecular networks</article-title>. <source>Plos Comp Biol</source> <volume>9</volume>: <fpage>e1002965</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003942-Jayanthi1"><label>35</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Jayanthi</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Nilgiriwala</surname><given-names>KS</given-names></name>, <name name-style="western"><surname>Del Vecchio</surname><given-names>D</given-names></name> (<year>2013</year>) <article-title>Retroactivity controls the temporal dynamics of gene transcription</article-title>. <source>ACS Synthetic Biology</source> <volume>2</volume>: <fpage>431</fpage>–<lpage>441</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003942-Lestas1"><label>36</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Lestas</surname><given-names>I</given-names></name>, <name name-style="western"><surname>Vinnicombe</surname><given-names>G</given-names></name>, <name name-style="western"><surname>Paulsson</surname><given-names>J</given-names></name> (<year>2010</year>) <article-title>Fundamental limits on the suppression of molecular fluctuations</article-title>. <source>Nature</source> <volume>467</volume>: <fpage>174</fpage>–<lpage>178</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003942-Munsky1"><label>37</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Munsky</surname><given-names>B</given-names></name>, <name name-style="western"><surname>Khammash</surname><given-names>M</given-names></name> (<year>2006</year>) <article-title>The finite state projection algorithm for the solution of the chemical master equation</article-title>. <source>J Chem Phys</source> <volume>124</volume>: <fpage>044104</fpage>.</mixed-citation>
</ref>
</ref-list></back>
</article>