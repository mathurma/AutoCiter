<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE article
  PUBLIC "-//NLM//DTD Journal Publishing DTD v3.0 20080202//EN" "http://dtd.nlm.nih.gov/publishing/3.0/journalpublishing3.dtd">
<article xmlns:mml="http://www.w3.org/1998/Math/MathML" xmlns:xlink="http://www.w3.org/1999/xlink" article-type="research-article" dtd-version="3.0" xml:lang="en">
<front>
<journal-meta>
<journal-id journal-id-type="publisher-id">plos</journal-id>
<journal-id journal-id-type="nlm-ta">PLoS Comput Biol</journal-id>
<journal-id journal-id-type="pmc">ploscomp</journal-id><journal-title-group>
<journal-title>PLoS Computational Biology</journal-title></journal-title-group>
<issn pub-type="ppub">1553-734X</issn>
<issn pub-type="epub">1553-7358</issn>
<publisher>
<publisher-name>Public Library of Science</publisher-name>
<publisher-loc>San Francisco, USA</publisher-loc></publisher>
</journal-meta>
<article-meta>
<article-id pub-id-type="publisher-id">PCOMPBIOL-D-13-00898</article-id>
<article-id pub-id-type="doi">10.1371/journal.pcbi.1003397</article-id>
<article-categories><subj-group subj-group-type="heading"><subject>Research Article</subject></subj-group></article-categories>
<title-group>
<article-title>Inferring the Source of Transmission with Phylogenetic Data</article-title>
<alt-title alt-title-type="running-head">Inferring the Source of Transmission</alt-title>
</title-group>
<contrib-group>
<contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Volz</surname><given-names>Erik M.</given-names></name><xref ref-type="aff" rid="aff1"><sup>1</sup></xref><xref ref-type="corresp" rid="cor1"><sup>*</sup></xref></contrib>
<contrib contrib-type="author" xlink:type="simple"><name name-style="western"><surname>Frost</surname><given-names>Simon D. W.</given-names></name><xref ref-type="aff" rid="aff2"><sup>2</sup></xref></contrib>
</contrib-group>
<aff id="aff1"><label>1</label><addr-line>Department of Infectious Disease Epidemiology, Imperial College London, London, United Kingdom</addr-line></aff>
<aff id="aff2"><label>2</label><addr-line>Department of Veterinary Medicine, University of Cambridge, Cambridge, United Kingdom</addr-line></aff>
<contrib-group>
<contrib contrib-type="editor" xlink:type="simple"><name name-style="western"><surname>Kosakovsky Pond</surname><given-names>Sergei L.</given-names></name>
<role>Editor</role>
<xref ref-type="aff" rid="edit1"/></contrib>
</contrib-group>
<aff id="edit1"><addr-line>University of California San Diego, United States of America</addr-line></aff>
<author-notes>
<corresp id="cor1">* E-mail: <email xlink:type="simple">e.volz@imperial.ac.uk</email></corresp>
<fn fn-type="conflict"><p>The authors have declared that no competing interests exist.</p></fn>
<fn fn-type="con"><p>Conceived and designed the experiments: EMV SDWF. Performed the experiments: EMV SDWF. Analyzed the data: EMV SDWF. Contributed reagents/materials/analysis tools: EMV SDWF. Wrote the paper: EMV SDWF.</p></fn>
</author-notes>
<pub-date pub-type="collection"><month>12</month><year>2013</year></pub-date>
<pub-date pub-type="epub"><day>19</day><month>12</month><year>2013</year></pub-date>
<volume>9</volume>
<issue>12</issue>
<elocation-id>e1003397</elocation-id>
<history>
<date date-type="received"><day>23</day><month>5</month><year>2013</year></date>
<date date-type="accepted"><day>1</day><month>11</month><year>2013</year></date>
</history>
<permissions>
<copyright-year>2013</copyright-year>
<copyright-holder>Volz, Frost</copyright-holder><license xlink:href="http://creativecommons.org/licenses/by/4.0/" xlink:type="simple"><license-p>This is an open-access article distributed under the terms of the <ext-link ext-link-type="uri" xlink:href="http://creativecommons.org/licenses/by/4.0/" xlink:type="simple">Creative Commons Attribution License</ext-link>, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.</license-p></license></permissions><related-article id="RA1" related-article-type="companion" ext-link-type="uri" vol="" page="e1002972" xlink:type="simple" xlink:href="info:doi/10.1371/journal.pcbi.1002972"> <article-title>New Methods Section in PLOS Computational Biology</article-title></related-article>
<abstract>
<p>Identifying the source of transmission using pathogen genetic data is complicated by numerous biological, immunological, and behavioral factors. A large source of error arises when there is incomplete or sparse sampling of cases. Unsampled cases may act as either a common source of infection or as an intermediary in a transmission chain for hosts infected with genetically similar pathogens. It is difficult to quantify the probability of common source or intermediate transmission events, which has made it difficult to develop statistical tests to either confirm or deny putative transmission pairs with genetic data. We present a method to incorporate additional information about an infectious disease epidemic, such as incidence and prevalence of infection over time, to inform estimates of the probability that one sampled host is the direct source of infection of another host in a pathogen gene genealogy. These methods enable forensic applications, such as source-case attribution, for infectious disease epidemics with incomplete sampling, which is usually the case for high-morbidity community-acquired pathogens like HIV, Influenza and Dengue virus. These methods also enable epidemiological applications such as the identification of factors that increase the risk of transmission. We demonstrate these methods in the context of the HIV epidemic in Detroit, Michigan, and we evaluate the suitability of current sequence databases for forensic and epidemiological investigations. We find that currently available sequences collected for drug resistance testing of HIV are unlikely to be useful in most forensic investigations, but are useful for identifying transmission risk factors.</p>
</abstract>
<abstract abstract-type="summary"><title>Author Summary</title>
<p>Molecular data from pathogens may be useful for identifying the source of infection and identifying pairs of individuals such that one host transmitted to the other. Inference of who acquired infection from whom is confounded by incomplete sampling, and given genetic data only, it is not possible to infer the direction of transmission in a transmission pair. Given additional information about an infectious disease epidemic, such as incidence of infection over time, and the proportion of hosts sampled, it is possible to correct for biases stemming from incomplete sampling of the infected host population. It may even be possible to infer the direction of transmission within a transmission pair if additional clinical, behavioral, and demographic covariates of the infected hosts are available. We consider the problem of identifying the source of infection using HIV sequence data collected for clinical purposes. We find that it is rarely possible to infer transmission pairs with high credibility, but such data may nevertheless be useful for epidemiological investigations and identifying risk factors for transmission.</p>
</abstract>
<funding-group><funding-statement>EMV was supported by an NIAID K01 Career Development Award (AI91440). SDWF is supported in part by a Royal Society Wolfson Research Merit Award, and by an MRC Methodology Research Programme grant (MR/J013862/1). The funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.</funding-statement></funding-group><counts><page-count count="13"/></counts></article-meta>
</front>
<body><sec id="s1">
<title/>
<disp-quote>
<p>This is a <italic>PLOS Computational Biology</italic> Methods article.</p>
</disp-quote></sec><sec id="s2">
<title>Introduction</title>
<p>Phylogenetic trees reconstructed from sequences of pathogens contain information on the past transmission dynamics that would be difficult, if not impossible, to obtain through other means. Over the past two decades, a number of approaches have been proposed to extract epidemiologically relevant information from viral phylogenies, particularly from highly variable RNA viruses such as HIV-1, hepatitis C virus, and influenza A virus <xref ref-type="bibr" rid="pcbi.1003397-Pybus1">[1]</xref>. With the advent of high-throughput sequencing, these approaches can also be applied to help understand bacterial spread <xref ref-type="bibr" rid="pcbi.1003397-Baker1">[2]</xref>.</p>
<p>Although many studies have focused on the ‘phylodynamics’ <xref ref-type="bibr" rid="pcbi.1003397-Volz1">[3]</xref>, <xref ref-type="bibr" rid="pcbi.1003397-Grenfell1">[4]</xref> of infectious disease transmission at the population level, there have been a number of studies that have focused more on the ability of molecular sequence data to inform transmission at the level of pairs or small groups of individuals. Molecular epidemiological analysis of couples with discordant HIV status have demonstrated that infection of the initially uninfected partner may often be from a third party <xref ref-type="bibr" rid="pcbi.1003397-Eshleman1">[5]</xref>. Sequence data have also been used in a forensic setting <xref ref-type="bibr" rid="pcbi.1003397-Schutzer1">[6]</xref>, <xref ref-type="bibr" rid="pcbi.1003397-Scaduto1">[7]</xref>, most famously in the Florida dentist case <xref ref-type="bibr" rid="pcbi.1003397-Ou1">[8]</xref>. Identifying the source of infection from genetic data is known to be confounded by many sources of error. The similarity of pathogen sequence data collected from a transmission pair depends, among other factors, on the time since transmission, immunological pressure on the pathogen, the substitution rate of the pathogen within host, and how the substitution rate changes over time within hosts. Provided a realistic model of how pathogen sequences diverge over time, it is possible to calculate the probability that the consensus sequence in a recipient of infection diverged in a given span of time from a putative source of infection <xref ref-type="bibr" rid="pcbi.1003397-Velsko1">[9]</xref>–<xref ref-type="bibr" rid="pcbi.1003397-Jombart1">[11]</xref>.</p>
<p>Recently, there has been rapid development of methods to identify transmission sources under the assumption of complete sampling, i.e. under the assumption that every infected individual is represented in the phylogeny. These methods have yielded many valuable insights into the spread of nosocomial infections <xref ref-type="bibr" rid="pcbi.1003397-Snitkin1">[12]</xref>, Mycobacterium tuberculosis <xref ref-type="bibr" rid="pcbi.1003397-Gardy1">[13]</xref>, foot-and-mouth disease virus, and avian influenza between farms <xref ref-type="bibr" rid="pcbi.1003397-Ypma2">[14]</xref>. Nevertheless, for many human pathogens, incomplete sampling is the rule. In the case of HIV, sequencing of the <italic>pol</italic> gene is now routine in many countries for surveillance of drug resistance, but even so, sample coverage is far from complete.</p>
<p><xref ref-type="fig" rid="pcbi-1003397-g001">Figure 1</xref> illustrates errors that can be introduced by incomplete sampling. For example, it is possible that two hosts with genetically similar virus were both infected by a common source who was not sampled. Therefore, calculation of the probability that <italic>i</italic> infected <italic>j</italic> should account for the possibility that an unobserved individual <italic>k</italic> infected both <italic>i</italic> and <italic>j</italic> (second panel). Similarly, it is possible that <italic>i</italic> infected an unsampled individual <italic>k</italic> who went on to infect <italic>j</italic>. Due to the uncertainty stemming from incomplete sampling, viral sequence data have often been used as a test to disconfirm a putative transmission pair. For example, in the context of HIV, a phylogeny estimated from a pair of sequences in a putative transmission pair, along with a set of sequences from a suitable background population (e.g. infected individuals with a matching geographic and risk-behavior profile), can be used to detect if the putative donor is relatively distant in evolutionary terms from the recipient <xref ref-type="bibr" rid="pcbi.1003397-Metzker1">[15]</xref>. If the putative donor is not monophyletic with the recipient, it is less likely that the putative donor is the true source of infection. However, even if the donor and recipient sequences are not monophyletic, there are scenarios where the putative transmission pair is genuine. For example, it is possible that the putative donor is a common source of infection for all sampled cases in the donor-recipient clade. This is illustrated in <xref ref-type="fig" rid="pcbi-1003397-g001">Figure 1</xref>, in which donor <italic>i</italic> infects both <italic>j</italic> and <italic>k</italic>, yielding a polyphylous relationship between <italic>i</italic> and <italic>j</italic>. As it is impossible to rule out the possibility that an unsampled individual or unobserved chain of transmissions connects a putative donor and recipient, it has been impossible to properly define the statistical power of tests for confirming or disconfirming transmission pairs from phylogenetic data.</p>
<fig id="pcbi-1003397-g001" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003397.g001</object-id><label>Figure 1</label><caption>
<title>Four transmission trees between hosts <italic>i</italic>, <italic>j</italic> and <italic>k</italic> are shown (center) that are consistent with the pathogen gene genealogy (left).</title>
<p>If the host <italic>k</italic> is not sampled, the resulting gene genealogy is shown at right. Transmission trees where <italic>i</italic> directly interacts with <italic>j</italic> are highlighted. The unsampled unit <italic>k</italic> may act as either a common source of infection for <italic>i</italic> and <italic>j</italic> or a an intermediate infection between <italic>i</italic> and <italic>j</italic>.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003397.g001" position="float" xlink:type="simple"/></fig>
<p>Due to the problems involved in incomplete sampling, relatively little work has been performed to identify potential sources of infection - i.e. understanding transmission at an individual level - using population-level datasets collected for clinical or surveillance purposes. A notable exception is a study of HIV-positive men who have sex with men (MSM) in Brighton, UK <xref ref-type="bibr" rid="pcbi.1003397-Fisher1">[16]</xref>, which, through a combination of diagnosis times and sequence data, attempted to identify the source of transmission for 159 cases of recent HIV infection. A single most likely transmission source was inferred in only 41 (26%) cases, and the potential for a transmission source outside of the study population was not quantified. Nevertheless, biologically plausible associations between younger age, higher viral load, recent HIV infection, and a recent sexually transmitted infection were found with the probability of being identified as a source of infection.</p>
<p>In the case of incomplete sampling, calculating the probability that a putative transmission pair is real is equivalent to calculating the probability that there are zero unsampled intermediaries between the pair in the viral phylogeny. Calculating this probability is complex, but possible, provided a realistic model of the epidemic process and given good data about incidence and prevalence of infection. This paper is concerned with calculating the probability, henceforth called the <italic>infector probability</italic>, that a given host is the source of infection for another host from phylogenetic and epidemiological surveillance data. The main contribution of this manuscript is the development of a theoretical framework which realistically accounts for the epidemiological and sampling process, thereby correcting for error due to incomplete sampling. This theory also allows for the possibility that the infected population is heterogeneous, such that some individuals have a higher intrinsic infectiousness than others. This is accomplished by the incorporation of patient-level covariates (behavior, stage of infection etc.) into the calculation of infector probabilities.</p>
<p>To demonstrate the utility of infector probabilities to the analysis of real epidemic data, we have simulated a dataset based on the real HIV epidemic among MSM in Detroit, Michigan. Through a simulation-based analysis, we use our solution of the infector probabilities to address the following questions:</p>
<list list-type="bullet"><list-item>
<p>Is it possible to infer transmission events from HIV phylogenetic data with high accuracy?</p>
</list-item><list-item>
<p>Are widely available HIV sequence data collected for drug resistance testing useful for forensic investigations of who infected whom?</p>
</list-item><list-item>
<p>Are estimated infector probabilities useful for epidemiological investigations? Can our methods detect increased transmission rates during early/acute HIV infection (EHI) or other variables that determine heterogeneity in transmission rates?</p>
</list-item></list>
</sec><sec id="s3" sec-type="materials|methods">
<title>Materials and Methods</title>
<p>This section is focused on the derivation of a <italic>n</italic>×<italic>n</italic> matrix of infector probabilities <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e001" xlink:type="simple"/></inline-formula> (<xref ref-type="disp-formula" rid="pcbi.1003397.e148">equation 17</xref>) which is a function of</p>
<list list-type="bullet"><list-item>
<p><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e002" xlink:type="simple"/></inline-formula>, a binary genealogy with branch lengths in units of calendar time, and</p>
</list-item><list-item>
<p><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e003" xlink:type="simple"/></inline-formula>, a process model which provides a timeseries of incidence (<italic>F</italic>), state transitions (<italic>G</italic>) and prevalence (<italic>Y</italic>), and</p>
</list-item><list-item>
<p><italic>X</italic>, a <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e004" xlink:type="simple"/></inline-formula>vector that describes the state of each sample unit.</p>
</list-item></list>
<p>Our solutions employ a population genetic model that assumes that the population size is large, so the model may be biased for very small epidemics or outbreaks. In reality, all of the inputs into our solution of <italic>W</italic> would need to be estimated from real data, which increases uncertainty when identifying transmission pairs. The process model may optionally describe the dynamics of a structured population (a compartmental model), such that each infected individual occupies one of <italic>m</italic> discrete categories. In this situation, <italic>Y</italic>(<italic>t</italic>) is a <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e005" xlink:type="simple"/></inline-formula>vector valued function of time, and <italic>F</italic>(<italic>t</italic>) and <italic>G</italic>(<italic>t</italic>) are <italic>m</italic>×<italic>m</italic>-matrix valued functions of time. In structured models, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e006" xlink:type="simple"/></inline-formula> will denote the state (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e007" xlink:type="simple"/></inline-formula>) of each sample unit at the time of sampling. Almost all continuous-time compartmental infectious disease models with a discrete state space can be decomposed into the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e008" xlink:type="simple"/></inline-formula> processes <xref ref-type="bibr" rid="pcbi.1003397-Volz2">[17]</xref>. An explicit example of such a decomposition for a realistic HIV model is provided in the <xref ref-type="sec" rid="s3">Materials and Methods</xref>.</p>
<p>Our approach makes use of coalescent theory, which is based on the retrospective modelling of gene tree structure <xref ref-type="bibr" rid="pcbi.1003397-Wakeley1">[18]</xref>. The state of the tree will be described at a retrospective time <italic>s</italic>, which proceeds from the present to the past. Solving for the state of the tree is accomplished by conditioning on the state of the tree at the tips and working backwards towards the root. An approximation made by the coalesecent model is that the population size <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e009" xlink:type="simple"/></inline-formula> is large, such that the states of lineages in the tree can be assumed to be independent <xref ref-type="bibr" rid="pcbi.1003397-Volz2">[17]</xref>. We assume that hosts <italic>i</italic> and <italic>j</italic> are randomly sampled, or sampling may be stratified according to a categorical variable. We assume that the the phylogeny is reconstructed from a set of sequences that are one-to-one with the set of hosts, i.e. each host is sampled exactly once and has one corresponding pathogen sequence in the phylogeny. Additionally, we will assume that the time of sampling is known for each host, that branch lengths in the phylogeny are proportional to calendar time, and that the tree is bifurcating i.e. that there are no polytomies. For a sample of <italic>n</italic> hosts, our goal is to arrive at an <italic>n</italic>×<italic>n</italic> matrix which gives the probability that a host in the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e010" xlink:type="simple"/></inline-formula>th row transmitted to a host in the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e011" xlink:type="simple"/></inline-formula>th column. We also employ the same population-genetic assumptions as employed in <xref ref-type="bibr" rid="pcbi.1003397-Volz2">[17]</xref>: 1. Every node in the tree corresponds to a transmission from an infected host to a susceptible host. 2. Each lineage at a single time point corresponds to a single infected host. The first condition is appropriate if viral lineages coalesce very rapidly within hosts relative to their rate of dispersal between hosts. The second condition is appropriate if dual infection is rare (hosts can be infected with at most one lineage at a time). Simulation studies have examined the suitability of these assumptions for HIV <xref ref-type="bibr" rid="pcbi.1003397-Volz3">[19]</xref>. Note that the second condition does not preclude a lineage from passing through multiple unsampled hosts. If sampling is heterochronous (samples occur at multiple time points), we invoke a third assumption: If a lineage is sampled, it does not have descendents which are also sampled. If sampling of direct descendents is allowed, condition (1) would be violated, since a node in the genealogy would correspond to the time of sampling of the ancestral lineage, not a transmission event.</p>
<sec id="s3a">
<title>Infector probabilities in a homogenous population at endemic equilibrium</title>
<p>To give intuition for the method, we first illustrate a simple example of an epidemic within a homogeneous population. The variable <italic>s</italic> will denote time on a reverse axis (time before the last sample is taken), while <italic>t</italic> will represent time on a forward axis (time since some point in the past).</p>
<p>We calculate the probability that host <italic>i</italic> infected host <italic>j</italic> under the conditions that sampling occurs at a single timepoint, and that there is a single type of infected host. We assume that <italic>i</italic> and <italic>j</italic> form a ‘cherry’ (a clade of size 2), and that both the population and sample sizes are sufficiently large such that we can approximate the dynamics of the number of infected individuals in the population, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e012" xlink:type="simple"/></inline-formula>, and the number of lineages in the sample, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e013" xlink:type="simple"/></inline-formula>, using differential equations. At time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e014" xlink:type="simple"/></inline-formula>, we have <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e015" xlink:type="simple"/></inline-formula> lineages equal to the number of hosts sampled. All of these assumptions will be relaxed in subsequent sections.</p>
<p>What is the probability that <italic>i</italic> transmitted to <italic>j</italic> at their most recent common ancestor, which occurs at time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e016" xlink:type="simple"/></inline-formula>? A necessary condition for this to occur is that the viral lineage at <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e017" xlink:type="simple"/></inline-formula> corresponds to virus circulating in host <italic>i</italic>. This condition will not be satisfied if an unsampled individual <italic>k</italic> transmits to <italic>i</italic> before (retrospectively) <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e018" xlink:type="simple"/></inline-formula>, in which case <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e019" xlink:type="simple"/></inline-formula> will correspond to a transmission event involving <italic>k</italic>. The rate at which an unsampled host <italic>k</italic> infects <italic>i</italic> at time <italic>s</italic>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e020" xlink:type="simple"/></inline-formula> is<disp-formula id="pcbi.1003397.e021"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003397.e021" xlink:type="simple"/><label>(1)</label></disp-formula>This can be understood as the product of a rate and two probabilities:</p>
<list list-type="bullet"><list-item>
<p><italic>f</italic> is the rate of new infections in the population.</p>
</list-item><list-item>
<p><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e022" xlink:type="simple"/></inline-formula> is the probability that <italic>i</italic> is infected given that a transmission occurs. This is a consequence of the homogeneity assumption, so that every individual has equal chance of being the recipient of a new infection.</p>
</list-item><list-item>
<p><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e023" xlink:type="simple"/></inline-formula> is the proportion of infected individuals that do not correspond to lineages within the tree. This is also the probability that the host that transmits infection is not represented by a lineage in the tree.</p>
</list-item></list>
<p>When an unsampled individual <italic>k</italic> transmits to <italic>i</italic>, the viral lineage “jumps” to <italic>k</italic> (recalling that we are considering time from the present to the past). We can therefore count the number of unique infected individuals along the branch that begins at <italic>i</italic> and terminates at <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e024" xlink:type="simple"/></inline-formula>. We will denote this random variable <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e025" xlink:type="simple"/></inline-formula>, which is given by the following expression:<disp-formula id="pcbi.1003397.e026"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003397.e026" xlink:type="simple"/><label>(2)</label></disp-formula>Note that one is added to account for the host <italic>i</italic> itself. We can also calculate the probability of there being no jumps.<disp-formula id="pcbi.1003397.e027"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003397.e027" xlink:type="simple"/><label>(3)</label></disp-formula>For <italic>i</italic> to transmit to <italic>j</italic>, we must have <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e028" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e029" xlink:type="simple"/></inline-formula>. This occurs with probability <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e030" xlink:type="simple"/></inline-formula>. Finally, as infected individuals are homogeneous and sampled at the same time, the probability that <italic>i</italic> transmits to <italic>j</italic> as opposed to <italic>j</italic> transmitting to <italic>i</italic> is 1/2. Hence, the probability that <italic>i</italic> infected <italic>j</italic> at time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e031" xlink:type="simple"/></inline-formula> is<disp-formula id="pcbi.1003397.e032"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003397.e032" xlink:type="simple"/><label>(4)</label></disp-formula>where <italic>W</italic> denotes the matrix of infector probabilities.</p>
<p>To demonstrate how sampling plays a central role in determining the extent to which cherries represent direct transmissions, we will consider a large sample size, such that we can model the number of cherries as well as the number of cherries that correspond to direct transmissions as ordinary differential equations. Previously <xref ref-type="bibr" rid="pcbi.1003397-Frost1">[20]</xref>, we have shown that the cumulative number of cherries in a tree at height <italic>s</italic>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e033" xlink:type="simple"/></inline-formula> can be written in terms of the rate of coalescence between the leaves of a tree. Let <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e034" xlink:type="simple"/></inline-formula> be the number of extant terminal branches of the tree at retrospective time <italic>s</italic> (that is, uncoalesced lineages). We have<disp-formula id="pcbi.1003397.e035"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003397.e035" xlink:type="simple"/><label>(5)</label></disp-formula>These equations may be understood as the product of a rate (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e036" xlink:type="simple"/></inline-formula>) and two probabilities which describe the combination of two lineages at a coalescent event. For example, with probability <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e037" xlink:type="simple"/></inline-formula>, a terminal branch will be involved in a transmission event, and with probability <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e038" xlink:type="simple"/></inline-formula> an ancestral lineage will also be involved in the transmission event such that a coalescent will occur. With probability <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e039" xlink:type="simple"/></inline-formula>, two terminal branches will be involved in a transmission event, and a cherry will form. The total number of cherries in a tree can be calculated by solving for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e040" xlink:type="simple"/></inline-formula> at <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e041" xlink:type="simple"/></inline-formula>, the time of the most recent common ancestor of the sampled sequences.</p>
<p>To determine the number of cherries that represent direct transmission, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e042" xlink:type="simple"/></inline-formula>, we first derive an equation for the number of leaves of a tree along which no transmissions from an unsampled individual have occurred, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e043" xlink:type="simple"/></inline-formula>, which decreases as a consequence of transmission from others in the sample (as for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e044" xlink:type="simple"/></inline-formula>) as well as transmission from unsampled individuals:<disp-formula id="pcbi.1003397.e045"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003397.e045" xlink:type="simple"/><label>(6)</label></disp-formula>These equations are derived as above, but include an additional hazard <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e046" xlink:type="simple"/></inline-formula> for an unsampled host transmitting to one of the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e047" xlink:type="simple"/></inline-formula> external lineages.</p>
<p>Some analytical insights into how different parameters affect the proportion of cherries that are associated with direct transmission can be obtained under the assumption that the number of infected hosts, <italic>Y</italic>, and the incidence of infection, <italic>f</italic>, are constant, i.e. when the system is at equilibrium, and we drop the time index for these variables. If we define the constant <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e048" xlink:type="simple"/></inline-formula>, then following <xref ref-type="bibr" rid="pcbi.1003397-Frost1">[20]</xref>, the number of lineages over time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e049" xlink:type="simple"/></inline-formula>, which is a deterministic approximation to the rate of coalescence in a coalescent model of fixed size, and the time to the most recent common ancestor <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e050" xlink:type="simple"/></inline-formula>, which is obtained by the solution of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e051" xlink:type="simple"/></inline-formula>. We substitute this expression for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e052" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e053" xlink:type="simple"/></inline-formula> into the equation for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e054" xlink:type="simple"/></inline-formula> to give the following.<disp-formula id="pcbi.1003397.e055"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003397.e055" xlink:type="simple"/><label>(7)</label></disp-formula></p>
<p>This can be solved using separation of variables, with the constant of integration calculating by the initial condition <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e056" xlink:type="simple"/></inline-formula>.<disp-formula id="pcbi.1003397.e057"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003397.e057" xlink:type="simple"/><label>(8)</label></disp-formula></p>
<p>Substituting this solution of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e058" xlink:type="simple"/></inline-formula> into the differential equation for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e059" xlink:type="simple"/></inline-formula> gives the following.<disp-formula id="pcbi.1003397.e060"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003397.e060" xlink:type="simple"/><label>(9)</label></disp-formula></p>
<p>Solving the above for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e061" xlink:type="simple"/></inline-formula> is made more simple using integration by substitution with <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e062" xlink:type="simple"/></inline-formula> (i.e. changing the timescale), such that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e063" xlink:type="simple"/></inline-formula>, and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e064" xlink:type="simple"/></inline-formula>.<disp-formula id="pcbi.1003397.e065"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003397.e065" xlink:type="simple"/><label>(10)</label></disp-formula></p>
<p>The solution for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e066" xlink:type="simple"/></inline-formula>, the total number of cherries that represent direct transmission, is found by integrating from <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e067" xlink:type="simple"/></inline-formula> to <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e068" xlink:type="simple"/></inline-formula> (for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e069" xlink:type="simple"/></inline-formula>). The term <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e070" xlink:type="simple"/></inline-formula> is a constant, and integration of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e071" xlink:type="simple"/></inline-formula> results in an exponential integral term, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e072" xlink:type="simple"/></inline-formula>, where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e073" xlink:type="simple"/></inline-formula> is the upper incomplete gamma function.<disp-formula id="pcbi.1003397.e074"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003397.e074" xlink:type="simple"/><label>(11)</label></disp-formula>The approximation is for large <italic>Y</italic>, such that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e075" xlink:type="simple"/></inline-formula>.</p>
<p>Similarly, at equilibrium we can substitute <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e076" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e077" xlink:type="simple"/></inline-formula> into <xref ref-type="disp-formula" rid="pcbi.1003397.e027">equation 3</xref>, which yields <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e078" xlink:type="simple"/></inline-formula>. If we know the height of the cherry, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e079" xlink:type="simple"/></inline-formula>, then at equilibrium, the probability that <italic>i</italic> and <italic>j</italic> are a transmission pair is approximately<disp-formula id="pcbi.1003397.e080"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003397.e080" xlink:type="simple"/><label>(12)</label></disp-formula></p>
<p>These results demonstrate that at equilibrium, the fraction of sequences in cherries is independent of sampling fraction (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e081" xlink:type="simple"/></inline-formula>), while the proportion of sequences in cherries that represent a direct transmission is a function of the ratio of the number of infected in the population to the number of infected in the sample. Note that even when <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e082" xlink:type="simple"/></inline-formula>, i.e. all individuals have been sampled, not all cherries represent direct transmissions (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e083" xlink:type="simple"/></inline-formula>). In addition, for more realistic sample fractions, the number of cherries that represent direct transmissions is extremely low; for example, if <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e084" xlink:type="simple"/></inline-formula>, then <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e085" xlink:type="simple"/></inline-formula>.</p>
<p>The very simple expressions in <xref ref-type="disp-formula" rid="pcbi.1003397.e032">equation 4</xref> and <xref ref-type="disp-formula" rid="pcbi.1003397.e080">12</xref> are obtained after applying numerous simplifying assumptions: <italic>i</italic> and <italic>j</italic> are sampled at the same time, <italic>i</italic> and <italic>j</italic> are monophyletic, and the epidemic is at equilibrium (<italic>Y</italic> and <italic>f</italic> are constant). In the next section, we proceed to relax all of these assumptions. Nevertheless, <xref ref-type="disp-formula" rid="pcbi.1003397.e032">equation 4</xref> may be a good approximation in some situations when <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e086" xlink:type="simple"/></inline-formula> is close to the time of sampling and if incidence and prevalence is relatively constant between <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e087" xlink:type="simple"/></inline-formula> and the time of sampling.</p>
</sec><sec id="s3b">
<title>General framework for derivation of infector probabilities</title>
<p>The solutions described below are applicable to a large class of infectious disease process models which describe the incidence and prevalence of infection over time. The host population is not assumed to be homogeneous, but can have arbitrary discrete structure. Each infected host can occupy any of <italic>m</italic> states (a compartmental model), and an infected host cannot transmit to more than one susceptible at a single point in time.</p>
<p>The discrete states that a host may occupy will be indexed by variables <italic>k</italic> and <italic>l</italic>. Under these conditions, the model can be decomposed into the following processes (see <xref ref-type="bibr" rid="pcbi.1003397-Volz2">[17]</xref> for details):</p>
<list list-type="bullet"><list-item>
<p><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e088" xlink:type="simple"/></inline-formula>: <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e089" xlink:type="simple"/></inline-formula>vector valued function of time which describes the number of infected hosts at time <italic>t</italic>.</p>
</list-item><list-item>
<p><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e090" xlink:type="simple"/></inline-formula>: <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e091" xlink:type="simple"/></inline-formula>matrix valued function of time which describes the rate of transmission from each state to each other state. <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e092" xlink:type="simple"/></inline-formula> describes the rate that all infected hosts in state <italic>k</italic> generate new infections in state <italic>l</italic>. This does not imply that the transmitting individuals move to state <italic>l</italic>; transmission may occur across categories, for example, men infecting women. This will also be called the <italic>birth</italic> matrix.</p>
</list-item><list-item>
<p><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e093" xlink:type="simple"/></inline-formula>: <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e094" xlink:type="simple"/></inline-formula>matrix valued function of time which describes the rate of transition from each state to each other state. Several examples of processes that would be included in <italic>G</italic> are: progression through discrete stages of infection, diagnosis, discrete changes in risk behavior, and geographical migration. This will be called the <italic>migration</italic> matrix.</p>
</list-item></list>
<p>The process model will be denoted by the tuple <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e095" xlink:type="simple"/></inline-formula>. An explicit example of decomposition of a model into <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e096" xlink:type="simple"/></inline-formula> is given for an HIV model below.</p>
<p>In <xref ref-type="bibr" rid="pcbi.1003397-Volz2">[17]</xref>, master-equations were developed for computing many attributes of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e097" xlink:type="simple"/></inline-formula> conditional on <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e098" xlink:type="simple"/></inline-formula>, such as the likelihood. This approach can, for example, be used to fit models to phylogenetic data. A similar approach is taken here, and we will re-use notation where possible. The primary aim is to derive <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e099" xlink:type="simple"/></inline-formula>, the probability that a host <italic>i</italic> directly transmitted infection to host <italic>j</italic> based on phylogenetic data (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e100" xlink:type="simple"/></inline-formula>). The master equations will describe the dynamics on a reverse time axis. In common with other coalescent models, our solutions will work by integration from the present to the past along the reverse time axis <italic>s</italic>. The variables <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e101" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e102" xlink:type="simple"/></inline-formula> will denote the times of sampling of host <italic>i</italic>, and the initial conditions will be based on the states of hosts at these times.</p>
<p>The coalescent model described here is complex, so a visual aid is provided in <xref ref-type="fig" rid="pcbi-1003397-g002">Figure 2</xref>. A useful way to conceptualize the organization of this model is to visualize every branch in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e103" xlink:type="simple"/></inline-formula> as having a set of dynamic variables associated with it for every tip of the tree descended from it. Every node will have associated with it the probabilities <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e104" xlink:type="simple"/></inline-formula> for every pair of sampled hosts <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e105" xlink:type="simple"/></inline-formula> descended from it.</p>
<fig id="pcbi-1003397-g002" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003397.g002</object-id><label>Figure 2</label><caption>
<title>A schematic of a gene tree with variables of the coalescent model corresponding to tips, branches, and nodes of the tree.</title>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003397.g002" position="float" xlink:type="simple"/></fig>
<p>At some point in the past, every sampled host <italic>i</italic> has an ancestral host; in other words, the ancestral host harbors virus which is ancestral to the virus that is sampled from host <italic>i</italic> at <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e106" xlink:type="simple"/></inline-formula>. We will denote the ancestral host of <italic>i</italic> as <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e107" xlink:type="simple"/></inline-formula>. Note that we may have <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e108" xlink:type="simple"/></inline-formula> if <italic>i</italic> became infected at a retrospective time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e109" xlink:type="simple"/></inline-formula>, in which case the ancestral branch of <italic>i</italic> in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e110" xlink:type="simple"/></inline-formula> at time <italic>s</italic> corresponds to the host <italic>i</italic> itself. The variable <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e111" xlink:type="simple"/></inline-formula> will denote the probability of this event. <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e112" xlink:type="simple"/></inline-formula> will denote the time of most recent common ancestry for virus sampled from hosts <italic>i</italic> and <italic>j</italic>. <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e113" xlink:type="simple"/></inline-formula> will denote the probability that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e114" xlink:type="simple"/></inline-formula> is in state <italic>k</italic>. The master equations describing evolution of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e115" xlink:type="simple"/></inline-formula> were derived in <xref ref-type="bibr" rid="pcbi.1003397-Volz2">[17]</xref>. Here, we introduce a similar variable <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e116" xlink:type="simple"/></inline-formula>, which is the probability that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e117" xlink:type="simple"/></inline-formula> is in state <italic>k</italic> conditional on <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e118" xlink:type="simple"/></inline-formula>.</p>
<p>Derivations of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e119" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e120" xlink:type="simple"/></inline-formula> are provided in subsequent sections. Here, we show how <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e121" xlink:type="simple"/></inline-formula> is calculated when <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e122" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e123" xlink:type="simple"/></inline-formula> are known.</p>
<p>Consider the node in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e124" xlink:type="simple"/></inline-formula> corresponding to the MRCA of <italic>i</italic> and <italic>j</italic> at time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e125" xlink:type="simple"/></inline-formula>. In order for <italic>i</italic> to transmit to <italic>j</italic>, we must have <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e126" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e127" xlink:type="simple"/></inline-formula>, i.e. both daughter lineages of the node correspond to hosts <italic>i</italic> and <italic>j</italic>. The probability of this event is <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e128" xlink:type="simple"/></inline-formula>, since events are assumed to be independent. That is a good approximation when <italic>Y</italic> is large. At <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e129" xlink:type="simple"/></inline-formula>, the states of host <italic>i</italic> and <italic>j</italic> are described by the vectors <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e130" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e131" xlink:type="simple"/></inline-formula>.</p>
<p>Suppose that at <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e132" xlink:type="simple"/></inline-formula> a type <italic>k</italic> host transmits to a type <italic>l</italic> host, which occurs at rate <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e133" xlink:type="simple"/></inline-formula>. The probability that host <italic>i</italic> is the transmitter conditional on <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e134" xlink:type="simple"/></inline-formula> is <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e135" xlink:type="simple"/></inline-formula>, i.e. the probability that <italic>i</italic> is selected from the <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e136" xlink:type="simple"/></inline-formula> infections of type <italic>k</italic> and the probability that <italic>i</italic> is type <italic>k</italic>. Similarly, the probability that <italic>j</italic> is the recipient of infection conditional on <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e137" xlink:type="simple"/></inline-formula> is <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e138" xlink:type="simple"/></inline-formula>, i.e. the probability that <italic>j</italic> is selected from <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e139" xlink:type="simple"/></inline-formula> infections of type <italic>l</italic> and the probability that <italic>j</italic> is type <italic>l</italic>. Considering all possible types of transmission <italic>k</italic> and <italic>l</italic>, the rate that <italic>i</italic> transmits to <italic>j</italic> is as follows.<disp-formula id="pcbi.1003397.e140"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003397.e140" xlink:type="simple"/><label>(13)</label></disp-formula>This can be written with greater economy using matrix notation.<disp-formula id="pcbi.1003397.e141"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003397.e141" xlink:type="simple"/><label>(14)</label></disp-formula>where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e142" xlink:type="simple"/></inline-formula> is an <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e143" xlink:type="simple"/></inline-formula>vector with elements <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e144" xlink:type="simple"/></inline-formula>. Similarly, the rate that <italic>j</italic> transmits to <italic>i</italic> is as follows.<disp-formula id="pcbi.1003397.e145"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003397.e145" xlink:type="simple"/><label>(15)</label></disp-formula>If both daughter lines correspond to <italic>i</italic> and <italic>j</italic>, a transmission must have taken place between them. The probability <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e146" xlink:type="simple"/></inline-formula> is obtained by taking the ratio of the rate that <italic>i</italic> transmits to <italic>j</italic> to the rate that transmission occurs in either direction.<disp-formula id="pcbi.1003397.e147"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003397.e147" xlink:type="simple"/><label>(16)</label></disp-formula><disp-formula id="pcbi.1003397.e148"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003397.e148" xlink:type="simple"/><label>(17)</label></disp-formula></p>
</sec><sec id="s3c">
<title>Derivations of master equations for <italic>ψ</italic> and <italic>ρ</italic></title>
<p>The function <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e149" xlink:type="simple"/></inline-formula> describes the probability that the ancestral host of the sampled host <italic>i</italic> is in state <italic>k</italic> at retrospective time <italic>s</italic>. Equations for the dynamics of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e150" xlink:type="simple"/></inline-formula> are derived in <xref ref-type="bibr" rid="pcbi.1003397-Volz2">[17]</xref>. Here, we derive similar equations for <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e151" xlink:type="simple"/></inline-formula>, which describes the probability that the ancestral host of <italic>i</italic> is type <italic>k</italic> at time <italic>s</italic> conditional on <italic>i</italic> being the ancestral host; in other words, the branch in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e152" xlink:type="simple"/></inline-formula> that is ancestral to <italic>i</italic> at time <italic>s</italic> corresponds to the host <italic>i</italic> itself (<inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e153" xlink:type="simple"/></inline-formula>). It is assumed that at each time of sampling <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e154" xlink:type="simple"/></inline-formula> we know the state of <italic>i</italic>; this information provides the initial conditions for the set of equations that describes the dynamics of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e155" xlink:type="simple"/></inline-formula>.</p>
<p>Suppose that at retrospective time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e156" xlink:type="simple"/></inline-formula>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e157" xlink:type="simple"/></inline-formula> and <italic>i</italic> is in state <italic>k</italic>. In a small time step <italic>h</italic>, approximately <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e158" xlink:type="simple"/></inline-formula> infected hosts will migrate from state <italic>l</italic> to state <italic>k</italic>. Then retrospectively, the probability that host <italic>i</italic> will change state from <italic>k</italic> to <italic>l</italic> is approximately <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e159" xlink:type="simple"/></inline-formula>, where the factor of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e160" xlink:type="simple"/></inline-formula> is the probability of selecting <italic>i</italic> if drawing a single individual from <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e161" xlink:type="simple"/></inline-formula> infected hosts. Considering the limit <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e162" xlink:type="simple"/></inline-formula>, this leads to the following equations.<disp-formula id="pcbi.1003397.e163"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003397.e163" xlink:type="simple"/><label>(18)</label></disp-formula></p>
<p>In matrix notation, the derivative of the vector <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e164" xlink:type="simple"/></inline-formula> can be expressed as<disp-formula id="pcbi.1003397.e165"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003397.e165" xlink:type="simple"/><label>(19)</label></disp-formula>where <italic>B</italic> is a <italic>m</italic>×<italic>m</italic> matrix with elements:<disp-formula id="pcbi.1003397.e166"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003397.e166" xlink:type="simple"/><label>(20)</label></disp-formula></p>
<p>Suppose that at a time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e167" xlink:type="simple"/></inline-formula>, there is a node in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e168" xlink:type="simple"/></inline-formula> at the branch that is ancestral to <italic>i</italic>. At a node, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e169" xlink:type="simple"/></inline-formula> undergoes a discrete change as we incorporate information about the state of the other daughter branch at the node. Let <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e170" xlink:type="simple"/></inline-formula> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e171" xlink:type="simple"/></inline-formula> represent the two state vectors for two daughter branches of the node at the MRCA of <italic>i</italic> and <italic>j</italic>, which occurs at retrospective time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e172" xlink:type="simple"/></inline-formula>. Note that we will use the state vector <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e173" xlink:type="simple"/></inline-formula> for the ancestral host of <italic>j</italic>, since we are not conditioning on the event that <italic>j</italic> corresponds to a daughter branch at <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e174" xlink:type="simple"/></inline-formula>. Under the assumptions of this model, a transmission event occurs at this node, either from <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e175" xlink:type="simple"/></inline-formula> to <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e176" xlink:type="simple"/></inline-formula> or vice versa. The discrete change at <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e177" xlink:type="simple"/></inline-formula> will occur after an infinitesimal time <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e178" xlink:type="simple"/></inline-formula>. In order for the event <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e179" xlink:type="simple"/></inline-formula> to occur, <italic>i</italic> must be the transmitter at the node. Hence, the probability <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e180" xlink:type="simple"/></inline-formula> is simply the probability that the transmission is made by a type <italic>k</italic> conditional on <italic>i</italic> being the transmitter. This is<disp-formula id="pcbi.1003397.e181"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003397.e181" xlink:type="simple"/><label>(21)</label></disp-formula><inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e182" xlink:type="simple"/></inline-formula> is the probability that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e183" xlink:type="simple"/></inline-formula>. Equations governing <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e184" xlink:type="simple"/></inline-formula> are found by considering the hazard of an ‘invisible transmission event’ <xref ref-type="bibr" rid="pcbi.1003397-Frost1">[20]</xref>, <xref ref-type="bibr" rid="pcbi.1003397-Volz4">[21]</xref>, which changes the ancestral host of a branch in the phylogeny without producing a coalescent event. Equations for <italic>ψ<sub>i</sub></italic> will have a continuous component for branches and a discrete component for nodes.</p>
<p>Suppose that at retrospective time <italic>s</italic>, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e185" xlink:type="simple"/></inline-formula> and <italic>i</italic> is in state <italic>k</italic>. <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e186" xlink:type="simple"/></inline-formula> will denote the number of ancestors of the sample at retrospective time <italic>s</italic> that are in state <italic>k</italic>. Following the approach taken in <xref ref-type="bibr" rid="pcbi.1003397-Volz2">[17]</xref>, the rate that a transmission <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e187" xlink:type="simple"/></inline-formula> leads to a change of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e188" xlink:type="simple"/></inline-formula> is<disp-formula id="pcbi.1003397.e189"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003397.e189" xlink:type="simple"/></disp-formula>This is the product of the rate of transmissions <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e190" xlink:type="simple"/></inline-formula>, the probability 1/<italic>Y<sub>k</sub></italic> that <italic>i</italic> is selected as the recipient of transmission, and the expression <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e191" xlink:type="simple"/></inline-formula>, which is the probability that the transmitter is not ancestral to the sample (i.e. that no branch in the tree corresponds to the transmitting host).</p>
<p>This motivates the following equation for the derivative of <italic>ψ<sub>i</sub></italic>:<disp-formula id="pcbi.1003397.e192"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003397.e192" xlink:type="simple"/><label>(22)</label></disp-formula></p>
<p>At an ancestral node of <italic>i</italic>, <italic>ψ<sub>i</sub></italic> undergoes a discrete change by a factor which is simply the probability of <italic>i</italic> being the host that transmitted at the node:<disp-formula id="pcbi.1003397.e193"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003397.e193" xlink:type="simple"/><label>(23)</label></disp-formula></p>
<p>Software for calculating <italic>W<sub>ij</sub></italic> as described in this paper is available at <ext-link ext-link-type="uri" xlink:href="http://code.google.com/p/colgem/" xlink:type="simple">http://code.google.com/p/colgem/</ext-link>.</p>
</sec><sec id="s3d">
<title>Simulations</title>
<p>We simulated HIV gene genealogies using an individual-based stochastic simulation based on the epidemic model presented in <xref ref-type="bibr" rid="pcbi.1003397-Volz3">[19]</xref>. These simulations were carried out with the objective of replicating a real HIV dataset as closely as possible, while allowing us to know who infected whom. Sample sizes, the times of sampling, and incidence of infection were all chosen to coincide as closely as possible to the dataset of HIV sequences described in <xref ref-type="bibr" rid="pcbi.1003397-Volz3">[19]</xref>, which was based on 662 HIV-1 sequences sampled from men MSM in the Detroit metropolitan area. Simulated sequences and estimated phylogenies were also chosen to mimic the diversity expected for a sample of subtype B sequences. To capture heterogeneity in simulated outcomes, 20 independent simulations were undertaken.</p>
<p>The HIV model is illustrated in <xref ref-type="fig" rid="pcbi-1003397-g003">Figure 3</xref>. The model in <xref ref-type="bibr" rid="pcbi.1003397-Volz3">[19]</xref> was fitted to a combination of surveillance timeseries data, such as HIV/AIDS diagnoses over time and HIV genetic sequences. This provided an estimate of incidence and prevalence over time as well as estimate of the number of transmissions made by infected individuals in different stages of infection. Parameter estimates in the simulations were taken from the maximum likelihood model fit in <xref ref-type="bibr" rid="pcbi.1003397-Volz3">[19]</xref>. In this model, infected individuals progress through five stages of infection and can be undiagnosed or diagnosed. Diagnosed individuals may additionally receive antiretroviral therapy (ART) which reduces the rate of progression towards AIDS and death. We assume that ART is available after 1998 to all diagnosed individuals. Chronic infections transmit at rate 87.5% smaller than the transmission rate of early HIV infection (EHI), and there are no transmissions from AIDS cases oweing to effective diagnosis and treatment. In this model, the first stage of infection, EHI, lasts <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e194" xlink:type="simple"/></inline-formula> year, three chronic stages last <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e195" xlink:type="simple"/></inline-formula> years on average each, and AIDS lasts <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e196" xlink:type="simple"/></inline-formula> years on average. The total infectious period may be much longer with treatment, which is largely determined by natural mortality, which occurs at the rate <italic>m</italic>(<italic>t</italic>) of 1 per 27 years.</p>
<fig id="pcbi-1003397-g003" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003397.g003</object-id><label>Figure 3</label><caption>
<title>Model used to simulate HIV phylogenies.</title>
<p>Left: Simulated number of infections over time. Infections are aggregated by stage of infection (top) and by diagnosis status (bottom). Right: Flow-diagram showing the progression of infected individuals through 5 stages of infection, diagnosis, and death. The color of compartments correspond to diagnosis status in prevalence figures on left. The color of outlines corresponds to stage of infection in prevalence figures on left. The per-capita rate of state transitions is shown over arrows.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003397.g003" position="float" xlink:type="simple"/></fig>
<p>An essential aspect of this model is how incidence <italic>f</italic>(<italic>t</italic>) and diagnosis rates <italic>μ</italic>(<italic>t</italic>) vary over time. In this model, both of these rates are described by spline functions, and we re-use the parameters of the spline functions estimated in <xref ref-type="bibr" rid="pcbi.1003397-Volz3">[19]</xref>.</p>
<p>In the discrete individual-based simulations, the time to the next transmission event is exponentially distributed with rate <italic>f</italic>(<italic>t</italic>). We make the approximation that <italic>f</italic>(<italic>t</italic>) is constant between transmission events, which is a good approximation since the time between transmissions in the population is quite short relative to the change in <italic>f</italic>(<italic>t</italic>). At each transmission event, the transmitting individual is selected randomly from the set of all infected individuals with a weight that depends on the stage of infection of the individual and whether they are diagnosed. For example, someone with undiagnosed chronic infection will transmit at a rate less than an undiagnosed EHI by a factor of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e197" xlink:type="simple"/></inline-formula> as described above, and a diagnosed chronic infection (pre-treatment) will transmit at a rate less than an undiagnosed EHI by a factor of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e198" xlink:type="simple"/></inline-formula>. Similarly, the time to the next diagnosis event is exponentially distributed with rate <italic>μ</italic>(<italic>t</italic>), and the newly diagnosed individual is selected uniformly at random from the set of all undiagnosed infections.</p>
<p>Note that the the simulation may be put in the canonical form <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e199" xlink:type="simple"/></inline-formula> described above, which allows simulations to be used to calculate infector probabilities. In this case, <italic>m</italic> = 10 (infected may occupy 5 stages and be diagnosed/undiagnosed), and <italic>Y</italic>(<italic>t</italic>) is an <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e200" xlink:type="simple"/></inline-formula>vector that describes how many infected are in each state at time <italic>t</italic>. <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e201" xlink:type="simple"/></inline-formula> gives the transmission rate from state <italic>k</italic> to <italic>l</italic> at time <italic>t</italic>, so for example, if <italic>k</italic> corresponds to undiagnosed chronic infection, and <italic>l</italic> corresponds to undiagnosed EHI, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e202" xlink:type="simple"/></inline-formula>, where <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e203" xlink:type="simple"/></inline-formula> is the relative infectiousness of chronic infections. <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e204" xlink:type="simple"/></inline-formula> represents the rate that type <italic>k</italic> changes state to type <italic>l</italic>; in this model, this process corresponds to stage progression and diagnosis. For example, if <italic>k</italic> corresponds to undiagnosed EHI and <italic>l</italic> corresponds to the first chronic stage, then <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e205" xlink:type="simple"/></inline-formula>.</p>
<p>To reconstruct a gene genealogy from the simulation, we iteratively build a binary tree by adding a new branch at each transmission. The logic underlying tree reconstruction is given in <xref ref-type="bibr" rid="pcbi.1003397-Volz4">[21]</xref>–<xref ref-type="bibr" rid="pcbi.1003397-Bedford1">[23]</xref>. Briefly, if an individual <italic>z</italic> transmits at time <italic>t</italic>, we add a new branch to the tree which connects a new node <italic>u</italic> with an old node <italic>v</italic>. Each node in the tree has a time associated with it. The time of <italic>u</italic> is the time of the new transmission event <italic>t</italic>. The node <italic>v</italic> that is connected to <italic>u</italic> corresponds to the last transmission event that involved host <italic>z</italic>. That event may be another event in which <italic>z</italic> transmitted, or it may correspond to the event where <italic>z</italic> became infected. All of the internal branch lengths in the tree therefore correspond to the time between consecutive transmission events.</p>
<p>In reality, we do not observe the complete transmission genealogy, but rather a small subsample. To model sampling, we randomly sampled <italic>n</italic> = 662 branches heterochronously at regular intervals between the 29th and 37th year of the epidemic. At each sampling time, we introduce a terminal node into the tree with a corresponding time of sampling. The sample size and sample window were chosen to mimic the real dataset in <xref ref-type="bibr" rid="pcbi.1003397-Volz3">[19]</xref>. Unsampled branches are then pruned from the tree, which yields a final binary tree with <italic>n</italic> terminals and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e206" xlink:type="simple"/></inline-formula> internal branches.</p>
<p>As noted above, the calculation of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e207" xlink:type="simple"/></inline-formula> in heterochronous samples does not account for the possibility that a sampled lineage is a direct descendent of a previously sampled ancestral lineage. Nevertheless, we allow this event to occur in simulations in order to evaluate if violation of this assumption is a large source of bias.</p>
</sec><sec id="s3e">
<title>Sequence simulation and phylogenetic analysis</title>
<p>To simulate genetic sequence alignments corresponding to the simulated genealogical relationships described in the previous section, we used the program Seq-Gen v.1.3.3 <xref ref-type="bibr" rid="pcbi.1003397-Rambaut1">[24]</xref>. For each simulated tree, we generated a sequence alignment of 662 sequences, each 1200 nucleotides in length. We used an HKY nucleotide substitution model with a transition-transversion ratio of 4.73, and rate heterogeneity modeled as a mixture of invariant sites (47%), a mean substitution rate of 1.6e-03 per site per year, and a Γ distribution discretized into four categories with a shape parameter of 0.714. These parameters were obtained by a previous phylogenetic analysis of real HIV data <xref ref-type="bibr" rid="pcbi.1003397-Volz5">[25]</xref>.</p>
<p>For each sequence alignment, we used relaxed-clock Bayesian methods <xref ref-type="bibr" rid="pcbi.1003397-Drummond1">[26]</xref> as implemented in the software BEAST <xref ref-type="bibr" rid="pcbi.1003397-Drummond2">[27]</xref> to estimate a posterior distribution of phylogenetic trees. We assumed a GTR substitution model, with rate variation modeled as a mixture of invariant sites and four-category discretized Γ distribution. We used the semi-parametric skyride method <xref ref-type="bibr" rid="pcbi.1003397-Minin1">[28]</xref> to estimate how the effective population size changes through time. Parameters were estimated using a Markov Chain Monte Carlo algorithm which was run for 50 million iterations. We discarded the first 50% of samples as burn-in. To generate estimated infector probabilities from the posterior distribution, we calculated <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e208" xlink:type="simple"/></inline-formula> for a sample of 50 trees and report the mean. We also compare <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e209" xlink:type="simple"/></inline-formula> between samples from the BEAST posterior to investigate uncertainty in <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e210" xlink:type="simple"/></inline-formula> oweing to uncertainty in the underlying phylogeny.</p>
<p>Results for the HIV model presented below which are based on a true transmission genealogy utilize 20 independent simulations. Results that utilize simulated sequences are based on only a single simulation, but utilize 50 posterior sampled trees.</p>
</sec><sec id="s3f">
<title>Simulations for model validation</title>
<p><xref ref-type="supplementary-material" rid="pcbi.1003397.s006">Text S1</xref> and figures S1, S2, S3 describes several additional simulation experiments to validate the numerical accuracy of the approach. These simulations were undertaken using idealized compartmental SIRS models with homochronous samples. The time of sampling (peak prevalence of endemic equilibrium) was investigated.</p>
<p>Define<disp-formula id="pcbi.1003397.e211"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003397.e211" xlink:type="simple"/></disp-formula>In the absence of bias, the expected residual <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e212" xlink:type="simple"/></inline-formula> should be zero where the expectation is taken across all pairs <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e213" xlink:type="simple"/></inline-formula> in all simulations. A t-test was performed to test the hypothesis that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e214" xlink:type="simple"/></inline-formula>.</p>
<p>Code for all simulation experiments can be found at <ext-link ext-link-type="uri" xlink:href="https://code.google.com/p/inferring-the-source-of-transmission-with-phylogenetic-data/" xlink:type="simple">https://code.google.com/p/inferring-the-source-of-transmission-with-phylogenetic-data/</ext-link>.</p>
</sec></sec><sec id="s4">
<title>Results</title>
<p>Synthetic HIV datasets were generated which matches the data described previously in <xref ref-type="bibr" rid="pcbi.1003397-Volz5">[25]</xref> and <xref ref-type="bibr" rid="pcbi.1003397-Volz3">[19]</xref>. This dataset comprised an alignment of 662 HIV-1 subtype B partial-<italic>pol</italic> sequences originally collected for drug resistance testing. All sequences were collected within one year of diagnosis from treatment-naive individuals with self-described MSM risk behavior. Sequences were sampled heterochronously over the period 2004–2012. Additionally, associated with each sequence are clinical covariates such as CD4 counts, last negative test dates, and BED test results <xref ref-type="bibr" rid="pcbi.1003397-Volz3">[19]</xref> that are informative about the stage of infection at the time of diagnosis. In the simulation results, we assume that the stage of infection is known for each sample unit.</p>
<p>The number of HIV infections over time are shown in <xref ref-type="fig" rid="pcbi-1003397-g003">Figure 3</xref> for a single simulation. These trajectories are similar to maximum likelihood estimates obtained in <xref ref-type="bibr" rid="pcbi.1003397-Volz3">[19]</xref> for MSM in the Detroit Metropolitan area. At the end of 2011, there are 2509 prevalent infections according to this simulation, and approximately 662/2509 = 26% of these are sampled for phylogenetic analysis.</p>
<p>Infector probabilities for the HIV simulations are shown in <xref ref-type="fig" rid="pcbi-1003397-g004">Figure 4</xref>. We compare estimates based on the true transmission genealogy, which is not generally known in applications with real data, and a sample of phylogenies from the Bayesian phylogenetic posterior distribution estimated from simulated sequences. Estimates for the true genealogies are based on pooled results for 20 independent simulations, while estimates for the estimated phylogenies are based on a single simulated sequence alignment and 50 trees sampled from the BEAST posterior distribution. Infector probabilities were calculated and compared for all possible pairs of sampled individuals. With both estimated and true genealogies, we find that the infector probabilities increase at the same rate (slope≈1) as the frequency of true transmission events, which are known from the simulations. We regressed the known transmission events, coded as zero or one, on the estimated infector probabilities. If the infector probabilities perfectly coincide with the true frequency of transmission events, the slope of the regression line will be one and the intercept zero. The slope and intercept for the regression line calculated from the true genealogy are respectively 0.93 and 0.01. The slope and intercept of the regression line calculated from 15 estimated phylogenies are respectively 1.04 and 0.006.</p>
<fig id="pcbi-1003397-g004" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003397.g004</object-id><label>Figure 4</label><caption>
<title>Comparison of infector probabilities and frequency of transmission events in simulations.</title>
<p>On the left, infector probabilities are calculated for the true transmission genealogy in 20 independent simulated HIV epidemics and samples of 662 individuals. On the right, infector probabilities are based on simulated sequence data for a single simulation and a sample of 662 individuals. Data are pooled from 50 trees sampled from the Bayesian phylogenetic posterior distribution. Middle: The estimated infector probabilities (x-axis) versus whether a transmission actually occured (hash marks) for all pairs of sampled individuals in the HIV simulation. The red line shows a local-average of the frequency of transmission events. The green line shows a linear regression of true transmission events (coded zero or one) on the estimated infector probability. Histograms show the frequency of estimated infector probabilities when transmissions happen (top) and when they don't (bottom).</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003397.g004" position="float" xlink:type="simple"/></fig>
<p>Histograms in <xref ref-type="fig" rid="pcbi-1003397-g004">Figure 4</xref> also show the frequency of transmission events stratified by the estimated infector probability. This shows that the infector probability is generally quite close to zero in the majority of cases that a transmission event actually occurred. In almost all cases where a transmission did not occur, the estimated infector probability is very close to zero. Considering all 20 simulations, there are <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e215" xlink:type="simple"/></inline-formula> possible transmission events given a sample of 662, and we observed only 1,079 transmission events. Thus, there is only <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e216" xlink:type="simple"/></inline-formula> probability that the donor of a random patient also appears in the sample. This probability depends on details of the epidemiological model, which types of individuals are sampled, and when samples are collected. In this instance, the probability is much lower than the sample fraction (approximately 26%) since the sample is collected over time and the donor for many cases are diagnosed or deceased (only undiagnosed cases are sampled).</p>
<p><xref ref-type="fig" rid="pcbi-1003397-g005">Figure 5</xref> shows estimated infector probabilities based on the true transmission genealogy from a single simulation and on 50 trees sampled from the Bayesian-phylogenetic posterior distribution for a single simulated multiple sequence alignment. The Pearson correlation coefficient between these two sets of infector probabilities is 83%.</p>
<fig id="pcbi-1003397-g005" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003397.g005</object-id><label>Figure 5</label><caption>
<title>Performance of estimated infector probabilities.</title>
<p>Left: Estimated infector probabilities based on the true transmission genealogy versus infector probabilities based on a sample of trees from the Bayesian phylogenetic posterior distribution. The red line shows <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e217" xlink:type="simple"/></inline-formula>. Right: True positive versus false positive rates (ROC) using estimated infector probabilities for classification of who infected whom in simulated HIV epidemics. The ROC curves were calculated for 208 pairs of individuals clustered in cherries in the transmission genealogy. Estimates are shown for the true transmission genealogy for a sample of 662 individuals and for the average infector probability calculated from a sample of 50 trees from a Bayesian phylogenetic posterior distribution.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003397.g005" position="float" xlink:type="simple"/></fig>
<p><xref ref-type="fig" rid="pcbi-1003397-g005">Figure 5</xref> also shows true positive and false positive rates (ROC) if estimated infector probabilities are used for classification of the event that a prospective transmission pair is real. The data are based on a single simulation of the HIV model and a single simulated sequence alignment. If we consider the set of all potential transmission pairs, the classification of true negatives will generally be extremely accurate because distant pairs in the tree will have very low infector probabilities; consequently, the false positive rate will be extremely low for all but the smallest threshold values. Therefore, we confine the analysis to a more difficult problem of identifying true transmission pairs in the set of 208 potential transmission pairs corresponding to cherries (2-clades) in the true genealogy. ROC curves are shown for infector probabilities based on the true transmission genealogy and on the infector probability averaged across 15 trees sampled from the Bayesian-phylogenetic posterior. Both ROC curves have similar properties; the area under the curve (AUC) is 84.7% for the estimated phylogenies and 84.8% for the true genealogy.</p>
<p>Comparing aggregated infector probabilities can be used to detect systematic differences in transmission rates between categories of infected individuals. Relative values of infector probabilities are not equivalent to relative transmission rates, and these statistics should not be interpreted as estimates of relative transmission rates. But, we do expect that relative infector probabilities to trend in the same direction as transmission rates. <xref ref-type="supplementary-material" rid="pcbi.1003397.s004">Figure S4</xref> compares infector probabilities for different stages of infection and for undiagnosed versus diagnosed individuals. These results are based on a single simulation of the HIV model and a single sequence alignment and use a sample of 15 trees from the BEAST posterior distribution. For individual <italic>i</italic>, the expected number of transmissions to other individuals in the sample is the sum of the infector probabilities: <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e218" xlink:type="simple"/></inline-formula>. Individuals who have been infected longer are expected to have larger <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e219" xlink:type="simple"/></inline-formula>, however by dividing by the time since infection <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e220" xlink:type="simple"/></inline-formula>, we may detect increased transmission during EHI. An adjusted infector probability for each category is found by dividing each <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e221" xlink:type="simple"/></inline-formula> by the expected duration that <italic>i</italic> has been infected given that they are sampled in each category:<disp-formula id="pcbi.1003397.e222"><graphic position="anchor" xlink:href="info:doi/10.1371/journal.pcbi.1003397.e222" xlink:type="simple"/></disp-formula>We use the approximation that <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e223" xlink:type="simple"/></inline-formula> years if <italic>i</italic> is sampled with EHI, <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e224" xlink:type="simple"/></inline-formula> years if <italic>i</italic> is sampled with chronic infection, and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e225" xlink:type="simple"/></inline-formula> years if <italic>i</italic> is sampled with AIDS. <xref ref-type="supplementary-material" rid="pcbi.1003397.s004">Figure S4</xref> shows stark differences in the number of transmissions attributable to different categories of infected individual.</p>
<p>In the simulations, EHI transmit at a greater rate than chronic infections by a factor of 12.4. If we compare medians of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e226" xlink:type="simple"/></inline-formula>, we find transmissions from EHI relative to chronic by a factor of 17.2. In the simulations, undiagnosed individuals transmit at a greater rate than diagnosed individuals by a factor of 12.1 after 1998 and by a factor of 6.4 before 1998 because of the effects of treatment. Comparing medians of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e227" xlink:type="simple"/></inline-formula>, we find transmissions from undiagnosed relative to diagnosed by a factor of 7.2.</p>
<p>To demonstrate the feasibility of detecting covariates that impact transmission rates that are not explicitly included in the calculation of <italic>W</italic>, we conducted another simulation that was identical in all respects to those described above except that half of infected individuals (the ‘high risk’ group) transmit at a rate that is 10× greater than the other half (the ‘low risk’ group). Susceptibility was not correlated with infectiousness in this simulation. We then calculated <italic>W</italic> and <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e228" xlink:type="simple"/></inline-formula>, and these values are compared for high and low risk groups in <xref ref-type="fig" rid="pcbi-1003397-g006">Figure 6</xref>. Infector probabilities are much greater for those in the high risk group. The median of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e229" xlink:type="simple"/></inline-formula> in the high risk group is greater than in the low risk group by a factor of 6.7.</p>
<fig id="pcbi-1003397-g006" position="float"><object-id pub-id-type="doi">10.1371/journal.pcbi.1003397.g006</object-id><label>Figure 6</label><caption>
<title>Left: The log of the expected number of transmissions to at least one other sample unit is shown in aggregated form for two risk groups.</title>
<p>The high risk category transmits at a rate 10× that of the low risk category. Right: A quantile-quantile comparison of the distributions of log infector probabilities. A quantile-quantile comparison for undiagnosed and diagnosed is shown at bottom right.</p>
</caption><graphic mimetype="image" xlink:href="info:doi/10.1371/journal.pcbi.1003397.g006" position="float" xlink:type="simple"/></fig><sec id="s4a">
<title>Model validation</title>
<p>To validate the numerical accuracy of our derivation of <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e230" xlink:type="simple"/></inline-formula>, we present additional simulations in <xref ref-type="supplementary-material" rid="pcbi.1003397.s006">Text S1</xref>. In these emperiments, more simulations are carried out and more transmissions are observed so that estimated infector probabilities can be compared with a large sample of transmission events.</p>
<p>In all, 1158 SIRS epidemics were simulated, 59194 potential transmission pairs were evaluated, yeilding 3168 within-sample transmission pairs. A sample of 5% of infections was taken at peak prevalence and endemic equilibrium. Bias was not detected for either sampling time (t-test <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e231" xlink:type="simple"/></inline-formula>).</p>
</sec></sec><sec id="s5">
<title>Discussion</title>
<p>We have presented a method for calculating the probability that one host infected another (the infector probability) in a pathogen phylogeny. This method makes use of extra epidemiological information, such as the incidence and prevalence of infection over time. The method thereby accounts for the possibility that unsampled infected individuals act as either intermediaries or as a common source of infection for a putative donor and recipient of infection. Any infectious disease model that is used to estimate incidence and prevalence of infection implies a relationship between pathogen gene genealogies and infector probabilities. This is the first method which makes the connection between infector probabilities, infectious disease models, and pathogen genealogies explicit. The practical importance of this method is that it enables the estimation of infector probabilities in situations where there is incomplete sampling, which is more often than not the case for high-prevalence community-acquired pathogens like HIV.</p>
<p>Once <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e232" xlink:type="simple"/></inline-formula> is calculated, a variety of auxiliary analyses are enabled. The column sum <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e233" xlink:type="simple"/></inline-formula> is equivalent to the probability that the infector of <italic>j</italic> is in the sample. This statistic will be sensitive to the number of patients sampled and the times of sampling. The row sum <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e234" xlink:type="simple"/></inline-formula> is equivalent to the expected number of secondary infections for case <italic>i</italic> which also appear in the sample. Variation of this statistic can be examined with respect to covariates that may influence transmission rates. Such investigations may indicate which clinical, demographic, and behavioral variables have a large impact on transmission rates and thereby guide further model development.</p>
<p>We have also demonstrated the method using a simulated HIV dataset in which we know who actually infected whom. The dataset was designed to mimic a real HIV dataset, both in terms how patients are sampled and in the epidemiology of infection in the simulated community; phylogenies were estimated from simulated sequences in order to realistically reproduce phylogenetic error. The method is subject to bias due to finite population size and violation of model assumptions. Nevertheless, we have not detected substantial bias in realistic simulation experiments, which suggests that bias will be quite small for applications provided an appropriate epidemiological model is used. <xref ref-type="fig" rid="pcbi-1003397-g004">Figure 4</xref> shows that accuracy is not greatly impacted by phylogenetic uncertainty stemming from the simulated sequences in this application. Although there is very high variation in estimated infector probabilities between individual trees in the Bayesian-phylogenetic posterior distribution, the infector probability averaged over a sample of phylogenies has similar performance to infector probabilities calculated from the true tree. As <xref ref-type="fig" rid="pcbi-1003397-g005">Figure 5</xref> shows, infector probabilities calculated from the true tree are highly correlated with estimated phylogenies, but on an individual basis, there can be huge discrepancies. For example, according to the true tree, an infector probability may be 90%, while according to an estimated tree it may be as low as 35%. Due to the potential for false positive classification, which may occur even if the true genealogy is known, it is more concerning that probabilities calculated from estimated trees can also be much greater than those based on the true tree.</p>
<p>It is also important to note that this simulation study assumed perfect knowledge of incidence and prevalence of infection over time as well as perfect knowledge of the stage of infection at the time each infected host is sampled. In reality, there will be substantial uncertainty regarding both, and that would add additional error to estimated infector probabilities. Even though there is very high variance in the infector probabilities based on estimated phylogenies, the infector probability averaged across estimated phylogenies has similar performance as a statistic for classification (AUC of ROC).</p>
<p>There has been controversy <xref ref-type="bibr" rid="pcbi.1003397-Leitner1">[29]</xref>–<xref ref-type="bibr" rid="pcbi.1003397-Pillay1">[31]</xref> regarding whether abundant HIV sequences collected for clinical purposes may be useful for forensic investigations into who acquired infection from whom. Alternatively, such sequence data may be useful for epidemiological investigations only. An obvious temptation is to use the proposed models in forensic cases. At realistic levels of sampling that resemble currently availabe HIV DRM sequence databases, infector probabilities are quite small. In other words, even though the method may give a realistic estimate of the probability that <italic>i</italic> infected <italic>j</italic>, we rarely have much confidence that <italic>i</italic> infected <italic>j</italic>. In addition, forensic investigations often employ a more targeted approach to sampling and serial sampling of individual hosts <xref ref-type="bibr" rid="pcbi.1003397-Scaduto1">[7]</xref>, <xref ref-type="bibr" rid="pcbi.1003397-Leitner1">[29]</xref>, which violates the assumption of simple random sampling used in our models. Calculating infector probabilities may actually be helpful for protecting patient confidentiality, since sequence data could be screened and stripped of closely linked pairs prior to being deposited in public databases.</p>
<p>Our simulation experiments have demonstrated how infector probabilities are sensitive to many factors in addition to the structure of the phylogeny, such as details about who is sampled, when they are sampled, and the state of infected individuals at the time of sampling. Details of the epidemic process such as incidence and prevalence over time also influence infector probabilities. Most clustering methods employ a threshold genetic or evolutionary distance, but, as shown in <xref ref-type="supplementary-material" rid="pcbi.1003397.s005">Figure S5</xref>, there is a noisy relationship between infector probabilities and the cophenetic distance within the HIV gene genealogy. Infector probabilities are highly correlated with phylogenetic distance, yet for a given phylogenetic distance, the infector probabilities may differ by many orders of magnitude. Getting a realistic picture of potential transmission pairs requires consideration of all of the factors included in our solution for the infector probabilities.</p>
<p>Even though transmission events could not be inferred with high confidence, the application of infector probabilities to epidemiological investigations of HIV seems promising in light of the results in <xref ref-type="fig" rid="pcbi-1003397-g006">Figure 6</xref> and <xref ref-type="supplementary-material" rid="pcbi.1003397.s004">S4</xref>. Infector probabilities capture increased transmissions by those with early infection and those who are undiagnosed at the time of sampling relative to those who are diagnosed. We can also detect the effects on transmission rates of covariates that are not explicitly included in the coalescent model.</p>
<p>Our models have additional utility beyond the calculation of infector probabilies. Similar methods could be used to calculate the distribution of the number of unsampled infected individuals in a transmission chain between two sample units. For example, this has relevance for studies of the evolution of virulence of HIV <xref ref-type="bibr" rid="pcbi.1003397-Shirreff1">[32]</xref>, <xref ref-type="bibr" rid="pcbi.1003397-Alizon1">[33]</xref>, which is frequently assessed by conducting comparative phylogenetic analyses of set-point viral load and declining slope CD4. Most comparative phylogenetic analyses are based on diffusion models of a continuous trait, however models which account for discrete transmission events may be more appropriate. One could, for example, use information about the length of a transmission chain to obtain estimates of how set point viral load correlates between epidemiologically linked pairs.</p>
<p>This method for calculating infector probabilities is based on a population genetic model that makes assumptions about the epidemiological and immunological process. The model does not account for the potential for superinfection, recombination, or complex within-host evolutionary dynamics which could confuse phylogenetic inference and decrease confidence in putative transmission links. Furthermore, the model does not account for multiple- or serial-sampling of a single infected host. Future research is needed on methods for relaxing these assumptions as well as for quantifying error that may arise from violation of model assumptions in realistic settings.</p>
</sec><sec id="s6">
<title>Supporting Information</title>
<supplementary-material id="pcbi.1003397.s001" mimetype="image/png" xlink:href="info:doi/10.1371/journal.pcbi.1003397.s001" position="float" xlink:type="simple"><label>Figure S1</label><caption>
<p>Simulated number of infections through time for the SIRS model.</p>
<p>(PNG)</p>
</caption></supplementary-material><supplementary-material id="pcbi.1003397.s002" mimetype="image/png" xlink:href="info:doi/10.1371/journal.pcbi.1003397.s002" position="float" xlink:type="simple"><label>Figure S2</label><caption>
<p>Regression of true transmission events (ticks on axis coded zero or one) on calculated infector probabilities <inline-formula><inline-graphic xlink:href="info:doi/10.1371/journal.pcbi.1003397.e235" xlink:type="simple"/></inline-formula>. Left: samples of 10% at endemic equilibrium. Right: samples of 10% at peak prevalence.</p>
<p>(PNG)</p>
</caption></supplementary-material><supplementary-material id="pcbi.1003397.s003" mimetype="image/png" xlink:href="info:doi/10.1371/journal.pcbi.1003397.s003" position="float" xlink:type="simple"><label>Figure S3</label><caption>
<p>Top: Model structure and population size over time for a model with three states. Blue arrows represent birth within and between states. Red arrows represent migration between states. Bottom: Regression of true transmission events (ticks on axis coded zero or one) on calculated infector probabilities. At right is shown the ROC curve if infector probabilities are used for classification of the event that a putative transmission pair is real.</p>
<p>(PNG)</p>
</caption></supplementary-material><supplementary-material id="pcbi.1003397.s004" mimetype="application/pdf" xlink:href="info:doi/10.1371/journal.pcbi.1003397.s004" position="float" xlink:type="simple"><label>Figure S4</label><caption>
<p>The log of the expected number of transmissions to at least one other sample unit is shown in aggregated form for different stages of infection and diagnosis status (top). Each stage is represented twice in this figure because an infected individual may be undiagnosed or diagnosed (labels prefixed with ‘D.’). A sampled lineage from an undiagnosed individual corresponds to a situation in which a pathogen is sequenced at the same time that the patient is diagnosed. A quantile-quantile comparison of the distributions of log infector probabilities for EHI and chronic stages is shown at bottom left. A quantile-quantile comparison for undiagnosed and diagnosed is shown at bottom right.</p>
<p>(PDF)</p>
</caption></supplementary-material><supplementary-material id="pcbi.1003397.s005" mimetype="image/png" xlink:href="info:doi/10.1371/journal.pcbi.1003397.s005" position="float" xlink:type="simple"><label>Figure S5</label><caption>
<p>The cophenetic distance between each pair of tips in the HIV gene genealogy is shown versus the calculated infector probabilities.</p>
<p>(PNG)</p>
</caption></supplementary-material><supplementary-material id="pcbi.1003397.s006" mimetype="application/pdf" xlink:href="info:doi/10.1371/journal.pcbi.1003397.s006" position="float" xlink:type="simple"><label>Text S1</label><caption>
<p>Additional simulation experiments.</p>
<p>(PDF)</p>
</caption></supplementary-material></sec></body>
<back><ref-list>
<title>References</title>
<ref id="pcbi.1003397-Pybus1"><label>1</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Pybus</surname><given-names>O</given-names></name>, <name name-style="western"><surname>Rambaut</surname><given-names>A</given-names></name> (<year>2009</year>) <article-title>Evolutionary analysis of the dynamics of viral infectious disease</article-title>. <source>Nature Reviews Genetics</source> <volume>10</volume>: <fpage>540</fpage>–<lpage>550</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003397-Baker1"><label>2</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Baker</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Hanage</surname><given-names>WP</given-names></name>, <name name-style="western"><surname>Holt</surname><given-names>KE</given-names></name> (<year>2010</year>) <article-title>Navigating the future of bacterial molecular epidemiology</article-title>. <source>Current Opinion in Microbiology</source> <volume>13</volume>: <fpage>640</fpage>–<lpage>645</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003397-Volz1"><label>3</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Volz</surname><given-names>E</given-names></name>, <name name-style="western"><surname>Koelle</surname><given-names>K</given-names></name>, <name name-style="western"><surname>Bedford</surname><given-names>T</given-names></name> (<year>2013</year>) <article-title>Viral phylodynamics</article-title>. <source>PLoS Computational Biology</source> <volume>9</volume>: <fpage>e1002947</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003397-Grenfell1"><label>4</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Grenfell</surname><given-names>B</given-names></name>, <name name-style="western"><surname>Pybus</surname><given-names>O</given-names></name>, <name name-style="western"><surname>Gog</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Wood</surname><given-names>J</given-names></name>, <name name-style="western"><surname>Daly</surname><given-names>J</given-names></name>, <etal>et al</etal>. (<year>2004</year>) <article-title>Unifying the epidemiological and evolutionary dynamics of pathogens</article-title>. <source>Science</source> <volume>303</volume>: <fpage>327</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003397-Eshleman1"><label>5</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Eshleman</surname><given-names>SH</given-names></name>, <name name-style="western"><surname>Hudelson</surname><given-names>SE</given-names></name>, <name name-style="western"><surname>Redd</surname><given-names>AD</given-names></name>, <name name-style="western"><surname>Wang</surname><given-names>L</given-names></name>, <name name-style="western"><surname>Debes</surname><given-names>R</given-names></name>, <etal>et al</etal>. (<year>2011</year>) <article-title>Analysis of genetic linkage of HIV from couples enrolled in the HIV Prevention Trials Network 052 trial</article-title>. <source>Journal of Infectious Diseases</source> <volume>204</volume>: <fpage>1918</fpage>–<lpage>1926</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003397-Schutzer1"><label>6</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Schutzer</surname><given-names>SE</given-names></name>, <name name-style="western"><surname>Budowle</surname><given-names>B</given-names></name>, <name name-style="western"><surname>Atlas</surname><given-names>RM</given-names></name> (<year>2005</year>) <article-title>Biocrimes, microbial forensics, and the physician</article-title>. <source>PLoS medicine</source> <volume>2</volume>: <fpage>e337</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003397-Scaduto1"><label>7</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Scaduto</surname><given-names>DI</given-names></name>, <name name-style="western"><surname>Brown</surname><given-names>JM</given-names></name>, <name name-style="western"><surname>Haaland</surname><given-names>WC</given-names></name>, <name name-style="western"><surname>Zwickl</surname><given-names>DJ</given-names></name>, <name name-style="western"><surname>Hillis</surname><given-names>DM</given-names></name>, <etal>et al</etal>. (<year>2010</year>) <article-title>Source identification in two criminal cases using phylogenetic analysis of HIV-1 DNA sequences</article-title>. <source>Proceedings of the National Academy of Sciences</source> <volume>107</volume>: <fpage>21242</fpage>–<lpage>21247</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003397-Ou1"><label>8</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Ou</surname><given-names>CY</given-names></name>, <name name-style="western"><surname>Ciesielski</surname><given-names>CA</given-names></name>, <name name-style="western"><surname>Myers</surname><given-names>G</given-names></name>, <name name-style="western"><surname>Bandea</surname><given-names>CI</given-names></name>, <name name-style="western"><surname>Luo</surname><given-names>CC</given-names></name>, <etal>et al</etal>. (<year>1992</year>) <article-title>Molecular epidemiology of HIV transmission in a dental practice</article-title>. <source>Science</source> <volume>256</volume>: <fpage>1165</fpage>–<lpage>1171</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003397-Velsko1"><label>9</label>
<mixed-citation publication-type="other" xlink:type="simple">Velsko SP, Allen JE, Cunningham CT (2009) A statistical framework for microbial source attribution. Technical report, Lawrence Livermore National Laboratory (LLNL), Livermore, CA.</mixed-citation>
</ref>
<ref id="pcbi.1003397-Ypma1"><label>10</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Ypma</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Bataille</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Stegeman</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Koch</surname><given-names>G</given-names></name>, <name name-style="western"><surname>Wallinga</surname><given-names>J</given-names></name>, <etal>et al</etal>. (<year>2012</year>) <article-title>Unravelling transmission trees of infectious diseases by combining genetic and epidemiological data</article-title>. <source>Proceedings of the Royal Society B: Biological Sciences</source> <volume>279</volume>: <fpage>444</fpage>–<lpage>450</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003397-Jombart1"><label>11</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Jombart</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Eggo</surname><given-names>R</given-names></name>, <name name-style="western"><surname>Dodd</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Balloux</surname><given-names>F</given-names></name> (<year>2010</year>) <article-title>Reconstructing disease outbreaks from genetic data: a graph approach</article-title>. <source>Heredity</source> <volume>106</volume>: <fpage>383</fpage>–<lpage>390</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003397-Snitkin1"><label>12</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Snitkin</surname><given-names>ES</given-names></name>, <name name-style="western"><surname>Zelazny</surname><given-names>AM</given-names></name>, <name name-style="western"><surname>Thomas</surname><given-names>PJ</given-names></name>, <name name-style="western"><surname>Stock</surname><given-names>F</given-names></name>, <name name-style="western"><surname>Henderson</surname><given-names>DK</given-names></name>, <etal>et al</etal>. (<year>2012</year>) <article-title>Tracking a hospital outbreak of carbapenem-resistant klebsiella pneumoniae with whole-genome sequencing</article-title>. <source>Science Translational Medicine</source> <volume>4</volume>: <fpage>148ra116</fpage>–<lpage>148ra116</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003397-Gardy1"><label>13</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Gardy</surname><given-names>JL</given-names></name>, <name name-style="western"><surname>Johnston</surname><given-names>JC</given-names></name>, <name name-style="western"><surname>Sui</surname><given-names>SJH</given-names></name>, <name name-style="western"><surname>Cook</surname><given-names>VJ</given-names></name>, <name name-style="western"><surname>Shah</surname><given-names>L</given-names></name>, <etal>et al</etal>. (<year>2011</year>) <article-title>Whole-genome sequencing and social-network analysis of a tuberculosis outbreak</article-title>. <source>New England Journal of Medicine</source> <volume>364</volume>: <fpage>730</fpage>–<lpage>739</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003397-Ypma2"><label>14</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Ypma</surname><given-names>RJ</given-names></name>, <name name-style="western"><surname>Jonges</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Bataille</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Stegeman</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Koch</surname><given-names>G</given-names></name>, <etal>et al</etal>. (<year>2013</year>) <article-title>Genetic data provide evidence for wind-mediated transmission of highly pathogenic avian influenza</article-title>. <source>Journal of Infectious Diseases</source> <volume>207</volume>: <fpage>730</fpage>–<lpage>735</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003397-Metzker1"><label>15</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Metzker</surname><given-names>ML</given-names></name>, <name name-style="western"><surname>Mindell</surname><given-names>DP</given-names></name>, <name name-style="western"><surname>Liu</surname><given-names>XM</given-names></name>, <name name-style="western"><surname>Ptak</surname><given-names>RG</given-names></name>, <name name-style="western"><surname>Gibbs</surname><given-names>RA</given-names></name>, <etal>et al</etal>. (<year>2002</year>) <article-title>Molecular evidence of HIV-1 transmission in a criminal case</article-title>. <source>Proceedings of the National Academy of Sciences</source> <volume>99</volume>: <fpage>14292</fpage>–<lpage>14297</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003397-Fisher1"><label>16</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Fisher</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Pao</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Brown</surname><given-names>AE</given-names></name>, <name name-style="western"><surname>Sudarshi</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Gill</surname><given-names>ON</given-names></name>, <etal>et al</etal>. (<year>2010</year>) <article-title>Determinants of HIV-1 transmission in men who have sex with men: a combined clinical, epidemiological and phylogenetic approach</article-title>. <source>AIDS</source> <volume>24</volume>: <fpage>1739</fpage>–<lpage>1747</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003397-Volz2"><label>17</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Volz</surname><given-names>E</given-names></name> (<year>2012</year>) <article-title>Complex population dynamics and the coalescent under neutrality</article-title>. <source>Genetics</source> <volume>190</volume>: <fpage>187</fpage>–<lpage>201</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003397-Wakeley1"><label>18</label>
<mixed-citation publication-type="other" xlink:type="simple">Wakeley J (2005) Coalescent theory: an introduction. Roberts Greenwood Village, Colorado.</mixed-citation>
</ref>
<ref id="pcbi.1003397-Volz3"><label>19</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Volz</surname><given-names>E</given-names></name>, <name name-style="western"><surname>Ionides</surname><given-names>E</given-names></name>, <name name-style="western"><surname>Romero Severson</surname><given-names>E</given-names></name>, <name name-style="western"><surname>Brandt</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Mokotoff</surname><given-names>E</given-names></name>, <etal>et al</etal>. (<year>2013</year>) <article-title>HIV-1 transmission during early infection in men who have sex with men: A phylodynamic analysis</article-title>. <source>PLoS Medicine</source> [In Press].</mixed-citation>
</ref>
<ref id="pcbi.1003397-Frost1"><label>20</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Frost</surname><given-names>SDW</given-names></name>, <name name-style="western"><surname>Volz</surname><given-names>EM</given-names></name> (<year>2013</year>) <article-title>Modelling tree shape and structure in viral phylodynamics</article-title>. <source>Philos Trans R Soc Lond B Biol Sci</source> <volume>368</volume>: <fpage>20120208</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003397-Volz4"><label>21</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Volz</surname><given-names>E</given-names></name>, <name name-style="western"><surname>Pond</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Ward</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Leigh Brown</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Frost</surname><given-names>S</given-names></name> (<year>2009</year>) <article-title>Phylodynamics of infectious disease epidemics</article-title>. <source>Genetics</source> <volume>183</volume>: <fpage>1421</fpage>–<lpage>1430</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003397-Gordo1"><label>22</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Gordo</surname><given-names>I</given-names></name>, <name name-style="western"><surname>Gomes</surname><given-names>MGM</given-names></name>, <name name-style="western"><surname>Reis</surname><given-names>DG</given-names></name>, <name name-style="western"><surname>Campos</surname><given-names>PR</given-names></name> (<year>2009</year>) <article-title>Genetic diversity in the SIR model of pathogen evolution</article-title>. <source>PLoS One</source> <volume>4</volume>: <fpage>e4876</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003397-Bedford1"><label>23</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Bedford</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Cobey</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Beerli</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Pascual</surname><given-names>M</given-names></name> (<year>2010</year>) <article-title>Global migration dynamics underlie evolution and persistence of human influenza A (H3N2)</article-title>. <source>PLoS pathogens</source> <volume>6</volume>: <fpage>e1000918</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003397-Rambaut1"><label>24</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Rambaut</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Grass</surname><given-names>N</given-names></name> (<year>1997</year>) <article-title>Seq-Gen: an application for the Monte Carlo simulation of DNA sequence evolution along phylogenetic trees</article-title>. <source>Computer Applications in the Biosciences: CABIOS</source> <volume>13</volume>: <fpage>235</fpage>–<lpage>238</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003397-Volz5"><label>25</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Volz</surname><given-names>EM</given-names></name>, <name name-style="western"><surname>Koopman</surname><given-names>JS</given-names></name>, <name name-style="western"><surname>Ward</surname><given-names>MJ</given-names></name>, <name name-style="western"><surname>Brown</surname><given-names>AL</given-names></name>, <name name-style="western"><surname>Frost</surname><given-names>SDW</given-names></name> (<year>2012</year>) <article-title>Simple epidemiological dynamics explain phylogenetic clustering of hiv from patients with recent infection</article-title>. <source>PLoS Comput Biol</source> <volume>8</volume>: <fpage>e1002552</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003397-Drummond1"><label>26</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Drummond</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Ho</surname><given-names>S</given-names></name>, <name name-style="western"><surname>Phillips</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Rambaut</surname><given-names>A</given-names></name> (<year>2006</year>) <article-title>Relaxed phylogenetics and dating with confidence</article-title>. <source>PLoS Biology</source> <volume>4</volume>: <fpage>e88</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003397-Drummond2"><label>27</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Drummond</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Rambaut</surname><given-names>A</given-names></name> (<year>2007</year>) <article-title>BEAST: Bayesian evolutionary analysis by sampling trees</article-title>. <source>BMC Evolutionary Biology</source> <volume>7</volume>: <fpage>214</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003397-Minin1"><label>28</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Minin</surname><given-names>V</given-names></name>, <name name-style="western"><surname>Bloomquist</surname><given-names>E</given-names></name>, <name name-style="western"><surname>Suchard</surname><given-names>M</given-names></name> (<year>2008</year>) <article-title>Smooth skyride through a rough skyline: Bayesian coalescent-based inference of population dynamics</article-title>. <source>Molecular Biology and Evolution</source> <volume>25</volume>: <fpage>1459</fpage>–<lpage>1471</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003397-Leitner1"><label>29</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Leitner</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Albert</surname><given-names>J</given-names></name> (<year>2000</year>) <article-title>Reconstruction of HIV-1 transmission chains for forensic purposes</article-title>. <source>AIDS Rev</source> <volume>2</volume>: <fpage>241</fpage>–<lpage>251</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003397-Strmer1"><label>30</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Stürmer</surname><given-names>M</given-names></name>, <name name-style="western"><surname>Preiser</surname><given-names>W</given-names></name>, <name name-style="western"><surname>Gute</surname><given-names>P</given-names></name>, <name name-style="western"><surname>Nisius</surname><given-names>G</given-names></name>, <name name-style="western"><surname>Doerr</surname><given-names>HW</given-names></name> (<year>2004</year>) <article-title>Phylogenetic analysis of HIV-1 transmission: pol gene sequences are insufficient to clarify true relationships between patient isolates</article-title>. <source>AIDS</source> <volume>18</volume>: <fpage>2109</fpage>–<lpage>2113</lpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003397-Pillay1"><label>31</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Pillay</surname><given-names>D</given-names></name>, <name name-style="western"><surname>Rambaut</surname><given-names>A</given-names></name>, <name name-style="western"><surname>Geretti</surname><given-names>AM</given-names></name>, <name name-style="western"><surname>Brown</surname><given-names>AJL</given-names></name> (<year>2007</year>) <article-title>HIV phylogenetics</article-title>. <source>BMJ: British Medical Journal</source> <volume>335</volume>: <fpage>460</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003397-Shirreff1"><label>32</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Shirreff</surname><given-names>G</given-names></name>, <name name-style="western"><surname>Pellis</surname><given-names>L</given-names></name>, <name name-style="western"><surname>Laeyendecker</surname><given-names>O</given-names></name>, <name name-style="western"><surname>Fraser</surname><given-names>C</given-names></name> (<year>2011</year>) <article-title>Transmission selects for HIV-1 strains of intermediate virulence: a modelling approach</article-title>. <source>PLoS computational biology</source> <volume>7</volume>: <fpage>e1002185</fpage>.</mixed-citation>
</ref>
<ref id="pcbi.1003397-Alizon1"><label>33</label>
<mixed-citation publication-type="journal" xlink:type="simple"><name name-style="western"><surname>Alizon</surname><given-names>S</given-names></name>, <name name-style="western"><surname>von Wyl</surname><given-names>V</given-names></name>, <name name-style="western"><surname>Stadler</surname><given-names>T</given-names></name>, <name name-style="western"><surname>Kouyos</surname><given-names>RD</given-names></name>, <name name-style="western"><surname>Yerly</surname><given-names>S</given-names></name>, <etal>et al</etal>. (<year>2010</year>) <article-title>Phylogenetic approach reveals that virus genotype largely determines HIV set-point viral load</article-title>. <source>PLoS Pathogens</source> <volume>6</volume>: <fpage>e1001123</fpage>.</mixed-citation>
</ref>
</ref-list></back>
</article>